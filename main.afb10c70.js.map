{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/Cell.vue?7813","webpack:///./components/Cell.vue?334d","webpack:///./components/Cell.vue","webpack:///./components/Cell.vue?3316","webpack:///./src/utils.ts","webpack:///./src/fov.ts","webpack:///./src/items/internal.ts","webpack:///./src/inventory.ts","webpack:///./src/screen.ts","webpack:///./src/creature.ts","webpack:///./src/ai/internal.ts","webpack:///./src/ai/attacker.ts","webpack:///./src/ai/chaser.ts","webpack:///./src/ai/meta_ai.ts","webpack:///./src/characteristics.ts","webpack:///./src/ai/wearer.ts","webpack:///./src/ai/dispatcher.ts","webpack:///./src/ai/escaper.ts","webpack:///./src/ai/explorer.ts","webpack:///./src/ai/loiter.ts","webpack:///./src/ai/patrol.ts","webpack:///./src/ai/picker.ts","webpack:///./src/ai/selfhealer.ts","webpack:///./src/ai/descender.ts","webpack:///./src/effect.ts","webpack:///./src/ai/thrower.ts","webpack:///./src/tile.ts","webpack:///./src/logger.ts","webpack:///./src/timeline.ts","webpack:///./src/map.ts","webpack:///./src/level.ts","webpack:///./src/memory.ts","webpack:///./src/game.ts","webpack:///./src/pool.ts","webpack:///./src/profession.ts","webpack:///./src/generator/post.ts","webpack:///./src/generator/drawn.ts","webpack:///./src/generator/dungeon.ts","webpack:///./components/Logger.vue?9375","webpack:///./components/Logger.vue?c1ad","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?e2af","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/stats.vue?8458","webpack:///./components/stats.vue?fdb0","webpack:///./src/ai/waiter.ts","webpack:///./components/stats.vue","webpack:///./components/stats.vue?cdea","webpack:///./components/Scene.vue?a156","webpack:///./components/Scene.vue?4292","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?8c9b","webpack:///./components/LevelUp.vue?afd3","webpack:///./components/LevelUp.vue?22fc","webpack:///./components/LevelUp.vue","webpack:///./components/LevelUp.vue?ad0e","webpack:///./src/onisun.ts","webpack:///./components/App.vue?b7e9","webpack:///./components/App.vue?91d1","webpack:///./components/App.vue","webpack:///./components/App.vue?f4fc","webpack:///./components/index.ts","webpack:///./components/App.vue?7ea9","webpack:///./components/LevelUp.vue?d2f2","webpack:///./components/Scene.vue?c20d","webpack:///./components/Logger.vue?c164","webpack:///./node_modules/moment/locale sync ^\\.\\/.*$","webpack:///./components/Cell.vue?b975"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","components_Cellvue_type_script_lang_ts","vue_runtime_esm","extend","props","computed","[object Object]","this","player","cell","isWall","isDoor","display","Cell","componentNormalizer","_h","$createElement","_self","_c","_v","Rect","x","y","w","h","succ","String","fromCharCode","charCodeAt","rand","max","Math","floor","random","twoDimArray","width","height","field","Array","min","list","Point","point","abs","dxy","map","add","Mapped","on","forEach","column","tile","cycle","dx","pop","unshift","bresenham","p0","p1","x0","x1","y0","y1","steps","delta","round","Fov","startx","starty","radius","checkSolid","markVisible","doubleRadius","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","Usage","ItemGroup","BodyPart","Item","group","usages","id","getId","lastId","Corpse","specie","super","Consumable","Equipment","modifier","creature","characteristics","addModifier","removeModifier","Missile","Throw","BodyArmor","WearsOnBody","OneHandWeapon","WeaponOneHand","bodyToUsage","RightHand","Body","inventory_Inventory","parts","wearings","bag","bodyPart","usage","match","wears","find","equipment","item","some","wearing","lodash","filter","actor","matchingEquip","putToBag","onTakeOff","onPutOn","inventoryItem","Screen","game","input","screen","undefined","LevelUp","options","professionPicker","available","pickedProfession","levelUps","levelUp","playerProfession","professions","profession","level","Clan","Ability","allAbilities","keys","Specie","clan","abilities","creature_Phantom","refToReal","ability","Event","AttackEvent","subject","misses","currentLevel","logger","missMessage","Reaction","DODGE","damage","damageTo","health","currentValue","AddExperienceEvent","killMessage","die","DIE","decrease","hurtMessage","HURT","ThrowEvent","missile","throwMisses","throwMissMessage","THROW_DODGE","throwDamageTo","throwKillMessage","throwHurtMessage","creature_Player","NOTHING","creature_Creature","ai","stageMemories","inventory","LeftHand","Legs","Finger","Head","Eye","Neck","Back","MissileWeapon","equip","removeFromBag","takeOff","pos","previousLevel","addCreature","visionMask","removeCreature","at","items","cares","event","affect","speed","levelId","stage","previousPos","copy","act","nextPoint","phantom","stageMemory","resetVisible","memory_Memory","isSolid","degree","see","calc","visibleThrough","dead","FIRST_STEP","internal_AI","prevAI","destination","eq","path","leePath","move","nextTo","randomDestination","pointsToVisit","pointsToCheck","step","wavePoints","inRange","tangible","wrappers","dist","buildRoad","lastPoint","chain","dp","visit","tileVisited","visible","enemy","FreeForAll","Player","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","goTo","onMove","onReach","onCantMove","moveTo","GoToTileAI","metaAI","matcher","attacker_Attacker","canAttack","firstTurn","victimInAccess","attack","pickNewVictim","victim","findCreature","enemies","real","condition","memory","chaser_Chaser","reset","victimId","victimSet","buildVictimPath","foundNewVictim","followTo","withinView","AIEventType","AIEvent","type","AIItemPickedEvent","ItemPickedUp","meta_ai_MetaAI","aiToRun","events","characteristics_Attribute","current","modifiers","increase","val","PositiveAttribute","AttributeSet","defense","dexterity","pairSet","Modifier","weight","Characteristics","with","char","mod","dex","pow","regenerationValue","constantIncrease","wearer_Wearer","can","PutOn","canWear","whereToWear","putOn","matches","weightModifier","reduce","acc","withWeight","f","dispatcher_Dispatcher","firstCallPatrol","escaper","escaper_Escaper","explorer","explorer_Explorer","chaser","attacker","picker","picker_Picker","patrol","patrol_Patrol","loiter","loiter_Loiter","thrower","thrower_Thrower","descender","descender_Descender","regenerateEvery","regenerate","feelsGood","setAi","seesItems","pickItem","explore","healthCritical","rest","resetEvents","maximum","trackMovement","addNode","selfhealer_SelfHealer","STEP_DISTANCE","escapesFrom","foundEnemies","buildPath","minDistance","seen","NEW_POINT_EVERY","graph","graphlib","lastNodeVisit","markNodeVisited","currentNodeID","nodes","moveToTarget","targetNodeID","pickUpNewTarget","shouldAddNode","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","desiredItemId","Inventory","findItem","pushEvent","atMax","kind","TileTypes","StairwayDown","canDescend","GoStairwayDown","go","Effect","onDone","ItemFlightEffect","frames","done","effect","patchMemory","Throwing","hasMissile","missiles","previousVictim","addEffect","inSlot","obstacles","target","Tile","Floor","Wall","Door","StairwayUp","isFloor","retrieve","clone","repository","Stairway","currentMap","leave","adjacentMap","enter","enterPos","LogLevel","LogMessage","ts","message","logger_Logger","messages","debug","warning","addMessage","DEBUG","INFO","WARNING","DANGER","moment","timeline_Timeline","turns","element","parseInt","actors","map_LevelMap","creatures","timeline","addToMap","remove","passibleThrough","actorId","next","rebuildVision","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","MemoryTile","baseTile","each","game_Game","pool_Pool","totalWeight","ceil","pick","pool","totalPool","Profession","ProfessionPicker","addDoors","addDoor","up","down","left","right","setTile","addCreatures","chance","creaturesPool","addItems","itemsPool","addItem","centralize","minX","minY","maxX","maxY","addOnTile","onValid","iters","connectMaps","map1","map2","downTile","ux","uy","upTile","drawn","drawMap","charAt","THICKNESS","newRoomSpace","newCorridor","newWall","RAY_TURNS","DELTA_ANGLE","PI","dungeon_Room","rect","dungeon_Road","lined","hx","hy","horizontalLine","vx","vy","verticalLine","generator_dungeon","dimX","dimY","minSize","maxSize","roomsCount","dungeon","rooms","fill","_","generateRoom","normalize","ray","roads","buildRoads","pickedRooms","currentRoom","angle","cos","sin","roomToMove","ndx","ndy","every","room","notCross","points","pointWithin","connectedPoints","point1","point2","currentPoint","pointToConnect","currentDistance","components_Loggervue_type_script_lang_ts","methods","record","format","components_Logger","_vm","ref","staticClass","_l","class","rowClass","_s","unicodetiles_Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","elem","appendChild","charMap","charArray","defaultColors","attribs","position","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","displayItem","components_statsvue_type_script_lang_ts","aiName","getChar","displayAttribute","attribute","mods","grouped","stats","displayAttributeWithModifiers","displayBodyPart","groupedCares","count","HUMAN","HUMAN2","HUMAN3","HUMAN4","HUMAN5","RAT","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","Scenevue_type_script_lang_ts_NULLTILE","nextItemAnimation","components_Scenevue_type_script_lang_ts","wholeMap","term","eng","drawInterval","Date","now","fps","counter","interval","nextStep","pause","components","Stats","frame","animationFps","itemId","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","duration","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","turn","update","lighted","fovTile","initViewport","watch","Scene","directives","rawName","expression","attrs","domProps","checked","isArray","_i","change","$event","$$a","$$el","$$c","$$i","concat","composing","for","click","components_LevelUpvue_type_script_lang_ts","picked","onInput","components_LevelUp","option","close","_e","baseConfig","weapons","newCreature","rat","orc","undead","robot","creaturesPool1","creaturesPool2","creaturesPool3","creaturesPool4","creaturesPool5","onisun_OnisunProfessionPicker","maxLevel","maxTaken","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","excludeProfessions","excluding","onisun_Onisun","generatorOptions","initPlayer","generateMap","map3","map4","map5","dagger","rock","playerSpecie","merge","components_Appvue_type_script_lang_ts","Logger","App","$set","el","./af","./af.js","./ar","./ar-dz","./ar-dz.js","./ar-kw","./ar-kw.js","./ar-ly","./ar-ly.js","./ar-ma","./ar-ma.js","./ar-sa","./ar-sa.js","./ar-tn","./ar-tn.js","./ar.js","./az","./az.js","./be","./be.js","./bg","./bg.js","./bm","./bm.js","./bn","./bn.js","./bo","./bo.js","./br","./br.js","./bs","./bs.js","./ca","./ca.js","./cs","./cs.js","./cv","./cv.js","./cy","./cy.js","./da","./da.js","./de","./de-at","./de-at.js","./de-ch","./de-ch.js","./de.js","./dv","./dv.js","./el","./el.js","./en-au","./en-au.js","./en-ca","./en-ca.js","./en-gb","./en-gb.js","./en-ie","./en-ie.js","./en-il","./en-il.js","./en-nz","./en-nz.js","./eo","./eo.js","./es","./es-do","./es-do.js","./es-us","./es-us.js","./es.js","./et","./et.js","./eu","./eu.js","./fa","./fa.js","./fi","./fi.js","./fo","./fo.js","./fr","./fr-ca","./fr-ca.js","./fr-ch","./fr-ch.js","./fr.js","./fy","./fy.js","./gd","./gd.js","./gl","./gl.js","./gom-latn","./gom-latn.js","./gu","./gu.js","./he","./he.js","./hi","./hi.js","./hr","./hr.js","./hu","./hu.js","./hy-am","./hy-am.js","./id","./id.js","./is","./is.js","./it","./it.js","./ja","./ja.js","./jv","./jv.js","./ka","./ka.js","./kk","./kk.js","./km","./km.js","./kn","./kn.js","./ko","./ko.js","./ky","./ky.js","./lb","./lb.js","./lo","./lo.js","./lt","./lt.js","./lv","./lv.js","./me","./me.js","./mi","./mi.js","./mk","./mk.js","./ml","./ml.js","./mn","./mn.js","./mr","./mr.js","./ms","./ms-my","./ms-my.js","./ms.js","./mt","./mt.js","./my","./my.js","./nb","./nb.js","./ne","./ne.js","./nl","./nl-be","./nl-be.js","./nl.js","./nn","./nn.js","./pa-in","./pa-in.js","./pl","./pl.js","./pt","./pt-br","./pt-br.js","./pt.js","./ro","./ro.js","./ru","./ru.js","./sd","./sd.js","./se","./se.js","./si","./si.js","./sk","./sk.js","./sl","./sl.js","./sq","./sq.js","./sr","./sr-cyrl","./sr-cyrl.js","./sr.js","./ss","./ss.js","./sv","./sv.js","./sw","./sw.js","./ta","./ta.js","./te","./te.js","./tet","./tet.js","./tg","./tg.js","./th","./th.js","./tl-ph","./tl-ph.js","./tlh","./tlh.js","./tr","./tr.js","./tzl","./tzl.js","./tzm","./tzm-latn","./tzm-latn.js","./tzm.js","./ug-cn","./ug-cn.js","./uk","./uk.js","./ur","./ur.js","./uz","./uz-latn","./uz-latn.js","./uz.js","./vi","./vi.js","./x-pseudo","./x-pseudo.js","./yo","./yo.js","./zh-cn","./zh-cn.js","./zh-hk","./zh-hk.js","./zh-tw","./zh-tw.js","webpackContext","req","webpackContextResolve","e","Error","code","resolve"],"mappings":"aACA,SAAAA,EAAAC,GAOA,IANA,IAKAC,EAAAC,EALAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAGAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAIA,IADAe,KAAAhB,GACAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,GAAA,EACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,GAAA,GAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,GAAA,EACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,GAAA,EAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GAA0CI,YAAA,EAAAC,IAAAJ,KAK1CX,EAAAgB,EAAA,SAAAZ,GACA,oBAAAa,eAAAC,aACAlC,OAAA6B,eAAAT,EAAAa,OAAAC,aAAwDC,MAAA,WAExDnC,OAAA6B,eAAAT,EAAA,cAAiDe,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAvC,OAAAwC,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAvC,OAAA6B,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAS,EAAAc,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAtB,GACA,IAAAM,EAAAN,KAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAgB,EAAAC,GAAsD,OAAA7C,OAAAC,UAAAC,eAAAC,KAAAyC,EAAAC,IAGtD7B,EAAA8B,EAAA,WAEA,IAAAC,EAAAC,OAAA,aAAAA,OAAA,iBACAC,EAAAF,EAAAhD,KAAA2C,KAAAK,GACAA,EAAAhD,KAAAX,EACA2D,IAAAG,QACA,QAAAvD,EAAA,EAAgBA,EAAAoD,EAAAlD,OAAuBF,IAAAP,EAAA2D,EAAApD,IACvC,IAAAU,EAAA4C,EAIA1C,EAAAR,MAAA,QAEAU,8ECpJiK0C,ECalJC,EAAA,EAAIC,QACjBC,OAAQ,OAAQ,UAChBC,UACEC,QACE,OAAIC,KAAKC,OACA,SACED,KAAKE,KAAKC,SACZ,OACEH,KAAKE,KAAKE,SACZ,OAGF,SAETL,SACE,OAAIC,KAAKC,OACA,IACuB,KAArBD,KAAKE,KAAKG,QACZ,IACuB,KAArBL,KAAKE,KAAKG,QACZ,IACuB,KAArBL,KAAKE,KAAKG,QACZ,IAEA,wBClBfC,EAXA/D,OAAAgE,EAAA,EAAAhE,CACAmD,ECTA,WAA0B,IAAac,EAAbR,KAAaS,eAAkD,OAA/DT,KAAuCU,MAAAC,IAAAH,GAAwB,MAA/DR,KAA+DY,GAAA,qFDYzF,EACA,KACA,KACA,2BEfMC,EAEJd,YACSe,EACAC,EACAC,EACAC,GAHAjB,KAAAc,IACAd,KAAAe,IACAf,KAAAgB,IACAhB,KAAAiB,IAGTlB,KAAKe,EAAWC,GACdf,KAAKc,GAAKA,EACVd,KAAKe,GAAKA,GAIP,MAAMG,EAAO,SAASnD,GAC3B,OAAOoD,OAAOC,aAAarD,EAAEsD,WAAW,GAAK,IAGlCC,EAAO,SAASC,GAC3B,OAAOC,KAAKC,MAAMD,KAAKE,SAAWH,IAIvBI,EAAc,SACzBC,EACAC,EACAnD,GAEA,IAAIoD,EAAQC,MAAMH,GAElB,IAAK,IAAI1F,EAAI,EAAGA,EAAI0F,EAAO1F,IAAK,CAC9B4F,EAAM5F,GAAK,IAAI6F,MAAMF,GACrB,IAAK,IAAIzE,EAAI,EAAGA,EAAIyE,EAAQzE,IAC1B0E,EAAM5F,GAAGkB,GAAKsB,EAAMxC,EAAGkB,GAI3B,OAAO0E,GAOIE,EAAM,SAASC,GAC1B,OAAOT,KAAKQ,IAAIjF,MAAMyE,KAAMS,UAGxBC,EACJnC,YAAmBe,EAAkBC,GAAlBf,KAAAc,IAAkBd,KAAAe,IAa9BhB,GAAGoC,GACR,OAAOnC,KAAKc,IAAMqB,EAAMrB,GAAKd,KAAKe,IAAMoB,EAAMpB,EAGzChB,OAAOoC,GACZ,OAAOX,KAAKY,IAAIpC,KAAKc,EAAIqB,EAAMrB,IAAM,GAAKU,KAAKY,IAAIpC,KAAKe,EAAIoB,EAAMpB,IAAM,EAGnEhB,OACL,OAAO,IAAImC,EAAMlC,KAAKc,EAAGd,KAAKe,GAGzBhB,IAAIoC,GACT,OAAO,IAAID,EAAMlC,KAAKc,EAAIqB,EAAMrB,EAAGd,KAAKe,EAAIoB,EAAMpB,GAG7ChB,WACL,OAAOmC,EAAMG,IAAIC,IAAIH,GAASnC,KAAKuC,IAAIJ,KA5BlBD,EAAAG,KACrB,IAAIH,GAAO,GAAI,GACf,IAAIA,EAAM,GAAI,GACd,IAAIA,EAAM,GAAI,GACd,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,EAAM,EAAG,UAwBXM,EAIJzC,YAAmBuC,GAAAtC,KAAAsC,MACjBtC,KAAK4B,MAAQU,EAAIlG,OACjB4D,KAAK6B,OAASS,EAAI,GAAGlG,OAGhB2D,GAAGe,EAAGC,GACX,OAAOf,KAAKsC,IAAIxB,GAAGC,GAGdhB,QAAQoC,GACb,OACEA,EAAMrB,GAAK,GACXqB,EAAMpB,GAAK,GACXoB,EAAMrB,EAAId,KAAK4B,OACfO,EAAMpB,EAAIf,KAAK6B,OAIZ9B,KAAK0C,GACVzC,KAAKsC,IAAII,QAAQC,IACfA,EAAOD,QAAQE,IACbH,EAAGG,QAMJ,MAAMC,EAAQ,SAASZ,EAAaa,GACzC,IAAIhC,EACJ,GAAIgC,EAAK,EACP,IAAK,IAAI5G,EAAI,EAAGA,EAAI4G,EAAI5G,IACtB4E,EAAImB,EAAKc,MACTd,EAAKe,QAAQlC,QAEV,GAAIgC,EAAK,EACd,IAAK,IAAI5G,EAAI4G,EAAI5G,EAAI,EAAGA,IACtB4E,EAAImB,EAAKpF,QACToF,EAAK3F,KAAKwE,GAId,OAAOmB,GAGIgB,EAAY,SACvBC,EACAC,EACAV,GAEA,IAAKW,EAAIC,EAAIC,EAAIC,IAAOL,EAAGpC,EAAGqC,EAAGrC,EAAGoC,EAAGnC,EAAGoC,EAAGpC,GACzCyC,EAAQhC,KAAKD,IAAIC,KAAKY,IAAIgB,EAAKC,GAAK7B,KAAKY,IAAIkB,EAAKC,IACtD,MAAME,EAAQ,IAAIvB,GAAOmB,EAAKD,GAAMI,GAAQD,EAAKD,GAAME,GAEvD,KAAOA,EAAQ,GACbJ,GAAMK,EAAM3C,EACZwC,GAAMG,EAAM1C,EAEZ0B,EAAGjB,KAAKkC,MAAMN,GAAK5B,KAAKkC,MAAMJ,IAE9BE,GAAS,SCnJPG,EAGJ5D,YACU6D,EACAC,EACAC,EACAlC,EACAC,EACAkC,EACAC,GANAhE,KAAA4D,SACA5D,KAAA6D,SACA7D,KAAA8D,SACA9D,KAAA4B,QACA5B,KAAA6B,SACA7B,KAAA+D,aACA/D,KAAAgE,cAERhE,KAAKiE,aAAejE,KAAK8D,OAAS9D,KAAK8D,OAGlC/D,OACLC,KAAKgE,YAAYhE,KAAK4D,OAAQ5D,KAAK6D,OAAQ,GAEtC7D,KAAK+D,WAAW/D,KAAK4D,OAAQ5D,KAAK6D,WAClC,EAAG,IAAK,GAAI,KAAM,EAAG,KAAM,GAAI,IAAInB,QAAQ,EAAEI,EAAIoB,MAClDlE,KAAKmE,UAAU,EAAG,EAAK,EAAK,EAAGrB,EAAIoB,EAAI,GACvClE,KAAKmE,UAAU,EAAG,EAAK,EAAKrB,EAAI,EAAG,EAAGoB,KAKpCnE,UACNqE,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,GAAIL,EAAQC,EACV,OAGF,IAAIK,EAAW,EACXC,GAAU,EAEd,IAAK,IAAIC,EAAWT,EAAKS,GAAY7E,KAAK8D,SAAWc,EAASC,IAAY,CACxE,IAAIC,GAAUD,EAEd,IAAK,IAAIE,GAAkBF,EAAUE,GAAU,EAAGA,IAAU,CAC1D,IAAIC,EAAWxD,KAAKkC,MAAM1D,KAAK4D,OAASmB,EAASR,EAAKO,EAASN,GAC3DS,EAAWzD,KAAKkC,MAAM1D,KAAK6D,OAASkB,EAASN,EAAKK,EAASJ,GAC3DQ,GAAaH,EAAS,KAAQD,EAAS,IACvCK,GAAcJ,EAAS,KAAQD,EAAS,IAE5C,GAEIE,GAAY,GACZC,GAAY,GACZD,EAAWhF,KAAK4B,OAChBqD,EAAWjF,KAAK6B,UAElBwC,EAAQc,GAPV,CAUO,GAAIb,EAAMY,EACf,MAIElF,KAAKoF,eAAeL,EAAQD,IAAW9E,KAAKiE,cAC9CjE,KAAKgE,YACHgB,EACAC,EACA,EAAIjF,KAAKoF,eAAeL,EAAQD,GAAU9E,KAAKiE,cAI/CW,EAEE5E,KAAK+D,WAAWiB,EAAUC,GAE5BN,EAAWQ,GAEXP,GAAU,EACVP,EAAQM,GAGN3E,KAAK+D,WAAWiB,EAAUC,IAAaJ,EAAW7E,KAAK8D,SAEzDc,GAAU,EACV5E,KAAKmE,UAAUU,EAAW,EAAGR,EAAOa,EAAWX,EAAIC,EAAIC,EAAIC,GAC3DC,EAAWQ,MAObpF,eAAee,EAAWC,GAChC,OAAOD,EAAIA,EAAIC,EAAIA,GC7FvB,IAAYsE,EAMAC,ECFAC,GDJZ,SAAYF,GACVA,IAAA,iCACAA,IAAA,6BACAA,IAAA,iBAHF,CAAYA,WAMZ,SAAYC,GACVA,IAAA,yBACAA,IAAA,iCACAA,IAAA,2BACAA,IAAA,qBAJF,CAAYA,iBASNE,EAMJzF,YACS0F,EACAxH,EACSyH,KACTC,EAAaH,EAAKI,SAHlB5F,KAAAyF,QACAzF,KAAA/B,OACS+B,KAAA0F,SACT1F,KAAA2F,KARF5F,eACL,OAAOC,KAAK6F,SAUP9F,QACL,OAAO,IAAIyF,EAAKxF,KAAKyF,MAAOzF,KAAK/B,OAbpBuH,EAAAK,OAAiB,QAiB5BC,UAAsBN,EAC1BzF,YAA4BgG,GAC1BC,MAAMV,EAAUW,cAAeF,EAAO9H,iBADZ+B,KAAA+F,gBAKxBG,UAAkCV,EACtCzF,YACE0F,EACAxH,EACgBkI,EAChBT,GAEAM,MAAMP,EAAOxH,EAAMyH,GAHH1F,KAAAmG,WAMXpG,QAAQqG,GACbA,EAASC,gBAAgBC,YAAYtG,KAAKmG,UAGrCpG,UAAUqG,GACfA,EAASC,gBAAgBE,eAAevG,KAAKmG,iBAI3CK,UAAuBN,EAC3BnG,YAAY9B,EAAckI,GACxBH,MAAMV,EAAUkB,QAASvI,EAAMkI,GAAWd,EAAMoB,eAI9CC,UAAyBR,EAC7BnG,YAAY9B,EAAckI,GACxBH,MAAMV,EAAUoB,UAAWzI,EAAMkI,GAAWd,EAAMsB,qBAIhDC,UAA6BV,EACjCnG,YAAY9B,EAAckI,GACxBH,MAAMV,EAAUsB,cAAe3I,EAAMkI,GAAWd,EAAMwB,kBCpE1D,SAAYtB,GACVA,IAAA,uBACAA,IAAA,yBACAA,IAAA,eACAA,IAAA,mBACAA,IAAA,eACAA,IAAA,aACAA,IAAA,eACAA,IAAA,eACAA,IAAA,eAEAA,IAAA,iCACAA,IAAA,sBAZF,CAAYA,WAoBZ,MAAMuB,GACJ/G,CAACwF,EAASwB,WAAY1B,EAAMwB,cAC5B9G,CAACwF,EAASyB,MAAO3B,EAAMsB,YACvB5G,CAACwF,EAASiB,SAAUnB,EAAMoB,aAGtBQ,EAIJlH,YAAYmH,GAHJlH,KAAAmH,YACAnH,KAAAoH,OAGNpH,KAAKmH,SAAWD,EAAM5E,IAAI+E,KACfA,SAAUA,KAIhBtH,OAAOuH,GACZ,MAAMC,EAAQvH,KAAKwH,QAAQC,KACzB,EAAGJ,cAAeC,IAAUR,EAAYO,IAE1C,OAAOE,GAASA,EAAMG,WAAaH,EAAMG,cAGpC3H,QACL,OAAOC,KAAKmH,SAGPpH,QACL,OAAOC,KAAKoH,IAGPrH,QAAQ4H,GACb,OAAO3H,KAAKmH,SAASS,KAAKC,GACxBtL,OAAAuL,EAAA,SAAAvL,CAASoL,EAAKjC,OAAQoB,EAAYe,EAAQR,YAIvCtH,cAAc4H,GACnB,OAAO3H,KAAKmH,SAASY,OAAOF,GAC1BtL,OAAAuL,EAAA,SAAAvL,CAASoL,EAAKjC,OAAQoB,EAAYe,EAAQR,YAIvCtH,MAAMiI,EAAiBL,GAC5B3H,KAAKiI,cAAcN,GAAMjF,QAAQmF,IAC3BA,EAAQH,YACV1H,KAAKkI,SAASL,EAAQH,WACtBG,EAAQH,UAAUS,UAAUH,IAG9BH,EAAQH,UAAYC,EACpBA,EAAKS,QAAQJ,KAIVjI,QAAQiI,EAAiBL,GAC9B3H,KAAKmH,SAASzE,QAAQmF,IAChBA,EAAQH,WAAaG,EAAQH,UAAU/B,KAAOgC,EAAKhC,KACrD3F,KAAKkI,SAASL,EAAQH,WACtBC,EAAKQ,UAAUH,GACfH,EAAQH,UAAY,QAKnB3H,SAAS4H,GACd3H,KAAKoH,IAAI9K,KAAKqL,GAGT5H,cAAc4H,GACnBpL,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAKoH,IAAKiB,GAAiBA,EAAc1C,KAAOgC,EAAKhC,WC7F1D2C,EACJvI,YACYwI,GAAAvI,KAAAuI,OAILxI,SAEAA,QAAQyI,GACbxI,KAAKuI,KAAKE,YAASC,SAIjBC,UAAuBL,EAG3BvI,YACEwI,EACOtI,GAGP+F,MAAMuC,GAHCvI,KAAAC,SAKPD,KAAK4I,QAAU5I,KAAKuI,KAAKM,iBAAiBC,UAAU9I,KAAKC,QAGpDF,QAAQgJ,GACb,KAAO/I,KAAKC,OAAO+I,SAAW,GAC5BhJ,KAAKC,OAAOoG,gBAAgB4C,QAAQjJ,KAAKC,OAAO8F,QAEhD/F,KAAKC,OAAO+I,UAAY,EAG1B,IAAIE,EAAmBlJ,KAAKC,OAAOkJ,YAAY1B,KAAK2B,GAAcA,EAAWzD,KAAOoD,EAAiBpD,IACjGuD,EACFA,EAAiBG,OAAS,EAE1BrJ,KAAKC,OAAOkJ,YAAY7M,KAAKyM,GAI/B/I,KAAKuI,KAAKE,YAASC,GC/BvB,IAAYY,EAMAC,GANZ,SAAYD,GACVA,IAAA,mBACAA,IAAA,qCACAA,IAAA,2BAHF,CAAYA,WAMZ,SAAYC,GACVA,IAAA,mCACAA,IAAA,yBACAA,IAAA,iBACAA,IAAA,uBAJF,CAAYA,WAOL,MAAMC,EAAejN,OAAOkN,KAAKF,GAASjH,IAAItD,GAAOuK,EAAQvK,UAE9D0K,EACJ3J,YACkB9B,EACA0L,EACAC,GAFA5J,KAAA/B,OACA+B,KAAA2J,OACA3J,KAAA4J,mBAMdC,EAQJ9J,YAAmBgG,EAAuBJ,EAAiBkE,EAAQjE,SAAhD5F,KAAA+F,SAAuB/F,KAAA2F,KANnC5F,eACL,OAAOC,KAAK6F,SAOP9F,OACL,OAAOC,KAAK+F,OAAO9H,KAGd8B,OACL,OAAOC,KAAK+F,OAAO4D,KAGd5J,QACL,OAAO,IAAI8J,EAAQ7J,KAAK+F,OAAQ/F,KAAK2F,IAGhC5F,OACL,OAAOC,KAAK8J,UAGP/J,IAAIgK,GACT,OAAOxN,OAAAuL,EAAA,SAAAvL,CAASyD,KAAK+F,OAAO6D,UAAWG,IA1B1BF,EAAAhE,OAAqB,QA8BhCmE,SAIAC,UAA2BD,EAC/BjK,YAAmBiI,GACjBhC,QADiBhG,KAAAgI,QAIZjI,OAAOmK,GACZ,GAAIlK,KAAKgI,MAAM3B,gBAAgB8D,OAAOD,EAAQ7D,iBAE5C,OADA6D,EAAQE,aAAa7B,KAAK8B,OAAOC,YAAYtK,KAAKgI,MAAOkC,GAClDK,EAASC,MAGlB,MAAMC,EAASzK,KAAKgI,MAAM3B,gBAAgBqE,SAASR,EAAQ7D,iBAE3D,OAAIoE,GAAUP,EAAQ7D,gBAAgBsE,OAAOC,gBAC3C5K,KAAKgI,MAAMvF,GAAG,IAAIoI,EAAmBX,IACrCA,EAAQE,aAAa7B,KAAK8B,OAAOS,YAAYL,EAAQzK,KAAKgI,MAAOkC,GACjEA,EAAQa,MACDR,EAASS,MAEhBd,EAAQ7D,gBAAgBsE,OAAOM,SAASR,GACxCP,EAAQE,aAAa7B,KAAK8B,OAAOa,YAAYT,EAAQzK,KAAKgI,MAAOkC,GAC1DK,EAASY,aAKhBC,UAA0BpB,EAC9BjK,YAAmBiI,EAAwBqD,GACzCrF,QADiBhG,KAAAgI,QAAwBhI,KAAAqL,UAIpCtL,OAAOmK,GACZ,GAAIlK,KAAKgI,MAAM3B,gBAAgBiF,YAAYpB,EAAQ7D,iBAMjD,OALA6D,EAAQE,aAAa7B,KAAK8B,OAAOkB,iBAC/BvL,KAAKgI,MACLkC,EACAlK,KAAKqL,SAEAd,EAASiB,YAGlB,MAAMf,EAASzK,KAAKgI,MAAM3B,gBAAgBoF,cACxCvB,EAAQ7D,gBACRrG,KAAKqL,SAGP,OAAIZ,GAAUP,EAAQ7D,gBAAgBsE,OAAOC,gBAC3C5K,KAAKgI,MAAMvF,GAAG,IAAIoI,EAAmBX,IACrCA,EAAQE,aAAa7B,KAAK8B,OAAOqB,iBAC/BjB,EACAzK,KAAKgI,MACLkC,EACAlK,KAAKqL,SAEPnB,EAAQa,MACDR,EAASS,MAEhBd,EAAQ7D,gBAAgBsE,OAAOM,SAASR,GACxCP,EAAQE,aAAa7B,KAAK8B,OAAOsB,iBAC/BlB,EACAzK,KAAKgI,MACLkC,EACAlK,KAAKqL,SAEAd,EAASY,aAKhBN,UAAkCb,EACtCjK,YAAmBiI,GACjBhC,QADiBhG,KAAAgI,QAIZjI,OAAOmK,GAKZ,OAJIA,aAAmB0B,IACrB1B,EAAQlB,UAAYkB,EAAQb,MAAM9G,IAAI,IAGjCgI,EAASsB,SAIpB,IAAYtB,GAAZ,SAAYA,GACVA,IAAA,aACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,6BACAA,IAAA,qBALF,CAAYA,iBAQNuB,UAAwBjC,EAU5B9J,YACSsG,EACP0F,EACAhG,GAEAC,MAAMD,GAJC/F,KAAAqG,kBATFrG,KAAAgM,iBAcLhM,KAAK+L,GAAKA,EAEV/L,KAAKiM,UAAY,IAAIhF,GACnB1B,EAAS2G,SACT3G,EAASwB,UACTxB,EAAS4G,KACT5G,EAAS6G,OACT7G,EAAS8G,KACT9G,EAAS+G,IACT/G,EAASgH,KACThH,EAASiH,KACTjH,EAASyB,KAETzB,EAASkH,cACTlH,EAASiB,UAINzG,MAAM4H,GACX3H,KAAKiM,UAAUS,MAAM1M,KAAM2H,GAC3B3H,KAAKiM,UAAUU,cAAchF,GAGxB5H,QAAQ4H,GACb3H,KAAKiM,UAAUW,QAAQ5M,KAAM2H,GAGxB5H,SAAS8M,EAAYxD,GAC1BrJ,KAAK6M,IAAMA,EACX7M,KAAK8M,cAAgB9M,KAAKoK,aAC1BpK,KAAKoK,aAAef,EACpBA,EAAM0D,YAAY/M,MAClBA,KAAKgN,WAAW3D,GAGXtJ,MACLC,KAAKoK,aAAa6C,eAAejN,MAEjC,IAAI4C,EAAO5C,KAAKoK,aAAa8C,GAAGlN,KAAK6M,IAAI/L,EAAGd,KAAK6M,IAAI9L,GACrD6B,EAAKuK,MAAM7Q,KAAK,IAAIwJ,EAAO9F,KAAK+F,SAEhC/F,KAAKiM,UAAUzE,QAAQ9E,QAAQ,EAAGgF,gBAC5BA,GACF9E,EAAKuK,MAAM7Q,KAAKoL,KAIpB1H,KAAKiM,UAAUmB,QAAQ1K,QAAQiF,IAC7B/E,EAAKuK,MAAM7Q,KAAKqL,KAIb5H,GAAGsN,GACR,OAAOA,EAAMC,OAAOtN,MAGfD,OACL,OAAOC,KAGFD,QACL,OAAOC,KAAKqG,gBAAgBkH,MAAM3C,eAG7B7K,SACL,OAAOC,KAAKqG,gBAAgBvC,OAAO8G,eAG9B7K,YAAYyN,EAAsBxN,KAAKoK,aAAazE,IACzD,OAAO3F,KAAKgM,cAAcwB,GAGrBzN,IAAI0N,GACTzN,KAAKgN,WAAWS,GAChBzN,KAAK0N,YAAc1N,KAAK6M,IAAIc,OAC5B3N,KAAK+L,GAAG6B,IAAI5N,MAAM,IAEKA,KAAK8M,eAAiB9M,KAAKoK,cACjC8C,GACflN,KAAK0N,YAAY5M,EACjBd,KAAK0N,YAAY3M,GACjBqF,cAAWsC,EACb1I,KAAKoK,aAAa8C,GAAGlN,KAAK6M,IAAI/L,EAAGd,KAAK6M,IAAI9L,GAAGqF,SAAWpG,KAExDA,KAAK8M,mBAAgBpE,EAGhB3I,KAAK8N,GACV7N,KAAK6M,IAAMgB,EAAUF,OAGhB5N,QACL,IAAI+N,EAAU,IAAIjE,EAAQ7J,KAAK+F,OAAQ/F,KAAK2F,IAE5C,OADAmI,EAAQhE,UAAY9J,KACb8N,EAGF/N,WAAW0N,GACXzN,KAAKgM,cAAcyB,EAAM9H,IAG5B3F,KAAK+N,cAAcC,eAFnBhO,KAAKgM,cAAcyB,EAAM9H,IAAM,IAAIsI,GAAOR,EAAM7L,MAAO6L,EAAM5L,QAW/D,IAAI8B,EACF3D,KAAK6M,IAAI/L,EACTd,KAAK6M,IAAI9L,EACTf,KAAK8D,SACL2J,EAAM7L,MACN6L,EAAM5L,OACN7B,KAAKkO,QAAQT,GAZH,CAAC3M,EAAWC,EAAWoN,KACjCnO,KAAK+N,cACFb,GAAGpM,EAAGC,GACNqN,IAAIX,EAAMP,GAAGpM,EAAGC,GAAIoN,KAWvBE,OAGItO,QAAQ0N,GACd,MAAO,CAAC3M,EAAWC,KACb0M,EAAMa,eAAexN,EAAGC,MAIxB0M,EAAMP,GAAGpM,EAAGC,GAAGX,UACfJ,KAAK6M,IAAI/L,IAAMA,GACfd,KAAK6M,IAAI9L,IAAMA,UAOnB6K,UAAsBE,EAM1B/L,YACSsJ,EACPhD,EACA0F,EACAhG,GAEAC,MAAMK,EAAiB0F,EAAIhG,GALpB/F,KAAAqJ,QANFrJ,KAAAuO,MAAgB,EAEhBvO,KAAAgJ,SAAmB,EACnBhJ,KAAAmJ,eAWApJ,IAAI0N,GACTzH,MAAM4H,IAAIH,GAENzN,KAAKgJ,SAAW,IAClByE,EAAMlF,KAAKE,OAAS,IAAIE,EAAQ8E,EAAMlF,KAAMvI,OAIzCD,MACLiG,MAAM+E,MACN/K,KAAKuO,MAAO,EAGPxO,gBACLC,KAAKgN,WAAWhN,KAAKoK,eCnVzB,MAAMoE,EAAqB,QAIrBC,EAMJ1O,YAAmB2O,EAAwB/I,EAAW8I,EAAG7I,SAAtC5F,KAAA0O,SAAwB1O,KAAA2F,KAJpC5F,eACL,OAAOC,KAAK6F,SASP9F,SAEGA,OAAOiI,EAAiB2G,GAEhC,GAAI3G,EAAM6E,IAAI+B,GAAGD,GACf,OAAO,EAGT,MAAME,EAAO7O,KAAK8O,QAAQ9G,EAAO7F,GAASwM,EAAYC,GAAGzM,IAMzD,OAJI0M,EAAKzS,QACP4L,EAAM+G,KAAKF,EAAK,MAGTA,EAAKzS,OAGN2D,SAASiI,EAAiB2G,GAClC,MAAME,EAAO7O,KAAK8O,QAAQ9G,EAAO7F,GAASwM,EAAYK,OAAO7M,IAM7D,OAJI0M,EAAKzS,QACP4L,EAAM+G,KAAKF,EAAK,MAGTA,EAAKzS,OAGN2D,QACRiI,EACA2G,EACAM,GAA6B,GAE7B,MAAM3M,EAAM0F,EAAM+F,cAElB,IAAIA,EAA0BpM,EAC5BW,EAAIV,MACJU,EAAIT,OACJ,SAAM6G,GAEJwG,KACAC,GAA0BnH,EAAM6E,KAEhCuC,EAAO,EACX,KAAOD,EAAc/S,SAAW8S,EAAc9S,QAAQ,CACpD,IAAIiT,KAEJF,EAAczM,QAASP,IACrB,IAAKG,EAAIgN,QAAQnN,GACf,OAGF,MAAMS,EAAON,EAAI4K,GAAG/K,EAAMrB,EAAGqB,EAAMpB,GAGjC6B,EAAK2M,SAASvH,SACoBU,IAAlCqF,EAAY5L,EAAMrB,GAAGqB,EAAMpB,KAK7BgN,EAAY5L,EAAMrB,GAAGqB,EAAMpB,GAAKqO,EAC5BT,EAAYxM,EAAOS,GACrBsM,EAAc5S,KAAK6F,GAEnBA,EAAMqN,WAAW9M,QAAQ+M,GAAQJ,EAAW/S,KAAKmT,OAGrDL,IAEAD,EAAgBE,EAGlB,OAAIH,EAAc9S,OACZ6S,EACKjP,KAAK0P,UAAUnT,OAAAuL,EAAA,OAAAvL,CAAO2S,GAAgBnB,GAEtC/N,KAAK0P,UAAUR,EAAc,GAAInB,MAOtChO,UAAUoC,EAAc4L,GAC9B,IAAI4B,EAAYxN,EACZyN,GAASD,GAETlM,OAAeiF,EAEnB,KAAOqF,EAAY4B,EAAU7O,GAAG6O,EAAU5O,KAAOyN,GAAY,CAW3D,KAVA/K,EAAQvB,EAAMG,IAAIoF,KACfoI,GAEG9B,EAAY4B,EAAU7O,EAAI+O,EAAG/O,IAC7BiN,EAAY4B,EAAU7O,EAAI+O,EAAG/O,GAAG6O,EAAU5O,EAAI8O,EAAG9O,KAC/CgN,EAAY4B,EAAU7O,GAAG6O,EAAU5O,GAAK,IAM9C,SAGF4O,EAAYA,EAAUpN,IAAIkB,GAE1BmM,EAAM5M,QAAQ2M,GAGhB,OAAOC,EAGC7P,WACRiI,EACA8H,GAEA,MAAMxN,EAAM0F,EAAM+F,cAElB,IAAIgC,EAA2BpO,EAC7BW,EAAIV,MACJU,EAAIT,OACJ,KAAM,GAEJsN,GAA0BnH,EAAM6E,KAEpC,KAAOsC,EAAc/S,QAAQ,CAC3B,IAAIiT,KAEJF,EAAczM,QAASP,IACrB,IAAKG,EAAIgN,QAAQnN,GACf,OAGF,MAAMS,EAAON,EAAI4K,GAAG/K,EAAMrB,EAAGqB,EAAMpB,GAC9B6B,EAAKoN,UAAWD,EAAY5N,EAAMrB,GAAGqB,EAAMpB,KAIhDgP,EAAY5N,EAAMrB,GAAGqB,EAAMpB,IAAK,EAEhC+O,EAAM3N,EAAOS,GAEbT,EAAMqN,WAAW9M,QAAQ+M,GAAQJ,EAAW/S,KAAKmT,OAGnDN,EAAgBE,GAIbtP,QAAQiI,EAAgBiI,GAC7B,OAAIjI,EAAMrC,KAAOsK,EAAMtK,KAInBqC,EAAM2B,SAAWL,EAAK4G,YAAcD,EAAMtG,SAAWL,EAAK4G,aAI1DlI,EAAM2B,SAAWL,EAAK6G,QAAUF,EAAMtG,SAAWL,EAAK8G,iBAItDH,EAAMtG,SAAWL,EAAK6G,QAAUnI,EAAM2B,SAAWL,EAAK8G,mBA7K7C3B,EAAA5I,OAAe,QAqL1BwK,UAAuC5B,EAA7C1O,kCACSC,KAAA2O,iBAAqBjG,EAErB3I,UAAUiI,GACf,OAAOhI,KAAKsQ,eAAetI,MAAYhI,KAAK2O,YAGvC5O,IAAIiI,GACT,IAAKhI,KAAK2O,YACR,KAAM,gEAGJ3O,KAAKuQ,KAAKvI,IACZhI,KAAKwQ,OAAOxI,GAERhI,KAAK2O,YAAYC,GAAG5G,EAAM6E,OAC5B7M,KAAK2O,iBAAcjG,EACnB1I,KAAKyQ,QAAQzI,MAIfhI,KAAK2O,iBAAcjG,EACnB1I,KAAK0Q,WAAW1I,IAIbjI,QACLC,KAAK2O,iBAAcjG,EAGX3I,KAAKiI,GACb,OAAOhI,KAAK2Q,OAAO3I,EAAOhI,KAAK2O,aAIvB5O,OAAOiI,IACPjI,QAAQiI,IACRjI,WAAWiI,WAGjB4I,UAAmCP,EACvCtQ,YACE8Q,EACUC,GAEV9K,MAAM6K,GAFI7Q,KAAA8Q,UAKF/Q,eAAeiI,GACvB,MAAM6G,EAAO7O,KAAK8O,QAAQ9G,EAAO,CAAC7F,EAAOS,IAAS5C,KAAK8Q,QAAQlO,IAAO,GAEtE,QAAIiM,EAAKzS,SACP4D,KAAK2O,YAAcE,EAAK9L,OACjB,UCnPPgO,UAAwBtC,EAGrB1O,UAAUiI,GACf,OAAOhI,KAAKgR,UAAUhJ,GAGjBjI,IAAIiI,EAAiBiJ,GAAqB,GAC/C,GAAIjR,KAAKkR,eAAelJ,GACtBhI,KAAKmR,OAAOnJ,OACP,CACL,IAAKiJ,EACH,KAAM,4BAGRjR,KAAKoR,cAAcpJ,GACnBhI,KAAK4N,IAAI5F,GAAO,IAIVjI,OAAOiI,GACXhI,KAAKqR,OAAO5O,GAAG,IAAIwH,EAAYjC,MAAYuC,EAASS,MACtDhL,KAAKqR,YAAS3I,GAIV3I,UAAUiI,GAIhB,QAHiBhI,KAAKsR,aAAatJ,EAAO5B,GACxCpG,KAAKuR,QAAQvJ,EAAO5B,IAKhBrG,eAAeiI,GACrB,QAAoBU,IAAhB1I,KAAKqR,OACP,OAAO,EAOT,QAJiBrR,KAAKsR,aACpBtJ,EACA5B,GAAYA,EAAST,KAAO3F,KAAKqR,OAAO1L,IAKpC5F,cAAciI,GACpBhI,KAAKqR,OAASrR,KAAKsR,aAAatJ,EAAO5B,GACrCpG,KAAKuR,QAAQvJ,EAAO5B,IACpBoL,OAGIzR,aACNiI,EACAyJ,GAEA,MAAMC,EAAS1J,EAAM+F,cACrB,OAAO/F,EAAM6E,IACV2C,WACAlN,IAAI,EAAGxB,IAAGC,OAAQ2Q,EAAOxE,GAAGpM,EAAGC,GAAGqF,YAClCqB,KAAKrB,GAAYA,GAAYqL,EAAUrL,WC1DxCuL,UAAsBtB,EAGnBtQ,QACLiG,MAAM4L,QACN5R,KAAK6R,cAAWnJ,EAGR3I,eAAeiI,GAEvB,OACGhI,KAAK8R,aAAe9R,KAAK+R,gBAAgB/J,IAC1ChI,KAAKgS,eAAehK,GAIdjI,aACRC,KAAK6R,cAAWnJ,EAGR3I,UACRC,KAAK6R,cAAWnJ,EAGV3I,YACN,QAASC,KAAK6R,SAGN9R,KAAKiI,GACb,OAAOhI,KAAKiS,SAASjK,EAAOhI,KAAK2O,aAG3B5O,gBAAgBiI,GACtB,OAAOhI,KAAKsR,aAAatJ,EAAO5B,GAAYA,EAAST,KAAO3F,KAAK6R,UAG3D9R,eAAeiI,GAErB,OACEhI,KAAKsR,aAAatJ,EAAO5B,GAAYpG,KAAKuR,QAAQvJ,EAAO5B,KACzDpG,KAAK+R,gBAAgB/J,GAIjBjI,aACNiI,EACAyJ,GAEA,IAAIxU,GAAkB,EAYtB,OAVA+C,KAAKkS,WAAWlK,EAAO,EAAGlH,IAAGC,KAAK6B,KAChC,MAAMwD,EAAWxD,EAAKwD,YAEjBnJ,GAAUmJ,GAAYqL,EAAUrL,KACnCpG,KAAK2O,YAAc,IAAIzM,EAAMpB,EAAGC,GAChCf,KAAK6R,SAAWzL,EAAST,GACzB1I,GAAS,KAINA,GC5DX,IAAYkV,GAAZ,SAAYA,GACVA,IAAA,+BADF,CAAYA,iBAINC,EACJrS,YAAmBsS,GAAArS,KAAAqS,cAEfC,UAAiCF,EACrCrS,YAAmBoN,GACjBnH,MAAMmM,EAAYI,cADDvS,KAAAmN,eAKfqF,UAA+B/D,EACnC1O,YAAmB0S,EAAc,MAC/BzM,QADiBhG,KAAAyS,UAGTzS,KAAA0S,UAEH3S,UAAUiI,GACf,OAAO,EAGFjI,UAAUsN,GACfrN,KAAK0S,OAAOpW,KAAK+Q,GAGTtN,cACRC,KAAK0S,iBC5BHC,EAGJ5S,YAAsBwB,EAAuBqR,EAAkBrR,GAAzCvB,KAAAuB,MAAuBvB,KAAA4S,UAFtC5S,KAAA6S,aAIA9S,UACL,OAAOC,KAAKuB,IAGPxB,QACL,OAAOC,KAAKuB,MAAQvB,KAAK4S,QAGpB7S,SAASoG,GACdnG,KAAK4S,SAAWzM,EAGXpG,SAASoG,GACdnG,KAAK4S,QAAUpR,KAAKQ,IAAIhC,KAAK4S,QAAUzM,EAAUnG,KAAKuB,KAGjDxB,iBAAiBoG,GACtBnG,KAAKuB,KAAO4E,EACZnG,KAAK8S,SAAS3M,GAGTpG,iBAAiBoG,GACtBnG,KAAKuB,KAAO4E,EACZnG,KAAKiL,SAAS9E,GAGTpG,YAAYoG,GACjBnG,KAAK6S,UAAUvW,KAAK6J,GAGfpG,eAAeoG,GACpB5J,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAK6S,UAAWE,GAAOA,IAAQ5M,GAGjCpG,eACL,OAAOC,KAAK4S,QAAUrW,OAAAuL,EAAA,IAAAvL,CAAIyD,KAAK6S,kBAI7BG,WAAiCL,EAC9B5S,eACL,MAAMrB,EAAQsH,MAAM4E,eACpB,OAAOlM,GAAS,EAAIA,EAAQ,EAGvBqB,iBAAiBoG,GACtBnG,KAAKuB,IAAMC,KAAKD,IAAI,EAAGvB,KAAKuB,IAAM4E,GAClCnG,KAAKiL,SAAS9E,GAGTpG,SAASoG,GACdnG,KAAK4S,QAAUpR,KAAKD,IAAI,EAAGvB,KAAK4S,QAAUzM,UAIxC8M,GACJlT,YACSoR,EACA+B,EACAC,EACAxI,EACA7G,EACAyJ,GALAvN,KAAAmR,SACAnR,KAAAkT,UACAlT,KAAAmT,YACAnT,KAAA2K,SACA3K,KAAA8D,SACA9D,KAAAuN,QAGFxN,KAAKqT,EAA4B3Q,GACtCA,EAAGzC,KAAKmR,OAAQiC,EAAQjC,QACxB1O,EAAGzC,KAAKkT,QAASE,EAAQF,SACzBzQ,EAAGzC,KAAK2K,OAAQyI,EAAQzI,QACxBlI,EAAGzC,KAAK8D,OAAQsP,EAAQtP,QACxBrB,EAAGzC,KAAKuN,MAAO6F,EAAQ7F,cAIrB8F,WAAwBJ,GAC5BlT,aAAYoR,OACVA,EAAS,EAAC+B,QACVA,EAAU,EAACC,UACXA,EAAY,EAACxI,OACbA,EAAS,EAAC7G,OACVA,EAAS,EAACyJ,MACVA,EAAQ,IAERvH,MAAMmL,EAAQ+B,EAASC,EAAWxI,EAAQ7G,EAAQyJ,GAG7CxN,WACLqT,EACAE,EACA7Q,GAEAA,EAAGzC,KAAKmR,OAAQiC,EAAQjC,OAAQmC,EAAOnC,QACvC1O,EAAGzC,KAAKkT,QAASE,EAAQF,QAASI,EAAOJ,SACzCzQ,EAAGzC,KAAK2K,OAAQyI,EAAQzI,OAAQ2I,EAAO3I,QACvClI,EAAGzC,KAAK8D,OAAQsP,EAAQtP,OAAQwP,EAAOxP,QACvCrB,EAAGzC,KAAKuN,MAAO6F,EAAQ7F,MAAO+F,EAAO/F,cAInCgG,WAA+BN,GACnClT,aAAYoR,OAAEA,EAAM+B,QAAEA,EAAOC,UAAEA,EAASxI,OAAEA,EAAM7G,OAAEA,EAAMyJ,MAAEA,IACxDvH,MACE,IAAIgN,GAAkB7B,GACtB,IAAI6B,GAAkBE,GACtB,IAAIF,GAAkBG,GACtB,IAAIR,EAAUhI,GACd,IAAIqI,GAAkBlP,GACtB,IAAIkP,GAAkBzF,IAInBxN,YAAYoG,GACjBnG,KAAKwT,KAAKrN,EAAU,CAACsN,EAAMC,KACb,IAARA,GACFD,EAAKnN,YAAYoN,KAKhB3T,eAAeoG,GACpBnG,KAAKwT,KAAKrN,EAAU,CAACsN,EAAMC,KACb,IAARA,GACFD,EAAKlN,eAAemN,KAKnB3T,SAASsR,GACd,OAAO7P,KAAKkC,MACT,GAAK1D,KAAKmR,OAAOvG,eAAkByG,EAAO6B,QAAQtI,gBAIhD7K,OAAOsR,GACZ,IAAIsC,EAAM3T,KAAKmT,UAAUvI,eAEzB,OACEpJ,KAAKE,SACLiS,GAAOA,EAAMnS,KAAKoS,IAAsC,IAAlCvC,EAAO8B,UAAUvI,eAAuB,KAI3D7K,YAAYsR,GACjB,OAAOrR,KAAKmK,OAAOkH,GAGdtR,cAAcsR,EAAyBhG,GAC5C,OAAO,GAGFtL,aACLC,KAAK2K,OAAOmI,SAAS9S,KAAK6T,qBAGlB9T,oBACR,OAAO,EAGFA,kBACL,OAAO,EAGFA,QAAQgG,GACb/F,KAAK2K,OAAOmJ,iBAAiB,GAEzBtS,KAAKE,SAAW,GAClB1B,KAAKmR,OAAO2C,iBAAiB,GAE7B9T,KAAKkT,QAAQY,iBAAiB,UC3K9BC,WAAsBtF,EACnB1O,UAAUiI,GACf,OAAOA,EAAMgM,IAAIzK,EAAQ0K,OAGpBlU,IAAIiI,EAAiBiJ,GAAqB,GAC/CjJ,EAAMiE,UAAUmB,QAAQ1K,QAAQiF,IAC9B,GAAIA,aAAgBzB,GACd8B,EAAMiE,UAAUiI,QAAQvM,GAAO,CACjB3H,KAAKmU,YAAYnM,EAAOL,IAItCK,EAAMoM,MAAMzM,MAOd5H,YAAYiI,EAAiBL,GACnC,MAAM0M,EAAUrM,EAAMiE,UAAUhE,cAAcN,GAE9C,GAAuB,IAAnB0M,EAAQjY,OACV,OAAO,KAGT,MAAMkY,EAAiB,IAAIjB,IACzBlC,OAAQ,EACR+B,QAAS,EACTvI,OAAQ,EACR7G,OAAQ,GACRyJ,MAAO,KAGH1F,QAAEA,GAAYwM,EAAQE,OAC1B,CAACC,EAAK3M,KACJ,IAAIyL,EAAS,EAYb,OAVIzL,EAAQH,UACVC,EAAKxB,SAASsO,WACZ5M,EAAQH,UAAUvB,SAClBmO,EACA,CAACI,EAAGlX,EAAGwD,IAAOsS,GAAUtS,GAAK0T,EAAIlX,IAGnCmK,EAAKxB,SAASqN,KAAKc,EAAgB,CAACI,EAAG1T,IAAOsS,GAAUoB,EAAI1T,GAG1DwT,EAAIlB,OAASA,EACRkB,GAEElB,SAAQzL,aAGnByL,OAAQ,EAAGzL,QAAS,OAGxB,OAAOA,SC/CL8M,WAA0BnC,EAgB9BzS,cACEiG,QALMhG,KAAA4U,iBAA2B,EAE3B5U,KAAAoP,KAAe,EAIrBpP,KAAK6U,QAAU,IAAIC,GAAQ9U,MAC3BA,KAAK+U,SAAW,IAAIC,GAAShV,MAC7BA,KAAKiV,OAAS,IAAItD,EAAO3R,MACzBA,KAAKkV,SAAW,IAAInE,EAAS/Q,MAC7BA,KAAKmV,OAAS,IAAIC,GAAOpV,MACzBA,KAAKqV,OAAS,IAAIC,GAAOtV,MACzBA,KAAKuV,OAAS,IAAIC,GAAOxV,MACzBA,KAAKyV,QAAU,IAAIC,GAAQ1V,MAE3BA,KAAK2V,UAAY,IAAIC,GAAU5V,MAG1BD,IAAIiI,EAAiBiJ,GAAqB,GAE/C,IAAKA,EACH,KAAM,6BAGRjR,KAAKoP,MAAQ,EAETpP,KAAKoP,KAAOpH,EAAM3B,gBAAgBwP,mBAAsB,GAC1D7N,EAAM3B,gBAAgByP,aAGxB9V,KAAK0S,OAAOhQ,QAAQ2K,IAClB,OAAQA,EAAMgF,MACZ,KAAKF,EAAYI,aACf,IAAIwB,GAAO/T,MAAM4N,IAAI5F,MAIvBhI,KAAK+V,UAAU/N,GACbhI,KAAKkV,SAASpM,UAAUd,GAC1BhI,KAAKgW,MAAMhW,KAAKkV,UACPlV,KAAKyV,QAAQ3M,UAAUd,GAChChI,KAAKgW,MAAMhW,KAAKyV,SACPzV,KAAKiV,OAAOnM,UAAUd,GAC/BhI,KAAKgW,MAAMhW,KAAKiV,QACPjV,KAAKiW,UAAUjO,GACxBhI,KAAKkW,SAASlO,GAEdhI,KAAKmW,QAAQnO,GAENhI,KAAKoW,eAAepO,IAAUhI,KAAK6U,QAAQ/L,UAAUd,GAC9DhI,KAAKgW,MAAMhW,KAAK6U,SACP7U,KAAKkV,SAASpM,UAAUd,GACjChI,KAAKgW,MAAMhW,KAAKkV,UACPlV,KAAKyV,QAAQ3M,UAAUd,GAChChI,KAAKgW,MAAMhW,KAAKyV,SACPzV,KAAKiV,OAAOnM,UAAUd,GAC/BhI,KAAKgW,MAAMhW,KAAKiV,QAEhBjV,KAAKqW,KAAKrO,GAGZhI,KAAKsW,cACLtW,KAAKyS,QAAQ7E,IAAI5F,EAAOiJ,GAGlBlR,UAAUiI,GAChB,OACEA,EAAM3B,gBAAgBsE,OAAOC,eACY,GAAzC5C,EAAM3B,gBAAgBsE,OAAO4L,UAIzBxW,eAAeiI,GACrB,OACEA,EAAM3B,gBAAgBsE,OAAOC,eAC7B5C,EAAM3B,gBAAgBsE,OAAO4L,UAAY,EAIrCxW,UAAUiI,GAChB,OAAOhI,KAAKmV,OAAOrM,UAAUd,GAGvBjI,SAASiI,GACfhI,KAAKgW,MAAMhW,KAAKmV,QAGVpV,QAAQiI,GACVhI,KAAK+U,SAASjM,UAAUd,IAC1BhI,KAAKqV,OAAOmB,cAAcxO,GAC1BhI,KAAKgW,MAAMhW,KAAK+U,WACP/U,KAAK2V,UAAU7M,UAAUd,GAClChI,KAAKgW,MAAMhW,KAAK2V,WACP3V,KAAKqV,OAAOvM,UAAUd,IAC3BhI,KAAK4U,kBACP5U,KAAK4U,iBAAkB,EACvB5U,KAAKqV,OAAOoB,QAAQzO,EAAM6E,IAAI/L,EAAGkH,EAAM6E,IAAI9L,IAE7Cf,KAAKgW,MAAMhW,KAAKqV,SAEhBrV,KAAKgW,MAAMhW,KAAKuV,QAIZxV,KAAKiI,GACXhI,KAAKgW,MAAM,IAAIU,GAAW1W,OAGpBD,MAAMgM,GACR/L,KAAKyS,SAAWzS,KAAKyS,QAAQ9M,KAAOoG,EAAGpG,IACzC3F,KAAKyS,QAAQb,QAGf5R,KAAKyS,QAAU1G,GCxInB,MAAM4K,GAAgB,QAEhB7B,WAAuBzE,EAA7BtQ,kCACUC,KAAA4W,eAEE7W,eAAeiI,GACvB,OAAOhI,KAAK6W,aAAa7O,IAAUhI,KAAK8W,UAAU9O,GAG5CjI,UACNiI,EACA+O,EAAsB/O,EAAMlE,SAAW,GAEvC,GAAIiT,GAAe,EAEjB,OADA/W,KAAK2O,iBAAcjG,GACZ,EAGT,MAAMmG,EAAO7O,KAAK8O,QAChB9G,EACA,EAAGlH,IAAGC,QAQJ,OAPcxE,OAAAuL,EAAA,MAAAvL,CAAMyD,KAAK4W,YAAa,EAAE/J,EAAKoD,KAIpCzO,KAAKD,IAAIC,KAAKY,IAAItB,EAAI+L,EAAI/L,GAAIU,KAAKY,IAAIrB,EAAI8L,EAAI9L,MAGxCgW,IAElB,GAGF,OAAIlI,EAAKzS,QACP4D,KAAK2O,YAAcE,EAAK9L,OACjB,GAEA/C,KAAK8W,UAAU9O,EAAO+O,EAAcJ,IAIvC5W,aAAaiI,GAWnB,OAVAhI,KAAK4W,eAEL5W,KAAKkS,WAAWlK,EAAO,CAAC7F,EAAOS,KAC7B,MAAMwD,EAAWxD,EAAKwD,WAElBA,GAAYpG,KAAKuR,QAAQvJ,EAAO5B,IAClCpG,KAAK4W,YAAYta,MAAM6F,EAAOiE,MAI3BpG,KAAK4W,YAAYxa,OAAS,SCvD/B4Y,WAAwBpE,EAC5B7Q,YAAY8Q,GACV7K,MAAM6K,EAAQjO,IAASA,EAAKoU,aCF1BxB,WAAsB/G,EAG1B1O,IAAIiI,EAAiBiJ,GAAqB,GAOxC,MAAMpC,EAAO7O,KAAK8O,QAAQ9G,EAAO7F,IAAU6F,EAAM6E,IAAI+B,GAAGzM,IAAQ,GAE5D0M,EAAKzS,QAEP4L,EAAM+G,KAAKF,EAAK,IAIb9O,UAAUiI,GACf,OAAO,iBCXX,MAAMiP,GAA0B,SAE1B3B,WAAsB7G,EAS1B1O,YAAYgM,GACV/F,MAAM+F,GAHA/L,KAAAoP,KAAe6H,GAIrBjX,KAAK9D,EAAI,IAET8D,KAAKkX,MAAQ,IAAIC,GAAA,MAEjBnX,KAAKoX,iBAELpX,KAAKqX,gBAAgBrX,KAAKsX,eAC1BtX,KAAK6O,QAGA9O,UAAUiI,GACf,OAAOhI,KAAKkX,MAAMK,QAAQnb,OAAS,EAG9B2D,IAAIiI,EAAiBiJ,GAAqB,GAC3CjR,KAAK6O,KAAKzS,OACZ4D,KAAKwX,aAAaxP,EAAOiJ,IAErBjR,KAAKyX,eACPzX,KAAKqX,gBAAgBrX,KAAKyX,cAC1BzX,KAAKsX,cAAgBtX,KAAKyX,cAG5BzX,KAAK0X,gBAAgB1P,GACrBhI,KAAKwX,aAAaxP,EAAOiJ,IAE3BjR,KAAKoP,MAAQ,EAGRrP,QACLC,KAAK6O,QAGA9O,cAAciI,IACfhI,KAAKoP,MAAQ6H,IAAmBjX,KAAK2X,cAAc3P,KACrDhI,KAAKyW,QAAQzO,EAAM6E,IAAI/L,EAAGkH,EAAM6E,IAAI9L,GAEtCf,KAAKoP,MAAQ,EAIRrP,QAAQe,EAAWC,GACxBf,KAAKkX,MAAMU,QAAQ5X,KAAK9D,EAAG,IAAIgG,EAAMpB,EAAGC,IACpCf,KAAKsX,eAAiBtX,KAAKsX,gBAAkBtX,KAAK9D,GACpD8D,KAAKkX,MAAMW,QAAQ7X,KAAKsX,cAAetX,KAAK9D,GAE9C8D,KAAKsX,cAAgBtX,KAAK9D,EAC1B8D,KAAK9D,EAAIgF,EAAKlB,KAAK9D,GACnB8D,KAAKoP,KAAO,EAGNrP,aAAaiI,GACnB,MAAM6E,EAAa7M,KAAKkX,MAAMY,KAAK9X,KAAKyX,cAExCzX,KAAK6O,KAAO7O,KAAK8O,QAAQ9G,EAAO7F,GAAS0K,EAAI+B,GAAGzM,IAG1CpC,gBAAgBiI,GACtB,IAAI+P,EAAqB/X,KAAKkX,MAAMK,QAAQ,GACxCS,EAAuBhY,KAAKoX,cAAcW,GAE9C/X,KAAKkX,MAAMe,UAAUjY,KAAKsX,eAAe5U,QAASwV,IAC5CF,GAAgBhY,KAAKoX,cAAcc,IAAW,KAChDH,EAAaG,EACbF,EAAehY,KAAKoX,cAAcW,MAItC/X,KAAKyX,aAAeM,EACpB/X,KAAKmY,aAAanQ,GAGZjI,aAAaiI,EAAiBiJ,GACpC,MAAMpD,EAAmB7N,KAAK6O,KAAKhS,QAEnC,GAAKgR,EAOE,GACL7F,EACG+F,cACAb,GAAGW,EAAU/M,EAAG+M,EAAU9M,GAC1BwO,YAIH,GAFAvP,KAAKmY,aAEDnY,KAAK6O,KAAKzS,OACZ,OAAO4D,KAAK4N,IAAI5F,GAAO,QAGzBA,EAAM+G,KAAKlB,QAlBPoD,GACFjR,KAAK6O,QACL7O,KAAK4N,IAAI5F,GAAO,IAEhB,IAAIwN,GAAOxV,KAAK0O,QAAQd,IAAI5F,EAAOiJ,GAkBjClR,gBAAgBmY,GACtBlY,KAAKoX,cAAcc,GAAUlY,KAAKoP,KAG5BrP,cAAciI,GACpB,OAAOA,EACJ+F,cACAb,GAAGlF,EAAM0F,YAAY5M,EAAGkH,EAAM0F,YAAY3M,GAC1C6B,KAAKxC,gBC5HNgV,WAAsB/E,EAA5BtQ,kCACUC,KAAAoY,cAAwB,KAEzBrY,UAAUiI,GACf,OAAOA,EAAMgM,IAAIzK,EAAQ8O,YAAcrS,MAAM8C,UAAUd,GAG/CjI,eAAeiI,GACvB,OACEhI,KAAKsY,SAAStQ,EAAOL,GAAQA,EAAKhC,KAAO3F,KAAKoY,gBAC9CpY,KAAKsY,SAAStQ,EAAOL,IAAQ,GAIvB5H,QAAQiI,GAChB,MAAMpF,EAAOoF,EAAMoC,aAAa8C,GAAGlF,EAAM6E,IAAI/L,EAAGkH,EAAM6E,IAAI9L,GAC1Df,KAAK0O,OAAO6J,UAAU,IAAIjG,EAAkB1P,EAAKuK,QAEjDvK,EAAKuK,MAAMzK,QAAQiF,IACjBK,EAAMiE,UAAU/D,SAASP,KAG3B/E,EAAKuK,SAELnN,KAAKoY,cAAgB,KAGfrY,SACNiI,EACAyJ,GAEA,IAAIxU,GAAkB,EAYtB,OAVA+C,KAAKkS,WAAWlK,EAAO,EAAGlH,IAAGC,KAAK6B,KAChC,MAAM+E,EAAO/E,EAAKuK,QAAQ1F,KAAKgK,GAE3B9J,IAAS1K,IACX+C,KAAKoY,cAAgBzQ,EAAKhC,GAC1B3F,KAAK2O,YAAc,IAAIzM,EAAMpB,EAAGC,GAChC9D,GAAS,KAINA,SC9CLyZ,WAA0BjI,EACvB1O,UAAUiI,GACf,OAAQA,EAAM3B,gBAAgBsE,OAAO6N,QAGhCzY,IAAIiI,WCLP4N,WAAyBhF,EAG7B7Q,YAAY8Q,GACV7K,MAAM6K,EAAQjO,GAAQA,EAAKA,KAAK6V,OAASC,GAAUC,cAH7C3Y,KAAA4Y,YAAsB,EAMvB7Y,UAAUiI,GACf,OAAOA,EAAMgM,IAAIzK,EAAQsP,iBAAmB7S,MAAM8C,UAAUd,GAGvDjI,QACLiG,MAAM4L,QACN5R,KAAK4Y,YAAa,EAGV7Y,eAAeiI,GAMvB,OAJAhI,KAAK4Y,WAAa5Y,KAAK8Q,QACrB9I,EAAM+F,cAAcb,GAAGlF,EAAM6E,IAAI/L,EAAGkH,EAAM6E,IAAI9L,IAG5Cf,KAAK4Y,YACP5Y,KAAK2O,YAAc3G,EAAM6E,KAClB,GAEA7G,MAAMsK,eAAetI,GAItBjI,QAAQiI,GAEhB,MAAMpF,EAAOoF,EAAMoC,aAAa8C,GAAGlF,EAAM6E,IAAI/L,EAAGkH,EAAM6E,IAAI9L,GACtDf,KAAK4Y,YAAchW,aAAgB+V,IACrC/V,EAAKkW,GAAG9Q,UCjCR+Q,GACJhZ,YAAmBiZ,GAAAhZ,KAAAgZ,SAIZjZ,QACL,OAAQ,SAINkZ,WAAgCF,GACpChZ,YACkB4H,EACRuR,EACRF,GAEAhT,MAAMgT,GAJUhZ,KAAA2H,OACR3H,KAAAkZ,SAMHnZ,YAAY2R,GACjB,GAAI1R,KAAKmZ,OACP,OAGF,MAAOhX,GAASnC,KAAKkZ,OAAO5b,OAAO,EAAG,GAChCsF,EAAO8O,EAAOxE,GAAG/K,EAAMrB,EAAGqB,EAAMpB,GAElC6B,EAAKoN,QACPpN,EAAKwW,OAAS,IAGdpZ,KAAKqZ,YAAY3H,GAId3R,OACL,OAA8B,IAAvBC,KAAKkZ,OAAO9c,cC3BjBsZ,WAAuBjH,EAKpB1O,UAAUiI,GACf,OACEA,EAAMgM,IAAIzK,EAAQ+P,WAClBtZ,KAAKuZ,WAAWvR,IAChBhI,KAAKgR,UAAUhJ,GAIZjI,IAAIiI,GACT,MAAMqD,EAAUrL,KAAKwZ,SAASzW,MAM9B,IAAI8L,KAEJ5L,EAAU+E,EAAM6E,IAAK7M,KAAKqR,OAAOxE,IAAK,CAAC/L,EAAGC,IAAM8N,EAAKvS,KAAK,IAAI4F,EAAMpB,EAAGC,KAEvE,MAAMqY,EAAS,IAAIH,GAAiB5N,EAASwD,EAAM,KAC7C7O,KAAKqR,OAAO5O,GAAG,IAAI2I,EAAWpD,EAAOqD,MAAcd,EAASS,MAC9DhL,KAAKqR,YAAS3I,EACd1I,KAAKyZ,oBAAiB/Q,KAI1BV,EAAMoC,aAAasP,UAAUN,GAGvBrZ,WAAWiI,GAEjB,OADAhI,KAAKwZ,SAAWxR,EAAMiE,UAAU0N,OAAOtU,EAAMoB,OACtCzG,KAAKwZ,SAASpd,OAAS,EAGxB2D,UAAUiI,GAIhB,OAHAhI,KAAKyZ,eAAiBzZ,KAAKqR,OAC3BrR,KAAKqR,YAAS3I,KAEV1I,KAAKyZ,iBAELzZ,KAAKsR,aACHtJ,EACA5B,GAAYpG,KAAKyZ,eAAe9T,KAAOS,EAAST,MAO/C3F,KAAKsR,aAAatJ,EAAO5B,GAAYpG,KAAKuR,QAAQvJ,EAAO5B,IAG1DrG,aACNiI,EACAyJ,GAeA,OAbAzR,KAAKkS,WAAWlK,EAAO,CAAC7F,EAAOS,KAC7B,MAAMwD,EAAWxD,EAAKwD,YAGnBpG,KAAKqR,QACNjL,GACAqL,EAAUrL,KACTpG,KAAK4Z,UAAU5R,EAAO7F,KAEvBnC,KAAKqR,OAASrJ,EAAMoC,aAAa8C,GAAG/K,EAAMrB,EAAGqB,EAAMpB,GAAGqF,SAASoL,YAI1DxR,KAAKqR,OAGRtR,UAAUiI,EAAiB6R,GACjC,IAAID,GAAY,EAWhB,OATA3W,EAAU+E,EAAM6E,IAAKgN,EAAQ,CAAC/Y,EAAGC,KAC/B6Y,EACEA,GACA5R,EACG+F,cACAb,GAAGpM,EAAGC,GACNwO,SAASvH,KAGT4R,GCjGX,IAAYlB,IAAZ,SAAYA,GACVA,IAAA,eACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,+BACAA,IAAA,2BALF,CAAYA,mBAQNoB,GAyBJ/Z,YACSf,EACAqB,EACAoY,GAFAzY,KAAAhB,MACAgB,KAAAK,UACAL,KAAAyY,OA1BFzY,KAAAmN,SAIApN,gBAAgBf,GACrB,OAAQA,GACN,IAAK,IACH,OAAO,IAAI8a,GAAK,IAAK,IAAKpB,GAAUqB,OACtC,IAAK,IACH,OAAO,IAAID,GAAK,IAAK,IAAKpB,GAAUqB,OACtC,IAAK,IACH,OAAO,IAAID,GAAK,IAAK,IAAKpB,GAAUsB,MACtC,IAAK,IACH,OAAO,IAAIF,GAAK,IAAK,IAAKpB,GAAUuB,MACtC,IAAK,IACH,OAAO,IAAIH,GAAK,IAAK,IAAKpB,GAAUC,cACtC,IAAK,IACH,OAAO,IAAImB,GAAK,IAAK,IAAKpB,GAAUwB,YACtC,QACE,cAAelb,yBAUde,QAAQ4H,GACb3H,KAAKmN,MAAM7Q,KAAKqL,GAGX5H,SACL,OAAOC,KAAKyY,OAASC,GAAUuB,KAG1Bla,SACL,OAAOC,KAAKyY,OAASC,GAAUsB,KAG1Bja,UACL,OAAOC,KAAKyY,OAASC,GAAUqB,MAG1Bha,iBACL,OACEC,KAAKma,WACLna,KAAKyY,OAASC,GAAUC,cACxB3Y,KAAKyY,OAASC,GAAUwB,WAIrBna,gBAAgBiI,GACrB,OAAIA,GAAShI,KAAKoG,SACTpG,KAAKyY,OAASC,GAAUsB,MAAQha,KAAKoG,SAAST,KAAOqC,EAAMrC,GAG7D3F,KAAKyY,OAASC,GAAUsB,OAASha,KAAKoG,SAGxCrG,QACL,IAAI6C,EAAOkX,GAAKM,SAASpa,KAAKhB,KAK9B,OAJIgB,KAAKoG,WACPxD,EAAKwD,SAAWpG,KAAKoG,SAASiU,SAEhCra,KAAKmN,MAAMzK,QAAQiF,GAAQ/E,EAAKuK,MAAM7Q,KAAKqL,EAAK0S,UACzCzX,EAGC7C,OACR,YAAyB2I,IAAlB1I,KAAKoG,UArEC0T,GAAAQ,oBAyEjBC,WAAgCT,GAKvB/Z,GAAGiI,GACRhI,KAAKwa,WAAWC,MAAMzS,GACtBhI,KAAK0a,YAAYC,MAAM3S,EAAOhI,KAAK4a,UAEnC5a,KAAK0a,YAAYnS,KAAKiS,WAAaxa,KAAK0a,mBAItC/B,WAA4B4B,GAChCxa,YACYya,EACAE,EACAE,GAEV5U,MAAM,IAAK,IAAK0S,GAAUC,cAJhB3Y,KAAAwa,aACAxa,KAAA0a,cACA1a,KAAA4a,gBCtGFC,YAAZ,SAAYA,GACVA,IAAA,iBACAA,IAAA,eACAA,IAAA,qBACAA,IAAA,mBAJF,CAAYA,mBAONC,GACJ/a,YACSsJ,EACA0R,EACAC,GAFAhb,KAAAqJ,QACArJ,KAAA+a,KACA/a,KAAAgb,iBAILC,GAANlb,cACSC,KAAAkb,YAEAnb,YAAY0K,EAAgBzC,EAAiB6R,GAClD7Z,KAAKmb,SAAStB,EAAO5b,cAAcwM,iBAAsBzC,EAAM/J,UAG1D8B,YAAY0K,EAAgBzC,EAAiB6R,GAClD7Z,KAAKob,WACAvB,EAAO5b,cAAcwM,iBAAsBzC,EAAM/J,6BAIjD8B,YAAYiI,EAAiB6R,GAClC7Z,KAAKmb,SAASnT,EAAM/J,iBAAiB4b,EAAO5b,WAGvC8B,iBAAiBiI,EAAiB6R,EAAkBxO,GACzDrL,KAAKmb,SACAnT,EAAM/J,iBAAiBoN,EAAQpN,WAAW4b,EAAO5b,uBAIjD8B,iBACL0K,EACAzC,EACA6R,EACAxO,GAEArL,KAAKob,WACAvB,EAAO5b,cAAcwM,iBAAsBzC,EAAM/J,aAClDoN,EAAQpN,2BAKP8B,iBACL0K,EACAzC,EACA6R,EACAxO,GAEArL,KAAKmb,SACAtB,EAAO5b,cAAcwM,iBAAsBzC,EAAM/J,aAClDoN,EAAQpN,QAKJ8B,MAAMib,GACdhb,KAAKqb,WAAWR,GAASS,MAAON,GAGxBjb,KAAKib,GACbhb,KAAKqb,WAAWR,GAASU,KAAMP,GAGvBjb,QAAQib,GAChBhb,KAAKqb,WAAWR,GAASW,QAASR,GAG1Bjb,OAAOib,GACfhb,KAAKqb,WAAWR,GAASY,OAAQT,GAGzBjb,WAAWsJ,EAAiB2R,GACpChb,KAAKkb,SAAS5e,KAAK,IAAIwe,GAAWzR,EAAOqS,KAAUV,WCpFjDW,GAAN5b,cACUC,KAAAoP,KAAe,EACfpP,KAAA4b,SAED7b,IAAI4H,EAASlE,GAClB,MAAMsX,EAAK/a,KAAKoP,KAAO3L,EAEnBzD,KAAK4b,MAAMb,GACb/a,KAAK4b,MAAMb,GAAIze,KAAKqL,GAEpB3H,KAAK4b,MAAMb,IAAOpT,GAIf5H,OAAO4H,GACZpL,OAAAuL,EAAA,QAAAvL,CAAQyD,KAAK4b,MAAO,CAACld,EAAOM,KAC1BzC,OAAAuL,EAAA,OAAAvL,CAAOmC,EAAOmd,GAAWA,IAAYlU,KAIlC5H,OACLC,KAAKoP,KAAO7S,OAAAuL,EAAA,IAAAvL,CAAIA,OAAAuL,EAAA,KAAAvL,CAAKyD,KAAK4b,OAAOtZ,IAAIxB,GAAKgb,SAAShb,KAEnD,MAAO+a,GAAWtf,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAK4b,MAAM5b,KAAKoP,MAAO,GAMhD,OAJqC,IAAjCpP,KAAK4b,MAAM5b,KAAKoP,MAAMhT,eACjB4D,KAAK4b,MAAM5b,KAAKoP,MAGlByM,EAGF9b,SACL,GAAyB,IAArBxD,OAAAuL,EAAA,KAAAvL,CAAKyD,KAAK4b,OACZ,SAGF5b,KAAKoP,KAAO7S,OAAAuL,EAAA,IAAAvL,CAAIA,OAAAuL,EAAA,KAAAvL,CAAKyD,KAAK4b,OAAOtZ,IAAIxB,GAAKgb,SAAShb,KACnD,MAAMib,EAAS/b,KAAK4b,MAAM5b,KAAKoP,MAI/B,cAFOpP,KAAK4b,MAAM5b,KAAKoP,MAEhB2M,SC/BLC,WAAwBxZ,EAW5BzC,YAAYuC,GACV0D,MAAM1D,GAXDtC,KAAAic,aAYLjc,KAAK2F,GAAKqW,GAASpW,QACnB5F,KAAKkc,SAAW,IAAIP,GAPf5b,eACL,OAAOC,KAAK6F,SASP9F,QACLC,KAAKkc,SAAW,IAAIP,GAGf5b,MAAMiI,GACXhI,KAAK4R,QACL5R,KAAKiN,eAAejF,GAGfjI,MAAMiI,EAAiB4S,GAC5B5a,KAAK4R,QACL5R,KAAKic,UAAUvZ,QAAQ0D,GACrBpG,KAAKkc,SAAS3Z,KAAK6D,EAAST,QAAI+C,GAAYtC,EAASmH,UAGvDvF,EAAMmU,SAASvB,EAAU5a,MAGpBD,YAAYqG,GACjBpG,KAAKic,UAAU3f,KAAK8J,GAEpBpG,KAAKkN,GAAG9G,EAASyG,IAAI/L,EAAGsF,EAASyG,IAAI9L,GAAGqF,SAAWA,EACnDpG,KAAKkc,SAAS3Z,KAAK6D,EAAST,QAAI+C,GAAYtC,EAASmH,SAGhDxN,eAAeqG,GACTpG,KAAKkN,GAAG9G,EAASyG,IAAI/L,EAAGsF,EAASyG,IAAI9L,GAC3CqF,cAAWsC,EAChBnM,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAKic,UAAWle,GAAKA,EAAE4H,KAAOS,EAAST,IAC9C3F,KAAKkc,SAASE,QAAQhW,EAAST,QAAI+C,IAG9B3I,eAAee,EAAWC,GAC/B,OAAOf,KAAKsC,IAAIxB,GAAGC,GAAGuN,iBAGjBvO,gBAAgBe,EAAWC,GAChC,OAAOf,KAAKsC,IAAIxB,GAAGC,GAAGsb,kBAGjBtc,QAAQe,EAAWC,EAAW6B,GACnC5C,KAAKsC,IAAIxB,GAAGC,GAAK6B,EAGZ7C,UAAUqZ,GACfpZ,KAAKkc,SAAS3Z,UAAKmG,EAAW0Q,GAASA,EAAO7L,SAGzCxN,OACL,GAAIC,KAAKuI,KAAKE,OACZ,OAGF,MAAO6T,EAASlD,GAAUpZ,KAAKkc,SAASK,OAExC,QAAgB7T,IAAZ4T,EAAuB,CACzB,MAAMtU,EAAQhI,KAAKic,UAAUxU,KAAKrB,GAAYkW,IAAYlW,EAAST,IAE/DqC,IACFA,EAAM4F,IAAI5N,MAGNA,KAAKic,UAAUxU,KAAKrB,GAAYkW,IAAYlW,EAAST,KACvD3F,KAAKkc,SAAS3Z,KAAK+Z,OAAS5T,GAAYV,EAAMuF,UAIlDvN,KAAKuI,KAAKtI,OAAOuc,oBACZ,KAAIpD,EAUT,KAAM,2BATFA,EAAOD,OACTC,EAAOJ,SAEPhZ,KAAKkc,SAAS3Z,UAAKmG,EAAW0Q,GAASA,EAAO7L,SAGhDvN,KAAKuI,KAAKtI,OAAOuc,gBACjBpD,EAAOC,YAAYrZ,KAAKuI,KAAKtI,OAAO8N,iBAvFzBiO,GAAAnW,OAAqB,QCnBhC4W,GAOJ1c,YAAoB2c,GAAA1c,KAAA0c,WANb1c,KAAA4S,QAAkB,EAClB5S,KAAA2c,kBAA4B,EAG3B3c,KAAA4c,cAAwB,EAG9B5c,KAAK6c,mBAAqB7c,KAAK0c,SAAS,GAGnC3c,IAAI+c,GACT,GAAI9c,KAAK4c,aACP,OAGF5c,KAAK2c,mBAAqBG,EAE1B,IAAI9T,EAAW,EAEf,MACGhJ,KAAK4c,cACN5c,KAAK2c,mBAAqB3c,KAAK6c,oBAE/B7T,GAAY,EACZhJ,KAAKiJ,UAGP,OAAOD,EAGCjJ,UACRC,KAAK4S,SAAW,EAEhB,IAAIvJ,EAAQrJ,KAAK0c,SAAS1c,KAAK4S,QAAU,GAErCvJ,GACFrJ,KAAK2c,mBAAqB3c,KAAK6c,mBAC/B7c,KAAK6c,mBAAqBxT,IAE1BrJ,KAAK2c,kBAAoB3c,KAAK6c,mBAC9B7c,KAAK4c,cAAe,UCrCpBG,GAMJhd,YAAmB6C,GAAA5C,KAAA4C,OALZ5C,KAAAgQ,SAAmB,EACnBhQ,KAAAmO,OAAiB,EACjBnO,KAAAgX,MAAgB,EAKhBjX,IAAI6C,EAAYuL,GACrBnO,KAAKgQ,SAAU,EACfhQ,KAAKmO,OAASA,EACdnO,KAAKgX,MAAO,EACZhX,KAAK4C,KAAOA,EAAKyX,QAGZta,QACL,OAAOC,KAAK4C,KAAKuK,MAGZpN,SAASiI,GACd,OAAOhI,KAAKgX,OAAShX,KAAK4C,KAAKyZ,gBAAgBrU,GAG1CjI,WACL,OAAOC,KAAK4C,MAAQ5C,KAAK4C,KAAKwD,SAGzBrG,QACLC,KAAKgQ,SAAU,EACfhQ,KAAKoZ,YAAS1Q,EACd1I,KAAK4C,KAAKwD,cAAWsC,SAInBuF,WAAsBzL,EAC1BzC,YAAY6B,EAAeC,GACzB,MAAMmb,EAAWlD,GAAKM,SAAS,KAC/BpU,MAAMrE,EAAYC,EAAOC,EAAQ,IAAM,IAAIkb,GAAWC,KAGjDjd,eACLC,KAAKid,KAAKra,GAAQA,EAAKgP,gBCzCrBsL,GAMJnd,YACS8I,GAAA7I,KAAA6I,mBANF7I,KAAAqK,OAAiB,IAAI4Q,GAQ1Bjb,KAAKyI,OAAS,YCXZ0U,GAIJpd,YAAYoN,GAHJnN,KAAAod,YAAsB,EACtBpd,KAAAmN,SAGNA,EAAMzK,QAAQ,EAAE4Q,EAAQ3L,KAAU3H,KAAKuC,IAAI+Q,EAAQ3L,IAG9C5H,IAAIuT,EAAgB3L,GACzB,GAAI2L,EAAS,EACX,KAAM,gCAGRtT,KAAKmN,MAAM7Q,MAAMgX,EAAQ3L,IACzB3H,KAAKod,aAAe5b,KAAK6b,KAAK/J,GAGzBvT,KAAKyI,GACV,GAA0B,IAAtBxI,KAAKmN,MAAM/Q,OACb,KAAM,0BAGR,IAAIkhB,EAAO/gB,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAKod,aAEvB,OAAOpd,KAAKmN,MAAM1F,KAAK,EAAE6L,EAAQ3L,MAC/B2V,GAAQhK,IAEO,GACd,GAAG9K,GAGDzI,MAAMwd,GACX,IAAIC,EAAY,IAAIL,OAKpB,OAHAnd,KAAKmN,MAAMzK,QAAQ,EAAE4Q,EAAQ3L,KAAU6V,EAAUjb,IAAI+Q,EAAQ3L,IAC7D4V,EAAKpQ,MAAMzK,QAAQ,EAAE4Q,EAAQ3L,KAAU6V,EAAUjb,IAAI+Q,EAAQ3L,IAEtD6V,SCrCLC,GACJ1d,YACkB4F,EACA1H,EACToL,EAAgB,GAFPrJ,KAAA2F,KACA3F,KAAA/B,OACT+B,KAAAqJ,eAILqU,ICFC,MAAMC,GAAW,SACtBtU,EACAuU,EAAyB,MAAM,IAE/B,IAAK,IAAIxgB,EAAI,EAAGA,EAAIiM,EAAMxH,OAAS,EAAGzE,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAImN,EAAMzH,MAAO1F,IAAK,CACpC,MAAM0G,EAAOyG,EAAM6D,GAAGhR,EAAGkB,GACvBygB,EAAKxU,EAAM6D,GAAGhR,EAAGkB,EAAI,GACrB0gB,EAAOzU,EAAM6D,GAAGhR,EAAGkB,EAAI,GACvB2gB,EAAO1U,EAAM6D,GAAGhR,EAAI,EAAGkB,GACvB4gB,EAAQ3U,EAAM6D,GAAGhR,EAAI,EAAGkB,GAErBwgB,KAA0B,MAAbhb,EAAK5D,MAKR,MAAb+e,EAAK/e,KACS,MAAdgf,EAAMhf,KACK,MAAX6e,EAAG7e,KACU,MAAb8e,EAAK9e,MAMQ,MAAb+e,EAAK/e,KACS,MAAdgf,EAAMhf,KACK,MAAX6e,EAAG7e,KACU,MAAb8e,EAAK9e,MAMS,MAAb+e,EAAK/e,KAA6B,MAAdgf,EAAMhf,KACf,MAAX6e,EAAG7e,KAA4B,MAAb8e,EAAK9e,MAExBqK,EAAM4U,QAAQ/hB,EAAGkB,EAAG0c,GAAKM,SAAS,QAKxC,OAAO/Q,GAGI6U,GAAe,SAC1BC,EACA9U,EACA+U,GAEA,IAAK,IAAIhhB,EAAI,EAAGA,EAAIiM,EAAMxH,OAAS,EAAGzE,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAImN,EAAMzH,MAAQ,EAAG1F,IAC/BmN,EAAM6D,GAAGhR,EAAGkB,GAAGif,mBAAqB7a,KAAKE,SAAWyc,GACtDC,EAAcd,KAAK,MAAMnB,SAAS,IAAIja,EAAMhG,EAAGkB,GAAIiM,GAKzD,OAAOA,GAGIgV,GAAW,SACtBF,EACA9U,EACAiV,GAEA,IAAK,IAAIlhB,EAAI,EAAGA,EAAIiM,EAAMxH,OAAS,EAAGzE,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAImN,EAAMzH,MAAQ,EAAG1F,IAAK,CACxC,MAAM0G,EAAOyG,EAAM6D,GAAGhR,EAAGkB,GACrBwF,EAAKyZ,mBAAqB7a,KAAKE,SAAWyc,GAC5Cvb,EAAK2b,QAAQD,EAAUhB,KAAK,OAKlC,OAAOjU,GAGImV,GAAa,SAASnV,GACjC,IAAIoV,EAAOpV,EAAMzH,MACf8c,EAAOrV,EAAMxH,OACb8c,EAAO,EACPC,EAAO,EAET,IAAK,IAAIxhB,EAAI,EAAGA,EAAIiM,EAAMxH,OAAS,EAAGzE,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAImN,EAAMzH,MAAQ,EAAG1F,IAC9BmN,EAAM6D,GAAGhR,EAAGkB,GAAGif,oBAIpBuC,EAAOpd,KAAKD,IAAInE,EAAGwhB,GACnBD,EAAOnd,KAAKD,IAAIrF,EAAGyiB,GACnBD,EAAOld,KAAKQ,IAAI5E,EAAGshB,GACnBD,EAAOjd,KAAKQ,IAAI9F,EAAGuiB,IAIvB,MAAM3b,EAAKtB,KAAKC,OAAO4H,EAAMzH,OAAS+c,EAAOF,IAAS,GAAKA,EACzDva,EAAK1C,KAAKC,OAAO4H,EAAMxH,QAAU+c,EAAOF,IAAS,GAAKA,EAKxD,OAHA7b,EAAMwG,EAAM/G,IAAKQ,GACjBuG,EAAM/G,IAAII,QAAQ0B,GAAOvB,EAAMuB,EAAKF,IAE7BmF,GAGIwV,GAAY,SACvBxV,EACA9B,EACAuX,GAEA,IAAIC,EAAQ1V,EAAMzH,MAAQyH,EAAMxH,OAEhC,KAAOkd,EAAQ,GAAG,CAChB,MAAMje,EAAIvE,OAAAuL,EAAA,OAAAvL,CAAO,EAAG8M,EAAMzH,MAAQ,GAChCb,EAAIxE,OAAAuL,EAAA,OAAAvL,CAAO,EAAG8M,EAAMxH,OAAS,GAE/B,GAAI0F,EAAM8B,EAAM6D,GAAGpM,EAAGC,IAEpB,OADA+d,EAAQhe,EAAGC,GACJsI,EAGT0V,IAGF,KAAM,+BAGKC,GAAc,SAASC,EAAgBC,GAClDL,GACEI,EACArc,GAAQA,EAAKuX,WAAavX,EAAKyZ,kBAC/B,CAACvZ,EAAIoB,KACH,IAAIib,EAEJN,GACEK,EACAtc,GAAQA,EAAKuX,WAAavX,EAAKyZ,kBAC/B,CAAC+C,EAAIC,KACH,MAAMC,EAAS,kBTnCO/E,GAC9Bxa,YACYya,EACAE,EACAE,GAEV5U,MAAM,IAAK,IAAK0S,GAAUwB,YAJhBla,KAAAwa,aACAxa,KAAA0a,cACA1a,KAAA4a,aS+B0BsE,EAAMD,EAAM,IAAI/c,EAAMY,EAAIoB,IACxDgb,EAAKjB,QAAQmB,EAAIC,EAAIC,GAErBH,EAAW,IAAIxG,GAAasG,EAAMC,EAAM,IAAIhd,EAAMkd,EAAIC,MAI1DJ,EAAKhB,QAAQnb,EAAIoB,EAAIib,MCxJ3B,IAAAI,GAAA,SAAwBC,GACtB,OAAO,IAAIxD,GACTra,EAAY6d,EAAQ,GAAGpjB,OAAQojB,EAAQpjB,OAAQ,CAAC0E,EAAGC,IACjD+Y,GAAKM,SAASoF,EAAQze,GAAG0e,OAAO3e,OCHtC,MAAM4e,GAAY,EAEZC,GAAe,WACnB,OAAO7F,GAAKM,SAAS,MAGjBwF,GAAc,WAClB,OAAO9F,GAAKM,SAAS,MAGjByF,GAAU,WACd,OAAO/F,GAAKM,SAAS,MAKjB0F,GAAY,GACZC,GAAcve,KAAKwe,IAAkB,EAAZF,UAE/BG,WAAmBpf,EACjBd,SAASmgB,GACP,OACEA,EAAKpf,EAAI4e,GAAY1f,KAAKc,EAAId,KAAKgB,GACnCkf,EAAKnf,EAAI2e,GAAY1f,KAAKe,EAAIf,KAAKiB,GACnCif,EAAKpf,EAAIof,EAAKlf,EAAIhB,KAAKc,EAAI4e,IAC3BQ,EAAKnf,EAAImf,EAAKjf,EAAIjB,KAAKe,EAAI2e,GAI/B3f,cACE,OAAO,IAAImC,EACTlC,KAAKc,EAAI,EAAIQ,EAAKtB,KAAKgB,EAAI,GAC3BhB,KAAKe,EAAI,EAAIO,EAAKtB,KAAKiB,EAAI,IAI/BlB,IAAI0N,GACF,IAAIvR,EAAY,EAChB,KAAOA,EAAI8D,KAAKgB,GAAG,CACjB,IAAI5D,EAAY,EAChB,KAAOA,EAAI4C,KAAKiB,GACdwM,EAAMzN,KAAKc,EAAI5E,GAAG8D,KAAKe,EAAI3D,GAAKuiB,KAChCviB,IAGFlB,YAKNikB,WAAmBtf,EAGjBd,YAAYe,EAAWC,EAAWC,EAAWC,GAC3C+E,MAAMlF,EAAGC,EAAGC,EAAGC,GACfjB,KAAKogB,MAAStf,GAAKE,GAAKD,GAAKE,GAAOD,GAAKF,GAAKG,GAAKF,EAGrDhB,IAAI0N,GACF,IAAK4S,EAAIC,EAAItf,GAAKhB,KAAKugB,iBAEnBrkB,EAAI,EACR,KAAOA,EAAI8E,GACqB,MAA1ByM,EAAM4S,EAAKnkB,GAAGokB,GAAIthB,MACpByO,EAAM4S,EAAKnkB,GAAGokB,GAAMV,MAEtB1jB,GAAK,EAGP,IAAKskB,EAAIC,EAAIxf,GAAKjB,KAAK0gB,eACnBtjB,EAAI,EACR,KAAOA,EAAI6D,GACqB,MAA1BwM,EAAM+S,GAAIC,EAAKrjB,GAAG4B,MACpByO,EAAM+S,GAAIC,EAAKrjB,GAAKwiB,MAEtBxiB,GAAK,EAIT2C,iBAIE,OAAIC,KAAKogB,OAEL5e,KAAKQ,IAAIhC,KAAKc,EAAGd,KAAKgB,GACtBQ,KAAKD,IAAIvB,KAAKe,EAAGf,KAAKiB,GACtBO,KAAKY,IAAIpC,KAAKgB,EAAIhB,KAAKc,KAOvBU,KAAKQ,IAAIhC,KAAKc,EAAGd,KAAKgB,GACtBQ,KAAKQ,IAAIhC,KAAKe,EAAGf,KAAKiB,GACtBO,KAAKY,IAAIpC,KAAKgB,EAAIhB,KAAKc,IAI7Bf,eAIE,OAAIC,KAAKogB,OAEL5e,KAAKQ,IAAIhC,KAAKc,EAAGd,KAAKgB,GACtBQ,KAAKQ,IAAIhC,KAAKe,EAAGf,KAAKiB,GACtBO,KAAKY,IAAIpC,KAAKiB,EAAIjB,KAAKe,KAmJ/B,IAAA4f,GAAA,SACEC,EACAC,EACAC,EACAC,EACAC,GAGA,MAAMC,EAAU,UAzIhBlhB,YACY4e,EACAC,EACFkC,EACAC,EACAC,GAJEhhB,KAAA2e,OACA3e,KAAA4e,OACF5e,KAAA8gB,UACA9gB,KAAA+gB,UACA/gB,KAAAghB,aAER,IAAIE,EAAgB,IAAInf,MAAM/B,KAAKghB,YAChCG,UAAKzY,GACLpG,IAAI8e,GAAKphB,KAAKqhB,gBAEjBrhB,KAAKkhB,MAAQlhB,KAAKshB,UAAUthB,KAAKuhB,IAAIL,IACrClhB,KAAKwhB,MAAQxhB,KAAKyhB,WAAWzhB,KAAKkhB,OAG5BnhB,eACN,OAAO,IAAIkgB,GACT,EACA,EACAjgB,KAAK8gB,QAAUxf,EAAKtB,KAAK+gB,QAAU/gB,KAAK8gB,SACxC9gB,KAAK8gB,QAAUxf,EAAKtB,KAAK+gB,QAAU/gB,KAAK8gB,UAMpC/gB,IAAImhB,GACV,OAAOA,EAAM3M,OAAO,CAACmN,EAAqBC,KACxC,IACE,IAAIzlB,EAAI,EAAG0lB,EAAStgB,EAAK,KAAO,IAAOE,KAAKwe,GAC5C9jB,EAAI4jB,GACJ8B,GAAS7B,GAAa7jB,IACtB,CAEA,MAAM2lB,EAAcrgB,KAAKqgB,IAAID,GACvBE,EAActgB,KAAKsgB,IAAIF,GAC7B,IAAI/jB,EAAY,EACZiF,EAAa,EACboB,EAAa,EAEb6d,EAAa,IAAI9B,GACnB0B,EAAY7gB,EACZ6gB,EAAY5gB,EACZ4gB,EAAY3gB,EACZ2gB,EAAY1gB,GAGd,KAAOO,KAAKY,IAAIU,GAAM9C,KAAK2e,KAAO,GAAKnd,KAAKY,IAAI8B,GAAMlE,KAAK4e,KAAO,GAAG,CACnE,IAAIoD,EAAMxgB,KAAKkC,MAAM7F,EAAIgkB,GACrBI,EAAMzgB,KAAKkC,MAAM7F,EAAIikB,GAEzB,KAAOE,IAAQlf,GAAMmf,IAAQ/d,GAC3BrG,GAAK,EACLmkB,EAAMxgB,KAAKkC,MAAM7F,EAAIgkB,GACrBI,EAAMzgB,KAAKkC,MAAM7F,EAAIikB,GAOvB,GAJAC,EAAWhT,KAAKiT,EAAMlf,EAAImf,EAAM/d,GAChCpB,EAAKkf,EACL9d,EAAK+d,EAEDP,EAAYQ,MAAMC,GAAQJ,EAAWK,SAASD,IAEhD,OADAT,EAAYplB,KAAKylB,GACVL,GAKb,OAAOA,OAIH3hB,UAAUmhB,GAChB,MAAMzC,EAAOzc,EAAIkf,EAAM5e,IAAI6f,GAAQA,EAAKrhB,IAAM,EAC9CogB,EAAMxe,QAAQyf,IACZA,EAAKpT,MAAM0P,EAAM,KAEnByC,EAAQA,EAAMnZ,OAAQoa,GAAeA,EAAKrhB,EAAIqhB,EAAKnhB,EAAIhB,KAAK2e,MAE5D,MAAMD,EAAO1c,EAAIkf,EAAM5e,IAAI6f,GAAQA,EAAKphB,IAAM,EAI9C,OAHAmgB,EAAMxe,QAAQyf,IACZA,EAAKpT,KAAK,GAAI2P,KAETwC,EAAMnZ,OAAQoa,GAAeA,EAAKphB,EAAIohB,EAAKlhB,EAAIjB,KAAK4e,MAGrD7e,WAAWmhB,GACjB,IAAImB,EAAkBnB,EAAM5e,IAAI6f,GACvBA,EAAKG,eAGVC,GAA4BF,EAAOxlB,SACnC2kB,KAEJ,MAAM3c,EAAW,SAAS2d,EAAeC,GAEvC,OAAOjhB,KAAAoS,IAAC4O,EAAO1hB,EAAI2hB,EAAO3hB,EAAM,GAAIU,KAAAoS,IAAC4O,EAAOzhB,EAAI0hB,EAAO1hB,EAAM,IAG/D,KAAOshB,EAAOjmB,QAAQ,CACpB,IAAIsmB,EAAeL,EAAOxlB,QAEtB8lB,EAAiBJ,EAAgB,GACjCxL,EAAclS,EAAS6d,EAAcC,GAEzCJ,EAAgB7f,QAAQP,IACtB,MAAMygB,EAAkB/d,EAAS1C,EAAOugB,GACpCE,EAAkB7L,IACpB4L,EAAiBxgB,EACjB4U,EAAc6L,KAIlBL,EAAgBjmB,KAAKomB,GAErBlB,EAAMllB,KACJ,IAAI6jB,GACFuC,EAAa5hB,EACb4hB,EAAa3hB,EACb4hB,EAAe7hB,EACf6hB,EAAe5hB,IAKrB,OAAOygB,IAY4BZ,EAAMC,EAAMC,EAASC,EAASC,GAEnE,IAAIvT,EAAQ9L,EAAYif,EAAMC,EAAMhB,IAEpC,IAAK,IAAI3jB,EAAI,EAAGA,EAAI+kB,EAAQC,MAAM9kB,OAAQF,IAAK+kB,EAAQC,MAAMhlB,GAAGqG,IAAIkL,GAEpE,IAAK,IAAIvR,EAAI,EAAGA,EAAI+kB,EAAQO,MAAMplB,OAAQF,IAAK+kB,EAAQO,MAAMtlB,GAAGqG,IAAIkL,GAEpE,OAAO,IAAIuO,GAASvO,IClR6IoV,GCqBpJljB,EAAA,EAAIC,QACjB3B,KAAM,SACN4B,OAAQ,UACRC,UACEC,WACE,OAAOxD,OAAAuL,EAAA,UAAAvL,CAAUyD,KAAKqK,OAAO6Q,SAAU,KAG3C4H,SACE/H,GAAGgI,GACMrH,GAAOqH,EAAOhI,IAAIiI,OAAO,YAElCjjB,SAASgjB,GACP,OAAQA,EAAO1Z,OACb,KAAKwR,GAASS,MACZ,MAAO,kBACT,KAAKT,GAASU,KACZ,MAAO,aACT,KAAKV,GAASW,QACZ,MAAO,gBACT,KAAKX,GAASY,OACZ,MAAO,oBCvBjBwH,WAXA1mB,OAAAgE,EAAA,EAAAhE,CACAsmB,GCTA,WAA0B,IAAAK,EAAAljB,KAAaQ,EAAA0iB,EAAAziB,eAA0BE,EAAAuiB,EAAAxiB,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiBwiB,IAAA,YAAAC,YAAA,WAAqCziB,EAAA,SAAcyiB,YAAA,iCAA2CziB,EAAA,QAAAuiB,EAAAG,GAAAH,EAAA,kBAAAH,EAAA7mB,GAAsD,OAAAyE,EAAA,MAAgB3B,IAAA9C,EAAAonB,MAAAJ,EAAAK,SAAAR,KAAiCpiB,EAAA,MAAAuiB,EAAAtiB,GAAAsiB,EAAAM,GAAAN,EAAAnI,GAAAgI,OAAAG,EAAAtiB,GAAA,KAAAD,EAAA,MAAAuiB,EAAAtiB,GAAAsiB,EAAAM,GAAAT,EAAA/H,0BDY/S,EACA,KACA,KACA,qBETMyI,GAYJ1jB,YACS2jB,EACAnlB,EACAolB,EACAC,EACAC,EACAC,EACAC,GANA/jB,KAAA0jB,KACA1jB,KAAAzB,IACAyB,KAAA2jB,IACA3jB,KAAA4jB,IACA5jB,KAAA6jB,KACA7jB,KAAA8jB,KACA9jB,KAAA+jB,KAKFhkB,UAAY,OAAOC,KAAK0jB,GAIxB3jB,QAAQ2jB,GAAc1jB,KAAK0jB,GAAKA,EAIhC3jB,SAASxB,EAAWolB,EAAWC,GACpC5jB,KAAKzB,EAAIA,EACTyB,KAAK2jB,EAAIA,EACT3jB,KAAK4jB,EAAIA,EAKJ7jB,QAAQikB,GACbhkB,KAAKzB,EAAIylB,EACThkB,KAAK2jB,EAAIK,EACThkB,KAAK4jB,EAAII,EAKJjkB,cAAcxB,EAAWolB,EAAWC,GACzC5jB,KAAK6jB,GAAKtlB,EACVyB,KAAK8jB,GAAKH,EACV3jB,KAAK+jB,GAAKH,EAGL7jB,oBACLC,KAAKzB,EAAIyB,KAAK6jB,GACd7jB,KAAK2jB,EAAI3jB,KAAK8jB,GACd9jB,KAAK4jB,EAAI5jB,KAAK+jB,GAGThkB,aACLC,KAAKzB,GAAKyB,KAAK6jB,GAAI7jB,KAAK6jB,GAAK7jB,KAAKzB,GAAG,GACrCyB,KAAK2jB,GAAK3jB,KAAK8jB,GAAI9jB,KAAK8jB,GAAK9jB,KAAK2jB,GAAG,GACrC3jB,KAAK4jB,GAAK5jB,KAAK+jB,GAAI/jB,KAAK+jB,GAAK/jB,KAAK4jB,GAAG,GAKhC7jB,aAAeC,KAAKzB,EAAIyB,KAAK2jB,EAAI3jB,KAAK4jB,OAAIlb,EAI1C3I,kBAAoBC,KAAK6jB,GAAK7jB,KAAK8jB,GAAK9jB,KAAK+jB,QAAKrb,EAIlD3I,cACL,YAAe2I,IAAX1I,KAAKzB,QAA8BmK,IAAX1I,KAAK2jB,QAA8Bjb,IAAX1I,KAAK4jB,EAChD,IAAM5jB,KAAKzB,EAAE0lB,SAAS,IAAMjkB,KAAK2jB,EAAEM,SAAS,IAAMjkB,KAAK4jB,EAAEK,SAAS,IAC/D,GAKPlkB,mBACL,YAAgB2I,IAAZ1I,KAAK6jB,SAAgCnb,IAAZ1I,KAAK8jB,SAAgCpb,IAAZ1I,KAAK+jB,GAClD,IAAM/jB,KAAK6jB,GAAGI,SAAS,IAAMjkB,KAAK8jB,GAAGG,SAAS,IAAMjkB,KAAK+jB,GAAGE,SAAS,IAClE,GAKPlkB,cACL,YAAe2I,IAAX1I,KAAKzB,QAA8BmK,IAAX1I,KAAK2jB,QAA8Bjb,IAAX1I,KAAK4jB,SACzC5jB,KAAKzB,KAAKyB,KAAK2jB,KAAK3jB,KAAK4jB,KAC7B,GAKP7jB,mBACL,YAAgB2I,IAAZ1I,KAAK6jB,SAAgCnb,IAAZ1I,KAAK8jB,SAAgCpb,IAAZ1I,KAAK+jB,UAC3C/jB,KAAK6jB,MAAM7jB,KAAK8jB,MAAM9jB,KAAK+jB,MAC/B,GAKPhkB,eACL,YAAe2I,IAAX1I,KAAKzB,QAA8BmK,IAAX1I,KAAK2jB,QAA8Bjb,IAAX1I,KAAK4jB,GAC9CrlB,EAAKyB,KAAKzB,EAAGolB,EAAK3jB,KAAK2jB,EAAGC,EAAK5jB,KAAK4jB,MAM1C7jB,oBACL,YAAe2I,IAAX1I,KAAKzB,QAA8BmK,IAAX1I,KAAK2jB,QAA8Bjb,IAAX1I,KAAK4jB,GAC9CrlB,EAAKyB,KAAK6jB,GAAIF,EAAK3jB,KAAK8jB,GAAIF,EAAK5jB,KAAK+jB,OAM5ChkB,KAAKmkB,GACVlkB,KAAK0jB,GAAKQ,EAAMR,GAChB1jB,KAAKzB,EAAI2lB,EAAM3lB,EACfyB,KAAK2jB,EAAIO,EAAMP,EACf3jB,KAAK4jB,EAAIM,EAAMN,EACf5jB,KAAK6jB,GAAKK,EAAML,GAChB7jB,KAAK8jB,GAAKI,EAAMJ,GAChB9jB,KAAK+jB,GAAKG,EAAMH,GAKXhkB,QACL,OAAO,IAAI0jB,GAAKzjB,KAAK0jB,GAAI1jB,KAAKzB,EAAGyB,KAAK2jB,EAAG3jB,KAAK4jB,EAAG5jB,KAAK6jB,GAAI7jB,KAAK8jB,GAAI9jB,KAAK+jB,KASrE,MAEMI,GAAW,eACXC,GAAW,IAAIX,GAFJ,KClEjB,MCrFDY,GAAgB,ynBAwBhBC,GAAkB,2QAwUjB,MAAMC,GAAgB,SAASC,GACpC,OAAO,UAlSPzkB,YAAoB0kB,GAIlB,GAJkBzkB,KAAAykB,OAClBzkB,KAAKykB,KAAOA,EACZzkB,KAAK0kB,OAASC,SAASC,cAAc,WAEhC5kB,KAAK0kB,OAAOG,WAAY,KAAK,uBAElC,GADA7kB,KAAK8kB,GAAK9kB,KAAK0kB,OAAOG,WAAW,uBAC5B7kB,KAAK8kB,GAAI,KAAK,sBAuBnB,GAtBAL,EAAKM,KAAKC,YAAYhlB,KAAK0kB,QAE3B1kB,KAAKilB,WACLjlB,KAAKklB,aACLllB,KAAKmlB,eAAkB5mB,EAAG,EAAKolB,EAAG,EAAKC,EAAG,EAAKC,GAAI,EAAKC,GAAI,EAAKC,GAAI,GAErE/jB,KAAKolB,SACHC,UAAaC,OAAQ,KAAM1pB,KAAM,KAAM2pB,SAAU,EAAGC,SAAU,KAAMC,KAAMzlB,KAAK8kB,GAAGY,aAClFC,UAAaL,OAAQ,KAAM1pB,KAAM,KAAM2pB,SAAU,EAAGC,SAAU,KAAMC,KAAMzlB,KAAK8kB,GAAGY,aAClFE,OAAaN,OAAQ,KAAM1pB,KAAM,KAAM2pB,SAAU,EAAGC,SAAU,KAAMC,KAAMzlB,KAAK8kB,GAAGe,cAClFC,SAAaR,OAAQ,KAAM1pB,KAAM,KAAM2pB,SAAU,EAAGC,SAAU,KAAMC,KAAMzlB,KAAK8kB,GAAGe,cAClFE,WAAaT,OAAQ,KAAM1pB,KAAM,KAAM2pB,SAAU,EAAGC,SAAU,KAAMC,KAAMzlB,KAAK8kB,GAAGe,eAK/E7lB,KAAKgmB,YACRhmB,KAAKgmB,UAAYrB,SAASC,cAAc,WAC1C5kB,KAAKgmB,UAAUC,MAAMZ,SAAW,WAChCrlB,KAAKgmB,UAAUC,MAAMC,IAAM,MAC3BlmB,KAAKgmB,UAAUC,MAAMlI,KAAO,MAC5B/d,KAAKmmB,IAAMnmB,KAAKgmB,UAAUnB,WAAW,OAChC7kB,KAAKmmB,IAAK,KAAM,qDAErBnmB,KAAKomB,cACLpmB,KAAK0kB,OAAO9iB,OAAS6iB,EAAK4B,SAAWrmB,KAAKsmB,GAAKtmB,KAAKumB,IAAM9B,EAAKzjB,EAC/DhB,KAAK0kB,OAAO7iB,OAAS7B,KAAKsmB,GAAK7B,EAAKxjB,EACpCjB,KAAKgmB,UAAUpkB,MAAQ,EACvB5B,KAAKgmB,UAAUnkB,OAAS,EAExB7B,KAAKomB,cAELpmB,KAAK8kB,GAAGN,SAAS,EAAG,EAAGxkB,KAAK0kB,OAAO9iB,MAAO5B,KAAK0kB,OAAO7iB,QAEtD,IAAI2kB,EAAexmB,KAAKymB,cAAczmB,KAAK8kB,GAAGT,cAAeA,IACzDqC,EAAiB1mB,KAAKymB,cAAczmB,KAAK8kB,GAAGR,gBAAiBA,IAC7DqC,EAAU3mB,KAAK8kB,GAAG8B,gBAOtB,GANA5mB,KAAK8kB,GAAG+B,aAAaF,EAASH,GAC9BxmB,KAAK8kB,GAAG+B,aAAaF,EAASD,GAC9B1mB,KAAK8kB,GAAGgC,YAAYH,GACpB3mB,KAAK8kB,GAAGiC,aAAaP,GACrBxmB,KAAK8kB,GAAGiC,aAAaL,IACV1mB,KAAK8kB,GAAGkC,oBAAoBL,EAAS3mB,KAAK8kB,GAAGmC,aAC/C,CACP,MAAMC,4BAAgClnB,KAAK8kB,GAAGqC,kBAAkBR,KAEhE,MADA3mB,KAAK8kB,GAAGsC,cAAcT,GAChBO,EAERlnB,KAAK8kB,GAAGuC,WAAWV,GAGnB3mB,KAAKolB,QAAQC,SAASG,SAAYxlB,KAAK8kB,GAAGwC,kBAAkBX,EAAS,YACrE3mB,KAAKolB,QAAQO,SAASH,SAAYxlB,KAAK8kB,GAAGwC,kBAAkBX,EAAS,YACrE3mB,KAAKolB,QAAQQ,MAAMJ,SAAexlB,KAAK8kB,GAAGwC,kBAAkBX,EAAS,SACrE3mB,KAAKolB,QAAQU,QAAQN,SAAaxlB,KAAK8kB,GAAGwC,kBAAkBX,EAAS,WACrE3mB,KAAKolB,QAAQW,UAAUP,SAAWxlB,KAAK8kB,GAAGwC,kBAAkBX,EAAS,aAGrE3mB,KAAKunB,cACL,IAAIC,EAAqBxnB,KAAK8kB,GAAG2C,mBAAmBd,EAAS,eAC7D3mB,KAAK8kB,GAAG4C,UAAUF,EAAoBxnB,KAAK0kB,OAAO9iB,MAAO5B,KAAK0kB,OAAO7iB,QACrE7B,KAAK2nB,mBAAqB3nB,KAAK8kB,GAAG2C,mBAAmBd,EAAS,eAC9D3mB,KAAK8kB,GAAG4C,UAAU1nB,KAAK2nB,mBAAoB3nB,KAAKykB,KAAKzjB,EAAGhB,KAAKykB,KAAKxjB,GAClEjB,KAAK4nB,gBAAkB5nB,KAAK8kB,GAAG2C,mBAAmBd,EAAS,YAC3D3mB,KAAK8kB,GAAG4C,UAAU1nB,KAAK4nB,gBAAiB,EAAK,GAI7C,IAAIC,EAAU7nB,KAAK8kB,GAAGgD,gBACtB9nB,KAAK8kB,GAAGiD,YAAY/nB,KAAK8kB,GAAGkD,WAAYH,GACxC7nB,KAAKioB,WAAW,oGAChBjoB,KAAK8kB,GAAGoD,cAAcloB,KAAK8kB,GAAGkD,WAAYhoB,KAAK8kB,GAAGqD,mBAAoBnoB,KAAK8kB,GAAGsD,SAC9EpoB,KAAK8kB,GAAGoD,cAAcloB,KAAK8kB,GAAGkD,WAAYhoB,KAAK8kB,GAAGuD,mBAAoBroB,KAAK8kB,GAAGsD,SAC9EpoB,KAAK8kB,GAAGoD,cAAcloB,KAAK8kB,GAAGkD,WAAYhoB,KAAK8kB,GAAGwD,eAAgBtoB,KAAK8kB,GAAGyD,eAC1EvoB,KAAK8kB,GAAGoD,cAAcloB,KAAK8kB,GAAGkD,WAAYhoB,KAAK8kB,GAAG0D,eAAgBxoB,KAAK8kB,GAAGyD,eAC1EvoB,KAAK8kB,GAAG2D,cAAczoB,KAAK8kB,GAAG4D,UAE9BC,WAAW,KACT3oB,KAAKomB,cACLpmB,KAAK4oB,eACL5oB,KAAK6oB,UACJ,KAGE9oB,oBAA8B,MAAO,QAEpCA,eACN,IAAIiB,EAAIhB,KAAKgmB,UAAUpkB,OAAS5B,KAAKumB,GAAKvmB,KAAK8oB,KACzC7nB,EAAIjB,KAAKgmB,UAAUnkB,QAAU7B,KAAKsmB,GAAKtmB,KAAK8oB,KAElD,MAAMC,EAAY/oB,KAAKklB,UAAU9oB,OAC7B2sB,EAAYvnB,KAAKC,MAAMT,GAAKQ,KAAKC,MAAMR,KAEzCA,GADAD,EAAIQ,KAAK6b,KAAK7b,KAAKwnB,KAAKD,KAChB,EACR/oB,KAAKgmB,UAAUpkB,MAAQZ,GAAKhB,KAAKumB,GAAKvmB,KAAK8oB,KAC3C9oB,KAAKgmB,UAAUnkB,OAASZ,GAAKjB,KAAKsmB,GAAKtmB,KAAK8oB,KAC5C9oB,KAAKomB,cACLpmB,KAAK8kB,GAAG4C,UAAU1nB,KAAK2nB,mBAAoB3mB,EAAGC,IAEhDjB,KAAK8kB,GAAG4C,UAAU1nB,KAAK4nB,gBAAiB5nB,KAAK8oB,IAAM9oB,KAAKgmB,UAAUpkB,MAAO5B,KAAK8oB,IAAM9oB,KAAKgmB,UAAUnkB,QAEnG,IAAW6hB,EAAP3lB,EAAI,EACRiC,KAAKmmB,IAAI8C,UAAY,UACrBjpB,KAAKmmB,IAAI+C,SAAS,EAAG,EAAGlpB,KAAKgmB,UAAUpkB,MAAO5B,KAAKgmB,UAAUnkB,QAC7D7B,KAAKmmB,IAAI8C,UAAY,UAErB,MAAME,EAAU,GAAMnpB,KAAKopB,IACrB7C,EAAKvmB,KAAKumB,GAAKvmB,KAAK8oB,IACpBxC,EAAKtmB,KAAKsmB,GAAKtmB,KAAK8oB,IAC1B,IAAI/nB,EAAI,GAAMulB,EACd,IAAK,IAAIlpB,EAAI,EAAGA,EAAI6D,IAAK7D,EAAG,CAC1B,IAAI0D,EAAe,GAAXd,KAAK8oB,IACb,IAAK,IAAI5sB,EAAI,EAAGA,EAAI8E,QAEP0H,KADXgb,EAAK1jB,KAAKklB,UAAUnnB,MADG7B,IAAK6B,EAG5BiC,KAAKmmB,IAAIkD,SAAS3F,EAAI5iB,EAAIqoB,EAASpoB,GACnCD,GAAKylB,EAEP,IAAK7C,EAAI,MACT3iB,GAAKulB,EAEPtmB,KAAK8kB,GAAGwE,WAAWtpB,KAAK8kB,GAAGkD,WAAY,EAAGhoB,KAAK8kB,GAAGyE,KAAMvpB,KAAK8kB,GAAGyE,KAAMvpB,KAAK8kB,GAAG0E,cAAexpB,KAAKgmB,WAG5FjmB,WAAW0pB,EAAeC,GAAiB,GACjD,IAAK1pB,KAAK8kB,GAAI,OACd,IAAI6E,GAAU,EACd,IAAK,IAAIztB,EAAI,EAAGA,EAAIutB,EAAMrtB,SAAUF,EAC7B8D,KAAKilB,QAAQwE,EAAMvtB,MACtBytB,GAAU,EACV3pB,KAAKklB,UAAU5oB,KAAKmtB,EAAMvtB,IAC1B8D,KAAKilB,QAAQwE,EAAMvtB,IAAM8D,KAAKklB,UAAU9oB,OAAS,GAIjDutB,GAAWD,GAAO1pB,KAAK4oB,eAGtB7oB,YAAYvC,GACjBA,EAAIA,GAAK+B,OAAOqqB,iBAAiB5pB,KAAKykB,KAAKM,KAAM,MACjD/kB,KAAKmmB,IAAI0D,KAAOrsB,EAAEssB,SAAW,IAAMtsB,EAAEusB,WAAa,IAAMvsB,EAAEwsB,WAC1DhqB,KAAKmmB,IAAI8D,aAAe,SACxBjqB,KAAKmmB,IAAI8C,UAAY,UACrBjpB,KAAKumB,GAAKvmB,KAAKmmB,IAAI+D,YAAY,KAAKtoB,MACpC5B,KAAKsmB,GAAKxK,SAASte,EAAEssB,SAAU,IAC/B9pB,KAAKopB,IAAMppB,KAAKykB,KAAK4B,SAAYrmB,KAAKsmB,GAAKtmB,KAAKumB,GAAM,EAClDvmB,KAAKykB,KAAK4B,WAAUrmB,KAAKumB,GAAKvmB,KAAKsmB,IACvCtmB,KAAK8oB,IAAiC,EAA3BtnB,KAAK6b,KAAe,GAAVrd,KAAKsmB,IAE1B,MAAMV,EAAQpoB,EAAEooB,MAAMre,MAAM,QACtBue,EAAUtoB,EAAE2sB,gBAAgB5iB,MAAM,QACxCvH,KAAKmlB,cAAc5mB,EAAIud,SAAS8J,EAAM,GAAI,IAAM,IAChD5lB,KAAKmlB,cAAcxB,EAAI7H,SAAS8J,EAAM,GAAI,IAAM,IAChD5lB,KAAKmlB,cAAcvB,EAAI9H,SAAS8J,EAAM,GAAI,IAAM,IAChD5lB,KAAKmlB,cAActB,GAAK/H,SAASgK,EAAQ,GAAI,IAAM,IACnD9lB,KAAKmlB,cAAcrB,GAAKhI,SAASgK,EAAQ,GAAI,IAAM,IACnD9lB,KAAKmlB,cAAcpB,GAAKjI,SAASgK,EAAQ,GAAI,IAAM,IAG9C/lB,SAEAA,SACLC,KAAK8kB,GAAGsF,MAAMpqB,KAAK8kB,GAAGuF,kBACtB,MAAMrpB,EAAIhB,KAAKykB,KAAKzjB,EAClBC,EAAIjB,KAAKykB,KAAKxjB,EAGhB,IAAIqpB,EAAQtqB,KAAKykB,KAAKa,OAGlBiF,GAFevqB,KAAKykB,KAAK+F,aACRxqB,KAAKykB,KAAKgG,mBAChB,GAEf,IAAK,IAAIrtB,EAAI,EAAGA,EAAI6D,IAAK7D,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAI8E,IAAK9E,EAAG,CAC1B,MAAM0G,EAAO0nB,EAAMltB,GAAGlB,GACtB,IAAIwnB,EAAK1jB,KAAKilB,QAAQriB,EAAK8gB,SAChBhb,IAAPgb,IACF1jB,KAAKioB,WAAWrlB,EAAK8gB,IAAI,GACzB6G,GAAW,EACX7G,EAAK1jB,KAAKilB,QAAQriB,EAAK8gB,KAEzB,MAAMgH,EAAkC,EAA9B1qB,KAAKolB,QAAQQ,MAAML,UAAgBnoB,EAAI4D,EAAI9E,GAC/CyuB,EAAuC,EAAlC3qB,KAAKolB,QAAQW,UAAUR,UAAgBnoB,EAAI4D,EAAI9E,GACpDqC,OAAemK,IAAX9F,EAAKrE,EAAkByB,KAAKmlB,cAAc5mB,EAAIqE,EAAKrE,EAAI,IAC3DolB,OAAejb,IAAX9F,EAAK+gB,EAAkB3jB,KAAKmlB,cAAcxB,EAAI/gB,EAAK+gB,EAAI,IAC3DC,OAAelb,IAAX9F,EAAKghB,EAAkB5jB,KAAKmlB,cAAcvB,EAAIhhB,EAAKghB,EAAI,IAC3DC,OAAiBnb,IAAZ9F,EAAKihB,GAAmB7jB,KAAKmlB,cAActB,GAAKjhB,EAAKihB,GAAK,IAC/DC,OAAiBpb,IAAZ9F,EAAKkhB,GAAmB9jB,KAAKmlB,cAAcrB,GAAKlhB,EAAKkhB,GAAK,IAC/DC,OAAiBrb,IAAZ9F,EAAKmhB,GAAmB/jB,KAAKmlB,cAAcpB,GAAKnhB,EAAKmhB,GAAK,IACrE,IAAK,IAAIjmB,EAAI,EAAGA,EAAI,IAAKA,EAAG,CAC1B,MAAMoB,EAAIwrB,EAAI5sB,EAAIkC,KAAKolB,QAAQQ,MAAML,SACrCvlB,KAAKolB,QAAQQ,MAAMhqB,KAAKsD,EAAI,GAAKX,EACjCyB,KAAKolB,QAAQQ,MAAMhqB,KAAKsD,EAAI,GAAKykB,EACjC3jB,KAAKolB,QAAQQ,MAAMhqB,KAAKsD,EAAI,GAAK0kB,EACjC5jB,KAAKolB,QAAQU,QAAQlqB,KAAKsD,EAAI,GAAK2kB,EACnC7jB,KAAKolB,QAAQU,QAAQlqB,KAAKsD,EAAI,GAAK4kB,EACnC9jB,KAAKolB,QAAQU,QAAQlqB,KAAKsD,EAAI,GAAK6kB,EACnC/jB,KAAKolB,QAAQW,UAAUnqB,KAAK+uB,EAAK7sB,GAAK4lB,GAMxC6G,GAAUvqB,KAAK4oB,eACnB5oB,KAAK8kB,GAAG8F,WAAW5qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQQ,MAAMN,QAC5DtlB,KAAK8kB,GAAGgG,WAAW9qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQQ,MAAMhqB,KAAMoE,KAAKolB,QAAQQ,MAAMH,MACrFzlB,KAAK8kB,GAAG8F,WAAW5qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQU,QAAQR,QAC9DtlB,KAAK8kB,GAAGgG,WAAW9qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQU,QAAQlqB,KAAMoE,KAAKolB,QAAQU,QAAQL,MACzFzlB,KAAK8kB,GAAG8F,WAAW5qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQW,UAAUT,QAChEtlB,KAAK8kB,GAAGgG,WAAW9qB,KAAK8kB,GAAG+F,aAAc7qB,KAAKolB,QAAQW,UAAUnqB,KAAMoE,KAAKolB,QAAQW,UAAUN,MAE7F,MAAMsF,EAAS/qB,KAAKolB,QAAQC,SAC5BrlB,KAAK8kB,GAAGkG,WAAWhrB,KAAK8kB,GAAGmG,UAAW,EAAGF,EAAOnvB,KAAKQ,OAAS2uB,EAAOxF,UAI/DxlB,cAAcsS,EAAc6Y,GAClC,MAAMC,EAASnrB,KAAK8kB,GAAGsG,aAAa/Y,GAIpC,GAHArS,KAAK8kB,GAAGuG,aAAaF,EAAQD,GAC7BlrB,KAAK8kB,GAAG2B,cAAc0E,IACXnrB,KAAK8kB,GAAGwG,mBAAmBH,EAAQnrB,KAAK8kB,GAAGyG,gBAC7C,CACP,MAAMrE,EAAM,2BAA6BlnB,KAAK8kB,GAAG0G,iBAAiBL,GAElE,MADAnrB,KAAK8kB,GAAGiC,aAAaoE,GACfjE,EAER,OAAOiE,EAGDprB,cACN,IAAI0rB,EAAGV,EAAQ3F,EAAUplB,KAAKolB,QAE9B,MAAMpkB,EAAIhB,KAAKykB,KAAKzjB,EACdC,EAAIjB,KAAKykB,KAAKxjB,EAGpB,IAAKwqB,KAAKzrB,KAAKolB,SACb2F,EAAS3F,EAAQqG,IACV7vB,KAAO,IAAI8vB,aAA+B,EAAlBX,EAAOxF,SAAevkB,EAAIC,GAG3D,IAAK,IAAI7D,EAAI,EAAGA,EAAI6D,IAAK7D,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAI8E,IAAK9E,EAAG,CAE1B,MAAMwuB,EAAgC,EAA5BtF,EAAQC,SAASE,UAAgBnoB,EAAI4D,EAAI9E,GACnD8D,KAAK2rB,WAAWvG,EAAQC,SAASzpB,KAAM8uB,EAAGxuB,EAAI8D,KAAKumB,GAAInpB,EAAI4C,KAAKsmB,GAAItmB,KAAKumB,GAAIvmB,KAAKsmB,IAClFtmB,KAAK2rB,WAAWvG,EAAQO,SAAS/pB,KAAM8uB,EAAG,EAAK,EAAK,EAAK,GAI7D,IAAKe,KAAKzrB,KAAKolB,SACb2F,EAAS3F,EAAQqG,IACNnG,QAAQtlB,KAAK8kB,GAAG8G,aAAab,EAAOzF,QAC/CyF,EAAOzF,OAAStlB,KAAK8kB,GAAG+G,eACxB7rB,KAAK8kB,GAAG8F,WAAW5qB,KAAK8kB,GAAG+F,aAAcE,EAAOzF,QAChDtlB,KAAK8kB,GAAGgG,WAAW9qB,KAAK8kB,GAAG+F,aAAcE,EAAOnvB,KAAMmvB,EAAOtF,MAC7DzlB,KAAK8kB,GAAGgH,wBAAwBf,EAAOvF,UACvCxlB,KAAK8kB,GAAGiH,oBAAoBhB,EAAOvF,SAAUuF,EAAOxF,SAAUvlB,KAAK8kB,GAAGkH,OAAO,EAAO,EAAG,GAInFjsB,WAAWksB,EAAe/vB,EAAW4E,EAAWC,EAAWC,EAAWC,GAC5E,MAAMoC,EAAKvC,EACLyC,EAAKxC,EACLmrB,EAAKprB,EAAIE,EACTmrB,EAAKprB,EAAIE,EAEfgrB,EAAM/vB,GAAKmH,EACX4oB,IAAM/vB,GAAKqH,EACX0oB,IAAM/vB,GAAKgwB,EACXD,IAAM/vB,GAAKqH,EACX0oB,IAAM/vB,GAAKmH,EACX4oB,IAAM/vB,GAAKiwB,EACXF,IAAM/vB,GAAKmH,EACX4oB,IAAM/vB,GAAKiwB,EACXF,IAAM/vB,GAAKgwB,EACXD,IAAM/vB,GAAKqH,EACX0oB,IAAM/vB,GAAKgwB,EACXD,IAAM/vB,GAAKiwB,IAKY3H,IC5VrB4H,GAAuB,IACvBC,GAAyB,IACzBC,IAAgB/tB,EAAG,IAAKolB,EAAG,IAAKC,EAAG,SAEnC2I,WAA2B9I,GACxB1jB,QAAQoO,GACb,OAAOnO,KAGTD,YAAY0T,EAAclV,EAAI6tB,GAAczI,EAAIyI,GAAcxI,EAAIwI,IAChEpmB,MAAMyN,EAAMlV,EAAGolB,EAAGC,GAGV7jB,cAAc6C,EAAYuL,GAMlC,OALAvL,EAAK4pB,cACHF,GAAY/tB,EAAI4P,EAChBme,GAAY3I,EAAIxV,EAChBme,GAAY1I,EAAIzV,GAEXvL,EAGC7C,SAAS6C,EAAYuL,GAM7B,OALAvL,EAAK6pB,SACHH,GAAY/tB,EAAI4P,EAChBme,GAAY3I,EAAIxV,EAChBme,GAAY1I,EAAIzV,GAEXvL,SAIX8pB,WAAqCH,GACnCxsB,YAAY0T,GACVzN,MAAMyN,EAAM4Y,GAAgBA,GAAgBA,WAI1CM,WAA4BD,GAChC3sB,YACE0T,EACOmZ,EACAC,EACAC,GAEP9mB,MAAMyN,GAJCzT,KAAA4sB,KACA5sB,KAAA6sB,KACA7sB,KAAA8sB,KAKF/sB,QAAQoO,GACb,IAAIvL,EAAO5C,KAAKqa,QAGhB,OAFAzX,EAAK6pB,SAASzsB,KAAK4sB,GAAI5sB,KAAK6sB,GAAI7sB,KAAK8sB,IAE9BlqB,SAsDLmqB,WAAwBR,GAC5BxsB,YACE0T,EACOmZ,EACAC,EACAC,GAEP9mB,MAAMyN,GAJCzT,KAAA4sB,KACA5sB,KAAA6sB,KACA7sB,KAAA8sB,KAKF/sB,QAAQoO,GACb,IAAIvL,EAAO5C,KAAKqa,QAGhB,OAFAzX,EAAK6pB,SAASzsB,KAAK4sB,GAAI5sB,KAAK6sB,GAAI7sB,KAAK8sB,IAE9BlqB,GAIX,MAAMoqB,GAAS,IAAID,GAAS,IAAK,IAAK,IAAK,KACrCE,GAAS,IAAIF,GAAS,IAAK,IAAK,IAAK,KACrCG,GAAa,IAAIH,GAAS,IAAK,IAAK,IAAK,KACzCI,GAAU,IAAIJ,GAAS,IAAK,IAAK,IAAK,KAE/BK,GAAc,SAASzlB,GAClC,OAAQA,EAAKlC,OACX,KAAKH,EAAUsB,cACb,OAAOomB,GACT,KAAK1nB,EAAUW,WACb,OAAOgnB,GACT,KAAK3nB,EAAUoB,UACb,OAAOwmB,GACT,KAAK5nB,EAAUkB,QACb,OAAO2mB,GACT,QACE,sBAAuBxlB,eAAkBA,EAAKlC,UC1BpD,ICzHkK4nB,GDyHnJ1tB,EAAA,EAAIC,QACjB3B,KAAM,QACN4B,OAAQ,YACRC,YAEAgjB,SACE/iB,OAAOgM,GACL,OAAIA,aAAcuJ,GACT,SAELvJ,aAAc+I,GACT,UAEL/I,aAAc4F,EACT,SAEL5F,aAAciJ,GACT,WAELjJ,2BEzIkB0C,EAC1B1O,IAAIiI,IAEGjI,UAAUiI,GACf,OAAO,IFsII,SAEL+D,aAAcyJ,GACT,SAELzJ,aAAc4I,kBACM3U,KAAKstB,OAAOvhB,EAAG0G,YAEnC1G,aAAcgF,EACT,WAELhF,aAAc2K,GACT,aAEL3K,aAAcqJ,GACT,SAELrJ,aAAc2J,GACT,eADT,GAIF3V,YAAY4H,GACV,GAAIA,EACF,SAAUylB,GAAYzlB,GAAM4lB,aAAa5lB,EAAK1J,QAGlDuvB,iBAAiBC,GACXA,EAAU7iB,gBAAkB6iB,EAAUlX,aAC9BkX,EAAU7iB,mBAAmB6iB,EAAUlX,aAE1CkX,EAAU7iB,eAGrB7K,8BAA8B0tB,GAC5B,GAAIA,EAAU7iB,gBAAkB6iB,EAAUlX,UAAW,CACnD,MAAMmX,EAAOD,EAAU5a,UAAUvQ,IAAIxB,GAAKA,EAAI,OAASA,SAAWA,KAClE,SAAU2sB,EAAU7iB,qBAAqB6iB,EAAUlX,cAAcmX,IAEjE,OAAOD,EAAU7iB,gBAGrB7K,aAAaqN,GACX,IAAIugB,KAUJ,OARAvgB,EAAM1K,QAAQiF,IACRgmB,EAAQhmB,EAAK1J,MACf0vB,EAAQhmB,EAAK1J,OAAS,EAEtB0vB,EAAQhmB,EAAK1J,MAAQ,IAIlB0vB,GAET5tB,gBAAgBsH,GACd,OAAQA,GACN,KAAK9B,EAAS2G,SAEd,KAAK3G,EAASwB,UACZ,MAAO,IACT,KAAKxB,EAAS4G,KACZ,MAAO,IACT,KAAK5G,EAAS6G,OACZ,MAAO,IACT,KAAK7G,EAAS8G,KACZ,MAAO,IACT,KAAK9G,EAAS+G,IACZ,MAAO,IACT,KAAK/G,EAASgH,KACZ,MAAO,IACT,KAAKhH,EAASiH,KACZ,MAAO,IACT,KAAKjH,EAASyB,KACZ,MAAO,IACT,KAAKzB,EAASkH,cACZ,MAAO,gBACT,KAAKlH,EAASiB,QACZ,MAAO,UACT,QACE,yBAA0Ba,SG1MpCumB,GAXArxB,OAAAgE,EAAA,EAAAhE,CACA8wB,GCRA,WAA0B,IAAAnK,EAAAljB,KAAaQ,EAAA0iB,EAAAziB,eAA0BE,EAAAuiB,EAAAxiB,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,MAAgByiB,YAAA,cAAwBziB,EAAA,MAAWyiB,YAAA,aAAuBF,EAAAtiB,GAAA,kBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAgDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA9c,SAAAT,IAAA,UAAAud,EAAAtiB,GAAA,KAAAD,EAAA,MAAyEyiB,YAAA,aAAuBF,EAAAtiB,GAAA,mBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAiDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA9c,SAAAyG,KAAA,UAAAqW,EAAAtiB,GAAA,KAAAD,EAAA,MAA0EyiB,YAAA,aAAuBF,EAAAtiB,GAAA,qBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAmDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA9c,SAAAiD,MAAAuJ,SAAA,KAAAsQ,EAAAM,GAAAN,EAAA9c,SAAAiD,MAAAsT,mBAAA,MAAAuG,EAAAM,GAAAN,EAAA9c,SAAAiD,MAAAwT,oBAAA,WAAAqG,EAAAtiB,GAAA,KAAAD,EAAA,MAA2LyiB,YAAA,aAAuBF,EAAAtiB,GAAA,wBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAsDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAAsK,iBAAAtK,EAAA9c,SAAAC,gBAAAsE,SAAA,UAAAuY,EAAAtiB,GAAA,KAAAD,EAAA,MAAmHyiB,YAAA,aAAuBF,EAAAtiB,GAAA,qBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAmDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA2K,8BAAA3K,EAAA9c,SAAAC,gBAAA8K,SAAA,UAAA+R,EAAAtiB,GAAA,KAAAD,EAAA,MAAgIyiB,YAAA,aAAuBF,EAAAtiB,GAAA,sBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAoDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA2K,8BAAA3K,EAAA9c,SAAAC,gBAAA6M,UAAA,UAAAgQ,EAAAtiB,GAAA,KAAAD,EAAA,MAAiIyiB,YAAA,aAAuBF,EAAAtiB,GAAA,wBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAsDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAA2K,8BAAA3K,EAAA9c,SAAAC,gBAAAkH,QAAA,UAAA2V,EAAAtiB,GAAA,KAAAD,EAAA,MAA+HyiB,YAAA,aAAuBF,EAAAtiB,GAAA,kBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAgDyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAM,GAAAN,EAAAoK,OAAApK,EAAA9c,SAAA2F,KAAA,UAAAmX,EAAAtiB,GAAA,KAAAD,EAAA,MAAqFyiB,YAAA,aAAuBF,EAAAtiB,GAAA,iBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAA+CyiB,YAAA,aAAuBziB,EAAA,QAAAuiB,EAAAG,GAAAH,EAAA9c,SAAA6F,UAAAzE,QAAA,SAAAK,EAAA3L,GAAyE,OAAAyE,EAAA,MAAgB3B,IAAA,WAAA9C,IAAmByE,EAAA,MAAAuiB,EAAAtiB,GAAA,eAAAsiB,EAAAM,GAAAN,EAAA4K,gBAAAjmB,EAAAR,WAAA,gBAAA6b,EAAAtiB,GAAA,KAAAD,EAAA,MAAAuiB,EAAAtiB,GAAA,eAAAsiB,EAAAM,GAAAN,EAAAkK,YAAAvlB,EAAAH,YAAA,uBAAuMwb,EAAAtiB,GAAA,KAAAD,EAAA,MAA0ByiB,YAAA,aAAuBF,EAAAtiB,GAAA,iBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAA+CyiB,YAAA,aAAuBziB,EAAA,KAAAuiB,EAAAG,GAAAH,EAAA6K,aAAA7K,EAAA9c,SAAA6F,UAAAmB,SAAA,SAAA4gB,EAAA/vB,GAAyF,OAAA0C,EAAA,MAAgB3B,IAAAf,IAASilB,EAAAtiB,GAAA,eAAAsiB,EAAAM,GAAAvlB,GAAA,IAAAilB,EAAAM,GAAA,IAAAwK,EAAA,QAAAA,GAAA,mBAAiG9K,EAAAtiB,GAAA,KAAAD,EAAA,MAA0ByiB,YAAA,aAAuBF,EAAAtiB,GAAA,yBAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,MAAuDyiB,YAAA,aAAuBziB,EAAA,KAAAuiB,EAAAG,GAAAH,EAAA9c,SAAA,qBAAAgD,GAAiE,OAAAzI,EAAA,MAAgB3B,IAAAoK,EAAAnL,OAAoBilB,EAAAtiB,GAAA,eAAAsiB,EAAAM,GAAApa,EAAAnL,MAAA,IAAAilB,EAAAM,GAAApa,EAAAC,OAAA,0BDWvuF,EACA,KACA,KACA,cEoDA,MAAM4kB,GAAS,IAAItB,GAAa,IAAK,EAAG,IAAK,GACvCuB,GAAS,IAAIvB,GAAa,IAAK,IAAK,EAAG,GACvCwB,GAAS,IAAIxB,GAAa,IAAK,EAAG,EAAG,KACrCyB,GAAS,IAAIzB,GAAa,IAAK,IAAK,EAAG,KACvC0B,GAAS,IAAI1B,GAAa,IAAK,EAAG,IAAK,KAEvC2B,GAAM,IAAI3B,GAAa,IAAK,IAAK,GAAI,IAErC4B,GAAO,kBNXiBhC,GAC5BxsB,cACEiG,MAAM,KAGDjG,QAAQoO,GACb,IAAIvL,EAAO5C,KAAKqa,QAIhB,OAHAra,KAAKwuB,SAAS5rB,EAAMuL,GACpBvL,EAAK6rB,aAEE7rB,IMEL8rB,GAAO,kBNYiBnC,GAC5BxsB,cACEiG,MAAM,KAGDjG,QAAQoO,GACb,IAAIvL,EAAO5C,KAAKqa,QAIhB,OAHAra,KAAK2uB,cAAc/rB,EAAMuL,GACzBvL,EAAKgsB,oBAEEhsB,IMrBLisB,GAAQ,kBNCiBtC,GAC7BxsB,cACEiG,MAAM,KAGDjG,QAAQoO,GACb,OAAOnO,KAAKwuB,SAASxuB,KAAKqa,QAASlM,KMNjC2gB,GAAgB,kBNwBYvC,GAChCxsB,cACEiG,MAAM,OMzBJ+oB,GAAc,kBN6BYxC,GAC9BxsB,cACEiG,MAAM,OM9BJgpB,GAAW,IAAIzC,GAAY,IAAK,EAAG,EAAG,GAEtC0C,IACJ,IAAIlC,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,MAG9B,ICxFkKmC,GDwFnJvvB,EAAA,EAAIC,QACjBC,OAAQ,QAAS,UACjBjE,KAAI,MAEAuzB,UAAU,EACVC,KAAM,KACNC,IAAK,KACLC,aAAc,KACdvU,GAAIwU,KAAKC,MACTC,IAAK,EACLC,QAAS,EACTC,SAAU,IACVC,UAAU,EACVxgB,KAAM,EACNygB,OAAO,IAGXC,YACEC,MAAAnC,IAEF9K,SACE/iB,QAAQe,EAAGC,GACT,MAAMqY,EAASpZ,KAAKyN,MAAMP,GAAGpM,EAAGC,GAAGqY,OACnC,GAAIA,EACF,OAAO,IAAImT,GAAYnT,EAAQ,IAAK,IAAK,GAG3C,MAAMxW,EAAO5C,KAAKmvB,SAAWnvB,KAAKyN,MAAMP,GAAGpM,EAAGC,GAAKf,KAAKyN,MAAMP,GAAGpM,EAAGC,GAAG6B,KAEvE,IAAKA,EACH,OAAOosB,GAGT,GAAIpsB,EAAKwD,SAAU,CACjB,GAA4B,OAAxBxD,EAAKwD,SAASnI,OAChB,OAAOqwB,GAGT,OAAQ1rB,EAAKwD,SAAST,GAAK,GACzB,KAAK,EACH,OAAO0oB,GACT,KAAK,EACH,OAAOD,GACT,KAAK,EACH,OAAOD,GACT,KAAK,EACH,OAAOD,GACT,KAAK,EACH,OAAOD,IAIb,GAAIrrB,EAAKuK,MAAM/Q,OAAQ,CACrB,GAA0B,IAAtBwG,EAAKuK,MAAM/Q,OACb,OAAOgxB,GAAYxqB,EAAKuK,MAAM,IAGhC,MAAM6iB,EAAQhwB,KAAKoP,MAA4B,EAApBpP,KAAKiwB,aAAmB,GACnD,GAAID,EAAQf,GAAkB7yB,OAC5B,OAAO6yB,GAAkBe,GACpB,CACL,MAAME,EAAS1uB,KAAKC,MAAMzB,KAAKoP,MAA4B,EAApBpP,KAAKiwB,aAAmB,IAE/D,OAAO7C,GAAYxqB,EAAKuK,MAAM+iB,EAASttB,EAAKuK,MAAM/Q,UAItD,OAAQwG,EAAKvC,SACb,IAAK,IACH,OAAOquB,GACT,IAAK,IACH,OAAOH,GACT,IAAK,IACH,OAAOM,GACT,IAAK,IACH,OAAOE,GACT,IAAK,IACH,OAAOD,GACT,QACE,OAAOE,KAGXjvB,eACEC,KAAKovB,KAAO,UTqBhBrvB,YACSglB,EACA/jB,EACAC,EACPkvB,EACO9J,GAAoB,GAJpBrmB,KAAA+kB,OACA/kB,KAAAgB,IACAhB,KAAAiB,IAEAjB,KAAAqmB,WAEPrmB,KAAKowB,GAAK5uB,KAAKC,MAAMT,EAAI,GACzBhB,KAAKqwB,GAAK7uB,KAAKC,MAAMR,EAAI,GAEzBjB,KAAK+kB,KAAKuL,UAAY,IAGoB,IAAtCvL,EAAKwL,UAAUC,QAAQrM,MACK,IAA1BY,EAAKwL,UAAUn0B,OACjB2oB,EAAKwL,UAAYpM,GAEdY,EAAKwL,WAAa,IAAMpM,IAI/BnkB,KAAKslB,OAAS,IAAIvjB,MAAMd,GACxB,IAAK,IAAI7D,EAAI,EAAGA,EAAI6D,IAAK7D,EAAG,CAC1B4C,KAAKslB,OAAOloB,GAAK,IAAI2E,MAAMf,GAC3B,IAAK,IAAI9E,EAAI,EAAGA,EAAI8E,IAAK9E,EACvB8D,KAAKslB,OAAOloB,GAAGlB,GAAKkoB,GAIxBpkB,KAAKmwB,SAAWA,EAASnwB,MAKnBD,YAAY0wB,GAClB,MAAMjzB,EAAI+B,OAAOqqB,iBAAiB5pB,KAAK+kB,KAAM,MAE7C/kB,KAAKwqB,aAAehtB,EAAEooB,YAASld,EAC/B1I,KAAKyqB,kBAAoBjtB,EAAE2sB,sBAAmBzhB,EAC1C+nB,GACFzwB,KAAKmwB,SAAS/J,YAAY5oB,GASvBuC,oBACL,OAAOC,KAAKmwB,SAASO,oBAWhB3wB,IAAI6C,EAAY9B,EAAWC,GAC5BD,EAAI,GAAKC,EAAI,GAAKD,GAAKd,KAAKgB,GAAKD,GAAKf,KAAKiB,IAC/CjB,KAAKslB,OAAOvkB,GAAGD,GAAK8B,GAWf7C,UAAU6C,EAAY9B,EAAWC,GACtCf,KAAKslB,OAAOvkB,GAAGD,GAAK8B,EAiBf7C,UACL4wB,EACA7vB,EACAC,EACAxC,EACAolB,EACAC,EACAC,EACAC,EACAC,GAEA,MAAM6M,EAAMD,EAAIv0B,OAChB,KAAI0E,EAAI,GAAKC,EAAI,GAEjB,IAAK,IAAI7E,EAAI,EAAGA,EAAI00B,IAAO10B,EAAG,CAK5B,GAJI4E,GAAKd,KAAKgB,IACZF,EAAI,IACFC,GAEAA,GAAKf,KAAKiB,EAAG,OAEjB,MAAM2B,EAAO,IAAI6gB,GAAKkN,EAAIz0B,GAAIqC,EAAGolB,EAAGC,EAAGC,EAAIC,EAAIC,GAC/C/jB,KAAK6wB,UAAUjuB,EAAM9B,EAAGC,KACtBD,GAcCf,IAAIe,EAAWC,GACpB,OAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKd,KAAKgB,GAAKD,GAAKf,KAAKiB,EAAUmjB,GAClDpkB,KAAKslB,OAAOvkB,GAAGD,GAKjBf,QACL,IAAK,IAAI3C,EAAI,EAAGA,EAAI4C,KAAKiB,IAAK7D,EAC5B,IAAK,IAAIlB,EAAI,EAAGA,EAAI8D,KAAKgB,IAAK9E,EAC5B8D,KAAKslB,OAAOloB,GAAGlB,GAAKkoB,GAGxBpkB,KAAKmwB,SAAS/F,QAKTrqB,SACLC,KAAKmwB,SAAStH,WSxKV7oB,KAAK8wB,MAAMC,MACX/wB,KAAKqJ,MAAMzH,MACX5B,KAAKqJ,MAAMxH,OACX0iB,IACA,GAGFvkB,KAAKqvB,IAAM,UTiMftvB,YACSykB,EACAwM,EACAhwB,EACAC,GAHAjB,KAAAwkB,WACAxkB,KAAAgxB,WACAhxB,KAAAgB,IACAhB,KAAAiB,IA7BDjB,KAAAixB,cAAwB,EACxBjxB,KAAAkxB,cAAwB,EAGxBlxB,KAAAmxB,mBAA6B,EAI7BnxB,KAAAoxB,OAAiB,EACjBpxB,KAAAqxB,OAAiB,EAuBvBrxB,KAAKsxB,UAAY,IAAIvvB,MAAMyiB,EAASvjB,GACpCjB,KAAKuxB,WAAa,IAAIxvB,MAAMyiB,EAASvjB,GAErC,IAAK,IAAI7D,EAAI,EAAGA,EAAIonB,EAASvjB,IAAK7D,EAChC4C,KAAKsxB,UAAUl0B,GAAK,IAAI2E,MAAMyiB,EAASxjB,GACvChB,KAAKuxB,WAAWn0B,GAAK,IAAI2E,MAAMyiB,EAASxjB,GAarCjB,YAAYyxB,EAAsCpY,EAAiBqY,GACpErY,IACFpZ,KAAK0xB,gBAAahpB,EACI,iBAAX0Q,IACM,UAAXA,EAAoBpZ,KAAK0xB,WAAa,SAAS5wB,EAAGC,EAAGC,EAAGC,EAAG0wB,EAAOC,EAAOC,GAC3E,MAAMC,EAAY,GAAJ9wB,EAAS+wB,EAAY,GAAJ9wB,EAG/B,OAFAH,GAAKgxB,EACL/wB,GAAKgxB,EACDvwB,KAAKY,IAAItB,GAAKgxB,EAAQD,GAAUrwB,KAAKY,IAAIrB,GAAKgxB,EAAQF,EAAeF,EAC7DC,GAEM,WAAXxY,EAAqBpZ,KAAK0xB,WAAa,SAAS5wB,EAAGC,EAAGC,EAAGC,EAAG0wB,EAAOC,EAAOC,GACjF,MAAMC,EAAY,GAAJ9wB,EAAS+wB,EAAY,GAAJ9wB,EAI/B,OAHAH,GAAKgxB,EACL/wB,GAAKgxB,EACLF,EAAS,EAAMA,EACXrwB,KAAKY,IAAItB,GAAKgxB,EAAQD,GAAUrwB,KAAKY,IAAIrB,GAAKgxB,EAAQF,EAAeD,EAC7DD,GAEM,aAAXvY,EAAuBpZ,KAAK0xB,WAAa,SAAS5wB,EAAGC,EAAGC,EAAGC,EAAG0wB,EAAOC,EAAOC,GACnF,MAAMC,EAAY,GAAJ9wB,EAAS+wB,EAAY,GAAJ9wB,EAG/B,OAFAH,GAAKgxB,GAEGhxB,GADRC,GAAKgxB,GACWhxB,GAAK+wB,EAAQA,EAAQC,EAAQA,GAASF,EAAeF,EACzDC,GAEM,cAAXxY,EAAwBpZ,KAAK0xB,WAAa,SAAS5wB,EAAGC,EAAGC,EAAGC,EAAG0wB,EAAOC,EAAOC,GACpF,MAAMC,EAAY,GAAJ9wB,EAAS+wB,EAAY,GAAJ9wB,EAI/B,OAHAH,GAAKgxB,GAGGhxB,GAFRC,GAAKgxB,GAEWhxB,GAAK+wB,EAAQA,EAAQC,EAAQA,IAD7CF,EAAS,EAAMA,GACsDF,EACzDC,GAEM,WAAXxY,IAAqBpZ,KAAK0xB,WAAa,SAAS5wB,EAAGC,EAAGC,EAAGC,EAAG0wB,EAAOC,EAAOC,GACjF,OAAIrwB,KAAKE,SAAWmwB,EAAeD,EACvBD,KAGZ3xB,KAAK0xB,aACP1xB,KAAKgyB,iBAAkB,IAAKzC,MAAQ0C,UACpCjyB,KAAKmxB,mBAAqBM,GAAY,MAG1CzxB,KAAKgxB,SAAWQ,EASXzxB,YAAYyxB,GAA2CxxB,KAAKkyB,SAAWV,EAQvEzxB,cAAcyxB,GAAoDxxB,KAAKmyB,WAAaX,EASpFzxB,aAAa6B,EAAeC,GACjC7B,KAAKgB,EAAIY,EACT5B,KAAKiB,EAAIY,EAaJ9B,gBAAgBnB,GACrBoB,KAAKkxB,aAAetyB,EACpBoB,KAAKixB,cAAe,EAkBflxB,OAAOe,EAAYC,GACxBD,EAAIA,GAAK,EACTC,EAAIA,GAAK,EAGT,MAAMwD,EAAKzD,EAAId,KAAKwkB,SAAS4L,GACvB1rB,EAAK3D,EAAIf,KAAKwkB,SAAS6L,GACvB+B,GAAU,IAAK7C,MAAQ0C,UAC7B,IAAII,EAIAzvB,EAHA5C,KAAK0xB,YAAc1xB,KAAKgyB,kBAAiBK,GAAaD,EAAUpyB,KAAKgyB,iBAAmBhyB,KAAKmxB,oBAC7FkB,GAAaA,GAAa,IAAKryB,KAAK0xB,gBAAahpB,GAKrD,IAAK,IAAItL,EAAI,EAAGA,EAAI4C,KAAKwkB,SAASvjB,IAAK7D,EACrC,IAAK,IAAIlB,EAAI,EAAGA,EAAI8D,KAAKwkB,SAASxjB,IAAK9E,EAAG,CACxC,MAAMo2B,EAAMp2B,EAAIqI,EAAIguB,EAAMn1B,EAAIsH,EAE9B,GAAI1E,KAAKgB,IAAMsxB,EAAM,GAAKA,GAAOtyB,KAAKgB,GACpC4B,EAAOwhB,QAEF,GAAIpkB,KAAKiB,IAAMsxB,EAAM,GAAKA,GAAOvyB,KAAKiB,GAC3C2B,EAAOwhB,QAEF,GAAIpkB,KAAKkyB,WAAalyB,KAAKkyB,SAASI,EAAKC,GAC9C3vB,EAAOwhB,QAEF,GAAIpkB,KAAK0xB,aAAe1xB,KAAKixB,aAClCruB,EAAO5C,KAAK0xB,WACVx1B,EACAkB,EACA4C,KAAKwkB,SAASxjB,EACdhB,KAAKwkB,SAASvjB,EACdjB,KAAKgxB,SAASsB,EAAKC,GACnBvyB,KAAKsxB,UAAUl0B,GAAGlB,GAClBm2B,GAAa,QAGV,GAAIryB,KAAKkxB,eAAiBlxB,KAAKixB,aAAc,CAClD,MAAMuB,EAAUF,EAAMtyB,KAAKoxB,OACrBqB,EAAUF,EAAMvyB,KAAKqxB,OACvBmB,GAAW,GAAKA,EAAUxyB,KAAKwkB,SAASxjB,GAAKyxB,GAAW,GAAKA,EAAUzyB,KAAKwkB,SAASvjB,GACvF2B,EAAO5C,KAAKsxB,UAAUmB,GAASD,MAClBpO,KAAUxhB,EAAO5C,KAAKgxB,SAASsB,EAAKC,IAEjD3vB,EAAO5C,KAAKgxB,SAASsB,EAAKC,QAEvB3vB,EAAO5C,KAAKgxB,SAASsB,EAAKC,GAEjCvyB,KAAKuxB,WAAWn0B,GAAGlB,GAAK0G,EAEpB5C,KAAKmyB,YAAcvvB,IAASwhB,KAC9BxhB,EAAO5C,KAAKmyB,WAAWvvB,EAAM0vB,EAAKC,EAAKH,IAEzCpyB,KAAKwkB,SAASqM,UAAUjuB,EAAM1G,EAAGkB,GAKrC4C,KAAKoxB,OAAS7sB,EACdvE,KAAKqxB,OAAS3sB,EAGd,MAAMguB,EAAY1yB,KAAKsxB,UACvBtxB,KAAKsxB,UAAYtxB,KAAKuxB,WACtBvxB,KAAKuxB,WAAamB,EAClB1yB,KAAKixB,cAAe,ISrYhBjxB,KAAKovB,KACL,CAACtuB,EAAGC,IAAMf,KAAK2yB,QAAQ7xB,EAAGC,GAC1Bf,KAAKqJ,MAAMzH,MACX5B,KAAKqJ,MAAMxH,QAGb7B,KAAKqvB,IAAIuD,YAAY,CAAC9xB,EAAGC,IAChBf,KAAKmvB,UAAYnvB,KAAKyN,MAAMP,GAAGpM,EAAGC,GAAGiW,MAG9ChX,KAAKqvB,IAAIwD,cAAc,CAACjwB,EAAM9B,EAAGC,EAAG+xB,IAC3B9yB,KAAK+yB,SAASnwB,EAAM9B,EAAGC,EAAG+xB,IAGnCE,cAAchzB,KAAKsvB,cACnBtvB,KAAKsvB,aAAe2D,YAAY,KAAQjzB,KAAKkzB,aAAelzB,KAAK2vB,WAEnE5vB,YACE,GAAIC,KAAKmZ,KAAQ,OACjB,MAAM4B,EAAKwU,KAAKC,MACZxvB,KAAK+a,GAAK,IAAOA,IACnB/a,KAAKyvB,IAAMzvB,KAAK0vB,QAChB1vB,KAAK0vB,QAAU,EACf1vB,KAAK+a,GAAKA,GAGZ/a,KAAKmZ,MAAO,EACPnZ,KAAK6vB,QAAS7vB,KAAK4vB,WACtB5vB,KAAK4vB,UAAW,EAEhB5vB,KAAKqJ,MAAM8pB,QAIbnzB,KAAKqvB,IAAI+D,OAAOpzB,KAAKovB,KAAKgB,GAAIpwB,KAAKovB,KAAKiB,IACxCrwB,KAAKovB,KAAKvG,SAEV7oB,KAAKmZ,MAAO,EACZnZ,KAAK0vB,SAAW,EAChB1vB,KAAKoP,MAAQ,GAEfrP,SAAS6C,EAAM9B,EAAGC,EAAG+xB,GACnB,GAAI9yB,KAAKmvB,SACP,OAAOvsB,EAAKywB,QAAQ,GAEtB,MAAMC,EAAUtzB,KAAKyN,MAAMP,GAAGpM,EAAGC,GAEjC,OAAIuyB,EAAQtjB,SAAWpN,EAAKywB,QACnBzwB,EAAKywB,QAAQC,EAAQnlB,QAGvBvL,IAGX9C,UACEC,QACE,OAAOC,KAAKmvB,SAAWnvB,KAAKqJ,MAAQrJ,KAAKC,OAAO8N,YAAY/N,KAAKqJ,MAAM1D,KAEzE5F,eACE,OAAO,IAAOC,KAAK2vB,WAGvB5vB,UACEC,KAAKuzB,gBAEPxzB,gBACEizB,cAAchzB,KAAKsvB,eAErBkE,OACEzzB,WACEC,KAAKuzB,mBEvOXE,WAXAl3B,OAAAgE,EAAA,EAAAhE,CACA2yB,GCTA,WAA0B,IAAAhM,EAAAljB,KAAaQ,EAAA0iB,EAAAziB,eAA0BE,EAAAuiB,EAAAxiB,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiByiB,YAAA,UAAoBziB,EAAA,OAAYyiB,YAAA,QAAkBziB,EAAA,OAAYyiB,YAAA,aAAuBziB,EAAA,OAAYwiB,IAAA,QAAAC,YAAA,mBAAuCF,EAAAtiB,GAAA,KAAAD,EAAA,OAA0ByiB,YAAA,aAAuBziB,EAAA,OAAYyiB,YAAA,cAAwBF,EAAAtiB,GAAA,OAAAsiB,EAAAM,GAAAN,EAAAuM,QAAAvM,EAAAtiB,GAAA,KAAAD,EAAA,OAAAuiB,EAAAtiB,GAAA,OAAAsiB,EAAAM,GAAAN,EAAA7Z,MAAA1D,OAAAud,EAAAtiB,GAAA,KAAAD,EAAA,SAAuH+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAA,SAAA0Q,WAAA,aAA0EC,OAASxhB,KAAA,YAAkByhB,UAAWC,QAAAhyB,MAAAiyB,QAAA9Q,EAAAiM,UAAAjM,EAAA+Q,GAAA/Q,EAAAiM,SAAA,SAAAjM,EAAA,UAAkFzgB,IAAKyxB,OAAA,SAAAC,GAA0B,IAAAC,EAAAlR,EAAAiM,SAAAkF,EAAAF,EAAAta,OAAAya,IAAAD,EAAAN,QAAwE,GAAAhyB,MAAAiyB,QAAAI,GAAA,CAAuB,IAAAG,EAAArR,EAAA+Q,GAAAG,EAAA,MAAiCC,EAAAN,QAAiBQ,EAAA,IAAArR,EAAAiM,SAAAiF,EAAAI,QAAlD,QAA+FD,GAAA,IAAArR,EAAAiM,SAAAiF,EAAA30B,MAAA,EAAA80B,GAAAC,OAAAJ,EAAA30B,MAAA80B,EAAA,UAAuErR,EAAAiM,SAAAmF,MAAoBpR,EAAAtiB,GAAA,KAAAD,EAAA,SAA0BkzB,OAAOztB,SAAA8c,EAAAjjB,UAAuBijB,EAAAtiB,GAAA,KAAAD,EAAA,OAAwByiB,YAAA,mBAA6BziB,EAAA,OAAYyiB,YAAA,aAAuBF,EAAAtiB,GAAA,SAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAAwCyiB,YAAA,cAAwBziB,EAAA,OAAYyiB,YAAA,eAAyBziB,EAAA,SAAc+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAA,SAAA0Q,WAAA,aAA0ExQ,YAAA,eAAAyQ,OAAoCluB,GAAA,WAAA0M,KAAA,UAAgCyhB,UAAWp1B,MAAAwkB,EAAA,UAAuBzgB,IAAK+F,MAAA,SAAA2rB,GAAyBA,EAAAta,OAAA4a,YAAsCvR,EAAAyM,SAAAwE,EAAAta,OAAAnb,WAAmCwkB,EAAAtiB,GAAA,KAAAD,EAAA,SAA0ByiB,YAAA,mBAAAyQ,OAAsCa,IAAA,cAAkBxR,EAAAtiB,GAAA,mDAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,UAAqFyiB,YAAA,oBAAA3gB,IAAoCkyB,MAAA,SAAAR,GAAyBjR,EAAA0M,UAAA,MAAsB1M,EAAAtiB,GAAA,yCAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,UAA2EyiB,YAAA,oBAAA3gB,IAAoCkyB,MAAA,SAAAR,GAAyBjR,EAAA2M,OAAA3M,EAAA2M,UAAyB3M,EAAAtiB,GAAA,iBAAAsiB,EAAAM,GAAAN,EAAA2M,MAAA,oDDYv4D,EACA,KACA,KACA,eEfoK+E,GCyBrJj1B,EAAA,EAAIC,QACjBC,OAAQ,UACRjE,KAAI,MAEAi5B,OAAQ,OAGZ/0B,UACEC,WAIF+iB,SACE/iB,QACEC,KAAKyI,OAAOqsB,QAAQ90B,KAAK60B,YCpB/BE,WAXAx4B,OAAAgE,EAAA,EAAAhE,CACAq4B,GCTA,WAA0B,IAAA1R,EAAAljB,KAAaQ,EAAA0iB,EAAAziB,eAA0BE,EAAAuiB,EAAAxiB,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiByiB,YAAA,yBAAmCziB,EAAA,MAAAuiB,EAAAG,GAAAH,EAAAza,OAAA,iBAAAusB,GAAwD,OAAAr0B,EAAA,QAAkB3B,IAAAg2B,EAAArvB,GAAAyd,YAAA,iBAAAE,OAAkDuR,OAAA3R,EAAA2R,QAAA3R,EAAA2R,OAAAlvB,KAAAqvB,EAAArvB,IAAsDlD,IAAKkyB,MAAA,SAAAR,GAAyBjR,EAAA2R,OAAAG,MAAsB9R,EAAAtiB,GAAA,WAAAsiB,EAAAM,GAAAwR,EAAA/2B,MAAA,eAAoDilB,EAAAtiB,GAAA,YAAAsiB,EAAA2R,OAAAl0B,EAAA,KAA6C8B,IAAIkyB,MAAAzR,EAAA+R,SAAmB/R,EAAAtiB,GAAA,iBAAAsiB,EAAAgS,YDY3e,EACA,KACA,KACA,eEyBO,IAAIC,IACTxX,UAAU,EACVmD,QAAS,EACTC,QAAS,GACTC,WAAY,IAGd,MAAMoU,GAAU,IAAIjY,KACjB,EAAG,IAAM,IAAIvW,EAAc,SAAU,IAAIyM,IAAWlC,OAAQ,QAC5D,EAAG,IAAM,IAAIvK,EAAc,MAAO,IAAIyM,IAAWlC,OAAQ,OACzD,EAAG,IAAM,IAAIvK,EAAc,SAAU,IAAIyM,IAAWlC,OAAQ,OAC5D,EAAG,IAAM,IAAIvK,EAAc,SAAU,IAAIyM,IAAWlC,OAAQ,QAGzDmN,GAAY,IAAInB,KACnB,EAAG,IAAM,IAAIzW,EAAU,WAAY,IAAI2M,IAAWH,QAAS,QAC3D,EAAG,IAAM,IAAIxM,EAAU,OAAQ,IAAI2M,IAAWH,QAAS,OACvD,GAAI,IAAM,IAAIxM,EAAU,OAAQ,IAAI2M,IAAWH,QAAS,QAGrDmiB,GAAc,CAAChvB,EAAkCpI,IAC9C,IAAI6N,EACTzF,EACA,IAAIsO,GACJ,IAAIjL,EAAOzL,EAAMqL,EAAK8G,qBAkBpBklB,GAAM,IACHD,GACL,IAAI9hB,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,EACR7G,OAAQ,EACRyJ,MAAO,KAET,OAIEgoB,GAAM,IACHF,GACL,IAAI9hB,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,EACR7G,OAAQ,EACRyJ,MAAO,MAET,OAIEioB,GAAS,IACNH,GACL,IAAI9hB,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,GACR7G,OAAQ,EACRyJ,MAAO,MAET,UAIEkoB,GAAQ,IACLJ,GACL,IAAI9hB,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,EACR7G,OAAQ,EACRyJ,MAAO,KAET,SAkBEmoB,GAAiB,IAAIvY,KAAuB,EAAGmY,MAC/CK,GAAiB,IAAIxY,KAAuB,EAAGmY,KAAO,EAAGC,MACzDK,GAAiB,IAAIzY,KACxB,EAAGmY,KACH,EAAGC,KACH,EAAGC,MAEAK,GAAiB,IAAI1Y,KAAuB,EAAGqY,KAAU,EAAGC,MAC5DK,GAAiB,IAAI3Y,KAAuB,EAAGsY,KAAS,EAtB/C,IACNJ,GACL,IAAI9hB,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,GACR7G,OAAQ,EACRyJ,MAAO,MAET,mBAcEwoB,WAAsCrY,GAC1C3d,YACUwd,EACAyY,EACAC,GAERjwB,QAJQhG,KAAAud,OACAvd,KAAAg2B,WACAh2B,KAAAi2B,WAKHl2B,UAAUE,GACf,IAAIkJ,KAcJ,OAZInJ,KAAKk2B,UAAUj2B,GACjBkJ,EAAY7M,KAAK0D,KAAKm2B,oBAAoBl2B,IACjCD,KAAKo2B,qBAAqBn2B,IACnCkJ,EAAY7M,KAAK0D,KAAKq2B,YAAYp2B,IAGhCD,KAAKo2B,qBAAqBn2B,GAC5BkJ,EAAY7M,KAAK0D,KAAKq2B,YAAYp2B,EAAQkJ,EAAY7G,IAAI8G,GAAcA,EAAWzD,MAC1E3F,KAAKk2B,UAAUj2B,IACxBkJ,EAAY7M,KAAK0D,KAAKm2B,oBAAoBl2B,EAAQkJ,EAAY7G,IAAI8G,GAAcA,EAAWzD,MAGtFwD,EAGCpJ,UAAUE,GAClB,OAAOA,EAAOkJ,YAAYvB,KAAKwB,GAAcA,EAAWC,MAAQrJ,KAAKg2B,UAG7Dj2B,oBAAoBE,EAAgBq2B,MAC5C,OAAO/5B,OAAAuL,EAAA,OAAAvL,CAAO0D,EAAOkJ,YAAYpB,OAAOqB,GAAcnJ,EAAOkJ,YAAY/M,OAAS4D,KAAKi2B,WAAa15B,OAAAuL,EAAA,SAAAvL,CAAS+5B,EAAoBltB,EAAWzD,MAGpI5F,qBAAqBE,GAC7B,OAAOA,EAAOkJ,YAAY/M,OAAS4D,KAAKi2B,SAGhCl2B,YAAYE,EAAgBq2B,MACpC,MAAMC,EAAYD,EAAmB9B,OAAOv0B,EAAOkJ,YAAY7G,IAAI8G,GAAcA,EAAWzD,KAC5F,OAAOpJ,OAAAuL,EAAA,OAAAvL,CAAOyD,KAAKud,KAAKxV,OAAOqB,IAAe7M,OAAAuL,EAAA,SAAAvL,CAASg6B,EAAWntB,EAAWzD,aAI3E6wB,WAAsBtZ,GAC1Bnd,YAAY02B,GACV,IAAIlZ,MAGF,QACA,QACA,QAEA,MACA,OACA,cAEA,aACA,OACA,cAEA,YACA,KACA,aACA7a,QAAQ,CAACzE,EAAM/B,KACfqhB,EAAKjhB,KAAK,IAAImhB,GAAWvhB,EAAG+B,EAAM,MAGpC+H,MAAM,IAAI+vB,GAAuBxY,EAAM,EAAG,IAE1Cvd,KAAKC,OAASD,KAAK02B,aAEnB,IAAIzX,EAAOjf,KAAK22B,YAAYF,GACxBvX,EAAOlf,KAAK22B,YAAYF,GACxBG,EAAO52B,KAAK22B,YAAYF,GACxBI,EAAO72B,KAAK22B,YAAYF,GACxBK,EAAO92B,KAAK22B,YAAYF,GAE5BvY,GAAa,IAAMe,EAAMyW,IACzBxX,GAAa,IAAMgB,EAAMyW,IACzBzX,GAAa,IAAM0Y,EAAMhB,IACzB1X,GAAa,IAAM2Y,EAAMhB,IACzB3X,GAAa,IAAM4Y,EAAMhB,IAEzB9W,GAAYC,EAAMC,GAClBF,GAAYE,EAAM0X,GAClB5X,GAAY4X,EAAMC,GAClB7X,GAAY6X,EAAMC,GAElB92B,KAAKwa,WAAayE,EAMlBJ,GACE7e,KAAKwa,WACL5X,GAAQA,EAAKuX,WAAavX,EAAKyZ,kBAC/B,CAACvb,EAAGC,KACFf,KAAKC,OAAOkc,SAAS,IAAIja,EAAMpB,EAAGC,GAAIf,KAAKwa,cAKvCza,aACR,MAAMg3B,EAAS,IAAInwB,EAAc,SAAU,IAAIyM,IAAWlC,OAAQ,KAC5D6lB,EAAO,IAAIxwB,EAAQ,OAAQ,IAAI6M,QAE/B4jB,EAAe,IAAIvtB,EAAO,SAAUJ,EAAK6G,OAAQ3G,GAEvD,IAAIvJ,EAAS,IAAI2L,EACf,IAAI6Q,IAAO,EAAG,EAAG,EAAG,EAAG,KACvB,IAAIlJ,IACFpC,OAAQ,EACR+B,QAAS,EACTC,UAAW,EACXxI,OAAQ,GACR7G,OAAQ,GACRyJ,MAAO,MAET,IAAIoH,GACJsiB,GAKF,OAHAh3B,EAAOmU,MAAM2iB,GACb92B,EAAOmU,MAAM4iB,GAEN/2B,EAGCF,YAAY6I,GACpB,IAAItG,EAAMqe,GACR,GACA,GACA/X,EAAQkY,QACRlY,EAAQmY,QACRnY,EAAQoY,YAqBV,OAlBA1e,EAAMid,IACJ,cACA,cACA,cACA,cACA,cACA,cACA,gBAGE3W,EAAQ+U,UACVA,GAASrb,GAEXkc,GAAWlc,GACXA,EAAIiG,KAAOvI,KAEXqe,GAAS,IAAM/b,EAAK8yB,GAAQ8B,MAAM5Y,KAE3Bhc,GCrPX,IC1EgK60B,GD0EjJx3B,EAAA,EAAIC,QACjBhE,KAAI,MAEA2M,KAAM,IAAIiuB,GAAOrB,IACjBpa,GAAIwU,KAAKC,MACTiH,iBAAkBtB,KAGtBrF,YACExvB,OACA82B,OAAAnU,GACAwQ,SACA9qB,QAAAosB,IAEFjS,SACE/iB,cACEC,KAAKuI,KAAO,IAAIiuB,GACdx2B,KAAKy2B,sBExEbY,WAXA96B,OAAAgE,EAAA,EAAAhE,CACA46B,GCTA,WAA0B,IAAAjU,EAAAljB,KAAaQ,EAAA0iB,EAAAziB,eAA0BE,EAAAuiB,EAAAxiB,MAAAC,IAAAH,EAAwB,OAAA0iB,EAAA,KAAAviB,EAAA,OAA4ByiB,YAAA,YAAAyQ,OAA+BluB,GAAA,SAAYud,EAAA3a,KAAAtI,SAAAijB,EAAA3a,KAAAtI,OAAAsO,KAAA5N,EAAA,SAAyDkzB,OAAOxqB,MAAA6Z,EAAA3a,KAAAiS,WAAAva,OAAAijB,EAAA3a,KAAAtI,UAAsDijB,EAAAgS,KAAAhS,EAAAtiB,GAAA,KAAAsiB,EAAA3a,KAAAtI,QAAAijB,EAAA3a,KAAAtI,OAAAsO,KAAA5N,EAAA,OAAAuiB,EAAAtiB,GAAA,kBAAAsiB,EAAAgS,KAAAhS,EAAAtiB,GAAA,KAAAsiB,EAAA3a,KAAA,OAAA5H,EAAA,WAAyJkzB,OAAOprB,OAAAya,EAAA3a,KAAAE,UAA0Bya,EAAAgS,KAAAhS,EAAAtiB,GAAA,KAAAD,EAAA,UAAoCkzB,OAAOxpB,OAAA6Y,EAAA3a,KAAA8B,UAA0B6Y,EAAAtiB,GAAA,KAAAD,EAAA,UAAyBA,EAAA,UAAaA,EAAA,OAAYyiB,YAAA,mBAA6BziB,EAAA,OAAYyiB,YAAA,aAAuBF,EAAAtiB,GAAA,+BAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAA8DyiB,YAAA,cAAwBziB,EAAA,OAAYyiB,YAAA,eAAyBziB,EAAA,SAAc+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAAuT,iBAAA,SAAA7C,WAAA,8BAA4GxQ,YAAA,mBAAAyQ,OAAwCluB,GAAA,QAAA0M,KAAA,YAA+ByhB,UAAWC,QAAAhyB,MAAAiyB,QAAA9Q,EAAAuT,iBAAA9Y,UAAAuF,EAAA+Q,GAAA/Q,EAAAuT,iBAAA9Y,SAAA,SAAAuF,EAAAuT,iBAAA,UAAqIh0B,IAAKyxB,OAAA,SAAAC,GAA0B,IAAAC,EAAAlR,EAAAuT,iBAAA9Y,SAAA0W,EAAAF,EAAAta,OAAAya,IAAAD,EAAAN,QAAyF,GAAAhyB,MAAAiyB,QAAAI,GAAA,CAAuB,IAAAG,EAAArR,EAAA+Q,GAAAG,EAAA,MAAiCC,EAAAN,QAAiBQ,EAAA,GAAArR,EAAAoU,KAAApU,EAAAuT,iBAAA,WAAArC,EAAAI,QAAlD,QAA8HD,GAAA,GAAArR,EAAAoU,KAAApU,EAAAuT,iBAAA,WAAArC,EAAA30B,MAAA,EAAA80B,GAAAC,OAAAJ,EAAA30B,MAAA80B,EAAA,UAAsGrR,EAAAoU,KAAApU,EAAAuT,iBAAA,WAAAnC,OAAmDpR,EAAAtiB,GAAA,KAAAD,EAAA,SAA0ByiB,YAAA,mBAAAyQ,OAAsCa,IAAA,WAAexR,EAAAtiB,GAAA,+CAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAA8EyiB,YAAA,eAAyBziB,EAAA,SAAc+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAAuT,iBAAA,WAAA7C,WAAA,gCAAgHxQ,YAAA,eAAAyQ,OAAoCluB,GAAA,aAAA0M,KAAA,UAAkCyhB,UAAWp1B,MAAAwkB,EAAAuT,iBAAA,YAA0Ch0B,IAAK+F,MAAA,SAAA2rB,GAAyBA,EAAAta,OAAA4a,WAAsCvR,EAAAoU,KAAApU,EAAAuT,iBAAA,aAAAtC,EAAAta,OAAAnb,WAAoEwkB,EAAAtiB,GAAA,KAAAD,EAAA,SAA0ByiB,YAAA,mBAAAyQ,OAAsCa,IAAA,gBAAoBxR,EAAAtiB,GAAA,gDAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAA+EyiB,YAAA,eAAyBziB,EAAA,SAAc+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAAuT,iBAAA,QAAA7C,WAAA,6BAA0GxQ,YAAA,eAAAyQ,OAAoCluB,GAAA,UAAA0M,KAAA,UAA+ByhB,UAAWp1B,MAAAwkB,EAAAuT,iBAAA,SAAuCh0B,IAAK+F,MAAA,SAAA2rB,GAAyBA,EAAAta,OAAA4a,WAAsCvR,EAAAoU,KAAApU,EAAAuT,iBAAA,UAAAtC,EAAAta,OAAAnb,WAAiEwkB,EAAAtiB,GAAA,KAAAD,EAAA,SAA0ByiB,YAAA,mBAAAyQ,OAAsCa,IAAA,aAAiBxR,EAAAtiB,GAAA,6CAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAA4EyiB,YAAA,eAAyBziB,EAAA,SAAc+yB,aAAaz1B,KAAA,QAAA01B,QAAA,UAAAj1B,MAAAwkB,EAAAuT,iBAAA,QAAA7C,WAAA,6BAA0GxQ,YAAA,eAAAyQ,OAAoCluB,GAAA,UAAA0M,KAAA,UAA+ByhB,UAAWp1B,MAAAwkB,EAAAuT,iBAAA,SAAuCh0B,IAAK+F,MAAA,SAAA2rB,GAAyBA,EAAAta,OAAA4a,WAAsCvR,EAAAoU,KAAApU,EAAAuT,iBAAA,UAAAtC,EAAAta,OAAAnb,WAAiEwkB,EAAAtiB,GAAA,KAAAD,EAAA,SAA0ByiB,YAAA,mBAAAyQ,OAAsCa,IAAA,aAAiBxR,EAAAtiB,GAAA,iDAAAsiB,EAAAtiB,GAAA,KAAAD,EAAA,OAAgFyiB,YAAA,mBAA6BziB,EAAA,OAAYyiB,YAAA,cAAwBziB,EAAA,UAAeyiB,YAAA,kBAAA3gB,IAAkCkyB,MAAA,SAAAR,GAAyBjR,EAAAyT,kBAAoBzT,EAAAtiB,GAAA,oDAAAsiB,EAAAgS,UDY1/G,EACA,KACA,KACA,6BERA,IAAIv1B,EAAA,GACF43B,GAAI,OACJ1O,OAAQ5nB,GAAKA,EAAEo2B,gFCT6U,sDCAI,sDCAF,sDCAC,uBCAjW,IAAA/0B,GACAk1B,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,GACAC,aAAA,GACAC,UAAA,IACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,gBAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,UAAA,GACAC,aAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,UAAA,GACAC,aAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,YAAA,GACAC,eAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,QAAA,GACAC,WAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,UAAA,GACAC,aAAA,GACAC,QAAA,GACAC,WAAA,GACAC,OAAA,GACAC,UAAA,GACAC,QAAA,GACAC,WAAA,GACAC,QAAA,GACAC,aAAA,GACAC,gBAAA,GACAC,WAAA,GACAC,UAAA,GACAC,aAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,YAAA,GACAC,eAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,aAAA,GACAC,gBAAA,GACAC,OAAA,GACAC,UAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,aAAA,GACAC,UAAA,GACAC,aAAA,IAIA,SAAAC,EAAAC,GACA,IAAAphC,EAAAqhC,EAAAD,GACA,OAAAxpC,EAAAoI,GAEA,SAAAqhC,EAAAD,GACA,IAAAphC,EAAArD,EAAAykC,GACA,KAAAphC,EAAA,IACA,IAAAshC,EAAA,IAAAC,MAAA,uBAAAH,EAAA,KAEA,MADAE,EAAAE,KAAA,mBACAF,EAEA,OAAAthC,EAEAmhC,EAAAr9B,KAAA,WACA,OAAAlN,OAAAkN,KAAAnH,IAEAwkC,EAAAM,QAAAJ,EACAppC,EAAAD,QAAAmpC,EACAA,EAAAnhC,GAAA,yDC5QkS","file":"main.afb10c70.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([173,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { Tile, TileTypes } from '../map'\n\nexport default Vue.extend({\n  props: [\"cell\", 'player'],\n  computed: {\n    style() {\n      if (this.player) {\n        return 'player'\n      } else if (this.cell.isWall()) {\n        return 'wall'\n      } else if (this.cell.isDoor()) {\n        return 'door'\n      }\n\n      return 'floor'\n    },\n    symbol():any {\n      if (this.player) {\n        return ''\n      } else if (this.cell.display == ' ') {\n        return ''\n      } else if (this.cell.display == '+') {\n        return ''\n      } else if (this.cell.display == '#') {\n        return ''\n      } else {\n        return 'E'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Cell.vue?vue&type=template&id=0a1e052e\"\nimport script from \"./Cell.vue?vue&type=script&lang=ts\"\nexport * from \"./Cell.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Cell.vue?vue&type=style&index=0&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('td',[_vm._v(\"\\n  :class=\\\"style\\\"\\n  v-text=\\\"symbol\\\"\\n  @click=\\\"$emit('setPosition')\\\"\\n\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export class Rect {\n  // TODO: Validate?\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {}\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\nexport const succ = function(c: string): string {\n  return String.fromCharCode(c.charCodeAt(0) + 1)\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\n/* tslint:disable no-any */\nexport const twoDimArray = function(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => any\n): Array<Array<any>> {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport const max = function(list: Array<number>): number {\n  return Math.max.apply(Math, list)\n}\n\nexport const min = function(list: Array<number>): number {\n  return Math.min.apply(Math, list)\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x, y): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (T) => any): void {\n    this.map.forEach(column => {\n      column.forEach(tile => {\n        on(tile)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x, y) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n","export class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private checkSolid: (x: number, y: number) => boolean,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.checkSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.checkSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (this.checkSolid(currentX, currentY) && distance < this.radius) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { Specie, Creature } from '../creature'\nimport { Modifier } from '../characteristics'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnBody,\n  Throw,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public readonly usages: Usage[] = [],\n    public id: ItemId = Item.getId()\n  ) {}\n\n  public clone(): Item {\n    return new Item(this.group, this.name)\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: Specie) {\n    super(ItemGroup.Consumable, `${specie.name}'s corpse`)\n  }\n}\n\nexport abstract class Equipment extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    public readonly modifier: Modifier,\n    usages: Usage[]\n  ) {\n    super(group, name, usages)\n  }\n\n  public onPutOn(creature: Creature): void {\n    creature.characteristics.addModifier(this.modifier)\n  }\n\n  public onTakeOff(creature: Creature): void {\n    creature.characteristics.removeModifier(this.modifier)\n  }\n}\n\nexport class Missile extends Equipment {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.Missile, name, modifier, [Usage.Throw])\n  }\n}\n\nexport class BodyArmor extends Equipment {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.BodyArmor, name, modifier, [Usage.WearsOnBody])\n  }\n}\n\nexport class OneHandWeapon extends Equipment {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.OneHandWeapon, name, modifier, [Usage.WeaponOneHand])\n  }\n}\n","import { Item, Equipment } from './items'\n\nimport { Usage } from './items/internal'\n\nimport { remove, includes } from 'lodash'\nimport { Creature } from './creature'\n\nexport enum BodyPart {\n  LeftHand,\n  RightHand,\n  Legs,\n  Finger,\n  Head,\n  Eye,\n  Neck,\n  Back,\n  Body,\n\n  MissileWeapon,\n  Missile,\n}\n\nexport type Wearing = {\n  bodyPart: BodyPart\n  equipment?: Equipment\n}\n\nconst bodyToUsage = {\n  [BodyPart.RightHand]: Usage.WeaponOneHand,\n  [BodyPart.Body]: Usage.WearsOnBody,\n  [BodyPart.Missile]: Usage.Throw,\n}\n\nexport class Inventory {\n  private wearings: Wearing[] = []\n  private bag: Item[] = []\n\n  constructor(parts: BodyPart[]) {\n    this.wearings = parts.map(bodyPart => {\n      return { bodyPart: bodyPart }\n    })\n  }\n\n  public inSlot(usage: Usage): Equipment[] {\n    const match = this.wears().find(\n      ({ bodyPart }) => usage === bodyToUsage[bodyPart]\n    )\n    return match && match.equipment ? [match.equipment] : []\n  }\n\n  public wears(): Wearing[] {\n    return this.wearings\n  }\n\n  public cares(): Item[] {\n    return this.bag\n  }\n\n  public canWear(item: Equipment) {\n    return this.wearings.some(wearing =>\n      includes(item.usages, bodyToUsage[wearing.bodyPart])\n    )\n  }\n\n  public matchingEquip(item: Equipment): Wearing[] {\n    return this.wearings.filter(wearing =>\n      includes(item.usages, bodyToUsage[wearing.bodyPart])\n    )\n  }\n\n  public equip(actor: Creature, item: Equipment) {\n    this.matchingEquip(item).forEach(wearing => {\n      if (wearing.equipment) {\n        this.putToBag(wearing.equipment)\n        wearing.equipment.onTakeOff(actor)\n      }\n\n      wearing.equipment = item\n      item.onPutOn(actor)\n    })\n  }\n\n  public takeOff(actor: Creature, item: Equipment) {\n    this.wearings.forEach(wearing => {\n      if (wearing.equipment && wearing.equipment.id === item.id) {\n        this.putToBag(wearing.equipment)\n        item.onTakeOff(actor)\n        wearing.equipment = null\n      }\n    })\n  }\n\n  public putToBag(item: Item) {\n    this.bag.push(item)\n  }\n\n  public removeFromBag(item: Item) {\n    remove(this.bag, inventoryItem => inventoryItem.id === item.id)\n  }\n}\n","import { Game } from './game'\nimport { Player } from './creature'\nimport { Profession } from './profession'\n\nexport abstract class Screen {\n  constructor(\n    protected game: Game,\n    // protected onDone: () => void,\n  ) {}\n\n  public build() {}\n\n  public onInput(input: any) {\n    this.game.screen = undefined\n  }\n}\n\nexport class LevelUp extends Screen {\n  public options: Profession[]\n\n  constructor(\n    game: Game,\n    public player: Player,\n    // onDone: () => void,\n  ) {\n    super(game)\n    // super(onDone)\n    this.options = this.game.professionPicker.available(this.player)\n  }\n\n  public onInput(pickedProfession: Profession) {\n    while (this.player.levelUps > 0) {\n      this.player.characteristics.levelUp(this.player.specie)\n\n      this.player.levelUps -= 1\n    }\n\n    let playerProfession = this.player.professions.find(profession => profession.id === pickedProfession.id)\n    if (playerProfession) {\n      playerProfession.level += 1\n    } else {\n      this.player.professions.push(pickedProfession)\n    }\n\n    // this.onDone()\n    this.game.screen = undefined\n  }\n}\n","import { Point } from './utils'\nimport { MetaAI } from './ai'\nimport { Fov } from './fov'\nimport { Equipment } from './items'\n\nimport { Characteristics, Corpse, LevelMap, LevelMapId, Memory } from './engine'\nimport { Inventory, BodyPart } from './inventory'\n\nimport { Level } from './level'\nimport { includes } from 'lodash'\nimport { Item } from './items'\nimport { LevelUp } from './screen';\nimport { Profession } from './profession';\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairwayDown,\n  Inventory,\n  PutOn,\n  Throwing,\n}\n\nexport const allAbilities = Object.keys(Ability).map(key => Ability[key])\n\nexport class Specie {\n  constructor(\n    public readonly name: string,\n    public readonly clan: Clan,\n    public readonly abilities: Ability[]\n  ) {}\n}\n\nexport type CreatureId = number\n\nexport class Phantom {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  public refToReal?: Creature\n\n  constructor(public specie: Specie, public id: CreatureId = Phantom.getId()) {}\n\n  public name(): string {\n    return this.specie.name\n  }\n\n  public clan(): Clan {\n    return this.specie.clan\n  }\n\n  public clone(): Phantom {\n    return new Phantom(this.specie, this.id)\n  }\n\n  public real(): Creature {\n    return this.refToReal\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n}\n\nexport abstract class Event {\n  public abstract affect(subject: Creature): Reaction\n}\n\nexport class AttackEvent extends Event {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (this.actor.characteristics.misses(subject.characteristics)) {\n      subject.currentLevel.game.logger.missMessage(this.actor, subject)\n      return Reaction.DODGE\n    }\n\n    const damage = this.actor.characteristics.damageTo(subject.characteristics)\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.killMessage(damage, this.actor, subject)\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.hurtMessage(damage, this.actor, subject)\n      return Reaction.HURT\n    }\n  }\n}\n\nexport class ThrowEvent extends Event {\n  constructor(public actor: Creature, public missile: Item) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (this.actor.characteristics.throwMisses(subject.characteristics)) {\n      subject.currentLevel.game.logger.throwMissMessage(\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.THROW_DODGE\n    }\n\n    const damage = this.actor.characteristics.throwDamageTo(\n      subject.characteristics,\n      this.missile\n    )\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.throwKillMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.throwHurtMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.HURT\n    }\n  }\n}\n\nexport class AddExperienceEvent extends Event {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (subject instanceof Player) {\n      subject.levelUps += subject.level.add(1)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  THROW_DODGE,\n  NOTHING,\n}\n\nexport class Creature extends Phantom {\n  public ai: MetaAI\n  public stageMemories: { [key: string]: Memory } = {}\n  public currentLevel: LevelMap\n  public inventory: Inventory\n\n  public previousPos: Point\n  public previousLevel: LevelMap\n  public pos: Point\n\n  constructor(\n    public characteristics: Characteristics,\n    ai: MetaAI,\n    specie: Specie\n  ) {\n    super(specie)\n    this.ai = ai\n\n    this.inventory = new Inventory([\n      BodyPart.LeftHand,\n      BodyPart.RightHand,\n      BodyPart.Legs,\n      BodyPart.Finger,\n      BodyPart.Head,\n      BodyPart.Eye,\n      BodyPart.Neck,\n      BodyPart.Back,\n      BodyPart.Body,\n\n      BodyPart.MissileWeapon,\n      BodyPart.Missile,\n    ])\n  }\n\n  public putOn(item: Equipment) {\n    this.inventory.equip(this, item)\n    this.inventory.removeFromBag(item)\n  }\n\n  public takeOff(item: Equipment) {\n    this.inventory.takeOff(this, item)\n  }\n\n  public addToMap(pos: Point, level: LevelMap) {\n    this.pos = pos\n    this.previousLevel = this.currentLevel\n    this.currentLevel = level\n    level.addCreature(this)\n    this.visionMask(level)\n  }\n\n  public die(): void {\n    this.currentLevel.removeCreature(this)\n\n    let tile = this.currentLevel.at(this.pos.x, this.pos.y)\n    tile.items.push(new Corpse(this.specie))\n\n    this.inventory.wears().forEach(({ equipment }) => {\n      if (equipment) {\n        tile.items.push(equipment)\n      }\n    })\n\n    this.inventory.cares().forEach(item => {\n      tile.items.push(item)\n    })\n  }\n\n  public on(event: Event): Reaction {\n    return event.affect(this)\n  }\n\n  public real(): Creature {\n    return this\n  }\n\n  public speed(): number {\n    return this.characteristics.speed.currentValue()\n  }\n\n  public radius(): number {\n    return this.characteristics.radius.currentValue()\n  }\n\n  public stageMemory(levelId: LevelMapId = this.currentLevel.id): Memory {\n    return this.stageMemories[levelId]\n  }\n\n  public act(stage: LevelMap): void {\n    this.visionMask(stage)\n    this.previousPos = this.pos.copy()\n    this.ai.act(this, true)\n\n    let previousPosLevel = this.previousLevel || this.currentLevel\n    previousPosLevel.at(\n      this.previousPos.x,\n      this.previousPos.y\n    ).creature = undefined\n    this.currentLevel.at(this.pos.x, this.pos.y).creature = this\n\n    this.previousLevel = undefined\n  }\n\n  public move(nextPoint: Point) {\n    this.pos = nextPoint.copy()\n  }\n\n  public clone(): Phantom {\n    let phantom = new Phantom(this.specie, this.id)\n    phantom.refToReal = this\n    return phantom\n  }\n\n  public visionMask(stage: LevelMap): void {\n    if (!this.stageMemories[stage.id]) {\n      this.stageMemories[stage.id] = new Memory(stage.width, stage.height)\n    } else {\n      this.stageMemory().resetVisible()\n    }\n\n    const see = (x: number, y: number, degree: number): void => {\n      this.stageMemory()\n        .at(x, y)\n        .see(stage.at(x, y), degree)\n    }\n\n    new Fov(\n      this.pos.x,\n      this.pos.y,\n      this.radius(),\n      stage.width,\n      stage.height,\n      this.isSolid(stage),\n      see\n    ).calc()\n  }\n\n  private isSolid(stage: LevelMap): (x: number, y: number) => boolean {\n    return (x: number, y: number) => {\n      if (stage.visibleThrough(x, y)) {\n        return false\n      } else {\n        return !(\n          stage.at(x, y).isDoor() &&\n          this.pos.x === x &&\n          this.pos.y === y\n        )\n      }\n    }\n  }\n}\n\nexport class Player extends Creature {\n  public dead: boolean = false\n\n  public levelUps: number = 0\n  public professions: Profession[] = []\n\n  constructor(\n    public level: Level,\n    characteristics: Characteristics,\n    ai: MetaAI,\n    specie: Specie\n  ) {\n    super(characteristics, ai, specie)\n  }\n\n  public act(stage: LevelMap) {\n    super.act(stage)\n\n    if (this.levelUps > 0) {\n      stage.game.screen = new LevelUp(stage.game, this)\n    }\n  }\n\n  public die(): void {\n    super.die() // We do not want player to act after they death\n    this.dead = true\n  }\n\n  public rebuildVision(): void {\n    this.visionMask(this.currentLevel)\n  }\n}\n","import { Point, twoDimArray } from '../utils'\nimport { Creature, Phantom, Clan } from '../creature'\n\nimport { sample } from 'lodash'\nimport { MetaAI } from './meta_ai'\nimport { MemoryTile } from '../memory'\n\nconst FIRST_STEP: number = 1\n\ntype AIId = number\n\nexport abstract class AI {\n  private static lastId: AIId = 0\n  public static getId(): AIId {\n    return this.lastId++\n  }\n\n  constructor(public prevAI?: MetaAI, public id: AIId = AI.getId()) {}\n\n  public abstract act(actor: Creature, firstTurn: boolean): void\n\n  public abstract available(actor: Creature): boolean\n\n  public reset(): void {}\n\n  protected moveTo(actor: Creature, destination: Point): boolean {\n    // TODO: Rethink of it\n    if (actor.pos.eq(destination)) {\n      return true\n    }\n\n    const path = this.leePath(actor, point => destination.eq(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected followTo(actor: Creature, destination: Point): boolean {\n    const path = this.leePath(actor, point => destination.nextTo(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected leePath(\n    actor: Creature,\n    destination: (point: Point, tile: MemoryTile) => boolean,\n    randomDestination: boolean = false\n  ): Point[] {\n    const map = actor.stageMemory()\n\n    let stageMemory: number[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => undefined\n    )\n    let pointsToVisit: Point[] = []\n    let pointsToCheck: Point[] = [actor.pos]\n\n    let step = 0\n    while (pointsToCheck.length && !pointsToVisit.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        // TODO: Compare, current value might be lower\n        if (\n          tile.tangible(actor) ||\n          stageMemory[point.x][point.y] !== undefined\n        ) {\n          return\n        }\n\n        stageMemory[point.x][point.y] = step\n        if (destination(point, tile)) {\n          pointsToVisit.push(point)\n        } else {\n          point.wrappers().forEach(dist => wavePoints.push(dist))\n        }\n      })\n      step++\n\n      pointsToCheck = wavePoints\n    }\n\n    if (pointsToVisit.length) {\n      if (randomDestination) {\n        return this.buildRoad(sample(pointsToVisit), stageMemory)\n      } else {\n        return this.buildRoad(pointsToVisit[0], stageMemory)\n      }\n    } else {\n      return []\n    }\n  }\n\n  private buildRoad(point: Point, stageMemory: number[][]): Point[] {\n    let lastPoint = point\n    let chain = [lastPoint]\n\n    let delta: Point = undefined\n\n    while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n      delta = Point.dxy.find(\n        (dp): boolean => {\n          return (\n            stageMemory[lastPoint.x + dp.x] &&\n            stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n              stageMemory[lastPoint.x][lastPoint.y] - 1\n          )\n        }\n      )\n\n      if (!delta) {\n        return []\n      }\n\n      lastPoint = lastPoint.add(delta)\n\n      chain.unshift(lastPoint)\n    }\n\n    return chain\n  }\n\n  protected withinView(\n    actor: Creature,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    const map = actor.stageMemory()\n\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [actor.pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Phantom, enemy: Phantom): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan() === Clan.FreeForAll || enemy.clan() === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan() === Clan.Player && enemy.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan() === Clan.Player && actor.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination: Point = undefined\n\n  public available(actor: Creature): boolean {\n    return this.foundNewTarget(actor) || !!this.destination\n  }\n\n  public act(actor: Creature): void {\n    if (!this.destination) {\n      throw `FollowTargetAI's act got called when there is no destination!`\n    }\n\n    if (this.goTo(actor)) {\n      this.onMove(actor)\n      // If got the destination\n      if (this.destination.eq(actor.pos)) {\n        this.destination = undefined\n        this.onReach(actor)\n      }\n    } else {\n      // If can not move\n      this.destination = undefined\n      this.onCantMove(actor)\n    }\n  }\n\n  public reset(): void {\n    this.destination = undefined\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.moveTo(actor, this.destination)\n  }\n\n  protected abstract foundNewTarget(actor: Creature): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(actor: Creature): void {}\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(\n    metaAI: MetaAI,\n    protected matcher: (tile: MemoryTile) => boolean\n  ) {\n    super(metaAI)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    const path = this.leePath(actor, (point, tile) => this.matcher(tile), true)\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Phantom, Creature, Reaction, AttackEvent } from '../creature'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public available(actor: Creature): boolean {\n    return this.canAttack(actor)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.victimInAccess(actor)) {\n      this.attack(actor)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor)\n      this.act(actor, false)\n    }\n  }\n\n  protected attack(actor: Creature) {\n    if (this.victim.on(new AttackEvent(actor)) === Reaction.DIE) {\n      this.victim = undefined\n    }\n  }\n\n  private canAttack(actor: Creature): boolean {\n    const creature = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(actor: Creature): boolean {\n    if (this.victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      creature => creature.id === this.victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature) {\n    this.victim = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    ).real()\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): Phantom {\n    const memory = actor.stageMemory()\n    return actor.pos\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature())\n      .find(creature => creature && condition(creature))\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature, CreatureId } from '../creature'\nimport { Point } from '../utils'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  public reset(): void {\n    super.reset()\n    this.victimId = undefined\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor)) ||\n      this.foundNewVictim(actor)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): void {\n    this.victimId = undefined\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.followTo(actor, this.destination)\n  }\n\n  private buildVictimPath(actor: Creature): boolean {\n    return this.findCreature(actor, creature => creature.id === this.victimId)\n  }\n\n  private foundNewVictim(actor: Creature): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, creature => this.enemies(actor, creature)) &&\n      this.buildVictimPath(actor)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      const creature = tile.creature()\n\n      if (!result && creature && condition(creature)) {\n        this.destination = new Point(x, y)\n        this.victimId = creature.id\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../creature'\nimport { Item } from '../items/internal'\n\nexport enum AIEventType {\n  ItemPickedUp,\n}\n\nexport class AIEvent {\n  constructor(public type: AIEventType) {}\n}\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: Item[]) {\n    super(AIEventType.ItemPickedUp)\n  }\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI = null) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n}\n","import { remove, sum } from 'lodash'\nimport { Specie } from './creature'\nimport { Item } from './items'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, protected current: number = max) {}\n\n  public maximum(): number {\n    return this.max\n  }\n\n  public atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  public currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  public currentValue(): number {\n    const value = super.currentValue()\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n\nexport class AttributeSet<T> {\n  constructor(\n    public attack: T,\n    public defense: T,\n    public dexterity: T,\n    public health: T,\n    public radius: T,\n    public speed: T\n  ) {}\n\n  public with(pairSet: AttributeSet<any>, on: (first: T, second: any) => void) {\n    on(this.attack, pairSet.attack)\n    on(this.defense, pairSet.defense)\n    on(this.health, pairSet.health)\n    on(this.radius, pairSet.radius)\n    on(this.speed, pairSet.speed)\n  }\n}\n\nexport class Modifier extends AttributeSet<number> {\n  constructor({\n    attack = 0,\n    defense = 0,\n    dexterity = 0,\n    health = 0,\n    radius = 0,\n    speed = 0,\n  }) {\n    super(attack, defense, dexterity, health, radius, speed)\n  }\n\n  public withWeight(\n    pairSet: Modifier,\n    weight: Modifier,\n    on: (first: number, second: number, weight: number) => void\n  ) {\n    on(this.attack, pairSet.attack, weight.attack)\n    on(this.defense, pairSet.defense, weight.defense)\n    on(this.health, pairSet.health, weight.health)\n    on(this.radius, pairSet.radius, weight.radius)\n    on(this.speed, pairSet.speed, weight.speed)\n  }\n}\n\nexport class Characteristics extends AttributeSet<Attribute> {\n  constructor({ attack, defense, dexterity, health, radius, speed }) {\n    super(\n      new PositiveAttribute(attack),\n      new PositiveAttribute(defense),\n      new PositiveAttribute(dexterity),\n      new Attribute(health),\n      new PositiveAttribute(radius),\n      new PositiveAttribute(speed)\n    )\n  }\n\n  public addModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.addModifier(mod)\n      }\n    })\n  }\n\n  public removeModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.removeModifier(mod)\n      }\n    })\n  }\n\n  public damageTo(victim: Characteristics): number {\n    return Math.round(\n      (10 * this.attack.currentValue()) / victim.defense.currentValue()\n    )\n  }\n\n  public misses(victim: Characteristics): boolean {\n    let dex = this.dexterity.currentValue()\n\n    return (\n      Math.random() >\n      dex / (dex + Math.pow(victim.dexterity.currentValue() * 0.25, 0.8))\n    )\n  }\n\n  public throwMisses(victim: Characteristics): boolean {\n    return this.misses(victim)\n  }\n\n  public throwDamageTo(victim: Characteristics, missile: Item): number {\n    return 10\n  }\n\n  public regenerate(): void {\n    this.health.increase(this.regenerationValue())\n  }\n\n  protected regenerationValue(): number {\n    return 1\n  }\n\n  public regenerateEvery(): number {\n    return 8\n  }\n\n  public levelUp(specie: Specie) {\n    this.health.constantIncrease(3)\n\n    if (Math.random() > 0.5) {\n      this.attack.constantIncrease(1)\n    } else {\n      this.defense.constantIncrease(1)\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability } from '../creature'\nimport { Equipment, Usage } from '../items/internal'\nimport { Modifier } from '../characteristics'\nimport { Wearing } from '../inventory'\n\nexport class Wearer extends AI {\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.PutOn)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true) {\n    actor.inventory.cares().forEach(item => {\n      if (item instanceof Equipment) {\n        if (actor.inventory.canWear(item)) {\n          const wearing = this.whereToWear(actor, item)\n\n          if (wearing) {\n            // TODO: Use matching slot\n            actor.putOn(item)\n          }\n        }\n      }\n    })\n  }\n\n  private whereToWear(actor: Creature, item: Equipment): Wearing {\n    const matches = actor.inventory.matchingEquip(item)\n\n    if (matches.length === 0) {\n      return null\n    }\n\n    const weightModifier = new Modifier({\n      attack: 1,\n      defense: 1,\n      health: 1,\n      radius: 0.5,\n      speed: 1,\n    })\n\n    const { wearing } = matches.reduce(\n      (acc, wearing) => {\n        let weight = 0\n\n        if (wearing.equipment) {\n          item.modifier.withWeight(\n            wearing.equipment.modifier,\n            weightModifier,\n            (f, s, w) => (weight += w * (f - s))\n          )\n        } else {\n          item.modifier.with(weightModifier, (f, w) => (weight += f * w))\n        }\n\n        if (acc.weight > weight) {\n          return acc\n        } else {\n          return { weight, wearing }\n        }\n      },\n      { weight: 0, wearing: null }\n    )\n\n    return wearing\n  }\n}\n","import {\n  AI,\n  Attacker,\n  Chaser,\n  Escaper,\n  Explorer,\n  Loiter,\n  Picker,\n  Patrol,\n  SelfHealer,\n  Descender,\n  Thrower,\n} from '../ai'\nimport { Creature } from '../creature'\nimport { MetaAI, AIEventType } from './meta_ai'\nimport { Wearer } from './wearer'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  private firstCallPatrol: boolean = true\n\n  private step: number = 0\n\n  constructor() {\n    super()\n    this.escaper = new Escaper(this)\n    this.explorer = new Explorer(this)\n    this.chaser = new Chaser(this)\n    this.attacker = new Attacker(this)\n    this.picker = new Picker(this)\n    this.patrol = new Patrol(this)\n    this.loiter = new Loiter(this)\n    this.thrower = new Thrower(this)\n\n    this.descender = new Descender(this)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    // Never dispatch twice\n    if (!firstTurn) {\n      throw 'Meta AI called recursively'\n    }\n\n    this.step += 1\n\n    if (this.step % actor.characteristics.regenerateEvery() === 0) {\n      actor.characteristics.regenerate()\n    }\n\n    this.events.forEach(event => {\n      switch (event.type) {\n        case AIEventType.ItemPickedUp:\n          new Wearer(this).act(actor)\n      }\n    })\n\n    if (this.feelsGood(actor)) {\n      if (this.attacker.available(actor)) {\n        this.setAi(this.attacker)\n      } else if (this.thrower.available(actor)) {\n        this.setAi(this.thrower)\n      } else if (this.chaser.available(actor)) {\n        this.setAi(this.chaser)\n      } else if (this.seesItems(actor)) {\n        this.pickItem(actor)\n      } else {\n        this.explore(actor)\n      }\n    } else if (this.healthCritical(actor) && this.escaper.available(actor)) {\n      this.setAi(this.escaper)\n    } else if (this.attacker.available(actor)) {\n      this.setAi(this.attacker)\n    } else if (this.thrower.available(actor)) {\n      this.setAi(this.thrower)\n    } else if (this.chaser.available(actor)) {\n      this.setAi(this.chaser)\n    } else {\n      this.rest(actor)\n    }\n\n    this.resetEvents()\n    this.aiToRun.act(actor, firstTurn)\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() >\n      actor.characteristics.health.maximum() * 0.9\n    )\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() <\n      actor.characteristics.health.maximum() / 4\n    )\n  }\n\n  private seesItems(actor: Creature): boolean {\n    return this.picker.available(actor)\n  }\n\n  private pickItem(actor: Creature): void {\n    this.setAi(this.picker)\n  }\n\n  private explore(actor: Creature): void {\n    if (this.explorer.available(actor)) {\n      this.patrol.trackMovement(actor)\n      this.setAi(this.explorer)\n    } else if (this.descender.available(actor)) {\n      this.setAi(this.descender)\n    } else if (this.patrol.available(actor)) {\n      if (this.firstCallPatrol) {\n        this.firstCallPatrol = false\n        this.patrol.addNode(actor.pos.x, actor.pos.y)\n      }\n      this.setAi(this.patrol)\n    } else {\n      this.setAi(this.loiter)\n    }\n  }\n\n  private rest(actor: Creature): void {\n    this.setAi(new SelfHealer(this))\n  }\n\n  private setAi(ai: AI): void {\n    if (this.aiToRun && this.aiToRun.id !== ai.id) {\n      this.aiToRun.reset()\n    }\n\n    this.aiToRun = ai\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature } from '../creature'\n\nimport { sumBy } from 'lodash'\nimport { Point } from '../engine'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Phantom][] = []\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return this.foundEnemies(actor) && this.buildPath(actor)\n  }\n\n  private buildPath(\n    actor: Creature,\n    minDistance: number = actor.radius() / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.leePath(\n      actor,\n      ({ x, y }) => {\n        const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n          // I don't use pathfinding since it should try\n          // to run away from those who are visible, so the path\n          // to them should be straightforward.\n          return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n        })\n\n        return score >= minDistance\n      },\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildPath(actor, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature): boolean {\n    this.escapesFrom = []\n\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (creature && this.enemies(actor, creature)) {\n        this.escapesFrom.push([point, creature])\n      }\n    })\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from '../ai'\nimport { MetaAI } from './meta_ai'\n\nexport class Explorer extends GoToTileAI {\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => !tile.seen)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Loiter extends AI {\n  // private turns: number = 0\n\n  act(actor: Creature, firstTurn: boolean = true): void {\n    // if (this.turns > 1) {\n    //   actor.ai = this.prevAI\n    //   this.prevAI.act(actor, false)\n    //   return\n    // }\n\n    const path = this.leePath(actor, point => !actor.pos.eq(point), true)\n\n    if (path.length) {\n      // this.turns += 1\n      actor.move(path[0])\n    }\n  }\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, rand, succ } from '../utils'\nimport { Creature } from '../creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { MetaAI } from './meta_ai'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n\n  constructor(ai: MetaAI) {\n    super(ai)\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public available(actor: Creature): boolean {\n    return this.graph.nodes().length > 1\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.path.length) {\n      this.moveToTarget(actor, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor)\n      this.moveToTarget(actor, firstTurn)\n    }\n    this.step += 1\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(actor: Creature): void {\n    if (this.step >= NEW_POINT_EVERY || this.shouldAddNode(actor)) {\n      this.addNode(actor.pos.x, actor.pos.y)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(x: number, y: number): void {\n    this.graph.setNode(this.i, new Point(x, y))\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.i = succ(this.i)\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature): void {\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.leePath(actor, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature): void {\n    let seenLastID: NodeID = this.graph.nodes()[0]\n    let seenLastStep: number = this.lastNodeVisit[seenLastID]\n\n    this.graph.neighbors(this.currentNodeID).forEach((nodeID: NodeID) => {\n      if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n        seenLastID = nodeID\n        seenLastStep = this.lastNodeVisit[seenLastID]\n      }\n    })\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor)\n  }\n\n  private moveToTarget(actor: Creature, firstTurn: boolean): void {\n    const nextPoint: Point = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        this.act(actor, false)\n      } else {\n        new Loiter(this.prevAI).act(actor, firstTurn)\n      }\n    } else if (\n      actor\n        .stageMemory()\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath\n\n      if (this.path.length) {\n        return this.act(actor, false)\n      }\n    } else {\n      actor.move(nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n\n  private shouldAddNode(actor: Creature): boolean {\n    return actor\n      .stageMemory()\n      .at(actor.previousPos.x, actor.previousPos.y)\n      .tile.isDoor()\n  }\n}\n","import { FollowTargetAI } from '../ai'\nimport { Creature, Ability } from '../creature'\nimport { Item, ItemId } from '../items'\nimport { Point } from '../utils'\nimport { AIItemPickedEvent } from './meta_ai'\n\nexport class Picker extends FollowTargetAI {\n  private desiredItemId: ItemId = null\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.Inventory) && super.available(actor)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return (\n      this.findItem(actor, item => item.id === this.desiredItemId) ||\n      this.findItem(actor, item => true)\n    )\n  }\n\n  protected onReach(actor: Creature): void {\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    this.prevAI.pushEvent(new AIItemPickedEvent(tile.items))\n\n    tile.items.forEach(item => {\n      actor.inventory.putToBag(item)\n    })\n\n    tile.items = []\n\n    this.desiredItemId = null\n  }\n\n  private findItem(\n    actor: Creature,\n    condition: (item: Item) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      const item = tile.items().find(condition)\n\n      if (item && !result) {\n        this.desiredItemId = item.id\n        this.destination = new Point(x, y)\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from '../ai'\nimport { Creature } from '../creature'\n\nexport class SelfHealer extends AI {\n  public available(actor: Creature): boolean {\n    return !actor.characteristics.health.atMax()\n  }\n\n  public act(actor: Creature): void {\n    // Does nothing, just waiting\n    // actor.characteristics.regenerate()\n  }\n}\n","import { GoToTileAI, MetaAI } from '../ai'\nimport { Ability, Creature, StairwayDown, TileTypes } from '../engine'\n\nexport class Descender extends GoToTileAI {\n  private canDescend: boolean = false\n\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => tile.tile.kind === TileTypes.StairwayDown)\n  }\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.GoStairwayDown) && super.available(actor)\n  }\n\n  public reset(): void {\n    super.reset()\n    this.canDescend = false\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // When we are on a stairway\n    this.canDescend = this.matcher(\n      actor.stageMemory().at(actor.pos.x, actor.pos.y)\n    )\n\n    if (this.canDescend) {\n      this.destination = actor.pos\n      return true\n    } else {\n      return super.foundNewTarget(actor)\n    }\n  }\n\n  protected onReach(actor: Creature) {\n    // Should stay here at least for a turn\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    if (this.canDescend && tile instanceof StairwayDown) {\n      tile.go(actor)\n    }\n  }\n}\n","import { Item } from './items/internal'\nimport { Point } from './utils'\nimport { Memory } from './memory'\n\nexport abstract class Effect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightEffect extends Effect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { AI } from './internal'\nimport {\n  Creature,\n  Ability,\n  CreatureId,\n  Phantom,\n  Reaction,\n  ThrowEvent,\n} from '../creature'\nimport { Usage, Equipment, Item } from '../items/internal'\nimport { Point, bresenham } from '../utils'\nimport { ItemFlightEffect } from '../effect'\n\nexport class Thrower extends AI {\n  public victim: Creature\n  public previousVictim: Creature\n  public missiles: Equipment[]\n\n  public available(actor: Creature): boolean {\n    return (\n      actor.can(Ability.Throwing) &&\n      this.hasMissile(actor) &&\n      this.canAttack(actor)\n    )\n  }\n\n  public act(actor: Creature): void {\n    const missile = this.missiles.pop()\n\n    // TODO: TEST IT!\n    // actor.inventory.takeOff(actor, missile)\n    // actor.inventory.removeFromBag(missile)\n\n    let path = []\n\n    bresenham(actor.pos, this.victim.pos, (x, y) => path.push(new Point(x, y)))\n\n    const effect = new ItemFlightEffect(missile, path, () => {\n      if (this.victim.on(new ThrowEvent(actor, missile)) === Reaction.DIE) {\n        this.victim = undefined\n        this.previousVictim = undefined\n      }\n    })\n\n    actor.currentLevel.addEffect(effect)\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.inventory.inSlot(Usage.Throw)\n    return this.missiles.length > 0\n  }\n\n  private canAttack(actor: Creature): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (\n        this.findCreature(\n          actor,\n          creature => this.previousVictim.id === creature.id\n        )\n      ) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, creature => this.enemies(actor, creature))\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, point)\n      ) {\n        this.victim = actor.currentLevel.at(point.x, point.y).creature.real()\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(actor: Creature, target: Point): boolean {\n    let obstacles = false\n\n    bresenham(actor.pos, target, (x, y) => {\n      obstacles =\n        obstacles ||\n        actor\n          .stageMemory()\n          .at(x, y)\n          .tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import { Phantom, Creature } from './creature'\nimport { Item } from './items'\nimport { Point } from './utils'\nimport { LevelMap } from './map'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n}\n\nexport class Tile {\n  public creature?: Phantom\n  public items: Item[] = []\n\n  private static repository: { [key: string]: Tile } = {}\n\n  public static retrieve(key: string): Tile {\n    switch (key) {\n      case 'R':\n        return new Tile('R', ' ', TileTypes.Floor)\n      case 'C':\n        return new Tile('C', ' ', TileTypes.Floor)\n      case 'W':\n        return new Tile('W', '#', TileTypes.Wall)\n      case 'D':\n        return new Tile('D', '+', TileTypes.Door)\n      case '>':\n        return new Tile('>', '>', TileTypes.StairwayDown)\n      case '<':\n        return new Tile('<', '<', TileTypes.StairwayUp)\n      default:\n        throw `Tile '${key}' is not registered!`\n    }\n  }\n\n  protected constructor(\n    public key: string,\n    public display: string,\n    public kind: TileTypes\n  ) {}\n\n  public addItem(item: Item): void {\n    this.items.push(item)\n  }\n\n  public isDoor(): boolean {\n    return this.kind === TileTypes.Door\n  }\n\n  public isWall(): boolean {\n    return this.kind === TileTypes.Wall\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public visibleThrough(): boolean {\n    return (\n      this.isFloor() ||\n      this.kind === TileTypes.StairwayDown ||\n      this.kind === TileTypes.StairwayUp\n    )\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public clone(): Tile {\n    let tile = Tile.retrieve(this.key)\n    if (this.creature) {\n      tile.creature = this.creature.clone()\n    }\n    this.items.forEach(item => tile.items.push(item.clone()))\n    return tile\n  }\n\n  protected uniq(): boolean {\n    return this.creature !== undefined\n  }\n}\n\nabstract class Stairway extends Tile {\n  protected currentMap: LevelMap\n  protected adjacentMap: LevelMap\n  protected enterPos: Point\n\n  public go(actor: Creature): void {\n    this.currentMap.leave(actor)\n    this.adjacentMap.enter(actor, this.enterPos)\n\n    this.adjacentMap.game.currentMap = this.adjacentMap\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(\n    protected currentMap: LevelMap,\n    protected adjacentMap: LevelMap,\n    protected enterPos: Point\n  ) {\n    super('>', '>', TileTypes.StairwayDown)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(\n    protected currentMap: LevelMap,\n    protected adjacentMap: LevelMap,\n    protected enterPos: Point\n  ) {\n    super('<', '<', TileTypes.StairwayUp)\n  }\n}\n","import * as moment from 'moment'\nimport { Creature } from './creature'\nimport { Moment } from 'moment'\nimport { Item } from './items/internal'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport class LogMessage {\n  constructor(\n    public level: LogLevel,\n    public ts: Moment,\n    public message: string\n  ) {}\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name()} got ${damage} damage from ${actor.name()}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} causes them to die`\n    )\n  }\n\n  public missMessage(actor: Creature, target: Creature) {\n    this.debug(`${actor.name()} misses ${target.name()}!`)\n  }\n\n  public throwMissMessage(actor: Creature, target: Creature, missile: Item) {\n    this.debug(\n      `${actor.name()} throws ${missile.name} in ${target.name()}, but misses!`\n    )\n  }\n\n  public throwKillMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public throwHurtMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.debug(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      }`\n    )\n  }\n\n  protected debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  protected info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  protected warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  protected danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    this.messages.push(new LogMessage(level, moment(), message))\n  }\n}\n","import { forEach, keys, min, remove, size, pullAt } from 'lodash'\n\nexport class Timeline<T> {\n  private step: number = 0\n  private turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      this.turns[ts].push(item)\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n  }\n\n  public next(): T {\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from './utils'\nimport { Timeline } from './timeline'\nimport { Game } from './game'\nimport { Tile } from './tile'\n\nimport { remove } from 'lodash'\nimport { Effect } from './engine'\n\nexport type LevelMapId = number\n\nexport type TimeEvent = [CreatureId, Effect]\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public id: LevelMapId\n  public game: Game\n  protected timeline: Timeline<TimeEvent>\n\n  private static lastId: LevelMapId = 0\n  public static getId(): LevelMapId {\n    return this.lastId++\n  }\n\n  constructor(map: Tile[][]) {\n    super(map)\n    this.id = LevelMap.getId()\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public leave(actor: Creature): void {\n    this.reset()\n    this.removeCreature(actor)\n  }\n\n  public enter(actor: Creature, enterPos: Point): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add([creature.id, undefined], creature.speed())\n    )\n\n    actor.addToMap(enterPos, this)\n  }\n\n  public addCreature(creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(creature.pos.x, creature.pos.y).creature = creature\n    this.timeline.add([creature.id, undefined], creature.speed())\n  }\n\n  public removeCreature(creature: Creature) {\n    let tile = this.at(creature.pos.x, creature.pos.y)\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove([creature.id, undefined])\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public addEffect(effect: Effect): void {\n    this.timeline.add([undefined, effect], effect.speed())\n  }\n\n  public turn(): void {\n    if (this.game.screen) {\n      return\n    }\n\n    const [actorId, effect] = this.timeline.next()\n\n    if (actorId !== undefined) {\n      const actor = this.creatures.find(creature => actorId === creature.id)\n\n      if (actor) {\n        actor.act(this)\n\n        // If they are still on a map\n        if (this.creatures.find(creature => actorId === creature.id)) {\n          this.timeline.add([actorId, undefined], actor.speed())\n        }\n      }\n\n      this.game.player.rebuildVision()\n    } else if (effect) {\n      if (effect.done()) {\n        effect.onDone()\n      } else {\n        this.timeline.add([undefined, effect], effect.speed())\n      }\n\n      this.game.player.rebuildVision()\n      effect.patchMemory(this.game.player.stageMemory())\n    } else {\n      throw 'Timeline event is empty!'\n    }\n  }\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number {\n    if (this.doneLeveling) {\n      return\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = 0\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      levelUps += 1\n      this.levelUp()\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { Tile } from './tile'\nimport { Item } from './items'\nimport { Creature, Phantom, Mapped, twoDimArray } from './engine'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile?: Tile) {}\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public items(): Item[] {\n    return this.tile.items\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public creature(): Phantom {\n    return this.tile && this.tile.creature\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = Tile.retrieve('W')\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { Logger, LevelMap, Player } from './engine'\nimport { Screen, LevelUp } from './screen'\nimport { ProfessionPicker } from './profession';\n\nexport abstract class Game {\n  public logger: Logger = new Logger()\n  public currentMap: LevelMap\n  public player: Player\n  public screen: Screen\n\n  constructor(\n    public professionPicker: ProfessionPicker,\n  ) {\n    this.screen = null\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (Input) => Output][] = []\n\n  constructor(items: [number, (Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    return this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })[1](input)\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import { Player } from './creature';\n\nexport class Profession {\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1\n  ) {}\n}\n\nexport abstract class ProfessionPicker {\n  public abstract available(player: Player): Profession[]\n}\n","import { LevelMap, Tile, StairwayDown, StairwayUp } from '../engine'\nimport { Pool } from '../pool'\nimport { Creature } from '../creature'\nimport { Point, cycle } from '../utils'\nimport { Item } from '../items/internal'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, Tile.retrieve('D'))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        creaturesPool.pick(null).addToMap(new Point(i, j), level)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\nexport const addOnTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n\nexport const connectMaps = function(map1: LevelMap, map2: LevelMap) {\n  addOnTile(\n    map1,\n    tile => tile.isFloor() && tile.passibleThrough(),\n    (dx, dy) => {\n      let downTile\n\n      addOnTile(\n        map2,\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (ux, uy) => {\n          const upTile = new StairwayUp(map2, map1, new Point(dx, dy))\n          map2.setTile(ux, uy, upTile)\n\n          downTile = new StairwayDown(map1, map2, new Point(ux, uy))\n        }\n      )\n\n      map1.setTile(dx, dy, downTile)\n    }\n  )\n}\n","import { twoDimArray } from '../utils'\nimport { LevelMap, Tile } from '../engine'\n\nexport default function(drawMap: string[]): LevelMap {\n  return new LevelMap(\n    twoDimArray(drawMap[0].length, drawMap.length, (x, y) =>\n      Tile.retrieve(drawMap[y].charAt(x))\n    )\n  )\n}\n","import { Rect, Point, rand, min, twoDimArray } from '../utils'\nimport { LevelMap, Tile } from '../engine'\n\nconst THICKNESS = 0\n\nconst newRoomSpace = function(): Tile {\n  return Tile.retrieve('R')\n}\n\nconst newCorridor = function(): Tile {\n  return Tile.retrieve('C')\n}\n\nconst newWall = function(): Tile {\n  return Tile.retrieve('W')\n}\n\ntype Stage = Tile[][]\n\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: Stage): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: Stage): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (stage[hx + i][hy].key === 'W') {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (stage[vx][vy + j].key === 'W') {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator {\n  rooms: Array<Room>\n  roads: Array<Road>\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room[]): Room[] {\n    return rooms.reduce((pickedRooms: Room[], currentRoom: Room) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room[]): Room[] {\n    const minX = min(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room) => room.x + room.w < this.maxX)\n\n    const minY = min(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room[]): Road[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    let connectedPoints: Point[] = [points.shift()]\n    let roads: Road[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let currentPoint = points.shift()\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number\n): LevelMap {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator(dimX, dimY, minSize, maxSize, roomsCount)\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n\n  for (let i = 0; i < dungeon.rooms.length; i++) dungeon.rooms[i].add(stage)\n\n  for (let i = 0; i < dungeon.roads.length; i++) dungeon.roads[i].add(stage)\n\n  return new LevelMap(stage)\n}\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { takeRight } from 'lodash'\n\nimport { LogLevel } from '../src/engine'\n\nimport * as moment from 'moment'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: ['logger'],\n  computed: {\n    messages() {\n      return takeRight(this.logger.messages, 5)\n    }\n  },\n  methods: {\n    ts(record) {\n      return moment(record.ts).format(\"hh:mm:ss\")\n    },\n    rowClass(record) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'table-secondary'\n        case LogLevel.INFO:\n          return 'table-info'\n        case LogLevel.WARNING:\n          return 'table-warning'\n        case LogLevel.DANGER:\n          return 'table-danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=3e0edcb8\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"container\",staticClass:\"logger\"},[_c('table',{staticClass:\"table table-sm table-striped\"},[_c('tbody',_vm._l((_vm.messages),function(record,i){return _c('tr',{key:i,class:_vm.rowClass(record)},[_c('td',[_vm._v(_vm._s(_vm.ts(record)))]),_vm._v(\" \"),_c('td',[_vm._v(_vm._s(record.message))])])}))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Tile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n} from '../src/engine'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends Tile {\n  public lighted(degree: number): Tile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: Tile, degree: number): Tile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: Tile, degree: number): Tile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDown extends DisplayTile {\n  constructor() {\n    super('')\n  }\n}\n\nexport class StairwayUp extends DisplayTile {\n  constructor() {\n    super('')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('', 200, 200, 200)\nconst CORPSE = new ItemTile('', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('', 200, 200, 200)\nconst MISSILE = new ItemTile('', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    default:\n      throw `Unknown group ${item} with type ${item.group}`\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  displayItem,\n} from './scene_tiles'\n\nimport {\n  BodyPart,\n\n  Patrol,\n  Explorer,\n  Waiter,\n  Chaser,\n  Escaper,\n  Loiter,\n  Dispatcher,\n  Picker,\n  SelfHealer,\n  Attacker,\n  Thrower,\n} from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature'],\n  computed: {\n  },\n  methods: {\n    aiName(ai) {\n      if (ai instanceof Patrol) {\n        return 'Patrol'\n      }\n      if (ai instanceof Escaper) {\n        return 'Escaper'\n      }\n      if (ai instanceof Chaser) {\n        return 'Chaser'\n      }\n      if (ai instanceof Explorer) {\n        return 'Explorer'\n      }\n      if (ai instanceof Waiter) {\n        return 'Waiter'\n      }\n      if (ai instanceof Loiter) {\n        return `Loiter`\n      }\n      if (ai instanceof Dispatcher) {\n        return `Dispatcher (${this.aiName(ai.aiToRun)})`\n      }\n      if (ai instanceof Attacker) {\n        return `Attacker`\n      }\n      if (ai instanceof SelfHealer) {\n        return `SelfHealer`\n      }\n      if (ai instanceof Picker) {\n        return 'Picker'\n      }\n      if (ai instanceof Thrower) {\n        return 'Thrower'\n      }\n    },\n    displayItem(item) {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    displayAttribute(attribute) {\n      if (attribute.currentValue() != attribute.maximum()) {\n        return `${attribute.currentValue()} [${attribute.maximum()}]`\n      } else {\n        return attribute.currentValue()\n      }\n    },\n    displayAttributeWithModifiers(attribute) {\n      if (attribute.currentValue() != attribute.maximum()) {\n        const mods = attribute.modifiers.map(x => x > 0 ? `+ ${x}` : `- ${x}`)\n        return `${attribute.currentValue()} = [${attribute.maximum()}] ${mods}`\n      } else {\n        return attribute.currentValue()\n      }\n    },\n    groupedCares(cares) {\n      let grouped = {}\n\n      cares.forEach(item => {\n        if (grouped[item.name]) {\n          grouped[item.name] += 1\n        } else {\n          grouped[item.name] = 1\n        }\n      })\n\n      return grouped\n    },\n    displayBodyPart(bodyPart) {\n      switch (bodyPart) {\n        case BodyPart.LeftHand:\n          return ''\n        case BodyPart.RightHand:\n          return ''\n        case BodyPart.Legs:\n          return ''\n        case BodyPart.Finger:\n          return ''\n        case BodyPart.Head:\n          return ''\n        case BodyPart.Eye:\n          return ''\n        case BodyPart.Neck:\n          return ''\n        case BodyPart.Back:\n          return ''\n        case BodyPart.Body:\n          return ''\n        case BodyPart.MissileWeapon:\n          return 'MissileWeapon'\n        case BodyPart.Missile:\n          return 'Missile'\n        default:\n          throw `Unknow body part ${bodyPart}`\n      }\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts\"","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Waiter extends AI {\n  act(actor: Creature): void {}\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { render, staticRenderFns } from \"./stats.vue?vue&type=template&id=ef456fa4\"\nimport script from \"./stats.vue?vue&type=script&lang=ts\"\nexport * from \"./stats.vue?vue&type=script&lang=ts\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('dl',{staticClass:\"row small\"},[_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    ID\\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.creature.id)+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    POS\\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.creature.pos)+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    Level\\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.creature.level.current)+\" [\"+_vm._s(_vm.creature.level.currentExperience)+\" - \"+_vm._s(_vm.creature.level.requiredExperience)+\"]\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.displayAttribute(_vm.creature.characteristics.health))+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.displayAttributeWithModifiers(_vm.creature.characteristics.attack))+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.displayAttributeWithModifiers(_vm.creature.characteristics.defense))+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.displayAttributeWithModifiers(_vm.creature.characteristics.speed))+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    AI\\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n    \"+_vm._s(_vm.aiName(_vm.creature.ai))+\"\\n  \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_c('table',_vm._l((_vm.creature.inventory.wears()),function(wearing,i){return _c('tr',{key:\"bodyPart\" + i},[_c('td',[_vm._v(\"\\n          \"+_vm._s(_vm.displayBodyPart(wearing.bodyPart))+\"\\n        \")]),_vm._v(\" \"),_c('td',[_vm._v(\"\\n          \"+_vm._s(_vm.displayItem(wearing.equipment))+\"\\n        \")])])}))]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_c('ul',_vm._l((_vm.groupedCares(_vm.creature.inventory.cares())),function(count,name){return _c('li',{key:name},[_vm._v(\"\\n          \"+_vm._s(name)+\" \"+_vm._s(count === 1 ? '' : (\": \" + count))+\"\\n      \")])}))]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n    \\n  \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_c('ul',_vm._l((_vm.creature.professions),function(profession){return _c('li',{key:profession.name},[_vm._v(\"\\n          \"+_vm._s(profession.name)+\" \"+_vm._s(profession.level)+\"\\n      \")])}))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport Stats from './stats.vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  DoorTile,\n  FloorTile,\n  ItemTile,\n  WallTile,\n  StairwayUp,\n  StairwayDown,\n  DisplayTile,\n\n  displayItem,\n} from './scene_tiles'\n\nconst HUMAN  = new CreatureTile('', 0, 255, 0)\nconst HUMAN2 = new CreatureTile('', 255, 0, 0)\nconst HUMAN3 = new CreatureTile('', 0, 0, 255)\nconst HUMAN4 = new CreatureTile('', 255, 0, 255)\nconst HUMAN5 = new CreatureTile('', 0, 255, 255)\n\nconst RAT = new CreatureTile('', 197, 65, 38)\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDown()\nconst STAIRWAY_UP = new StairwayUp()\nconst NULLTILE = new DisplayTile('', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      fps: 0,\n      counter: 0,\n      interval: 100,\n      nextStep: false,\n      step: 0,\n      pause: false,\n    }\n  },\n  components: {\n    Stats\n  },\n  methods: {\n    getTile(x, y) {\n      const effect = this.stage.at(x, y).effect\n      if (effect) {\n        return new DisplayTile(effect, 200, 200, 0)\n      }\n\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULLTILE\n      }\n\n      if (tile.creature) {\n        if (tile.creature.name() == 'Rat') {\n          return RAT\n        }\n\n        switch (tile.creature.id % 5) {\n          case 0:\n            return HUMAN5\n          case 1:\n            return HUMAN4\n          case 2:\n            return HUMAN3\n          case 3:\n            return HUMAN2\n          case 4:\n            return HUMAN\n        }\n      }\n\n      if (tile.items.length) {\n        if (tile.items.length === 1) {\n          return displayItem(tile.items[0])\n        }\n\n        const frame = this.step % (this.animationFps * 3 + 4)\n        if (frame < nextItemAnimation.length) {\n          return nextItemAnimation[frame]\n        } else {\n          const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n          return displayItem(tile.items[itemId % tile.items.length])\n        }\n      }\n\n      switch (tile.display) {\n      case '#':\n        return WALL\n      case '+':\n        return DOOR\n      case ' ':\n        return FLOOR\n      case '<':\n        return STAIRWAY_UP\n      case '>':\n        return STAIRWAY_DOWN\n      default:\n        return NULLTILE\n      }\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        this.level.width,\n        this.level.height,\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x, y) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      if (this.done) { return }\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.fps = this.counter\n        this.counter = 0\n        this.ts = ts\n      }\n\n      this.done = true\n      if (!this.pause || this.nextStep) {\n        this.nextStep = false\n\n        this.level.turn()\n      }\n\n      // this.eng.update(this.player.x, this.player.y);\n      this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.done = false\n      this.counter += 1\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level.id)\n    },\n    animationFps() {\n      return 1000 / this.interval\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=01e18adb\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"scene\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col mr-0\"},[_c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})]),_vm._v(\" \"),_c('div',{staticClass:\"col pl-0\"},[_c('div',{staticClass:\"fps mb-2 \"},[_vm._v(\"FPS \"+_vm._s(_vm.fps))]),_vm._v(\" \"),_c('div',[_vm._v(\"MAP \"+_vm._s(_vm.level.id))]),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.wholeMap),expression:\"wholeMap\"}],attrs:{\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.wholeMap)?_vm._i(_vm.wholeMap,null)>-1:(_vm.wholeMap)},on:{\"change\":function($event){var $$a=_vm.wholeMap,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.wholeMap=$$a.concat([$$v]))}else{$$i>-1&&(_vm.wholeMap=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.wholeMap=$$c}}}}),_vm._v(\" \"),_c('Stats',{attrs:{\"creature\":_vm.player}}),_vm._v(\" \"),_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-2\"},[_vm._v(\"Map\")]),_vm._v(\" \"),_c('div',{staticClass:\"col-sm-10\"},[_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.interval),expression:\"interval\"}],staticClass:\"form-control\",attrs:{\"id\":\"interval\",\"type\":\"number\"},domProps:{\"value\":(_vm.interval)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.interval=$event.target.value}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"interval\"}},[_vm._v(\"\\n              Tick interval\\n            \")])]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-secondary\",on:{\"click\":function($event){_vm.nextStep = true}}},[_vm._v(\"\\n            Next step\\n          \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-secondary\",on:{\"click\":function($event){_vm.pause = !_vm.pause}}},[_vm._v(\"\\n            \"+_vm._s(_vm.pause ? 'Start' : 'Pause')+\"\\n          \")])])])],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LevelUp.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LevelUp.vue?vue&type=script&lang=ts\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport * as _ from 'lodash'\n\nimport Cell from './Cell.vue'\nimport Logger from './Logger.vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  computed: {\n    valid() {\n      return\n    }\n  },\n  methods: {\n    close() {\n      this.screen.onInput(this.picked)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./LevelUp.vue?vue&type=template&id=26c11674\"\nimport script from \"./LevelUp.vue?vue&type=script&lang=ts\"\nexport * from \"./LevelUp.vue?vue&type=script&lang=ts\"\nimport style0 from \"./LevelUp.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"level-up text-center\"},[_c('div',_vm._l((_vm.screen.options),function(option){return _c('span',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option}}},[_vm._v(\"\\n      \"+_vm._s(option.name)+\"\\n    \")])})),_vm._v(\" \"),(_vm.picked !== null)?_c('a',{on:{\"click\":_vm.close}},[_vm._v(\"\")]):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import {\n  dungeon,\n  drawn,\n  addDoors,\n  addCreatures,\n  addItems,\n  centralize,\n  addOnTile,\n  connectMaps,\n  Creature,\n  Clan,\n  Player,\n  Specie,\n  allAbilities,\n  Dispatcher,\n  OneHandWeapon,\n  Item,\n  LevelMap,\n  Pool,\n  BodyArmor,\n  Modifier,\n  Characteristics,\n  Game,\n  Point,\n  Level,\n  Ability,\n  Missile,\n  ProfessionPicker,\n  Profession,\n} from './engine'\nimport { includes, sample } from 'lodash'\n\nexport type GeneratorOptions = {\n  minSize: number\n  maxSize: number\n  roomsCount: number\n\n  addDoors: boolean\n}\n\nexport let baseConfig = {\n  addDoors: false,\n  minSize: 3,\n  maxSize: 10,\n  roomsCount: 10,\n}\n\nconst weapons = new Pool<null, Item>([\n  [1, () => new OneHandWeapon('Katana', new Modifier({ attack: 10 }))],\n  [3, () => new OneHandWeapon('Axe', new Modifier({ attack: 7 }))],\n  [7, () => new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))],\n  [5, () => new OneHandWeapon('Hammer', new Modifier({ attack: 5 }))],\n])\n\nconst itemsPool = new Pool<null, Item>([\n  [1, () => new BodyArmor('', new Modifier({ defense: 10 }))],\n  [5, () => new BodyArmor('', new Modifier({ defense: 5 }))],\n  [10, () => new BodyArmor('', new Modifier({ defense: 1 }))],\n])\n\nconst newCreature = (characteristics: Characteristics, name: string) => {\n  return new Creature(\n    characteristics,\n    new Dispatcher(),\n    new Specie(name, Clan.PlayerOnlyEnemy, [])\n  )\n}\n\nconst floatingEye = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 100,\n      radius: 5,\n      speed: 200,\n    }),\n    'Floating eye'\n  )\n}\n\nconst rat = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 1,\n      radius: 5,\n      speed: 90,\n    }),\n    'Rat'\n  )\n}\n\nconst orc = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 3,\n      defense: 3,\n      dexterity: 2,\n      health: 5,\n      radius: 5,\n      speed: 100,\n    }),\n    'Orc'\n  )\n}\n\nconst undead = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 2,\n      defense: 7,\n      dexterity: 1,\n      health: 10,\n      radius: 5,\n      speed: 120,\n    }),\n    'Undead'\n  )\n}\n\nconst robot = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 5,\n      defense: 5,\n      dexterity: 3,\n      health: 7,\n      radius: 7,\n      speed: 90,\n    }),\n    'Robot'\n  )\n}\n\nconst dragon = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 7,\n      defense: 7,\n      dexterity: 7,\n      health: 30,\n      radius: 5,\n      speed: 100,\n    }),\n    'Dragon'\n  )\n}\n\nconst creaturesPool1 = new Pool<null, Creature>([[1, rat]])\nconst creaturesPool2 = new Pool<null, Creature>([[1, rat], [2, orc]])\nconst creaturesPool3 = new Pool<null, Creature>([\n  [1, rat],\n  [1, orc],\n  [2, undead],\n])\nconst creaturesPool4 = new Pool<null, Creature>([[2, undead], [2, robot]])\nconst creaturesPool5 = new Pool<null, Creature>([[2, robot], [1, dragon]])\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    private pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number,\n  ) {\n    super()\n  }\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n\n    if (this.canUpdate(player)) {\n      professions.push(this.updatableProfession(player))\n    } else if (this.canTakeNewProfession(player)) {\n      professions.push(this.newFromPool(player))\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      professions.push(this.newFromPool(player, professions.map(profession => profession.id)))\n    } else if (this.canUpdate(player)) {\n      professions.push(this.updatableProfession(player, professions.map(profession => profession.id)))\n    }\n\n    return professions\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(profession => profession.level < this.maxLevel)\n  }\n\n  protected updatableProfession(player: Player, excludeProfessions: number[] = []): Profession {\n    return sample(player.professions.filter(profession => player.professions.length < this.maxTaken && !includes(excludeProfessions, profession.id)))\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return player.professions.length < this.maxTaken\n  }\n\n  protected newFromPool(player: Player, excludeProfessions: number[] = []): Profession {\n    const excluding = excludeProfessions.concat(player.professions.map(profession => profession.id))\n    return sample(this.pool.filter(profession => !includes(excluding, profession.id)))\n  }\n}\n\nexport class Onisun extends Game {\n  constructor(generatorOptions: GeneratorOptions) {\n    let pool: Profession[] = [];\n\n    [\n      'Lorem',\n      'ipsum',\n      'dolor',\n\n      'sit',\n      'amet',\n      'consectetur',\n\n      'adipiscing',\n      'elit',\n      'Suspendisse',\n\n      'dignissim',\n      'mi',\n      'tincidunt',\n    ].forEach((name, i) => {\n      pool.push(new Profession(i, name, 1))\n    })\n\n    super(new OnisunProfessionPicker(pool, 3, 6))\n\n    this.player = this.initPlayer()\n\n    let map1 = this.generateMap(generatorOptions)\n    let map2 = this.generateMap(generatorOptions)\n    let map3 = this.generateMap(generatorOptions)\n    let map4 = this.generateMap(generatorOptions)\n    let map5 = this.generateMap(generatorOptions)\n\n    addCreatures(0.05, map1, creaturesPool1)\n    addCreatures(0.06, map2, creaturesPool2)\n    addCreatures(0.07, map3, creaturesPool3)\n    addCreatures(0.08, map4, creaturesPool4)\n    addCreatures(0.09, map5, creaturesPool5)\n\n    connectMaps(map1, map2)\n    connectMaps(map2, map3)\n    connectMaps(map3, map4)\n    connectMaps(map4, map5)\n\n    this.currentMap = map1\n\n    // floatingEye().addToMap(new Point(1, 3), this.currentMap)\n\n    // this.player.addToMap(new Point(9, 3), this.currentMap)\n\n    addOnTile(\n      this.currentMap,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        this.player.addToMap(new Point(x, y), this.currentMap)\n      }\n    )\n  }\n\n  protected initPlayer(): Player {\n    const dagger = new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))\n    const rock = new Missile('Rock', new Modifier({}))\n\n    const playerSpecie = new Specie('Player', Clan.Player, allAbilities)\n\n    let player = new Player(\n      new Level([1, 1, 1, 3, 10]),\n      new Characteristics({\n        attack: 1,\n        defense: 4,\n        dexterity: 3,\n        health: 10,\n        radius: 10,\n        speed: 100,\n      }),\n      new Dispatcher(),\n      playerSpecie\n    )\n    player.putOn(dagger)\n    player.putOn(rock)\n\n    return player\n  }\n\n  protected generateMap(options: GeneratorOptions): LevelMap {\n    let map = dungeon(\n      20,\n      40,\n      options.minSize,\n      options.maxSize,\n      options.roomsCount\n    )\n\n    map = drawn([\n      'WWWWWWWWWWW',\n      'WRRRRRRRRRW',\n      'WRRRRRRRRRW',\n      'WRRRRRRRRRW',\n      'WRRRRRRRRRW',\n      'WRRRRRRRRRW',\n      'WWWWWWWWWWW',\n    ])\n\n    if (options.addDoors) {\n      addDoors(map)\n    }\n    centralize(map)\n    map.game = this\n\n    addItems(0.01, map, weapons.merge(itemsPool))\n\n    return map\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport * as _ from 'lodash'\n\nimport Cell from './Cell.vue'\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\n\nimport LevelUp from './LevelUp.vue'\n\nimport { LevelMap, } from '../src/engine'\n\nimport {\n  Onisun,\n  baseConfig,\n} from '../src/onisun'\n\nexport default Vue.extend({\n  data() {\n    return {\n      game: new Onisun(baseConfig),\n      ts: Date.now(),\n      generatorOptions: baseConfig,\n    }\n  },\n  components: {\n    Cell,\n    Logger,\n    Scene,\n    LevelUp,\n  },\n  methods: {\n    generateMap() {\n      this.game = new Onisun(\n        this.generatorOptions,\n      )\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--13-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=6dc37359\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{staticClass:\"container\",attrs:{\"id\":\"app\"}},[(_vm.game.player && !_vm.game.player.dead)?_c('Scene',{attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player}}):_vm._e(),_vm._v(\" \"),(_vm.game.player && _vm.game.player.dead)?_c('div',[_vm._v(\"You are dead\")]):_vm._e(),_vm._v(\" \"),(_vm.game.screen)?_c('LevelUp',{attrs:{\"screen\":_vm.game.screen}}):_vm._e(),_vm._v(\" \"),_c('Logger',{attrs:{\"logger\":_vm.game.logger}}),_vm._v(\" \"),_c('div',{},[_c('div',{},[_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-2\"},[_vm._v(\"\\n          Map\\n        \")]),_vm._v(\" \"),_c('div',{staticClass:\"col-sm-10\"},[_c('div',{staticClass:\"form-check\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.addDoors),expression:\"generatorOptions.addDoors\"}],staticClass:\"form-check-input\",attrs:{\"id\":\"doors\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.generatorOptions.addDoors)?_vm._i(_vm.generatorOptions.addDoors,null)>-1:(_vm.generatorOptions.addDoors)},on:{\"change\":function($event){var $$a=_vm.generatorOptions.addDoors,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.$set(_vm.generatorOptions, \"addDoors\", $$a.concat([$$v])))}else{$$i>-1&&(_vm.$set(_vm.generatorOptions, \"addDoors\", $$a.slice(0,$$i).concat($$a.slice($$i+1))))}}else{_vm.$set(_vm.generatorOptions, \"addDoors\", $$c)}}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"doors\"}},[_vm._v(\"\\n              Add doors\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.roomsCount),expression:\"generatorOptions.roomsCount\"}],staticClass:\"form-control\",attrs:{\"id\":\"roomsCount\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.roomsCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"roomsCount\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"roomsCount\"}},[_vm._v(\"\\n              roomsCount\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.minSize),expression:\"generatorOptions.minSize\"}],staticClass:\"form-control\",attrs:{\"id\":\"minSize\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.minSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"minSize\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"minSize\"}},[_vm._v(\"\\n              minSize\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.maxSize),expression:\"generatorOptions.maxSize\"}],staticClass:\"form-control\",attrs:{\"id\":\"maxSize\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.maxSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"maxSize\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"maxSize\"}},[_vm._v(\"\\n              maxSize\\n            \")])])])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-10\"},[_c('button',{staticClass:\"btn btn-primary\",on:{\"click\":function($event){_vm.generateMap()}}},[_vm._v(\"\\n            Rebuild!\\n          \")])])])])])],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './App.vue'\n\nimport './application.css'\n\nimport 'bootstrap/dist/css/bootstrap.css';\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LevelUp.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./LevelUp.vue?vue&type=style&index=0&lang=scss\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&lang=scss\"","var map = {\n\t\"./af\": 134,\n\t\"./af.js\": 134,\n\t\"./ar\": 133,\n\t\"./ar-dz\": 132,\n\t\"./ar-dz.js\": 132,\n\t\"./ar-kw\": 131,\n\t\"./ar-kw.js\": 131,\n\t\"./ar-ly\": 130,\n\t\"./ar-ly.js\": 130,\n\t\"./ar-ma\": 129,\n\t\"./ar-ma.js\": 129,\n\t\"./ar-sa\": 128,\n\t\"./ar-sa.js\": 128,\n\t\"./ar-tn\": 127,\n\t\"./ar-tn.js\": 127,\n\t\"./ar.js\": 133,\n\t\"./az\": 126,\n\t\"./az.js\": 126,\n\t\"./be\": 125,\n\t\"./be.js\": 125,\n\t\"./bg\": 124,\n\t\"./bg.js\": 124,\n\t\"./bm\": 123,\n\t\"./bm.js\": 123,\n\t\"./bn\": 122,\n\t\"./bn.js\": 122,\n\t\"./bo\": 121,\n\t\"./bo.js\": 121,\n\t\"./br\": 120,\n\t\"./br.js\": 120,\n\t\"./bs\": 119,\n\t\"./bs.js\": 119,\n\t\"./ca\": 118,\n\t\"./ca.js\": 118,\n\t\"./cs\": 117,\n\t\"./cs.js\": 117,\n\t\"./cv\": 116,\n\t\"./cv.js\": 116,\n\t\"./cy\": 115,\n\t\"./cy.js\": 115,\n\t\"./da\": 114,\n\t\"./da.js\": 114,\n\t\"./de\": 113,\n\t\"./de-at\": 112,\n\t\"./de-at.js\": 112,\n\t\"./de-ch\": 111,\n\t\"./de-ch.js\": 111,\n\t\"./de.js\": 113,\n\t\"./dv\": 110,\n\t\"./dv.js\": 110,\n\t\"./el\": 109,\n\t\"./el.js\": 109,\n\t\"./en-au\": 108,\n\t\"./en-au.js\": 108,\n\t\"./en-ca\": 107,\n\t\"./en-ca.js\": 107,\n\t\"./en-gb\": 106,\n\t\"./en-gb.js\": 106,\n\t\"./en-ie\": 105,\n\t\"./en-ie.js\": 105,\n\t\"./en-il\": 104,\n\t\"./en-il.js\": 104,\n\t\"./en-nz\": 103,\n\t\"./en-nz.js\": 103,\n\t\"./eo\": 102,\n\t\"./eo.js\": 102,\n\t\"./es\": 101,\n\t\"./es-do\": 100,\n\t\"./es-do.js\": 100,\n\t\"./es-us\": 99,\n\t\"./es-us.js\": 99,\n\t\"./es.js\": 101,\n\t\"./et\": 98,\n\t\"./et.js\": 98,\n\t\"./eu\": 97,\n\t\"./eu.js\": 97,\n\t\"./fa\": 96,\n\t\"./fa.js\": 96,\n\t\"./fi\": 95,\n\t\"./fi.js\": 95,\n\t\"./fo\": 94,\n\t\"./fo.js\": 94,\n\t\"./fr\": 93,\n\t\"./fr-ca\": 92,\n\t\"./fr-ca.js\": 92,\n\t\"./fr-ch\": 91,\n\t\"./fr-ch.js\": 91,\n\t\"./fr.js\": 93,\n\t\"./fy\": 90,\n\t\"./fy.js\": 90,\n\t\"./gd\": 89,\n\t\"./gd.js\": 89,\n\t\"./gl\": 88,\n\t\"./gl.js\": 88,\n\t\"./gom-latn\": 87,\n\t\"./gom-latn.js\": 87,\n\t\"./gu\": 86,\n\t\"./gu.js\": 86,\n\t\"./he\": 85,\n\t\"./he.js\": 85,\n\t\"./hi\": 84,\n\t\"./hi.js\": 84,\n\t\"./hr\": 83,\n\t\"./hr.js\": 83,\n\t\"./hu\": 82,\n\t\"./hu.js\": 82,\n\t\"./hy-am\": 81,\n\t\"./hy-am.js\": 81,\n\t\"./id\": 80,\n\t\"./id.js\": 80,\n\t\"./is\": 79,\n\t\"./is.js\": 79,\n\t\"./it\": 78,\n\t\"./it.js\": 78,\n\t\"./ja\": 77,\n\t\"./ja.js\": 77,\n\t\"./jv\": 76,\n\t\"./jv.js\": 76,\n\t\"./ka\": 75,\n\t\"./ka.js\": 75,\n\t\"./kk\": 74,\n\t\"./kk.js\": 74,\n\t\"./km\": 73,\n\t\"./km.js\": 73,\n\t\"./kn\": 72,\n\t\"./kn.js\": 72,\n\t\"./ko\": 71,\n\t\"./ko.js\": 71,\n\t\"./ky\": 70,\n\t\"./ky.js\": 70,\n\t\"./lb\": 69,\n\t\"./lb.js\": 69,\n\t\"./lo\": 68,\n\t\"./lo.js\": 68,\n\t\"./lt\": 67,\n\t\"./lt.js\": 67,\n\t\"./lv\": 66,\n\t\"./lv.js\": 66,\n\t\"./me\": 65,\n\t\"./me.js\": 65,\n\t\"./mi\": 64,\n\t\"./mi.js\": 64,\n\t\"./mk\": 63,\n\t\"./mk.js\": 63,\n\t\"./ml\": 62,\n\t\"./ml.js\": 62,\n\t\"./mn\": 61,\n\t\"./mn.js\": 61,\n\t\"./mr\": 60,\n\t\"./mr.js\": 60,\n\t\"./ms\": 59,\n\t\"./ms-my\": 58,\n\t\"./ms-my.js\": 58,\n\t\"./ms.js\": 59,\n\t\"./mt\": 57,\n\t\"./mt.js\": 57,\n\t\"./my\": 56,\n\t\"./my.js\": 56,\n\t\"./nb\": 55,\n\t\"./nb.js\": 55,\n\t\"./ne\": 54,\n\t\"./ne.js\": 54,\n\t\"./nl\": 53,\n\t\"./nl-be\": 52,\n\t\"./nl-be.js\": 52,\n\t\"./nl.js\": 53,\n\t\"./nn\": 51,\n\t\"./nn.js\": 51,\n\t\"./pa-in\": 50,\n\t\"./pa-in.js\": 50,\n\t\"./pl\": 49,\n\t\"./pl.js\": 49,\n\t\"./pt\": 48,\n\t\"./pt-br\": 47,\n\t\"./pt-br.js\": 47,\n\t\"./pt.js\": 48,\n\t\"./ro\": 46,\n\t\"./ro.js\": 46,\n\t\"./ru\": 45,\n\t\"./ru.js\": 45,\n\t\"./sd\": 44,\n\t\"./sd.js\": 44,\n\t\"./se\": 43,\n\t\"./se.js\": 43,\n\t\"./si\": 42,\n\t\"./si.js\": 42,\n\t\"./sk\": 41,\n\t\"./sk.js\": 41,\n\t\"./sl\": 40,\n\t\"./sl.js\": 40,\n\t\"./sq\": 39,\n\t\"./sq.js\": 39,\n\t\"./sr\": 38,\n\t\"./sr-cyrl\": 37,\n\t\"./sr-cyrl.js\": 37,\n\t\"./sr.js\": 38,\n\t\"./ss\": 36,\n\t\"./ss.js\": 36,\n\t\"./sv\": 35,\n\t\"./sv.js\": 35,\n\t\"./sw\": 34,\n\t\"./sw.js\": 34,\n\t\"./ta\": 33,\n\t\"./ta.js\": 33,\n\t\"./te\": 32,\n\t\"./te.js\": 32,\n\t\"./tet\": 31,\n\t\"./tet.js\": 31,\n\t\"./tg\": 30,\n\t\"./tg.js\": 30,\n\t\"./th\": 29,\n\t\"./th.js\": 29,\n\t\"./tl-ph\": 28,\n\t\"./tl-ph.js\": 28,\n\t\"./tlh\": 27,\n\t\"./tlh.js\": 27,\n\t\"./tr\": 26,\n\t\"./tr.js\": 26,\n\t\"./tzl\": 25,\n\t\"./tzl.js\": 25,\n\t\"./tzm\": 24,\n\t\"./tzm-latn\": 23,\n\t\"./tzm-latn.js\": 23,\n\t\"./tzm.js\": 24,\n\t\"./ug-cn\": 22,\n\t\"./ug-cn.js\": 22,\n\t\"./uk\": 21,\n\t\"./uk.js\": 21,\n\t\"./ur\": 20,\n\t\"./ur.js\": 20,\n\t\"./uz\": 19,\n\t\"./uz-latn\": 18,\n\t\"./uz-latn.js\": 18,\n\t\"./uz.js\": 19,\n\t\"./vi\": 17,\n\t\"./vi.js\": 17,\n\t\"./x-pseudo\": 16,\n\t\"./x-pseudo.js\": 16,\n\t\"./yo\": 15,\n\t\"./yo.js\": 15,\n\t\"./zh-cn\": 14,\n\t\"./zh-cn.js\": 14,\n\t\"./zh-hk\": 13,\n\t\"./zh-hk.js\": 13,\n\t\"./zh-tw\": 12,\n\t\"./zh-tw.js\": 12\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 155;","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css\""],"sourceRoot":""}