{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils.ts","webpack:///./src/logger.ts","webpack:///./src/fov.ts","webpack:///./src/creature.ts","webpack:///./src/components/Cell.vue?3c3a","webpack:///./src/components/Cell.vue?1443","webpack:///./src/components/Cell.vue?b33b","webpack:///./src/components/Cell.vue","webpack:///./src/components/Logger.vue?14bb","webpack:///./src/components/Logger.vue?5c6b","webpack:///./src/components/Logger.vue?5585","webpack:///./src/components/Logger.vue","webpack:///./src/components/Scene.vue?c2a0","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./src/components/scene_tiles.ts","webpack:///./src/components/Scene.vue?fdbf","webpack:///./src/components/Scene.vue?f618","webpack:///./src/components/Scene.vue","webpack:///./src/generator/post.ts","webpack:///./src/generator/dungeon.ts","webpack:///./src/components/App.vue?50d0","webpack:///./src/components/App.vue","webpack:///./src/components/App.vue?a80d","webpack:///./src/index.ts","webpack:///./src/components/App.vue?607a","webpack:///./src/components/Scene.vue?5d57","webpack:///./src/components/App.vue?0351","webpack:///./src/components/Logger.vue?6c36","webpack:///./node_modules/moment/locale sync ^\\.\\/.*$","webpack:///./src/components/Cell.vue?8b87","webpack:///./src/inventory.ts","webpack:///./src/ai/internal.ts","webpack:///./src/ai/attacker.ts","webpack:///./src/ai/chaser.ts","webpack:///./src/ai/dispatcher.ts","webpack:///./src/ai/escaper.ts","webpack:///./src/ai/explorer.ts","webpack:///./src/ai/loiter.ts","webpack:///./src/ai/patrol.ts","webpack:///./src/ai/picker.ts","webpack:///./src/ai/waiter.ts","webpack:///./src/map.ts","webpack:///./src/timeline.ts","webpack:///./src/items/internal.ts","webpack:///./src/items/weapon.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Rect","[object Object]","x","y","w","h","this","succ","String","fromCharCode","charCodeAt","rand","max","Math","floor","random","twoDimArray","dimX","dimY","field","Array","min","list","Point","point","abs","dxy","map","add","Mapped","width","height","LogLevel","LogMessage","level","ts","message","Logger","messages","damage","actor","target","debug","warning","addMessage","DEBUG","INFO","WARNING","DANGER","moment__WEBPACK_IMPORTED_MODULE_0__","Fov","startx","starty","radius","checkSolid","markVisible","doubleRadius","forEach","dx","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","round","currentY","leftSlope","rightSlope","doubleDistance","EventType","Reaction","MemoryTile","tile","visible","degree","seen","clone","items","passibleThrough","creature","undefined","creature_Memory","utils","baseTile","retrive","super","reset","creature_Phantom","id","getId","pos","lastId","refToReal","Attack","subject","health","currentLevel","logger","killMessage","die","HURT","hurtMessage","DIE","creature_Creature","speed","ai","stageMemories","previousPos","copy","inventory","LeftHand","RightHand","Legs","Finger","Head","Eye","Neck","Back","Body","item","equip","visionMask","addCreature","eventType","removeCreature","event","affect","levelId","stage","act","at","nextPoint","phantom","stageMemory","resetVisible","isSolid","see","calc","visibleThrough","isDoor","components_Cellvue_type_script_lang_ts","extend","props","computed","player","cell","isWall","display","component","componentNormalizer","_h","$createElement","_self","_c","_v","__webpack_exports__","components_Loggervue_type_script_lang_ts","vue_runtime_esm","lodash","methods","record","moment","format","_vm","ref","staticClass","_l","class","rowClass","_s","Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","elem","appendChild","charMap","charArray","defaultColors","attribs","position","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","left","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","ceil","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","parseInt","match","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","type","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x1","y1","x2","y2","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","char","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","KATANA","CORPSE","displayItem","kind","Katana","Corpse","HUMAN","HUMAN2","HUMAN3","HUMAN4","HUMAN5","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","Scenevue_type_script_lang_ts_NULLTILE","nextItemAnimation","components_Scenevue_type_script_lang_ts","term","eng","drawInterval","Date","now","fps","counter","interval","nextStep","step","pause","creatures","src_ai","aiName","prevAI","frame","animationFps","itemId","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","effect","duration","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","done","turn","update","fovTile","lighted","getChar","bodyPart","initViewport","watch","initiativity","wears","wearing","displayBodyPart","equipment","cares","directives","rawName","expression","attrs","domProps","on","input","$event","composing","for","click","addDoors","addDoor","up","down","right","setTile","_map__WEBPACK_IMPORTED_MODULE_0__","THICKNESS","newRoomSpace","_map__WEBPACK_IMPORTED_MODULE_1__","newCoridor","newWall","generate","minSize","maxSize","roomsCount","dungeon","maxX","maxY","rooms","generateRoom","normalize","fuzzifyRooms","roads","buildRoads","Room","_utils__WEBPACK_IMPORTED_MODULE_0__","pickedRooms","currentRoom","angle","PI","cos","sin","every","room","notCross","ndx","ndy","move","minX","minY","filter","points","pointWithin","connectedPoints","point1","point2","pow","currentPoint","pointToConnect","minDistance","currentDistance","Road","rect","lined","hx","hy","horizontalLine","vx","vy","verticallLine","components_Appvue_type_script_lang_ts","App","_e","placeholder","formula","minVal","maxVal","staticStyle","border","generatorOptions","checked","isArray","_i","change","$$a","$$el","$$c","$$i","$set","concat","generateMap","el","vue__WEBPACK_IMPORTED_MODULE_0__","_map__WEBPACK_IMPORTED_MODULE_4__","array","components","Cell","_Cell_vue__WEBPACK_IMPORTED_MODULE_1__","_Logger_vue__WEBPACK_IMPORTED_MODULE_2__","Scene","_Scene_vue__WEBPACK_IMPORTED_MODULE_3__","eval","e","buildMap","creature1","_creature__WEBPACK_IMPORTED_MODULE_5__","_ai__WEBPACK_IMPORTED_MODULE_9__","addToMap","wear","_items__WEBPACK_IMPORTED_MODULE_8__","creature2","_generator_dungeon__WEBPACK_IMPORTED_MODULE_6__","_generator_post__WEBPACK_IMPORTED_MODULE_7__","./af","./af.js","./ar","./ar-dz","./ar-dz.js","./ar-kw","./ar-kw.js","./ar-ly","./ar-ly.js","./ar-ma","./ar-ma.js","./ar-sa","./ar-sa.js","./ar-tn","./ar-tn.js","./ar.js","./az","./az.js","./be","./be.js","./bg","./bg.js","./bm","./bm.js","./bn","./bn.js","./bo","./bo.js","./br","./br.js","./bs","./bs.js","./ca","./ca.js","./cs","./cs.js","./cv","./cv.js","./cy","./cy.js","./da","./da.js","./de","./de-at","./de-at.js","./de-ch","./de-ch.js","./de.js","./dv","./dv.js","./el","./el.js","./en-au","./en-au.js","./en-ca","./en-ca.js","./en-gb","./en-gb.js","./en-ie","./en-ie.js","./en-il","./en-il.js","./en-nz","./en-nz.js","./eo","./eo.js","./es","./es-do","./es-do.js","./es-us","./es-us.js","./es.js","./et","./et.js","./eu","./eu.js","./fa","./fa.js","./fi","./fi.js","./fo","./fo.js","./fr","./fr-ca","./fr-ca.js","./fr-ch","./fr-ch.js","./fr.js","./fy","./fy.js","./gd","./gd.js","./gl","./gl.js","./gom-latn","./gom-latn.js","./gu","./gu.js","./he","./he.js","./hi","./hi.js","./hr","./hr.js","./hu","./hu.js","./hy-am","./hy-am.js","./id","./id.js","./is","./is.js","./it","./it.js","./ja","./ja.js","./jv","./jv.js","./ka","./ka.js","./kk","./kk.js","./km","./km.js","./kn","./kn.js","./ko","./ko.js","./ky","./ky.js","./lb","./lb.js","./lo","./lo.js","./lt","./lt.js","./lv","./lv.js","./me","./me.js","./mi","./mi.js","./mk","./mk.js","./ml","./ml.js","./mn","./mn.js","./mr","./mr.js","./ms","./ms-my","./ms-my.js","./ms.js","./mt","./mt.js","./my","./my.js","./nb","./nb.js","./ne","./ne.js","./nl","./nl-be","./nl-be.js","./nl.js","./nn","./nn.js","./pa-in","./pa-in.js","./pl","./pl.js","./pt","./pt-br","./pt-br.js","./pt.js","./ro","./ro.js","./ru","./ru.js","./sd","./sd.js","./se","./se.js","./si","./si.js","./sk","./sk.js","./sl","./sl.js","./sq","./sq.js","./sr","./sr-cyrl","./sr-cyrl.js","./sr.js","./ss","./ss.js","./sv","./sv.js","./sw","./sw.js","./ta","./ta.js","./te","./te.js","./tet","./tet.js","./tg","./tg.js","./th","./th.js","./tl-ph","./tl-ph.js","./tlh","./tlh.js","./tr","./tr.js","./tzl","./tzl.js","./tzm","./tzm-latn","./tzm-latn.js","./tzm.js","./ug-cn","./ug-cn.js","./uk","./uk.js","./ur","./ur.js","./uz","./uz-latn","./uz-latn.js","./uz.js","./vi","./vi.js","./x-pseudo","./x-pseudo.js","./yo","./yo.js","./zh-cn","./zh-cn.js","./zh-hk","./zh-hk.js","./zh-tw","./zh-tw.js","webpackContext","req","webpackContextResolve","Error","code","keys","resolve","BodyPart","Inventory","parts","wearings","bag","putToBag","lodash__WEBPACK_IMPORTED_MODULE_0__","inventoryItem","FIRST_STEP","internal_AI","destination","path","leePath","eq","nextTo","randomDestination","pointsToVisit","pointsToCheck","wavePoints","inRange","tangible","wrappers","dist","buildRoad","lastPoint","chain","delta","find","dp","unshift","visit","tileVisited","attacker_Attacker","canAttack","firstTurn","victimSet","victimInAccess","attack","findNewVictim","victim","emit","src_creature","memory","some","findCreature","condition","withinView","real","chaser_Chaser","updateVictimPosition","chase","foundNewVictim","victimPos","moveTo","caught","resetVictim","victimId","followTo","dispatcher_Dispatcher","events","escaper","escaper_Escaper","explorer","explorer_Explorer","chaser","attacker","picker","picker_Picker","feelsGood","enemyClose","seesItems","pickItem","explore","runAway","rest","available","STEP_DISTANCE","escapesFrom","foundEnemies","buildPath","runningTo","loiter_Loiter","enemy","pop","NEW_POINT_EVERY","buildNewPath","updatePatrol","shouldAddNode","patrol","addNode","patrol_Patrol","turns","graph","graphlib","lastNodeVisit","markNodeVisited","currentNodeID","nodes","moveToTarget","targetNodeID","pickUpNewTarget","withEdge","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","desiredItemId","desiredItemPos","seesItem","findItem","waiter_Waiter","TileTypes","timeline_Timeline","element","actors","repository","Floor","Wall","Door","map_LevelMap","timeline","remove","turnCreatureIds","ItemGroup","ItemKind","Item","group","Equipment","weapon_Weapon","Weapon","weapon_Katana"],"mappings":"aACA,SAAAA,EAAAC,GAOA,IANA,IAKAC,EAAAC,EALAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAGAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAIA,IADAe,KAAAhB,GACAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,GAAA,EACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,GAAA,GAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,GAAA,EACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,GAAA,EAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GAA0CI,YAAA,EAAAC,IAAAJ,KAK1CX,EAAAgB,EAAA,SAAAZ,GACA,oBAAAa,eAAAC,aACAlC,OAAA6B,eAAAT,EAAAa,OAAAC,aAAwDC,MAAA,WAExDnC,OAAA6B,eAAAT,EAAA,cAAiDe,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAvC,OAAAwC,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAvC,OAAA6B,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAS,EAAAc,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAtB,GACA,IAAAM,EAAAN,KAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAgB,EAAAC,GAAsD,OAAA7C,OAAAC,UAAAC,eAAAC,KAAAyC,EAAAC,IAGtD7B,EAAA8B,EAAA,WAEA,IAAAC,EAAAC,OAAA,aAAAA,OAAA,iBACAC,EAAAF,EAAAhD,KAAA2C,KAAAK,GACAA,EAAAhD,KAAAX,EACA2D,IAAAG,QACA,QAAAvD,EAAA,EAAgBA,EAAAoD,EAAAlD,OAAuBF,IAAAP,EAAA2D,EAAApD,IACvC,IAAAU,EAAA4C,EAIA1C,EAAAR,MAAA,QAEAU,2QCpJM0C,EAMJC,YAAaC,EAAWC,EAAWC,EAAWC,GAE5CC,KAAKJ,EAAIA,EACTI,KAAKH,EAAIA,EACTG,KAAKF,EAAIA,EACTE,KAAKD,EAAIA,EAGXJ,KAAMC,EAAWC,GACfG,KAAKJ,GAAKA,EACVI,KAAKH,GAAKA,GAIP,MAAMI,EAAO,SAAWlC,GAC7B,OAAOmC,OAAOC,aAAcpC,EAAEqC,WAAY,GAAM,IAGrCC,EAAO,SAAWC,GAC7B,OAAOC,KAAKC,MAAOD,KAAKE,SAAWH,IAIxBI,EAAc,SAAWC,EAAcC,EACdlC,GACpC,IAAImC,EAAQC,MAAOH,GAEfzE,EAAI,EACR,KAAQA,EAAIyE,GAAO,CACjBE,EAAM3E,GAAK,IAAI4E,MAAMF,GACrB,IAAIxD,EAAI,EACR,KAAQA,EAAIwD,GACVC,EAAM3E,GAAGkB,GAAKsB,EAAOxC,EAAGkB,GACxBA,IAEFlB,IAGF,OAAO2E,GAOIE,EAAM,SAAUC,GAC3B,OAAOT,KAAKQ,IAAIhE,MAAOwD,KAAMS,UAGzBC,EACJtB,YACSC,EACAC,GADAG,KAAAJ,IACAI,KAAAH,IAUFF,GAAGuB,GACR,OAAOlB,KAAKJ,IAAMsB,EAAMtB,GAAKI,KAAKH,IAAMqB,EAAMrB,EAGzCF,OAAOuB,GACZ,OAAOX,KAAKY,IAAInB,KAAKJ,EAAIsB,EAAMtB,IAAM,GAAKW,KAAKY,IAAInB,KAAKH,EAAIqB,EAAMrB,IAAM,EAGnEF,OACL,OAAO,IAAIsB,EAAMjB,KAAKJ,EAAGI,KAAKH,GAGzBF,IAAIuB,GACT,OAAO,IAAID,EAAMjB,KAAKJ,EAAIsB,EAAMtB,EAAGI,KAAKH,EAAIqB,EAAMrB,GAG7CF,WACL,OAAOsB,EAAMG,IAAIC,IAAIH,GAASlB,KAAKsB,IAAIJ,KAvBlBD,EAAAG,KACrB,IAAIH,GAAO,GAAI,GAAI,IAAIA,EAAM,GAAI,GAAI,IAAIA,EAAM,GAAI,GACnD,IAAIA,GAAO,EAAI,GAAsB,IAAIA,EAAM,EAAI,GACnD,IAAIA,GAAO,EAAI,GAAI,IAAIA,EAAM,EAAI,GAAI,IAAIA,EAAM,EAAI,UAwBjDM,EAIJ5B,YAAsB0B,GAAArB,KAAAqB,MACpBrB,KAAKwB,MAASH,EAAI,GAAGjF,OACrB4D,KAAKyB,OAASJ,EAAIjF,OAGbuD,GAAGC,EAAGC,GACX,OAAOG,KAAKqB,IAAIxB,GAAGD,0GC/FX8B,UAAZ,SAAYA,GACVA,IAAA,iBACAA,IAAA,eACAA,IAAA,qBACAA,IAAA,mBAJF,CAAYA,iBAONC,EACJhC,YACSiC,EACAC,EACAC,GAFA9B,KAAA4B,QACA5B,KAAA6B,KACA7B,KAAA8B,iBAKLC,EAANpC,cACSK,KAAAgC,YAEArC,YAAYsC,EAAgBC,EAAiBC,GAClDnC,KAAKoC,SAASD,EAAOlE,cAAcgE,iBAAsBC,EAAMjE,UAG1D0B,YAAYsC,EAAgBC,EAAiBC,GAClDnC,KAAKqC,WAAWF,EAAOlE,cAAcgE,iBAAsBC,EAAMjE,6BAGzD0B,MAAMmC,GACd9B,KAAKsC,WAAWZ,EAASa,MAAOT,GAGxBnC,KAAKmC,GACb9B,KAAKsC,WAAWZ,EAASc,KAAMV,GAGvBnC,QAAQmC,GAChB9B,KAAKsC,WAAWZ,EAASe,QAASX,GAG1BnC,OAAOmC,GACf9B,KAAKsC,WAAWZ,EAASgB,OAAQZ,GAGzBnC,WAAWiC,EAAiBE,GACpC9B,KAAKgC,SAAS1F,KACZ,IAAIqF,EACFC,EACAe,IACAb,wDCpDFc,EAGJjD,YACUkD,EACAC,EACAC,EACAvB,EACAC,EACAuB,EACAC,GANAjD,KAAA6C,SACA7C,KAAA8C,SACA9C,KAAA+C,SACA/C,KAAAwB,QACAxB,KAAAyB,SACAzB,KAAAgD,aACAhD,KAAAiD,cAERjD,KAAKkD,aAAelD,KAAK+C,OAAS/C,KAAK+C,OAGlCpD,OACLK,KAAKiD,YAAYjD,KAAK6C,OAAQ7C,KAAK8C,OAAQ,GAEtC9C,KAAKgD,WAAWhD,KAAK6C,OAAQ7C,KAAK8C,WACnC,EAAG,IAAK,GAAI,KAAM,EAAG,KAAM,GAAI,IAAIK,QAAQ,EAAEC,EAAIC,MACjDrD,KAAKsD,UAAU,EAAG,EAAK,EAAK,EAAGF,EAAIC,EAAI,GACvCrD,KAAKsD,UAAU,EAAG,EAAK,EAAKF,EAAI,EAAG,EAAGC,KAKpC1D,UAAU4D,EAAaC,EAAeC,EAAaC,EAAYC,EAAYC,EAAYC,GAC7F,GAAIL,EAAQC,EAAO,OAEnB,IAAIK,EAAW,EACXC,GAAU,EAEd,IAAK,IAAIC,EAAWT,EAAKS,GAAYhE,KAAK+C,SAAWgB,EAASC,IAAY,CACxE,IAAIC,GAAUD,EAEd,IAAK,IAAIE,GAAkBF,EAAUE,GAAU,EAAGA,IAAU,CAC1D,IAAIC,EAAW5D,KAAK6D,MAAMpE,KAAK6C,OAASqB,EAASR,EAAKO,EAASN,GAC3DU,EAAW9D,KAAK6D,MAAMpE,KAAK8C,OAASoB,EAASN,EAAKK,EAASJ,GAC3DS,GAAaJ,EAAS,KAAQD,EAAS,IACvCM,GAAcL,EAAS,KAAQD,EAAS,IAE5C,GAAME,GAAY,GAAKE,GAAY,GAAKF,EAAWnE,KAAKwB,OAAS6C,EAAWrE,KAAKyB,UAAW+B,EAAQe,GAApG,CAEO,GAAId,EAAMa,EACf,MAIEtE,KAAKwE,eAAeN,EAAQD,IAAWjE,KAAKkD,cAC9ClD,KAAKiD,YACHkB,EACAE,EACA,EAAIrE,KAAKwE,eAAeN,EAAQD,GAAUjE,KAAKkD,cAI/Ca,EACE/D,KAAKgD,WAAWmB,EAAUE,GAC5BP,EAAWS,GAEXR,GAAU,EACVP,EAAQM,GAGN9D,KAAKgD,WAAWmB,EAAUE,IAAaL,EAAWhE,KAAK+C,SACvDgB,GAAU,EACV/D,KAAKsD,UAAUU,EAAW,EAAGR,EAAOc,EAAWZ,EAAIC,EAAIC,EAAIC,GAC3DC,EAAWS,MAOf5E,eAAeC,EAAWC,GAChC,OAAOD,EAAIA,EAAIC,EAAIA,OCwCX4E,EAIAC,sHA9GNC,EAKJhF,YACSiF,GAAA5E,KAAA4E,OALF5E,KAAA6E,SAAmB,EACnB7E,KAAA8E,OAAiB,EACjB9E,KAAA+E,MAAgB,EAOhBpF,IAAIiF,EAAYE,GACrB9E,KAAK6E,SAAU,EACf7E,KAAK8E,OAASA,EACd9E,KAAK+E,MAAO,EACZ/E,KAAK4E,KAAOA,EAAKI,QAGZrF,QACL,OAAOK,KAAK4E,KAAKK,MAGZtF,SAASuC,GACd,OAAOlC,KAAK+E,OAAS/E,KAAK4E,KAAKM,gBAAgBhD,GAG1CvC,WACL,OAAOK,KAAK4E,MAAQ5E,KAAK4E,KAAKO,SAGzBxF,QACLK,KAAK6E,SAAU,EACf7E,KAAK4E,KAAKO,cAAWC,SAInBC,UAAsBC,EAAA,EAC1B3F,YACE6B,EACAC,GAEA,MAAM8D,EAAWlE,EAAA,EAAKmE,QAAQ,KAC9BC,MAAMlJ,OAAA+I,EAAA,EAAA/I,CAAYkF,EAAQD,EAAO,IAAM,IAAImD,EAAWY,KAGjD5F,QAAQuB,GACb,OAAOA,EAAMtB,GAAK,GAAasB,EAAMrB,GAAK,GACnCqB,EAAMtB,EAAII,KAAKwB,OAASN,EAAMrB,EAAIG,KAAKyB,OAGzC9B,eACLK,KAAKqB,IAAI8B,QAASI,IAChBA,EAAIJ,QAASyB,IACXA,EAAKc,mBAQPC,EASJhG,YACEC,EACAC,EACO+F,EAAiBD,EAAQE,SAAzB7F,KAAA4F,KAEP5F,KAAK8F,IAAM,IAAIR,EAAA,EAAM1F,EAAGC,GAZnBF,eACL,OAAOK,KAAK+F,SAcPpG,QACL,OAAO,IAAIgG,EAAQ3F,KAAK8F,IAAIlG,EAAGI,KAAK8F,IAAIjG,EAAGG,KAAK4F,IAG3CjG,OACL,OAAOK,KAAKgG,WArBCL,EAAAI,OAAqB,QA6BhCE,EACJtG,YAAmBuC,EAAwBD,GAAxBjC,KAAAkC,QAAwBlC,KAAAiC,SAEpCtC,OAAOuG,GACZ,OAAIlG,KAAKiC,OAASiE,EAAQC,QACxBD,EAAQE,aAAaC,OAAOC,YAAYtG,KAAKiC,OAAQjC,KAAKkC,MAAOgE,GACjEA,EAAQK,MACD7B,EAAS8B,OAEhBN,EAAQC,QAAUnG,KAAKiC,OACvBiE,EAAQE,aAAaC,OAAOI,YAAYzG,KAAKiC,OAAQjC,KAAKkC,MAAOgE,GAC1DxB,EAASgC,OAKtB,SAAYjC,GACVA,IAAA,mBADF,CAAYA,WAIZ,SAAYC,GACVA,IAAA,aACAA,IAAA,eACAA,IAAA,qBAHF,CAAYA,iBASNiC,UAAwBhB,EAQ5BhG,YACEC,EACAC,EACOsG,EACApD,EACC6D,EACRC,GAEApB,MAAM7F,EAAGC,GALFG,KAAAmG,SACAnG,KAAA+C,SACC/C,KAAA4G,QAXH5G,KAAA8G,iBAeL9G,KAAK+G,YAAc/G,KAAK8F,IAAIkB,OAC5BhH,KAAK6G,GAAKA,EACV7G,KAAKiH,UAAY,IAAIA,EAAA,GACnBA,EAAA,EAASC,SACTD,EAAA,EAASE,UACTF,EAAA,EAASG,KACTH,EAAA,EAASI,OACTJ,EAAA,EAASK,KACTL,EAAA,EAASM,IACTN,EAAA,EAASO,KACTP,EAAA,EAASQ,KACTR,EAAA,EAASS,OAIN/H,KAAKgI,GACV3H,KAAKiH,UAAUW,MAAMD,GAGhBhI,OACL,SAAUK,KAAK4F,KAGVjG,SAASiC,GACd5B,KAAKoG,aAAexE,EACpB5B,KAAK6H,WAAWjG,GAChBA,EAAMkG,YAAY9H,MAGbL,KAAKoI,GACV,OAAQA,GACR,KAAKtD,EAAUwB,OACb,OAAO,IAAIA,EAAOjG,KAAMA,KAAK4G,OAC/B,QACE,0BAA2BmB,SAAiB/H,QAIzCL,MACLK,KAAKoG,aAAa4B,eAAehI,MAG5BL,GAAGsI,GACR,OAAOA,EAAMC,OAAOlI,MAGfL,OACL,OAAOK,KAIFL,eACL,OAAOK,KAAK4G,MAGPjH,YAAYwI,EAAsBnI,KAAKoG,aAAaR,IACzD,OAAO5F,KAAK8G,cAAcqB,GAGrBxI,IAAIyI,GACTpI,KAAK6H,WAAWO,GAChBpI,KAAK+G,YAAc/G,KAAK8F,IAAIkB,OAC5BhH,KAAK6G,GAAGwB,IAAIrI,MAAM,GAClBoI,EAAME,GAAGtI,KAAK+G,YAAYnH,EAAGI,KAAK+G,YAAYlH,GAAGsF,cAAWC,EAC5DgD,EAAME,GAAGtI,KAAK8F,IAAIlG,EAAGI,KAAK8F,IAAIjG,GAAGsF,SAAWnF,KAGvCL,KAAK4I,GACVvI,KAAK8F,IAAMyC,EAAUvB,OAGhBrH,QACL,IAAI6I,EAAU,IAAI7C,EAAQ3F,KAAK8F,IAAIlG,EAAGI,KAAK8F,IAAIjG,EAAGG,KAAK4F,IAEvD,OADA4C,EAAQxC,UAAYhG,KACbwI,EAGF7I,WAAWyI,GACXpI,KAAK8G,cAAcsB,EAAMxC,IAG5B5F,KAAKyI,cAAcC,eAFnB1I,KAAK8G,cAAcsB,EAAMxC,IAAM,IAAIP,EAAO+C,EAAM5G,MAAO4G,EAAM3G,QAS/D,IAAImB,EACF5C,KAAK8F,IAAIlG,EACTI,KAAK8F,IAAIjG,EACTG,KAAK+C,OACLqF,EAAM5G,MACN4G,EAAM3G,OACNzB,KAAK2I,QAAQP,GAVH,CAACxI,EAAWC,EAAWiF,KACjC9E,KAAKyI,cAAcH,GAAG1I,EAAGC,GAAG+I,IAAIR,EAAME,GAAG1I,EAAGC,GAAIiF,KAWhD+D,OAGIlJ,QAAQyI,GACd,MAAO,CAACxI,EAAWC,KACbuI,EAAMU,eAAelJ,EAAGC,MAGjBuI,EAAME,GAAG1I,EAAGC,GAAGkJ,UAAY/I,KAAK8F,IAAIlG,IAAMA,GAAKI,KAAK8F,IAAIjG,IAAMA,iFCzP/E,ICAuKmJ,OCaxJ,EAAIC,QACjBC,OAAQ,OAAQ,UAChBC,UACExJ,QACE,OAAIK,KAAKoJ,OACA,SACEpJ,KAAKqJ,KAAKC,SACZ,OACEtJ,KAAKqJ,KAAKN,SACZ,OAGF,SAETpJ,SACE,OAAIK,KAAKoJ,OACA,IACuB,KAArBpJ,KAAKqJ,KAAKE,QACZ,IACuB,KAArBvJ,KAAKqJ,KAAKE,QACZ,IACuB,KAArBvJ,KAAKqJ,KAAKE,QACZ,IAEA,wBC7BfC,EAAAjN,OAAAkN,EAAA,EAAAlN,CACAyM,EHTA,WAA0B,IAAaU,EAAb1J,KAAa2J,eAAkD,OAA/D3J,KAAuC4J,MAAAC,IAAAH,GAAwB,MAA/D1J,KAA+D8J,GAAA,qFGYzF,EACA,KACA,KACA,MAIAC,EAAA,EAAAP,4CCnBA,iCCAyKQ,ECoB1JC,EAAA,EAAIhB,QACjBhL,KAAM,SACNiL,OAAQ,UACRC,UACExJ,WACE,OAAOpD,OAAA2N,EAAA,UAAA3N,CAAUyD,KAAKqG,OAAOrE,SAAU,KAG3CmI,SACEtI,GAAGuI,GACMC,EAAOD,EAAOvI,IAAIyI,OAAO,YAElC3K,SAASyK,GACP,OAAQA,EAAOxI,OACb,KAAKyE,EAAA,EAAS9D,MACZ,MAAO,kBACT,KAAK8D,EAAA,EAAS7D,KACZ,MAAO,aACT,KAAK6D,EAAA,EAAS5D,QACZ,MAAO,gBACT,KAAK4D,EAAA,EAAS3D,OACZ,MAAO,oCCjCjB8G,EAAAjN,OAAAkN,EAAA,EAAAlN,CACAyN,EHTA,WAA0B,IAAAO,EAAAvK,KAAa0J,EAAAa,EAAAZ,eAA0BE,EAAAU,EAAAX,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiBW,IAAA,YAAAC,YAAA,WAAqCZ,EAAA,SAAcY,YAAA,iCAA2CZ,EAAA,QAAAU,EAAAG,GAAAH,EAAA,kBAAAH,GAAoD,OAAAP,EAAA,MAAgBc,MAAAJ,EAAAK,SAAAR,KAA2BP,EAAA,MAAAU,EAAAT,GAAAS,EAAAM,GAAAN,EAAA1I,GAAAuI,OAAAG,EAAAT,GAAA,KAAAD,EAAA,MAAAU,EAAAT,GAAAS,EAAAM,GAAAT,EAAAtI,0BGYvS,EACA,KACA,KACA,MAIAiI,EAAA,EAAAP,iECnBA,iBCMMsB,EAYJnL,YACSoL,EACAxM,EACAyM,EACAC,EACAC,EACAC,EACAC,GANApL,KAAA+K,KACA/K,KAAAzB,IACAyB,KAAAgL,IACAhL,KAAAiL,IACAjL,KAAAkL,KACAlL,KAAAmL,KACAnL,KAAAoL,KAKFzL,UAAY,OAAOK,KAAK+K,GAIxBpL,QAAQoL,GAAc/K,KAAK+K,GAAKA,EAIhCpL,SAASpB,EAAWyM,EAAWC,GACpCjL,KAAKzB,EAAIA,EACTyB,KAAKgL,EAAIA,EACThL,KAAKiL,EAAIA,EAKJtL,QAAQ0L,GACbrL,KAAKzB,EAAI8M,EACTrL,KAAKgL,EAAIK,EACTrL,KAAKiL,EAAII,EAKJ1L,cAAcpB,EAAWyM,EAAWC,GACzCjL,KAAKkL,GAAK3M,EACVyB,KAAKmL,GAAKH,EACVhL,KAAKoL,GAAKH,EAGLtL,oBACLK,KAAKzB,EAAIyB,KAAKkL,GACdlL,KAAKgL,EAAIhL,KAAKmL,GACdnL,KAAKiL,EAAIjL,KAAKoL,GAGTzL,aACLK,KAAKzB,GAAKyB,KAAKkL,GAAIlL,KAAKkL,GAAKlL,KAAKzB,GAAG,GACrCyB,KAAKgL,GAAKhL,KAAKmL,GAAInL,KAAKmL,GAAKnL,KAAKgL,GAAG,GACrChL,KAAKiL,GAAKjL,KAAKoL,GAAIpL,KAAKoL,GAAKpL,KAAKiL,GAAG,GAKhCtL,aAAeK,KAAKzB,EAAIyB,KAAKgL,EAAIhL,KAAKiL,OAAI7F,EAI1CzF,kBAAoBK,KAAKkL,GAAKlL,KAAKmL,GAAKnL,KAAKoL,QAAKhG,EAIlDzF,cACL,YAAeyF,IAAXpF,KAAKzB,QAA8B6G,IAAXpF,KAAKgL,QAA8B5F,IAAXpF,KAAKiL,EAChD,IAAMjL,KAAKzB,EAAE+M,SAAS,IAAMtL,KAAKgL,EAAEM,SAAS,IAAMtL,KAAKiL,EAAEK,SAAS,IAC/D,GAKP3L,mBACL,YAAgByF,IAAZpF,KAAKkL,SAAgC9F,IAAZpF,KAAKmL,SAAgC/F,IAAZpF,KAAKoL,GAClD,IAAMpL,KAAKkL,GAAGI,SAAS,IAAMtL,KAAKmL,GAAGG,SAAS,IAAMtL,KAAKoL,GAAGE,SAAS,IAClE,GAKP3L,cACL,YAAeyF,IAAXpF,KAAKzB,QAA8B6G,IAAXpF,KAAKgL,QAA8B5F,IAAXpF,KAAKiL,SACzCjL,KAAKzB,KAAKyB,KAAKgL,KAAKhL,KAAKiL,KAC7B,GAKPtL,mBACL,YAAgByF,IAAZpF,KAAKkL,SAAgC9F,IAAZpF,KAAKmL,SAAgC/F,IAAZpF,KAAKoL,UAC3CpL,KAAKkL,MAAMlL,KAAKmL,MAAMnL,KAAKoL,MAC/B,GAKPzL,eACL,YAAeyF,IAAXpF,KAAKzB,QAA8B6G,IAAXpF,KAAKgL,QAA8B5F,IAAXpF,KAAKiL,GAC9C1M,EAAKyB,KAAKzB,EAAGyM,EAAKhL,KAAKgL,EAAGC,EAAKjL,KAAKiL,MAM1CtL,oBACL,YAAeyF,IAAXpF,KAAKzB,QAA8B6G,IAAXpF,KAAKgL,QAA8B5F,IAAXpF,KAAKiL,GAC9C1M,EAAKyB,KAAKkL,GAAIF,EAAKhL,KAAKmL,GAAIF,EAAKjL,KAAKoL,OAM5CzL,KAAK4L,GACVvL,KAAK+K,GAAKQ,EAAMR,GAChB/K,KAAKzB,EAAIgN,EAAMhN,EACfyB,KAAKgL,EAAIO,EAAMP,EACfhL,KAAKiL,EAAIM,EAAMN,EACfjL,KAAKkL,GAAKK,EAAML,GAChBlL,KAAKmL,GAAKI,EAAMJ,GAChBnL,KAAKoL,GAAKG,EAAMH,GAKXzL,QACL,OAAO,IAAImL,EAAK9K,KAAK+K,GAAI/K,KAAKzB,EAAGyB,KAAKgL,EAAGhL,KAAKiL,EAAGjL,KAAKkL,GAAIlL,KAAKmL,GAAInL,KAAKoL,KASrE,MAEMI,EAAW,eACXC,EAAW,IAAIX,EAFJ,KClEjB,MCrFDY,EAAgB,ynBAwBhBC,EAAkB,2QAwUjB,MAAMC,EAAgB,SAASC,GACpC,OAAO,UAlSPlM,YAAoBmM,GAIlB,GAJkB9L,KAAA8L,OAClB9L,KAAK8L,KAAOA,EACZ9L,KAAK+L,OAASC,SAASC,cAAc,WAEhCjM,KAAK+L,OAAOG,WAAY,KAAK,uBAElC,GADAlM,KAAKmM,GAAKnM,KAAK+L,OAAOG,WAAW,uBAC5BlM,KAAKmM,GAAI,KAAK,sBAuBnB,GAtBAL,EAAKM,KAAKC,YAAYrM,KAAK+L,QAE3B/L,KAAKsM,WACLtM,KAAKuM,aACLvM,KAAKwM,eAAkBjO,EAAG,EAAKyM,EAAG,EAAKC,EAAG,EAAKC,GAAI,EAAKC,GAAI,EAAKC,GAAI,GAErEpL,KAAKyM,SACHC,UAAaC,OAAQ,KAAM/Q,KAAM,KAAMgR,SAAU,EAAGC,SAAU,KAAMC,KAAM9M,KAAKmM,GAAGY,aAClFC,UAAaL,OAAQ,KAAM/Q,KAAM,KAAMgR,SAAU,EAAGC,SAAU,KAAMC,KAAM9M,KAAKmM,GAAGY,aAClFE,OAAaN,OAAQ,KAAM/Q,KAAM,KAAMgR,SAAU,EAAGC,SAAU,KAAMC,KAAM9M,KAAKmM,GAAGe,cAClFC,SAAaR,OAAQ,KAAM/Q,KAAM,KAAMgR,SAAU,EAAGC,SAAU,KAAMC,KAAM9M,KAAKmM,GAAGe,cAClFE,WAAaT,OAAQ,KAAM/Q,KAAM,KAAMgR,SAAU,EAAGC,SAAU,KAAMC,KAAM9M,KAAKmM,GAAGe,eAK/ElN,KAAKqN,YACRrN,KAAKqN,UAAYrB,SAASC,cAAc,WAC1CjM,KAAKqN,UAAUC,MAAMZ,SAAW,WAChC1M,KAAKqN,UAAUC,MAAMC,IAAM,MAC3BvN,KAAKqN,UAAUC,MAAME,KAAO,MAC5BxN,KAAKyN,IAAMzN,KAAKqN,UAAUnB,WAAW,OAChClM,KAAKyN,IAAK,KAAM,qDAErBzN,KAAK0N,cACL1N,KAAK+L,OAAOvK,OAASsK,EAAK6B,SAAW3N,KAAK4N,GAAK5N,KAAK6N,IAAM/B,EAAKhM,EAC/DE,KAAK+L,OAAOtK,OAASzB,KAAK4N,GAAK9B,EAAK/L,EACpCC,KAAKqN,UAAU7L,MAAQ,EACvBxB,KAAKqN,UAAU5L,OAAS,EAExBzB,KAAK0N,cAEL1N,KAAKmM,GAAGN,SAAS,EAAG,EAAG7L,KAAK+L,OAAOvK,MAAOxB,KAAK+L,OAAOtK,QAEtD,IAAIqM,EAAe9N,KAAK+N,cAAc/N,KAAKmM,GAAGT,cAAeA,GACzDsC,EAAiBhO,KAAK+N,cAAc/N,KAAKmM,GAAGR,gBAAiBA,GAC7DsC,EAAUjO,KAAKmM,GAAG+B,gBAOtB,GANAlO,KAAKmM,GAAGgC,aAAaF,EAASH,GAC9B9N,KAAKmM,GAAGgC,aAAaF,EAASD,GAC9BhO,KAAKmM,GAAGiC,YAAYH,GACpBjO,KAAKmM,GAAGkC,aAAaP,GACrB9N,KAAKmM,GAAGkC,aAAaL,IACVhO,KAAKmM,GAAGmC,oBAAoBL,EAASjO,KAAKmM,GAAGoC,aAC/C,CACP,MAAMC,4BAAgCxO,KAAKmM,GAAGsC,kBAAkBR,KAEhE,MADAjO,KAAKmM,GAAGuC,cAAcT,GAChBO,EAERxO,KAAKmM,GAAGwC,WAAWV,GAGnBjO,KAAKyM,QAAQC,SAASG,SAAY7M,KAAKmM,GAAGyC,kBAAkBX,EAAS,YACrEjO,KAAKyM,QAAQO,SAASH,SAAY7M,KAAKmM,GAAGyC,kBAAkBX,EAAS,YACrEjO,KAAKyM,QAAQQ,MAAMJ,SAAe7M,KAAKmM,GAAGyC,kBAAkBX,EAAS,SACrEjO,KAAKyM,QAAQU,QAAQN,SAAa7M,KAAKmM,GAAGyC,kBAAkBX,EAAS,WACrEjO,KAAKyM,QAAQW,UAAUP,SAAW7M,KAAKmM,GAAGyC,kBAAkBX,EAAS,aAGrEjO,KAAK6O,cACL,IAAIC,EAAqB9O,KAAKmM,GAAG4C,mBAAmBd,EAAS,eAC7DjO,KAAKmM,GAAG6C,UAAUF,EAAoB9O,KAAK+L,OAAOvK,MAAOxB,KAAK+L,OAAOtK,QACrEzB,KAAKiP,mBAAqBjP,KAAKmM,GAAG4C,mBAAmBd,EAAS,eAC9DjO,KAAKmM,GAAG6C,UAAUhP,KAAKiP,mBAAoBjP,KAAK8L,KAAKhM,EAAGE,KAAK8L,KAAK/L,GAClEC,KAAKkP,gBAAkBlP,KAAKmM,GAAG4C,mBAAmBd,EAAS,YAC3DjO,KAAKmM,GAAG6C,UAAUhP,KAAKkP,gBAAiB,EAAK,GAI7C,IAAIC,EAAUnP,KAAKmM,GAAGiD,gBACtBpP,KAAKmM,GAAGkD,YAAYrP,KAAKmM,GAAGmD,WAAYH,GACxCnP,KAAKuP,WAAW,oGAChBvP,KAAKmM,GAAGqD,cAAcxP,KAAKmM,GAAGmD,WAAYtP,KAAKmM,GAAGsD,mBAAoBzP,KAAKmM,GAAGuD,SAC9E1P,KAAKmM,GAAGqD,cAAcxP,KAAKmM,GAAGmD,WAAYtP,KAAKmM,GAAGwD,mBAAoB3P,KAAKmM,GAAGuD,SAC9E1P,KAAKmM,GAAGqD,cAAcxP,KAAKmM,GAAGmD,WAAYtP,KAAKmM,GAAGyD,eAAgB5P,KAAKmM,GAAG0D,eAC1E7P,KAAKmM,GAAGqD,cAAcxP,KAAKmM,GAAGmD,WAAYtP,KAAKmM,GAAG2D,eAAgB9P,KAAKmM,GAAG0D,eAC1E7P,KAAKmM,GAAG4D,cAAc/P,KAAKmM,GAAG6D,UAE9BC,WAAW,KACTjQ,KAAK0N,cACL1N,KAAKkQ,eACLlQ,KAAKmQ,UACJ,KAGExQ,oBAA8B,MAAO,QAEpCA,eACN,IAAIG,EAAIE,KAAKqN,UAAU7L,OAASxB,KAAK6N,GAAK7N,KAAKoQ,KACzCrQ,EAAIC,KAAKqN,UAAU5L,QAAUzB,KAAK4N,GAAK5N,KAAKoQ,KAElD,MAAMC,EAAYrQ,KAAKuM,UAAUnQ,OAC7BiU,EAAY9P,KAAKC,MAAMV,GAAKS,KAAKC,MAAMT,KAEzCA,GADAD,EAAIS,KAAK+P,KAAK/P,KAAKgQ,KAAKF,KAChB,EACRrQ,KAAKqN,UAAU7L,MAAQ1B,GAAKE,KAAK6N,GAAK7N,KAAKoQ,KAC3CpQ,KAAKqN,UAAU5L,OAAS1B,GAAKC,KAAK4N,GAAK5N,KAAKoQ,KAC5CpQ,KAAK0N,cACL1N,KAAKmM,GAAG6C,UAAUhP,KAAKiP,mBAAoBnP,EAAGC,IAEhDC,KAAKmM,GAAG6C,UAAUhP,KAAKkP,gBAAiBlP,KAAKoQ,IAAMpQ,KAAKqN,UAAU7L,MAAOxB,KAAKoQ,IAAMpQ,KAAKqN,UAAU5L,QAEnG,IAAWsJ,EAAPhN,EAAI,EACRiC,KAAKyN,IAAI+C,UAAY,UACrBxQ,KAAKyN,IAAIgD,SAAS,EAAG,EAAGzQ,KAAKqN,UAAU7L,MAAOxB,KAAKqN,UAAU5L,QAC7DzB,KAAKyN,IAAI+C,UAAY,UAErB,MAAME,EAAU,GAAM1Q,KAAK2Q,IACrB9C,EAAK7N,KAAK6N,GAAK7N,KAAKoQ,IACpBxC,EAAK5N,KAAK4N,GAAK5N,KAAKoQ,IAC1B,IAAIvQ,EAAI,GAAM+N,EACd,IAAK,IAAIxQ,EAAI,EAAGA,EAAI2C,IAAK3C,EAAG,CAC1B,IAAIwC,EAAe,GAAXI,KAAKoQ,IACb,IAAK,IAAIlU,EAAI,EAAGA,EAAI4D,QAEPsF,KADX2F,EAAK/K,KAAKuM,UAAUxO,MADG7B,IAAK6B,EAG5BiC,KAAKyN,IAAImD,SAAS7F,EAAInL,EAAI8Q,EAAS7Q,GACnCD,GAAKiO,EAEP,IAAK9C,EAAI,MACTlL,GAAK+N,EAEP5N,KAAKmM,GAAG0E,WAAW7Q,KAAKmM,GAAGmD,WAAY,EAAGtP,KAAKmM,GAAG2E,KAAM9Q,KAAKmM,GAAG2E,KAAM9Q,KAAKmM,GAAG4E,cAAe/Q,KAAKqN,WAG5F1N,WAAWqR,EAAeC,GAAiB,GACjD,IAAKjR,KAAKmM,GAAI,OACd,IAAI+E,GAAU,EACd,IAAK,IAAIhV,EAAI,EAAGA,EAAI8U,EAAM5U,SAAUF,EAC7B8D,KAAKsM,QAAQ0E,EAAM9U,MACtBgV,GAAU,EACVlR,KAAKuM,UAAUjQ,KAAK0U,EAAM9U,IAC1B8D,KAAKsM,QAAQ0E,EAAM9U,IAAM8D,KAAKuM,UAAUnQ,OAAS,GAIjD8U,GAAWD,GAAOjR,KAAKkQ,eAGtBvQ,YAAYnC,GACjBA,EAAIA,GAAK+B,OAAO4R,iBAAiBnR,KAAK8L,KAAKM,KAAM,MACjDpM,KAAKyN,IAAI2D,KAAO5T,EAAE6T,SAAW,IAAM7T,EAAE8T,WAAa,IAAM9T,EAAE+T,WAC1DvR,KAAKyN,IAAI+D,aAAe,SACxBxR,KAAKyN,IAAI+C,UAAY,UACrBxQ,KAAK6N,GAAK7N,KAAKyN,IAAIgE,YAAY,KAAKjQ,MACpCxB,KAAK4N,GAAK8D,SAASlU,EAAE6T,SAAU,IAC/BrR,KAAK2Q,IAAM3Q,KAAK8L,KAAK6B,SAAY3N,KAAK4N,GAAK5N,KAAK6N,GAAM,EAClD7N,KAAK8L,KAAK6B,WAAU3N,KAAK6N,GAAK7N,KAAK4N,IACvC5N,KAAKoQ,IAAiC,EAA3B7P,KAAK+P,KAAe,GAAVtQ,KAAK4N,IAE1B,MAAMX,EAAQzP,EAAEyP,MAAM0E,MAAM,QACtBxE,EAAU3P,EAAEoU,gBAAgBD,MAAM,QACxC3R,KAAKwM,cAAcjO,EAAImT,SAASzE,EAAM,GAAI,IAAM,IAChDjN,KAAKwM,cAAcxB,EAAI0G,SAASzE,EAAM,GAAI,IAAM,IAChDjN,KAAKwM,cAAcvB,EAAIyG,SAASzE,EAAM,GAAI,IAAM,IAChDjN,KAAKwM,cAActB,GAAKwG,SAASvE,EAAQ,GAAI,IAAM,IACnDnN,KAAKwM,cAAcrB,GAAKuG,SAASvE,EAAQ,GAAI,IAAM,IACnDnN,KAAKwM,cAAcpB,GAAKsG,SAASvE,EAAQ,GAAI,IAAM,IAG9CxN,SAEAA,SACLK,KAAKmM,GAAG0F,MAAM7R,KAAKmM,GAAG2F,kBACtB,MAAMhS,EAAIE,KAAK8L,KAAKhM,EAClBC,EAAIC,KAAK8L,KAAK/L,EAGhB,IAAIgS,EAAQ/R,KAAK8L,KAAKa,OAGlBqF,GAFehS,KAAK8L,KAAKmG,aACRjS,KAAK8L,KAAKoG,mBAChB,GAEf,IAAK,IAAI9U,EAAI,EAAGA,EAAI2C,IAAK3C,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAI4D,IAAK5D,EAAG,CAC1B,MAAM0I,EAAOmN,EAAM3U,GAAGlB,GACtB,IAAI6O,EAAK/K,KAAKsM,QAAQ1H,EAAKmG,SAChB3F,IAAP2F,IACF/K,KAAKuP,WAAW3K,EAAKmG,IAAI,GACzBiH,GAAW,EACXjH,EAAK/K,KAAKsM,QAAQ1H,EAAKmG,KAEzB,MAAMoH,EAAkC,EAA9BnS,KAAKyM,QAAQQ,MAAML,UAAgBxP,EAAI0C,EAAI5D,GAC/CkW,EAAuC,EAAlCpS,KAAKyM,QAAQW,UAAUR,UAAgBxP,EAAI0C,EAAI5D,GACpDqC,OAAe6G,IAAXR,EAAKrG,EAAkByB,KAAKwM,cAAcjO,EAAIqG,EAAKrG,EAAI,IAC3DyM,OAAe5F,IAAXR,EAAKoG,EAAkBhL,KAAKwM,cAAcxB,EAAIpG,EAAKoG,EAAI,IAC3DC,OAAe7F,IAAXR,EAAKqG,EAAkBjL,KAAKwM,cAAcvB,EAAIrG,EAAKqG,EAAI,IAC3DC,OAAiB9F,IAAZR,EAAKsG,GAAmBlL,KAAKwM,cAActB,GAAKtG,EAAKsG,GAAK,IAC/DC,OAAiB/F,IAAZR,EAAKuG,GAAmBnL,KAAKwM,cAAcrB,GAAKvG,EAAKuG,GAAK,IAC/DC,OAAiBhG,IAAZR,EAAKwG,GAAmBpL,KAAKwM,cAAcpB,GAAKxG,EAAKwG,GAAK,IACrE,IAAK,IAAItN,EAAI,EAAGA,EAAI,IAAKA,EAAG,CAC1B,MAAMoB,EAAIiT,EAAIrU,EAAIkC,KAAKyM,QAAQQ,MAAML,SACrC5M,KAAKyM,QAAQQ,MAAMrR,KAAKsD,EAAI,GAAKX,EACjCyB,KAAKyM,QAAQQ,MAAMrR,KAAKsD,EAAI,GAAK8L,EACjChL,KAAKyM,QAAQQ,MAAMrR,KAAKsD,EAAI,GAAK+L,EACjCjL,KAAKyM,QAAQU,QAAQvR,KAAKsD,EAAI,GAAKgM,EACnClL,KAAKyM,QAAQU,QAAQvR,KAAKsD,EAAI,GAAKiM,EACnCnL,KAAKyM,QAAQU,QAAQvR,KAAKsD,EAAI,GAAKkM,EACnCpL,KAAKyM,QAAQW,UAAUxR,KAAKwW,EAAKtU,GAAKiN,GAMxCiH,GAAUhS,KAAKkQ,eACnBlQ,KAAKmM,GAAGkG,WAAWrS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQQ,MAAMN,QAC5D3M,KAAKmM,GAAGoG,WAAWvS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQQ,MAAMrR,KAAMoE,KAAKyM,QAAQQ,MAAMH,MACrF9M,KAAKmM,GAAGkG,WAAWrS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQU,QAAQR,QAC9D3M,KAAKmM,GAAGoG,WAAWvS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQU,QAAQvR,KAAMoE,KAAKyM,QAAQU,QAAQL,MACzF9M,KAAKmM,GAAGkG,WAAWrS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQW,UAAUT,QAChE3M,KAAKmM,GAAGoG,WAAWvS,KAAKmM,GAAGmG,aAActS,KAAKyM,QAAQW,UAAUxR,KAAMoE,KAAKyM,QAAQW,UAAUN,MAE7F,MAAM0F,EAASxS,KAAKyM,QAAQC,SAC5B1M,KAAKmM,GAAGsG,WAAWzS,KAAKmM,GAAGuG,UAAW,EAAGF,EAAO5W,KAAKQ,OAASoW,EAAO5F,UAI/DjN,cAAcgT,EAAcC,GAClC,MAAMC,EAAS7S,KAAKmM,GAAG2G,aAAaH,GAIpC,GAHA3S,KAAKmM,GAAG4G,aAAaF,EAAQD,GAC7B5S,KAAKmM,GAAG4B,cAAc8E,IACX7S,KAAKmM,GAAG6G,mBAAmBH,EAAQ7S,KAAKmM,GAAG8G,gBAC7C,CACP,MAAMzE,EAAM,2BAA6BxO,KAAKmM,GAAG+G,iBAAiBL,GAElE,MADA7S,KAAKmM,GAAGkC,aAAawE,GACfrE,EAER,OAAOqE,EAGDlT,cACN,IAAIwT,EAAGX,EAAQ/F,EAAUzM,KAAKyM,QAE9B,MAAM3M,EAAIE,KAAK8L,KAAKhM,EACdC,EAAIC,KAAK8L,KAAK/L,EAGpB,IAAKoT,KAAKnT,KAAKyM,SACb+F,EAAS/F,EAAQ0G,IACVvX,KAAO,IAAIwX,aAA+B,EAAlBZ,EAAO5F,SAAe9M,EAAIC,GAG3D,IAAK,IAAI3C,EAAI,EAAGA,EAAI2C,IAAK3C,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAI4D,IAAK5D,EAAG,CAE1B,MAAMiW,EAAgC,EAA5B1F,EAAQC,SAASE,UAAgBxP,EAAI0C,EAAI5D,GACnD8D,KAAKqT,WAAW5G,EAAQC,SAAS9Q,KAAMuW,EAAGjW,EAAI8D,KAAK6N,GAAIzQ,EAAI4C,KAAK4N,GAAI5N,KAAK6N,GAAI7N,KAAK4N,IAClF5N,KAAKqT,WAAW5G,EAAQO,SAASpR,KAAMuW,EAAG,EAAK,EAAK,EAAK,GAI7D,IAAKgB,KAAKnT,KAAKyM,SACb+F,EAAS/F,EAAQ0G,IACNxG,QAAQ3M,KAAKmM,GAAGmH,aAAad,EAAO7F,QAC/C6F,EAAO7F,OAAS3M,KAAKmM,GAAGoH,eACxBvT,KAAKmM,GAAGkG,WAAWrS,KAAKmM,GAAGmG,aAAcE,EAAO7F,QAChD3M,KAAKmM,GAAGoG,WAAWvS,KAAKmM,GAAGmG,aAAcE,EAAO5W,KAAM4W,EAAO1F,MAC7D9M,KAAKmM,GAAGqH,wBAAwBhB,EAAO3F,UACvC7M,KAAKmM,GAAGsH,oBAAoBjB,EAAO3F,SAAU2F,EAAO5F,SAAU5M,KAAKmM,GAAGuH,OAAO,EAAO,EAAG,GAInF/T,WAAWgU,EAAezX,EAAW0D,EAAWC,EAAWC,EAAWC,GAC5E,MAAM6T,EAAKhU,EACLiU,EAAKhU,EACLiU,EAAKlU,EAAIE,EACTiU,EAAKlU,EAAIE,EAEf4T,EAAMzX,GAAK0X,EACXD,IAAMzX,GAAK2X,EACXF,IAAMzX,GAAK4X,EACXH,IAAMzX,GAAK2X,EACXF,IAAMzX,GAAK0X,EACXD,IAAMzX,GAAK6X,EACXJ,IAAMzX,GAAK0X,EACXD,IAAMzX,GAAK6X,EACXJ,IAAMzX,GAAK4X,EACXH,IAAMzX,GAAK2X,EACXF,IAAMzX,GAAK4X,EACXH,IAAMzX,GAAK6X,IAKYlI,eCvV3B,MAAMmI,EAAuB,IACvBC,EAAyB,IACzBC,GAAgB3V,EAAG,IAAKyM,EAAG,IAAKC,EAAG,SAEzCkJ,UAA0BrJ,EACjBnL,QAAQmF,GACb,OAAO9E,KAGTL,YAAYyU,EAAc7V,EAAIyV,EAAchJ,EAAIgJ,EAAc/I,EAAI+I,GAChEvO,MAAM2O,EAAM7V,EAAGyM,EAAGC,GAGVtL,cAAciF,EAAYE,GAMlC,OALAF,EAAKyP,cACHH,EAAY3V,EAAIuG,EAChBoP,EAAYlJ,EAAIlG,EAChBoP,EAAYjJ,EAAInG,GAEXF,EAGCjF,SAASiF,EAAYE,GAM7B,OALAF,EAAK0P,SACHJ,EAAY3V,EAAIuG,EAChBoP,EAAYlJ,EAAIlG,EAChBoP,EAAYjJ,EAAInG,GAEXF,SAIX2P,UAAqCJ,EACnCxU,YAAYyU,GACV3O,MAAM2O,EAAMH,EAAgBA,EAAgBA,UAI1CO,UAA4BD,EAChC5U,YACEyU,EACOK,EACAC,EACAC,GAEPlP,MAAM2O,GAJCpU,KAAAyU,KACAzU,KAAA0U,KACA1U,KAAA2U,KAKFhV,QAAQmF,GACb,IAAIF,EAAO5E,KAAKgF,QAGhB,OAFAJ,EAAK0P,SAAStU,KAAKyU,GAAIzU,KAAK0U,GAAI1U,KAAK2U,IAE9B/P,SA0CLgQ,UAAwBT,EAC5BxU,YACEyU,EACOK,EACAC,EACAC,GAEPlP,MAAM2O,GAJCpU,KAAAyU,KACAzU,KAAA0U,KACA1U,KAAA2U,KAKFhV,QAAQmF,GACb,IAAIF,EAAO5E,KAAKgF,QAGhB,OAFAJ,EAAK0P,SAAStU,KAAKyU,GAAIzU,KAAK0U,GAAI1U,KAAK2U,IAE9B/P,GAIX,MAAMiQ,EAAS,IAAID,EAAS,IAAK,IAAK,IAAK,KACrCE,EAAS,IAAIF,EAAS,IAAK,IAAK,IAAK,KAE9BG,EAAc,SAASpN,GAClC,OAAQA,EAAKqN,MACX,KAAK/P,EAAA,EAASgQ,OACZ,OAAOJ,EACT,KAAK5P,EAAA,EAASiQ,OACZ,OAAOJ,EACT,QACE,oBAAqBnN,eAAkBA,EAAKqN,2BCIlD,MAAMG,EAAS,IAAIX,EAAa,IAAK,EAAG,IAAK,GACvCY,EAAS,IAAIZ,EAAa,IAAK,IAAK,EAAG,GACvCa,EAAS,IAAIb,EAAa,IAAK,EAAG,EAAG,KACrCc,EAAS,IAAId,EAAa,IAAK,IAAK,EAAG,KACvCe,EAAS,IAAIf,EAAa,IAAK,EAAG,IAAK,KAEvCgB,EAAO,kBD5EiBrB,EAC5BxU,cACE8F,MAAM,KAGD9F,QAAQmF,GACb,IAAIF,EAAO5E,KAAKgF,QAIhB,OAHAhF,KAAKyV,SAAS7Q,EAAME,GACpBF,EAAK8Q,aAEE9Q,ICmEL+Q,EAAO,kBDrDiBxB,EAC5BxU,cACE8F,MAAM,KAGD9F,QAAQmF,GACb,IAAIF,EAAO5E,KAAKgF,QAIhB,OAHAhF,KAAK4V,cAAchR,EAAME,GACzBF,EAAKiR,oBAEEjR,IC4CLkR,EAAQ,kBDhEiB3B,EAC7BxU,cACE8F,MAAM,KAGD9F,QAAQmF,GACb,OAAO9E,KAAKyV,SAASzV,KAAKgF,QAASF,KC2DjCiR,EAAW,IAAIjL,EAAK,IAAK,EAAG,EAAG,GAE/BkL,GACJ,IAAIpB,EAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,EAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,EAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,EAAS,IAAK,IAAK,IAAK,UCzJ0IqB,ED4JzJhM,EAAA,EAAIhB,QACjBC,OAAQ,SACRvJ,OACE,OACEuW,KAAM,KACNC,IAAK,KACLC,aAAc,KACdvU,GAAIwU,KAAKC,MACTC,IAAK,EACLC,QAAS,EACTC,SAAU,IACVC,UAAU,EACVC,KAAM,EACNC,OAAO,EACPxN,OAAQpJ,KAAK4B,MAAMiV,UAAU,KAGjC1M,SACExK,OAAOkH,GACL,OAAIA,aAAciQ,EAAA,EACT,SAELjQ,aAAciQ,EAAA,EACT,UAELjQ,aAAciQ,EAAA,EACT,SAELjQ,aAAciQ,EAAA,EACT,WAELjQ,aAAciQ,EAAA,EACT,SAELjQ,aAAciQ,EAAA,aACE9W,KAAK+W,OAAOlQ,EAAGmQ,WAE/BnQ,aAAciQ,EAAA,iBACM9W,KAAK+W,OAAOlQ,EAAGmQ,WAEnCnQ,aAAciQ,EAAA,EACT,cADT,GAIFnX,QAAQC,EAAGC,GACT,MAAM+E,EAAO5E,KAAKoI,MAAME,GAAG1I,EAAGC,GAAG+E,KACjC,IAAKA,EACH,OAAOmR,EAGT,GAAInR,EAAKO,SACP,OAAQP,EAAKO,SAASS,GAAK,GACzB,KAAK,EACH,OAAO2P,EACT,KAAK,EACH,OAAOD,EACT,KAAK,EACH,OAAOD,EACT,KAAK,EACH,OAAOD,EACT,KAAK,EACH,OAAOD,EAIb,GAAIvQ,EAAKK,MAAM7I,OAAQ,CACrB,GAA0B,IAAtBwI,EAAKK,MAAM7I,OACb,OAAO2Y,EAAYnQ,EAAKK,MAAM,IAGhC,MAAMgS,EAAQjX,KAAK2W,MAA4B,EAApB3W,KAAKkX,aAAmB,GACnD,GAAID,EAAQjB,EAAkB5Z,OAC5B,OAAO4Z,EAAkBiB,GACpB,CACL,MAAME,EAAS5W,KAAKC,MAAMR,KAAK2W,MAA4B,EAApB3W,KAAKkX,aAAmB,IAE/D,OAAOnC,EAAYnQ,EAAKK,MAAMkS,EAASvS,EAAKK,MAAM7I,UAItD,OAAQwI,EAAK2E,SACb,IAAK,IACH,OAAOoM,EACT,IAAK,IACH,OAAOH,EACT,IAAK,IACH,OAAOM,EACT,QACE,OAAOC,IAGXpW,eACEK,KAAKkW,KAAO,UJxDhBvW,YACSyM,EACAtM,EACAC,EACPqX,EACOzJ,GAAoB,GAJpB3N,KAAAoM,OACApM,KAAAF,IACAE,KAAAD,IAEAC,KAAA2N,WAEP3N,KAAKqX,GAAK9W,KAAKC,MAAMV,EAAI,GACzBE,KAAKsX,GAAK/W,KAAKC,MAAMT,EAAI,GAEzBC,KAAKoM,KAAKmL,UAAY,IAGoB,IAAtCnL,EAAKoL,UAAUC,QAAQjM,KACK,IAA1BY,EAAKoL,UAAUpb,OACjBgQ,EAAKoL,UAAYhM,EAEdY,EAAKoL,WAAa,IAAMhM,GAI/BxL,KAAK2M,OAAS,IAAI7L,MAAMf,GACxB,IAAK,IAAI3C,EAAI,EAAGA,EAAI2C,IAAK3C,EAAG,CAC1B4C,KAAK2M,OAAOvP,GAAK,IAAI0D,MAAMhB,GAC3B,IAAK,IAAI5D,EAAI,EAAGA,EAAI4D,IAAK5D,EACvB8D,KAAK2M,OAAOvP,GAAGlB,GAAKuP,EAIxBzL,KAAKoX,SAAWA,EAASpX,MAKnBL,YAAY+X,GAClB,MAAMla,EAAI+B,OAAO4R,iBAAiBnR,KAAKoM,KAAM,MAE7CpM,KAAKiS,aAAezU,EAAEyP,YAAS7H,EAC/BpF,KAAKkS,kBAAoB1U,EAAEoU,sBAAmBxM,EAC1CsS,GACF1X,KAAKoX,SAAS1J,YAAYlQ,GASvBmC,oBACL,OAAOK,KAAKoX,SAASO,oBAWhBhY,IAAIiF,EAAYhF,EAAWC,GAC5BD,EAAI,GAAKC,EAAI,GAAKD,GAAKI,KAAKF,GAAKD,GAAKG,KAAKD,IAC/CC,KAAK2M,OAAO9M,GAAGD,GAAKgF,GAWfjF,UAAUiF,EAAYhF,EAAWC,GACtCG,KAAK2M,OAAO9M,GAAGD,GAAKgF,EAiBfjF,UACLiY,EACAhY,EACAC,EACAtB,EACAyM,EACAC,EACAC,EACAC,EACAC,GAEA,MAAMyM,EAAMD,EAAIxb,OAChB,KAAIwD,EAAI,GAAKC,EAAI,GAEjB,IAAK,IAAI3D,EAAI,EAAGA,EAAI2b,IAAO3b,EAAG,CAK5B,GAJI0D,GAAKI,KAAKF,IACZF,EAAI,IACFC,GAEAA,GAAKG,KAAKD,EAAG,OAEjB,MAAM6E,EAAO,IAAIkG,EAAK8M,EAAI1b,GAAIqC,EAAGyM,EAAGC,EAAGC,EAAIC,EAAIC,GAC/CpL,KAAK8X,UAAUlT,EAAMhF,EAAGC,KACtBD,GAcCD,IAAIC,EAAWC,GACpB,OAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKI,KAAKF,GAAKD,GAAKG,KAAKD,EAAU0L,EAClDzL,KAAK2M,OAAO9M,GAAGD,GAKjBD,QACL,IAAK,IAAIvC,EAAI,EAAGA,EAAI4C,KAAKD,IAAK3C,EAC5B,IAAK,IAAIlB,EAAI,EAAGA,EAAI8D,KAAKF,IAAK5D,EAC5B8D,KAAK2M,OAAOvP,GAAGlB,GAAKuP,EAGxBzL,KAAKoX,SAASvF,QAKTlS,SACLK,KAAKoX,SAASjH,WI3FVnQ,KAAK+X,MAAMC,MACXhY,KAAK4B,MAAMJ,MACXxB,KAAK4B,MAAMH,OACXmK,GACA,GAGF5L,KAAKmW,IAAM,UJoHfxW,YACSkM,EACAoM,EACAnY,EACAC,GAHAC,KAAA6L,WACA7L,KAAAiY,WACAjY,KAAAF,IACAE,KAAAD,IA7BDC,KAAAkY,cAAwB,EACxBlY,KAAAmY,cAAwB,EAGxBnY,KAAAoY,mBAA6B,EAI7BpY,KAAAqY,OAAiB,EACjBrY,KAAAsY,OAAiB,EAuBvBtY,KAAKuY,UAAY,IAAIzX,MAAM+K,EAAS9L,GACpCC,KAAKwY,WAAa,IAAI1X,MAAM+K,EAAS9L,GAErC,IAAK,IAAI3C,EAAI,EAAGA,EAAIyO,EAAS9L,IAAK3C,EAChC4C,KAAKuY,UAAUnb,GAAK,IAAI0D,MAAM+K,EAAS/L,GACvCE,KAAKwY,WAAWpb,GAAK,IAAI0D,MAAM+K,EAAS/L,GAarCH,YAAY8Y,EAAsCC,EAAiBC,GACpED,IACF1Y,KAAK4Y,gBAAaxT,EACI,iBAAXsT,IACM,UAAXA,EAAoB1Y,KAAK4Y,WAAa,SAAShZ,EAAGC,EAAGC,EAAGC,EAAG8Y,EAAOC,EAAOC,GAC3E,MAAMC,EAAY,GAAJlZ,EAASmZ,EAAY,GAAJlZ,EAG/B,OAFAH,GAAKoZ,EACLnZ,GAAKoZ,EACD1Y,KAAKY,IAAIvB,GAAKoZ,EAAQD,GAAUxY,KAAKY,IAAItB,GAAKoZ,EAAQF,EAAeF,EAC7DC,GAEM,WAAXJ,EAAqB1Y,KAAK4Y,WAAa,SAAShZ,EAAGC,EAAGC,EAAGC,EAAG8Y,EAAOC,EAAOC,GACjF,MAAMC,EAAY,GAAJlZ,EAASmZ,EAAY,GAAJlZ,EAI/B,OAHAH,GAAKoZ,EACLnZ,GAAKoZ,EACLF,EAAS,EAAMA,EACXxY,KAAKY,IAAIvB,GAAKoZ,EAAQD,GAAUxY,KAAKY,IAAItB,GAAKoZ,EAAQF,EAAeD,EAC7DD,GAEM,aAAXH,EAAuB1Y,KAAK4Y,WAAa,SAAShZ,EAAGC,EAAGC,EAAGC,EAAG8Y,EAAOC,EAAOC,GACnF,MAAMC,EAAY,GAAJlZ,EAASmZ,EAAY,GAAJlZ,EAG/B,OAFAH,GAAKoZ,GAEGpZ,GADRC,GAAKoZ,GACWpZ,GAAKmZ,EAAQA,EAAQC,EAAQA,GAASF,EAAeF,EACzDC,GAEM,cAAXJ,EAAwB1Y,KAAK4Y,WAAa,SAAShZ,EAAGC,EAAGC,EAAGC,EAAG8Y,EAAOC,EAAOC,GACpF,MAAMC,EAAY,GAAJlZ,EAASmZ,EAAY,GAAJlZ,EAI/B,OAHAH,GAAKoZ,GAGGpZ,GAFRC,GAAKoZ,GAEWpZ,GAAKmZ,EAAQA,EAAQC,EAAQA,IAD7CF,EAAS,EAAMA,GACsDF,EACzDC,GAEM,WAAXJ,IAAqB1Y,KAAK4Y,WAAa,SAAShZ,EAAGC,EAAGC,EAAGC,EAAG8Y,EAAOC,EAAOC,GACjF,OAAIxY,KAAKE,SAAWsY,EAAeD,EACvBD,KAGZ7Y,KAAK4Y,aACP5Y,KAAKkZ,iBAAkB,IAAK7C,MAAQ8C,UACpCnZ,KAAKoY,mBAAqBO,GAAY,MAG1C3Y,KAAKiY,SAAWQ,EASX9Y,YAAY8Y,GAA2CzY,KAAKoZ,SAAWX,EAQvE9Y,cAAc8Y,GAAoDzY,KAAKqZ,WAAaZ,EASpF9Y,aAAa6B,EAAeC,GACjCzB,KAAKF,EAAI0B,EACTxB,KAAKD,EAAI0B,EAaJ9B,gBAAgBf,GACrBoB,KAAKmY,aAAevZ,EACpBoB,KAAKkY,cAAe,EAkBfvY,OAAOC,EAAYC,GACxBD,EAAIA,GAAK,EACTC,EAAIA,GAAK,EAGT,MAAM6D,EAAK9D,EAAII,KAAK6L,SAASwL,GACvBxT,EAAKhE,EAAIG,KAAK6L,SAASyL,GACvBgC,GAAU,IAAKjD,MAAQ8C,UAC7B,IAAII,EAIA3U,EAHA5E,KAAK4Y,YAAc5Y,KAAKkZ,kBAAiBK,GAAaD,EAAUtZ,KAAKkZ,iBAAmBlZ,KAAKoY,oBAC7FmB,GAAaA,GAAa,IAAKvZ,KAAK4Y,gBAAaxT,GAKrD,IAAK,IAAIhI,EAAI,EAAGA,EAAI4C,KAAK6L,SAAS9L,IAAK3C,EACrC,IAAK,IAAIlB,EAAI,EAAGA,EAAI8D,KAAK6L,SAAS/L,IAAK5D,EAAG,CACxC,MAAMsd,EAAMtd,EAAIwH,EAAI+V,EAAMrc,EAAIyG,EAE9B,GAAI7D,KAAKF,IAAM0Z,EAAM,GAAKA,GAAOxZ,KAAKF,GACpC8E,EAAO6G,OAEF,GAAIzL,KAAKD,IAAM0Z,EAAM,GAAKA,GAAOzZ,KAAKF,GAC3C8E,EAAO6G,OAEF,GAAIzL,KAAKoZ,WAAapZ,KAAKoZ,SAASI,EAAKC,GAC9C7U,EAAO6G,OAEF,GAAIzL,KAAK4Y,aAAe5Y,KAAKkY,aAClCtT,EAAO5E,KAAK4Y,WACV1c,EACAkB,EACA4C,KAAK6L,SAAS/L,EACdE,KAAK6L,SAAS9L,EACdC,KAAKiY,SAASuB,EAAKC,GACnBzZ,KAAKuY,UAAUnb,GAAGlB,GAClBqd,GAAa,QAGV,GAAIvZ,KAAKmY,eAAiBnY,KAAKkY,aAAc,CAClD,MAAMwB,EAAUF,EAAMxZ,KAAKqY,OACrBsB,EAAUF,EAAMzZ,KAAKsY,OACvBoB,GAAW,GAAKA,EAAU1Z,KAAK6L,SAAS/L,GAAK6Z,GAAW,GAAKA,EAAU3Z,KAAK6L,SAAS9L,GACvF6E,EAAO5E,KAAKuY,UAAUoB,GAASD,MAClBjO,IAAU7G,EAAO5E,KAAKiY,SAASuB,EAAKC,IAEjD7U,EAAO5E,KAAKiY,SAASuB,EAAKC,QAEvB7U,EAAO5E,KAAKiY,SAASuB,EAAKC,GAEjCzZ,KAAKwY,WAAWpb,GAAGlB,GAAK0I,EAEpB5E,KAAKqZ,YAAczU,IAAS6G,IAC9B7G,EAAO5E,KAAKqZ,WAAWzU,EAAM4U,EAAKC,EAAKH,IAEzCtZ,KAAK6L,SAASiM,UAAUlT,EAAM1I,EAAGkB,GAKrC4C,KAAKqY,OAAS3U,EACd1D,KAAKsY,OAASzU,EAGd,MAAM+V,EAAY5Z,KAAKuY,UACvBvY,KAAKuY,UAAYvY,KAAKwY,WACtBxY,KAAKwY,WAAaoB,EAClB5Z,KAAKkY,cAAe,IIxThBlY,KAAKkW,KACL,CAACtW,EAAGC,IAAMG,KAAK6Z,QAAQja,EAAGC,GAC1BG,KAAK4B,MAAMJ,MACXxB,KAAK4B,MAAMH,QAGbzB,KAAKmW,IAAI2D,YAAY,CAACla,EAAGC,IAChBG,KAAKoI,MAAME,GAAG1I,EAAGC,GAAGkF,MAG7B/E,KAAKmW,IAAI4D,cAAc,CAACnV,EAAMhF,EAAGC,EAAGma,IAC3Bha,KAAKia,SAASrV,EAAMhF,EAAGC,EAAGma,IAGnCE,cAAcla,KAAKoW,cACnBpW,KAAKoW,aAAe+D,YAAY,KAAQna,KAAKoa,aAAepa,KAAKyW,WAEnE9W,YACE,GAAIK,KAAKqa,KAAQ,OACjB,MAAMxY,EAAKwU,KAAKC,MACZtW,KAAK6B,GAAK,IAAOA,IACnB7B,KAAKuW,IAAMvW,KAAKwW,QAChBxW,KAAKwW,QAAU,EACfxW,KAAK6B,GAAKA,GAGZ7B,KAAKqa,MAAO,EACPra,KAAK4W,QAAS5W,KAAK0W,WACtB1W,KAAK0W,UAAW,EAEhB1W,KAAK4B,MAAM0Y,OACXta,KAAKoJ,OAASpJ,KAAK4B,MAAMiV,UAAU,IAIrC7W,KAAKmW,IAAIoE,OAAOva,KAAKkW,KAAKmB,GAAIrX,KAAKkW,KAAKoB,IACxCtX,KAAKkW,KAAK/F,SAEVnQ,KAAKqa,MAAO,EACZra,KAAKwW,SAAW,EAChBxW,KAAK2W,MAAQ,GAEfhX,SAASiF,EAAMhF,EAAGC,EAAGma,GACnB,MAAMQ,EAAUxa,KAAKoI,MAAME,GAAG1I,EAAGC,GAEjC,OAAI2a,EAAQ3V,SAAWD,EAAK6V,QACnB7V,EAAK6V,QAAQD,EAAQ1V,QAGvBF,GAETjF,YAAYgI,GACV,GAAIA,EACF,SAAUoN,EAAYpN,GAAM+S,aAAa/S,EAAK1J,QAGlD0B,gBAAgBgb,GACd,OAAQA,GACN,KAAK1T,EAAA,EAASC,SAEd,KAAKD,EAAA,EAASE,UACZ,MAAO,IACT,KAAKF,EAAA,EAASG,KACZ,MAAO,IACT,KAAKH,EAAA,EAASI,OACZ,MAAO,IACT,KAAKJ,EAAA,EAASK,KACZ,MAAO,IACT,KAAKL,EAAA,EAASM,IACZ,MAAO,IACT,KAAKN,EAAA,EAASO,KACZ,MAAO,IACT,KAAKP,EAAA,EAASQ,KACZ,MAAO,IACT,KAAKR,EAAA,EAASS,KACZ,MAAO,IACT,QACE,yBAA0BiT,OAIlCxR,UACExJ,QACE,OAAOK,KAAKoJ,OAAOX,YAAYzI,KAAK4B,MAAMgE,KAE5CjG,eACE,OAAO,IAAOK,KAAKyW,WAGvB9W,UACEK,KAAK4a,gBAEPjb,gBACEua,cAAcla,KAAKoW,eAErByE,OACElb,QACEK,KAAK4a,gBAEPjb,WACEK,KAAK4a,mCE7VXpR,EAAAjN,OAAAkN,EAAA,EAAAlN,CACA0Z,EPTA,WAA0B,IAAA1L,EAAAvK,KAAa0J,EAAAa,EAAAZ,eAA0BE,EAAAU,EAAAX,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiBY,YAAA,UAAoBZ,EAAA,OAAYY,YAAA,QAAkBZ,EAAA,OAAYY,YAAA,aAAuBZ,EAAA,OAAYW,IAAA,QAAAC,YAAA,mBAAuCF,EAAAT,GAAA,KAAAD,EAAA,OAA0BY,YAAA,aAAuBZ,EAAA,OAAYY,YAAA,cAAwBF,EAAAT,GAAA,OAAAS,EAAAM,GAAAN,EAAAgM,QAAAhM,EAAAT,GAAA,KAAAS,EAAAG,GAAAH,EAAA3I,MAAA,mBAAAuD,GAA+F,OAAA0E,EAAA,MAAgB7K,IAAAmG,EAAAS,GAAA6E,YAAA,cAAwCZ,EAAA,MAAWY,YAAA,aAAuBF,EAAAT,GAAA,8BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA4DY,YAAA,aAAuBF,EAAAT,GAAA,eAAAS,EAAAM,GAAA1F,EAAAS,IAAA,gBAAA2E,EAAAT,GAAA,KAAAD,EAAA,MAAiFY,YAAA,aAAuBF,EAAAT,GAAA,+BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA6DY,YAAA,aAAuBF,EAAAT,GAAA,eAAAS,EAAAM,GAAA1F,EAAAW,KAAA,gBAAAyE,EAAAT,GAAA,KAAAD,EAAA,MAAkFY,YAAA,aAAuBF,EAAAT,GAAA,8BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA4DY,YAAA,aAAuBF,EAAAT,GAAA,eAAAS,EAAAM,GAAA1F,EAAAgB,QAAA,gBAAAoE,EAAAT,GAAA,KAAAD,EAAA,MAAqFY,YAAA,aAAuBF,EAAAT,GAAA,sCAAAS,EAAAT,GAAA,KAAAD,EAAA,MAAoEY,YAAA,aAAuBF,EAAAT,GAAA,eAAAS,EAAAM,GAAA1F,EAAA2V,gBAAA,gBAAAvQ,EAAAT,GAAA,KAAAD,EAAA,MAA6FY,YAAA,aAAuBF,EAAAT,GAAA,8BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA4DY,YAAA,aAAuBF,EAAAT,GAAA,eAAAS,EAAAM,GAAAN,EAAAwM,OAAA5R,EAAA0B,KAAA,gBAAA0D,EAAAT,GAAA,KAAAD,EAAA,MAA6FY,YAAA,aAAuBF,EAAAT,GAAA,6BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA2DY,YAAA,aAAuBZ,EAAA,QAAAU,EAAAG,GAAAvF,EAAA8B,UAAA8T,QAAA,SAAAC,EAAA9e,GAAqE,OAAA2N,EAAA,MAAgB7K,IAAA,WAAA9C,IAAmB2N,EAAA,MAAAU,EAAAT,GAAA,qBAAAS,EAAAM,GAAAN,EAAA0Q,gBAAAD,EAAAL,WAAA,sBAAApQ,EAAAT,GAAA,KAAAD,EAAA,MAAAU,EAAAT,GAAA,qBAAAS,EAAAM,GAAAN,EAAAwK,YAAAiG,EAAAE,YAAA,6BAA+N3Q,EAAAT,GAAA,KAAAD,EAAA,MAA0BY,YAAA,aAAuBF,EAAAT,GAAA,6BAAAS,EAAAT,GAAA,KAAAD,EAAA,MAA2DY,YAAA,aAAuBZ,EAAA,KAAAU,EAAAG,GAAAvF,EAAA8B,UAAAkU,QAAA,SAAAxT,GAA6D,OAAAkC,EAAA,MAAgB7K,IAAA2I,EAAA/B,KAAY2E,EAAAT,GAAA,qBAAAS,EAAAM,GAAAN,EAAAwK,YAAApN,IAAA,6BAAuF4C,EAAAT,GAAA,KAAAD,EAAA,OAAwBY,YAAA,mBAA6BZ,EAAA,OAAYY,YAAA,aAAuBF,EAAAT,GAAA,SAAAS,EAAAT,GAAA,KAAAD,EAAA,OAAwCY,YAAA,cAAwBZ,EAAA,OAAYY,YAAA,eAAyBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA,SAAA+Q,WAAA,aAA0E7Q,YAAA,eAAA8Q,OAAoC3V,GAAA,WAAA+M,KAAA,UAAgC6I,UAAW9c,MAAA6L,EAAA,UAAuBkR,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,YAAsCrR,EAAAkM,SAAAkF,EAAAxZ,OAAAzD,WAAmC6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BY,YAAA,mBAAA8Q,OAAsCM,IAAA,cAAkBtR,EAAAT,GAAA,mDAAAS,EAAAT,GAAA,KAAAD,EAAA,UAAqFY,YAAA,oBAAAgR,IAAoCK,MAAA,SAAAH,GAAyBpR,EAAAmM,UAAA,MAAsBnM,EAAAT,GAAA,yCAAAS,EAAAT,GAAA,KAAAD,EAAA,UAA2EY,YAAA,oBAAAgR,IAAoCK,MAAA,SAAAH,GAAyBpR,EAAAqM,OAAArM,EAAAqM,UAAyBrM,EAAAT,GAAA,iBAAAS,EAAAM,GAAAN,EAAAqM,MAAA,oDOYniG,EACA,KACA,KACA,MAIA7M,EAAA,EAAAP,uFCjBO,MAAMuS,EAAW,SACtBna,EACAoa,EAAyB,MAAM,IAE/B,IAAK,IAAI5e,EAAI,EAAGA,EAAIwE,EAAMH,OAAS,EAAGrE,IAEpC,IAAK,IAAIlB,EAAI,EAAGA,EAAI0F,EAAMJ,MAAOtF,IAAK,CACpC,MACE0I,EAAQhD,EAAM0G,GAAGpM,EAAGkB,GACpB6e,EAAQra,EAAM0G,GAAGpM,EAAGkB,EAAI,GACxB8e,EAAQta,EAAM0G,GAAGpM,EAAGkB,EAAI,GACxBoQ,EAAQ5L,EAAM0G,GAAGpM,EAAI,EAAGkB,GACxB+e,EAAQva,EAAM0G,GAAGpM,EAAI,EAAGkB,GAErB4e,KAA0B,MAAbpX,EAAK5F,MAIN,MAAbwO,EAAKxO,KAA6B,MAAdmd,EAAMnd,KAA0B,MAAXid,EAAGjd,KAA4B,MAAbkd,EAAKld,MAInD,MAAbwO,EAAKxO,KAA6B,MAAdmd,EAAMnd,KAA0B,MAAXid,EAAGjd,KAA4B,MAAbkd,EAAKld,MAIlD,MAAbwO,EAAKxO,KAA6B,MAAdmd,EAAMnd,KAA4B,MAAXid,EAAGjd,KAA4B,MAAbkd,EAAKld,MACrE4C,EAAMwa,QAAQlgB,EAAGkB,EAAGif,EAAA,EAAK7W,QAAQ,QAKvC,OAAO5D,uFC9BT,MAAM0a,EAAY,EAEZC,EAAe,WACnB,OAAOC,EAAA,EAAKhX,QAAQ,MAGhBiX,EAAa,WACjB,OAAOD,EAAA,EAAKhX,QAAQ,MAGhBkX,EAAU,WACd,OAAOF,EAAA,EAAKhX,QAAQ,MAKhBmX,EAAW,SACfhc,EACAC,EACAgc,EAAkB,EAClBC,EAAkB,EAClBC,EAAqB,GAErB,MAAMC,EAAU,UA4GhBpd,YACYqd,EACAC,EACFL,EACAC,EACAC,GAJE9c,KAAAgd,OACAhd,KAAAid,OACFjd,KAAA4c,UACA5c,KAAA6c,UACA7c,KAAA8c,aAER,IAAII,KAEAhhB,EAAI,EACR,KAAQA,EAAI8D,KAAK8c,YACfI,EAAM5gB,KAAM0D,KAAKmd,gBACjBjhB,GAAK,EAGP8D,KAAKkd,MAAQld,KAAKod,UAAWpd,KAAKqd,aAAcH,IAChDld,KAAKsd,MAAQtd,KAAKud,WAAYvd,KAAKkd,OAG7Bvd,eACN,OAAO,IAAI6d,EACT,EACA,EACAxd,KAAK4c,QAAUrgB,OAAAkhB,EAAA,EAAAlhB,CAAKyD,KAAK6c,QAAU7c,KAAK4c,SACxC5c,KAAK4c,QAAUrgB,OAAAkhB,EAAA,EAAAlhB,CAAKyD,KAAK6c,QAAU7c,KAAK4c,UAIpCjd,aAAcud,GACpB,IAAIQ,GAA+BR,EAAMrgB,SAEzC,KAAQqgB,EAAM9gB,QAAS,CACrB,IAAIuhB,EAAoBT,EAAMrgB,QAE1B+gB,EAAgBrhB,OAAAkhB,EAAA,EAAAlhB,CAAM,KAAQ,IAAMgE,KAAKsd,GAG7C,MAAMC,EAAcvd,KAAKud,IAAKF,GACxBG,EAAcxd,KAAKwd,IAAKH,GAC9B,IAAI/f,EAAY,EACZuF,EAAa,EACbC,EAAa,EAEjB,MAASqa,EAAYM,MAASC,GAAUN,EAAYO,SAAUD,KAAU,CACtE,IAAIE,EAAM5d,KAAK6D,MAAOvG,EAAIigB,GACtBM,EAAM7d,KAAK6D,MAAOvG,EAAIkgB,GAE1B,KACElgB,GAAK,EACLsgB,EAAM5d,KAAK6D,MAAOvG,EAAIigB,GACtBM,EAAM7d,KAAK6D,MAAOvG,EAAIkgB,GAEjBI,IAAQ/a,GAAMgb,IAAQ/a,IAK7Bsa,EAAYU,KAAMF,EAAM/a,EAAIgb,EAAM/a,GAClCD,EAAK+a,EACL9a,EAAK+a,EAGPV,EAAYphB,KAAMqhB,GAGpB,OAAOD,EAGD/d,UAAWud,GACjB,MAAMoB,EAAO/hB,OAAAkhB,EAAA,EAAAlhB,CAAK2gB,EAAM7b,IAAO4c,GAAUA,EAAKre,IAAQ,EAChD2e,EAAOhiB,OAAAkhB,EAAA,EAAAlhB,CAAK2gB,EAAM7b,IAAO4c,GAAUA,EAAKpe,IAAQ,EAGtD,OAFAqd,EAAM/Z,QAAW8a,IAAYA,EAAKI,MAAQC,GAAQC,KAE3CrB,EAAMsB,OAAUP,GACZA,EAAKre,EAAIqe,EAAKne,EAAIE,KAAKgd,MAAYiB,EAAKpe,EAAIoe,EAAKle,EAAIC,KAAKid,MAI/Dtd,WAAYud,GAClB,IAAIuB,EAAyBvB,EAAM7b,IAAO4c,GAAmBA,EAAKS,eAE9DC,GAAoCF,EAAO5hB,SAC3CygB,KAEJ,MAAMtZ,EAAW,SAAU4a,EAAeC,GAExC,OAAOte,KAAAue,IAAEF,EAAOhf,EAAIif,EAAOjf,EAAO,GAAIW,KAAAue,IAAEF,EAAO/e,EAAIgf,EAAOhf,EAAO,IAGnE,KAAQ4e,EAAOriB,QAAS,CACtB,IAAI2iB,EAAeN,EAAO5hB,QAEtBmiB,EAAiBL,EAAiB,GAClCM,EAAcjb,EAAU+a,EAAcC,GAE1CL,EAAgBxb,QAAWjC,IACzB,MAAMge,EAAkBlb,EAAU9C,EAAO6d,GACpCG,EAAkBD,IACrBD,EAAiB9d,EACjB+d,EAAcC,KAIlBP,EAAgBriB,KAAMyiB,GAEtBzB,EAAMhhB,KAAM,IAAI6iB,EACdJ,EAAanf,EACbmf,EAAalf,EACbmf,EAAepf,EACfof,EAAenf,IAInB,OAAOyd,IA5NP3c,EACAC,EACAgc,EACAC,EACAC,GAGF,IAAI1U,EAAQ7L,OAAAkhB,EAAA,EAAAlhB,CAAYoE,EAAMC,EAAM8b,GAEpC,IAAM,IAAIxgB,EAAI,EAAGA,EAAI6gB,EAAQG,MAAM9gB,OAAQF,IACzC6gB,EAAQG,MAAOhhB,GAAIoF,IAAK8G,GAE1B,IAAM,IAAIlM,EAAI,EAAGA,EAAI6gB,EAAQO,MAAMlhB,OAAQF,IACzC6gB,EAAQO,MAAOphB,GAAIoF,IAAK8G,GAE1B,OAAO,IAAIoU,EAAA,EAASpU,UAGtBoV,UAAmBC,EAAA,EACjB9d,SAAUyf,GACR,OAASA,EAAKxf,EAAI0c,EAAYtc,KAAKJ,EAAII,KAAKF,GACxCsf,EAAKvf,EAAIyc,EAAYtc,KAAKH,EAAIG,KAAKD,GACnCqf,EAAKxf,EAAIwf,EAAKtf,EAAIE,KAAKJ,EAAI0c,GAC3B8C,EAAKvf,EAAIuf,EAAKrf,EAAIC,KAAKH,EAAIyc,EAGjC3c,cACE,OAAO,IAAI8d,EAAA,EACTzd,KAAKJ,EAAI,EAAIrD,OAAAkhB,EAAA,EAAAlhB,CAAMyD,KAAKF,EAAI,GAC5BE,KAAKH,EAAI,EAAItD,OAAAkhB,EAAA,EAAAlhB,CAAMyD,KAAKD,EAAI,IAIhCJ,IAAKyI,GACH,IAAIlM,EAAY,EAChB,KAAQA,EAAI8D,KAAKF,GAAI,CACnB,IAAI1C,EAAY,EAChB,KAAQA,EAAI4C,KAAKD,GACfqI,EAAOpI,KAAKJ,EAAI1D,GAAK8D,KAAKH,EAAIzC,GAAMmf,IACpCnf,IAGFlB,YAKNijB,UAAmB1B,EAAA,EAGjB9d,YAAaC,EAAWC,EAAWC,EAAWC,GAC5C0F,MAAO7F,EAAGC,EAAGC,EAAGC,GAChBC,KAAKqf,MAAYzf,GAAKE,GAASD,GAAKE,GAAWD,GAAKF,GAASG,GAAKF,EAGpEF,IAAKyI,GACH,IAAMkX,EAAIC,EAAIzf,GAAME,KAAKwf,iBAErBtjB,EAAI,EACR,KAAQA,EAAI4D,GACwB,MAA9BsI,EAAOkX,EAAKpjB,GAAKqjB,GAAKvgB,MACxBoJ,EAAOkX,EAAKpjB,GAAKqjB,GAAO9C,KAE1BvgB,GAAK,EAGP,IAAMujB,EAAIC,EAAI3f,GAAMC,KAAK2f,gBACrBviB,EAAI,EACR,KAAQA,EAAI2C,GACwB,MAA9BqI,EAAOqX,GAAMC,EAAKtiB,GAAI4B,MACxBoJ,EAAOqX,GAAMC,EAAKtiB,GAAMqf,KAE1Brf,GAAK,EAITuC,iBAIE,OAAKK,KAAKqf,OACC9e,KAAKQ,IAAKf,KAAKJ,EAAGI,KAAKF,GAAKS,KAAKD,IAAKN,KAAKH,EAAGG,KAAKD,GAAKQ,KAAKY,IAAKnB,KAAKF,EAAIE,KAAKJ,KAKhFW,KAAKQ,IAAKf,KAAKJ,EAAGI,KAAKF,GAAKS,KAAKQ,IAAKf,KAAKH,EAAGG,KAAKD,GAAKQ,KAAKY,IAAKnB,KAAKF,EAAIE,KAAKJ,IAG7FD,gBAIE,OAAKK,KAAKqf,OACC9e,KAAKQ,IAAKf,KAAKJ,EAAGI,KAAKF,GAAKS,KAAKQ,IAAKf,KAAKH,EAAGG,KAAKD,GAAKQ,KAAKY,IAAKnB,KAAKD,EAAIC,KAAKH,0DC1HuE+f,QAAA,kBCmBtKC,EAXAtjB,OAAAkN,EAAA,EAAAlN,CACAqjB,ECTA,WAA0B,IAAArV,EAAAvK,KAAa0J,EAAAa,EAAAZ,eAA0BE,EAAAU,EAAAX,MAAAC,IAAAH,EAAwB,OAAAG,EAAA,OAAiBY,YAAA,YAAA8Q,OAA+B3V,GAAA,SAAY2E,EAAAlJ,IAAAwV,UAAA,OAAAhN,EAAA,SAAyC0R,OAAO3Z,MAAA2I,EAAAlJ,OAAiBkJ,EAAAuV,KAAAvV,EAAAT,GAAA,KAAAD,EAAA,UAAoC0R,OAAOlV,OAAAkE,EAAAlJ,IAAAgF,UAAyBkE,EAAAT,GAAA,KAAAD,EAAA,OAAwBY,YAAA,SAAmBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA,QAAA+Q,WAAA,YAAwEC,OAAS5I,KAAA,OAAAoN,YAAA,WAAsCvE,UAAW9c,MAAA6L,EAAA,SAAsBkR,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,YAAsCrR,EAAAyV,QAAArE,EAAAxZ,OAAAzD,WAAkC6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA,OAAA+Q,WAAA,WAAsEC,OAAS5I,KAAA,SAAAoN,YAAA,OAAoCvE,UAAW9c,MAAA6L,EAAA,QAAqBkR,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,YAAsCrR,EAAA0V,OAAAtE,EAAAxZ,OAAAzD,WAAiC6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA,OAAA+Q,WAAA,WAAsEC,OAAS5I,KAAA,SAAAoN,YAAA,OAAoCvE,UAAW9c,MAAA6L,EAAA,QAAqBkR,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,YAAsCrR,EAAA2V,OAAAvE,EAAAxZ,OAAAzD,WAAiC6L,EAAAT,GAAA,KAAAD,EAAA,SAAAA,EAAA,MAAAA,EAAA,MAAAU,EAAAT,GAAA,UAAAS,EAAAT,GAAA,KAAAS,EAAAG,GAAAH,EAAA,gBAAA7L,GAA6G,OAAAmL,EAAA,MAAgB7K,IAAAN,IAAU6L,EAAAT,GAAAS,EAAAM,GAAAnM,SAA0B,GAAA6L,EAAAT,GAAA,KAAAS,EAAAG,GAAAH,EAAA,gBAAAvM,GAAkD,OAAA6L,EAAA,MAAgB7K,IAAAhB,IAAM6L,EAAA,MAAAU,EAAAT,GAAAS,EAAAM,GAAA7M,MAAAuM,EAAAT,GAAA,KAAAS,EAAAG,GAAAH,EAAA,gBAAA4I,GAA2E,OAAAtJ,EAAA,MAAgB7K,IAAAmU,EAAAgN,aAAmBC,OAAA,qBAA4B7V,EAAAT,GAAA,eAAAS,EAAAM,GAAAN,EAAA1B,KAAAsK,EAAAnV,IAAA,mBAA+D,MAAM,KAAAuM,EAAAT,GAAA,KAAAD,EAAA,UAA+BA,EAAA,UAAaA,EAAA,OAAYY,YAAA,mBAA6BZ,EAAA,SAAcY,YAAA,0BAAA8Q,OAA6CM,IAAA,YAAgBtR,EAAAT,GAAA,kCAAAS,EAAAT,GAAA,KAAAD,EAAA,OAAiEY,YAAA,cAAwBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA,OAAA+Q,WAAA,WAAsE7Q,YAAA,eAAA8Q,OAAoC3V,GAAA,SAAA+M,KAAA,UAA8B6I,UAAW9c,MAAA6L,EAAA,QAAqBkR,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,YAAsCrR,EAAAxH,OAAA4Y,EAAAxZ,OAAAzD,eAAiC6L,EAAAT,GAAA,KAAAD,EAAA,OAA4BY,YAAA,mBAA6BZ,EAAA,OAAYY,YAAA,aAAuBF,EAAAT,GAAA,+BAAAS,EAAAT,GAAA,KAAAD,EAAA,OAA8DY,YAAA,cAAwBZ,EAAA,OAAYY,YAAA,eAAyBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA8V,iBAAA,SAAA/E,WAAA,8BAA4G7Q,YAAA,mBAAA8Q,OAAwC3V,GAAA,QAAA+M,KAAA,YAA+B6I,UAAW8E,QAAAxf,MAAAyf,QAAAhW,EAAA8V,iBAAAtE,UAAAxR,EAAAiW,GAAAjW,EAAA8V,iBAAAtE,SAAA,SAAAxR,EAAA8V,iBAAA,UAAqI5E,IAAKgF,OAAA,SAAA9E,GAA0B,IAAA+E,EAAAnW,EAAA8V,iBAAAtE,SAAA4E,EAAAhF,EAAAxZ,OAAAye,IAAAD,EAAAL,QAAyF,GAAAxf,MAAAyf,QAAAG,GAAA,CAAuB,IAAAG,EAAAtW,EAAAiW,GAAAE,EAAA,MAAiCC,EAAAL,QAAiBO,EAAA,GAAAtW,EAAAuW,KAAAvW,EAAA8V,iBAAA,WAAAK,EAAAK,QAAlD,QAA8HF,GAAA,GAAAtW,EAAAuW,KAAAvW,EAAA8V,iBAAA,WAAAK,EAAAjhB,MAAA,EAAAohB,GAAAE,OAAAL,EAAAjhB,MAAAohB,EAAA,UAAsGtW,EAAAuW,KAAAvW,EAAA8V,iBAAA,WAAAO,OAAmDrW,EAAAT,GAAA,KAAAD,EAAA,SAA0BY,YAAA,mBAAA8Q,OAAsCM,IAAA,WAAetR,EAAAT,GAAA,+CAAAS,EAAAT,GAAA,KAAAD,EAAA,OAA8EY,YAAA,eAAyBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA8V,iBAAA,WAAA/E,WAAA,gCAAgH7Q,YAAA,eAAA8Q,OAAoC3V,GAAA,aAAA+M,KAAA,UAAkC6I,UAAW9c,MAAA6L,EAAA8V,iBAAA,YAA0C5E,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,WAAsCrR,EAAAuW,KAAAvW,EAAA8V,iBAAA,aAAA1E,EAAAxZ,OAAAzD,WAAoE6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BY,YAAA,mBAAA8Q,OAAsCM,IAAA,gBAAoBtR,EAAAT,GAAA,gDAAAS,EAAAT,GAAA,KAAAD,EAAA,OAA+EY,YAAA,eAAyBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA8V,iBAAA,QAAA/E,WAAA,6BAA0G7Q,YAAA,eAAA8Q,OAAoC3V,GAAA,UAAA+M,KAAA,UAA+B6I,UAAW9c,MAAA6L,EAAA8V,iBAAA,SAAuC5E,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,WAAsCrR,EAAAuW,KAAAvW,EAAA8V,iBAAA,UAAA1E,EAAAxZ,OAAAzD,WAAiE6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BY,YAAA,mBAAA8Q,OAAsCM,IAAA,aAAiBtR,EAAAT,GAAA,6CAAAS,EAAAT,GAAA,KAAAD,EAAA,OAA4EY,YAAA,eAAyBZ,EAAA,SAAcuR,aAAand,KAAA,QAAAod,QAAA,UAAA3c,MAAA6L,EAAA8V,iBAAA,QAAA/E,WAAA,6BAA0G7Q,YAAA,eAAA8Q,OAAoC3V,GAAA,UAAA+M,KAAA,UAA+B6I,UAAW9c,MAAA6L,EAAA8V,iBAAA,SAAuC5E,IAAKC,MAAA,SAAAC,GAAyBA,EAAAxZ,OAAAyZ,WAAsCrR,EAAAuW,KAAAvW,EAAA8V,iBAAA,UAAA1E,EAAAxZ,OAAAzD,WAAiE6L,EAAAT,GAAA,KAAAD,EAAA,SAA0BY,YAAA,mBAAA8Q,OAAsCM,IAAA,aAAiBtR,EAAAT,GAAA,iDAAAS,EAAAT,GAAA,KAAAD,EAAA,OAAgFY,YAAA,mBAA6BZ,EAAA,OAAYY,YAAA,cAAwBZ,EAAA,UAAeY,YAAA,kBAAAgR,IAAkCK,MAAA,SAAAH,GAAyBpR,EAAAyW,kBAAoBzW,EAAAT,GAAA,yDDYpkK,EACA,KACA,KACA,4BERA,IAAIG,EAAA,GACFgX,GAAI,OACJ9Q,OAAQpQ,GAAKA,EAAE8f,qGCT4V,uDCAE,qsBCkG/W9V,oBAAA,EAAemX,iCAAA,EAAIjY,QACjBrN,KAAI,MAEAyF,IAAK,IAAI8f,kCAAA,QACTpe,OAAQ,GACRlB,GAAIwU,KAAKC,MACT+J,kBACEtE,UAAU,EACVa,QAAS,EACTC,QAAS,EACTC,WAAY,GAEdmD,OAAQ,EACRC,OAAQ,GACRF,QAAS,2BAGb7W,UACExJ,SACE,IAAIyhB,KACJ,IAAK,IAAIllB,EAAI8D,KAAKigB,OAAQ/jB,GAAK8D,KAAKkgB,OAAQhkB,IAC1CklB,EAAM9kB,KAAKJ,GAIb,OAAOklB,IAIXC,YACEC,KAAAC,uCAAA,EACAxf,OAAAyf,yCAAA,EACAC,MAAAC,wCAAA,GAEFvX,SACExK,KAAKwT,EAAGnV,GACN,IACE,OAAO2jB,KAAK3hB,KAAKggB,SACjB,MAAM4B,GACN,MAAO,MAGXjiB,cACEK,KAAKqB,IAAMrB,KAAK6hB,WAChB,IAAIjiB,EAAI,EACJC,EAAI,EAER,MAAQG,KAAKqB,IAAIyH,eAAelJ,EAAGC,IAC7BD,EAAII,KAAKqB,IAAIG,MAAQ,EACvB5B,GAAK,GAELA,EAAI,EACJC,GAAK,GAIT,MAAMiiB,EAAY,IAAIC,uCAAA,EACpBniB,EACAC,EACA,GACAG,KAAK+C,OACL,GACA,IAAIif,iCAAA,GASN,IANAF,EAAUG,SAASjiB,KAAKqB,KACxBygB,EAAUI,KAAK,IAAIC,oCAAA,GAEnBviB,EAAII,KAAKqB,IAAIG,MAAQ,EACrB3B,EAAIG,KAAKqB,IAAII,OAAQ,GAEbzB,KAAKqB,IAAIyH,eAAelJ,EAAGC,IAC7BD,EAAI,EACNA,GAAK,GAELA,EAAII,KAAKqB,IAAIG,MAAQ,EACrB3B,GAAK,GAIT,MAAMuiB,EAAY,IAAIL,uCAAA,EACpBniB,EACAC,EACA,IACAG,KAAK+C,OACL,EACA,IAAIif,iCAAA,GAGNI,EAAUH,SAASjiB,KAAKqB,KACxB+gB,EAAUF,KAAK,IAAIC,oCAAA,IAErBxiB,WACE,IAAI0B,EAAM9E,OAAA8lB,gDAAA,EAAA9lB,CACR,GACA,GACAyD,KAAKqgB,iBAAiBzD,QACtB5c,KAAKqgB,iBAAiBxD,QACtB7c,KAAKqgB,iBAAiBvD,YAGxB,OAAI9c,KAAKqgB,iBAAiBtE,SACjBxf,OAAA+lB,6CAAA,EAAA/lB,CAAS8E,GAGXA,IAGX1B,UACEK,KAAKghB,sEC/MuW,uBCAhX,IAAA3f,GACAkhB,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,aAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,OAAA,IACAC,UAAA,IACAC,aAAA,GACAC,gBAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,UAAA,GACAC,aAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA,GACAC,OAAA,GACAC,UAAA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","file":"main.fd9f41b6.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([183,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export class Rect {\n  x: number\n  y: number\n  w: number\n  h: number\n\n  constructor( x: number, y: number, w: number, h: number ) {\n    // TODO: Validate?\n    this.x = x\n    this.y = y\n    this.w = w\n    this.h = h\n  }\n\n  move( x: number, y: number ): void {\n    this.x += x\n    this.y += y\n  }\n}\n\nexport const succ = function ( c: string ): string {\n  return String.fromCharCode( c.charCodeAt( 0 ) + 1 )\n}\n\nexport const rand = function ( max: number ): number {\n  return Math.floor( Math.random() * max )\n}\n\n/* tslint:disable no-any */\nexport const twoDimArray = function ( dimX: number, dimY: number,\n                                      value: ( x: number, y: number ) => any ): Array<Array<any>> {\n  let field = Array( dimX )\n\n  let i = 0\n  while ( i < dimX ) {\n    field[i] = new Array(dimY)\n    let j = 0\n    while ( j < dimY ) {\n      field[i][j] = value( i, j )\n      j++\n    }\n    i++\n  }\n\n  return field\n}\n\nexport const max = function( list: Array< number > ): number {\n  return Math.max.apply( Math, list )\n}\n\nexport const min = function( list: Array< number > ): number {\n  return Math.min.apply( Math, list )\n}\n\nexport class Point {\n  constructor(\n    public x: number,\n    public y: number,\n  ) {\n  }\n\n  public static readonly dxy = [\n    new Point(-1, -1), new Point(0, -1), new Point(1, -1),\n    new Point(-1,  0),                   new Point(1,  0),\n    new Point(-1,  1), new Point(0,  1), new Point(1,  1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(protected map: T[][]) {\n    this.width  = map[0].length\n    this.height = map.length\n  }\n\n  public at(x, y): T {\n    return this.map[y][x]\n  }\n}\n","import * as moment from 'moment'\nimport { Creature } from './creature'\nimport { Moment } from 'moment'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport class LogMessage {\n  constructor(\n    public level: LogLevel,\n    public ts: Moment,\n    public message: string,\n  ) {\n  }\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name()} got ${damage} damage from ${actor.name()}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(`${target.name()} got ${damage} damage from ${actor.name()} causes them to die`)\n  }\n\n  protected debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  protected info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  protected warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  protected danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    this.messages.push(\n      new LogMessage(\n        level,\n        moment(),\n        message,\n      )\n    )\n  }\n}\n","export class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private checkSolid: (x: number, y: number) => boolean,\n    private markVisible: (x: number, y: number, degree: number) => void,\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.checkSolid(this.startx, this.starty)) {\n      [[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(row: number, start: number, end: number, xx: number, xy: number, yx: number, yy: number) {\n    if (start < end) { return }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (!(currentX >= 0 && currentY >= 0 && currentX < this.width && currentY < this.height) || start < rightSlope) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius,\n          )\n        }\n\n        if (blocked) { // previous cell was a blocking one\n          if (this.checkSolid(currentX, currentY)) { // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (this.checkSolid(currentX, currentY) && distance < this.radius) { // hit a wall within sight line\n              blocked = true\n              this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n              newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { Mapped, Point, twoDimArray } from './utils'\nimport { AI } from './ai'\nimport { Fov } from './fov'\nimport { Item, Equipment } from './items'\n\nimport { LevelMap, LevelMapId, Tile } from './map'\nimport { Logger } from './logger'\nimport { Inventory, BodyPart } from './inventory'\n\nexport class MemoryTile  {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n\n  constructor(\n    public tile?: Tile,\n  ) {\n  }\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public items(): Item[] {\n    return this.tile.items\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public creature(): Phantom {\n    return this.tile && this.tile.creature\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.tile.creature = undefined\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(\n    width: number,\n    height: number,\n  ) {\n    const baseTile = Tile.retrive('W')\n    super(twoDimArray(height, width, () => new MemoryTile(baseTile)))\n  }\n\n  public inRange(point: Point): boolean {\n    return point.x >= 0         && point.y >= 0\n        && point.x < this.width && point.y < this.height\n  }\n\n  public resetVisible(): void {\n    this.map.forEach((row) => {\n      row.forEach((tile) => {\n        tile.reset()\n      })\n    })\n  }\n}\n\nexport type CreatureId = number\n\nexport class Phantom {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  public pos: Point\n  public refToReal?: Creature\n\n  constructor(\n    x: number,\n    y: number,\n    public id: CreatureId = Phantom.getId(),\n  ) {\n    this.pos = new Point(x, y)\n  }\n\n  public clone(): Phantom {\n    return new Phantom(this.pos.x, this.pos.y, this.id)\n  }\n\n  public real(): Creature {\n    return this.refToReal\n  }\n}\n\nexport abstract class Event {\n  public abstract affect(actor: Creature): Reaction\n}\n\nexport class Attack {\n  constructor(public actor: Creature, public damage: number) {}\n\n  public affect(subject: Creature): Reaction {\n    if (this.damage > subject.health) {\n      subject.currentLevel.logger.killMessage(this.damage, this.actor, subject)\n      subject.die()\n      return Reaction.HURT\n    } else {\n      subject.health -= this.damage\n      subject.currentLevel.logger.hurtMessage(this.damage, this.actor, subject)\n      return Reaction.DIE\n    }\n  }\n}\n\nexport enum EventType {\n  Attack,\n}\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  NOTHING,\n}\n\nexport type Characteristics = {\n}\n\nexport class Creature extends Phantom {\n  ai: AI\n  public stageMemories: { [key: string]: Memory } = {}\n  public previousPos: Point\n  public currentLevel: LevelMap\n  public inventory: Inventory\n  public characteristics: Characteristics\n\n  constructor(\n    x: number,\n    y: number,\n    public health: number,\n    public radius: number,\n    private speed: number,\n    ai: AI,\n  ) {\n    super(x, y)\n    this.previousPos = this.pos.copy()\n    this.ai = ai\n    this.inventory = new Inventory([\n      BodyPart.LeftHand,\n      BodyPart.RightHand,\n      BodyPart.Legs,\n      BodyPart.Finger,\n      BodyPart.Head,\n      BodyPart.Eye,\n      BodyPart.Neck,\n      BodyPart.Back,\n      BodyPart.Body,\n    ])\n  }\n\n  public wear(item: Equipment) {\n    this.inventory.equip(item)\n  }\n\n  public name(): string {\n    return `${this.id}`\n  }\n\n  public addToMap(level: LevelMap) {\n    this.currentLevel = level\n    this.visionMask(level)\n    level.addCreature(this)\n  }\n\n  public emit(eventType: EventType): Event {\n    switch (eventType) {\n    case EventType.Attack:\n      return new Attack(this, this.speed)\n    default:\n      throw `Unknow event type ${eventType} for ${this}`\n    }\n  }\n\n  public die(): void {\n    this.currentLevel.removeCreature(this)\n  }\n\n  public on(event: Event): Reaction {\n    return event.affect(this)\n  }\n\n  public real(): Creature {\n    return this\n  }\n\n  // Speed, affect how often the creature acts\n  public initiativity(): number {\n    return this.speed\n  }\n\n  public stageMemory(levelId: LevelMapId = this.currentLevel.id): Memory {\n    return this.stageMemories[levelId]\n  }\n\n  public act(stage: LevelMap): void {\n    this.visionMask(stage)\n    this.previousPos = this.pos.copy()\n    this.ai.act(this, true)\n    stage.at(this.previousPos.x, this.previousPos.y).creature = undefined\n    stage.at(this.pos.x, this.pos.y).creature = this\n  }\n\n  public move(nextPoint: Point) {\n    this.pos = nextPoint.copy()\n  }\n\n  public clone(): Phantom {\n    let phantom = new Phantom(this.pos.x, this.pos.y, this.id)\n    phantom.refToReal = this\n    return phantom\n  }\n\n  public visionMask(stage: LevelMap): void {\n    if (!this.stageMemories[stage.id]) {\n      this.stageMemories[stage.id] = new Memory(stage.width, stage.height)\n    } else {\n      this.stageMemory().resetVisible()\n    }\n\n    const see = (x: number, y: number, degree: number): void => {\n      this.stageMemory().at(x, y).see(stage.at(x, y), degree)\n    }\n\n    new Fov(\n      this.pos.x,\n      this.pos.y,\n      this.radius,\n      stage.width,\n      stage.height,\n      this.isSolid(stage),\n      see,\n    ).calc()\n  }\n\n  private isSolid(stage: LevelMap): (x: number, y: number) => boolean {\n    return (x: number, y: number) => {\n      if (stage.visibleThrough(x, y)) {\n        return false\n      } else {\n        return !(stage.at(x, y).isDoor() && this.pos.x === x && this.pos.y === y)\n      }\n    }\n  }\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('td',[_vm._v(\"\\n  :class=\\\"style\\\"\\n  v-text=\\\"symbol\\\"\\n  @click=\\\"$emit('setPosition')\\\"\\n\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { Tile, TileTypes } from '../map'\n\nexport default Vue.extend({\n  props: [\"cell\", 'player'],\n  computed: {\n    style() {\n      if (this.player) {\n        return 'player'\n      } else if (this.cell.isWall()) {\n        return 'wall'\n      } else if (this.cell.isDoor()) {\n        return 'door'\n      }\n\n      return 'floor'\n    },\n    symbol():any {\n      if (this.player) {\n        return '俺'\n      } else if (this.cell.display == ' ') {\n        return '・'\n      } else if (this.cell.display == '+') {\n        return '戸'\n      } else if (this.cell.display == '#') {\n        return '＃'\n      } else {\n        return 'E'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Cell.vue?vue&type=template&id=489eab39\"\nimport script from \"./Cell.vue?vue&type=script&lang=ts\"\nexport * from \"./Cell.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Cell.vue?vue&type=style&index=0&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"container\",staticClass:\"logger\"},[_c('table',{staticClass:\"table table-sm table-striped\"},[_c('tbody',_vm._l((_vm.messages),function(record){return _c('tr',{class:_vm.rowClass(record)},[_c('td',[_vm._v(_vm._s(_vm.ts(record)))]),_vm._v(\" \"),_c('td',[_vm._v(_vm._s(record.message))])])}))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { takeRight } from 'lodash'\nimport { LogLevel } from '../logger'\n\nimport * as moment from 'moment'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: ['logger'],\n  computed: {\n    messages() {\n      return takeRight(this.logger.messages, 5)\n    }\n  },\n  methods: {\n    ts(record) {\n      return moment(record.ts).format(\"hh:mm:ss\")\n    },\n    rowClass(record) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'table-secondary'\n        case LogLevel.INFO:\n          return 'table-info'\n        case LogLevel.WARNING:\n          return 'table-warning'\n        case LogLevel.DANGER:\n          return 'table-danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=5cb338a5\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"scene\"},[_c('div',{staticClass:\"row\"},[_c('div',{staticClass:\"col mr-0\"},[_c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})]),_vm._v(\" \"),_c('div',{staticClass:\"col pl-0\"},[_c('div',{staticClass:\"fps mb-2 \"},[_vm._v(\"FPS \"+_vm._s(_vm.fps))]),_vm._v(\" \"),_vm._l((_vm.level.creatures),function(creature){return _c('dl',{key:creature.id,staticClass:\"row small\"},[_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          ID\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n          \"+_vm._s(creature.id)+\"\\n        \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          POS\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n          \"+_vm._s(creature.pos)+\"\\n        \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          健康\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n          \"+_vm._s(creature.health)+\"\\n        \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          Initiation\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n          \"+_vm._s(creature.initiativity())+\"\\n        \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          AI\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_vm._v(\"\\n          \"+_vm._s(_vm.aiName(creature.ai))+\"\\n        \")]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          服\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_c('table',_vm._l((creature.inventory.wears()),function(wearing,i){return _c('tr',{key:\"bodyPart\" + i},[_c('td',[_vm._v(\"\\n                \"+_vm._s(_vm.displayBodyPart(wearing.bodyPart))+\"\\n              \")]),_vm._v(\" \"),_c('td',[_vm._v(\"\\n                \"+_vm._s(_vm.displayItem(wearing.equipment))+\"\\n              \")])])}))]),_vm._v(\" \"),_c('dd',{staticClass:\"col-sm-4\"},[_vm._v(\"\\n          鞄\\n        \")]),_vm._v(\" \"),_c('dt',{staticClass:\"col-sm-8\"},[_c('ul',_vm._l((creature.inventory.cares()),function(item){return _c('li',{key:item.id},[_vm._v(\"\\n                \"+_vm._s(_vm.displayItem(item))+\"\\n            \")])}))])])}),_vm._v(\" \"),_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-2\"},[_vm._v(\"Map\")]),_vm._v(\" \"),_c('div',{staticClass:\"col-sm-10\"},[_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.interval),expression:\"interval\"}],staticClass:\"form-control\",attrs:{\"id\":\"interval\",\"type\":\"number\"},domProps:{\"value\":(_vm.interval)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.interval=$event.target.value}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"interval\"}},[_vm._v(\"\\n              Tick interval\\n            \")])]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-secondary\",on:{\"click\":function($event){_vm.nextStep = true}}},[_vm._v(\"\\n            Next step\\n          \")]),_vm._v(\" \"),_c('button',{staticClass:\"btn btn-secondary\",on:{\"click\":function($event){_vm.pause = !_vm.pause}}},[_vm._v(\"\\n            \"+_vm._s(_vm.pause ? 'Start' : 'Pause')+\"\\n          \")])])])],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.w)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('幅').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Tile } from '../../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemId,\n  ItemGroup,\n  ItemKind,\n\n  Katana,\n  Corpse,\n} from '../items'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nclass DisplayTile extends Tile {\n  public lighted(degree: number): Tile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: Tile, degree: number): Tile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: Tile, degree: number): Tile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('戸')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('・')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('＃')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst KATANA = new ItemTile('刀', 200, 200, 200)\nconst CORPSE = new ItemTile('体', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.kind) {\n    case ItemKind.Katana:\n      return KATANA\n    case ItemKind.Corpse:\n      return CORPSE\n    default:\n      throw `Unknow item ${item} with type ${item.kind}`\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  DoorTile,\n  FloorTile,\n  ItemTile,\n  WallTile,\n\n  displayItem,\n} from './scene_tiles'\n\nimport {\n  Patrol,\n  Explorer,\n  Waiter,\n  Chaser,\n  Escaper,\n  Loiter,\n  Dispatcher,\n  Picker,\n} from '../ai'\n\nimport {\n  Katana,\n  ItemKind,\n} from '../items'\n\nimport { BodyPart } from '../inventory'\n\nconst HUMAN  = new CreatureTile('俺', 0, 255, 0)\nconst HUMAN2 = new CreatureTile('俺', 255, 0, 0)\nconst HUMAN3 = new CreatureTile('俺', 0, 0, 255)\nconst HUMAN4 = new CreatureTile('俺', 255, 0, 255)\nconst HUMAN5 = new CreatureTile('俺', 0, 255, 255)\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst NULLTILE = new Tile('　', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('｜', 200, 200, 200),\n  new ItemTile('／', 200, 200, 200),\n  new ItemTile('ー', 200, 200, 200),\n  new ItemTile('＼', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level'],\n  data() {\n    return {\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      fps: 0,\n      counter: 0,\n      interval: 100,\n      nextStep: false,\n      step: 0,\n      pause: false,\n      player: this.level.creatures[0]\n    }\n  },\n  methods: {\n    aiName(ai) {\n      if (ai instanceof Patrol) {\n        return 'Patrol'\n      }\n      if (ai instanceof Escaper) {\n        return 'Escaper'\n      }\n      if (ai instanceof Chaser) {\n        return 'Chaser'\n      }\n      if (ai instanceof Explorer) {\n        return 'Explorer'\n      }\n      if (ai instanceof Waiter) {\n        return 'Waiter'\n      }\n      if (ai instanceof Loiter) {\n        return `Loiter (${this.aiName(ai.prevAI)})`\n      }\n      if (ai instanceof Dispatcher) {\n        return `Dispatcher (${this.aiName(ai.prevAI)})`\n      }\n      if (ai instanceof Picker) {\n        return 'Picker'\n      }\n    },\n    getTile(x, y) {\n      const tile = this.stage.at(x, y).tile\n      if (!tile) {\n        return NULLTILE\n      }\n\n      if (tile.creature) {\n        switch (tile.creature.id % 5) {\n          case 0:\n            return HUMAN5\n          case 1:\n            return HUMAN4\n          case 2:\n            return HUMAN3\n          case 3:\n            return HUMAN2\n          case 4:\n            return HUMAN\n        }\n      }\n\n      if (tile.items.length) {\n        if (tile.items.length === 1) {\n          return displayItem(tile.items[0])\n        }\n\n        const frame = this.step % (this.animationFps * 3 + 4)\n        if (frame < nextItemAnimation.length) {\n          return nextItemAnimation[frame]\n        } else {\n          const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n          return displayItem(tile.items[itemId % tile.items.length])\n        }\n      }\n\n      switch (tile.display) {\n      case '#':\n        return WALL\n      case '+':\n        return DOOR\n      case ' ':\n        return FLOOR\n      default:\n        return NULLTILE\n      }\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        this.level.width,\n        this.level.height,\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x, y) => this.getTile(x, y),\n        this.level.width,\n        this.level.height\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      if (this.done) { return }\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.fps = this.counter\n        this.counter = 0\n        this.ts = ts\n      }\n\n      this.done = true\n      if (!this.pause || this.nextStep) {\n        this.nextStep = false\n\n        this.level.turn()\n        this.player = this.level.creatures[0]\n      }\n\n      // this.eng.update(this.player.x, this.player.y);\n      this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.done = false\n      this.counter += 1\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n    displayItem(item) {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    displayBodyPart(bodyPart) {\n      switch (bodyPart) {\n        case BodyPart.LeftHand:\n          return '手'\n        case BodyPart.RightHand:\n          return '手'\n        case BodyPart.Legs:\n          return '足'\n        case BodyPart.Finger:\n          return '指'\n        case BodyPart.Head:\n          return '頭'\n        case BodyPart.Eye:\n          return '目'\n        case BodyPart.Neck:\n          return '首'\n        case BodyPart.Back:\n          return '背'\n        case BodyPart.Body:\n          return '体'\n        default:\n          throw `Unknow body part ${bodyPart}`\n      }\n    }\n  },\n  computed: {\n    stage() {\n      return this.player.stageMemory(this.level.id)\n    },\n    animationFps() {\n      return 1000 / this.interval\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    level() {\n      this.initViewport()\n    },\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=1d08ad7a\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { LevelMap, Tile, TileTypes } from '../map'\n\nexport const addDoors = function (\n  level: LevelMap,\n  addDoor: () => boolean = () => true,\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n\n    for (let i = 1; i < level.width; i++) {\n      const\n        tile  = level.at(i, j),\n        up    = level.at(i, j - 1),\n        down  = level.at(i, j + 1),\n        left  = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (left.key === 'D' || right.key === 'D' || up.key === 'D' || down.key === 'D') {\n        continue\n      }\n\n      if (left.key !== 'R' && right.key !== 'R' && up.key !== 'R' && down.key !== 'R') {\n        continue\n      }\n\n      if ((left.key === 'W' && right.key === 'W') || (up.key === 'W' && down.key === 'W')) {\n        level.setTile(i, j, Tile.retrive('D'))\n      }\n    }\n  }\n\n  return level\n}\n","import { Rect, Point, rand, min, max, twoDimArray } from '../utils'\n\nimport { LevelMap, Tile, TileTypes } from '../map'\n\nconst THICKNESS = 0\n\nconst newRoomSpace = function(): Tile {\n  return Tile.retrive('R')\n}\n\nconst newCoridor = function(): Tile {\n  return Tile.retrive('C')\n}\n\nconst newWall = function(): Tile {\n  return Tile.retrive('W')\n}\n\ntype Stage = Tile[][]\n\nconst generate = function (\n  dimX: number,\n  dimY: number,\n  minSize: number = 5,\n  maxSize: number = 5,\n  roomsCount: number = 3,\n): LevelMap {\n  const dungeon = new DungeonGenerator(\n    dimX,\n    dimY,\n    minSize,\n    maxSize,\n    roomsCount,\n  )\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n\n  for ( let i = 0; i < dungeon.rooms.length; i++ )\n    dungeon.rooms[ i ].add( stage )\n\n  for ( let i = 0; i < dungeon.roads.length; i++ )\n    dungeon.roads[ i ].add( stage )\n\n  return new LevelMap(stage)\n}\n\nclass Room extends Rect {\n  notCross( rect: Rect ): boolean {\n    return ( rect.x - THICKNESS > this.x + this.w ) ||\n      ( rect.y - THICKNESS > this.y + this.h ) ||\n      ( rect.x + rect.w < this.x - THICKNESS ) ||\n      ( rect.y + rect.h < this.y - THICKNESS )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand( this.w - 1 ),\n      this.y + 1 + rand( this.h - 1 )\n    )\n  }\n\n  add( stage: Stage ): void {\n    let i: number = 0\n    while ( i < this.w ) {\n      let j: number = 0\n      while ( j < this.h ) {\n        stage[ this.x + i ][ this.y + j ] = newRoomSpace()\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road extends Rect {\n  lined: boolean\n\n  constructor( x: number, y: number, w: number, h: number ) {\n    super( x, y, w, h )\n    this.lined = ( ( x >= w ) && ( y >= h ) ) || ( w >= x ) && ( h >= y )\n  }\n\n  add( stage: Stage ): void {\n    let [ hx, hy, w ] = this.horizontalLine()\n\n    let i = 0\n    while ( i < w ) {\n      if (stage[ hx + i ][ hy ].key === 'W') {\n        stage[ hx + i ][ hy ] = newCoridor()\n      }\n      i += 1\n    }\n\n    let [ vx, vy, h ] = this.verticallLine()\n    let j = 0\n    while ( j < h ) {\n      if (stage[ vx ][ vy + j ].key === 'W') {\n        stage[ vx ][ vy + j ] = newCoridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [ number, number, number ] {\n    // x\n    // |\\\n    // .-x\n    if ( this.lined )\n      return [ Math.min( this.x, this.w ), Math.max( this.y, this.h ), Math.abs( this.w - this.x ) ]\n    // .-x\n    // |/\n    // x\n    else\n      return [ Math.min( this.x, this.w ), Math.min( this.y, this.h ), Math.abs( this.w - this.x ) ]\n  }\n\n  verticallLine(): [ number, number, number ] {\n    // x\n    // |\\\n    // .-x\n    if ( this.lined )\n      return [ Math.min( this.x, this.w ), Math.min( this.y, this.h ), Math.abs( this.h - this.y ) ]\n    // .-x\n    // |/\n    // x\n    else\n      return [ Math.min( this.x, this.w ), Math.min( this.y, this.h ), Math.abs( this.h - this.y ) ]\n  }\n}\n\nclass DungeonGenerator {\n  rooms: Array< Room >\n  roads: Array< Road >\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number,\n  ) {\n    let rooms: Array< Room > = []\n\n    let i = 0\n    while ( i < this.roomsCount ) {\n      rooms.push( this.generateRoom() )\n      i += 1\n    }\n\n    this.rooms = this.normalize( this.fuzzifyRooms( rooms ) )\n    this.roads = this.buildRoads( this.rooms )\n  }\n\n  private generateRoom(): Room {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize),\n    )\n  }\n\n  private fuzzifyRooms( rooms: Array< Room > ): Array< Room > {\n    let pickedRooms: Array< Room > = [ rooms.shift() ]\n\n    while ( rooms.length ) {\n      let currentRoom: Room = rooms.shift()\n\n      let angle: number = rand( 360 ) / 180 * Math.PI\n\n      // TODO: Build table with these values.\n      const cos: number = Math.cos( angle )\n      const sin: number = Math.sin( angle )\n      let l: number = 0\n      let dx: number = 0\n      let dy: number = 0\n\n      while ( !pickedRooms.every( ( room ) => currentRoom.notCross( room ) )) {\n        let ndx = Math.round( l * cos )\n        let ndy = Math.round( l * sin )\n\n        while ( true ) {\n          l += 1\n          ndx = Math.round( l * cos )\n          ndy = Math.round( l * sin )\n\n          if ( ndx !== dx || ndy !== dy ) {\n            break\n          }\n        }\n\n        currentRoom.move( ndx - dx, ndy - dy )\n        dx = ndx\n        dy = ndy\n      }\n\n      pickedRooms.push( currentRoom )\n    }\n\n    return pickedRooms\n  }\n\n  private normalize( rooms: Array< Room > ): Array< Room > {\n    const minX = min( rooms.map( ( room ) => room.x ) ) - 1\n    const minY = min( rooms.map( ( room ) => room.y ) ) - 1\n    rooms.forEach( ( room ) => { room.move( - minX, - minY ) } )\n\n    return rooms.filter( ( room: Room ) => {\n      return ( room.x + room.w < this.maxX ) && ( room.y + room.h < this.maxY )\n    })\n  }\n\n  private buildRoads( rooms: Array< Room > ): Array< Road > {\n    let points: Array< Point > = rooms.map( ( room ) => { return room.pointWithin() } )\n\n    let connectedPoints: Array< Point > = [ points.shift() ]\n    let roads: Array< Road > = []\n\n    const distance = function( point1: Point, point2: Point ): number {\n      // No need to calc square root since it's being used for comparison only.\n      return ( point1.x - point2.x ) ** 2 + ( point1.y - point2.y ) ** 2\n    }\n\n    while ( points.length ) {\n      let currentPoint = points.shift()\n\n      let pointToConnect = connectedPoints[ 0 ]\n      let minDistance = distance( currentPoint, pointToConnect )\n\n      connectedPoints.forEach( ( point ) => {\n        const currentDistance = distance( point, currentPoint )\n        if ( currentDistance < minDistance ) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push( currentPoint )\n\n      roads.push( new Road(\n        currentPoint.x,\n        currentPoint.y,\n        pointToConnect.x,\n        pointToConnect.y\n      ))\n    }\n\n    return roads\n  }\n}\n\nexport { generate }\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--13-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=7c18dcf5\"\nimport script from \"./App.vue?vue&type=script&lang=ts\"\nexport * from \"./App.vue?vue&type=script&lang=ts\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\",attrs:{\"id\":\"app\"}},[(_vm.map.creatures.length)?_c('Scene',{attrs:{\"level\":_vm.map}}):_vm._e(),_vm._v(\" \"),_c('Logger',{attrs:{\"logger\":_vm.map.logger}}),_vm._v(\" \"),_c('div',{staticClass:\"mb-5\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.formula),expression:\"formula\"}],attrs:{\"type\":\"text\",\"placeholder\":\"formula\"},domProps:{\"value\":(_vm.formula)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.formula=$event.target.value}}}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.minVal),expression:\"minVal\"}],attrs:{\"type\":\"number\",\"placeholder\":\"min\"},domProps:{\"value\":(_vm.minVal)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.minVal=$event.target.value}}}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.maxVal),expression:\"maxVal\"}],attrs:{\"type\":\"number\",\"placeholder\":\"max\"},domProps:{\"value\":(_vm.maxVal)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.maxVal=$event.target.value}}}),_vm._v(\" \"),_c('table',[_c('tr',[_c('th',[_vm._v(\"D\\\\A\")]),_vm._v(\" \"),_vm._l((_vm.values),function(value){return _c('th',{key:value},[_vm._v(_vm._s(value))])})],2),_vm._v(\" \"),_vm._l((_vm.values),function(d){return _c('tr',{key:d},[_c('th',[_vm._v(_vm._s(d))]),_vm._v(\" \"),_vm._l((_vm.values),function(a){return _c('td',{key:a,staticStyle:{\"border\":\"1px solid black\"}},[_vm._v(\"\\n          \"+_vm._s(_vm.calc(a, d))+\"\\n        \")])})],2)})],2)]),_vm._v(\" \"),_c('div',{},[_c('div',{},[_c('div',{staticClass:\"form-group row\"},[_c('label',{staticClass:\"col-sm-2 col-form-label\",attrs:{\"for\":\"radius\"}},[_vm._v(\"\\n          Radius\\n        \")]),_vm._v(\" \"),_c('div',{staticClass:\"col-sm-10\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.radius),expression:\"radius\"}],staticClass:\"form-control\",attrs:{\"id\":\"radius\",\"type\":\"number\"},domProps:{\"value\":(_vm.radius)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.radius=$event.target.value}}})])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-2\"},[_vm._v(\"\\n          Map\\n        \")]),_vm._v(\" \"),_c('div',{staticClass:\"col-sm-10\"},[_c('div',{staticClass:\"form-check\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.addDoors),expression:\"generatorOptions.addDoors\"}],staticClass:\"form-check-input\",attrs:{\"id\":\"doors\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.generatorOptions.addDoors)?_vm._i(_vm.generatorOptions.addDoors,null)>-1:(_vm.generatorOptions.addDoors)},on:{\"change\":function($event){var $$a=_vm.generatorOptions.addDoors,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.$set(_vm.generatorOptions, \"addDoors\", $$a.concat([$$v])))}else{$$i>-1&&(_vm.$set(_vm.generatorOptions, \"addDoors\", $$a.slice(0,$$i).concat($$a.slice($$i+1))))}}else{_vm.$set(_vm.generatorOptions, \"addDoors\", $$c)}}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"doors\"}},[_vm._v(\"\\n              Add doors\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.roomsCount),expression:\"generatorOptions.roomsCount\"}],staticClass:\"form-control\",attrs:{\"id\":\"roomsCount\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.roomsCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"roomsCount\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"roomsCount\"}},[_vm._v(\"\\n              roomsCount\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.minSize),expression:\"generatorOptions.minSize\"}],staticClass:\"form-control\",attrs:{\"id\":\"minSize\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.minSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"minSize\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"minSize\"}},[_vm._v(\"\\n              minSize\\n            \")])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.generatorOptions.maxSize),expression:\"generatorOptions.maxSize\"}],staticClass:\"form-control\",attrs:{\"id\":\"maxSize\",\"type\":\"number\"},domProps:{\"value\":(_vm.generatorOptions.maxSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.generatorOptions, \"maxSize\", $event.target.value)}}}),_vm._v(\" \"),_c('label',{staticClass:\"form-check-label\",attrs:{\"for\":\"maxSize\"}},[_vm._v(\"\\n              maxSize\\n            \")])])])]),_vm._v(\" \"),_c('div',{staticClass:\"form-group row\"},[_c('div',{staticClass:\"col-sm-10\"},[_c('button',{staticClass:\"btn btn-primary\",on:{\"click\":function($event){_vm.generateMap()}}},[_vm._v(\"\\n            Rebuild!\\n          \")])])])])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './components/App.vue'\n\nimport './application.css'\n\nimport 'bootstrap/dist/css/bootstrap.css';\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport * as _ from 'lodash'\n\nimport Cell from './Cell.vue'\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\n\nimport { LevelMap } from '../map'\nimport { Phantom, Creature } from '../creature'\nimport { Memory, MemoryTile } from '../creature'\nimport { generate } from '../generator/dungeon'\nimport { addDoors } from '../generator/post'\n\nimport { Katana, Corpse } from '../items'\n\nimport { Escaper, Chaser, Waiter, Explorer, Dispatcher } from '../ai'\n\nexport default Vue.extend({\n  data() {\n    return {\n      map: new LevelMap([[]]),\n      radius: 10,\n      ts: Date.now(),\n      generatorOptions: {\n        addDoors: false,\n        minSize: 5,\n        maxSize: 5,\n        roomsCount: 3,\n      },\n      minVal: 1,\n      maxVal: 10,\n      formula: 'Math.floor(10 * a / d)'\n    }\n  },\n  computed: {\n    values() {\n      let array = []\n      for (let i = this.minVal; i <= this.maxVal; i ++ ) {\n        array.push(i)\n\n      }\n\n      return array\n\n    }\n  },\n  components: {\n    Cell,\n    Logger,\n    Scene,\n  },\n  methods: {\n    calc(a, d) {\n      try {\n        return eval(this.formula)\n      } catch(e) {\n        return 'E'\n      }\n    },\n    generateMap() {\n      this.map = this.buildMap()\n      let x = 1,\n          y = 1\n\n      while (!this.map.visibleThrough(x, y)) {\n        if (x < this.map.width - 1) {\n          x += 1\n        } else {\n          x = 1\n          y += 1\n        }\n      }\n\n      const creature1 = new Creature(\n        x,\n        y,\n        50,\n        this.radius,\n        10,\n        new Dispatcher(),\n      )\n\n      creature1.addToMap(this.map)\n      creature1.wear(new Katana())\n\n      x = this.map.width - 1\n      y = this.map.height -1\n\n      while (!this.map.visibleThrough(x, y)) {\n        if (x > 1) {\n          x -= 1\n        } else {\n          x = this.map.width - 1\n          y -= 1\n        }\n      }\n\n      const creature2 = new Creature(\n        x,\n        y,\n        100,\n        this.radius,\n        5,\n        new Dispatcher(),\n      )\n\n      creature2.addToMap(this.map)\n      creature2.wear(new Katana())\n    },\n    buildMap() {\n      let map = generate(\n        50,\n        50,\n        this.generatorOptions.minSize,\n        this.generatorOptions.maxSize,\n        this.generatorOptions.roomsCount,\n      )\n\n      if (this.generatorOptions.addDoors) {\n        return addDoors(map)\n      }\n\n      return map\n    }\n  },\n  created() {\n    this.generateMap()\n  }\n})\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&lang=scss\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&lang=scss\"","var map = {\n\t\"./af\": 146,\n\t\"./af.js\": 146,\n\t\"./ar\": 145,\n\t\"./ar-dz\": 144,\n\t\"./ar-dz.js\": 144,\n\t\"./ar-kw\": 143,\n\t\"./ar-kw.js\": 143,\n\t\"./ar-ly\": 142,\n\t\"./ar-ly.js\": 142,\n\t\"./ar-ma\": 141,\n\t\"./ar-ma.js\": 141,\n\t\"./ar-sa\": 140,\n\t\"./ar-sa.js\": 140,\n\t\"./ar-tn\": 139,\n\t\"./ar-tn.js\": 139,\n\t\"./ar.js\": 145,\n\t\"./az\": 138,\n\t\"./az.js\": 138,\n\t\"./be\": 137,\n\t\"./be.js\": 137,\n\t\"./bg\": 136,\n\t\"./bg.js\": 136,\n\t\"./bm\": 135,\n\t\"./bm.js\": 135,\n\t\"./bn\": 134,\n\t\"./bn.js\": 134,\n\t\"./bo\": 133,\n\t\"./bo.js\": 133,\n\t\"./br\": 132,\n\t\"./br.js\": 132,\n\t\"./bs\": 131,\n\t\"./bs.js\": 131,\n\t\"./ca\": 130,\n\t\"./ca.js\": 130,\n\t\"./cs\": 129,\n\t\"./cs.js\": 129,\n\t\"./cv\": 128,\n\t\"./cv.js\": 128,\n\t\"./cy\": 127,\n\t\"./cy.js\": 127,\n\t\"./da\": 126,\n\t\"./da.js\": 126,\n\t\"./de\": 125,\n\t\"./de-at\": 124,\n\t\"./de-at.js\": 124,\n\t\"./de-ch\": 123,\n\t\"./de-ch.js\": 123,\n\t\"./de.js\": 125,\n\t\"./dv\": 122,\n\t\"./dv.js\": 122,\n\t\"./el\": 121,\n\t\"./el.js\": 121,\n\t\"./en-au\": 120,\n\t\"./en-au.js\": 120,\n\t\"./en-ca\": 119,\n\t\"./en-ca.js\": 119,\n\t\"./en-gb\": 118,\n\t\"./en-gb.js\": 118,\n\t\"./en-ie\": 117,\n\t\"./en-ie.js\": 117,\n\t\"./en-il\": 116,\n\t\"./en-il.js\": 116,\n\t\"./en-nz\": 115,\n\t\"./en-nz.js\": 115,\n\t\"./eo\": 114,\n\t\"./eo.js\": 114,\n\t\"./es\": 113,\n\t\"./es-do\": 112,\n\t\"./es-do.js\": 112,\n\t\"./es-us\": 111,\n\t\"./es-us.js\": 111,\n\t\"./es.js\": 113,\n\t\"./et\": 110,\n\t\"./et.js\": 110,\n\t\"./eu\": 109,\n\t\"./eu.js\": 109,\n\t\"./fa\": 108,\n\t\"./fa.js\": 108,\n\t\"./fi\": 107,\n\t\"./fi.js\": 107,\n\t\"./fo\": 106,\n\t\"./fo.js\": 106,\n\t\"./fr\": 105,\n\t\"./fr-ca\": 104,\n\t\"./fr-ca.js\": 104,\n\t\"./fr-ch\": 103,\n\t\"./fr-ch.js\": 103,\n\t\"./fr.js\": 105,\n\t\"./fy\": 102,\n\t\"./fy.js\": 102,\n\t\"./gd\": 101,\n\t\"./gd.js\": 101,\n\t\"./gl\": 100,\n\t\"./gl.js\": 100,\n\t\"./gom-latn\": 99,\n\t\"./gom-latn.js\": 99,\n\t\"./gu\": 98,\n\t\"./gu.js\": 98,\n\t\"./he\": 97,\n\t\"./he.js\": 97,\n\t\"./hi\": 96,\n\t\"./hi.js\": 96,\n\t\"./hr\": 95,\n\t\"./hr.js\": 95,\n\t\"./hu\": 94,\n\t\"./hu.js\": 94,\n\t\"./hy-am\": 93,\n\t\"./hy-am.js\": 93,\n\t\"./id\": 92,\n\t\"./id.js\": 92,\n\t\"./is\": 91,\n\t\"./is.js\": 91,\n\t\"./it\": 90,\n\t\"./it.js\": 90,\n\t\"./ja\": 89,\n\t\"./ja.js\": 89,\n\t\"./jv\": 88,\n\t\"./jv.js\": 88,\n\t\"./ka\": 87,\n\t\"./ka.js\": 87,\n\t\"./kk\": 86,\n\t\"./kk.js\": 86,\n\t\"./km\": 85,\n\t\"./km.js\": 85,\n\t\"./kn\": 84,\n\t\"./kn.js\": 84,\n\t\"./ko\": 83,\n\t\"./ko.js\": 83,\n\t\"./ky\": 82,\n\t\"./ky.js\": 82,\n\t\"./lb\": 81,\n\t\"./lb.js\": 81,\n\t\"./lo\": 80,\n\t\"./lo.js\": 80,\n\t\"./lt\": 79,\n\t\"./lt.js\": 79,\n\t\"./lv\": 78,\n\t\"./lv.js\": 78,\n\t\"./me\": 77,\n\t\"./me.js\": 77,\n\t\"./mi\": 76,\n\t\"./mi.js\": 76,\n\t\"./mk\": 75,\n\t\"./mk.js\": 75,\n\t\"./ml\": 74,\n\t\"./ml.js\": 74,\n\t\"./mn\": 73,\n\t\"./mn.js\": 73,\n\t\"./mr\": 72,\n\t\"./mr.js\": 72,\n\t\"./ms\": 71,\n\t\"./ms-my\": 70,\n\t\"./ms-my.js\": 70,\n\t\"./ms.js\": 71,\n\t\"./mt\": 69,\n\t\"./mt.js\": 69,\n\t\"./my\": 68,\n\t\"./my.js\": 68,\n\t\"./nb\": 67,\n\t\"./nb.js\": 67,\n\t\"./ne\": 66,\n\t\"./ne.js\": 66,\n\t\"./nl\": 65,\n\t\"./nl-be\": 64,\n\t\"./nl-be.js\": 64,\n\t\"./nl.js\": 65,\n\t\"./nn\": 63,\n\t\"./nn.js\": 63,\n\t\"./pa-in\": 62,\n\t\"./pa-in.js\": 62,\n\t\"./pl\": 61,\n\t\"./pl.js\": 61,\n\t\"./pt\": 60,\n\t\"./pt-br\": 59,\n\t\"./pt-br.js\": 59,\n\t\"./pt.js\": 60,\n\t\"./ro\": 58,\n\t\"./ro.js\": 58,\n\t\"./ru\": 57,\n\t\"./ru.js\": 57,\n\t\"./sd\": 56,\n\t\"./sd.js\": 56,\n\t\"./se\": 55,\n\t\"./se.js\": 55,\n\t\"./si\": 54,\n\t\"./si.js\": 54,\n\t\"./sk\": 53,\n\t\"./sk.js\": 53,\n\t\"./sl\": 52,\n\t\"./sl.js\": 52,\n\t\"./sq\": 51,\n\t\"./sq.js\": 51,\n\t\"./sr\": 50,\n\t\"./sr-cyrl\": 49,\n\t\"./sr-cyrl.js\": 49,\n\t\"./sr.js\": 50,\n\t\"./ss\": 48,\n\t\"./ss.js\": 48,\n\t\"./sv\": 47,\n\t\"./sv.js\": 47,\n\t\"./sw\": 46,\n\t\"./sw.js\": 46,\n\t\"./ta\": 45,\n\t\"./ta.js\": 45,\n\t\"./te\": 44,\n\t\"./te.js\": 44,\n\t\"./tet\": 43,\n\t\"./tet.js\": 43,\n\t\"./tg\": 42,\n\t\"./tg.js\": 42,\n\t\"./th\": 41,\n\t\"./th.js\": 41,\n\t\"./tl-ph\": 40,\n\t\"./tl-ph.js\": 40,\n\t\"./tlh\": 39,\n\t\"./tlh.js\": 39,\n\t\"./tr\": 38,\n\t\"./tr.js\": 38,\n\t\"./tzl\": 37,\n\t\"./tzl.js\": 37,\n\t\"./tzm\": 36,\n\t\"./tzm-latn\": 35,\n\t\"./tzm-latn.js\": 35,\n\t\"./tzm.js\": 36,\n\t\"./ug-cn\": 34,\n\t\"./ug-cn.js\": 34,\n\t\"./uk\": 33,\n\t\"./uk.js\": 33,\n\t\"./ur\": 32,\n\t\"./ur.js\": 32,\n\t\"./uz\": 31,\n\t\"./uz-latn\": 30,\n\t\"./uz-latn.js\": 30,\n\t\"./uz.js\": 31,\n\t\"./vi\": 29,\n\t\"./vi.js\": 29,\n\t\"./x-pseudo\": 28,\n\t\"./x-pseudo.js\": 28,\n\t\"./yo\": 27,\n\t\"./yo.js\": 27,\n\t\"./zh-cn\": 26,\n\t\"./zh-cn.js\": 26,\n\t\"./zh-hk\": 25,\n\t\"./zh-hk.js\": 25,\n\t\"./zh-tw\": 24,\n\t\"./zh-tw.js\": 24\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 177;","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css\"","import { Item, Equipment } from './items'\n\nimport { remove } from 'lodash'\n\nexport enum BodyPart {\n  LeftHand,\n  RightHand,\n  Legs,\n  Finger,\n  Head,\n  Eye,\n  Neck,\n  Back,\n  Body,\n}\n\ntype Wearing = {\n  bodyPart: BodyPart\n  equipment?: Equipment\n}\n\nexport class Inventory {\n  private wearings: Wearing[] = []\n  private bag: Item[] = []\n\n  constructor(parts: BodyPart[]) {\n    this.wearings = parts.map(bodyPart => { return { bodyPart: bodyPart } })\n  }\n\n  public wears(): Wearing[] {\n    return this.wearings\n  }\n\n  public cares(): Item[] {\n    return this.bag\n  }\n\n  public equip(item: Equipment) {\n    this.wearings.forEach(wearing => {\n      if (wearing.bodyPart === item.bodyPart()) {\n        if (wearing.equipment) {\n          this.putToBag(wearing.equipment)\n        }\n\n        return wearing.equipment = item\n      }\n    })\n  }\n\n  public takeOff(item: Equipment) {\n    this.wearings.forEach(wearing => {\n      if (wearing.equipment && wearing.equipment.id === item.id) {\n        this.putToBag(wearing.equipment)\n        return wearing.equipment = null\n      }\n    })\n  }\n\n  public putToBag(item: Item) {\n    this.bag.push(item)\n  }\n\n  public removeFromBag(item: Item) {\n    remove(this.bag, inventoryItem => inventoryItem.id === item.id)\n  }\n}\n","import { Point, twoDimArray } from '../utils'\nimport { Creature, MemoryTile } from '../creature'\n\nimport { sample } from 'lodash'\n\nconst FIRST_STEP: number = 1\n\nexport abstract class AI {\n  constructor(public prevAI?: AI) {\n  }\n\n  public abstract act(actor: Creature, firstTurn: boolean): void\n\n  public abstract available(actor: Creature): boolean\n\n  protected moveTo(actor: Creature, destination: Point): boolean {\n    const path = this.leePath(\n      actor,\n      point => destination.eq(point),\n    )\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected followTo(actor: Creature, destination: Point): boolean {\n    const path = this.leePath(\n      actor,\n      point => destination.nextTo(point),\n    )\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected leePath(\n    actor: Creature,\n    destination: (point: Point, tile: MemoryTile) => boolean,\n    randomDestination: boolean = false,\n  ): Point[] {\n    const map = actor.stageMemory()\n\n    let stageMemory: number[][] = twoDimArray(map.height, map.width, () => undefined)\n    let pointsToVisit: Point[] = []\n    let pointsToCheck: Point[] = [actor.pos]\n\n    let step = 0\n    while ( pointsToCheck.length && !pointsToVisit.length ) {\n      let wavePoints: Array< Point > = []\n\n      pointsToCheck.forEach( ( point: Point ) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x ,  point.y)\n        // TODO: Compare, current value might be lower\n        if (tile.tangible(actor) ||\n            stageMemory[ point.x ][ point.y ] !== undefined ) {\n          return\n        }\n\n        stageMemory[ point.x ][ point.y ] = step\n        if (destination(point, tile)) {\n          pointsToVisit.push( point )\n        } else {\n          point.wrappers().forEach(dist => wavePoints.push(dist))\n        }\n      })\n      step++\n\n      pointsToCheck = wavePoints\n    }\n\n    if (pointsToVisit.length) {\n      if (randomDestination) {\n        return this.buildRoad(sample(pointsToVisit), stageMemory)\n      } else {\n        return this.buildRoad(pointsToVisit[0], stageMemory)\n      }\n    } else {\n      return []\n    }\n  }\n\n  private buildRoad(point: Point, stageMemory: number[][]): Point[] {\n    let lastPoint = point\n    let chain = [lastPoint]\n\n    let delta: Point = undefined\n\n    while ( stageMemory[ lastPoint.x ][ lastPoint.y ] !== FIRST_STEP ) {\n      delta = Point.dxy.find( ( dp ): boolean => {\n        return stageMemory[ lastPoint.x + dp.x ] &&\n          ( stageMemory[ lastPoint.x + dp.x ][ lastPoint.y + dp.y ] === stageMemory[ lastPoint.x ][ lastPoint.y ] - 1 )\n      })\n\n      if (!delta) {\n        return []\n      }\n\n      lastPoint = lastPoint.add(delta)\n\n      chain.unshift(lastPoint)\n    }\n\n    return chain\n  }\n\n  protected withinView(\n    actor: Creature,\n    visit: (point: Point, tile: MemoryTile) => void,\n  ): void {\n    const map = actor.stageMemory()\n\n    let tileVisited: boolean[][] = twoDimArray(map.height, map.width, () => false)\n    let pointsToCheck: Point[] = [actor.pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Array< Point > = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x ,  point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Phantom, Creature, Event, EventType, Reaction } from '../creature'\nimport { Point } from '../utils'\n\nexport class Attacker extends AI {\n  private victim?: Creature\n\n  public available(actor: Creature): boolean {\n    return this.canAttack(actor)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.victimSet() && this.victimInAccess(actor)) {\n      this.attack(actor)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.findNewVictim(actor)\n      this.act(actor, false)\n    }\n  }\n\n  protected attack(actor: Creature) {\n    if (this.victim.on(actor.emit(EventType.Attack)) === Reaction.DIE) {\n      this.victim = undefined\n    }\n  }\n\n  private canAttack(actor: Creature): boolean {\n    const memory = actor.stageMemory()\n    return actor.pos.wrappers().some(({ x, y }) => memory.at(x, y).creature() !== undefined)\n  }\n\n  private victimInAccess(actor: Creature): boolean {\n    const memory = actor.stageMemory()\n    return actor.pos.wrappers().some(({ x, y }) => memory.at(x, y).creature() && memory.at(x, y).creature().id === this.victim.id)\n  }\n\n  private victimSet(): boolean {\n    return this.victim !== undefined\n  }\n\n  private updateVictimPosition(actor: Creature) {\n    this.findCreature(\n      actor,\n      creature => creature.id === this.victim.id,\n    )\n  }\n\n  private findNewVictim(actor: Creature) {\n    this.findCreature(\n      actor,\n      creature => creature.id !== actor.id\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean,\n  ): boolean {\n    this.withinView(\n      actor,\n      ({ x, y }, tile) => {\n        const creature = tile.creature()\n\n        if (creature && condition(creature)) {\n          this.victim = creature.real()\n          return true\n        }\n      }\n    )\n\n    return false\n  }\n}\n\n","import { AI } from './internal'\nimport { Phantom, Creature, CreatureId } from '../creature'\nimport { Point } from '../utils'\n\nexport class Chaser extends AI {\n  private victimPos?: Point\n  private victimId?: CreatureId\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n\n  public act(actor: Creature): void {\n    if (this.victimSet()) {\n      this.updateVictimPosition(actor)\n      this.chase(actor)\n    } else if (this.foundNewVictim(actor)) {\n      this.chase(actor)\n    } else if (this.victimPos) {\n      if (this.moveTo(actor, this.victimPos) && this.victimPos.eq(actor.pos)) {\n        this.victimPos = undefined\n      }\n    }\n\n    if (this.victimSet() && this.caught(actor)) {\n      this.resetVictim()\n      // TODO: Loit here\n    } else {\n      // TODO: Loit here\n    }\n  }\n\n  private victimSet(): boolean {\n    return this.victimId !== undefined\n  }\n\n  private updateVictimPosition(actor: Creature) {\n    this.findCreature(\n      actor,\n      creature => creature.id === this.victimId,\n    )\n  }\n\n  private chase(actor: Creature): void {\n    this.followTo(actor, this.victimPos)\n  }\n\n  private foundNewVictim(actor: Creature): boolean {\n    return this.findCreature(\n      actor,\n      creature => creature.id !== actor.id\n    )\n  }\n\n  private caught(actor: Creature): boolean {\n    return actor.pos.nextTo(this.victimPos)\n  }\n\n  private resetVictim(): void {\n    this.victimId = undefined\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean,\n  ): boolean {\n    this.withinView(\n      actor,\n      ({ x, y }, tile) => {\n        const creature = tile.creature()\n\n        if (creature && condition(creature)) {\n          this.victimPos = new Point(x, y)\n          this.victimId = creature.id\n          return true\n        }\n      }\n    )\n\n    return false\n  }\n}\n","import {\n  AI,\n  Attacker,\n  Chaser,\n  Escaper,\n  Explorer,\n  Picker,\n} from '../ai'\nimport { Creature } from '../creature'\n\nexport class Dispatcher extends AI {\n  private events: Event[] = []\n\n  private escaper:  Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n\n  constructor() {\n    super()\n    this.escaper  = new Escaper(this)\n    this.explorer = new Explorer(this)\n    this.chaser   = new Chaser(this)\n    this.attacker = new Attacker(this)\n    this.picker   = new Picker(this)\n  }\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    // Never dispatch twice\n    if (!firstTurn) {\n      throw 'Meta AI called recursively'\n    }\n\n    if (this.feelsGood(actor)) {\n      if (this.enemyClose(actor)) {\n        this.attack(actor)\n      } else if (this.seesItems(actor)) {\n        this.pickItem(actor)\n      } else {\n        this.explore(actor)\n      }\n    } else if (this.enemyClose(actor)) {\n      this.runAway(actor)\n    } else {\n      this.rest(actor)\n    }\n\n    this.events = []\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return true /////////////////////\n  }\n\n  private enemyClose(actor: Creature): boolean {\n    return this.escaper.available(actor)\n  }\n\n  private seesItems(actor: Creature): boolean {\n    return this.picker.available(actor)\n  }\n\n  private attack(actor: Creature): void {\n    if (this.attacker.available(actor)) {\n      this.attacker.act(actor)\n    } else {\n      this.chaser.act(actor)\n    }\n  }\n\n  private pickItem(actor: Creature): void {\n    this.picker.act(actor)\n  }\n\n  private explore(actor: Creature): void {\n    this.explorer.act(actor)\n  }\n\n  private runAway(actor: Creature): void {\n    this.escaper.act(actor)\n  }\n\n  private rest(actor: Creature): void {\n  }\n}\n","import { AI } from './internal'\nimport { Loiter } from '../ai'\nimport { Phantom, Creature, CreatureId } from '../creature'\nimport { Point } from '../utils'\n\nimport { sumBy } from 'lodash'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends AI {\n  private escapesFrom: Phantom[] = []\n  private runningTo?: Point\n\n  public available(actor: Creature): boolean {\n    return this.foundEnemies(actor)\n  }\n\n  public act(actor: Creature): void {\n    if (this.foundEnemies(actor)) {\n      this.buildPath(actor)\n    }\n\n    if (this.runningTo) {\n      if (this.moveTo(actor, this.runningTo) && this.runningTo.eq(actor.pos)) {\n        this.runningTo = undefined\n      }\n    } else {\n      actor.ai = new Loiter(this)\n    }\n  }\n\n  private buildPath(\n    actor: Creature,\n    minDistance: number = actor.radius / 2,\n  ): void {\n    if (minDistance <= 1) {\n      this.runningTo = undefined\n      return\n    }\n\n    const path = this.leePath(\n      actor,\n      ({ x, y }) => {\n        const score = sumBy(this.escapesFrom, enemy => {\n          // I don't use pathfinding since it should try\n          // to run away from those who are visible, so the path\n          // to them should be straightforward.\n          return Math.max(Math.abs(x - enemy.pos.x), Math.abs(y - enemy.pos.y))\n        })\n\n        return score >= minDistance\n      },\n      true,\n    )\n\n    if (path.length) {\n      this.runningTo = path.pop()\n    } else {\n      this.buildPath(actor, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(\n    actor: Creature,\n  ): boolean {\n    this.escapesFrom = []\n\n    this.withinView(\n      actor,\n      (point, tile) => {\n        const creature = tile.creature()\n\n        if (creature && creature.id !== actor.id) {\n          this.escapesFrom.push(creature)\n        }\n      }\n    )\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { AI, Patrol, Loiter } from '../ai'\n\nimport { Point, twoDimArray } from '../utils'\nimport { Creature } from '../creature'\n\nconst NEW_POINT_EVERY: number = 10\n\nexport class Explorer extends AI {\n  path: Point[] = []\n  private step: number = NEW_POINT_EVERY\n  public patrol: Patrol\n\n  public available(actor: Creature): boolean {\n    if (this.path.length) {\n      return true\n    } else {\n      this.buildNewPath(actor)\n      return this.path.length > 0\n    }\n  }\n\n  act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.step >= NEW_POINT_EVERY ) {\n      this.updatePatrol( actor )\n    }\n\n    if (this.path.length) {\n      const nextPoint: Point = this.path.shift()\n      if (actor.stageMemory().at(nextPoint.x, nextPoint.y).tangible(actor)) {\n        this.path = []\n        if (firstTurn) {\n          this.act(actor, false)\n        }\n      } else {\n        this.step++\n\n        actor.move(nextPoint)\n\n        if (this.shouldAddNode(actor)) {\n          this.updatePatrol(actor)\n        }\n      }\n    } else {\n      this.buildNewPath(actor)\n      if (this.path.length) {\n        if (firstTurn) {\n          this.act(actor, false)\n        }\n      } else if (this.patrol.available(actor)) {\n        // Logger.info( \"I'm done, time to patrol\" )\n        this.patrol.addNode( actor.pos.x, actor.pos.y )\n        actor.ai = this.patrol\n        actor.ai.act(actor, false)\n      } else {\n        actor.ai = new Loiter(this)\n      }\n    }\n  }\n\n  private buildNewPath( actor: Creature ): void {\n    this.path = this.leePath( actor, point => {\n      return !actor.stageMemory().at(point.x, point.y).seen\n    })\n  }\n\n  private updatePatrol( actor: Creature ): void {\n    if (this.patrol === undefined) {\n      this.patrol = new Patrol( actor.pos.x, actor.pos.y )\n    } else {\n      this.patrol.addNode( actor.pos.x, actor.pos.y )\n    }\n\n    this.step = 0\n  }\n\n  private shouldAddNode(actor: Creature): boolean {\n    return actor.stageMemory().at(actor.previousPos.x, actor.previousPos.y).tile.isDoor()\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Loiter extends AI {\n  private turns: number = 0\n\n  act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.turns > 1) {\n      actor.ai = this.prevAI\n      this.prevAI.act(actor, false)\n      return\n    }\n\n    const path = this.leePath(\n      actor,\n      point => !actor.pos.eq(point),\n      true,\n    )\n\n    if (path.length) {\n      this.turns += 1\n      actor.move(path[0])\n    }\n  }\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, rand, succ } from '../utils'\nimport { Creature } from '../creature'\n\nimport { Loiter } from './loiter'\n\nimport * as graphlib from 'graphlib'\n\ntype NodeID = string\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private step: number\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [ key: string ]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID\n  private path: Point[]\n\n  constructor( x: number, y: number ) {\n    super()\n    this.i = 'a'\n\n    this.step = 0\n    this.graph = new graphlib.Graph()\n\n    this.addNode( x, y, false )\n    this.lastNodeVisit = {}\n\n    this.markNodeVisited( this.currentNodeID )\n    this.path = []\n  }\n\n  public available(actor: Creature): boolean {\n    return this.graph.nodes().length > 1\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if ( this.path.length ) {\n      this.moveToTarget( actor, firstTurn )\n    } else {\n      if ( this.targetNodeID ) {\n        this.markNodeVisited( this.targetNodeID )\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget( actor )\n      this.moveToTarget( actor, firstTurn )\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode( x: number, y: number, withEdge: boolean = true ): void {\n    this.graph.setNode( this.i, new Point(x, y))\n    if ( withEdge ) {\n      this.graph.setEdge( this.currentNodeID, this.i )\n    }\n    this.currentNodeID = this.i\n    this.i = succ( this.i )\n  }\n\n  private buildNewPath( actor: Creature ): void {\n    const pos: Point = this.graph.node( this.targetNodeID )\n\n    this.path = this.leePath(actor, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget( actor: Creature ): void {\n    let seenLastID: NodeID = this.graph.nodes()[0]\n    let seenLastStep: number = this.lastNodeVisit[ seenLastID ]\n\n    this.graph.neighbors( this.currentNodeID ).forEach( ( nodeID: NodeID ) => {\n      if (seenLastStep > (this.lastNodeVisit[ nodeID ] || 0)) {\n        seenLastID = nodeID\n        seenLastStep = this.lastNodeVisit[ seenLastID ]\n      }\n    })\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath( actor )\n  }\n\n  private moveToTarget( actor: Creature, firstTurn: boolean ): void {\n    const nextPoint: Point = this.path.shift()\n\n    if (!nextPoint) {\n      actor.ai = new Loiter(this)\n    } else if ( actor.stageMemory().at(nextPoint.x,  nextPoint.y).tangible() ) {\n      this.buildNewPath\n\n      if (this.path.length) {\n        return this.act( actor, false )\n      }\n\n      let explorer = new Loiter(this)\n\n      if (explorer.available(actor)) {\n        actor.ai = explorer\n        explorer.act(actor)\n      }\n    } else {\n      actor.move(nextPoint)\n    }\n  }\n\n  private markNodeVisited( nodeID: NodeID ): void {\n    this.lastNodeVisit[ nodeID ] = this.step\n  }\n}\n","import { AI } from \"../ai\";\nimport { Creature } from \"../creature\";\nimport { Item, ItemId } from \"../items\";\nimport { Point } from \"../utils\";\n\nexport class Picker extends AI {\n  private desiredItemId: ItemId = null\n  private desiredItemPos: Point = null\n\n  public available(actor: Creature): boolean {\n    return this.seesItem(actor)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (!firstTurn) {\n      throw 'Picker got called twice'\n    }\n\n    if (actor.pos.eq(this.desiredItemPos)) {\n      const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n      tile.items.forEach(item => {\n        actor.inventory.putToBag(item)\n      })\n\n      tile.items = []\n\n      this.desiredItemId = null\n      this.desiredItemPos = null\n\n      return\n    }\n\n    this.moveTo(actor, this.desiredItemPos)\n  }\n\n  protected canTakeMore(actor: Creature): boolean {\n    // TODO:\n    return true\n  }\n\n  protected seesItem(actor: Creature): boolean {\n    this.findItem(actor, item => item.id === this.desiredItemId)\n\n    if (this.desiredItemId !== null) {\n      return true\n    }\n    this.desiredItemId = null\n    this.desiredItemPos = null\n\n    this.findItem(actor, item => true)\n\n    return this.desiredItemId !== null\n  }\n\n  private findItem(\n    actor: Creature,\n    condition: (item: Item) => boolean,\n  ): boolean {\n    this.withinView(\n      actor,\n      ({ x, y }, tile) => {\n        const items = tile.items()\n        const item = items.find(condition)\n\n        if (item) {\n          this.desiredItemId = item.id\n          this.desiredItemPos = new Point(x, y)\n          return true\n        }\n      }\n    )\n\n    return false\n  }\n}","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Waiter extends AI {\n  act(actor: Creature): void {}\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { Phantom, Creature, CreatureId } from './creature'\nimport { Item, Corpse } from './items'\nimport { Point, Mapped } from './utils'\nimport { Logger } from './logger'\nimport { Timeline } from './timeline'\n\nimport { includes } from 'lodash'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n}\n\nimport { remove } from 'lodash'\n\nexport class Tile {\n  public creature?: Phantom\n  public items: Item[] = []\n\n  private static repository: { [key: string]: Tile } = {}\n\n  public static retrive(key: string): Tile {\n    let tile = this.repository[key]\n\n    switch (key) {\n      case 'R':\n        return new Tile('R', ' ', TileTypes.Floor)\n      case 'C':\n        return new Tile('C', ' ', TileTypes.Floor)\n      case 'W':\n        return new Tile('W', '#', TileTypes.Wall)\n      case 'D':\n        return new Tile('D', '+', TileTypes.Door)\n      default:\n        throw `Tile '${key}' is not registered!`\n    }\n  }\n\n  private constructor(\n    public key: string,\n    public display: string,\n    private kind: TileTypes,\n  ) {\n  }\n\n  public isDoor(): boolean {\n    return this.kind === TileTypes.Door\n  }\n\n  public isWall(): boolean {\n    return this.kind === TileTypes.Wall\n  }\n\n  public visibleThrough(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return (this.kind !== TileTypes.Wall) && this.creature.id === actor.id\n    }\n\n    return (this.kind !== TileTypes.Wall) && (!this.creature)\n  }\n\n  public clone(): Tile {\n    let tile = Tile.retrive(this.key)\n    if (this.creature) {\n      tile.creature = this.creature.clone()\n    }\n    this.items.forEach(item => tile.items.push(item.clone()))\n    return tile\n  }\n\n  protected uniq(): boolean {\n    return this.creature !== undefined\n  }\n}\n\nexport type LevelMapId = number\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public id: LevelMapId\n  public logger: Logger\n  protected timeline: Timeline<CreatureId>\n\n  private static lastId: LevelMapId = 0\n  public static getId(): LevelMapId {\n    return this.lastId++\n  }\n\n  constructor(map: Tile[][]) {\n    super(map)\n    this.id = LevelMap.getId()\n    this.logger = new Logger()\n    this.timeline = new Timeline()\n  }\n\n  public addCreature(creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(creature.pos.x, creature.pos.y).creature = creature\n    this.timeline.add(creature.id, creature.initiativity())\n  }\n\n  public removeCreature(creature: Creature) {\n    let tile = this.at(creature.pos.x, creature.pos.y)\n    tile.creature = undefined\n    tile.items.push(new Corpse(creature))\n\n    creature.inventory.wears().forEach(({ bodyPart, equipment }) => {\n      if (equipment) {\n        tile.items.push(equipment)\n      }\n    });\n\n    creature.inventory.cares().forEach(item => {\n      tile.items.push(item)\n    });\n\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove(creature.id)\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[y][x].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[y][x].passibleThrough()\n  }\n\n  public at(x, y): Tile {\n    return this.map[y][x]\n  }\n\n  public setTile(x, y, tile: Tile): void {\n    this.map[y][x] = tile\n  }\n\n  public inRange(point: Point): boolean {\n    return point.x >= 0         && point.y >= 0\n        && point.x < this.width && point.y < this.height\n  }\n\n  public turn(): void {\n    const turnCreatureIds = this.timeline.actors()\n\n    // First loop to act\n    this.creatures.forEach(creature => {\n      if (includes(turnCreatureIds, creature.id)) {\n        creature.act(this)\n      }\n    })\n\n    // Second loop to add themselves to timeline again\n    // and build vision after all actions\n    this.creatures.forEach(creature => {\n      if (includes(turnCreatureIds, creature.id)) {\n        this.timeline.add(creature.id, creature.initiativity())\n      }\n      creature.visionMask(this)\n    })\n  }\n}\n","import { forEach, keys, min, remove, size } from 'lodash'\n\nexport class Timeline<T> {\n  private step: number = 0\n  private turns: { [key: number]:  T[] } = {}\n\n  public add(actor: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      this.turns[ts].push(actor)\n\n    } else {\n      this.turns[ts] = [actor]\n    }\n  }\n\n  public remove(actor: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element == actor)\n    })\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = min(keys(this.turns).map(parseInt))\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n}\n","import { Phantom } from '../creature'\nimport { BodyPart } from '../inventory'\n\nexport enum ItemGroup {\n  Armor,\n  Weapon,\n  Corpse,\n}\n\nexport enum ItemKind {\n  Katana,\n  Corpse\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n\n  constructor(\n    public group: ItemGroup,\n    public kind: ItemKind,\n    public name: string,\n    public id: ItemId = Item.getId(),\n  ) {\n  }\n\n  public clone(): Item {\n    return new Item(\n      this.group,\n      this.kind,\n      this.name,\n    )\n  }\n}\n\nexport abstract class Equipment extends Item {\n  public abstract bodyPart(): BodyPart\n}\n\nexport class Corpse extends Item {\n  constructor(creature: Phantom) {\n    super(\n      ItemGroup.Corpse,\n      ItemKind.Corpse,\n      'corpse',\n    )\n  }\n}\n","import {\n  Item,\n  ItemId,\n  ItemGroup,\n  ItemKind,\n\n  Equipment,\n} from './internal'\n\nimport {\n  BodyPart,\n} from '../inventory'\n\nexport abstract class Weapon extends Equipment {\n  constructor(kind: ItemKind, name: string) {\n    super(\n      ItemGroup.Weapon,\n      kind,\n      name,\n    )\n  }\n\n  public bodyPart(): BodyPart {\n    return BodyPart.RightHand\n  }\n}\n\nexport class Katana extends Weapon {\n  constructor() {\n    super(\n      ItemKind.Katana,\n      'Katana',\n    )\n  }\n}\n"],"sourceRoot":""}