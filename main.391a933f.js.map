{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/Cell.vue?24b9","webpack:///./components/Logger.vue?5783","webpack:///./components/Scene.vue?bf04","webpack:///./components/stats.vue?0476","webpack:///./components/screens/ProfessionPickingScreen.vue?e006","webpack:///./components/screens/ItemsListingScreen.vue?119f","webpack:///./components/screens/TalentsTreeScreen.vue?428b","webpack:///./components/screens/InventoryScreen.vue?0e05","webpack:///./components/App.vue?6fed","webpack:///./components/Cell.vue?d822","webpack:///./components/Cell.vue?9cf9","webpack:///./components/Cell.vue","webpack:///./components/Cell.vue?14f1","webpack:///./src/engine/utils.ts","webpack:///./src/engine/fov.ts","webpack:///./src/engine/screens/internal.ts","webpack:///./src/engine/profession.ts","webpack:///./src/engine/creature.ts","webpack:///./src/engine/screens/talents_tree_screen.ts","webpack:///./src/engine/screens/profession_picking_screen.ts","webpack:///./src/engine/ai/internal.ts","webpack:///./src/engine/ai/attacker.ts","webpack:///./src/engine/ai/chaser.ts","webpack:///./src/engine/ai/meta_ai.ts","webpack:///./src/engine/ai/escaper.ts","webpack:///./src/engine/ai/explorer.ts","webpack:///./src/engine/ai/loiter.ts","webpack:///./src/engine/ai/patrol.ts","webpack:///./src/engine/ai/player_ai.ts","webpack:///./src/engine/ai/picker.ts","webpack:///./src/engine/ai/selfhealer.ts","webpack:///./src/engine/ai/descender.ts","webpack:///./src/engine/effect.ts","webpack:///./src/engine/ai/thrower.ts","webpack:///./src/engine/generator/post.ts","webpack:///./src/engine/characteristics.ts","webpack:///./src/engine/items/internal.ts","webpack:///./src/engine/tile.ts","webpack:///./src/engine/logger.ts","webpack:///./src/engine/dungeon.ts","webpack:///./src/engine/inventory_slot.ts","webpack:///./src/engine/inventory.ts","webpack:///./src/engine/timeline.ts","webpack:///./src/engine/level_map.ts","webpack:///./src/engine/level.ts","webpack:///./src/engine/memory.ts","webpack:///./src/engine/game.ts","webpack:///./src/engine/pool.ts","webpack:///./src/engine/generator/drawn.ts","webpack:///./src/engine/generator/dungeon.ts","webpack:///./src/engine/screens/idle_screen.ts","webpack:///./src/engine/screens/inventory_screen.ts","webpack:///./src/engine/screens/missile_screen.ts","webpack:///./src/engine/controllers/internal.ts","webpack:///./src/engine/screens/items_listing.ts","webpack:///./components/Logger.vue?93db","webpack:///./components/Logger.vue?dfa9","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?1a76","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/Scene.vue?a309","webpack:///./components/Scene.vue?972d","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?2315","webpack:///./components/PrimaryAttribute.vue?99e7","webpack:///./components/PrimaryAttribute.vue?fa93","webpack:///./components/PrimaryAttribute.vue","webpack:///./components/PrimaryAttribute.vue?7f35","webpack:///./components/stats.vue?ed27","webpack:///./components/stats.vue?81dd","webpack:///./components/stats.vue","webpack:///./components/stats.vue?8715","webpack:///./components/screens/IdleScreen.vue?a956","webpack:///./components/screens/IdleScreen.vue?b385","webpack:///./components/screens/IdleScreen.vue","webpack:///./components/screens/IdleScreen.vue?e098","webpack:///./components/screens/ProfessionPickingScreen.vue?4629","webpack:///./components/screens/ProfessionPickingScreen.vue?65a0","webpack:///./components/screens/ProfessionPickingScreen.vue","webpack:///./components/screens/ProfessionPickingScreen.vue?97ec","webpack:///./components/screens/ItemsListingScreen.vue?5e1f","webpack:///./components/screens/ItemsListingScreen.vue?7614","webpack:///./components/screens/ItemsListingScreen.vue","webpack:///./components/screens/ItemsListingScreen.vue?d175","webpack:///./src/onisun/talents.ts","webpack:///./src/onisun/professions.ts","webpack:///./src/onisun/items.ts","webpack:///./src/onisun/potions.ts","webpack:///./src/onisun/creatures.ts","webpack:///./src/engine/ai/dispatcher.ts","webpack:///./src/onisun/dungeons/tutorial_dungeon.ts","webpack:///./components/screens/TalentsTreeScreen.vue?f167","webpack:///./components/screens/TalentsTreeScreen.vue?56db","webpack:///./components/screens/TalentsTreeScreen.vue","webpack:///./components/screens/TalentsTreeScreen.vue?1f51","webpack:///./components/screens/InventoryScreen.vue?7d74","webpack:///./components/screens/InventoryScreen.vue?3a71","webpack:///./components/screens/InventoryScreen.vue","webpack:///./components/screens/InventoryScreen.vue?b9ac","webpack:///./components/screens/MissileScreen.vue?482d","webpack:///./components/screens/MissileScreen.vue?88f0","webpack:///./components/screens/MissileScreen.vue","webpack:///./components/screens/MissileScreen.vue?6d19","webpack:///./components/App.vue?a6a8","webpack:///./components/App.vue?c0b2","webpack:///./src/onisun.ts","webpack:///./components/App.vue","webpack:///./components/App.vue?22f7","webpack:///./components/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","components_Cellvue_type_script_lang_ts_","vue_runtime_esm","extend","props","computed","[object Object]","this","player","cell","isWall","isDoor","display","component","componentNormalizer","_h","$createElement","_self","_c","_v","options","__file","Cell","Rect","x","y","w","h","succ","String","fromCharCode","charCodeAt","rand","max","Math","floor","random","twoDimArray","width","height","field","Array","min","list","Point","point","abs","dxy","map","add","Mapped","on","forEach","column","tile","cycle","dx","pop","unshift","bresenham","p0","p1","x0","x1","y0","y1","steps","delta","round","bresenhamInclusion","Direction","super","up","down","left","right","upLeft","upRight","downLeft","downRight","Fov","startx","starty","radius","checkSolid","markVisible","doubleRadius","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","ScreenType","TalentStatus","Clan","Ability","Screen","type","game","Profession","id","level","points","talents","depthCost","profession_ProfessionPicker","pool","maxLevel","maxTaken","professions","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","profession","lodash","some","excludeProfessions","filter","excluding","concat","Talent","depth","rank","maxRank","description","talents_tree_screen_TalentsTreeScreen","AbilitiesPicking","talent","assign","status","professionId","talentId","find","levelUps","characteristics","levelUp","specie","screen","current","profession_picking_screen_ProfessionPickingScreen","undefined","Completed","Unavailable","Available","ProfessionPicking","professionPicker","available","title","pickedProfession","playerProfession","allAbilities","keys","Specie","clan","abilities","creature_Phantom","getId","lastId","refToReal","ability","Event","AttackEvent","actor","subject","misses","currentLevel","logger","missMessage","Reaction","DODGE","damage","damageTo","health","currentValue","creature_AddExperienceEvent","killMessage","die","DIE","decrease","hurtMessage","HURT","ThrowEvent","missile","throwMisses","throwMissMessage","THROW_DODGE","throwDamageTo","throwKillMessage","throwHurtMessage","Player","NOTHING","creature_Creature","ai","stageMemories","inventory","inventory_Inventory","pos","previousPos","copy","previousLevel","addCreature","visionMask","removeCreature","at","addItem","Corpse","slots","equipment","item","count","cares","invItem","event","affect","speed","levelId","stage","act","creature","nextPoint","phantom","stageMemory","resetVisible","memory_Memory","isSolid","degree","see","calc","visibleThrough","dead","dest","move","FIRST_STEP","internal_AI","prevAI","destination","eq","path","leePath","nextTo","randomDestination","pointsToVisit","pointsToCheck","step","wavePoints","inRange","tangible","wrappers","dist","buildRoad","lastPoint","chain","dp","visit","tileVisited","visible","enemy","FreeForAll","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","goTo","onMove","onReach","onCantMove","moveTo","GoToTileAI","metaAI","matcher","attacker_Attacker","canAttack","firstTurn","victimInAccess","attack","pickNewVictim","victim","findCreature","enemies","real","condition","memory","chaser_Chaser","reset","victimId","victimSet","buildVictimPath","foundNewVictim","followTo","withinView","AIEvent","AIItemPickedEvent","items","meta_ai_MetaAI","aiToRun","events","resetEvents","STEP_DISTANCE","escaper_Escaper","escapesFrom","foundEnemies","buildPath","minDistance","explorer_Explorer","seen","loiter_Loiter","NEW_POINT_EVERY","patrol_Patrol","graph","graphlib","lastNodeVisit","markNodeVisited","currentNodeID","nodes","moveToTarget","targetNodeID","pickUpNewTarget","shouldAddNode","addNode","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","player_ai_PlayerAI","idle_screen_IdleScreen","picker_Picker","desiredItemId","can","Inventory","findItem","pushEvent","bunch","groupedItem","putToBag","selfhealer_SelfHealer","atMax","descender_Descender","kind","TileTypes","StairwayDown","canDescend","GoStairwayDown","go","Effect","onDone","ItemFlightEffect","frames","done","effect","patchMemory","thrower_Thrower","Throwing","hasMissile","missiles","missileSlot","removeItem","previousVictim","addEffect","obstacles","target","addDoors","addDoor","setTile","tile_Tile","retrieve","addCreatures","chance","creaturesPool","passibleThrough","pick","addToMap","addItems","itemsPool","centralize","minX","minY","maxX","maxY","addOnTile","match","onValid","iters","characteristics_Attribute","modifiers","modifier","increase","val","PositiveAttribute","AttributeSet","defense","dexterity","pairSet","Modifier","weight","Characteristics","with","char","mod","addModifier","removeModifier","dex","pow","regenerationValue","constantIncrease","Usage","ItemGroup","ItemSubgroup","internal_Item","group","usages","inventoryItemId","GroupedItem","groupsWith","internal_ItemsBunch","inventoryItem","inv","put","Consumable","Potion","Missile","MissileWeapon","Shoot","BodyArmor","WearsOnBody","OneHandWeapon","WeaponOneHand","LogLevel","Floor","Wall","Door","StairwayUp","isFloor","clone","repository","Stairway","currentMap","leave","adjacentMap","getMap","adjacentMapId","enterPos","matchStairs","enter","dungeon_Dungeon","levels","adjustMapId","addStairs","inventory_slot_InventorySlot","useSingleItem","itemGroup","onTakeOff","groupItem","findInBag","removeFromBag","onPutOn","inventory_slot_RightHandSlot","inventory_slot_LeftHandSlot","inventory_slot_BodySlot","inventory_slot_MissileWeaponSlot","baseMatch","matchingItems","worksWith","inventory_slot_MissileSlot","Throw","missileWeapon","missileWeaponSlot","bag","rightHandSlot","leftHandSlot","bodySlot","remove","logger_Logger","messages","debug","warning","addMessage","DEBUG","INFO","message","WARNING","DANGER","lastRow","counter","timeline_Timeline","turns","ts","element","parseInt","actors","level_map_LevelMap","creatures","timeline","actorId","next","adjustId","stairPos","each","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","MemoryTile","baseTile","game_Game","running","maps","Map","runEvents","turn","rebuildVision","levelMap","Function","generator","pool_Pool","totalWeight","ceil","input","totalPool","drawn","drawMap","charAt","THICKNESS","newRoomSpace","newCorridor","newWall","RAY_TURNS","DELTA_ANGLE","PI","dungeon_Room","rect","dungeon_Road","lined","hx","hy","horizontalLine","vx","vy","verticalLine","IdleInputKey","generator_dungeon","dimX","dimY","minSize","maxSize","roomsCount","dungeon","rooms","fill","_","generateRoom","normalize","ray","roads","buildRoads","reduce","pickedRooms","currentRoom","angle","cos","sin","roomToMove","ndx","ndy","every","room","notCross","pointWithin","connectedPoints","point1","point2","currentPoint","pointToConnect","currentDistance","inventory_screen_InventoryScreen","positions","takeTime","rebuildPositions","position","AITakeOffItem","inventorySlot","items_listing_PutOnItemsScreen","AIPutOnItem","availableItems","Idle","Right","internal_AIMoveEvent","Left","Down","Up","UpRight","UpLeft","DownRight","DownLeft","Handle","internal_AIHandleEnvEvent","PickUp","internal_AIPickUpItemsDialog","internal_AIMissileDialog","Drop","items_listing_DropItemsScreen","Drink","items_listing_DrinkScreen","Bag","BagScreen","missile_screen_MissileScreen","targetEnemyIndex","findEnemies","resetTargetId","updateTarget","direction","targetPos","internal_AIMissileAttack","resetPath","stop","newPos","drawPath","Controller","ranIntoAnObstacle","howToHandle","noItemsToPickUp","internal_AIPickUpItems","items_listing_PickUpScreen","tileItems","pickedUpItem","internal_AIDropItems","droppedItem","slot","takeOff","equip","putOn","AIDrinkItem","potion","onDrink","drink","canThrow","needMissileWeapon","nothingToShotWith","items_listing_ItemsListingScreen","ItemsListing","initPositions","onWithItem","singleItemMode","components_Loggervue_type_script_lang_ts_","methods","record","Logger_component","_vm","staticClass","_l","class","rowClass","_s","components_Logger","unicodetiles_Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","elem","appendChild","charMap","charArray","defaultColors","attribs","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","MISSILE_WEAPON","POTION","displayItem","HUMAN","HUMAN2","HUMAN3","HUMAN4","HUMAN5","RAT","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","Scenevue_type_script_lang_ts_NULLTILE","nextItemAnimation","components_Scenevue_type_script_lang_ts_","wholeMap","term","eng","drawInterval","Date","now","interval","displayTile","creatureTile","frame","animationFps","itemId","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","duration","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","update","lighted","fovTile","initViewport","watch","Scene_component","ref","Scene","components_PrimaryAttributevue_type_script_lang_ts_","slug","attr","PrimaryAttribute_component","attrs","triggers","container","placement","fullName","PrimaryAttribute","components_statsvue_type_script_lang_ts_","components","attribute","maximum","displayAttribute","stats_component","levelProgress","role","healthLevel","full-name","stats","screens_IdleScreenvue_type_script_lang_ts_","inputKey","onInput","close","IdleScreen_component","screens_IdleScreen","screens_ProfessionPickingScreenvue_type_script_lang_ts_","picked","doubleClickOption","option","iconPath","ProfessionPickingScreen_component","click","$event","dblclick","src","variant","_e","screens_ProfessionPickingScreen","screens_ItemsListingScreenvue_type_script_lang_ts_","page","perPage","selected","pickUpItems","index","selectAt","withItem","indexLetter","positionStatus","ItemsListingScreen_component","positionSelected","OnisunTalentId","OnisunProfessionId","screens_ItemsListingScreen","talents_OnisunTalent","AttackerTwoHandedWeapons","professions_OnisunAttackerProfession","Attacker","professions_OnisunDefenderProfession","Defender","professions_OnisunProfessionPicker","attacker","defender","items_MissileRock","items_Sling","items_Arrow","items_Bow","noMod","commonBow","smallRock","woodenArrow","ironArrow","weapons","newCreature","firstCallPatrol","escaper","explorer","chaser","picker","patrol","loiter","thrower","descender","regenerateEvery","regenerate","feelsGood","setAi","seesItems","pickItem","explore","healthCritical","rest","trackMovement","rat","orc","undead","robot","creaturesPool1","initId","config","simple","tutorial_dungeon_TutorialDungeon","addMap","addStairDown","generateMap","addStairUp","merge","screens_TalentsTreeScreenvue_type_script_lang_ts_","professionIndex","groups","availableIndex","letter","groupedTalents","tip","AttackerHeavyWeapons","AttackerLightWeapons","AttackerTwoWeapons","AttackerDoubleTwoHandedWeapons","AttackerStrongGrip","TalentsTreeScreen_component","card","model","callback","$$v","expression","no-body","talentStatus","pickTalent","talentTip","screens_TalentsTreeScreen","screens_InventoryScreenvue_type_script_lang_ts_","displayBodyPart","bodyPart","getChar","itemName","InventoryScreen_component","availableStatus","itemWeight","screens_InventoryScreen","screens_MissileScreenvue_type_script_lang_ts_","moveTarget","nextTarget","previousTarget","MissileScreen_component","screens_MissileScreen","components_Appvue_type_script_lang_ts_","initPlayer","playerSpecie","dagger","katana","wooden","iron","rock","bow","loopIntervalId","Logger","Stats","screenComponent","onEvent","main","loop","addEventListener","removeEventListener","App_component","tag","App","use","es","el"],"mappings":"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","file":"main.391a933f.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([26,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--0-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingScreen.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingScreen.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingScreen.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingScreen.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeScreen.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeScreen.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryScreen.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryScreen.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Cell.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { Tile, TileTypes } from '../map'\n\nexport default Vue.extend({\n  props: [\"cell\", 'player'],\n  computed: {\n    style() {\n      if (this.player) {\n        return 'player'\n      } else if (this.cell.isWall()) {\n        return 'wall'\n      } else if (this.cell.isDoor()) {\n        return 'door'\n      }\n\n      return 'floor'\n    },\n    symbol():any {\n      if (this.player) {\n        return '俺'\n      } else if (this.cell.display == ' ') {\n        return '・'\n      } else if (this.cell.display == '+') {\n        return '戸'\n      } else if (this.cell.display == '#') {\n        return '＃'\n      } else {\n        return 'E'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Cell.vue?vue&type=template&id=0a1e052e&\"\nimport script from \"./Cell.vue?vue&type=script&lang=ts&\"\nexport * from \"./Cell.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Cell.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Cell.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('td',[_vm._v(\"\\n  :class=\\\"style\\\"\\n  v-text=\\\"symbol\\\"\\n  @click=\\\"$emit('setPosition')\\\"\\n\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export class Rect {\n  // TODO: Validate?\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {}\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\nexport const succ = function(c: string): string {\n  return String.fromCharCode(c.charCodeAt(0) + 1)\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\n/* tslint:disable no-any */\nexport const twoDimArray = function(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => any\n): Array<Array<any>> {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport const max = function(list: Array<number>): number {\n  return Math.max.apply(Math, list)\n}\n\nexport const min = function(list: Array<number>): number {\n  return Math.min.apply(Math, list)\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x, y): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (tile: T, x: number, y: number) => any): void {\n    this.map.forEach((column, x) => {\n      column.forEach((tile, y) => {\n        on(tile, x, y)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x, y) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n\nexport const bresenhamInclusion = function(\n  p0: Point,\n  p1: Point,\n  on: (x, y) => void\n): void {\n  bresenham(p0, p1, on)\n  on(p1.x, p1.y)\n}\n\nexport class Direction extends Point {\n  private constructor(x, y) {\n    super(x, y)\n  }\n\n  static readonly up = new Direction(0, -1)\n  static readonly down = new Direction(0, 1)\n  static readonly left = new Direction(-1, 0)\n  static readonly right = new Direction(1, 0)\n\n  static readonly upLeft = new Direction(-1, -1)\n  static readonly upRight = new Direction(1, -1)\n  static readonly downLeft = new Direction(-1, 1)\n  static readonly downRight = new Direction(1, 1)\n}\n","export class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private checkSolid: (x: number, y: number) => boolean,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.checkSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.checkSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (this.checkSolid(currentX, currentY) && distance < this.radius) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { Game } from '../game'\nimport { Player } from '../creature'\n\nexport enum ScreenType {\n  ProfessionPicking,\n  Idle,\n  AbilitiesPicking,\n  Inventory,\n  ItemsListing,\n  Missile,\n}\n\nexport abstract class Screen {\n  public player: Player\n\n  constructor(public readonly type: ScreenType, protected game: Game) {\n    this.player = this.game.player\n  }\n\n  public build() {}\n}\n","import { Player } from './creature'\n\nimport { includes, sample, compact } from 'lodash'\nimport { Game } from './game'\n\nexport class Profession {\n  public talents: Talent[] = []\n  public readonly depthCost: number = 3\n\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1,\n    public points: number = 0\n  ) {}\n}\n\nexport class ProfessionPicker {\n  constructor(\n    private pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number\n  ) {}\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n\n    if (this.canUpdate(player)) {\n      professions.push(this.updatableProfession(player))\n    } else if (this.canTakeNewProfession(player)) {\n      professions.push(this.newFromPool(player))\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      professions.push(\n        this.newFromPool(player, professions.map(profession => profession.id))\n      )\n    } else if (this.canUpdate(player)) {\n      professions.push(\n        this.updatableProfession(\n          player,\n          professions.map(profession => profession.id)\n        )\n      )\n    }\n\n    return compact(professions)\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(\n      profession => profession.level < this.maxLevel\n    )\n  }\n\n  protected updatableProfession(\n    player: Player,\n    excludeProfessions: number[] = []\n  ): Profession {\n    return sample(\n      player.professions.filter(\n        profession => !includes(excludeProfessions, profession.id)\n      )\n    )\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return (\n      player.professions.length < this.maxTaken &&\n      this.pool.length > player.professions.length\n    )\n  }\n\n  protected newFromPool(\n    player: Player,\n    excludeProfessions: number[] = []\n  ): Profession {\n    const excluding = excludeProfessions.concat(\n      player.professions.map(profession => profession.id)\n    )\n    return sample(\n      this.pool.filter(profession => !includes(excluding, profession.id))\n    )\n  }\n}\n\nexport enum TalentStatus {\n  Available,\n  Completed,\n  Unavailable,\n}\n\nexport abstract class Talent {\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public readonly depth: number,\n    public rank: number,\n    public readonly maxRank: number,\n    public readonly description: string\n  ) {}\n\n  public abstract onObtain(game: Game): void\n}\n","import { Point } from './utils'\nimport { MetaAI } from './ai'\nimport { Fov } from './fov'\n\nimport {\n  Characteristics,\n  Corpse,\n  LevelMap,\n  LevelMapId,\n  Memory,\n  Inventory,\n} from '../engine'\n\nimport { Level } from './level'\nimport { includes } from 'lodash'\nimport { Item } from './items'\nimport { Profession } from './profession'\nimport { ProfessionPickingScreen } from './screens/profession_picking_screen'\nimport { TalentsTreeScreen } from './screens/talents_tree_screen'\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairwayDown,\n  Inventory,\n  PutOn,\n  Throwing,\n}\n\nexport const allAbilities = Object.keys(Ability).map(key => Ability[key])\n\nexport class Specie {\n  constructor(\n    public readonly name: string,\n    public readonly clan: Clan,\n    public readonly abilities: Ability[]\n  ) {}\n}\n\nexport type CreatureId = number\n\nexport class Phantom {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  public refToReal?: Creature\n\n  constructor(public specie: Specie, public id: CreatureId = Phantom.getId()) {}\n\n  public name(): string {\n    return this.specie.name\n  }\n\n  public clan(): Clan {\n    return this.specie.clan\n  }\n\n  public clone(): Phantom {\n    return new Phantom(this.specie, this.id)\n  }\n\n  public real(): Creature {\n    return this.refToReal\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n}\n\nexport abstract class Event {\n  public abstract affect(subject: Creature): Reaction\n}\n\nexport class AttackEvent extends Event {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (this.actor.characteristics.misses(subject.characteristics)) {\n      subject.currentLevel.game.logger.missMessage(this.actor, subject)\n      return Reaction.DODGE\n    }\n\n    const damage = this.actor.characteristics.damageTo(subject.characteristics)\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.killMessage(damage, this.actor, subject)\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.hurtMessage(damage, this.actor, subject)\n      return Reaction.HURT\n    }\n  }\n}\n\nexport class ThrowEvent extends Event {\n  constructor(public actor: Creature, public missile: Item) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (this.actor.characteristics.throwMisses(subject.characteristics)) {\n      subject.currentLevel.game.logger.throwMissMessage(\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.THROW_DODGE\n    }\n\n    const damage = this.actor.characteristics.throwDamageTo(\n      subject.characteristics,\n      this.missile\n    )\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.throwKillMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.throwHurtMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.HURT\n    }\n  }\n}\n\nexport class AddExperienceEvent extends Event {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affect(subject: Creature): Reaction {\n    if (subject instanceof Player) {\n      const game = subject.currentLevel.game\n\n      subject.levelUps += subject.level.add(1)\n\n      if (subject.levelUps > 0) {\n        game.screen =\n          (subject.level.current - subject.levelUps + 1) % 3 === 0\n            ? new ProfessionPickingScreen(game)\n            : new TalentsTreeScreen(game)\n      }\n    }\n\n    return Reaction.NOTHING\n  }\n}\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  THROW_DODGE,\n  NOTHING,\n}\n\nexport class Creature extends Phantom {\n  public ai: MetaAI\n  public stageMemories: { [key: string]: Memory } = {}\n  public currentLevel: LevelMap\n  public inventory: Inventory\n\n  public previousPos: Point\n  public previousLevel: LevelMap\n  public pos: Point\n\n  constructor(\n    public characteristics: Characteristics,\n    ai: MetaAI,\n    specie: Specie\n  ) {\n    super(specie)\n    this.ai = ai\n\n    this.inventory = new Inventory()\n  }\n\n  public addToMap(pos: Point, level: LevelMap) {\n    this.pos = pos\n    this.previousPos = this.pos.copy()\n    this.previousLevel = this.currentLevel\n    this.currentLevel = level\n    level.addCreature(this)\n    this.visionMask(level)\n  }\n\n  public die(): void {\n    this.currentLevel.removeCreature(this)\n\n    let tile = this.currentLevel.at(this.pos.x, this.pos.y)\n    tile.addItem(new Corpse(this.specie), 1)\n\n    this.inventory.slots().forEach(({ equipment }) => {\n      if (equipment) {\n        tile.addItem(equipment.item, equipment.count)\n      }\n    })\n\n    this.inventory.cares().forEach(invItem => {\n      tile.addItem(invItem.item, invItem.count)\n    })\n  }\n\n  public on(event: Event): Reaction {\n    return event.affect(this)\n  }\n\n  public real(): Creature {\n    return this\n  }\n\n  public speed(): number {\n    return this.characteristics.speed.currentValue()\n  }\n\n  public radius(): number {\n    return this.characteristics.radius.currentValue()\n  }\n\n  public stageMemory(levelId: LevelMapId = this.currentLevel.id): Memory {\n    return this.stageMemories[levelId]\n  }\n\n  public act(stage: LevelMap) {\n    this.visionMask(stage)\n    this.previousPos = this.pos.copy()\n    this.ai.act(this, true)\n\n    let previousPosLevel = this.previousLevel || this.currentLevel\n    previousPosLevel.at(\n      this.previousPos.x,\n      this.previousPos.y\n    ).creature = undefined\n    this.currentLevel.at(this.pos.x, this.pos.y).creature = this\n\n    this.previousLevel = undefined\n  }\n\n  public move(nextPoint: Point) {\n    this.pos = nextPoint.copy()\n  }\n\n  public clone(): Phantom {\n    let phantom = new Phantom(this.specie, this.id)\n    phantom.refToReal = this\n    return phantom\n  }\n\n  public visionMask(stage: LevelMap): void {\n    if (!this.stageMemories[stage.id]) {\n      this.stageMemories[stage.id] = new Memory(stage.width, stage.height)\n    } else {\n      this.stageMemory().resetVisible()\n    }\n\n    const see = (x: number, y: number, degree: number): void => {\n      this.stageMemory()\n        .at(x, y)\n        .see(stage.at(x, y), degree)\n    }\n\n    new Fov(\n      this.pos.x,\n      this.pos.y,\n      this.radius(),\n      stage.width,\n      stage.height,\n      this.isSolid(stage),\n      see\n    ).calc()\n  }\n\n  private isSolid(stage: LevelMap): (x: number, y: number) => boolean {\n    return (x: number, y: number) => {\n      if (stage.visibleThrough(x, y)) {\n        return false\n      } else {\n        return !(\n          stage.at(x, y).isDoor() &&\n          this.pos.x === x &&\n          this.pos.y === y\n        )\n      }\n    }\n  }\n}\n\nexport class Player extends Creature {\n  public dead: boolean = false\n\n  public levelUps: number = 0\n  public professions: Profession[] = []\n\n  constructor(\n    public level: Level,\n    characteristics: Characteristics,\n    ai: MetaAI,\n    specie: Specie\n  ) {\n    super(characteristics, ai, specie)\n  }\n\n  public act(stage: LevelMap): void {\n    super.act(stage)\n    // TODO: Simplify this? No need to move here\n  }\n\n  public move(dest: Point) {\n    super.move(dest)\n\n    let previousPosLevel = this.previousLevel || this.currentLevel\n    previousPosLevel.at(\n      this.previousPos.x,\n      this.previousPos.y\n    ).creature = undefined\n    this.currentLevel.at(this.pos.x, this.pos.y).creature = this\n\n    this.previousLevel = undefined\n  }\n\n  public die(): void {\n    super.die() // We do not want player to act after they death\n    this.dead = true\n  }\n\n  public rebuildVision(): void {\n    this.visionMask(this.currentLevel)\n  }\n}\n","import { Screen, ScreenType } from './internal'\nimport { Game, ProfessionPickingScreen } from '../../engine'\nimport { Profession, Talent, TalentStatus } from '../profession'\n\ninterface TalentWithStatus extends Talent {\n  status: TalentStatus\n}\n\ninterface TalentsTreeScreenProfession {\n  profession: Profession\n  talents: TalentWithStatus[]\n}\n\nexport class TalentsTreeScreen extends Screen {\n  public options: TalentsTreeScreenProfession[] = []\n\n  constructor(game: Game) {\n    super(ScreenType.AbilitiesPicking, game)\n\n    this.options = this.player.professions.map(profession => {\n      return {\n        profession,\n        talents: profession.talents.map(talent => {\n          return Object.assign({}, talent, {\n            status: this.status(talent, profession),\n          })\n        }),\n      }\n    })\n  }\n\n  public onInput(professionId: number, talentId: number) {\n    const profession = this.player.professions.find(\n      profession => profession.id === professionId\n    )\n    profession.talents.find(talent => talent.id === talentId).rank += 1\n    profession.points += 1\n\n    this.player.levelUps -= 1\n    this.player.characteristics.levelUp(this.player.specie)\n\n    if (this.player.levelUps > 0) {\n      this.game.screen =\n        (this.player.level.current - this.player.levelUps + 1) % 3 === 0\n          ? new ProfessionPickingScreen(this.game)\n          : new TalentsTreeScreen(this.game)\n    } else {\n      this.game.screen = undefined\n    }\n  }\n\n  private status(talent: Talent, profession: Profession): TalentStatus {\n    if (talent.rank === talent.maxRank) {\n      return TalentStatus.Completed\n    } else if (talent.depth * profession.depthCost > profession.points) {\n      return TalentStatus.Unavailable\n    } else {\n      return TalentStatus.Available\n    }\n  }\n}\n","import { Game } from '../game'\nimport { ScreenType, Screen } from './internal'\nimport { Profession } from '../profession'\nimport { TalentsTreeScreen } from './talents_tree_screen'\n\nexport class ProfessionPickingScreen extends Screen {\n  public options: Profession[]\n  public title: string\n\n  constructor(game: Game) {\n    super(ScreenType.ProfessionPicking, game)\n    this.options = this.game.professionPicker.available(this.player)\n\n    this.title = `Gained ${this.player.level.current -\n      this.player.levelUps +\n      1} level`\n  }\n\n  public onInput(pickedProfession: Profession) {\n    let playerProfession = this.player.professions.find(\n      profession => profession.id === pickedProfession.id\n    )\n    if (playerProfession) {\n      playerProfession.level += 1\n    } else {\n      this.player.professions.push(pickedProfession)\n    }\n\n    this.game.screen = new TalentsTreeScreen(this.game)\n  }\n}\n","import { Point, twoDimArray } from '../utils'\nimport { Creature, Phantom, Clan } from '../creature'\n\nimport { sample } from 'lodash'\nimport { MetaAI } from './meta_ai'\nimport { MemoryTile } from '../memory'\n\nconst FIRST_STEP: number = 1\n\ntype AIId = number\n\nexport abstract class AI {\n  private static lastId: AIId = 0\n  public static getId(): AIId {\n    return this.lastId++\n  }\n\n  constructor(public prevAI?: MetaAI, public id: AIId = AI.getId()) {}\n\n  public abstract act(actor: Creature, firstTurn: boolean): void\n\n  public abstract available(actor: Creature): boolean\n\n  public reset(): void {}\n\n  protected moveTo(actor: Creature, destination: Point): boolean {\n    // TODO: Rethink of it\n    if (actor.pos.eq(destination)) {\n      return true\n    }\n\n    const path = this.leePath(actor, point => destination.eq(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected followTo(actor: Creature, destination: Point): boolean {\n    const path = this.leePath(actor, point => destination.nextTo(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected leePath(\n    actor: Creature,\n    destination: (point: Point, tile: MemoryTile) => boolean,\n    randomDestination: boolean = false\n  ): Point[] {\n    const map = actor.stageMemory()\n\n    let stageMemory: number[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => undefined\n    )\n    let pointsToVisit: Point[] = []\n    let pointsToCheck: Point[] = [actor.pos]\n\n    let step = 0\n    while (pointsToCheck.length && !pointsToVisit.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        // TODO: Compare, current value might be lower\n        if (\n          tile.tangible(actor) ||\n          stageMemory[point.x][point.y] !== undefined\n        ) {\n          return\n        }\n\n        stageMemory[point.x][point.y] = step\n        if (destination(point, tile)) {\n          pointsToVisit.push(point)\n        } else {\n          point.wrappers().forEach(dist => wavePoints.push(dist))\n        }\n      })\n      step++\n\n      pointsToCheck = wavePoints\n    }\n\n    if (pointsToVisit.length) {\n      if (randomDestination) {\n        return this.buildRoad(sample(pointsToVisit), stageMemory)\n      } else {\n        return this.buildRoad(pointsToVisit[0], stageMemory)\n      }\n    } else {\n      return []\n    }\n  }\n\n  private buildRoad(point: Point, stageMemory: number[][]): Point[] {\n    let lastPoint = point\n    let chain = [lastPoint]\n\n    let delta: Point = undefined\n\n    while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n      delta = Point.dxy.find(\n        (dp): boolean => {\n          return (\n            stageMemory[lastPoint.x + dp.x] &&\n            stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n              stageMemory[lastPoint.x][lastPoint.y] - 1\n          )\n        }\n      )\n\n      if (!delta) {\n        return []\n      }\n\n      lastPoint = lastPoint.add(delta)\n\n      chain.unshift(lastPoint)\n    }\n\n    return chain\n  }\n\n  protected withinView(\n    actor: Creature,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    const map = actor.stageMemory()\n\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [actor.pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Phantom, enemy: Phantom): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan() === Clan.FreeForAll || enemy.clan() === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan() === Clan.Player && enemy.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan() === Clan.Player && actor.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination: Point = undefined\n\n  public available(actor: Creature): boolean {\n    return this.foundNewTarget(actor) || !!this.destination\n  }\n\n  public act(actor: Creature): void {\n    if (!this.destination) {\n      throw `FollowTargetAI's act got called when there is no destination!`\n    }\n\n    if (this.goTo(actor)) {\n      this.onMove(actor)\n      // If got the destination\n      if (this.destination.eq(actor.pos)) {\n        this.destination = undefined\n        this.onReach(actor)\n      }\n    } else {\n      // If can not move\n      this.destination = undefined\n      this.onCantMove(actor)\n    }\n  }\n\n  public reset(): void {\n    this.destination = undefined\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.moveTo(actor, this.destination)\n  }\n\n  protected abstract foundNewTarget(actor: Creature): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(actor: Creature): void {}\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(\n    metaAI: MetaAI,\n    protected matcher: (tile: MemoryTile) => boolean\n  ) {\n    super(metaAI)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    const path = this.leePath(actor, (point, tile) => this.matcher(tile), true)\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Phantom, Creature, Reaction, AttackEvent } from '../creature'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public available(actor: Creature): boolean {\n    return this.canAttack(actor)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.victimInAccess(actor)) {\n      this.attack(actor)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor)\n      this.act(actor, false)\n    }\n  }\n\n  protected attack(actor: Creature) {\n    if (this.victim.on(new AttackEvent(actor)) === Reaction.DIE) {\n      this.victim = undefined\n    }\n  }\n\n  private canAttack(actor: Creature): boolean {\n    const creature = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(actor: Creature): boolean {\n    if (this.victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      creature => creature.id === this.victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature) {\n    this.victim = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    ).real()\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): Phantom {\n    const memory = actor.stageMemory()\n    return actor.pos\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature())\n      .find(creature => creature && condition(creature))\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature, CreatureId } from '../creature'\nimport { Point } from '../utils'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  public reset(): void {\n    super.reset()\n    this.victimId = undefined\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor)) ||\n      this.foundNewVictim(actor)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): void {\n    this.victimId = undefined\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.followTo(actor, this.destination)\n  }\n\n  private buildVictimPath(actor: Creature): boolean {\n    return this.findCreature(actor, creature => creature.id === this.victimId)\n  }\n\n  private foundNewVictim(actor: Creature): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, creature => this.enemies(actor, creature)) &&\n      this.buildVictimPath(actor)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      const creature = tile.creature()\n\n      if (!result && creature && condition(creature)) {\n        this.destination = new Point(x, y)\n        this.victimId = creature.id\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Player } from '../creature'\nimport { ItemsBunch, Item } from '../items/internal'\nimport { Tile } from '../tile'\nimport { Logger } from '../logger'\nimport { Game, Modifier, AIPutOnItem } from '../../engine'\n\nimport { compact, flatten, includes } from 'lodash'\n\nexport abstract class AIEvent {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract act(): void\n\n  protected tile(): Tile {\n    return this.player.currentLevel.at(this.player.pos.x, this.player.pos.y)\n  }\n}\n\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: ItemsBunch, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    this.player.inventory.cares().forEach(item => {\n      // const wearing = this.whereToWear(item.item)\n      // if (wearing) {\n      //   // TODO: Use matching slot\n      //   new AIPutOnItem(wearing.inventorySlot, item.item, this.game).act()\n      // }\n    })\n  }\n\n  // private whereToWear(item: Item): Wearing {\n  //   const matches: Wearing[] = compact(\n  //     flatten(\n  //       item.usages.map(usage =>\n  //         this.player.inventory.slots().filter(wearing => includes(wearing.inventorySlot.usages, usage))\n  //       )\n  //     ).map(wearing => this.player.inventory.matchingEquip(wearing.inventorySlot))\n  //   )\n\n  //   if (matches.length === 0) {\n  //     return null\n  //   }\n\n  //   const weightModifier = new Modifier({\n  //     attack: 1,\n  //     defense: 1,\n  //     health: 1,\n  //     radius: 0.5,\n  //     speed: 1,\n  //   })\n\n  //   const { wearing } = matches.reduce(\n  //     (acc, wearing) => {\n  //       let weight = 0\n\n  //       if (wearing.equipment) {\n  //         item.modifier.withWeight(\n  //           wearing.equipment.item.modifier,\n  //           weightModifier,\n  //           (f, s, w) => (weight += w * (f - s))\n  //         )\n  //       } else {\n  //         item.modifier.with(weightModifier, (f, w) => (weight += f * w))\n  //       }\n\n  //       if (acc.weight > weight) {\n  //         return acc\n  //       } else {\n  //         return { weight, wearing }\n  //       }\n  //     },\n  //     { weight: 0, wearing: null }\n  //   )\n\n  //   return wearing\n  // }\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI = null) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n\n  public runEvents(): void {\n    this.events.forEach(event => {\n      event.act()\n    })\n\n    this.resetEvents()\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature } from '../creature'\n\nimport { sumBy } from 'lodash'\nimport { Point } from '../../engine'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Phantom][] = []\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return this.foundEnemies(actor) && this.buildPath(actor)\n  }\n\n  private buildPath(\n    actor: Creature,\n    minDistance: number = actor.radius() / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.leePath(\n      actor,\n      ({ x, y }) => {\n        const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n          // I don't use pathfinding since it should try\n          // to run away from those who are visible, so the path\n          // to them should be straightforward.\n          return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n        })\n\n        return score >= minDistance\n      },\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildPath(actor, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature): boolean {\n    this.escapesFrom = []\n\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (creature && this.enemies(actor, creature)) {\n        this.escapesFrom.push([point, creature])\n      }\n    })\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from '../ai'\nimport { MetaAI } from './meta_ai'\n\nexport class Explorer extends GoToTileAI {\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => !tile.seen)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Loiter extends AI {\n  // private turns: number = 0\n\n  act(actor: Creature, firstTurn: boolean = true): void {\n    // if (this.turns > 1) {\n    //   actor.ai = this.prevAI\n    //   this.prevAI.act(actor, false)\n    //   return\n    // }\n\n    const path = this.leePath(actor, point => !actor.pos.eq(point), true)\n\n    if (path.length) {\n      // this.turns += 1\n      actor.move(path[0])\n    }\n  }\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, succ } from '../utils'\nimport { Creature } from '../creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { MetaAI } from './meta_ai'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n\n  constructor(ai: MetaAI) {\n    super(ai)\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public available(actor: Creature): boolean {\n    return this.graph.nodes().length > 1\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.path.length) {\n      this.moveToTarget(actor, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor)\n      this.moveToTarget(actor, firstTurn)\n    }\n    this.step += 1\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(actor: Creature): void {\n    if (this.step >= NEW_POINT_EVERY || this.shouldAddNode(actor)) {\n      this.addNode(actor.pos.x, actor.pos.y)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(x: number, y: number): void {\n    this.graph.setNode(this.i, new Point(x, y))\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.i = succ(this.i)\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature): void {\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.leePath(actor, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature): void {\n    let seenLastID: NodeID = this.graph.nodes()[0]\n    let seenLastStep: number = this.lastNodeVisit[seenLastID]\n\n    this.graph.neighbors(this.currentNodeID).forEach((nodeID: NodeID) => {\n      if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n        seenLastID = nodeID\n        seenLastStep = this.lastNodeVisit[seenLastID]\n      }\n    })\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor)\n  }\n\n  private moveToTarget(actor: Creature, firstTurn: boolean): void {\n    const nextPoint: Point = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        this.act(actor, false)\n      } else {\n        new Loiter(this.prevAI).act(actor, firstTurn)\n      }\n    } else if (\n      actor\n        .stageMemory()\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath\n\n      if (this.path.length) {\n        return this.act(actor, false)\n      }\n    } else {\n      actor.move(nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n\n  private shouldAddNode(actor: Creature): boolean {\n    return actor\n      .stageMemory()\n      .at(actor.previousPos.x, actor.previousPos.y)\n      .tile.isDoor()\n  }\n}\n","import { MetaAI } from './meta_ai'\nimport { Player } from '../creature'\nimport { IdleScreen, ProfessionPickingScreen } from '../../engine'\n\nexport class PlayerAI extends MetaAI {\n  public act(player: Player): void {\n    const game = player.currentLevel.game\n\n    // this.runEvents(player)\n    game.screen = new IdleScreen(game)\n\n    if (player.levelUps > 0) {\n      // TODO: Should never get here\n      player.currentLevel.game.screen = new ProfessionPickingScreen(game)\n    }\n  }\n}\n","import { FollowTargetAI } from '../ai'\nimport { Creature, Ability } from '../creature'\nimport { Item, ItemId } from '../items'\nimport { Point } from '../utils'\nimport { AIItemPickedEvent } from './meta_ai'\n\nexport class Picker extends FollowTargetAI {\n  private desiredItemId: ItemId = null\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.Inventory) && super.available(actor)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return (\n      this.findItem(actor, item => item.id === this.desiredItemId) ||\n      this.findItem(actor, item => true)\n    )\n  }\n\n  protected onReach(actor: Creature): void {\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    this.prevAI.pushEvent(\n      new AIItemPickedEvent(tile.items, actor.currentLevel.game)\n    )\n\n    tile.items.bunch.forEach(groupedItem => {\n      actor.inventory.putToBag(groupedItem.item, groupedItem.count)\n    })\n\n    tile.items = undefined\n\n    this.desiredItemId = null\n  }\n\n  private findItem(\n    actor: Creature,\n    condition: (item: Item) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      if (!tile.items()) {\n        return\n      }\n\n      const item = tile\n        .items()\n        .bunch.find(groupedItem => condition(groupedItem.item))\n\n      if (item && !result) {\n        this.desiredItemId = item.id\n        this.destination = new Point(x, y)\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from '../ai'\nimport { Creature } from '../creature'\n\nexport class SelfHealer extends AI {\n  public available(actor: Creature): boolean {\n    return !actor.characteristics.health.atMax()\n  }\n\n  public act(actor: Creature): void {\n    // Does nothing, just waiting\n    // actor.characteristics.regenerate()\n  }\n}\n","import { GoToTileAI, MetaAI } from '../ai'\nimport { Ability, Creature, StairwayDown, TileTypes } from '../../engine'\n\nexport class Descender extends GoToTileAI {\n  private canDescend: boolean = false\n\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => tile.tile.kind === TileTypes.StairwayDown)\n  }\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.GoStairwayDown) && super.available(actor)\n  }\n\n  public reset(): void {\n    super.reset()\n    this.canDescend = false\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // When we are on a stairway\n    this.canDescend = this.matcher(\n      actor.stageMemory().at(actor.pos.x, actor.pos.y)\n    )\n\n    if (this.canDescend) {\n      this.destination = actor.pos\n      return true\n    } else {\n      return super.foundNewTarget(actor)\n    }\n  }\n\n  protected onReach(actor: Creature) {\n    // Should stay here at least for a turn\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    if (this.canDescend && tile instanceof StairwayDown) {\n      tile.go(actor)\n    }\n  }\n}\n","import { Item } from './items/internal'\nimport { Point } from './utils'\nimport { Memory } from './memory'\n\nexport abstract class Effect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightEffect extends Effect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability, Phantom, Reaction, ThrowEvent } from '../creature'\nimport { GroupedItem } from '../items/internal'\nimport { Point, bresenham } from '../utils'\nimport { ItemFlightEffect } from '../effect'\n\nexport class Thrower extends AI {\n  public victim: Creature\n  public previousVictim: Creature\n  public missiles: GroupedItem\n\n  public available(actor: Creature): boolean {\n    return (\n      actor.can(Ability.Throwing) &&\n      this.hasMissile(actor) &&\n      this.canAttack(actor)\n    )\n  }\n\n  public act(actor: Creature): void {\n    const missile = this.missiles.item\n    actor.inventory.missileSlot.removeItem(actor, 1)\n\n    let path = []\n\n    bresenham(actor.pos, this.victim.pos, (x, y) => path.push(new Point(x, y)))\n\n    const effect = new ItemFlightEffect(missile, path, () => {\n      if (this.victim.on(new ThrowEvent(actor, missile)) === Reaction.DIE) {\n        this.victim = undefined\n        this.previousVictim = undefined\n      }\n    })\n\n    actor.currentLevel.addEffect(effect)\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.inventory.missileSlot.equipment\n    return this.missiles !== undefined\n  }\n\n  private canAttack(actor: Creature): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (\n        this.findCreature(\n          actor,\n          creature => this.previousVictim.id === creature.id\n        )\n      ) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, creature => this.enemies(actor, creature))\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, point)\n      ) {\n        this.victim = actor.currentLevel.at(point.x, point.y).creature.real()\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(actor: Creature, target: Point): boolean {\n    let obstacles = false\n\n    bresenham(actor.pos, target, (x, y) => {\n      obstacles =\n        obstacles ||\n        actor\n          .stageMemory()\n          .at(x, y)\n          .tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import { LevelMap, Tile, Item } from '../../engine'\nimport { Pool } from '../pool'\nimport { Creature } from '../creature'\nimport { Point, cycle } from '../utils'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, Tile.retrieve('D'))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        creaturesPool.pick(null).addToMap(new Point(i, j), level)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null), 1)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\nexport const addOnTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n","import { remove, sum } from 'lodash'\nimport { Specie } from './creature'\nimport { Item } from './items'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, public current: number = max) {}\n\n  public maximum(): number {\n    return this.max\n  }\n\n  public atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  public currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  public currentValue(): number {\n    const value = super.currentValue()\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n\nexport class AttributeSet<T> {\n  constructor(\n    public attack: T,\n    public defense: T,\n    public dexterity: T,\n    public health: T,\n    public radius: T,\n    public speed: T\n  ) {}\n\n  public with(pairSet: AttributeSet<any>, on: (first: T, second: any) => void) {\n    on(this.attack, pairSet.attack)\n    on(this.defense, pairSet.defense)\n    on(this.health, pairSet.health)\n    on(this.radius, pairSet.radius)\n    on(this.speed, pairSet.speed)\n  }\n}\n\nexport class Modifier extends AttributeSet<number> {\n  constructor({\n    attack = 0,\n    defense = 0,\n    dexterity = 0,\n    health = 0,\n    radius = 0,\n    speed = 0,\n  }) {\n    super(attack, defense, dexterity, health, radius, speed)\n  }\n\n  public withWeight(\n    pairSet: Modifier,\n    weight: Modifier,\n    on: (first: number, second: number, weight: number) => void\n  ) {\n    on(this.attack, pairSet.attack, weight.attack)\n    on(this.defense, pairSet.defense, weight.defense)\n    on(this.health, pairSet.health, weight.health)\n    on(this.radius, pairSet.radius, weight.radius)\n    on(this.speed, pairSet.speed, weight.speed)\n  }\n}\n\nexport class Characteristics extends AttributeSet<Attribute> {\n  constructor({ attack, defense, dexterity, health, radius, speed }) {\n    super(\n      new PositiveAttribute(attack),\n      new PositiveAttribute(defense),\n      new PositiveAttribute(dexterity),\n      new Attribute(health),\n      new PositiveAttribute(radius),\n      new PositiveAttribute(speed)\n    )\n  }\n\n  public addModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.addModifier(mod)\n      }\n    })\n  }\n\n  public removeModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.removeModifier(mod)\n      }\n    })\n  }\n\n  public damageTo(victim: Characteristics): number {\n    return Math.round(\n      (10 * this.attack.currentValue()) / victim.defense.currentValue()\n    )\n  }\n\n  public misses(victim: Characteristics): boolean {\n    let dex = this.dexterity.currentValue()\n\n    return (\n      Math.random() >\n      dex / (dex + Math.pow(victim.dexterity.currentValue() * 0.25, 0.8))\n    )\n  }\n\n  public throwMisses(victim: Characteristics): boolean {\n    return this.misses(victim)\n  }\n\n  public throwDamageTo(victim: Characteristics, missile: Item): number {\n    return 10\n  }\n\n  public regenerate(): void {\n    this.health.increase(this.regenerationValue())\n  }\n\n  protected regenerationValue(): number {\n    return 1\n  }\n\n  public regenerateEvery(): number {\n    return 8\n  }\n\n  public levelUp(specie: Specie) {\n    this.health.constantIncrease(3)\n\n    if (Math.random() > 0.5) {\n      this.attack.constantIncrease(1)\n    } else {\n      this.defense.constantIncrease(1)\n    }\n  }\n}\n","import { Specie, Creature, Player } from '../creature'\nimport { Modifier } from '../characteristics'\n\nimport { remove } from 'lodash'\nimport { Game } from '../game'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnBody,\n  Throw,\n  Shoot,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n  Potion,\n  MissileWeapon,\n}\n\nexport enum ItemSubgroup {\n  MissileRock,\n  Sling,\n\n  Bow,\n  Arrows,\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n  public weight: number = 100\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public readonly usages: Usage[] = [],\n    public readonly modifier: Modifier = new Modifier({}),\n    public id: ItemId = Item.getId()\n  ) {}\n\n  public clone(): Item {\n    return new Item(this.group, this.name)\n  }\n\n  public onPutOn(creature: Creature): void {\n    creature.characteristics.addModifier(this.modifier)\n  }\n\n  public onTakeOff(creature: Creature): void {\n    creature.characteristics.removeModifier(this.modifier)\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.name === item.name\n  }\n\n  public worksWith(item: Item): boolean {\n    return false\n  }\n\n  public canThrow(player: Player): boolean {\n    return true\n  }\n}\n\nlet inventoryItemId = 1\nexport class GroupedItem {\n  public id: number\n\n  constructor(public count: number, public item: Item) {\n    this.id = inventoryItemId++\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.item.groupsWith(item)\n  }\n}\n\nexport class ItemsBunch {\n  public bunch: GroupedItem[] = []\n\n  public find(item: Item): GroupedItem {\n    return this.bunch.find(invItem => invItem.groupsWith(item))\n  }\n\n  public remove(item: Item, count: number): void {\n    const invItem: GroupedItem = this.find(item)\n\n    if (!invItem) {\n      // TODO: Fail if removes item that's not in bunch yet?\n      return\n    } else if (invItem.count === count) {\n      remove(this.bunch, inventoryItem => inventoryItem.id === invItem.id)\n    } else {\n      invItem.count -= count\n    }\n  }\n\n  public put(item: Item, count: number): void {\n    const invItem = this.bunch.find(inv => inv.groupsWith(item))\n\n    if (invItem) {\n      invItem.count += count\n    } else {\n      this.bunch.push(new GroupedItem(count, item))\n    }\n  }\n\n  public clone(): ItemsBunch {\n    let bunch = new ItemsBunch()\n\n    this.bunch.forEach(groupedItem => {\n      bunch.put(groupedItem.item, groupedItem.count)\n    })\n\n    return bunch\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: Specie) {\n    super(ItemGroup.Consumable, `${specie.name}'s corpse`)\n  }\n}\n\nexport abstract class Potion extends Item {\n  constructor(public name: string) {\n    super(ItemGroup.Potion, name)\n  }\n\n  abstract onDrink(game: Game): void\n}\n\nexport abstract class Missile extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.Missile, name, [], modifier)\n  }\n}\n\nexport abstract class MissileWeapon extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, [Usage.Shoot], modifier)\n  }\n}\n\nexport class BodyArmor extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.BodyArmor, name, [Usage.WearsOnBody], modifier)\n  }\n}\n\nexport class OneHandWeapon extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, [Usage.WeaponOneHand], modifier)\n  }\n}\n","import { Phantom, Creature } from './creature'\nimport { Item } from './items'\nimport { Point } from './utils'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { ItemsBunch } from './items/internal'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n}\n\nexport class Tile {\n  public creature?: Phantom\n  public items: ItemsBunch\n\n  private static repository: { [key: string]: Tile } = {}\n\n  public static retrieve(key: string): Tile {\n    switch (key) {\n      case 'R':\n        return new Tile('R', ' ', TileTypes.Floor)\n      case 'C':\n        return new Tile('C', ' ', TileTypes.Floor)\n      case 'W':\n        return new Tile('W', '#', TileTypes.Wall)\n      case 'D':\n        return new Tile('D', '+', TileTypes.Door)\n      case '>':\n        return new Tile('>', '>', TileTypes.StairwayDown)\n      case '<':\n        return new Tile('<', '<', TileTypes.StairwayUp)\n      default:\n        throw `Tile '${key}' is not registered!`\n    }\n  }\n\n  protected constructor(\n    public key: string,\n    public display: string,\n    public kind: TileTypes\n  ) {}\n\n  public addItem(item: Item, count: number): void {\n    if (!this.items) {\n      this.items = new ItemsBunch()\n    }\n\n    this.items.put(item, count)\n  }\n\n  public isDoor(): boolean {\n    return this.kind === TileTypes.Door\n  }\n\n  public isWall(): boolean {\n    return this.kind === TileTypes.Wall\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public isStairway(): boolean {\n    return (\n      this.kind === TileTypes.StairwayDown || this.kind === TileTypes.StairwayUp\n    )\n  }\n\n  public visibleThrough(): boolean {\n    return (\n      this.isFloor() ||\n      this.kind === TileTypes.StairwayDown ||\n      this.kind === TileTypes.StairwayUp\n    )\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public clone(): Tile {\n    let tile = Tile.retrieve(this.key)\n    if (this.creature) {\n      tile.creature = this.creature.clone()\n    }\n    tile.items = this.items && this.items.clone()\n    return tile\n  }\n\n  protected uniq(): boolean {\n    return this.creature !== undefined\n  }\n}\n\nabstract class Stairway extends Tile {\n  public currentMap: LevelMap\n  public adjacentMapId: LevelMapId\n  public enterPos: Point\n\n  public go(actor: Creature): void {\n    this.currentMap.leave(actor)\n\n    // TODO: Do not do this if already connected\n    const adjacentMap = this.currentMap.game.getMap(this.adjacentMapId)\n    this.enterPos = adjacentMap.matchStairs(this.currentMap.id, actor.pos)\n\n    adjacentMap.enter(actor, this.enterPos)\n    adjacentMap.game.currentMap = adjacentMap\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(public currentMap: LevelMap, public adjacentMapId: LevelMapId) {\n    super('>', '>', TileTypes.StairwayDown)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(public currentMap: LevelMap, public adjacentMapId: LevelMapId) {\n    super('<', '<', TileTypes.StairwayUp)\n  }\n}\n","import { Creature } from './creature'\nimport { Item, Potion } from './items/internal'\n\nimport { last } from 'lodash'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport interface LogMessage {\n  level: LogLevel\n  message: string\n  counter?: number\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name()} got ${damage} damage from ${actor.name()}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} causes them to die`\n    )\n  }\n\n  public missMessage(actor: Creature, target: Creature) {\n    this.debug(`${actor.name()} misses ${target.name()}!`)\n  }\n\n  public throwMissMessage(actor: Creature, target: Creature, missile: Item) {\n    this.debug(\n      `${actor.name()} throws ${missile.name} in ${target.name()}, but misses!`\n    )\n  }\n\n  public throwKillMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public throwHurtMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.debug(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      }`\n    )\n  }\n\n  public ranIntoAnObstacle(): void {\n    this.addMessage(LogLevel.DEBUG, 'You ran into a wall')\n  }\n\n  public howToHandle(): void {\n    this.addMessage(LogLevel.DEBUG, \"Don't know how to handle it\")\n  }\n\n  public noItemsToPickUp(): void {\n    this.addMessage(LogLevel.DEBUG, \"You don't see anything to pick up\")\n  }\n\n  public takeOff(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You took off ${item.name}`)\n  }\n\n  public putOn(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You put on ${item.name}`)\n  }\n\n  public drink(item: Potion): void {\n    this.addMessage(LogLevel.INFO, `You drunk ${item.name}`)\n  }\n\n  public nothingToShotWith(): void {\n    this.addMessage(LogLevel.DEBUG, 'You have nothing to shoot with')\n  }\n\n  public needMissileWeapon(): void {\n    this.addMessage(LogLevel.DEBUG, 'Мне нужен лук или типа того')\n  }\n\n  public pickedUpItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You picked up ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You picked up ${count} ${item.name}`)\n    }\n  }\n\n  public droppedItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You dropped a ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You dropped ${count} ${item.name}`)\n    }\n  }\n\n  protected debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  protected info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  protected warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  protected danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    const lastRow: LogMessage = last(this.messages)\n\n    if (lastRow && lastRow.message === message) {\n      lastRow.counter = (lastRow.counter || 1) + 1\n    } else {\n      this.messages.push({ level, message, counter: null })\n    }\n  }\n}\n","import { LevelMap, LevelMapId } from './level_map'\nimport { Game } from './game'\nimport { addOnTile } from './generator/post'\nimport { StairwayDown, StairwayUp, Tile } from './tile'\n\nexport abstract class Dungeon {\n  protected levels: LevelMap[] = []\n\n  constructor(protected game: Game) {}\n  public abstract build(): void\n  public abstract enter(): void\n\n  protected addStairDown(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayDown(map, adjustMapId))\n  }\n\n  protected addStairUp(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayUp(map, adjustMapId))\n  }\n\n  private addStairs(map: LevelMap, tile: Tile): LevelMap {\n    addOnTile(\n      map,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        map.setTile(x, y, tile)\n      }\n    )\n\n    return map\n  }\n}\n","import { Item, GroupedItem } from './items'\nimport { Creature } from './creature'\nimport { Usage } from './items/internal'\nimport { intersection } from 'lodash'\nimport { Inventory } from './inventory'\n\nexport abstract class InventorySlot {\n  public name: string\n\n  constructor(\n    // What kind of items can be put in slot\n    public readonly usages: Usage[],\n    // Has to put only a single item or can put a bunch of them\n    public readonly useSingleItem: boolean,\n    public equipment?: GroupedItem\n  ) {}\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    return inventory.cares().filter(itemGroup => this.match(itemGroup.item))\n  }\n\n  public removeItem(actor: Creature, count: number): void {\n    if (this.equipment) {\n      if (this.equipment.count === count) {\n        this.equipment.item.onTakeOff(actor)\n        this.equipment = undefined\n      } else {\n        this.equipment.count -= count\n      }\n    } else {\n      // TODO: fail here\n    }\n  }\n\n  public equip(actor: Creature, item: Item) {\n    let inventory = actor.inventory,\n      groupItem = inventory.findInBag(item)\n    // TODO: assert item in a bag?\n    // TODO: assert that can't equip more than have in inventory\n    // TODO: assert can equip\n    if (this.equipment) {\n      inventory.putToBag(this.equipment.item, this.equipment.count)\n      this.equipment.item.onTakeOff(actor)\n    }\n    const count = this.useSingleItem ? 1 : groupItem.count\n    this.equipment = new GroupedItem(count, item)\n    inventory.removeFromBag(item, count)\n    item.onPutOn(actor)\n  }\n\n  public takeOff(actor: Creature): void {\n    if (this.equipment) {\n      actor.inventory.putToBag(this.equipment.item, this.equipment.count)\n      this.equipment.item.onTakeOff(actor)\n      this.equipment = null\n    } else {\n      throw `Slot ${this.name} has nothing to take off`\n    }\n  }\n\n  protected match(item: Item): boolean {\n    return intersection(item.usages, this.usages).length > 0\n  }\n}\n\nexport class RightHandSlot extends InventorySlot {\n  public name: string = 'Правая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class LeftHandSlot extends InventorySlot {\n  public name: string = 'Левая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class BodySlot extends InventorySlot {\n  public name: string = 'Корпус'\n  constructor() {\n    super([Usage.WearsOnBody], true)\n  }\n}\n\nexport class MissileWeaponSlot extends InventorySlot {\n  public name: string = 'Метательное'\n  constructor() {\n    super([Usage.Shoot], true)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    let baseMatch = super.matchingItems(inventory),\n      missile = inventory.missileSlot.equipment\n\n    if (missile) {\n      return baseMatch.filter(groupedItem =>\n        groupedItem.item.worksWith(missile.item)\n      )\n    }\n\n    return baseMatch\n  }\n}\n\nexport class MissileSlot extends InventorySlot {\n  public name: string = 'Снаряды'\n  constructor() {\n    super([Usage.Throw], false)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    let baseMatch = inventory.cares(),\n      missileWeapon = inventory.missileWeaponSlot.equipment\n\n    if (missileWeapon) {\n      return baseMatch.filter(groupedItem =>\n        groupedItem.item.worksWith(missileWeapon.item)\n      )\n    }\n\n    return baseMatch\n  }\n}\n","import {\n  InventorySlot,\n  RightHandSlot,\n  LeftHandSlot,\n  BodySlot,\n  MissileWeaponSlot,\n  MissileSlot,\n} from './inventory_slot'\n\nimport { Item, GroupedItem, ItemsBunch } from './items'\n\nimport { intersection } from 'lodash'\n\nexport class Inventory {\n  private bag: ItemsBunch = new ItemsBunch()\n\n  public rightHandSlot = new RightHandSlot()\n  public leftHandSlot = new LeftHandSlot()\n  public bodySlot = new BodySlot()\n  public missileWeaponSlot = new MissileWeaponSlot()\n  public missileSlot = new MissileSlot()\n\n  // public inSlot(slot: InventorySlot): GroupedItem {\n  //   const wearing = this.matchingEquip(slot)\n  //   return wearing && wearing.equipment\n  // }\n\n  // public removeWearing(\n  //   actor: Creature,\n  //   slot: InventorySlot,\n  //   count: number\n  // ): void {\n  //   let wearing = this.matchingEquip(slot)\n\n  //   if (wearing && wearing.equipment) {\n  //     if (wearing.equipment.count === count) {\n  //       wearing.equipment.item.onTakeOff(actor)\n  //       wearing.equipment = undefined\n  //     } else {\n  //       wearing.equipment.count -= count\n  //     }\n  //   } else {\n  //     // TODO: fail here\n  //   }\n  // }\n\n  public slots(): InventorySlot[] {\n    return [\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.bodySlot,\n      this.missileWeaponSlot,\n      this.missileSlot,\n    ]\n  }\n\n  public cares(): GroupedItem[] {\n    return this.bag.bunch\n  }\n\n  // public matchingEquip(slot: InventorySlot): Wearing {\n  //   return this.wearings.find(wearSlot => wearSlot.inventorySlot.id === slot.id)\n  // }\n\n  public findInBag(item: Item): GroupedItem {\n    return this.bag.find(item)\n  }\n\n  public putToBag(item: Item, count: number): void {\n    this.bag.put(item, count)\n  }\n\n  public removeFromBag(item: Item, count: number): void {\n    this.bag.remove(item, count)\n  }\n}\n","import { forEach, keys, min, remove, size, pullAt } from 'lodash'\n\nexport class Timeline<T> {\n  private step: number = 0\n  private turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      this.turns[ts].push(item)\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n  }\n\n  public next(): T {\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from './utils'\nimport { Timeline } from './timeline'\nimport { Game } from './game'\nimport { Tile, StairwayDown, StairwayUp } from './tile'\n\nimport { remove } from 'lodash'\nimport { Effect } from '../engine'\n\nexport type LevelMapId = number\n\nexport type TimeEvent = [CreatureId, Effect]\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public game: Game\n  public timeline: Timeline<TimeEvent>\n  public name: string\n\n  constructor(public readonly id: LevelMapId, map: Tile[][]) {\n    super(map)\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public leave(actor: Creature): void {\n    this.reset()\n    this.removeCreature(actor)\n  }\n\n  public enter(actor: Creature, enterPos: Point): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add([creature.id, undefined], creature.speed())\n    )\n\n    actor.addToMap(enterPos, this)\n  }\n\n  public addCreature(creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(creature.pos.x, creature.pos.y).creature = creature\n    this.timeline.add([creature.id, undefined], creature.speed())\n  }\n\n  public removeCreature(creature: Creature) {\n    let tile = this.at(creature.pos.x, creature.pos.y)\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove([creature.id, undefined])\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public addEffect(effect: Effect): void {\n    this.timeline.add([undefined, effect], effect.speed())\n  }\n\n  public turn(): Effect {\n    const [actorId, effect] = this.timeline.next()\n\n    if (actorId !== undefined) {\n      const actor = this.creatures.find(creature => actorId === creature.id)\n\n      if (actor) {\n        actor.act(this)\n\n        // If they are still on a map\n        if (this.creatures.find(creature => actorId === creature.id)) {\n          this.timeline.add([actorId, undefined], actor.speed())\n        }\n      }\n      return\n    } else if (effect) {\n      if (effect.done()) {\n        effect.onDone()\n      } else {\n        this.timeline.add([undefined, effect], effect.speed())\n      }\n\n      return effect\n    } else {\n      throw 'Timeline event is empty!'\n    }\n  }\n\n  public matchStairs(adjustId: LevelMapId, enterPos: Point): Point {\n    let stairPos: Point\n\n    this.each((tile, x, y) => {\n      if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n        if (tile.adjacentMapId === adjustId) {\n          tile.enterPos = enterPos\n          stairPos = new Point(x, y)\n        }\n      }\n    })\n\n    return stairPos\n  }\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number {\n    if (this.doneLeveling) {\n      return\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = 0\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      levelUps += 1\n      this.levelUp()\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { Tile } from './tile'\nimport { Creature, Phantom, twoDimArray } from '../engine'\nimport { ItemsBunch } from './items/internal'\nimport { Mapped } from './utils'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile?: Tile) {}\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public items(): ItemsBunch {\n    return this.tile.items\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public creature(): Phantom {\n    return this.tile && this.tile.creature\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = Tile.retrieve('W')\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { Logger, LevelMap, Player, Screen, LevelMapId } from '../engine'\nimport { ProfessionPicker } from './profession'\n\ntype MapGenerator = (id: LevelMapId, game: Game) => LevelMap\n\nexport abstract class Game {\n  public logger: Logger = new Logger()\n  public currentMap: LevelMap\n  public player: Player\n  public screen: Screen = null\n  public running: boolean = false\n  public professionPicker: ProfessionPicker\n\n  protected maps: Map<LevelMapId, LevelMap | MapGenerator> = new Map()\n\n  public turn() {\n    if (this.running || this.screen) {\n      return\n    }\n\n    this.player.ai.runEvents()\n\n    this.running = true\n\n    while (!this.player.dead && !this.screen) {\n      const effect = this.player.currentLevel.turn()\n\n      if (effect) {\n        this.player.rebuildVision()\n        effect.patchMemory(this.player.stageMemory())\n\n        this.running = false\n        return\n      }\n    }\n\n    this.player.rebuildVision()\n\n    this.running = false\n  }\n\n  public getMap(id: LevelMapId): LevelMap {\n    let levelMap: LevelMap | MapGenerator = this.maps[id]\n\n    if (levelMap instanceof LevelMap) {\n      return levelMap\n    } else if (levelMap instanceof Function) {\n      levelMap = levelMap(id, this)\n      this.maps[id] = levelMap\n      return levelMap\n    } else {\n      throw `LevelMap with id ${id} is not found`\n    }\n  }\n\n  public addMap(id: LevelMapId, generator: MapGenerator): void {\n    // TODO: Raise if presence\n    this.maps[id] = generator\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (Input) => Output][] = []\n\n  constructor(items: [number, (Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    return this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })[1](input)\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import { twoDimArray } from '../utils'\nimport { Tile } from '../../engine'\n\nexport default function(drawMap: string[]): Tile[][] {\n  return twoDimArray(drawMap[0].length, drawMap.length, (x, y) =>\n    Tile.retrieve(drawMap[y].charAt(x))\n  )\n}\n","import { Rect, Point, rand, min, twoDimArray } from '../utils'\nimport { Tile } from '../../engine'\n\nconst THICKNESS = 0\n\nconst newRoomSpace = function(): Tile {\n  return Tile.retrieve('R')\n}\n\nconst newCorridor = function(): Tile {\n  return Tile.retrieve('C')\n}\n\nconst newWall = function(): Tile {\n  return Tile.retrieve('W')\n}\n\ntype Stage = Tile[][]\n\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: Stage): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: Stage): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (stage[hx + i][hy].key === 'W') {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (stage[vx][vy + j].key === 'W') {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator {\n  rooms: Array<Room>\n  roads: Array<Road>\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room[]): Room[] {\n    return rooms.reduce((pickedRooms: Room[], currentRoom: Room) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room[]): Room[] {\n    const minX = min(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room) => room.x + room.w < this.maxX)\n\n    const minY = min(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room[]): Road[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    let connectedPoints: Point[] = [points.shift()]\n    let roads: Road[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let currentPoint = points.shift()\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number\n): Tile[][] {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator(dimX, dimY, minSize, maxSize, roomsCount)\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n\n  for (let i = 0; i < dungeon.rooms.length; i++) dungeon.rooms[i].add(stage)\n\n  for (let i = 0; i < dungeon.roads.length; i++) dungeon.roads[i].add(stage)\n\n  return stage\n}\n","import { Screen, ScreenType } from './internal'\nimport {\n  Game,\n  AIMoveEvent,\n  Direction,\n  AIHandleEnvEvent,\n  AIPickUpItemsDialog,\n  DropItemsScreen,\n  DrinkScreen,\n  BagScreen,\n  AIMissileDialog,\n} from '../../engine'\nimport { InventoryScreen } from './inventory_screen'\n\nexport enum IdleInputKey {\n  Right,\n  Left,\n  Down,\n  Up,\n\n  UpRight,\n  UpLeft,\n  DownRight,\n  DownLeft,\n\n  Handle,\n  Missile,\n\n  Inventory,\n  Bag,\n  PickUp,\n  Drop,\n  Drink,\n}\n\nexport class IdleScreen extends Screen {\n  constructor(game: Game) {\n    super(ScreenType.Idle, game)\n  }\n\n  public onInput(key: IdleInputKey) {\n    switch (key) {\n      case IdleInputKey.Right:\n        return new AIMoveEvent(Direction.right, this.game).act()\n      case IdleInputKey.Left:\n        return new AIMoveEvent(Direction.left, this.game).act()\n      case IdleInputKey.Down:\n        return new AIMoveEvent(Direction.down, this.game).act()\n      case IdleInputKey.Up:\n        return new AIMoveEvent(Direction.up, this.game).act()\n\n      case IdleInputKey.UpRight:\n        return new AIMoveEvent(Direction.upRight, this.game).act()\n      case IdleInputKey.UpLeft:\n        return new AIMoveEvent(Direction.upLeft, this.game).act()\n      case IdleInputKey.DownRight:\n        return new AIMoveEvent(Direction.downRight, this.game).act()\n      case IdleInputKey.DownLeft:\n        return new AIMoveEvent(Direction.downLeft, this.game).act()\n\n      case IdleInputKey.Handle:\n        return new AIHandleEnvEvent(this.game).act()\n\n      case IdleInputKey.PickUp:\n        return new AIPickUpItemsDialog(this.game).act()\n      case IdleInputKey.Missile:\n        return new AIMissileDialog(this.game).act()\n\n      case IdleInputKey.Drop:\n        this.game.screen = new DropItemsScreen(this.game)\n        return\n      case IdleInputKey.Drink:\n        this.game.screen = new DrinkScreen(this.game)\n        return\n      case IdleInputKey.Inventory:\n        this.game.screen = new InventoryScreen(this.game)\n        return\n      case IdleInputKey.Bag:\n        this.game.screen = new BagScreen(this.game)\n        return\n    }\n  }\n}\n","import { Screen, ScreenType } from './internal'\nimport {\n  Game,\n  AITakeOffItem,\n  Item,\n  InventorySlot,\n  GroupedItem,\n  PutOnItemsScreen,\n  AIPutOnItem,\n} from '../../engine'\nimport { IdleScreen } from './idle_screen'\n\ninterface InventoryPosition {\n  inventorySlot: InventorySlot\n  item: Item\n  count: number\n  availableItems: GroupedItem[]\n}\n\nexport class InventoryScreen extends Screen {\n  public positions: InventoryPosition[] = []\n  private takeTime: boolean = false\n\n  constructor(game: Game) {\n    super(ScreenType.Inventory, game)\n    this.rebuildPositions()\n  }\n\n  public takeOff(position: InventoryPosition) {\n    new AITakeOffItem(position.inventorySlot, this.game).act()\n    this.takeTime = true\n    this.rebuildPositions()\n  }\n\n  public putOn(position: InventoryPosition) {\n    this.game.screen = new PutOnItemsScreen(\n      itemGroup => {\n        new AIPutOnItem(position.inventorySlot, itemGroup.item, this.game).act()\n        this.takeTime = true\n        this.rebuildPositions()\n        this.game.screen = this\n      },\n      position.availableItems,\n      this.game\n    )\n  }\n\n  public close() {\n    if (this.takeTime) {\n      this.game.screen = null\n    } else {\n      this.game.screen = new IdleScreen(this.game)\n    }\n  }\n\n  private rebuildPositions(): void {\n    this.positions = this.player.inventory.slots().map(inventorySlot => {\n      return {\n        inventorySlot: inventorySlot,\n        item: inventorySlot.equipment && inventorySlot.equipment.item,\n        count: inventorySlot.equipment && inventorySlot.equipment.count,\n        availableItems: inventorySlot.matchingItems(this.player.inventory),\n      }\n    })\n  }\n}\n","import { Screen, ScreenType } from './internal'\nimport { Game } from '../game'\nimport { Point, bresenham, bresenhamInclusion, Direction } from '../utils'\nimport { Memory } from '../memory'\nimport { IdleScreen } from './idle_screen'\nimport { AIMissileAttack } from '../../engine'\n\nexport class MissileScreen extends Screen {\n  public targetPos: Point\n  private memory: Memory\n  private targetEnemyIndex: number = undefined\n  private enemies: Point[] = []\n  private path: Point[] = []\n\n  constructor(game: Game) {\n    super(ScreenType.Missile, game)\n\n    this.findEnemies()\n    this.memory = this.player.stageMemory()\n    this.resetTargetId()\n  }\n\n  public nextTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      return this.resetTargetId()\n    }\n\n    this.targetEnemyIndex += 1\n\n    if (this.targetEnemyIndex >= this.enemies.length) {\n      this.targetEnemyIndex = 0\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public previousTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      return this.resetTargetId()\n    }\n\n    this.targetEnemyIndex -= 1\n\n    if (this.targetEnemyIndex < 0) {\n      this.targetEnemyIndex = this.enemies.length - 1\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public moveTarget(direction: Direction): void {\n    const stage = this.player.currentLevel,\n      dest = this.targetPos.add(direction),\n      tile = stage.at(dest.x, dest.y)\n\n    if (\n      tile.visibleThrough() &&\n      this.player.stageMemory().at(dest.x, dest.y).visible\n    ) {\n      this.updateTarget(dest)\n      this.targetEnemyIndex = undefined\n    }\n  }\n\n  public attack(): void {\n    if (!this.targetPos.eq(this.player.pos)) {\n      new AIMissileAttack(this.path, this.game).act()\n    }\n  }\n\n  public close(): void {\n    this.resetPath()\n    this.game.screen = new IdleScreen(this.game)\n  }\n\n  private resetTargetId(): void {\n    if (this.enemies.length) {\n      this.targetEnemyIndex = 0\n      this.updateTarget(this.enemies[this.targetEnemyIndex])\n    } else {\n      this.targetEnemyIndex = undefined\n      this.updateTarget(this.player.pos)\n    }\n  }\n\n  private resetPath(): void {\n    this.path.forEach(({ x, y }) => (this.memory.at(x, y).effect = undefined))\n  }\n\n  private drawPath(): void {\n    this.path = []\n    let stop = false\n    const stage = this.player.currentLevel\n\n    bresenhamInclusion(this.player.pos, this.targetPos, (x, y) => {\n      if (!stage.at(x, y).passibleThrough()) {\n        stop = true\n      }\n\n      this.path.push(new Point(x, y))\n      this.memory.at(x, y).effect = stop ? 'o' : 'x'\n    })\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.resetPath()\n    this.targetPos = newPos.copy()\n    this.drawPath()\n  }\n\n  private findEnemies(): void {\n    this.enemies = []\n\n    this.player.stageMemory().each((tile, x, y) => {\n      if (\n        tile.visible &&\n        tile.creature() &&\n        tile.creature().id !== this.player.id\n      ) {\n        this.enemies.push(new Point(x, y))\n      }\n    })\n  }\n}\n","import { Logger } from '../logger'\nimport { Player, AttackEvent, ThrowEvent, Creature } from '../creature'\nimport { Game } from '../game'\nimport { Tile, StairwayDown, StairwayUp } from '../tile'\nimport { Direction, Point } from '../utils'\nimport {\n  IdleScreen,\n  PickUpScreen,\n  GroupedItem,\n  InventorySlot,\n  Potion,\n  Item,\n  ItemFlightEffect,\n} from '../../engine'\nimport { MissileScreen } from '../screens/missile_screen'\n\nexport abstract class Controller {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract act(): void\n\n  protected tile(): Tile {\n    return this.player.currentLevel.at(this.player.pos.x, this.player.pos.y)\n  }\n}\n\nexport class AIMoveEvent extends Controller {\n  constructor(public direction: Direction, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    const stage = this.player.currentLevel,\n      dest = this.player.pos.add(this.direction),\n      tile = stage.at(dest.x, dest.y)\n\n    if (tile.passibleThrough(this.player)) {\n      this.player.move(dest)\n    } else if (tile.creature) {\n      tile.creature.real().on(new AttackEvent(this.player))\n    } else {\n      this.game.logger.ranIntoAnObstacle()\n    }\n\n    this.game.screen = undefined\n  }\n}\n\nexport class AIHandleEnvEvent extends Controller {\n  public act(): void {\n    const tile = this.tile()\n\n    if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n      tile.go(this.player)\n      this.game.screen = undefined\n    } else {\n      this.player.currentLevel.game.logger.howToHandle()\n    }\n  }\n}\n\nexport class AIPickUpItemsDialog extends Controller {\n  public act(): void {\n    const items = this.tile().items,\n      game = this.player.currentLevel.game\n\n    switch ((items && items.bunch.length) || 0) {\n      case 0:\n        game.logger.noItemsToPickUp()\n        return\n      case 1:\n        new AIPickUpItems(items.bunch, this.game).act()\n        this.game.screen = undefined\n        return\n      default:\n        game.screen = new PickUpScreen(game)\n        return\n    }\n  }\n}\n\nexport class AIPickUpItems extends Controller {\n  constructor(private items: GroupedItem[], game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    if (!this.items.length) {\n      this.game.screen = new IdleScreen(this.game)\n    }\n\n    let tileItems = this.tile().items\n\n    this.items.forEach(({ item, count }) => {\n      this.player.inventory.putToBag(item, count)\n      this.game.logger.pickedUpItem(item, count)\n      tileItems.remove(item, count)\n    })\n\n    this.game.screen = undefined\n  }\n}\n\nexport class AIDropItems extends Controller {\n  constructor(private items: GroupedItem[], game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    if (!this.items.length) {\n      this.game.screen = new IdleScreen(this.game)\n    }\n\n    let tile = this.tile()\n\n    this.items.forEach(({ item, count }) => {\n      this.player.inventory.removeFromBag(item, count)\n      this.game.logger.droppedItem(item, count)\n      tile.addItem(item, count)\n    })\n\n    this.game.screen = undefined\n  }\n}\n\nexport class AITakeOffItem extends Controller {\n  constructor(private slot: InventorySlot, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    // TODO: assert slot is not empty\n    const groupedItem = this.slot.equipment\n    this.slot.takeOff(this.player)\n    this.logger.takeOff(groupedItem.item)\n  }\n}\n\nexport class AIPutOnItem extends Controller {\n  constructor(private slot: InventorySlot, private item: Item, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    this.slot.equip(this.player, this.item)\n    this.logger.putOn(this.item)\n  }\n}\n\nexport class AIDrinkItem extends Controller {\n  constructor(private potion: Potion, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    this.player.inventory.removeFromBag(this.potion, 1)\n    this.potion.onDrink(this.game)\n    this.logger.drink(this.potion)\n  }\n}\n\nexport class AIMissileDialog extends Controller {\n  public act(): void {\n    const missile = this.player.inventory.missileSlot.equipment\n\n    if (missile && missile.item) {\n      if (missile.item.canThrow(this.player)) {\n        this.game.screen = new MissileScreen(this.game)\n      } else {\n        this.logger.needMissileWeapon()\n      }\n    } else {\n      this.logger.nothingToShotWith()\n    }\n  }\n}\n\nexport class AIMissileAttack extends Controller {\n  constructor(private path: Point[], game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    const slot = this.player.inventory.missileSlot,\n      missile = slot.equipment.item\n\n    slot.removeItem(this.player, 1)\n\n    let path = [],\n      victim: Creature\n\n    this.path.forEach(point => {\n      if (!victim) {\n        const tile = this.player.currentLevel.at(point.x, point.y)\n        victim = tile.creature && tile.creature.real()\n        this.path.push(point)\n      }\n    })\n\n    const effect = new ItemFlightEffect(missile, path, () => {\n      if (victim) {\n        victim.on(new ThrowEvent(this.player, missile))\n      }\n    })\n\n    this.player.currentLevel.addEffect(effect)\n    this.game.screen = undefined\n  }\n}\n","import { Screen, ScreenType } from './internal'\nimport {\n  Game,\n  Item,\n  AIPickUpItems,\n  AIDropItems,\n  AIDrinkItem,\n} from '../../engine'\nimport { IdleScreen } from './idle_screen'\nimport { GroupedItem, ItemGroup, Potion } from '../items/internal'\nimport { InventoryScreen } from './inventory_screen'\n\ninterface ItemsListingPosition {\n  item: Item\n  count: number\n}\n\nabstract class ItemsListingScreen extends Screen {\n  public positions: ItemsListingPosition[]\n  public title: string\n\n  constructor(game: Game) {\n    super(ScreenType.ItemsListing, game)\n    this.initPositions()\n  }\n\n  protected abstract initPositions()\n\n  public close(): void {\n    this.game.screen = new IdleScreen(this.game)\n  }\n}\n\nexport class PickUpScreen extends ItemsListingScreen {\n  public title: string = 'What to pick up?'\n\n  protected initPositions(): void {\n    const items = this.player.currentLevel.at(\n      this.player.pos.x,\n      this.player.pos.y\n    ).items\n    this.positions = items.bunch.map(itemGroup => {\n      return { item: itemGroup.item, count: itemGroup.count }\n    })\n  }\n\n  public pickUpItems(items: GroupedItem[]): void {\n    // TODO: Validate items are part of positions\n    new AIPickUpItems(items, this.game).act()\n  }\n}\n\nexport class DropItemsScreen extends ItemsListingScreen {\n  public title: string = 'What to drop?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: GroupedItem[]): void {\n    // TODO: Validate items are part of positions\n    new AIDropItems(items, this.game).act()\n  }\n}\n\nexport class PutOnItemsScreen extends ItemsListingScreen {\n  public title: string = 'What to put on?'\n  public singleItemMode: boolean = true\n\n  constructor(\n    private onWithItem: (itemGroup: ItemsListingPosition) => void,\n    public positions: ItemsListingPosition[],\n    game: Game\n  ) {\n    super(game)\n  }\n\n  protected initPositions(): void {}\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Validate items are part of positions\n    // new AIDropItems(items, this.game).act()\n  }\n\n  public withItem(itemGroup: ItemsListingPosition): void {\n    this.onWithItem(itemGroup)\n  }\n\n  public close(): void {\n    this.game.screen = new InventoryScreen(this.game)\n  }\n}\n\nexport class DrinkScreen extends ItemsListingScreen {\n  public title: string = 'Что выпить?'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory\n      .cares()\n      .filter(itemGroup => itemGroup.item.group === ItemGroup.Potion)\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    new AIDrinkItem(itemGroup.item, this.game).act()\n    this.game.screen = undefined\n  }\n}\n\nexport class BagScreen extends ItemsListingScreen {\n  public title: string = 'Сумка'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.game.screen = undefined\n  }\n}\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { takeRight } from 'lodash'\n\nimport { LogLevel } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: ['logger'],\n  data() {\n    return {\n      lastId: 0,\n    }\n  },\n  computed: {\n    messages() {\n      return takeRight(this.logger.messages, 5)\n    }\n  },\n  methods: {\n    counter(value) {\n      if (value) {\n        return `x${value}`\n      }\n    },\n    rowClass(record) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'debug'\n        case LogLevel.INFO:\n          return 'info'\n        case LogLevel.WARNING:\n          return 'warning'\n        case LogLevel.DANGER:\n          return 'danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=c5c9c21c&scoped=true&lang=pug&\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts&\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"c5c9c21c\",\n  null\n  \n)\n\ncomponent.options.__file = \"Logger.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logger\"},_vm._l((_vm.messages),function(record,i){return _c('div',{key:i,class:_vm.rowClass(record)},[_vm._v(_vm._s(record.message)+\"\\n\"+_vm._s(_vm.counter(record.counter)))])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('幅').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Tile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n} from '../src/engine'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends Tile {\n  public lighted(degree: number): Tile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: Tile, degree: number): Tile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: Tile, degree: number): Tile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('戸')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('・')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('＃')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDown extends DisplayTile {\n  constructor() {\n    super('＞')\n  }\n}\n\nexport class StairwayUp extends DisplayTile {\n  constructor() {\n    super('＜')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('刀', 200, 200, 200)\nconst CORPSE = new ItemTile('体', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('胸', 200, 200, 200)\nconst MISSILE = new ItemTile('石', 200, 200, 200)\nconst MISSILE_WEAPON = new ItemTile(']', 200, 200, 200)\n\nconst POTION = new ItemTile('！', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    case ItemGroup.MissileWeapon:\n      return MISSILE_WEAPON\n    case ItemGroup.Potion:\n      return POTION\n    default:\n      throw `Unknown group ${item} with type ${item.group}`\n  }\n}\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  DoorTile,\n  FloorTile,\n  ItemTile,\n  WallTile,\n  StairwayUp,\n  StairwayDown,\n  DisplayTile,\n\n  displayItem,\n} from './scene_tiles'\n\nconst HUMAN  = new CreatureTile('俺', 0, 255, 0)\nconst HUMAN2 = new CreatureTile('俺', 255, 0, 0)\nconst HUMAN3 = new CreatureTile('俺', 0, 0, 255)\nconst HUMAN4 = new CreatureTile('俺', 255, 0, 255)\nconst HUMAN5 = new CreatureTile('俺', 0, 255, 255)\n\nconst RAT = new CreatureTile('ｄ', 197, 65, 38)\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDown()\nconst STAIRWAY_UP = new StairwayUp()\nconst NULLTILE = new DisplayTile('　', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('｜', 200, 200, 200),\n  new ItemTile('／', 200, 200, 200),\n  new ItemTile('ー', 200, 200, 200),\n  new ItemTile('＼', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      interval: 100,\n      step: 0,\n    }\n  },\n  methods: {\n    getTile(x, y) {\n      const effect = this.stage.at(x, y).effect\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULLTILE\n      }\n\n      if (effect) {\n        if (tile.creature) {\n          let displayTile = this.creatureTile(tile.creature).clone()\n          displayTile.setBackground(200, 0, 0)\n          return displayTile\n        } else {\n          return new DisplayTile(effect, 200, 200, 0)\n        }\n      }\n\n      if (tile.creature) {\n        return this.creatureTile(tile.creature)\n      }\n\n      if (tile.items) {\n        switch (tile.items.bunch.length) {\n        case 0:\n          break;\n        case 1:\n          return displayItem(tile.items.bunch[0].item)\n        default:\n          const frame = this.step % (this.animationFps * 3 + 4)\n          if (frame < nextItemAnimation.length) {\n            return nextItemAnimation[frame]\n          } else {\n            const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n            return displayItem(tile.items.bunch[itemId % tile.items.bunch.length].item)\n          }\n        }\n      }\n\n      switch (tile.display) {\n      case '#':\n        return WALL\n      case '+':\n        return DOOR\n      case ' ':\n        return FLOOR\n      case '<':\n        return STAIRWAY_UP\n      case '>':\n        return STAIRWAY_DOWN\n      default:\n        return NULLTILE\n      }\n    },\n    creatureTile(creature) {\n      if (creature.name() == 'Rat') {\n        return RAT\n      }\n\n      switch (creature.id % 5) {\n        case 0:\n          return HUMAN5\n        case 1:\n          return HUMAN4\n        case 2:\n          return HUMAN3\n        case 3:\n          return HUMAN2\n        case 4:\n          return HUMAN\n      }\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        Math.max(this.level.width, 40),\n        Math.max(this.level.height, 40),\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x, y) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.ts = ts\n      }\n\n      this.eng.update(this.player.pos.x, this.player.pos.y);\n      // this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level.id)\n    },\n    animationFps() {\n      return 1000 / this.interval\n    },\n    tileItems() {\n      let items = this.stage.at(this.player.pos.x, this.player.pos.y).items()\n      return items && items.bunch\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=d1269b18&lang=pug&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Scene.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { sum } from 'lodash'\n\nexport default Vue.extend({\n  name: 'PrimaryAttribute',\n  props: ['name', 'slug', 'attr', 'fullName'],\n  computed: {\n    id() {\n      return `${this.slug}-container`\n    },\n    modifier() {\n      return sum(this.attr.modifiers)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PrimaryAttribute.vue?vue&type=template&id=6e52ba73&lang=pug&\"\nimport script from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\nexport * from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PrimaryAttribute.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover\",attrs:{\"id\":_vm.id}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.attr.currentValue()))]),_c('b-popover',{attrs:{\"target\":_vm.id,\"triggers\":\"hover\",\"container\":_vm.id,\"placement\":\"top\"}},[[_c('big',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.fullName))]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Базовый:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.attr.current))])]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Модификатор:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.modifier))])])]],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PrimaryAttribute from './PrimaryAttribute.vue'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature'],\n  components: {\n    PrimaryAttribute\n  },\n  computed: {\n    levelProgress() {\n      const level = this.creature.level\n      return `${level.currentExperience  / level.requiredExperience * 100}%`\n    },\n    healthLevel() {\n      const attribute = this.creature.characteristics.health\n      return `${attribute.currentValue() / (attribute.maximum() || 0) * 100}%`\n    }\n  },\n  methods: {\n    displayAttribute(attribute) {\n      if (attribute.currentValue() != attribute.maximum()) {\n        return `${attribute.currentValue()} / ${attribute.maximum()}`\n      } else {\n        return attribute.currentValue()\n      }\n    },\n  }\n})\n","import { render, staticRenderFns } from \"./stats.vue?vue&type=template&id=2de6dc4a&scoped=true&lang=pug&\"\nimport script from \"./stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2de6dc4a\",\n  null\n  \n)\n\ncomponent.options.__file = \"stats.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel container\"},[_c('div',{staticClass:\"level cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.level.current))]),_c('div',{staticClass:\"note\"},[_vm._v(\"Уровень\"),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-bar bg-success\",style:({ width: _vm.levelProgress }),attrs:{\"role\":\"progressbar\"}})])])]),_c('div',{staticClass:\"hp cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.displayAttribute(_vm.creature.characteristics.health)))]),_c('div',{staticClass:\"bar\",style:({ height: _vm.healthLevel })})]),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"attack\",\"name\":\"А\",\"full-name\":\"Атака\",\"attr\":_vm.creature.characteristics.attack}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"defense\",\"name\":\"З\",\"full-name\":\"Защита\",\"attr\":_vm.creature.characteristics.defense}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"speed\",\"name\":\"С\",\"full-name\":\"Скорость\",\"attr\":_vm.creature.characteristics.speed}}),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.currentLevel.name))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleScreen.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'IdleScreen',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.close(IdleInputKey.Right)\n\n      case 'h':\n      case 'ArrowLeft':\n        return this.close(IdleInputKey.Left)\n\n      case 'k':\n      case 'ArrowUp':\n        return this.close(IdleInputKey.Up)\n\n      case 'j':\n      case 'ArrowDown':\n        return this.close(IdleInputKey.Down)\n\n      case 'y':\n        return this.close(IdleInputKey.UpLeft)\n      case 'u':\n        return this.close(IdleInputKey.UpRight)\n      case 'b':\n        return this.close(IdleInputKey.DownLeft)\n      case 'n':\n        return this.close(IdleInputKey.DownRight)\n\n      case 'H':\n        return this.close(IdleInputKey.Handle)\n\n      case 'i':\n        return this.close(IdleInputKey.Inventory)\n      case 'I':\n        return this.close(IdleInputKey.Bag)\n      case 't':\n        return this.close(IdleInputKey.Missile)\n      case ',':\n        return this.close(IdleInputKey.PickUp)\n      case 'd':\n        return this.close(IdleInputKey.Drop)\n      case 'D':\n        return this.close(IdleInputKey.Drink)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./IdleScreen.vue?vue&type=template&id=41e6de4e&lang=pug&\"\nimport script from \"./IdleScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./IdleScreen.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"IdleScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingScreen.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const option = doubleClickOption || this.picked\n      if (option) {\n        this.screen.onInput(option)\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case 'a':\n        this.picked = this.screen.options[0]\n        break\n      case 'b':\n        this.picked = this.screen.options[1]\n        break\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        return\n      }\n    },\n    iconPath(professionId: number) {\n      return 'assets/professions/' + [\n        'acrobatic.svg',\n        'button-finger.svg',\n        'disintegrate.svg',\n        'flying-fox.svg',\n        'amputation.svg',\n        'catch.svg',\n        'divert.svg',\n        'fruiting.svg',\n        'annexation.svg',\n        'conversation.svg',\n        'dodging.svg',\n        'grab.svg',\n        'arrest.svg',\n        'convince.svg',\n        'drinking.svg',\n        'journey.svg',\n        'back-forth.svg',\n        'coronation.svg',\n        'drop-weapon.svg',\n        'juggler.svg',\n        'backstab.svg',\n        'crafting.svg',\n        'drowning.svg',\n        'jump-across.svg',\n        'boot-stomp.svg',\n        'crush.svg',\n        'eating.svg',\n        'kindle.svg',\n        'bowman.svg',\n        'discussion.svg',\n        'expander.svg',\n        'kneeling.svg',\n      ][professionId]\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ProfessionPickingScreen.vue?vue&type=template&id=1eb699f7&lang=pug&\"\nimport script from \"./ProfessionPickingScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./ProfessionPickingScreen.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ProfessionPickingScreen.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ProfessionPickingScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal text-center\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"content\"},_vm._l((_vm.screen.options),function(option){return _c('div',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option},\"dblclick\":function($event){_vm.close(option)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(option.id)}}),_c('div',{staticClass:\"name\"},[_vm._v(_vm._s(option.name))])])})),_c('div',{staticClass:\"bottom\"},[(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":_vm.close}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        if (this.screen.singleItemMode) {\n          this.screen.withItem(this.screen.positions[i])\n        } else if (this.selected.indexOf(i) >= 0) {\n          this.selected.splice(this.selected.indexOf(i), 1)\n        } else {\n          this.selected.push(i)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingScreen.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ItemsListingScreen.vue?vue&type=template&id=c4cf8788&lang=pug&\"\nimport script from \"./ItemsListingScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./ItemsListingScreen.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ItemsListingScreen.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ItemsListingScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('table',{staticClass:\"container positions-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.positionStatus(position)},[_c('td',{staticClass:\"selected\"},[(_vm.positionSelected(index))?_c('div',{staticClass:\"sign\"},[_vm._v(\"+\")]):_vm._e()]),_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(position.item.name)+\" (\"+_vm._s(position.count)+\")\")]),_c('td',{staticClass:\"weight\"},[_vm._v(\"[\"+_vm._s(position.item.weight)+\"g]\")])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { Talent, Game } from '../engine'\n\n// TODO: Validate all Talent's ids are uniq\nexport enum OnisunTalentId {\n  AttackerTwoHandedWeapons,\n  AttackerHeavyWeapons,\n  AttackerLightWeapons,\n  AttackerTwoWeapons,\n  AttackerDoubleTwoHandedWeapons,\n  AttackerStrongGrip,\n}\n\nexport abstract class OnisunTalent extends Talent {\n  constructor(\n    id: number,\n    name: string,\n    depth: number,\n    rank: number,\n    maxRank: number,\n    description: string = ''\n  ) {\n    super(id, name, depth, rank, maxRank, description)\n  }\n}\n\nexport class AttackerTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerTwoHandedWeapons, 'Двуручные оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerLightWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerLightWeapons, 'Легкие оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerHeavyWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerHeavyWeapons, 'Тяжелые оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerTwoWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerTwoWeapons,\n      'Два оружия',\n      1,\n      0,\n      1,\n      'Позволяет брать оружие в каждую руку'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerDoubleTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerDoubleTwoHandedWeapons,\n      'Два двуручных оружия',\n      2,\n      0,\n      2\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerStrongGrip extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerStrongGrip,\n      'Крепкий хват',\n      2,\n      0,\n      2,\n      'Оружие не выбивается из рук'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n","import { ProfessionPicker, Profession, Player } from '../engine'\nimport { AttackerTwoHandedWeapons } from './talents'\n\nenum OnisunProfessionId {\n  Attacker,\n  Defender,\n}\n\nexport class OnisunAttackerProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Attacker, 'Оружейник', level)\n\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunDefenderProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Defender, 'Защитник', level)\n  }\n}\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    player: Player,\n    public attacker = new OnisunAttackerProfession(),\n    public defender = new OnisunDefenderProfession()\n  ) {\n    super([attacker, defender], 3, 6)\n  }\n}\n","import {\n  Missile,\n  MissileWeapon,\n  Item,\n  Modifier,\n  Player,\n  OneHandWeapon,\n  BodyArmor,\n  Pool,\n} from '../engine'\nimport { HealPotion } from './potions'\n\nclass MissileRock extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Sling\n  }\n}\n\nclass Arrow extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Bow\n  }\n\n  public canThrow(player: Player): boolean {\n    return !!player.inventory.missileWeaponSlot.equipment\n  }\n}\n\nclass Sling extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof MissileRock\n  }\n}\n\nclass Bow extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof Arrow\n  }\n}\n\nconst noMod = new Modifier({})\n\nexport const commonBow = () => new Bow('Common bow', noMod)\n\nexport const smallRock = () => new MissileRock('Small rock', noMod)\n\nexport const woodenArrow = () => new Arrow('Wooden arrow', noMod)\nexport const ironArrow = () => new Arrow('Iron arrow', noMod)\n\nexport const weapons = new Pool<null, Item>([\n  [1, () => new OneHandWeapon('Katana', new Modifier({ attack: 10 }))],\n  [3, () => new OneHandWeapon('Axe', new Modifier({ attack: 7 }))],\n  [7, () => new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))],\n  [5, () => new OneHandWeapon('Hammer', new Modifier({ attack: 5 }))],\n])\n\nexport const itemsPool = new Pool<null, Item>([\n  [1, () => new BodyArmor('Кольчуга', new Modifier({ defense: 10 }))],\n  [5, () => new BodyArmor('Латы', new Modifier({ defense: 5 }))],\n  [10, () => new BodyArmor('Роба', new Modifier({ defense: 1 }))],\n  [100, () => new HealPotion()],\n])\n","import { Potion } from '../engine/items'\nimport { Game } from '../engine'\n\nexport class HealPotion extends Potion {\n  constructor() {\n    super('Зелье лечения')\n  }\n\n  public onDrink(game: Game) {\n    game.player.characteristics.health.increase(5)\n  }\n}\n","import {\n  Characteristics,\n  Creature,\n  Dispatcher,\n  Specie,\n  Clan,\n  Pool,\n} from '../engine'\n\nconst newCreature = (characteristics: Characteristics, name: string) => {\n  return new Creature(\n    characteristics,\n    new Dispatcher(),\n    new Specie(name, Clan.PlayerOnlyEnemy, [])\n  )\n}\n\nconst floatingEye = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 100,\n      radius: 5,\n      speed: 200,\n    }),\n    'Floating eye'\n  )\n}\n\nconst rat = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 1,\n      radius: 5,\n      speed: 90,\n    }),\n    'Rat'\n  )\n}\n\nconst orc = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 3,\n      defense: 3,\n      dexterity: 2,\n      health: 5,\n      radius: 5,\n      speed: 100,\n    }),\n    'Orc'\n  )\n}\n\nconst undead = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 2,\n      defense: 7,\n      dexterity: 1,\n      health: 10,\n      radius: 5,\n      speed: 120,\n    }),\n    'Undead'\n  )\n}\n\nconst robot = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 5,\n      defense: 5,\n      dexterity: 3,\n      health: 7,\n      radius: 7,\n      speed: 90,\n    }),\n    'Robot'\n  )\n}\n\nconst dragon = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 7,\n      defense: 7,\n      dexterity: 7,\n      health: 30,\n      radius: 5,\n      speed: 100,\n    }),\n    'Dragon'\n  )\n}\n\nexport const creaturesPool1 = new Pool<null, Creature>([\n  [10, rat],\n  [1, floatingEye],\n])\nexport const creaturesPool2 = new Pool<null, Creature>([[1, rat], [2, orc]])\nexport const creaturesPool3 = new Pool<null, Creature>([\n  [1, rat],\n  [1, orc],\n  [2, undead],\n])\nexport const creaturesPool4 = new Pool<null, Creature>([\n  [2, undead],\n  [2, robot],\n])\nexport const creaturesPool5 = new Pool<null, Creature>([\n  [2, robot],\n  [1, dragon],\n])\n","import {\n  AI,\n  Attacker,\n  Chaser,\n  Escaper,\n  Explorer,\n  Loiter,\n  Picker,\n  Patrol,\n  SelfHealer,\n  Descender,\n  Thrower,\n} from '../ai'\nimport { Creature } from '../creature'\nimport { MetaAI } from './meta_ai'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  private firstCallPatrol: boolean = true\n\n  private step: number = 0\n\n  constructor() {\n    super()\n    this.escaper = new Escaper(this)\n    this.explorer = new Explorer(this)\n    this.chaser = new Chaser(this)\n    this.attacker = new Attacker(this)\n    this.picker = new Picker(this)\n    this.patrol = new Patrol(this)\n    this.loiter = new Loiter(this)\n    this.thrower = new Thrower(this)\n\n    this.descender = new Descender(this)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    // Never dispatch twice\n    if (!firstTurn) {\n      throw 'Meta AI called recursively'\n    }\n\n    this.step += 1\n\n    if (this.step % actor.characteristics.regenerateEvery() === 0) {\n      actor.characteristics.regenerate()\n    }\n\n    this.runEvents()\n\n    if (this.feelsGood(actor)) {\n      if (this.attacker.available(actor)) {\n        this.setAi(this.attacker)\n      } else if (this.thrower.available(actor)) {\n        this.setAi(this.thrower)\n      } else if (this.chaser.available(actor)) {\n        this.setAi(this.chaser)\n      } else if (this.seesItems(actor)) {\n        this.pickItem(actor)\n      } else {\n        this.explore(actor)\n      }\n    } else if (this.healthCritical(actor) && this.escaper.available(actor)) {\n      this.setAi(this.escaper)\n    } else if (this.attacker.available(actor)) {\n      this.setAi(this.attacker)\n    } else if (this.thrower.available(actor)) {\n      this.setAi(this.thrower)\n    } else if (this.chaser.available(actor)) {\n      this.setAi(this.chaser)\n    } else {\n      this.rest(actor)\n    }\n\n    this.resetEvents()\n    this.aiToRun.act(actor, firstTurn)\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() >\n      actor.characteristics.health.maximum() * 0.9\n    )\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() <\n      actor.characteristics.health.maximum() / 4\n    )\n  }\n\n  private seesItems(actor: Creature): boolean {\n    return this.picker.available(actor)\n  }\n\n  private pickItem(actor: Creature): void {\n    this.setAi(this.picker)\n  }\n\n  private explore(actor: Creature): void {\n    if (this.explorer.available(actor)) {\n      this.patrol.trackMovement(actor)\n      this.setAi(this.explorer)\n    } else if (this.descender.available(actor)) {\n      this.setAi(this.descender)\n    } else if (this.patrol.available(actor)) {\n      if (this.firstCallPatrol) {\n        this.firstCallPatrol = false\n        this.patrol.addNode(actor.pos.x, actor.pos.y)\n      }\n      this.setAi(this.patrol)\n    } else {\n      this.setAi(this.loiter)\n    }\n  }\n\n  private rest(actor: Creature): void {\n    this.setAi(new SelfHealer(this))\n  }\n\n  private setAi(ai: AI): void {\n    if (this.aiToRun && this.aiToRun.id !== ai.id) {\n      this.aiToRun.reset()\n    }\n\n    this.aiToRun = ai\n  }\n}\n","import {\n  Dungeon,\n  addOnTile,\n  Point,\n  LevelMap,\n  dungeon,\n  addDoors,\n  centralize,\n  addItems,\n  drawn,\n  addCreatures,\n} from '../../engine'\nimport { weapons, itemsPool } from '../items'\nimport { creaturesPool1 } from '../creatures'\n\nconst initId: number = -1\n\nconst config = {\n  addDoors: false,\n  minSize: 3,\n  maxSize: 10,\n  roomsCount: 10,\n  simple: false,\n}\n\nexport class TutorialDungeon extends Dungeon {\n  public enter(): void {\n    this.game.currentMap = this.game.getMap(initId)\n\n    addOnTile(\n      this.game.currentMap,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        this.game.player.addToMap(new Point(x, y), this.game.currentMap)\n      }\n    )\n  }\n\n  public build(): void {\n    this.game.addMap(-1, (id, game) =>\n      addCreatures(0.3, this.addStairDown(this.generateMap(id), 0), creaturesPool1)\n    )\n\n    for (let i = 0; i < 5; i++) {\n      this.game.addMap(i, (id, game) => {\n        return addCreatures(\n          i * 0.01,\n          this.addStairUp(\n            this.addStairDown(this.generateMap(id), i + 1),\n            i - 1\n          ),\n          creaturesPool1\n        )\n      })\n    }\n\n    this.game.addMap(5, (id, game) => this.addStairUp(this.generateMap(id), 4))\n  }\n\n  private generateMap(id: number): LevelMap {\n    let map = new LevelMap(\n      id,\n      dungeon(40, 30, config.minSize, config.maxSize, config.roomsCount)\n    )\n\n    if (config.simple) {\n      map = new LevelMap(\n        id,\n        drawn([\n          'WWWWWWWWWWWWWWWWWWWWWW',\n          'WRRRRRRRRRRRRRRRRRRRRW',\n          'WRRRRRRRRRRRRRRRRRRRRW',\n          'WRRRRRRRRRRRRRRRRRRRRW',\n          'WRRRRRRRRRRRRRRRRRRRRW',\n          'WRRRRRRRRRRRRRRRRRRRRW',\n          'WWWWWWWWWWWWWWWWWWWWWW',\n        ])\n      )\n    }\n\n    if (config.addDoors) {\n      addDoors(map)\n    }\n    centralize(map)\n    map.game = this.game\n    map.name = `MP ${id}`\n\n    addItems(0.05, map, weapons.merge(itemsPool))\n\n    return map\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { OnisunTalentId } from 'src/onisun'\nimport { TalentStatus } from 'src/engine';\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null,\n      professionIndex: 0\n    }\n  },\n  computed: {\n    option() {\n      return this.screen.options[this.professionIndex]\n    },\n    profession() {\n      return this.option.profession\n    },\n    groupedTalents() {\n      let groups = new Array(5)\n      for (let i = 0; i < groups.length; i++) {\n        groups[i] = []\n      }\n\n      let availableIndex = 0\n\n      this.option.talents.forEach(talent => {\n        if (talent.status === TalentStatus.Available) {\n          Object.assign(talent, {\n            letter: String.fromCharCode(LETTER_OFFSET + availableIndex++)\n          })\n        }\n\n        groups[talent.depth].push(talent)\n      })\n\n      return groups\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const talent = doubleClickOption || this.picked\n\n      if (!talent || talent.status !== TalentStatus.Available) {\n        return\n      }\n\n      this.screen.onInput(this.profession.id, talent.id)\n      this.picked = null\n    },\n    pickTalent(talent) {\n      if (talent.status === TalentStatus.Available) {\n        this.picked = talent\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        this.groupedTalents.forEach(group => group.forEach(talent => {\n          if (talent.letter === event.key) {\n            this.picked = talent\n          }\n        }))\n\n        const index = parseInt(event.key)\n        if (index >= 1 && index <= this.screen.options.length) {\n          this.professionIndex = index - 1\n        }\n      }\n    },\n    talentTip(talent) {\n      let tip = `${talent.rank}/${talent.maxRank}`\n      if (talent.rank >= talent.maxRank) {\n        return tip\n      } else {\n        return `${talent.letter} ${tip}`\n      }\n    },\n    talentStatus(talent) {\n      if (this.picked && this.picked.id === talent.id) {\n        return '-selected'\n      }\n      switch(talent.status) {\n      case TalentStatus.Available:\n        return '-available'\n      case TalentStatus.Unavailable:\n        return '-unavailable'\n      case TalentStatus.Completed:\n        return '-completed'\n      }\n    },\n    iconPath(talentId) {\n      switch(talentId) {\n        case OnisunTalentId.AttackerTwoHandedWeapons:\n          return 'AttackerTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerHeavyWeapons:\n          return 'AttackerHeavyWeapons.svg'\n        case OnisunTalentId.AttackerLightWeapons:\n          return 'AttackerLightWeapons.svg'\n        case OnisunTalentId.AttackerTwoWeapons:\n          return 'AttackerTwoWeapons.svg'\n        case OnisunTalentId.AttackerDoubleTwoHandedWeapons:\n          return 'AttackerDoubleTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerStrongGrip:\n          return 'AttackerStrongGrip.svg'\n      }\n    }\n  },\n  watch: {\n    professionIndex() {\n      this.picked =  null\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeScreen.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./TalentsTreeScreen.vue?vue&type=template&id=46248f2d&lang=pug&\"\nimport script from \"./TalentsTreeScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsTreeScreen.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./TalentsTreeScreen.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsTreeScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover screen-modal text-center\",attrs:{\"id\":\"talents-tree-container\"}},[_c('b-tabs',{staticClass:\"tabs-list\",attrs:{\"card\":\"\"},model:{value:(_vm.professionIndex),callback:function ($$v) {_vm.professionIndex=$$v},expression:\"professionIndex\"}},_vm._l((_vm.screen.player.professions),function(profession){return _c('b-tab',{key:profession.id,attrs:{\"title\":profession.name,\"no-body\":\"\"}})})),_c('table',{staticClass:\"content\"},_vm._l((_vm.groupedTalents),function(group,i){return _c('tr',{key:i},_vm._l((group),function(talent,j){return _c('td',{key:j,staticClass:\"cell\"},[_c('div',{staticClass:\"talent-cell\",class:_vm.talentStatus(talent),attrs:{\"id\":j + 'talentTree-'+i,\"variant\":\"primary\"},on:{\"click\":function($event){_vm.pickTalent(talent)},\"dblclick\":function($event){_vm.close(talent)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/talents/' + _vm.iconPath(talent.id)}}),_c('span',{staticClass:\"level\"},[_vm._v(_vm._s(_vm.talentTip(talent)))]),_c('b-popover',{attrs:{\"target\":j + 'talentTree-'+i,\"triggers\":\"hover\",\"container\":\"talents-tree-container\"}},[[_c('p',{staticClass:\"name\"},[_vm._v(_vm._s(talent.name))]),_c('small',[_c('p',{staticClass:\"rank\"},[_vm._v(\"Уровень \"+_vm._s(talent.rank)+\"/\"+_vm._s(talent.maxRank))]),(_vm.talentStatus(talent) === '-unavailable')?_c('p',{staticClass:\"requirements\"},[_vm._v(\"Требуется \"+_vm._s(talent.depth * _vm.profession.depthCost)+\" очков в \"+_vm._s(_vm.profession.name))]):_vm._e(),_c('p',{staticClass:\"description\"},[_vm._v(_vm._s(talent.description))])])]],2)],1)])}))})),(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"default\"},on:{\"click\":function($event){_vm.close()}}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  LeftHandSlot,\n  RightHandSlot,\n  BodySlot,\n  MissileSlot,\n  MissileWeaponSlot,\n} from '../../src/engine'\n\nimport {\n  displayItem,\n} from './../scene_tiles'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case ' ':\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ',':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        const position = this.screen.positions[i]\n        if (position.item) {\n          this.screen.takeOff(position)\n        } else if (position.availableItems.length) {\n          this.screen.putOn(position)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    displayBodyPart(bodyPart) {\n      return bodyPart.name\n    },\n    displayItem(item) {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    itemName(position) {\n      if (position.item) {\n        return `${position.item.name} (${position.count})`\n      } else {\n        return '-'\n      }\n    },\n    itemWeight(position) {\n      if (position.item) {\n        return `[${position.item.weight}g]`\n      }\n    },\n    available(position) {\n      return position.item || position.availableItems.length\n    },\n    availableStatus(position) {\n      return this.available(position) ? '-available' : '-unavailable'\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryScreen.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./InventoryScreen.vue?vue&type=template&id=fe588aa4&lang=pug&\"\nimport script from \"./InventoryScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./InventoryScreen.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./InventoryScreen.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"InventoryScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(\"Инвентарь\")]),_c('table',{staticClass:\"content inventory-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.availableStatus(position)},[_c('td',{staticClass:\"slot\"},[_c('span',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('span',{staticClass:\"dash\"},[_vm._v(\"—\")]),_c('span',{staticClass:\"part\"},[_vm._v(_vm._s(_vm.displayBodyPart(position.inventorySlot)))]),_c('span',{staticClass:\"separator\"},[_vm._v(\":\")])]),_c('td',{staticClass:\"name\",class:_vm.positionStatus(position)},[_vm._v(_vm._s(_vm.itemName(position)))]),_c('td',{staticClass:\"weight\"},[_vm._v(_vm._s(_vm.itemWeight(position)))])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileScreen.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileScreen.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey, Direction } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'MissileScreen',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case '>':\n        this.screen.nextTarget()\n        break\n      case '<':\n        this.screen.previousTarget()\n        break\n      case 't':\n        this.screen.attack()\n        break\n      case 'Escape':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MissileScreen.vue?vue&type=template&id=19016a98&lang=pug&\"\nimport script from \"./MissileScreen.vue?vue&type=script&lang=ts&\"\nexport * from \"./MissileScreen.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MissileScreen.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport * as _ from 'lodash'\n\nimport Cell from './Cell.vue'\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\nimport Stats from './stats.vue'\n\nimport Idle from './screens/IdleScreen.vue'\nimport ProfessionPickingScreen from './screens/ProfessionPickingScreen.vue'\nimport ItemsListingScreen from './screens/ItemsListingScreen.vue'\nimport TalentsTreeScreen from './screens/TalentsTreeScreen.vue'\nimport InventoryScreen from './screens/InventoryScreen.vue'\nimport MissileScreen from './screens/MissileScreen.vue'\n\nimport { LevelMap, ScreenType, Screen } from '../src/engine'\n\nimport {\n  Onisun,\n} from '../src/onisun'\nimport { setInterval, clearInterval } from 'timers';\n\nexport default Vue.extend({\n  data() {\n    return {\n      game: new Onisun(),\n      ts: Date.now(),\n      loopIntervalId: undefined\n    }\n  },\n  components: {\n    Cell,\n    Logger,\n    Scene,\n    Stats,\n  },\n  computed: {\n    screenComponent() {\n      switch (this.game.screen && this.game.screen.type) {\n      case ScreenType.AbilitiesPicking:\n        return TalentsTreeScreen\n      case ScreenType.ProfessionPicking:\n        return ProfessionPickingScreen\n      case ScreenType.Idle:\n        return Idle\n      case ScreenType.ItemsListing:\n        return ItemsListingScreen\n      case ScreenType.Inventory:\n        return InventoryScreen\n      case ScreenType.Missile:\n        return MissileScreen\n      }\n    }\n  },\n  methods: {\n    loop() {\n      this.game.turn()\n    },\n    onEvent(event) {\n      const screen = this.$refs.screenComponent\n      if (screen) {\n        screen.onEvent(event)\n      }\n    }\n  },\n  created() {\n    this.loopIntervalId = setInterval(this.loop, 10)\n    document.addEventListener('keydown', this.onEvent)\n  },\n  beforeDestroy() {\n    clearInterval(this.loopIntervalId)\n    document.removeEventListener('keydown', this.onEvent)\n  }\n})\n","import {\n  Clan,\n  Player,\n  Specie,\n  allAbilities,\n  OneHandWeapon,\n  Modifier,\n  Characteristics,\n  Game,\n  Level,\n  PlayerAI,\n} from './engine'\n\nimport { OnisunProfessionPicker } from './onisun/professions'\nimport { woodenArrow, ironArrow, commonBow, smallRock } from './onisun/items'\nimport { TutorialDungeon } from './onisun/dungeons/tutorial_dungeon'\n\nexport * from './onisun/professions'\nexport * from './onisun/talents'\nexport * from './onisun/items'\n\nexport class Onisun extends Game {\n  public professionPicker: OnisunProfessionPicker\n\n  constructor() {\n    super()\n    this.player = this.initPlayer()\n    this.professionPicker = new OnisunProfessionPicker(this.player)\n    this.player.professions.push(this.professionPicker.attacker)\n\n    const dungeon = new TutorialDungeon(this)\n    dungeon.build()\n    dungeon.enter()\n  }\n\n  protected initPlayer(): Player {\n    const playerSpecie = new Specie('Player', Clan.Player, allAbilities)\n\n    let player = new Player(\n      new Level([1, 3, 5, 10, 20]),\n      new Characteristics({\n        attack: 1,\n        defense: 4,\n        dexterity: 3,\n        health: 100,\n        radius: 10,\n        speed: 80,\n      }),\n      new PlayerAI(),\n      playerSpecie\n    )\n\n    const dagger = new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))\n    const katana = new OneHandWeapon('Katana', new Modifier({ attack: 10 }))\n\n    const wooden = woodenArrow()\n    const iron = ironArrow()\n    const rock = smallRock()\n\n    const bow = commonBow()\n\n    player.inventory.putToBag(dagger, 2)\n    player.inventory.putToBag(katana, 1)\n\n    player.inventory.putToBag(wooden, 5)\n    player.inventory.putToBag(iron, 5)\n    player.inventory.putToBag(rock, 5)\n\n    player.inventory.putToBag(bow, 2)\n\n    // player.putOn(RightHandSlot, dagger)\n    // player.inventory.missileWeaponSlot.equip(player, bow)\n    player.inventory.missileSlot.equip(player, wooden)\n\n    return player\n  }\n}\n","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=3b68ed5d&lang=pug&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{staticClass:\"container-fluid\",attrs:{\"id\":\"app\"}},[(_vm.game.player && !_vm.game.player.dead)?_c('Scene',{staticClass:\"scene\",attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player}}):_vm._e(),(_vm.game.player && !_vm.game.player.dead)?_c('Stats',{staticClass:\"player-stats\",attrs:{\"creature\":_vm.game.player}}):_vm._e(),_c('Logger',{staticClass:\"logger-panel\",attrs:{\"logger\":_vm.game.logger}}),(_vm.game.player && _vm.game.player.dead)?_c('div',[_vm._v(\"You are dead\")]):_vm._e(),(_vm.game.screen)?_c(_vm.screenComponent,{ref:\"screenComponent\",tag:\"component\",attrs:{\"screen\":_vm.game.screen}}):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './App.vue'\nimport BootstrapVue from 'bootstrap-vue'\n\nVue.use(BootstrapVue)\n\nimport './application.scss'\n\nimport 'bootstrap/dist/css/bootstrap.css'\nimport 'bootstrap-vue/dist/bootstrap-vue.css'\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n"],"sourceRoot":""}