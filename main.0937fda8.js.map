{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/engine/events/internal.ts","webpack:///./src/onisun.ts","webpack:///./src/engine/utils/utils.ts","webpack:///./src/engine/models/tile.ts","webpack:///./src/engine/presenters/internal.ts","webpack:///./src/engine/lib/calculator.ts","webpack:///./src/engine/models/item.ts","webpack:///./src/engine/lib/material.ts","webpack:///./src/engine/ai/internal.ts","webpack:///./src/engine/models/inventory_slot.ts","webpack:///./src/engine/events/move_event.ts","webpack:///./src/engine/events/die_event.ts","webpack:///./src/engine/lib/map_fov.ts","webpack:///./src/engine/models/creature.ts","webpack:///./src/engine/presenters/character_info_presenter.ts","webpack:///./src/engine/events/hurt_event.ts","webpack:///./src/engine/lib/stat.ts","webpack:///./src/engine/events/visible_creature_event.ts","webpack:///./src/engine/events/stay_event.ts","webpack:///./src/engine/lib/damage.ts","webpack:///./src/engine/presenters/items_listing_presenter.ts","webpack:///./src/onisun/professions.ts","webpack:///./src/engine/ai/meta_ai.ts","webpack:///./src/engine/lib/bunch.ts","webpack:///./src/engine/events/remove_item_event.ts","webpack:///./src/engine/lib/post.ts","webpack:///./src/engine/models/specie.ts","webpack:///./src/onisun/races.ts","webpack:///./src/engine/lib/impact.ts","webpack:///./src/engine/events/after_event.ts","webpack:///./src/engine/ai/player_ai.ts","webpack:///./src/engine/events/add_experience_event.ts","webpack:///./src/engine/events/add_impact_event.ts","webpack:///./src/engine/events/take_off_item_event.ts","webpack:///./src/engine/events/trap_event.ts","webpack:///./src/engine/presenters/equipment_presenter.ts","webpack:///./src/engine/presenters/pick_point_presenter.ts","webpack:///./src/onisun/ai.ts","webpack:///./src/engine/lib/timeline.ts","webpack:///./src/onisun/talents.ts","webpack:///./src/engine/utils/fov.ts","webpack:///./src/engine/lib/attribute.ts","webpack:///./src/engine/ai/loiter.ts","webpack:///./src/engine/presenters/death_presenter.ts","webpack:///./src/engine/events/drop_items_event.ts","webpack:///./src/engine/events/level_up_event.ts","webpack:///./src/engine/models/tile_effect.ts","webpack:///./src/engine/events/throw_event.ts","webpack:///./src/engine/events/open_door_event.ts","webpack:///./src/engine/events/pick_talent_event.ts","webpack:///./src/engine/models/profession.ts","webpack:///./src/engine/events/water_damage_event.ts","webpack:///./src/engine/models/level_map.ts","webpack:///./src/engine/models/logger.ts","webpack:///./src/engine/utils/kill_stat.ts","webpack:///./src/engine/models/traps/air_blow_trap.ts","webpack:///./src/engine/models/traps/bare_wire_trap.ts","webpack:///./src/engine/models/traps/falling_rock_trap.ts","webpack:///./src/engine/models/traps/hole_trap.ts","webpack:///./src/engine/models/traps/light_trap.ts","webpack:///./src/engine/models/traps/teleportation_trap.ts","webpack:///./src/engine/models/traps/water_trap.ts","webpack:///./src/engine/presenters/pick_single_option_presenter.ts","webpack:///./src/engine/presenters/talents_picking_presenter.ts","webpack:///./src/engine/presenters/talents_presenter.ts","webpack:///./src/onisun/items.ts","webpack:///./src/onisun/potions.ts","webpack:///./src/engine/presenters/missile_presenter.ts","webpack:///./src/engine/presenters/idle_presenter.ts","webpack:///./src/onisun/creatures.ts","webpack:///./src/onisun/dungeons/title_dungeon.ts","webpack:///./src/engine/ai/attacker.ts","webpack:///./src/engine/ai/chaser.ts","webpack:///./src/engine/ai/descender.ts","webpack:///./src/engine/ai/escaper.ts","webpack:///./src/engine/ai/explorer.ts","webpack:///./src/engine/ai/patrol.ts","webpack:///./src/engine/ai/picker.ts","webpack:///./src/engine/ai/selfhealer.ts","webpack:///./src/engine/ai/thrower.ts","webpack:///./src/engine/events/attack_event.ts","webpack:///./src/engine/events/close_door_event.ts","webpack:///./src/engine/events/drink_potion_event.ts","webpack:///./src/engine/events/missile_attack_event.ts","webpack:///./src/engine/events/pick_up_items_event.ts","webpack:///./src/engine/events/pick_profession_event.ts","webpack:///./src/engine/events/put_on_item_event.ts","webpack:///./src/engine/events/remove_impact_event.ts","webpack:///./src/engine/events/teleportation_event.ts","webpack:///./src/engine/events/untrap_event.ts","webpack:///./src/engine/generator/dungeon.ts","webpack:///./src/engine/lib/gender.ts","webpack:///./src/engine/lib/level.ts","webpack:///./src/engine/lib/pool.ts","webpack:///./src/engine/models/dungeon.ts","webpack:///./src/engine/models/game.ts","webpack:///./src/engine/models/inventory.ts","webpack:///./src/engine/models/memory.ts","webpack:///./src/engine/models/player.ts","webpack:///./src/engine/presenters/bag_presenter.ts","webpack:///./src/engine/presenters/base_info_presenter.ts","webpack:///./src/engine/presenters/drink_presenter.ts","webpack:///./src/engine/presenters/drop_items_presenter.ts","webpack:///./src/engine/presenters/history_info_presenter.ts","webpack:///./src/engine/presenters/look_presenter.ts","webpack:///./src/engine/presenters/pick_up_presenter.ts","webpack:///./src/engine/presenters/profession_picking_presenter.ts","webpack:///./src/engine/presenters/put_on_items_presenter.ts","webpack:///./src/engine/presenters/teleportation_presenter.ts","webpack:///./src/engine/utils/lee_path.ts","webpack:///./src/engine/utils/randomize_attributes.ts","webpack:///./src/onisun/menus.ts","webpack:///./components/MenuOption.vue?e569","webpack:///./components/Menu/AttributesSelectionMenu.vue?3287","webpack:///./components/Menu/ChooseProfessionMenu.vue?98f5","webpack:///./components/PlayerBackground.vue?e963","webpack:///./components/views/CharacterInfoPages/TalentsPage.vue?d8b2","webpack:///./components/Logger.vue?b5cd","webpack:///./components/Scene.vue?bf04","webpack:///./components/Stats.vue?4878","webpack:///./components/Impacts.vue?9a34","webpack:///./components/views/ProfessionPickingView.vue?7066","webpack:///./components/views/ItemsListingView.vue?a6a8","webpack:///./components/views/PickPointView.vue?495e","webpack:///./components/views/DeathView.vue?7f85","webpack:///./components/views/PickSingleOptionView.vue?1f3a","webpack:///./components/views/CharacterInfoPages/BasePage.vue?4c57","webpack:///./components/views/CharacterInfoPages/EquipmentPage.vue?c89e","webpack:///./components/views/CharacterInfoPages/HistoryInfoPage.vue?74b4","webpack:///./components/views/CharacterInfoView.vue?6dcf","webpack:///./components/Game.vue?aa89","webpack:///./components/Main.vue?8f15","webpack:///./components/MenuOption.vue?e62d","webpack:///./components/MenuOption.vue?9763","webpack:///./components/MenuOption.vue","webpack:///./components/MenuOption.vue?298d","webpack:///./components/Menu/AttributesSelectionMenu.vue?4ec3","webpack:///./components/Menu/AttributesSelectionMenu.vue?7dde","webpack:///./components/Menu/AttributesSelectionMenu.vue","webpack:///./components/Menu/AttributesSelectionMenu.vue?1fb9","webpack:///./components/Menu/ChooseGenderMenu.vue?aad4","webpack:///./components/Menu/ChooseGenderMenu.vue?a1f5","webpack:///./components/Menu/ChooseGenderMenu.vue","webpack:///./components/Menu/ChooseGenderMenu.vue?b0b7","webpack:///./components/Menu/ChooseProfessionMenu.vue?86ef","webpack:///./components/Menu/ChooseProfessionMenu.vue?c37b","webpack:///./components/Menu/ChooseProfessionMenu.vue","webpack:///./components/Menu/ChooseProfessionMenu.vue?fa87","webpack:///./components/Menu/ChooseRaceMenu.vue?fe02","webpack:///./components/Menu/ChooseRaceMenu.vue?e131","webpack:///./components/Menu/ChooseRaceMenu.vue","webpack:///./components/Menu/ChooseRaceMenu.vue?21ee","webpack:///./components/Menu/EnterNameMenu.vue?a411","webpack:///./components/Menu/EnterNameMenu.vue?6f51","webpack:///./components/Menu/EnterNameMenu.vue","webpack:///./components/Menu/EnterNameMenu.vue?36d7","webpack:///./components/PlayerBackground.vue?b2cd","webpack:///./components/PlayerBackground.vue?038a","webpack:///./components/PlayerBackground.vue","webpack:///./components/PlayerBackground.vue?5b83","webpack:///./components/Menu/BackgroundMenu.vue?d3d7","webpack:///./components/Menu/BackgroundMenu.vue?9b41","webpack:///./components/Menu/BackgroundMenu.vue","webpack:///./components/Menu/BackgroundMenu.vue?3166","webpack:///./components/Menu/MainMenu.vue?6332","webpack:///./components/Menu/MainMenu.vue?a8b7","webpack:///./components/Menu/MainMenu.vue","webpack:///./components/Menu/MainMenu.vue?cad7","webpack:///./components/views/CharacterInfoPages/TalentsPage.vue?c573","webpack:///./components/views/CharacterInfoPages/TalentsPage.vue?0a50","webpack:///./components/views/CharacterInfoPages/TalentsPage.vue","webpack:///./components/views/CharacterInfoPages/TalentsPage.vue?b91e","webpack:///./components/Menu/PickTalentsMenu.vue?0974","webpack:///./components/Menu/PickTalentsMenu.vue?5c28","webpack:///./components/Menu/PickTalentsMenu.vue","webpack:///./components/Menu/PickTalentsMenu.vue?c81c","webpack:///./components/Logger.vue?93db","webpack:///./components/Logger.vue?dfa9","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?f046","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/Scene.vue?a309","webpack:///./components/Scene.vue?972d","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?8979","webpack:///./components/PrimaryAttribute.vue?99e7","webpack:///./components/PrimaryAttribute.vue?fa93","webpack:///./components/PrimaryAttribute.vue","webpack:///./components/PrimaryAttribute.vue?8818","webpack:///./components/shows.ts","webpack:///./components/Stats.vue?772b","webpack:///./components/Stats.vue?2674","webpack:///./components/Stats.vue","webpack:///./components/Stats.vue?53d8","webpack:///./components/Impacts.vue?11e4","webpack:///./components/Impacts.vue?fd8b","webpack:///./components/Impacts.vue","webpack:///./components/Impacts.vue?27df","webpack:///./components/views/IdleView.vue?bc3e","webpack:///./components/views/IdleView.vue?d3da","webpack:///./components/views/IdleView.vue","webpack:///./components/views/IdleView.vue?91d8","webpack:///./components/views/ProfessionPickingView.vue?69ea","webpack:///./components/views/ProfessionPickingView.vue?b4ad","webpack:///./components/views/ProfessionPickingView.vue","webpack:///./components/views/ProfessionPickingView.vue?5ba2","webpack:///./components/views/ItemsListingView.vue?4aeb","webpack:///./components/views/ItemsListingView.vue?a2d9","webpack:///./components/views/ItemsListingView.vue","webpack:///./components/views/ItemsListingView.vue?e6aa","webpack:///./components/views/TalentsPickingView.vue?4f12","webpack:///./components/views/TalentsPickingView.vue?d0b8","webpack:///./components/views/TalentsPickingView.vue","webpack:///./components/views/TalentsPickingView.vue?21fb","webpack:///./components/views/PickPointView.vue?b03e","webpack:///./components/views/PickPointView.vue?fca0","webpack:///./components/views/PickPointView.vue","webpack:///./components/views/PickPointView.vue?4338","webpack:///./components/views/MissileView.vue?1488","webpack:///./components/views/MissileView.vue?2e63","webpack:///./components/views/MissileView.vue","webpack:///./components/views/MissileView.vue?ebb5","webpack:///./components/views/DeathView.vue?a86c","webpack:///./components/views/DeathView.vue?9ad1","webpack:///./components/views/DeathView.vue","webpack:///./components/views/DeathView.vue?0102","webpack:///./components/views/PickSingleOptionView.vue?a8e8","webpack:///./components/views/PickSingleOptionView.vue?f2a3","webpack:///./components/views/PickSingleOptionView.vue","webpack:///./components/views/PickSingleOptionView.vue?53c3","webpack:///./components/views/CharacterInfoPages/BasePage.vue?8f78","webpack:///./components/views/CharacterInfoPages/BasePage.vue?74b2","webpack:///./components/views/CharacterInfoPages/BasePage.vue","webpack:///./components/views/CharacterInfoPages/BasePage.vue?8d4f","webpack:///./components/views/CharacterInfoPages/EquipmentPage.vue?e9be","webpack:///./components/views/CharacterInfoPages/EquipmentPage.vue?f618","webpack:///./components/views/CharacterInfoPages/EquipmentPage.vue","webpack:///./components/views/CharacterInfoPages/EquipmentPage.vue?ac56","webpack:///./components/views/CharacterInfoPages/HistoryInfoPage.vue?5905","webpack:///./components/views/CharacterInfoPages/HistoryInfoPage.vue?88c5","webpack:///./components/views/CharacterInfoPages/HistoryInfoPage.vue","webpack:///./components/views/CharacterInfoPages/HistoryInfoPage.vue?9e31","webpack:///./components/views/CharacterInfoView.vue?92be","webpack:///./components/views/CharacterInfoView.vue?fe98","webpack:///./components/views/CharacterInfoView.vue","webpack:///./components/views/CharacterInfoView.vue?dec7","webpack:///./components/Game.vue?bbb5","webpack:///./components/Game.vue?a55b","webpack:///./components/Game.vue","webpack:///./components/Game.vue?2573","webpack:///./components/Main.vue?4b63","webpack:///./components/Main.vue?db11","webpack:///./components/Main.vue","webpack:///./components/Main.vue?5012","webpack:///./components/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Reaction","PlayerEvent","CreatureEvent","[object Object]","subject","this","affectCreature","critical","chance","multiplier","Onisun","_engine__WEBPACK_IMPORTED_MODULE_2__","player","super","_onisun_professions__WEBPACK_IMPORTED_MODULE_5__","dungeon","_onisun_dungeons_title_dungeon__WEBPACK_IMPORTED_MODULE_4__","register","enter","TitleGame","turn","currentMap","playerTurn","ai","endTurn","done","dead","turns","Application","menu","mainGame","initGame","randomPlayer","gender","race","profession","attributes","parentsProfession","buildLevels","clan","Player","abilities","leavesCorpseRatio","ownProfession","weight","protections","damages","type","Pure","dice","times","max","extra","maxHealthValue","regenerationRate","regenerationValue","resistances","visionRadius","moveSpeed","attackSpeed","bodyControl","material","flesh","throwingDamages","eyeColor","Aqua","hairColor","Fuchsia","skinColor","Purple","height","on","lodash__WEBPACK_IMPORTED_MODULE_1__","jquery__WEBPACK_IMPORTED_MODULE_0__","x","acc","v","map","val","Math","floor","experienceRatio","newPlayer","Male","_onisun_races__WEBPACK_IMPORTED_MODULE_6__","primaryAttributes","_onisun_ai__WEBPACK_IMPORTED_MODULE_3__","game","Rect","y","w","h","rand","random","twoDimArray","width","field","Array","Point","point","abs","dxy","add","Mapped","forEach","column","tile","cycle","list","dx","pop","unshift","bresenham","p0","p1","x0","x1","y0","y1","steps","delta","round","bresenhamInclusion","Direction","ratio","up","down","left","right","upLeft","upRight","downLeft","downRight","all","minUnsafe","elem","lodash__WEBPACK_IMPORTED_MODULE_0__","undefined","TileTypes","TrapType","Tile","kind","item","count","items","_lib_bunch__WEBPACK_IMPORTED_MODULE_0__","put","creature","isFloor","passibleThrough","Floor","actor","Wall","id","from","buildNew","clone","tileVisitor","onFloor","Corridor","Room","Door","open","onDoor","onWall","Stairway","adjacentMapName","levelMap","adjacentMap","_enterPos","matchStairs","StairwayDown","onStairwayDown","StairwayUp","onStairwayUp","Trap","revealed","onTrap","logger","succeededToUntrap","setTile","TileVisitor","wall","default","stairway","onStairway","door","trigger","trap","PresenterType","Presenter","creatureTile","presenter","redirect","_engine__WEBPACK_IMPORTED_MODULE_0__","BaseMenusPresenter","Calculator","attackerBC","victimBC","pow","min","lowerWeight","hit","of","actorBC","atan","PI","protectionTypes","victimResistances","every","resistTo","damage","resist","dropDice","protectionValue","damageType","_engine__WEBPACK_IMPORTED_MODULE_1__","Melee","Pierce","Blunt","_models_specie__WEBPACK_IMPORTED_MODULE_2__","Intangible","Magic","MagicDamage","armorToDamageRatio","armorType","Medium","Solid","Light","Unarmored","Heavy","Usage","ItemGroup","ItemSubgroup","CorrosionLevel","ProtectionType","Item","group","usages","getId","impacts","corrosionLevel","None","lastId","Slightly","Mostly","Fully","affectedWithWater","firm","insulator","canSeeDetails","Corpse","specie","Consumable","Potion","_lib_material__WEBPACK_IMPORTED_MODULE_0__","glass","Weapon","rawDamages","damageWithCorrosion","penalty","Missile","MissileWeapon","Shoot","OneHandWeapon","WeaponOneHand","Armor","rawProtections","usage","protectionWithCorrosion","BodyArmor","WearsOnBody","Boots","WaterAffect","Material","cloth","fragile","iron","Corrosion","leather","paper","Destroy","stone","wood","AI","destination","move","eq","dest","buildPath","_events_move_event__WEBPACK_IMPORTED_MODULE_2__","_engine__WEBPACK_IMPORTED_MODULE_3__","stageMemory","creaturePos","tangible","pos","visit","tileVisited","_utils_utils__WEBPACK_IMPORTED_MODULE_0__","pointsToCheck","wavePoints","inRange","at","visible","wrappers","dist","enemy","_models_creature__WEBPACK_IMPORTED_MODULE_1__","FreeForAll","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","checkCurrentTile","event","goTo","onCantMove","moveTo","onReach","GoToTileAI","matcher","path","InventorySlot","useSingleItem","equipment","inventory","cares","filter","itemGroup","match","baseMatch","groupedItem","worksWith","BodyPart","RightHandSlot","_item__WEBPACK_IMPORTED_MODULE_0__","LeftHandSlot","HeadSlot","WearsOnHead","ChestSlot","BootsSlot","GlovesSlot","Gloves","GauntletsSlot","Gauntlets","BeltSlot","Belt","AmuletSlot","Amulet","LeftFingerSlot","Ring","RightFingerSlot","CloakSlot","Cloak","MissileWeaponSlot","matchingItems","missile","missileSlot","withPairItem","MissileSlot","Throw","missileWeapon","missileWeaponSlot","ToolsSlot","Tool","SteppingTileVisitor","_models_tile__WEBPACK_IMPORTED_MODULE_1__","reaction","NOTHING","activate","MoveEvent","_internal__WEBPACK_IMPORTED_MODULE_0__","nextPoint","nextLevel","removeCreature","addCreature","visitor","reset","DieReason","DieEvent","reason","addItem","_models_item__WEBPACK_IMPORTED_MODULE_1__","inventoryItems","invItem","DIE","pushEvent","_ai_player_ai__WEBPACK_IMPORTED_MODULE_2__","buildFov","radius","memory","fov","stage","visibleThrough","degree","see","calc","Clan","Ability","creature_Creature","stageMemories","Map","health","stat","throwDamages","ability","lodash","speed","visionMask","resetVisible","engine","set","impactsBunch","_impactsBunch","effect","addConstImpact","addImpact","removeConstImpact","removeImpact","hasImpact","impact","Blind","activeImpacts","resistance","weightWithCarryings","creature_AICreature","statsTurn","command","act","after_event","throwingItem","bag","bunch","remove","CharacterInfoPage","CharacterInfoPresenter","CharacterInfo","HurtEvent","dieReason","doneDamage","_lib_calculator__WEBPACK_IMPORTED_MODULE_2__","RESIST","currentValue","_die_event__WEBPACK_IMPORTED_MODULE_1__","decrease","HURT","Stat","base","rate","current","CapacityLimitStat","strength","constitution","strengthRatio","constitutionRatio","stressed","loadedStart","overloadedStart","flattenedStart","HealthStat","_attribute__WEBPACK_IMPORTED_MODULE_0__","currentTurn","increase","StrengthStat","meleeAdjustment","ConstitutionStat","levelUpHPBonus","DexterityStat","bodyControlAdjustment","missileAdjustment","VisibleCreatureEvent","StayEvent","DamageType","ItemsListingPresenter","positions","initPositions","ItemsListing","goIdle","SingleItemUseListingPresenter","singleItemMode","MultipleItemUseListingPresenter","OnisunProfessionId","OnisunAttackerProfession","level","strongGrip","_talents__WEBPACK_IMPORTED_MODULE_1__","Attacker","depthCost","grid","OnisunDefenderProfession","steelSkin","Defender","OnisunProfessionPicker","attacker","defender","AIEvent","AIItemPickedEvent","MetaAI","aiToRun","events","res","run","resetEvents","ItemsBunch","find","groupsWith","inventoryItem","inv","RemoveItemEvent","slot","_take_off_item_event__WEBPACK_IMPORTED_MODULE_1__","addDoors","doorTile","addDoor","addCreatures","creaturesPool","pick","centralize","minX","minY","maxX","maxY","dy","row","withMatchingTile","onValid","iters","safeWithMatchingTile","withEachTile","each","Resistance","Color","humanRace","dexterity","intelligence","wisdom","charisma","dwarfRace","allRaces","ImpactType","Impact","constEffects","tempEffects","ImpactBunch","types","active","impactByType","addTempEffect","removeTempEffect","addConstEffect","removeConstEffect","AfterEvent","_internal__WEBPACK_IMPORTED_MODULE_1__","Overloaded","Stressed","Loaded","stuffWeight","carryingCapacity","AINewLevelEvent","_meta_ai__WEBPACK_IMPORTED_MODULE_2__","AIDieEvent","rebuildVision","_presenters_death_presenter__WEBPACK_IMPORTED_MODULE_1__","AITeleportationEvent","PlayerAI","levelUps","runEvents","PlayerBorgAI","AddExperienceEvent","AddImpactEvent","impactType","source","duration","TakeOffItemEvent","takeOff","onTakeOff","putToBag","itemProtection","itemsProtections","protection","TrapEvent","_visible_creature_event__WEBPACK_IMPORTED_MODULE_0__","onCreatureDodge","onCreatureActivated","dodgeRatio","sees","playerSees","dodges","_internal__WEBPACK_IMPORTED_MODULE_2__","DODGE","_lib_calculator__WEBPACK_IMPORTED_MODULE_1__","EquipmentPresenter","_character_info_presenter__WEBPACK_IMPORTED_MODULE_2__","takeTime","rebuildPositions","page","Equipment","position","inventorySlot","availableItems","_idle_presenter__WEBPACK_IMPORTED_MODULE_1__","slots","PickPointPresenter","targetPos","drawTarget","removeEffect","close","memoryTile","direction","updateTarget","newPos","copy","Dispatcher","escaper","explorer","chaser","picker","patrol","loiter","thrower","descender","feelsGood","explore","healthCritical","maximum","trackMovement","Timeline","step","ts","element","nextStep","next","actors","parseInt","OnisunTalent","depth","rank","maxRank","AttackerStrongGrip","DefenderSteelSkin","Fov","startx","starty","solidChecker","markVisible","doubleRadius","isSolid","castLight","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","Attribute","modifiers","atMax","modifier","Loiter","DeathPresenter","Death","playerName","DropItemsEvent","removeItem","subtract","droppedItem","LevelUpEvent","updateHealth","constantIncrease","TileEffect","onDone","ItemFlightTileEffect","frames","patchMemory","ThrowEvent","_internal__WEBPACK_IMPORTED_MODULE_4__","victim","process","_add_experience_event__WEBPACK_IMPORTED_MODULE_2__","isPlayer","throw","attackLogger","misses","hurtEvent","withCritical","_die_event__WEBPACK_IMPORTED_MODULE_3__","OpenDoorEvent","_visible_creature_event__WEBPACK_IMPORTED_MODULE_1__","doorLogger","alreadyOpen","PickTalentEvent","talent","status","_models_profession__WEBPACK_IMPORTED_MODULE_1__","Available","upgrade","points","TalentStatus","Talent","onObtain","Completed","Unavailable","Profession","talents","ProfessionPicker","pool","maxLevel","maxTaken","pickedProfession","professions","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","some","excludeId","excluding","WaterDamageEvent","playerReaction","_hurt_event__WEBPACK_IMPORTED_MODULE_3__","_die_event__WEBPACK_IMPORTED_MODULE_2__","affectBodyParts","affectInventory","affectEquipment","_lib_material__WEBPACK_IMPORTED_MODULE_1__","_lib_calculator__WEBPACK_IMPORTED_MODULE_0__","corrode","itemCorrode","destroyedCount","itemDestroyByWater","_remove_item_event__WEBPACK_IMPORTED_MODULE_5__","removeFromBag","bodyParts","bodyPart","waterBodyPartEquipmentResist","trackReaction","waterBodyPartDamage","LevelMap","creatures","timeline","_lib_timeline__WEBPACK_IMPORTED_MODULE_1__","lodash__WEBPACK_IMPORTED_MODULE_3__","adjustName","stairPos","_tile__WEBPACK_IMPORTED_MODULE_2__","LogLevel","Logger","messages","AttackLogger","DoorLogger","trapAirBlow","TrapAirBlowLogger","trapBareWire","TrapBareWireLogger","trapFallingRock","TrapFallingRockLogger","trapHole","TrapHoleLogger","target","warning","addMessage","DEBUG","INFO","WARNING","info","debug","danger","message","DANGER","lastRow","counter","SubLogger","KillStat","total","AirBlowTrap","_tile__WEBPACK_IMPORTED_MODULE_0__","AirBlow","failedToUntrap","disarmTile","creatureWeightBlowThreshold","_events_trap_event__WEBPACK_IMPORTED_MODULE_3__","dodge","randomPos","higherWeight","_events_move_event__WEBPACK_IMPORTED_MODULE_6__","headSlot","headBlow","rightHandSlot","handBlow","leftHandSlot","maxChance","throwItem","_events_remove_item_event__WEBPACK_IMPORTED_MODULE_4__","_engine__WEBPACK_IMPORTED_MODULE_7__","origin","maxDistance","lastPos","foundPos","lodash__WEBPACK_IMPORTED_MODULE_5__","_utils_utils__WEBPACK_IMPORTED_MODULE_1__","brokenLos","multiple","BareWireTrapEvent","_events_visible_creature_event__WEBPACK_IMPORTED_MODULE_5__","_events_hurt_event__WEBPACK_IMPORTED_MODULE_2__","_events_die_event__WEBPACK_IMPORTED_MODULE_3__","_lib_damage__WEBPACK_IMPORTED_MODULE_4__","hurtReaction","activated","bootsSlot","_events_internal__WEBPACK_IMPORTED_MODULE_6__","BareWireTrap","BareWire","glovesSlot","doNotWant","FallingRockTrap","newRock","missilesCount","FallingRock","throwMissile","ranOut","HoleTrap","_tile__WEBPACK_IMPORTED_MODULE_3__","Hole","canNotUntrap","fallEvent","_events_hurt_event__WEBPACK_IMPORTED_MODULE_4__","_lib_damage__WEBPACK_IMPORTED_MODULE_5__","_events_die_event__WEBPACK_IMPORTED_MODULE_6__","shallowActivated","_events_stay_event__WEBPACK_IMPORTED_MODULE_2__","downLevelMap","getMap","downPos","_events_move_event__WEBPACK_IMPORTED_MODULE_1__","LightTrap","_lib_calculator__WEBPACK_IMPORTED_MODULE_4__","_events_trap_event__WEBPACK_IMPORTED_MODULE_1__","lightTrapDodge","_lib_impact__WEBPACK_IMPORTED_MODULE_3__","_engine__WEBPACK_IMPORTED_MODULE_5__","lightTrapActivated","_events_add_impact_event__WEBPACK_IMPORTED_MODULE_2__","TeleportationTrap","_tile__WEBPACK_IMPORTED_MODULE_1__","Teleportation","playerDodgesTeleportationTrap","creatureDodgesTeleportationTrap","WaterTrap","Water","_lib_damage__WEBPACK_IMPORTED_MODULE_2__","waterTrapDamage","waterTrapActivated","_events_water_damage_event__WEBPACK_IMPORTED_MODULE_3__","PickSingleOptionPresenter","options","withOption","PickHandleOption","option","TalentsPickingPresenter","talentsPage","_talents_presenter__WEBPACK_IMPORTED_MODULE_2__","TalentsPicking","_events_pick_talent_event__WEBPACK_IMPORTED_MODULE_3__","_events_level_up_event__WEBPACK_IMPORTED_MODULE_1__","TalentsPresenter","_character_info_presenter__WEBPACK_IMPORTED_MODULE_0__","Talents","items_MissileRock","items_Sling","smallRock","missile_presenter_MissilePresenter","internal","targetEnemyIndex","enemies","findEnemies","resetTargetId","resetPath","idle_presenter_IdlePresenter","drawPath","stop","utils","idle_presenter_HandleTileVisitor","commands","move_event","enterPos","idle_presenter_AdjustHandleTileVisitor","open_door_event","Idle","equipment_presenter","stay_event","ranIntoAnObstacle","noItemsToPickUp","canThrow","needMissileWeapon","nothingToShotWith","adjustVisitor","howToHandle","pick_single_option_presenter","newCreature","creaturesPool1","titleId","config","minSize","maxSize","roomsCount","addTraps","tiles","traps","air_blow_trap","bare_wire_trap","falling_rock_trap","hole_trap","light_trap","teleportation_trap","water_trap","title_dungeon_TitleDungeon","addMap","generateMap","post","firstTurn","canAttack","victimInAccess","pickNewVictim","findCreature","condition","Chaser","victimSet","buildVictimPath","foundNewVictim","victimId","followTo","withinView","nextTo","StairwayDownFinderVisitor","StairwayDownTileMoverVisitor","Descender","can","GoStairway","STEP_DISTANCE","Escaper","escapesFrom","foundEnemies","buildEscapePath","minDistance","Explorer","seen","NEW_POINT_EVERY","PatrolTileVisitor","_models_tile__WEBPACK_IMPORTED_MODULE_3__","Patrol","firstCallPatrol","graph","graphlib__WEBPACK_IMPORTED_MODULE_1__","lastNodeVisit","currentNodeID","markNodeVisited","nodes","addNode","moveToTarget","targetNodeID","pickUpNewTarget","setNode","setEdge","newNodeId","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","_events_move_event__WEBPACK_IMPORTED_MODULE_4__","_loiter__WEBPACK_IMPORTED_MODULE_2__","String","fromCharCode","charCodeAt","Picker","Inventory","_meta_ai__WEBPACK_IMPORTED_MODULE_3__","SelfHealer","_events_stay_event__WEBPACK_IMPORTED_MODULE_1__","Thrower","Throwing","hasMissile","_utils_utils__WEBPACK_IMPORTED_MODULE_2__","_events_internal__WEBPACK_IMPORTED_MODULE_4__","previousVictim","missiles","findWithId","obstacles","AttackEvent","_add_experience_event__WEBPACK_IMPORTED_MODULE_1__","melee","_die_event__WEBPACK_IMPORTED_MODULE_4__","Attack","CloseDoorEvent","alreadyClosed","DrinkPotionEvent","potion","onDrink","drink","MissileAttackEvent","withMissile","_remove_item_event__WEBPACK_IMPORTED_MODULE_3__","flightPath","_models_tile_effect__WEBPACK_IMPORTED_MODULE_1__","_throw_event__WEBPACK_IMPORTED_MODULE_2__","PickUpItemsEvent","tileItems","withTileItems","pickedUpItem","PickProfessionEvent","playerProfession","PutOnItemEvent","groupItem","findInBag","equip","onPutOn","putOn","_models_item__WEBPACK_IMPORTED_MODULE_2__","concat","_add_impact_event__WEBPACK_IMPORTED_MODULE_3__","RemoveImpactEvent","TeleportationEvent","selfCast","hasResistance","_models_specie__WEBPACK_IMPORTED_MODULE_4__","TeleportationControl","teleport","creatureNotTeleported","creatureTeleported","_internal__WEBPACK_IMPORTED_MODULE_6__","playerTeleportationCaused","_ai_player_ai__WEBPACK_IMPORTED_MODULE_5__","playerTeleported","playerNotTeleported","teleported","_lib_post__WEBPACK_IMPORTED_MODULE_1__","free","_move_event__WEBPACK_IMPORTED_MODULE_2__","_utils_utils__WEBPACK_IMPORTED_MODULE_3__","_a","UntrapEvent","trapPosition","untrap","THICKNESS","RAY_TURNS","DELTA_ANGLE","rect","walls","newRoomSpace","Road","lined","newCorridor","hx","hy","horizontalLine","vx","vy","verticalLine","__webpack_exports__","dimX","dimY","newWall","rooms","fill","_","generateRoom","normalize","ray","roads","buildRoads","reduce","pickedRooms","currentRoom","angle","cos","sin","roomToMove","ndx","ndy","room","notCross","pointWithin","firstPoint","connectedPoints","point1","point2","maybePoint","currentPoint","pointToConnect","currentDistance","Gender","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","levelUp","Pool","totalWeight","ceil","input","found","totalPool","Dungeon","levels","adjustMapName","addStairs","_lib_post__WEBPACK_IMPORTED_MODULE_0__","Game","professionPicker","running","maps","_logger__WEBPACK_IMPORTED_MODULE_1__","mutexTurn","levelMapTurn","_level_map__WEBPACK_IMPORTED_MODULE_0__","Function","builtLevelMap","generator","has","actorId","_lib_bunch__WEBPACK_IMPORTED_MODULE_1__","_inventory_slot__WEBPACK_IMPORTED_MODULE_0__","_lib_material__WEBPACK_IMPORTED_MODULE_3__","amuletSlot","cloakSlot","chestSlot","leftFingerSlot","rightFingerSlot","gauntletsSlot","beltSlot","toolsSlot","allItems","lodash__WEBPACK_IMPORTED_MODULE_2__","unarmoredSlotsCount","MemoryTile","Memory","baseTile","_creature__WEBPACK_IMPORTED_MODULE_5__","itemsResistances","killStat","_utils_kill_stat__WEBPACK_IMPORTED_MODULE_6__","_lib_stat__WEBPACK_IMPORTED_MODULE_3__","_events_after_event__WEBPACK_IMPORTED_MODULE_2__","affectPlayer","dexterityAdjustment","missileItemsDamages","dmg","strengthAdjustment","meleeItemsDamages","_item__WEBPACK_IMPORTED_MODULE_4__","rightHandEq","leftHandEq","missileEq","missileWeaponEq","BagPresenter","_items_listing_presenter__WEBPACK_IMPORTED_MODULE_0__","title","BaseInfoPresenter","Base","currentLevel","DrinkPresenter","_items_listing_presenter__WEBPACK_IMPORTED_MODULE_2__","DropItemsPresenter","_events_drop_items_event__WEBPACK_IMPORTED_MODULE_1__","HistoryInfoPresenter","History","LookPresenterVisibility","LookPresenter","_pick_point_presenter__WEBPACK_IMPORTED_MODULE_2__","Look","See","Recall","Hidden","body","PickUpPresenter","ProfessionPickingPresenter","available","ProfessionPicking","_talents_picking_presenter__WEBPACK_IMPORTED_MODULE_1__","PutOnItemsPresenter","onWithItem","_equipment_presenter__WEBPACK_IMPORTED_MODULE_1__","TeleportationPresenter","_pick_point_presenter__WEBPACK_IMPORTED_MODULE_1__","playerTeleportedWhereTheyWere","leePath","randomDestination","_utils__WEBPACK_IMPORTED_MODULE_0__","pointsToVisit","randomPointToVisit","buildRoad","lastPoint","chain","dp","randomizeAttributes","baseAttributes","randomAttribute","totalAttributes","availableAttributes","keys","deltaAttributes","attribute","MenuComponent","components_MenuOptionvue_type_script_lang_ts_","vue_runtime_esm","extend","props","component","componentNormalizer","_h","$createElement","_c","_self","staticClass","class","-separator","separator","_v","domProps","textContent","_s","char","__file","MenuOption","Menu_AttributesSelectionMenuvue_type_script_lang_ts_","needConfirmation","selectedAttributes","attributeNames","components","methods","onisun","ready","back","attributeModifier","toString","index","attributeName","totalAttribute","canIncrease","canDecrease","AttributesSelectionMenu_component","_vm","_f","_l","racialAttributes","genderAttributes","invisible","click","$event","attrs","AttributesSelectionMenu","Menu_ChooseGenderMenuvue_type_script_lang_ts_","toUpperCase","withGender","Female","ChooseGenderMenu_component","ChooseGenderMenu","Menu_ChooseProfessionMenuvue_type_script_lang_ts_","computed","withProfession","selectAt","iconPath","professionName","ChooseProfessionMenu_component","-picked","src","_e","ChooseProfessionMenu","Menu_ChooseRaceMenuvue_type_script_lang_ts_","withRace","ChooseRaceMenu_component","ChooseRaceMenu","Menu_EnterNameMenuvue_type_script_lang_ts_","withName","maxLength","EnterNameMenu_component","EnterNameMenu","components_PlayerBackgroundvue_type_script_lang_ts_","PlayerBackground_component","age","PlayerBackground","Menu_BackgroundMenuvue_type_script_lang_ts_","BackgroundMenu_component","BackgroundMenu","Menu_MainMenuvue_type_script_lang_ts_","newGame","MainMenu_component","MainMenu","CharacterInfoPages_TalentsPagevue_type_script_lang_ts_","picked","screen","nameToLetter","doubleClickTalent","pickedTalent","$emit","pickingEnabled","pickProfession","confirmPick","pickTalent","tip","TalentsPage_component","-active","talentPickedStatus","variant","dblclick","talentTip","triggers","container","req","TalentsPage","Menu_PickTalentsMenuvue_type_script_lang_ts_","$refs","talentsComponent","onEvent","PickTalentsMenu_component","ref","picking-enabled","PickTalentsMenu","components_Loggervue_type_script_lang_ts_","required","currentMessagesCount","record","Logger_component","rowClass","ch","g","b","br","bg","bb","grey","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","appendChild","charMap","charArray","defaultColors","attribs","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ClosedDoorTile","litColor","swapColors","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","MISSILE_WEAPON","BOOTS","SCROLL","POTION","displayItem","Scrolls","CLOSED_DOOR","OPEN_DOOR","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","NULL_TILE","AIR_BLOW_TRAP","TELEPORTATION_TRAP","LIGHT_TRAP","HOLE_TRAP","BARE_WIRE_TRAP","FALLING_ROCK_TRAP","WATER_TRAP","displayTileVisitor","HUMAN","RAT","GOLEM","Scenevue_type_script_lang_ts_NULL_TILE","nextItemAnimation","components_Scenevue_type_script_lang_ts_","wholeMap","term","eng","drawInterval","Date","now","interval","dTile","frame","animationFps","itemId","displayTile","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","update","lighted","fovTile","initViewport","watch","Scene_component","Scene","components_PrimaryAttributevue_type_script_lang_ts_","slug","attr","PrimaryAttribute_component","placement","fullName","PrimaryAttribute","showDamage","showDamageType","showProtection","components_Statsvue_type_script_lang_ts_","join","displayAttribute","Stats_component","levelProgress","role","healthLevel","full-name","Stats","components_Impactsvue_type_script_lang_ts_","Impacts_component","icon","Impacts","views_IdleViewvue_type_script_lang_ts_","handleCommand","lookCommand","stayCommand","inventoryCommand","bagCommand","missileCommand","pickUpCommand","dropCommand","drinkCommand","goToBaseInfo","goToInventory","goToTalents","goToHistoryInfo","console","log","IdleView_component","IdleView","views_ProfessionPickingViewvue_type_script_lang_ts_","doubleClickOption","ProfessionPickingView_component","ProfessionPickingView","views_ItemsListingViewvue_type_script_lang_ts_","perPage","selected","withItems","withItem","indexLetter","positionStatus","itemWeight","ItemsListingView_component","carryingWeight","positionSelected","ItemsListingView","views_TalentsPickingViewvue_type_script_lang_ts_","TalentsPickingView_component","TalentsPickingView","views_PickPointViewvue_type_script_lang_ts_","inputKey","onInput","moveTarget","PickPointView_component","PickPointView","views_MissileViewvue_type_script_lang_ts_","nextTarget","previousTarget","attack","MissileView_component","MissileView","views_DeathViewvue_type_script_lang_ts_","DeathView_component","signature","DeathView","views_PickSingleOptionViewvue_type_script_lang_ts_","pickUpItems","PickSingleOptionView_component","optionName","PickSingleOptionView","CharacterInfoPages_BasePagevue_type_script_lang_ts_","BasePage_component","BasePage","CharacterInfoPages_EquipmentPagevue_type_script_lang_ts_","showItemDetails","displayBodyPart","getChar","itemName","EquipmentPage_component","availableStatus","positionDetails","EquipmentPage","CharacterInfoPages_HistoryInfoPagevue_type_script_lang_ts_","HistoryInfoPage_component","HistoryInfoPage","views_CharacterInfoViewvue_type_script_lang_ts_","pageComponent","pages","CharacterInfoView_component","activeOption","tag","CharacterInfoView","components_Gamevue_type_script_lang_ts_","loopIntervalId","viewComponent","Game_component","level-map","components_Mainvue_type_script_lang_ts_","app","background","newTitleGame","TalentsMenu","gameComponent","loop","menuComponent","addEventListener","removeEventListener","Main_component","backgroundPos","menuPage","Main","use","es","fetch","cache","then","response","json","polyglot","node_polyglot_default","phrases","locale","prefix","suffix","args","el"],"mappings":"aACA,SAAAA,EAAAC,GAQA,IAPA,IAMAC,EAAAC,EANAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAIAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAKA,IAFAe,KAAAhB,GAEAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,GAAA,EACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,GAAA,GAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,GAAA,EACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,GAAA,EAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GAA0CI,YAAA,EAAAC,IAAAJ,KAK1CX,EAAAgB,EAAA,SAAAZ,GACA,oBAAAa,eAAAC,aACAlC,OAAA6B,eAAAT,EAAAa,OAAAC,aAAwDC,MAAA,WAExDnC,OAAA6B,eAAAT,EAAA,cAAiDe,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAvC,OAAAwC,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAvC,OAAA6B,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAS,EAAAc,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAtB,GACA,IAAAM,EAAAN,KAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAgB,EAAAC,GAAsD,OAAA7C,OAAAC,UAAAC,eAAAC,KAAAyC,EAAAC,IAGtD7B,EAAA8B,EAAA,WAEA,IAAAC,EAAAC,OAAA,aAAAA,OAAA,iBACAC,EAAAF,EAAAhD,KAAA2C,KAAAK,GACAA,EAAAhD,KAAAX,EACA2D,IAAAG,QACA,QAAAvD,EAAA,EAAgBA,EAAAoD,EAAAlD,OAAuBF,IAAAP,EAAA2D,EAAApD,IACvC,IAAAU,EAAA4C,EAIA1C,EAAAR,MAAA,QAEAU,+uUCnJA,IAAY0C,kGAAZ,SAAYA,GACVA,IAAA,aACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,qBACAA,IAAA,mBALF,CAAYA,iBAQUC,SAIAC,UAAsBD,EAEnCE,aAAaC,GAClB,OAAOC,KAAKC,eAAeF,67CCmB/B,MAAMG,GAAuBC,OAAQ,IAAMC,WAAY,SAE1CC,UAAeC,EAAA,KAC1BR,YAAYS,GACVC,MAAMD,EAAQ,IAAIE,EAAA,GAElB,MAAMC,EAAU,IAAIC,EAAA,EACpBD,EAAQE,SAASZ,MACjBU,EAAQG,MAAMb,KAAMO,UAIXO,UAAkBR,EAAA,KACtBR,OACLU,MAAMO,OAEFf,KAAKgB,YAAchB,KAAKiB,YAC1BjB,KAAKO,OAAOW,GAAGC,QAAQnB,KAAMA,KAAKgB,YAItCI,WACE,OAAOpB,KAAKO,OAAOc,MAAQrB,KAAKsB,MAAQ,WAI/BC,EAIXzB,cAHOE,KAAAwB,KAAoB,KACpBxB,KAAAyB,SAA0B,KAI/BzB,KAAK0B,SAAS1B,KAAK2B,aAAa,IAAIrB,EAAA,WAG/BR,SAASS,GACdP,KAAKyB,SAAW,IAAIpB,EAAOE,GAC3BP,KAAKwB,KAAO,KAGP1B,UACL8B,EACAC,EACAC,EACAC,EACA7D,EACA8D,EACAd,EAAe,IAAIZ,EAAA,UAEnB,IAAIC,EAAS,IAAID,EAAA,OACfN,KAAKiC,YAAYJ,GACjBX,GAEEhD,KAAMA,EACN2D,KAAMA,EACND,OAAQA,EACRM,KAAM5B,EAAA,KAAK6B,OACXC,aACAC,kBAAmB,EAEnBC,cAAeR,EACfE,kBAAmBA,EAInBO,OAAQ,GACRC,eACAC,UACIC,KAAMpC,EAAA,WAAWqC,KAAMC,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,IAE9DC,eAAgB,GAChBC,iBAAkB,EAClBC,kBAAmB,EACnBC,eACAC,aAAc,GACdC,UAAW,GACXC,YAAa,GACbC,YAAa,EACbC,SAAUlD,EAAA,SAASmD,MACnBC,mBAEAC,SAAUrD,EAAA,MAAMsD,KAChBC,UAAWvD,EAAA,MAAMwD,QACjBC,UAAWzD,EAAA,MAAM0D,OAEjBC,OAAQ,IACR/D,YAEF6B,GAMF,OAHAxB,EAAO2D,GAAG,IAAI5D,EAAA,oBAAoBwB,IAClCvB,EAAO2D,GAAG,IAAI5D,EAAA,oBAAoB0B,IAE3BzB,EAGDT,YAAY+B,GAClB,OAAO,IAAIvB,EAAA,MACT9D,OAAA2H,EAAA,KAAA3H,CACEA,OAAA2H,EAAA,OAAA3H,CACEA,OAAA4H,EAAA,IAAA5H,CACEA,OAAA2H,EAAA,KAAA3H,CAAKA,OAAA2H,EAAA,MAAA3H,CAAM,GAAIL,GAAMA,EAAI,EAAK,GAAiB,OAATA,EAAI,IAAW,GACrD,CAACkI,EAAGlI,IAAMkI,GAAKlI,EAAI,IAErB,CAACmI,EAAKC,KACJD,EAAI/H,MAAMC,OAAA2H,EAAA,KAAA3H,CAAK8H,IAAQ,GAAKC,GACrBD,IAER,IAEH,GACAE,IAAIC,GAAOC,KAAKC,MAAMF,EAAM5C,EAAK+C,mBAIhC9E,aAAaoB,GAClB,OAAOlB,KAAK6E,UACVvE,EAAA,OAAOwE,KACPC,EAAA,EACA,IAAItE,EAAA,EACJsE,EAAA,EAAUC,kBACV,KACA,IAAIvE,EAAA,EACJS,GAIGpB,eACL,IAAIS,EAASP,KAAK2B,aAAa,IAAIrB,EAAA,aAAa,IAAI2E,EAAA,IAClDC,EAAO,IAAIpE,EAAUP,EAAQ,IAAIE,EAAA,GACjCC,EAAU,IAAIC,EAAA,EAKhB,OAHAD,EAAQE,SAASsE,GACjBxE,EAAQG,MAAMqE,EAAM3E,GAEb2E,qXC3KEC,EACXrF,YACSuE,EACAe,EACAC,EACAC,GAEP,GALOtF,KAAAqE,IACArE,KAAAoF,IACApF,KAAAqF,IACArF,KAAAsF,IAEHD,GAAK,GAAKC,GAAK,EACjB,aAAcjB,KAAKe,KAAKC,KAAKC,8BAIjCxF,KAAKuE,EAAWe,GACdpF,KAAKqE,GAAKA,EACVrE,KAAKoF,GAAKA,GAIP,MAAMG,EAAO,SAASzC,GAC3B,OAAO4B,KAAKC,MAAMD,KAAKc,SAAW1C,IAGvB2C,EAAc,SACzBC,EACAzB,EACAtF,GAEA,IAAIgH,EAAQC,MAAMF,GAElB,IAAK,IAAIvJ,EAAI,EAAGA,EAAIuJ,EAAOvJ,IAAK,CAC9BwJ,EAAMxJ,GAAK,IAAIyJ,MAAM3B,GACrB,IAAK,IAAI5G,EAAI,EAAGA,EAAI4G,EAAQ5G,IAC1BsI,EAAMxJ,GAAGkB,GAAKsB,EAAMxC,EAAGkB,GAI3B,OAAOsI,SAGIE,EACX/F,YAAmBuE,EAAkBe,GAAlBpF,KAAAqE,IAAkBrE,KAAAoF,IAa9BtF,GAAGgG,GACR,OAAO9F,KAAKqE,IAAMyB,EAAMzB,GAAKrE,KAAKoF,IAAMU,EAAMV,EAGzCtF,OAAOgG,GACZ,OAAOpB,KAAKqB,IAAI/F,KAAKqE,EAAIyB,EAAMzB,IAAM,GAAKK,KAAKqB,IAAI/F,KAAKoF,EAAIU,EAAMV,IAAM,EAGnEtF,OACL,OAAO,IAAI+F,EAAM7F,KAAKqE,EAAGrE,KAAKoF,GAGzBtF,IAAIgG,GACT,OAAO,IAAID,EAAM7F,KAAKqE,EAAIyB,EAAMzB,EAAGrE,KAAKoF,EAAIU,EAAMV,GAG7CtF,WACL,OAAO+F,EAAMG,IAAIxB,IAAIsB,GAAS9F,KAAKiG,IAAIH,KA5BlBD,EAAAG,KACrB,IAAIH,GAAO,GAAI,GACf,IAAIA,EAAM,GAAI,GACd,IAAIA,EAAM,GAAI,GACd,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,EAAM,EAAG,UAwBKK,EAIpBpG,YAAmB0E,GAAAxE,KAAAwE,MACjBxE,KAAK0F,MAAQlB,EAAInI,OACjB2D,KAAKiE,OAASO,EAAI,GAAGnI,OAGhByD,GAAGuE,EAAWe,GACnB,OAAOpF,KAAKwE,IAAIH,GAAGe,GAGdtF,QAAQgG,GACb,OACEA,EAAMzB,GAAK,GACXyB,EAAMV,GAAK,GACXU,EAAMzB,EAAIrE,KAAK0F,OACfI,EAAMV,EAAIpF,KAAKiE,OAIZnE,KAAKoE,GACVlE,KAAKwE,IAAI2B,QAAQ,CAACC,EAAQ/B,KACxB+B,EAAOD,QAAQ,CAACE,EAAMjB,KACpBlB,EAAGmC,EAAMhC,EAAGe,QAMb,MAAMkB,EAAQ,SAASC,EAAaC,GACzC,IAAInC,EACJ,GAAImC,EAAK,EACP,IAAK,IAAIrK,EAAI,EAAGA,EAAIqK,EAAIrK,IACtBkI,EAAIkC,EAAKE,MACTF,EAAKG,QAAQrC,QAEV,GAAImC,EAAK,EACd,IAAK,IAAIrK,EAAIqK,EAAIrK,EAAI,EAAGA,IACtBkI,EAAIkC,EAAKzJ,QACTyJ,EAAKhK,KAAK8H,GAId,OAAOkC,GAGII,EAAY,SACvBC,EACAC,EACA3C,GAEA,IAAK4C,EAAIC,EAAIC,EAAIC,IAAOL,EAAGvC,EAAGwC,EAAGxC,EAAGuC,EAAGxB,EAAGyB,EAAGzB,GACzC8B,EAAQxC,KAAK5B,IAAI4B,KAAKqB,IAAIe,EAAKC,GAAKrC,KAAKqB,IAAIiB,EAAKC,IACtD,MAAME,EAAQ,IAAItB,GAAOkB,EAAKD,GAAMI,GAAQD,EAAKD,GAAME,GAEvD,KAAOA,EAAQ,GACbJ,GAAMK,EAAM9C,EACZ2C,GAAMG,EAAM/B,EAEZlB,EAAGQ,KAAK0C,MAAMN,GAAKpC,KAAK0C,MAAMJ,IAE9BE,GAAS,GAIAG,EAAqB,SAChCT,EACAC,EACA3C,GAEAyC,EAAUC,EAAIC,EAAI3C,GAClBA,EAAG2C,EAAGxC,EAAGwC,EAAGzB,UAGDkC,UAAkBzB,EAC7B/F,YAAoBuE,EAAWe,GAC7B5E,MAAM6D,EAAGe,GAwBJtF,SAASyH,GACd,OAAO,IAAI1B,EAAM7F,KAAKqE,EAAIkD,EAAOvH,KAAKoF,EAAImC,IAtB5BD,EAAAE,GAAK,IAAIF,EAAU,GAAI,GACvBA,EAAAG,KAAO,IAAIH,EAAU,EAAG,GACxBA,EAAAI,KAAO,IAAIJ,GAAW,EAAG,GACzBA,EAAAK,MAAQ,IAAIL,EAAU,EAAG,GAEzBA,EAAAM,OAAS,IAAIN,GAAW,GAAI,GAC5BA,EAAAO,QAAU,IAAIP,EAAU,GAAI,GAC5BA,EAAAQ,SAAW,IAAIR,GAAW,EAAG,GAC7BA,EAAAS,UAAY,IAAIT,EAAU,EAAG,GAE7BA,EAAAU,KACdV,EAAUE,GACVF,EAAUG,KACVH,EAAUI,KACVJ,EAAUK,MACVL,EAAUM,OACVN,EAAUO,QACVP,EAAUQ,SACVR,EAAUS,WAQP,MAAME,EAAY,SAAY1B,GACnC,MAAM2B,EAAO1L,OAAA2L,EAAA,IAAA3L,CAAI+J,GACjB,QAAa6B,IAATF,EACF,OAAOA,EAGT,KAAM,+ZCpLIG,EA0KAC,WA1KZ,SAAYD,GACVA,IAAA,eACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,+BACAA,IAAA,2BACAA,IAAA,eACAA,IAAA,qBAPF,CAAYA,iBAUUE,EAIpBzI,YAAmBb,EAAoBuJ,GAApBxI,KAAAf,MAAoBe,KAAAwI,OAEhC1I,QAAQ2I,EAAYC,GACpB1I,KAAK2I,QACR3I,KAAK2I,MAAQ,IAAIC,EAAA,GAGnB5I,KAAK2I,MAAME,IAAIJ,EAAMC,GAGhB5I,KAAKgJ,GACV,OAAO9I,KAAK+I,WAAa/I,KAAKgJ,gBAAgBF,GAGzChJ,UACL,OAAOE,KAAKwI,OAASH,EAAUY,MAG1BnJ,iBACL,OAAO,EAGFA,gBAAgBoJ,GACrB,OAAIA,GAASlJ,KAAK8I,SACT9I,KAAKwI,OAASH,EAAUc,MAAQnJ,KAAK8I,SAASM,KAAOF,EAAME,GAG7DpJ,KAAKwI,OAASH,EAAUc,OAASnJ,KAAK8I,SAKxChJ,MAAMuJ,EAAarJ,MACxB,IAAIqG,EAAOrG,KAAKsJ,WAMhB,OAJID,EAAKP,WACPzC,EAAKyC,SAAWO,EAAKP,UAEvBzC,EAAKsC,MAAQU,EAAKV,OAASU,EAAKV,MAAMY,QAC/BlD,SAME4C,UAAcV,EAClBzI,iBACL,OAAO,EAGFA,MAAM0J,GACXA,EAAYC,QAAQzJ,MAGZF,WACR,OAAO,IAAImJ,EAAMjJ,KAAKf,IAAKe,KAAKwI,aAIvBkB,UAAiBT,SAEjBU,UAAaV,EACxBnJ,cACEU,MAAM,IAAK6H,EAAUY,cAIZW,UAAarB,EACxBzI,YAAmB+J,EAAgBnF,KAAKc,UAAY,IAClDhF,MAAM,IAAK6H,EAAUuB,MADJ5J,KAAA6J,OAIZ/J,iBACL,OAAOE,KAAK6J,KAGP/J,MAAM0J,GACXA,EAAYM,OAAO9J,MAGXF,WACR,OAAO,IAAI8J,EAAK5J,KAAK6J,aAIZV,UAAaZ,EACxBzI,cACEU,MAAM,IAAK6H,EAAUc,MAGhBrJ,iBACL,OAAO,EAGFA,MAAM0J,GACXA,EAAYO,OAAO/J,MAGXF,WACR,OAAO,IAAIqJ,SAIOa,UAAiBzB,EAGrCzI,YACEb,EACAyD,EACO1B,EACAiJ,GAEPzJ,MAAMvB,EAAKyD,GAHJ1C,KAAAgB,aACAhB,KAAAiK,kBAKFnK,SAASoK,EAAoBC,GAClC,OAAInK,KAAKoK,UACApK,KAAKoK,UAGNpK,KAAKoK,UAAYD,EAAYE,YAAYH,EAAShM,MAGrD4B,iBACL,OAAO,SAIEwK,UAAqBN,EAChClK,YAAYkB,EAAsBiJ,GAChCzJ,MAAM,IAAK6H,EAAUiC,aAActJ,EAAYiJ,GAG1CnK,MAAM0J,GACXA,EAAYe,eAAevK,MAGnBF,WACR,OAAO,IAAIwK,EAAatK,KAAKgB,WAAYhB,KAAKiK,wBAIrCO,UAAmBR,EAC9BlK,YAAYkB,EAAsBiJ,GAChCzJ,MAAM,IAAK6H,EAAUmC,WAAYxJ,EAAYiJ,GAGxCnK,MAAM0J,GACXA,EAAYiB,aAAazK,MAGjBF,WACR,OAAO,IAAI0K,EAAWxK,KAAKgB,WAAYhB,KAAKiK,mBAIhD,SAAY3B,GACVA,IAAA,qBACAA,IAAA,uBACAA,IAAA,6BACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,iCACAA,IAAA,iBAPF,CAAYA,iBAUUoC,UAAanC,EACjCzI,YACkB4C,EACT2D,EACAsE,GAAoB,GAE3BnK,MAAM,IAAK6H,EAAUqC,MAJL1K,KAAA0C,OACT1C,KAAAqG,OACArG,KAAA2K,WAKF7K,MAAM0J,GACXA,EAAYoB,OAAO5K,MAYXF,YACRuE,EAAEA,EAACe,EAAEA,GACL7E,EACA2J,EACAhF,GAEAA,EAAK2F,OAAOC,kBAAkBvK,GAC9B2J,EAASa,QAAQ1G,EAAGe,EAAGpF,KAAKqG,KAAKkD,MAAMvJ,cAqDrBgL,EACblL,OAAOmL,GACZjL,KAAKkL,QAAQD,GAGRnL,QAAQ6E,GACb3E,KAAKkL,QAAQvG,GAGR7E,eAAeqL,GACpBnL,KAAKoL,WAAWD,GAGXrL,aAAaqL,GAClBnL,KAAKoL,WAAWD,GAGXrL,OAAOuL,GACZrL,KAAKkL,QAAQG,GAGRvL,UAAUwL,GACftL,KAAKkL,QAAQI,GAGRxL,OAAOyL,GACZvL,KAAKkL,QAAQK,GAGLzL,WAAWqL,GACnBnL,KAAKkL,QAAQC,GAGLrL,QAAQuG,wICpSRmF,UAAZ,SAAYA,GACVA,IAAA,mCACAA,IAAA,iBACAA,IAAA,eACAA,IAAA,+BACAA,IAAA,qBACAA,IAAA,yCACAA,IAAA,eACAA,IAAA,iCACAA,IAAA,uCACAA,IAAA,iCAVF,CAAYA,iBAaUC,EAKpB3L,YAAsBoK,EAA8BhF,GAA9BlF,KAAAkK,WAA8BlK,KAAAkF,OAClDlF,KAAKO,OAASP,KAAKkF,KAAK3E,OAG1B8F,WACE,OAAOrG,KAAKkK,SAASwB,aAAa1L,KAAKO,QAG/BT,UACRE,KAAKkF,KAAK3E,OAAOW,GAAGC,QAAQnB,KAAKkF,KAAMlF,KAAKkK,UAGpCpK,SAAS6L,GACjB3L,KAAKkF,KAAK3E,OAAOW,GAAG0K,SAASD,GAGxB7L,SACLE,KAAK4L,SAAS,IAAIC,EAAA,cAAc7L,KAAKkK,SAAUlK,KAAKkF,cAIlC4G,UAA2BL,EACxC3L,eACLE,KAAK4L,SAAS,IAAIC,EAAA,kBAAkB7L,KAAKkK,SAAUlK,KAAKkF,OAGnDpF,gBACLE,KAAK4L,SAAS,IAAIC,EAAA,mBAAmB7L,KAAKkK,SAAUlK,KAAKkF,OAGpDpF,kBACLE,KAAK4L,SAAS,IAAIC,EAAA,qBAAqB7L,KAAKkK,SAAUlK,KAAKkF,OAGtDpF,cACLE,KAAK4L,SAAS,IAAIC,EAAA,iBAAiB7L,KAAKkK,SAAUlK,KAAKkF,uGCzD9C6G,EACXjM,eAEOA,oBACL2C,GACAtC,OAAEA,EAAMC,WAAEA,IAEV,OAAIsE,KAAKc,SAAWrF,EACXsC,EAGFA,EAAQ+B,IACb,EAAG9B,OAAME,MAAQC,QAAOC,OAAOC,aAE3BL,OACAE,MAAQC,QAAOC,IAAKA,EAAM1C,GAC1B2C,MAAOA,EAAQ3C,KAMhBN,cAAckM,EAAoBC,GACvC,OACEvH,KAAKc,SAAWwG,GAAcA,EAAatH,KAAKwH,IAAe,IAAXD,EAAiB,KAKlEnM,mBAAmBgD,EAAaqJ,EAAc,GACnD,IAAIzD,EAAQ,EAEZ,IAAK,IAAIvM,EAAIgQ,EAAKhQ,EAAI2G,EAAK3G,IACrB6D,KAAKG,OAAO,EAAG,KACjBuI,GAAS,GAIb,OAAOhE,KAAK5B,IAAI,EAAG4F,GAGd5I,oBAAoBgD,EAAaqJ,EAAc,GACpD,OAAOrJ,EAAMqJ,EAAMnM,KAAKoM,YAAYtJ,EAAKqJ,GAGpCrM,cAAcuM,EAAaC,GAChC,OAAO9P,OAAA2L,EAAA,OAAA3L,CAAO,EAAG8P,IAAOD,EAMnBvM,cAAcyM,EAAiBhF,GACpC,OAAO7C,KAAKc,SAAYd,KAAK8H,KAAKD,EAAUhF,GAAS7C,KAAK+H,GAAM,EAG3D3M,cACL2C,EACAiK,EACAC,GAEA,GACElK,EAAQmK,MAAM,EAAGlK,OAAMS,iBACrBnD,KAAK6M,SAASnK,EAAMS,EAAawJ,IAGnC,OAASG,OAAQ,EAAGC,QAAQ,GAqB9B,OAASD,OAlBMtQ,OAAA2L,EAAA,MAAA3L,CACbiG,EACA,EAAGM,QAAOH,OAAMF,OAAMS,iBAChBnD,KAAK6M,SAASnK,EAAMS,EAAawJ,GAC5B,EAGFjI,KAAKC,MACVD,KAAK5B,IACH,EACAC,EACE/C,KAAKgN,SAASpK,GACd5C,KAAKiN,gBAAgBvK,EAAMgK,MAMpBK,QAAQ,GAGjBjN,gBACRoN,EACA/J,EACAwJ,GAEA,GAAIxJ,GAAe3G,OAAA2L,EAAA,aAAA3L,CAAamQ,EAAmBxJ,GAAa9G,OAC9D,OAAO,EAGT,OAAQ6Q,GACN,KAAKC,EAAA,WAAWC,MAChB,KAAKD,EAAA,WAAWE,OAChB,KAAKF,EAAA,WAAWG,MACd,OAAO9Q,OAAA2L,EAAA,SAAA3L,CAASmQ,EAAmBY,EAAA,EAAWC,YAChD,KAAKL,EAAA,WAAWM,MACd,OAAOjR,OAAA2L,EAAA,SAAA3L,CAASmQ,EAAmBY,EAAA,EAAWG,aAChD,KAAKP,EAAA,WAAWxK,KACd,OAAO,GAIH7C,gBAAgB8C,GACxB,OAAOpG,OAAA2L,EAAA,IAAA3L,CAAIA,OAAA2L,EAAA,MAAA3L,CAAMoG,EAAKC,MAAO,IAAMrG,OAAA2L,EAAA,OAAA3L,CAAO,EAAGoG,EAAKE,OAG1ChD,uBACRoN,EACA1K,GAEA,OAAOhG,OAAA2L,EAAA,IAAA3L,CACLgG,EAAYgC,IACV,EAAG9B,OAAM/D,WACPA,EAAQqB,KAAK2N,mBAAmBT,EAAYxK,MAKnCqJ,EAAA4B,mBAAqB,EACpCT,EACAU,KAEA,OAAQV,GACN,KAAKC,EAAA,WAAWC,MACd,OAAQQ,GACN,KAAKT,EAAA,eAAeU,OAClB,OAAO,EAAI,EACb,KAAKV,EAAA,eAAeW,MAClB,OAAO,EAAI,EACb,QACE,OAAO,EAEb,KAAKX,EAAA,WAAWE,OACd,OAAQO,GACN,KAAKT,EAAA,eAAeY,MAClB,MAAO,GACT,KAAKZ,EAAA,eAAeU,OAClB,OAAO,EAAI,EACb,KAAKV,EAAA,eAAeW,MAClB,OAAO,EACT,KAAKX,EAAA,eAAea,UAClB,MAAO,IACT,QACE,OAAO,EAEb,KAAKb,EAAA,WAAWG,MACd,OAAQM,GACN,KAAKT,EAAA,eAAeU,OAClB,OAAO,EACT,KAAKV,EAAA,eAAeW,MAEpB,KAAKX,EAAA,eAAea,UAClB,MAAO,GACT,QACE,OAAO,EAEb,KAAKb,EAAA,WAAWM,MACd,OAAQG,GACN,KAAKT,EAAA,eAAeY,MAClB,OAAO,EAAI,EACb,KAAKZ,EAAA,eAAeU,OAClB,MAAO,IACT,KAAKV,EAAA,eAAec,MAClB,MAAO,GACT,KAAKd,EAAA,eAAeW,MAClB,OAAO,EACT,QACE,OAAO,EAEb,KAAKX,EAAA,WAAWxK,KACd,OAAO,EACT,QACE,KAAM,meCrLFuL,EAiBAC,EAYAC,EAUAC,EAmKAC,WA1MZ,SAAYJ,GACVA,IAAA,iCACAA,IAAA,6BACAA,IAAA,6BACAA,IAAA,eACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,eACAA,IAAA,eACAA,IAAA,oBACAA,IAAA,0BACAA,IAAA,kBACAA,IAAA,oBAdF,CAAYA,WAiBZ,SAAYC,GACVA,IAAA,yBACAA,IAAA,iCACAA,IAAA,2BACAA,IAAA,qBACAA,IAAA,mBACAA,IAAA,iCACAA,IAAA,iBACAA,IAAA,qBACAA,IAAA,aATF,CAAYA,WAYZ,SAAYC,GACVA,IAAA,6BACAA,IAAA,iBAEAA,IAAA,aACAA,IAAA,mBALF,CAAYA,WAUZ,SAAYC,GACVA,IAAA,eACAA,IAAA,uBACAA,IAAA,mBACAA,IAAA,iBAJF,CAAYA,iBAOCE,EASXzO,YACS0O,EACAtQ,EACAqE,EACAiB,EACSiL,KACTrF,EAAamF,EAAKG,SALlB1O,KAAAwO,QACAxO,KAAA9B,OACA8B,KAAAuC,SACAvC,KAAAwD,WACSxD,KAAAyO,SACTzO,KAAAoJ,KATFpJ,KAAA2O,WACA3O,KAAA4O,eAAiCP,EAAeQ,KALhD/O,eACL,OAAOE,KAAK8O,SAgBPhP,UACL,OAAQE,KAAK4O,gBACX,KAAKP,EAAeQ,KAElB,OADA7O,KAAK4O,eAAiBP,EAAeU,UAC9B,EACT,KAAKV,EAAeU,SAElB,OADA/O,KAAK4O,eAAiBP,EAAeW,QAC9B,EACT,KAAKX,EAAeW,OAElB,OADAhP,KAAK4O,eAAiBP,EAAeY,OAC9B,EAGX,OAAO,EAGTC,wBACE,YAA2C9G,IAApCpI,KAAKwD,SAAS0L,kBAGvBC,WACE,OAAOnP,KAAKwD,SAAS2L,KAGvBC,gBACE,OAAOpP,KAAKwD,SAAS4L,UAGvBC,oBACE,OAAO,EAGFvP,QACL,OAAO,IAAIyO,EAAKvO,KAAKwO,MAAOxO,KAAK9B,KAAM8B,KAAKuC,OAAQvC,KAAKwD,UAGpD1D,WAAW2I,GAChB,OAAOzI,KAAK9B,OAASuK,EAAKvK,KAGrB4B,UAAU2I,GACf,OAAO,EAGF3I,SAASS,GACd,OAAO,GA/DMgO,EAAAO,OAAiB,QAmErBQ,UAAef,EAC1BzO,YAA4ByP,GAC1B/O,MACE2N,EAAUqB,cACPD,EAAOrR,gBACVqR,EAAOhN,OACPgN,EAAO/L,UALiBxD,KAAAuP,gBAURE,UAAelB,EACnCzO,YAAmB5B,EAAcsF,EAAqBkM,EAAA,EAASC,OAC7DnP,MAAM2N,EAAUsB,OAAQvR,EAAM,GAAKsF,GADlBxD,KAAA9B,cAOC0R,UAAerB,EACnCzO,YACE0O,EACAtQ,EACAqE,EACAiB,EACUqM,EACVpB,GAEAjO,MAAMgO,EAAOtQ,EAAMqE,EAAQiB,EAAUiL,GAH3BzO,KAAA6P,aAMZpN,cACE,OAAQzC,KAAK4O,gBACX,KAAKP,EAAeU,SAClB,OAAO/O,KAAK8P,oBAAoB,GAClC,KAAKzB,EAAeW,OAClB,OAAOhP,KAAK8P,oBAAoB,GAClC,KAAKzB,EAAeY,MAClB,OAAOjP,KAAK8P,oBAAoB,GAClC,QACE,OAAO9P,KAAK6P,YAIR/P,oBAAoBiQ,GAC5B,OAAO/P,KAAK6P,WAAWrL,IAAI,EAAG5B,OAAMF,OAAMK,aAC/BH,OAAMF,OAAMK,MAAOA,EAAQgN,YAKpBC,UAAgBJ,EACpC9P,YACE5B,EACAqE,EACAE,EACAe,GAEAhD,MAAM2N,EAAU6B,QAAS9R,EAAMqE,EAAQiB,EAAUf,aAI/BwN,UAAsBL,EAC1C9P,YACE5B,EACAqE,EACAE,EACAe,GAEAhD,MAAM2N,EAAU8B,cAAe/R,EAAMqE,EAAQiB,EAAUf,GACrDyL,EAAMgC,eAKCC,UAAsBP,EACjC9P,YACE5B,EACAqE,EACAiB,EACAf,GAEAjC,MAAM2N,EAAUgC,cAAejS,EAAMqE,EAAQiB,EAAUf,GACrDyL,EAAMkC,kBAKZ,SAAY9B,GACVA,IAAA,iBACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,yBALF,CAAYA,iBAaU+B,UAAc9B,EAClCzO,YACE0O,EACAtQ,EACAqE,EACAiB,EACmB8M,EACnBC,GAEA/P,MAAMgO,EAAOtQ,EAAMqE,EAAQiB,GAAW+M,IAHnBvQ,KAAAsQ,iBAMrB9N,kBACE,OAAQxC,KAAK4O,gBACX,KAAKP,EAAeU,SAClB,OAAO/O,KAAKwQ,wBAAwB,GACtC,KAAKnC,EAAeW,OAClB,OAAOhP,KAAKwQ,wBAAwB,GACtC,KAAKnC,EAAeY,MAClB,OAAOjP,KAAKwQ,wBAAwB,GACtC,QACE,OAAOxQ,KAAKsQ,gBAIRxQ,wBAAwBiQ,GAChC,OAAO/P,KAAKsQ,eAAe9L,IAAI,EAAG9B,OAAM/D,aAC7B+D,OAAM/D,MAAOA,EAAQoR,YAKvBU,UAAkBJ,EAC7BvQ,YACE5B,EACAqE,EACAiB,EACAhB,GAEAhC,MACE2N,EAAUsC,UACVvS,EACAqE,EACAiB,EACAhB,EACA0L,EAAMwC,oBAKCC,UAAcN,EACzBvQ,YACE5B,EACAqE,EACAiB,EACAhB,GAEAhC,MAAM2N,EAAUwC,MAAOzS,EAAMqE,EAAQiB,EAAUhB,EAAa0L,EAAMyC,uCCxRtE,IAAYC,EAYKC,kEAZjB,SAAYD,GACVA,IAAA,yBACAA,IAAA,qBAFF,CAAYA,WAYZ,SAAiBC,GACFA,EAAAC,OACX5B,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAApN,OACXyL,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAlB,OACXT,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAG,MACX9B,kBAAmB0B,EAAYK,UAC/B9B,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAK,SACXhC,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAM,OACXjC,kBAAmB0B,EAAYQ,QAC/BjC,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAQ,OACXnC,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAGAyB,EAAAS,MACXpC,uBAAmB9G,EACnB+G,MAAM,EACN4B,SAAS,EACT3B,WAAW,GAtDf,CAAiByB,iLCJKU,EAOVzR,OACRoJ,EACAsI,EACAtH,EACAhF,GAEA,OAAOlF,KAAKyR,KAAKvI,EAAOgB,EAAUhF,EAAMY,GAAS0L,EAAYE,GAAG5L,IAGxDhG,KACRoJ,EACAgB,EACAhF,EACAyM,GAEA,MAAO7L,GAAS9F,KAAK4R,UAAU1I,EAAOgB,EAAUyH,GAEhD,GAAI7L,EACF,OAAO,IAAI+L,EAAA,EAAU3M,EAAMgF,EAAUpE,GAI/BhG,UACRoJ,EACAgB,EACAyH,GAEA,OAAOnV,OAAAsV,EAAA,QAAAtV,CACL0M,EAAM6I,YAAY7H,GAClBA,EAAS8H,YAAY9I,GACrB7C,GAAQA,EAAK4L,SAAS/I,GACtByI,GAIM7R,WACR0E,EACA0N,EACAC,GAEA,IAAIC,EAA2B5V,OAAA6V,EAAA,EAAA7V,CAC7BgI,EAAIkB,MACJlB,EAAIP,OACJ,KAAM,GAEJqO,GAA0BJ,GAE9B,KAAOI,EAAcjW,QAAQ,CAC3B,IAAIkW,KAEJD,EAAcnM,QAASL,IACrB,IAAKtB,EAAIgO,QAAQ1M,GACf,OAGF,MAAMO,EAAO7B,EAAIiO,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAC9BiB,EAAKqM,UAAWN,EAAYtM,EAAMzB,GAAGyB,EAAMV,KAIhDgN,EAAYtM,EAAMzB,GAAGyB,EAAMV,IAAK,EAEhC+M,EAAMrM,EAAOO,GAEbP,EAAM6M,WAAWxM,QAAQyM,GAAQL,EAAWhW,KAAKqW,OAGnDN,EAAgBC,GAIbzS,QAAQoJ,EAAiB2J,GAC9B,OAAI3J,EAAME,KAAOyJ,EAAMzJ,KAInBF,EAAMhH,OAAS4Q,EAAA,EAAKC,YAAcF,EAAM3Q,OAAS4Q,EAAA,EAAKC,aAItD7J,EAAMhH,OAAS4Q,EAAA,EAAK3Q,QAAU0Q,EAAM3Q,OAAS4Q,EAAA,EAAKE,iBAIlDH,EAAM3Q,OAAS4Q,EAAA,EAAK3Q,QAAU+G,EAAMhH,OAAS4Q,EAAA,EAAKE,yBAQpCC,UAAuB1B,EAA7CzR,kCACSE,KAAAwR,iBAAsBpJ,EAEtBtI,IACLoJ,EACAgB,EACAhF,GAEA,IAAKlF,KAAKkT,eAAehK,EAAOgB,KAAclK,KAAKwR,YACjD,OAAOxR,KAAKmT,iBAAiBjK,EAAOgB,EAAUhF,GAGhD,MAAMkO,EAAQpT,KAAKqT,KAAKnK,EAAOgB,EAAUhF,EAAMlF,KAAKwR,aACpD,GAAI4B,EACF,OAAOA,EAGTpT,KAAKwR,iBAAcpJ,EACnBpI,KAAKsT,WAAWpK,GAKRpJ,KACRoJ,EACAgB,EACAhF,EACAY,GAEA,OAAO9F,KAAKuT,OAAOrK,EAAOpD,EAAOoE,EAAUhF,GAGnCpF,iBACRoJ,EACAgB,EACAhF,GAEA,GAAIlF,KAAKwR,aAAetH,EAAS8H,YAAY9I,GAAOwI,GAAG1R,KAAKwR,aAE1D,OADAxR,KAAKwR,iBAAcpJ,EACZpI,KAAKwT,QAAQtK,EAAOgB,EAAUhF,GAQ/BpF,OAAOoJ,IACPpJ,QACRoJ,EACAgB,EACAhF,IAIQpF,WAAWoJ,WAGDuK,UAAmBR,EACvCnT,YAAsB4T,GACpBlT,QADoBR,KAAA0T,UAIZ5T,iBACRoJ,EACAgB,EACAhF,GAEA,IAAIkO,EAAQ5S,MAAM2S,iBAAiBjK,EAAOgB,EAAUhF,GAEpD,GAAIkO,EACF,OAAOA,EAGT,MAAMlB,EAAMhI,EAAS8H,YAAY9I,GACjC,OAAIlJ,KAAK0T,QAAQxK,EAAM6I,YAAY7H,GAAUuI,GAAGP,EAAI7N,EAAG6N,EAAI9M,KACzDpF,KAAKwR,iBAAcpJ,EACZpI,KAAKwT,QAAQtK,EAAOgB,EAAUhF,SAFvC,EAMQpF,eAAeoJ,EAAiBgB,GACxC,MAAMyJ,EAAOnX,OAAAsV,EAAA,QAAAtV,CACX0M,EAAM6I,YAAY7H,GAClBA,EAAS8H,YAAY9I,GACrB7C,GAAQA,EAAK4L,SAAS/I,GACtB,CAACpD,EAAOO,IAASrG,KAAK0T,QAAQrN,IAC9B,GAGF,QAAIsN,EAAKtX,SACP2D,KAAKwR,YAAcmC,EAAKlN,OACjB,4hBCjMSmN,EAGpB9T,YAEkB2O,EAEAoF,EACTC,GAHS9T,KAAAyO,SAEAzO,KAAA6T,gBACT7T,KAAA8T,YAPF9T,KAAA9B,KAAe,gBAUf4B,cAAciU,GACnB,OAAOA,EAAUC,QAAQC,OAAOC,GAAalU,KAAKmU,MAAMD,EAAUzL,OAGpE2G,gBACE,SAAUpP,KAAK8T,YAAa9T,KAAK8T,UAAUrL,KAAK2G,WAGlDD,WACE,SAAUnP,KAAK8T,YAAa9T,KAAK8T,UAAUrL,KAAK0G,MAG3CrP,MAAM2I,EAAiBC,GAC5B,GAAI1I,KAAK8T,UACP,aAAc9T,KAAK9B,iCAAiC8B,KAAK8T,UAAUrL,OAGrEzI,KAAK8T,WAAcpL,QAAOD,QAGrB3I,UACL,IAAKE,KAAK8T,UACR,aAAc9T,KAAK9B,+BAGrB8B,KAAK8T,eAAY1L,EAGTtI,MAAM2I,GACd,OAAOjM,OAAA2H,EAAA,aAAA3H,CAAaiM,EAAKgG,OAAQzO,KAAKyO,QAAQpS,OAAS,EAG/CyD,aACRsU,EACA3L,GAEA,OAAO2L,EAAUH,OAAOI,GAAeA,EAAY5L,KAAK6L,UAAU7L,WAIhD8L,UAEZX,EAGR1E,wBACE,YAA2C9G,IAApCpI,KAAKwD,SAAS0L,yBAIZsF,UAAsBD,EAEjCzU,YAAmB0D,GACjBhD,OAAOiU,EAAA,EAAMrE,gBAAgB,GADZpQ,KAAAwD,WADZxD,KAAA9B,KAAe,qBAMXwW,UAAqBH,EAEhCzU,YAAmB0D,GACjBhD,OAAOiU,EAAA,EAAMrE,gBAAgB,GADZpQ,KAAAwD,WADZxD,KAAA9B,KAAe,oBAMXyW,UAAiBJ,EAE5BzU,YAAmB0D,GACjBhD,OAAOiU,EAAA,EAAMG,cAAc,GADV5U,KAAAwD,WADZxD,KAAA9B,KAAe,gBAMX2W,UAAkBN,EAE7BzU,YAAmB0D,GACjBhD,OAAOiU,EAAA,EAAM/D,cAAc,GADV1Q,KAAAwD,WADZxD,KAAA9B,KAAe,gBAMX4W,UAAkBP,EAE7BzU,YAAmB0D,GACjBhD,OAAOiU,EAAA,EAAM9D,QAAQ,GADJ3Q,KAAAwD,WADZxD,KAAA9B,KAAe,iBAMX6W,UAAmBnB,EAE9B9T,cACEU,OAAOiU,EAAA,EAAMO,SAAS,GAFjBhV,KAAA9B,KAAe,kBAMX+W,UAAsBrB,EAEjC9T,cACEU,OAAOiU,EAAA,EAAMS,YAAY,GAFpBlV,KAAA9B,KAAe,gBAMXiX,UAAiBvB,EAE5B9T,cACEU,OAAOiU,EAAA,EAAMW,OAAO,GAFfpV,KAAA9B,KAAe,cAMXmX,UAAmBzB,EAE9B9T,cACEU,OAAOiU,EAAA,EAAMa,SAAS,GAFjBtV,KAAA9B,KAAe,gBAMXqX,UAAuB3B,EAElC9T,cACEU,OAAOiU,EAAA,EAAMe,OAAO,GAFfxV,KAAA9B,KAAe,qBAMXuX,UAAwB7B,EAEnC9T,cACEU,OAAOiU,EAAA,EAAMe,OAAO,GAFfxV,KAAA9B,KAAe,sBAMXwX,UAAkB9B,EAE7B9T,cACEU,OAAOiU,EAAA,EAAMkB,QAAQ,GAFhB3V,KAAA9B,KAAe,cAMX0X,UAA0BhC,EAErC9T,cACEU,OAAOiU,EAAA,EAAMvE,QAAQ,GAFhBlQ,KAAA9B,KAAe,cAKf4B,cAAciU,GACnB,IAAIK,EAAY5T,MAAMqV,cAAc9B,GAClC+B,EAAU/B,EAAUgC,YAAYjC,UAElC,OAAIgC,EACK9V,KAAKgW,aAAa5B,EAAW0B,EAAQrN,MAGvC2L,SAIE6B,UAAoBrC,EAE/B9T,cACEU,OAAOiU,EAAA,EAAMyB,QAAQ,GAFhBlW,KAAA9B,KAAe,UAKf4B,cAAciU,GACnB,IAAIK,EAAYL,EAAUC,QACxBmC,EAAgBpC,EAAUqC,kBAAkBtC,UAE9C,OAAIqC,EACKnW,KAAKgW,aAAa5B,EAAW+B,EAAc1N,MAG7C2L,SAIEiC,UAAkBzC,EAE7B9T,cACEU,OAAOiU,EAAA,EAAM6B,OAAO,GAFftW,KAAA9B,KAAe,4GCtLlBqY,UAA4BC,EAAA,EAGhC1W,YACUoS,EACApJ,EACAoB,EACAhF,GAER1E,QALQR,KAAAkS,MACAlS,KAAA8I,WACA9I,KAAAkK,WACAlK,KAAAkF,OANHlF,KAAAyW,SAAqBnW,EAAA,SAASoW,QAW9B5W,OAAOyL,GACZvL,KAAKyW,SAAWlL,EAAKoL,SACnB3W,KAAKkS,IACLlS,KAAKkF,KACLlF,KAAKkK,SACLlK,KAAK8I,UAIFhJ,UAAUwL,GACfA,EAAQqL,SAAS3W,KAAKkF,KAAMlF,KAAKkK,SAAUlK,KAAK8I,iBAIvC8N,UAAkBC,EAAA,EAC7B/W,YACUoF,EACAgF,EACA4M,EACAC,EAAsB7M,GAE9B1J,QALQR,KAAAkF,OACAlF,KAAAkK,WACAlK,KAAA8W,YACA9W,KAAA+W,YAKHjX,eAAeoJ,GACpB,MAAMgJ,EAAMlS,KAAKkK,SAAS8H,YAAY9I,GAElClJ,KAAK+W,UAAU7Y,OAAS8B,KAAKkK,SAAShM,MACxC8B,KAAKkK,SAAS8M,eAAe9N,GAC7BlJ,KAAK+W,UAAUE,YAAYjX,KAAK8W,UAAW5N,KAE3ClJ,KAAKkK,SAASuI,GAAGP,EAAI7N,EAAG6N,EAAI9M,GAAG0D,cAAWV,EAC1CpI,KAAKkK,SAASuI,GAAGzS,KAAK8W,UAAUzS,EAAGrE,KAAK8W,UAAU1R,GAAG0D,SAAWI,GAGlE,MAAMgO,EAAU,IAAIX,EAClBvW,KAAK8W,UACL5N,EACAlJ,KAAKkK,SACLlK,KAAKkF,MAIP,OAFAlF,KAAK+W,UAAUtE,GAAGzS,KAAK8W,UAAUzS,EAAGrE,KAAK8W,UAAU1R,GAAG+M,MAAM+E,GAErDA,EAAQT,SAGV3W,aAAaS,GAYlB,OAXIP,KAAK+W,WAAa/W,KAAKkK,SAAShM,OAAS8B,KAAK+W,UAAU7Y,MAC1D8B,KAAKkK,SAASiN,QACdnX,KAAK+W,UAAUlW,QAEfb,KAAKC,eAAeM,GAEpBP,KAAKkF,KAAKlE,WAAahB,KAAK+W,WAE5B/W,KAAKC,eAAeM,GAGfD,EAAA,SAASoW,4GCpERU,0BAAZ,SAAYA,GACVA,IAAA,mBACAA,IAAA,qBACAA,IAAA,eACAA,IAAA,2BAJF,CAAYA,iBAOCC,UAAiBR,EAAA,EAC5B/W,YACUoF,EACAgF,EACAoN,GAER9W,QAJQR,KAAAkF,OACAlF,KAAAkK,WACAlK,KAAAsX,SAKHxX,eAAegJ,GACpB,IAAIzC,EAAOrG,KAAKkK,SAASwB,aAAa5C,GAatC,OAXA9I,KAAKkK,SAAS8M,eAAelO,GAC7BA,EAASzH,MAAO,EAEZyH,EAASyG,OAAOlN,kBAAoBqC,KAAKc,UAC3Ca,EAAKkR,QAAQ,IAAIC,EAAA,EAAO1O,EAASyG,QAAS,GAG5CzG,EAAS2O,eAAetR,QAAQuR,GAC9BrR,EAAKkR,QAAQG,EAAQjP,KAAMiP,EAAQhP,QAG9BmO,EAAA,EAASc,IAGX7X,aAAaS,GAKlB,OAJAA,EAAOW,GAAG0W,UAAU,IAAIC,EAAA,EAAW7X,KAAKsX,OAAQtX,KAAKkK,SAAUlK,KAAKkF,OACpE3E,EAAOc,MAAO,EACdrB,KAAKkF,KAAKjE,YAAa,EAEhB4V,EAAA,EAASc,6FCXb,MAAMG,EAAW,SACtB5F,EACA6F,EACAC,EACA9N,GAMA,IAAI+N,EAAA,EACF/F,EAAI7N,EACJ6N,EAAI9M,EACJ2S,EACA7N,EAASxE,MACTwE,EAASjG,OACT,kBA7CgCoC,EAAA,EAKlCvG,YAAoBoY,EAAyBhG,GAC3C1R,QADkBR,KAAAkY,QAAyBlY,KAAAkS,MAJtClS,KAAA0S,SAAmB,EAQnB5S,QAAQuE,EAAWe,GAIxB,OAHApF,KAAKqE,EAAIA,EACTrE,KAAKoF,EAAIA,EACTpF,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAAG+M,MAAMnS,OAClBA,KAAK0S,QAGR5S,OAAOuL,GACZrL,KAAKkL,QAAQG,GACbrL,KAAK0S,QACH1S,KAAK0S,SAAY1S,KAAKkS,IAAI7N,IAAMrE,KAAKqE,GAAKrE,KAAKkS,IAAI9M,IAAMpF,KAAKoF,EAGxDtF,QAAQuG,GACZrG,KAAKqE,GAAKrE,KAAKoF,IACjBpF,KAAK0S,QAAU1S,KAAKkY,MAAMC,eAAenY,KAAKqE,EAAGrE,KAAKoF,MAqB9B8E,EAAUgI,GAV1B,CAAC7N,EAAWe,EAAWgT,KACjCJ,EAAOvF,GAAGpO,EAAGe,GAAGiT,IAAInO,EAASuI,GAAGpO,EAAGe,GAAIgT,KAWvCE,YCxCQC,EAMAC,0IANZ,SAAYD,GACVA,IAAA,mBACAA,IAAA,qCACAA,IAAA,2BAHF,CAAYA,WAMZ,SAAYC,GACVA,IAAA,2BACAA,IAAA,yBACAA,IAAA,uBAEAA,IAAA,mCALF,CAAYA,iBAUUC,EAYpB3Y,YAAmByP,EAAuBnG,EAAiBqP,EAAS/J,SAAjD1O,KAAAuP,SAAuBvP,KAAAoJ,KANhCpJ,KAAA0Y,cAAqC,IAAIC,IAE5C3Y,KAAAqB,MAAgB,EAKrBrB,KAAK4Y,OAAS,IAAIC,EAAA,EAAWtJ,GAXxBzP,eACL,OAAOE,KAAK8O,SAad5Q,WACE,OAAO8B,KAAKuP,OAAOrR,KAGrBgE,WACE,OAAOlC,KAAKuP,OAAOrN,KAGrBM,kBACE,OAAOxC,KAAKuP,OAAO/M,YAGrBsW,mBACE,OAAO9Y,KAAKuP,OAAO7L,gBAGrBjB,cACE,OAAOzC,KAAKuP,OAAO9M,QAGd3C,IAAIiZ,GACT,OAAOvc,OAAAwc,EAAA,SAAAxc,CAASwD,KAAKuP,OAAOnN,UAAW2W,GAGlCjZ,GAAGsT,GACR,OAAOA,EAAMnT,eAAeD,MAG9BiZ,YACE,OAAOjZ,KAAKuP,OAAOlM,UAGdvD,YAAYoK,GACjB,MAAM8N,EAAShY,KAAK0Y,cAAcna,IAAI2L,EAAShM,MAE/C,OAAI8Z,GAIGhY,KAAKkZ,WAAWhP,GAGlBpK,WAAWoK,GAChB,IAAI8N,EAAShY,KAAK0Y,cAAcna,IAAI2L,EAAShM,MAY7C,OAVI8Z,EACFA,EAAOmB,gBAEPnB,EAAS,IAAIoB,EAAA,OAAOlP,EAASxE,MAAOwE,EAASjG,QAE7CjE,KAAK0Y,cAAcW,IAAInP,EAAShM,KAAM8Z,IAGxCF,EAAS5N,EAAS8H,YAAYhS,MAAOA,KAAKoD,aAAc4U,EAAQ9N,GAEzD8N,EAOTsB,mBAKE,OAJKtZ,KAAKuZ,gBACRvZ,KAAKuZ,cAAgB,IAAIH,EAAA,aAGpBpZ,KAAKuZ,cAGPzZ,UAAU4C,GACf,OAAOlG,OAAAwc,EAAA,SAAAxc,CAASwD,KAAK2O,QAASjM,GAGzB5C,eAAe4C,EAAkB8W,GACtCxZ,KAAKsZ,aAAaG,eAAe/W,EAAM8W,GAGlC1Z,UAAU4C,EAAkBpB,GACjCtB,KAAKsZ,aAAaI,UAAUhX,EAAMpB,GAG7BxB,kBAAkB4C,EAAkB8W,GACzCxZ,KAAKsZ,aAAaK,kBAAkBjX,EAAM8W,GAGrC1Z,aAAa4C,GAClB1C,KAAKsZ,aAAaM,aAAalX,GAGjCU,mBACE,OAAIpD,KAAK6Z,UAAUC,EAAA,EAAWC,OACrB,EAGF/Z,KAAKuP,OAAOnM,aAGrBG,kBACE,OAAOvD,KAAKuP,OAAOhM,YAGrBoL,cACE,OAAO3O,KAAKsZ,aAAaU,cAGpBla,cAAcma,GACnB,OAAOzd,OAAAwc,EAAA,SAAAxc,CAASwD,KAAKmD,YAAa8W,GAGpC9W,kBACE,OAAOnD,KAAKuP,OAAOpM,YAGrB+W,0BACE,OAAOla,KAAKuP,OAAOhN,OASdzC,YACLE,KAAK4Y,OAAO7X,OAERf,KAAKuZ,eAEPvZ,KAAKuZ,cAAcxY,QAhJR0X,EAAA3J,OAAqB,QAqJzBqL,UAAmB1B,EAG9B3Y,YACSoB,EACPqO,EACAnG,EAAiBqP,EAAS/J,SAE1BlO,MAAM+O,EAAQnG,GAJPpJ,KAAAkB,KAOFpB,IAAIoK,EAAoBhF,GAC7BlF,KAAKoa,YACLpa,KAAKkZ,WAAWhP,GAEhB,MAAMmQ,EAAUra,KAAKkB,GAAGoZ,IAAIta,KAAMkK,EAAUhF,GAM5C,OALImV,GACFra,KAAKkE,GAAGmW,GAEVra,KAAKkE,GAAG,IAAIqW,EAAA,EAAWrQ,EAAUhF,IAE1BlF,KAAKiZ,MAGdnD,cAEE,GAAI9V,KAAKuP,OAAOiL,aACd,OAAS/R,KAAMzI,KAAKuP,OAAOiL,aAAc9R,MAAO,GAIpD+O,qBACE,OAAOzX,KAAKya,IAAMza,KAAKya,IAAIC,SAGtB5a,QAAQ2I,EAAYC,GACpB1I,KAAKya,MACRza,KAAKya,IAAM,IAAIC,EAAA,GAGjB1a,KAAKya,IAAI5R,IAAIJ,EAAMC,GAGd5I,WAAW2I,EAAYC,GAC5B,IAAK1I,KAAKya,IACR,iBAAkBza,KAAK9B,6BACrBuK,EAAKvK,+BAIT8B,KAAKya,IAAIE,OAAOlS,EAAMC,uGC1NdkS,UAAZ,SAAYA,GACVA,IAAA,eACAA,IAAA,qBACAA,IAAA,yBACAA,IAAA,qBAJF,CAAYA,iBAOUC,UAA+BhE,EAAA,EACnD/W,YAAYoK,EAAoBhF,GAC9B1E,MAAM0J,EAAUhF,GAGlBxC,WACE,OAAOmU,EAAA,EAAciE,cAKvBvL,aACE,OAAOvP,KAAKkF,KAAK3E,OAAOgP,uGCtBfwL,UAAkBlE,EAAA,EAG7B/W,YACU2C,EACAuY,EACA9Q,EACAhF,GAER1E,QALQR,KAAAyC,UACAzC,KAAAgb,YACAhb,KAAAkK,WACAlK,KAAAkF,OAKV4H,aACE,GAAI9M,KAAKib,WACP,OAAOjb,KAAKib,WAEZ,KAAM,sDAIHnb,eAAeC,GACpB,MAAM+M,OAAEA,EAAMC,OAAEA,GAAWmO,EAAA,EAAWpO,OACpC9M,KAAKyC,QACL1C,EAAQyC,YACRzC,EAAQoD,aAKV,OAFAnD,KAAKib,WAAanO,EAEdC,EACK8J,EAAA,EAASsE,OAGdrO,GAAU/M,EAAQ6Y,OAAOwC,cAC3Brb,EAAQmE,GAAG,IAAImX,EAAA,EAASrb,KAAKkF,KAAMlF,KAAKkK,SAAUlK,KAAKgb,YAChDnE,EAAA,EAASc,KACP7K,GAAU,EACZ+J,EAAA,EAASH,SAEhB3W,EAAQ6Y,OAAO0C,SAASxO,GACjB+J,EAAA,EAAS0E,wPC7CTC,EACX1b,YACS2b,EACAC,EAAe,EACf3Y,EAAgB,GAFhB/C,KAAAyb,OACAzb,KAAA0b,OACA1b,KAAA+C,QAGT4Y,cACE,OAAO3b,KAAKyb,KAAOzb,KAAK0b,KAAO1b,KAAK+C,MAG/BjD,IAAI2E,GACTzE,KAAKyb,MAAQhX,EAGR3E,SAAS2E,GACdzE,KAAKyb,MAAQhX,SAIJmX,EAKX9b,YAAoB+b,EAA0BC,GAA1B9b,KAAA6b,WAA0B7b,KAAA8b,eAJtC9b,KAAA+b,cAAwB,EACxB/b,KAAAgc,kBAA4B,EAC5Bhc,KAAAyb,KAAe,GAIhB3b,YAAY+b,EAAkBC,GACnC9b,KAAK6b,SAAWA,EAChB7b,KAAK8b,aAAeA,EAGtBG,eACE,OACEjc,KAAKyb,KACLzb,KAAK6b,SAAW7b,KAAK+b,cACrB/b,KAAK8b,aAAe9b,KAAKgc,kBAI7BE,kBACE,OAAuB,IAAhBlc,KAAKic,SAGdE,sBACE,OAA0B,EAAnBnc,KAAKkc,YAGdE,qBACE,OAA8B,EAAvBpc,KAAKmc,uBAIHE,UAAmBC,EAAA,EAI9Bxc,YACEyP,EACQgN,EAAc,EACtBnB,EAAe7L,EAAOvM,gBAEtBxC,MAAM+O,EAAOvM,eAAgBoY,GAHrBpb,KAAAuc,cAKRvc,KAAKiD,iBAAmBsM,EAAOtM,iBAC/BjD,KAAKkD,kBAAoBqM,EAAOrM,kBAG3BpD,OACLE,KAAKuc,aAAe,EAEhBvc,KAAKuc,aAAevc,KAAKiD,mBAC3BjD,KAAKuc,YAAc,EACnBvc,KAAKwc,SAASxc,KAAKkD,2BAKZuZ,UAAqBjB,EAChCkB,sBACE,OAAI1c,KAAK2b,QAAU,GACT,EACC3b,KAAK2b,QAAU,GACjBjX,KAAKC,OAAO3E,KAAK2b,QAAU,IAAM,GAEjC,SAKAgB,UAAyBnB,EACpCoB,qBACE,OAAI5c,KAAK2b,QAAU,GACT,EACC3b,KAAK2b,QAAU,GAChB,EACC3b,KAAK2b,QAAU,GACjB,EACE3b,KAAK2b,QAAU,GACjB,EACE3b,KAAK2b,QAAU,GACjB,EACE3b,KAAK2b,QAAU,GACjB,EAEA,SAKAkB,UAAsBrB,EACjCsB,4BACE,OAAI9c,KAAK2b,QAAU,GACT,EACC3b,KAAK2b,QAAU,GACjBjX,KAAKC,MAA4B,IAArB3E,KAAK2b,QAAU,KAE3B,EAIXoB,wBACE,OAAI/c,KAAK2b,QAAU,GACT,EACC3b,KAAK2b,QAAU,GACjBjX,KAAKC,OAAO3E,KAAK2b,QAAU,IAAM,GAEjC,oFC9HSqB,UAA6BnG,EAAA,EACjD/W,YAAsBoK,EAA8BhF,GAClD1E,QADoBR,KAAAkK,WAA8BlK,KAAAkF,OAI1CpF,WAAWoJ,GACnB,IAAI7E,EAAEA,EAACe,EAAEA,GAAMpF,KAAKkK,SAAS8H,YAAY9I,GACzC,OAAOlJ,KAAKkF,KAAK3E,OAAOwR,YAAY/R,KAAKkK,UAAUuI,GAAGpO,EAAGe,GAAGsN,yFCPnDuK,UAAkBpG,EAAA,EAC7B/W,YAAoBoK,GAClB1J,QADkBR,KAAAkK,WAIbpK,eAAegJ,GACpB,IAAIkP,EAASlP,EAASiJ,YAAY/R,KAAKkK,UASvC,OAPAlK,KAAKkK,SACF8H,YAAYlJ,GACZ6J,WACAxM,QAAQ,EAAG9B,IAAGe,QACb4S,EAAOvF,GAAGpO,EAAGe,GAAGiT,IAAIrY,KAAKkK,SAASuI,GAAGpO,EAAGe,GAAI,KAGzCyR,EAAA,EAASH,wCCjBpB,IAAYwG,kCAAZ,SAAYA,GACVA,IAAA,iBACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,eALF,CAAYA,0HCCUC,UAA8BtG,EAAA,EAGlD/W,YAAYoK,EAAoBhF,GAC9B1E,MAAM0J,EAAUhF,GAHXlF,KAAAod,aAILpd,KAAKqd,gBAGP3a,WACE,OAAOmU,EAAA,EAAcyG,aAQhBxd,QACLE,KAAKud,gBAIaC,UAAsCL,EAC1DM,qBACE,OAAO,SAMWC,UAAwCP,EAC5DM,qBACE,OAAO,sIChCNE,kBAAL,SAAKA,GACHA,IAAA,uBACAA,IAAA,uBAFF,CAAKA,iBAKQC,UAAiC/R,EAAA,WAC5C/L,YACE+d,EAAgB,EACTC,EAAiC,IAAIC,EAAA,EAC1C,aACA,EACA,EACA,IAGFvd,MAAMmd,EAAmBK,SAAU,UAAWH,EAAO,GACnDC,IARK9d,KAAA8d,aAYTG,gBACE,OAAO,EAGTC,WACE,aACG9V,EAAWpI,KAAK8d,gBAAY1V,WAKtB+V,UAAiCtS,EAAA,WAC5C/L,YACE+d,EAAgB,EACTO,EAA+B,IAAIL,EAAA,EAAkB,YAAa,EAAG,EAAG,IAE/Evd,MAAMmd,EAAmBU,SAAU,WAAYR,EAAO,GACpDO,IAHKpe,KAAAoe,YAOTH,gBACE,OAAO,EAGTC,WACE,QACEle,KAAKoe,mBAKEE,UAA+BzS,EAAA,iBAC1C/L,YACSye,EAAW,IAAIX,EACfY,EAAW,IAAIL,GAEtB3d,OAAO+d,EAAUC,GAAW,EAAG,GAHxBxe,KAAAue,WACAve,KAAAwe,8JCrDWC,EAIpB3e,YAAsBoF,GAAAlF,KAAAkF,OACpBlF,KAAKO,OAAS2E,EAAK3E,OACnBP,KAAK6K,OAAS3F,EAAK2F,cAMV6T,UAA0BD,EACrC3e,YAAmB6I,EAAyBzD,GAC1C1E,MAAM0E,GADWlF,KAAA2I,QAIZ7I,cAGa6e,UAAe9H,EAAA,EACnC/W,YAAmB8e,GACjBpe,QADiBR,KAAA4e,UAGT5e,KAAA6e,UAEH/e,UAAUsT,GACfpT,KAAK6e,OAAOtiB,KAAK6W,GAGTtT,cACRE,KAAK6e,UAGA/e,YACL,IAAIgf,GAAM,EAOV,OANA9e,KAAK6e,OAAO1Y,QAAQiN,IAClB0L,GAAM,EACN1L,EAAM2L,QAGR/e,KAAKgf,cACEF,mFCpCEG,EAAbnf,cACSE,KAAA0a,SAEA5a,KAAK2I,GACV,OAAOzI,KAAK0a,MAAMwE,KAAKxH,GAAWA,EAAQjP,KAAK0W,WAAW1W,IAGrD3I,OAAO2I,EAAYC,GACxB,MAAMgP,EAAU1X,KAAKkf,KAAKzW,QAEVL,IAAZsP,IAGOA,EAAQhP,QAAUA,EAC3BlM,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAK0a,MAAO0E,GACjBA,EAAc3W,KAAK0W,WAAWzH,EAAQjP,OAGxCiP,EAAQhP,OAASA,GAId5I,IAAI2I,EAAYC,GACrB,MAAMgP,EAAU1X,KAAK0a,MAAMwE,KAAKG,GAAOA,EAAI5W,KAAK0W,WAAW1W,IAEvDiP,EACFA,EAAQhP,OAASA,EAEjB1I,KAAK0a,MAAMne,MAAOmM,MAAOA,EAAOD,KAAMA,IAInC3I,QACL,IAAI4a,EAAQ,IAAIuE,EAMhB,OAJAjf,KAAK0a,MAAMvU,QAAQkO,IACjBqG,EAAM7R,IAAIwL,EAAY5L,KAAM4L,EAAY3L,SAGnCgS,2FC3CE4E,UAAwBzI,EAAA,EACnC/W,YACUyf,EACA7W,EACAxD,GAER1E,QAJQR,KAAAuf,OACAvf,KAAA0I,QACA1I,KAAAkF,OAKHpF,eAAegJ,GACpB,OAAO+N,EAAA,EAASH,QAGX5W,aAAaS,GAClB,IAAKP,KAAKuf,KAAKzL,UACb,yBAA0B9T,KAAKuf,KAAKrhB,wBAGtC,OAAI8B,KAAKuf,KAAKzL,UAAUpL,QAAU1I,KAAK0I,MAC9BnI,EAAO2D,GAAG,IAAIsb,EAAA,EAAiBxf,KAAKuf,KAAMvf,KAAKkF,QAEtDlF,KAAKuf,KAAKzL,UAAUpL,OAAS1I,KAAK0I,MAG7BmO,EAAA,EAASH,2PCxBb,MAAM+I,EAAW,SACtB5B,EACA6B,EACAC,EAAyB,MAAM,IAE/B,IAAK,IAAItiB,EAAI,EAAGA,EAAIwgB,EAAM5Z,OAAS,EAAG5G,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAI0hB,EAAMnY,MAAQ,EAAGvJ,IAAK,CACxC,MAAMkK,EAAOwX,EAAMpL,GAAGtW,EAAGkB,GACvBmK,EAAKqW,EAAMpL,GAAGtW,EAAGkB,EAAI,GACrBoK,EAAOoW,EAAMpL,GAAGtW,EAAGkB,EAAI,GACvBqK,EAAOmW,EAAMpL,GAAGtW,EAAI,EAAGkB,GACvBsK,EAAQkW,EAAMpL,GAAGtW,EAAI,EAAGkB,GAErBsiB,KAA0B,MAAbtZ,EAAKpH,MAKR,MAAbyI,EAAKzI,KACS,MAAd0I,EAAM1I,KACK,MAAXuI,EAAGvI,KACU,MAAbwI,EAAKxI,MAMQ,MAAbyI,EAAKzI,KACS,MAAd0I,EAAM1I,KACK,MAAXuI,EAAGvI,KACU,MAAbwI,EAAKxI,MAMS,MAAbyI,EAAKzI,KAA6B,MAAd0I,EAAM1I,KACf,MAAXuI,EAAGvI,KAA4B,MAAbwI,EAAKxI,MAExB4e,EAAM9S,QAAQ5O,EAAGkB,EAAGqiB,OAK1B,OAAO7B,GAGI+B,EAAe,SAC1Bzf,EACA0d,EACAgC,GAEA,IAAK,IAAI1jB,EAAI,EAAGA,EAAI0hB,EAAMnY,MAAQ,EAAGvJ,IACnC,IAAK,IAAIkB,EAAI,EAAGA,EAAIwgB,EAAM5Z,OAAS,EAAG5G,IAChCwgB,EAAMpL,GAAGtW,EAAGkB,GAAG2L,mBAAqBtE,KAAKc,SAAWrF,GACtD0d,EAAM5G,YAAY,IAAI5E,EAAA,EAAMlW,EAAGkB,GAAIwiB,EAAcC,KAAK,OAK5D,OAAOjC,GAoBIkC,EAAa,SAASlC,GACjC,IAAImC,EAAOnC,EAAMnY,MACfua,EAAOpC,EAAM5Z,OACbic,EAAO,EACPC,EAAO,EAET,IAAK,IAAI9iB,EAAI,EAAGA,EAAIwgB,EAAM5Z,OAAS,EAAG5G,IACpC,IAAK,IAAIlB,EAAI,EAAGA,EAAI0hB,EAAMnY,MAAQ,EAAGvJ,IAC9B0hB,EAAMpL,GAAGtW,EAAGkB,GAAG2L,oBAIpBmX,EAAOzb,KAAK5B,IAAIzF,EAAG8iB,GACnBD,EAAOxb,KAAK5B,IAAI3G,EAAG+jB,GACnBD,EAAOvb,KAAKyH,IAAI9O,EAAG4iB,GACnBD,EAAOtb,KAAKyH,IAAIhQ,EAAG6jB,IAIvB,MAAMxZ,EAAK9B,KAAKC,OAAOkZ,EAAMnY,OAASwa,EAAOF,IAAS,GAAKA,EACzDI,EAAK1b,KAAKC,OAAOkZ,EAAM5Z,QAAUkc,EAAOF,IAAS,GAAKA,EAKxD,OAHAzjB,OAAA6V,EAAA,EAAA7V,CAAMqhB,EAAMrZ,IAAKgC,GACjBqX,EAAMrZ,IAAI2B,QAAQka,GAAO7jB,OAAA6V,EAAA,EAAA7V,CAAM6jB,EAAKD,IAE7BvC,GAKIyC,EAAmB,SAC9BzC,EACA1J,EACAoM,GAEA,IAAIC,EAAQ3C,EAAMnY,MAAQmY,EAAM5Z,OAEhC,KAAOuc,EAAQ,GAAG,CAChB,MAAMnc,EAAI7H,OAAA2H,EAAA,OAAA3H,CAAO,EAAGqhB,EAAMnY,MAAQ,GAChCN,EAAI5I,OAAA2H,EAAA,OAAA3H,CAAO,EAAGqhB,EAAM5Z,OAAS,GAE/B,GAAIkQ,EAAM0J,EAAMpL,GAAGpO,EAAGe,IAEpB,OADAmb,EAAQlc,EAAGe,GACJyY,EAGT2C,IAGF,KAAM,+BAGKC,EAAuB,SAClC5C,EACA1J,GAEA,IAAIqM,EAAQ3C,EAAMnY,MAAQmY,EAAM5Z,OAEhC,KAAOuc,EAAQ,GAAG,CAChB,MAAMnc,EAAI7H,OAAA2H,EAAA,OAAA3H,CAAO,EAAGqhB,EAAMnY,MAAQ,GAChCN,EAAI5I,OAAA2H,EAAA,OAAA3H,CAAO,EAAGqhB,EAAM5Z,OAAS,GAC7BoC,EAAOwX,EAAMpL,GAAGpO,EAAGe,GAErB,GAAI+O,EAAM9N,GACR,OAASA,OAAMhC,IAAGe,KAGpBob,MAISE,EAAe,SAC1B7C,EACA1J,EACAoM,GAEA1C,EAAM8C,KAAK,CAACta,EAAMhC,EAAGe,KACf+O,EAAM9N,IACRka,EAAQla,EAAMhC,EAAGe,oCC7JvB,IAAYwb,EA0CAC,kEA1CZ,SAAYD,GACVA,IAAA,2BACAA,IAAA,6BACAA,IAAA,+CACAA,IAAA,yBAJF,CAAYA,WA0CZ,SAAYC,GACVA,EAAA,gBACAA,EAAA,UACAA,EAAA,gBACAA,EAAA,gBACAA,EAAA,cACAA,EAAA,cACAA,EAAA,gBACAA,EAAA,kBACAA,EAAA,YACAA,EAAA,YACAA,EAAA,YACAA,EAAA,YACAA,EAAA,YACAA,EAAA,cACAA,EAAA,YACAA,EAAA,gBACAA,EAAA,cAjBF,CAAYA,yIChDL,MAAMC,GACX5iB,KAAM,QACN8G,mBACE6W,SAAU,EACVkF,UAAW,EACXjF,aAAc,EACdkF,aAAc,EACdC,OAAQ,EACRC,SAAU,GAEZtc,gBAAiB,IAGNuc,GACXjjB,KAAM,QACN8G,mBACE6W,SAAU,GACVkF,UAAW,EACXjF,aAAc,EACdkF,aAAc,EACdC,OAAQ,EACRC,SAAU,GAEZtc,gBAAiB,GAGNwc,GAAoBN,EAAWK,sGC1BhCE,UAAZ,SAAYA,GACVA,IAAA,iBACAA,IAAA,uBACAA,IAAA,mBACAA,IAAA,2BAJF,CAAYA,iBAONC,EAIJxhB,cAHQE,KAAAuhB,gBACAvhB,KAAAwhB,YAAsB,EAIvB1hB,cAAcwB,GACnBtB,KAAKwhB,aAAelgB,EAGfxB,eAAe0Z,GAEpBxZ,KAAKuhB,aAAahlB,KAAKid,GAGlB1Z,mBACLE,KAAKwhB,YAAc,EAGd1hB,kBAAkB0Z,GACvBhd,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKuhB,aAAczH,GAAUA,IAAWN,GAG1C1Z,SACL,OAAOE,KAAKwhB,YAAc,GAAKxhB,KAAKuhB,aAAallB,OAAS,EAGrDyD,OACDE,KAAKwhB,aAAe,IACtBxhB,KAAKwhB,aAAe,UAKbC,EAAb3hB,cACUE,KAAA2O,QAAmC,IAAIgK,IAE/CqB,oBACE,IAAI0H,KAQJ,OANA1hB,KAAK2O,QAAQxI,QAAQ,CAAC2T,EAAQpX,KACxBoX,EAAO6H,UACTD,EAAMnlB,KAAKmG,KAIRgf,EAGF5hB,UAAU4C,EAAkBpB,GACjCtB,KAAK4hB,aAAalf,GAAMmf,cAAcvgB,GAGjCxB,aAAa4C,GAClB1C,KAAK4hB,aAAalf,GAAMof,mBAGnBhiB,eAAe4C,EAAkB8W,GACtCxZ,KAAK4hB,aAAalf,GAAMqf,eAAevI,GAGlC1Z,kBAAkB4C,EAAkB8W,GACzCxZ,KAAK4hB,aAAalf,GAAMsf,kBAAkBxI,GAGrC1Z,OACLE,KAAK2O,QAAQxI,QAAQ2T,GAAUA,EAAO/Y,QAG9BjB,aAAa4C,GACrB,IAAIoX,EAAS9Z,KAAK2O,QAAQpQ,IAAImE,GAC9B,YAAe0F,IAAX0R,EACKA,GAGTA,EAAS,IAAIwH,EACbthB,KAAK2O,QAAQ0K,IAAI3W,EAAMoX,GAChBA,2FCjFEmI,UAAmBC,EAAA,EAC9BpiB,YAAoBoK,EAA4BhF,GAC9C1E,QADkBR,KAAAkK,WAA4BlK,KAAAkF,OAIzCpF,eAAegJ,GACpB,OAAOoZ,EAAA,EAASxL,QAGX5W,aAAaS,GAKlB,OAJAA,EAAOoZ,kBAAkB9N,EAAA,WAAWsW,WAAY,OAChD5hB,EAAOoZ,kBAAkB9N,EAAA,WAAWuW,SAAU,OAC9C7hB,EAAOoZ,kBAAkB9N,EAAA,WAAWwW,OAAQ,OAExC9hB,EAAO+hB,YAAY3G,QAAUpb,EAAOgiB,iBAAiBnG,eAChD7b,EAAO2D,GACZ,IAAI2H,EAAA,SAAS7L,KAAKkF,KAAMlF,KAAKkK,SAAU2B,EAAA,UAAUsW,cAIjD5hB,EAAO+hB,YAAY3G,QAAUpb,EAAOgiB,iBAAiBpG,gBACvD5b,EAAOkZ,eAAe5N,EAAA,WAAWsW,WAAY,OAE7C5hB,EAAO+hB,YAAY3G,QAAUpb,EAAOgiB,iBAAiBrG,YAErD3b,EAAOkZ,eAAe5N,EAAA,WAAWwW,OAAQ,OAChC9hB,EAAO+hB,YAAY3G,QAAUpb,EAAOgiB,iBAAiBtG,UAC9D1b,EAAOkZ,eAAe5N,EAAA,WAAWuW,SAAU,OAGtCF,EAAA,EAASxL,0OCnBP8L,UAAwBC,EAAA,EACnC3iB,YAAmB+d,EAAuB3T,EAAoBhF,GAC5D1E,MAAM0E,GADWlF,KAAA6d,QAAuB7d,KAAAkK,WAInCpK,MACDE,KAAK6d,MAAQ,GAAM,EACrB7d,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAAY,IAAIE,EAAA,2BAClC7L,KAAK6d,MACL7d,KAAKkK,SACLlK,KAAKkF,MAGPlF,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAAY,IAAIE,EAAA,wBAClC7L,KAAK6d,MACL7d,KAAKkK,SACLlK,KAAKkF,aAMAwd,UAAmBD,EAAA,EAC9B3iB,YACUkb,EACA9Q,EACRhF,GAEA1E,MAAM0E,GAJElF,KAAAgb,YACAhb,KAAAkK,WAMHpK,MACLE,KAAKkF,KAAK3E,OAAOoiB,cAAc3iB,KAAKkK,UACpClK,KAAKkF,KAAKjE,YAAa,EACvBjB,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAAY,IAAIiX,EAAA,EAClC5iB,KAAKgb,UACLhb,KAAKkK,SACLlK,KAAKkF,aAKE2d,UAA6BJ,EAAA,EACxC3iB,YAAoBoK,EAAoBhF,GACtC1E,MAAM0E,GADYlF,KAAAkK,WAIbpK,MAELE,KAAKkF,KAAK3E,OAAOoiB,cAAc3iB,KAAKkK,UACpClK,KAAKkF,KAAKjE,YAAa,EACvBjB,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAAY,IAAIE,EAAA,uBAClC7L,KAAKkK,SACLlK,KAAKkF,aAKE4d,UAAiBL,EAAA,EAA9B3iB,kCACSE,KAAA2L,UAA8B,KAC9B3L,KAAA+iB,SAAmB,EAEnBjjB,IACLS,EACA2J,EACAhF,GAEAlF,KAAK2L,UAAY,IAAIE,EAAA,cAAc3B,EAAUhF,GAC7CA,EAAKjE,YAAa,EAKbnB,QAAQoF,EAAYgF,GACzB,IAAIkJ,EAAQpT,KAAK6e,OAAOpY,MACxB,GAAI2M,EACFA,EAAM2L,WACD,GAAI7Z,GAAQgF,EAAU,CAC3BhF,EAAK3E,OAAO2D,GAAG,IAAI2H,EAAA,WAAW3B,EAAUhF,IAExC,IAAIkO,EAAQpT,KAAK6e,OAAOpY,MACpB2M,EACFA,EAAM2L,OAEN7Z,EAAK3E,OAAOW,GAAG8hB,YACf9d,EAAKjE,YAAa,EAClBjB,KAAK2L,UAAY,OAKhB7L,SAAS6L,GACd3L,KAAK2L,UAAYA,SAIRsX,UAAqBH,EAChChjB,YAAoBoB,GAClBV,QADkBR,KAAAkB,KAIbpB,IACLS,EACA2J,EACAhF,GAEA,IAAIkO,EAAQpT,KAAKkB,GAAGoZ,IAAI/Z,EAAQ2J,EAAUhF,GAI1C,OAFAA,EAAKjE,YAAa,EAEXmS,0FCzHE8P,UAA2BrM,EAAA,EACtC/W,YACSoJ,EACCgB,EACAhF,GAER1E,QAJOR,KAAAkJ,QACClJ,KAAAkK,WACAlK,KAAAkF,OAKHpF,aAAaC,GAKlB,OAJAA,EAAQ8d,MAAM5X,IAAI,GAAGE,QAAQ0X,IAC3B9d,EAAQmB,GAAG0W,UAAU,IAAIzK,EAAA,gBAAgB0Q,EAAO7d,KAAKkK,SAAUlK,KAAKkF,SAG/D2R,EAAA,EAASH,yFCdPyM,UAAuBtM,EAAA,EAClC/W,YACUsjB,EACAC,EACAne,EACAoe,GAER9iB,QALQR,KAAAojB,aACApjB,KAAAqjB,SACArjB,KAAAkF,OACAlF,KAAAsjB,WAKHxjB,eAAegJ,GAQpB,OANI9I,KAAKsjB,SACPxa,EAAS4Q,UAAU1Z,KAAKojB,WAAYpjB,KAAKsjB,UAEzCxa,EAAS2Q,eAAezZ,KAAKojB,WAAYpjB,KAAKqjB,QAGzCxM,EAAA,EAASH,gGCTP6M,UAAyB1X,EAAA,cACpC/L,YAAoByf,EAA6Bra,GAC/C1E,QADkBR,KAAAuf,OAA6Bvf,KAAAkF,OAI1CpF,eAAeoJ,GACpB,OAAO2C,EAAA,SAAS6K,QAGX5W,aAAaS,GAClB,MAAMuT,EAAY9T,KAAKuf,KAAKzL,UAE5B,QAAkB1L,IAAd0L,EACF,mCAAoC9T,KAAKuf,KAAKrhB,0BAQhD,OALA8B,KAAKuf,KAAKiE,UACVxjB,KAAKyjB,UAAUljB,EAAQuT,EAAUrL,MACjClI,EAAOwT,UAAU2P,SAAS5P,EAAUrL,KAAMqL,EAAUpL,OACpD1I,KAAKkF,KAAK2F,OAAO2Y,QAAQ1P,EAAUrL,MAE5BoD,EAAA,SAAS6K,QAGV5W,UAAUS,EAAgBkI,GAC5BA,aAAgBoD,EAAA,OAClBpD,EAAKjG,YAAY2D,QAASwd,IACxBpjB,EAAOqjB,iBAAiBrmB,OACtBf,OAAA2H,EAAA,UAAA3H,CACE+D,EAAOqjB,iBACPC,GAAcA,IAAeF,GAE/B,KAKNlb,EAAKkG,QAAQxI,QAAQ2T,IACnBvZ,EAAO2D,GAAG,IAAI2H,EAAA,kBAAkBiO,EAAQ9Z,KAAKkF,KAAMuD,EAAKvK,yGC3CjD4lB,UAAkBC,EAAA,EAG7BjkB,YACUyL,EACRrB,EACAhF,EACQ8e,EACAC,GAERzjB,MAAM0J,EAAUhF,GANRlF,KAAAuL,OAGAvL,KAAAgkB,kBACAhkB,KAAAikB,sBAIRjkB,KAAKkkB,WAAa3Y,EAAK2Y,WAGlBpkB,eAAeoJ,GAEpB,MAAMib,EAAOnkB,KAAKokB,WAAWlb,GAK7B,OAJIib,IACFnkB,KAAKuL,KAAKZ,UAAW,GAGnB3K,KAAKqkB,OAAOnb,IACdlJ,KAAKgkB,gBAAgBG,GAAM,GACpBG,EAAA,EAASC,OAETvkB,KAAKikB,oBAAoBE,GAAM,GAInCrkB,aAAaoJ,GAGlB,OAFAlJ,KAAKuL,KAAKZ,UAAW,EAEjB3K,KAAKqkB,OAAOnb,IACdlJ,KAAKgkB,iBAAgB,GAAM,GACpBM,EAAA,EAASC,OAETvkB,KAAKikB,qBAAoB,GAAM,GAIhCnkB,OAAOoJ,GACf,OAAOsb,EAAA,EAAWH,OAAOnb,EAAM3F,YAAavD,KAAKkkB,6GC5BxCO,UAA2BC,EAAA,EAItC5kB,YAAYoK,EAAoBhF,GAC9B1E,MAAM0J,EAAUhF,GAJXlF,KAAAod,aACCpd,KAAA2kB,UAAoB,EAI1B3kB,KAAK4kB,mBAGPC,WACE,OAAOH,EAAA,EAAkBI,UAGpBhlB,QAAQilB,GACb/kB,KAAKO,OAAO2D,GAAG,IAAI2H,EAAA,iBAAiBkZ,EAASC,cAAehlB,KAAKkF,OACjElF,KAAK2kB,UAAW,EAChB3kB,KAAK4kB,mBAGA9kB,MAAMilB,GACX/kB,KAAK4L,SACH,IAAIC,EAAA,oBACFqI,IACElU,KAAKO,OAAO2D,GACV,IAAI2H,EAAA,eACFkZ,EAASC,cACT9Q,EAAUzL,KACVzI,KAAKkF,OAITlF,KAAK2kB,UAAW,EAChB3kB,KAAK4kB,mBACL5kB,KAAK4L,SAAS5L,OAEhB+kB,EAASE,eACTjlB,KAAKkK,SACLlK,KAAKkF,OAKJpF,QACDE,KAAK2kB,SACP3kB,KAAKmB,UAELnB,KAAK4L,SAAS,IAAIsZ,EAAA,EAAcllB,KAAKkK,SAAUlK,KAAKkF,OAIhDpF,mBACNE,KAAKod,UAAYpd,KAAKO,OAAOwT,UAAUoR,QAAQ3gB,IAAIwgB,KAE/CA,cAAeA,EACfvc,KAAMuc,EAAclR,WAAakR,EAAclR,UAAUrL,KACzDC,MAAOsc,EAAclR,WAAakR,EAAclR,UAAUpL,MAC1Duc,eAAgBD,EAAcnP,cAAc7V,KAAKO,OAAOwT,+FCzE1CqR,UAAwCvO,EAAA,EAI5D/W,YACEoK,EACAhF,EACQsU,EACArF,GAER3T,MAAM0J,EAAUhF,GAHRlF,KAAAwZ,SACAxZ,KAAAmU,QAIRnU,KAAKgY,OAAShY,KAAKO,OAAOwR,YAAY/R,KAAKkK,UAC3ClK,KAAKqlB,UAAYnb,EAAS8H,YAAYhS,KAAKO,QAC3CP,KAAKslB,aASAxlB,MACLE,KAAKulB,eACLvlB,KAAKwlB,QAGPC,iBACE,OAAOzlB,KAAKgY,OAAOvF,GAAGzS,KAAKqlB,UAAUhhB,EAAGrE,KAAKqlB,UAAUjgB,GAGlDtF,WAAW4lB,GAChB,MAAM/T,EAAO3R,KAAKqlB,UAAUpf,IAAIyf,GAE5B1lB,KAAKmU,MAAMxC,IACb3R,KAAK2lB,aAAahU,GAId7R,eACNE,KAAKgY,OAAOvF,GAAGzS,KAAKqlB,UAAUhhB,EAAGrE,KAAKqlB,UAAUjgB,GAAGoU,YAASpR,EAGtDtI,aAAa8lB,GACnB5lB,KAAKulB,eACLvlB,KAAKqlB,UAAYO,EAAOC,OACxB7lB,KAAKslB,aAGCxlB,aACNE,KAAKylB,WAAWjM,OAASxZ,KAAKwZ,wFCvCrBsM,UAAmBja,EAAA,OAY9B/L,cACEU,QACAR,KAAK+lB,QAAU,IAAIla,EAAA,QACnB7L,KAAKgmB,SAAW,IAAIna,EAAA,SACpB7L,KAAKimB,OAAS,IAAIpa,EAAA,OAClB7L,KAAKue,SAAW,IAAI1S,EAAA,SACpB7L,KAAKkmB,OAAS,IAAIra,EAAA,OAClB7L,KAAKmmB,OAAS,IAAIta,EAAA,OAClB7L,KAAKomB,OAAS,IAAIva,EAAA,OAClB7L,KAAKqmB,QAAU,IAAIxa,EAAA,QAEnB7L,KAAKsmB,UAAY,IAAIza,EAAA,UAGhB/L,IACLoJ,EACAgB,EACAhF,GAGA,IAAIkO,EAuBJ,OAxBApT,KAAKgjB,YAGDhjB,KAAKumB,UAAUrd,IACZkK,EAAQpT,KAAKue,SAASjE,IAAIpR,EAAOgB,EAAUhF,MACpCkO,EAAQpT,KAAKqmB,QAAQ/L,IAAIpR,EAAOgB,EAAUhF,MAC1CkO,EAAQpT,KAAKimB,OAAO3L,IAAIpR,EAAOgB,EAAUhF,MACzCkO,EAAQpT,KAAKkmB,OAAO5L,IAAIpR,EAAOgB,EAAUhF,MAEnDkO,EAAQpT,KAAKwmB,QAAQtd,EAAOgB,EAAUhF,IAGxClF,KAAKymB,eAAevd,KACnBkK,EAAQpT,KAAK+lB,QAAQzL,IAAIpR,EAAOgB,EAAUhF,MAEjCkO,EAAQpT,KAAKue,SAASjE,IAAIpR,EAAOgB,EAAUhF,MAC3CkO,EAAQpT,KAAKqmB,QAAQ/L,IAAIpR,EAAOgB,EAAUhF,MAC1CkO,EAAQpT,KAAKimB,OAAO3L,IAAIpR,EAAOgB,EAAUhF,MAEnDkO,GAAQ,IAAIvH,EAAA,YAAayO,IAAIpR,EAAOgB,IAGtClK,KAAKgf,cAEE5L,EAGDtT,UAAUoJ,GAChB,OAAOA,EAAM0P,OAAOwC,aAAsC,GAAvBlS,EAAM0P,OAAO8N,QAG1C5mB,eAAeoJ,GACrB,OAAOA,EAAM0P,OAAOwC,aAAelS,EAAM0P,OAAO8N,QAAU,EAGpD5mB,QACNoJ,EACAgB,EACAhF,GAEA,IAAIkO,EAeJ,OAbKA,EAAQpT,KAAKgmB,SAAS1L,IAAIpR,EAAOgB,EAAUhF,IACzCgE,EAAM7H,MACTrB,KAAKmmB,OAAOQ,cACVzc,EAAS8H,YAAY9I,GACrBgB,EAASwB,aAAaxC,KAGhBkK,EAAQpT,KAAKsmB,UAAUhM,IAAIpR,EAAOgB,EAAUhF,MAC5CkO,EAAQpT,KAAKmmB,OAAO7L,IAAIpR,EAAOgB,EAAUhF,MAEnDkO,EAAQpT,KAAKomB,OAAO9L,IAAIpR,EAAOgB,EAAUhF,IAGpCkO,mFC7FEwT,EAAb9mB,cACSE,KAAA6mB,KAAe,EACf7mB,KAAAsB,SAEAxB,IAAI2I,EAAStB,GAClB,MAAM2f,EAAK9mB,KAAK6mB,KAAO1f,EAEnBnH,KAAKsB,MAAMwlB,GACRtqB,OAAA2L,EAAA,SAAA3L,CAASwD,KAAKsB,MAAMwlB,GAAKre,IAC5BzI,KAAKsB,MAAMwlB,GAAIvqB,KAAKkM,GAGtBzI,KAAKsB,MAAMwlB,IAAOre,GAIf3I,OAAO2I,GACZjM,OAAA2L,EAAA,QAAA3L,CAAQwD,KAAKsB,MAAO,CAAC3C,EAAOM,KAC1BzC,OAAA2L,EAAA,OAAA3L,CAAOmC,EAAOooB,GAAWA,IAAYte,KAGvCzI,KAAKsB,MAAQ9E,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKsB,MAAQmD,GAAaA,EAAIpI,OAAS,GAGtDyD,OACLE,KAAK6mB,KAAO7mB,KAAKgnB,WAEjB,MAAOD,GAAWvqB,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKsB,MAAMtB,KAAK6mB,MAAO,GAMhD,OAJqC,IAAjC7mB,KAAKsB,MAAMtB,KAAK6mB,MAAMxqB,eACjB2D,KAAKsB,MAAMtB,KAAK6mB,WAGNze,IAAZ2e,EAAwB/mB,KAAKinB,OAASF,EAGxCjnB,SACL,GAAyB,IAArBtD,OAAA2L,EAAA,KAAA3L,CAAKwD,KAAKsB,OACZ,SAGFtB,KAAK6mB,KAAO7mB,KAAKgnB,WACjB,MAAME,EAASlnB,KAAKsB,MAAMtB,KAAK6mB,MAI/B,cAFO7mB,KAAKsB,MAAMtB,KAAK6mB,MAEhBK,EAGDpnB,WACN,IAAI+mB,EAAOrqB,OAAA2L,EAAA,IAAA3L,CAAIA,OAAA2L,EAAA,KAAA3L,CAAKwD,KAAKsB,OAAOkD,IAAIH,GAAK8iB,SAAS9iB,KAElD,QAAa+D,IAATye,EACF,KAAM,sDAGR,OAAOA,mHCjEWO,UAAqBvb,EAAA,OACzC/L,YAAY5B,EAAcmpB,EAAeC,EAAcC,GACrD/mB,MAAMtC,EAAMmpB,EAAOC,EAAMC,UAwBhBC,UAA2BJ,EAC/BtnB,SAASS,WAILknB,UAA0BL,EAC9BtnB,SAASS,6FC9BLmnB,EAGX5nB,YACU6nB,EACAC,EACA7P,EACArS,EACAzB,EACA4jB,EACAC,GANA9nB,KAAA2nB,SACA3nB,KAAA4nB,SACA5nB,KAAA+X,SACA/X,KAAA0F,QACA1F,KAAAiE,SACAjE,KAAA6nB,eACA7nB,KAAA8nB,cAER9nB,KAAK+nB,aAAe/nB,KAAK+X,OAAS/X,KAAK+X,OAGlCjY,OACLE,KAAK8nB,YAAY9nB,KAAK2nB,OAAQ3nB,KAAK4nB,OAAQ,GAEtC5nB,KAAK6nB,aAAaG,QAAQhoB,KAAK2nB,OAAQ3nB,KAAK4nB,WAC5C,EAAG,IAAK,GAAI,KAAM,EAAG,KAAM,GAAI,IAAIzhB,QAAQ,EAAEK,EAAI4Z,MAClDpgB,KAAKioB,UAAU,EAAG,EAAK,EAAK,EAAGzhB,EAAI4Z,EAAI,GACvCpgB,KAAKioB,UAAU,EAAG,EAAK,EAAKzhB,EAAI,EAAG,EAAG4Z,KAKpCtgB,UACNugB,EACA6H,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,GAAIL,EAAQC,EACV,OAGF,IAAIK,EAAW,EACXC,GAAU,EAEd,IAAK,IAAIC,EAAWrI,EAAKqI,GAAY1oB,KAAK+X,SAAW0Q,EAASC,IAAY,CACxE,IAAIC,GAAUD,EAEd,IAAK,IAAIE,GAAkBF,EAAUE,GAAU,EAAGA,IAAU,CAC1D,IAAIC,EAAWnkB,KAAK0C,MAAMpH,KAAK2nB,OAASiB,EAASR,EAAKO,EAASN,GAC3DS,EAAWpkB,KAAK0C,MAAMpH,KAAK4nB,OAASgB,EAASN,EAAKK,EAASJ,GAC3DQ,GAAaH,EAAS,KAAQD,EAAS,IACvCK,GAAcJ,EAAS,KAAQD,EAAS,IAE5C,GAEIE,GAAY,GACZC,GAAY,GACZD,EAAW7oB,KAAK0F,OAChBojB,EAAW9oB,KAAKiE,UAElBikB,EAAQc,GAPV,CAUO,GAAIb,EAAMY,EACf,MAIE/oB,KAAKipB,eAAeL,EAAQD,IAAW3oB,KAAK+nB,cAC9C/nB,KAAK8nB,YACHe,EACAC,EACA,EAAI9oB,KAAKipB,eAAeL,EAAQD,GAAU3oB,KAAK+nB,cAI/CU,EAEEzoB,KAAK6nB,aAAaG,QAAQa,EAAUC,GAEtCN,EAAWQ,GAEXP,GAAU,EACVP,EAAQM,GAIRxoB,KAAK6nB,aAAaG,QAAQa,EAAUC,IACpCJ,EAAW1oB,KAAK+X,SAGhB0Q,GAAU,EACVzoB,KAAKioB,UAAUS,EAAW,EAAGR,EAAOa,EAAWX,EAAIC,EAAIC,EAAIC,GAC3DC,EAAWQ,MAOblpB,eAAeuE,EAAWe,GAChC,OAAOf,EAAIA,EAAIe,EAAIA,mFCrGV8jB,EAGXppB,YAAsBgD,EAAoB6Y,EAAkB7Y,GAAtC9C,KAAA8C,MAAoB9C,KAAA2b,UAFnC3b,KAAAmpB,aAIPzC,cACE,OAAO1mB,KAAK8C,IAGdsmB,YACE,OAAOppB,KAAK8C,MAAQ9C,KAAK2b,QAGpB7b,SAASupB,GACdrpB,KAAK2b,SAAW0N,EAGXvpB,SAASupB,GACdrpB,KAAK2b,QAAUjX,KAAKyH,IAAInM,KAAK2b,QAAU0N,EAAUrpB,KAAK8C,KAGjDhD,iBAAiBupB,GACtBrpB,KAAK8C,KAAOumB,EACZrpB,KAAKwc,SAAS6M,GAGTvpB,iBAAiBupB,GACtBrpB,KAAK8C,KAAOumB,EACZrpB,KAAKsb,SAAS+N,GAGTvpB,YAAYupB,GACjBrpB,KAAKmpB,UAAU5sB,KAAK8sB,GAGfvpB,eAAeupB,GACpB7sB,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKmpB,UAAW1kB,GAAOA,IAAQ4kB,GAGxCjO,mBACE,OAAOpb,KAAK2b,QAAUnf,OAAA2L,EAAA,IAAA3L,CAAIwD,KAAKmpB,6FCpCtBG,UAAezS,EAAA,EACnB/W,IACLoJ,EACAgB,EACAhF,GAEA,MAAMgN,EAAMhI,EAAS8H,YAAY9I,GAEjC,OAAOlJ,KAAKyR,KAAKvI,EAAOgB,EAAUhF,EAAOY,IAAkBoM,EAAIR,GAAG5L,qFCTzDyjB,UAAuB1S,EAAA,EAClC/W,YAAmBkb,EAAsB9Q,EAAoBhF,GAC3D1E,MAAM0J,EAAUhF,GADClF,KAAAgb,YAInBtY,WACE,OAAOmU,EAAA,EAAc2S,MAGvBC,iBACE,OAAOzpB,KAAKkF,KAAK3E,OAAOrC,sFCTfwrB,UAAuB7S,EAAA,EAClC/W,YACUuG,EACAsC,EACAzD,GAER1E,QAJQR,KAAAqG,OACArG,KAAA2I,QACA3I,KAAAkF,OAKHpF,eAAegJ,GAKpB,OAJA9I,KAAK2I,MAAMxC,QAAQ,EAAGsC,OAAMC,YAC1BI,EAAS6gB,WAAWlhB,EAAMC,KAGrBmO,EAAA,EAASH,QAGX5W,aAAaS,GAUlB,OARAP,KAAK2I,MAAMxC,QAAQ,EAAGsC,OAAMC,YAC1BnI,EAAOopB,WAAWlhB,EAAMC,GACxBnI,EAAO+hB,YAAYsH,SAASnhB,EAAKlG,OAASmG,GAE1C1I,KAAKkF,KAAK2F,OAAOgf,YAAYphB,EAAMC,GACnC1I,KAAKqG,KAAKkR,QAAQ9O,EAAMC,KAGnBmO,EAAA,EAASH,yFC9BPoT,UAAqBjT,EAAA,EACzB/W,aAAaS,GAGlB,OAFAP,KAAK+pB,aAAaxpB,GAEXsW,EAAA,EAASH,QAGR5W,aAAaS,GACrBA,EAAOqY,OAAOoR,iBAAiBzpB,EAAOub,aAAac,gBAE/Crc,EAAOqY,OAAO8N,QAAU,GAC1BnmB,EAAOqY,OAAOoR,iBAAiB,EAAIzpB,EAAOqY,OAAO8N,+ECVjCuD,EACpBnqB,YAAmBoqB,GAAAlqB,KAAAkqB,SAIZpqB,QACL,OAAQ,SAICqqB,UAA6BF,EACxCnqB,YACkB2I,EACR2hB,EACRF,GAEA1pB,MAAM0pB,GAJUlqB,KAAAyI,OACRzI,KAAAoqB,SAMHtqB,YAAYkY,GACjB,GAAIhY,KAAKoB,OACP,OAGF,MAAO0E,GAAS9F,KAAKoqB,OAAO7sB,OAAO,EAAG,GAChC8I,EAAO2R,EAAOvF,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAElCiB,EAAKqM,QACPrM,EAAKmT,OAAS,IAGdxZ,KAAKqqB,YAAYrS,GAIdlY,OACL,OAA8B,IAAvBE,KAAKoqB,OAAO/tB,sHC/BViuB,UAAmBC,EAAA,EAC9BzqB,YACS0qB,EACA1U,EACC5L,EACAhF,GAER1E,QALOR,KAAAwqB,SACAxqB,KAAA8V,UACC9V,KAAAkK,WACAlK,KAAAkF,OAKHpF,eAAeoJ,GACpB,OAAOlJ,KAAKyqB,QAAQvhB,GAAO,GAGtBpJ,aAAaS,GAClB,MAAMkW,EAAWzW,KAAKyqB,QAAQlqB,GAAQ,GAMtC,OAJIkW,IAAa8T,EAAA,EAAS5S,KACxBpX,EAAO2D,GAAG,IAAIwmB,EAAA,EAAmB1qB,KAAKwqB,OAAQxqB,KAAKkK,SAAUlK,KAAKkF,OAG7DuR,EAGC3W,QAAQoJ,EAAiByhB,GACjC,MAAOlU,EAAU3J,GAAU9M,KAAK4qB,MAAM1hB,GAWtC,OATAlJ,KAAKkF,KAAK2F,OAAOggB,aAAa/U,QAC5BhJ,EACA5D,EACAlJ,KAAKwqB,OACL/T,EACAzW,KAAK8V,QACL6U,GAGKlU,EAGC3W,MAAMoJ,GACd,GAAIsb,EAAA,EAAWsG,OAAO5hB,EAAM3F,YAAavD,KAAKwqB,OAAOjnB,aACnD,OAAQgnB,EAAA,EAAShG,MAAO,GAI1B,MAAMwG,EAAY,IAAIlf,EAAA,UACpB2Y,EAAA,EAAWwG,aAAa9hB,EAAM4P,aAAc5P,EAAMqG,OAAOrP,UACzD+qB,EAAA,EAAUjb,QACVhQ,KAAKkK,SACLlK,KAAKkF,MAGP,OAAQlF,KAAKwqB,OAAOtmB,GAAG6mB,GAAYA,EAAUje,iGCtDpCoe,UAAsBC,EAAA,EACjCrrB,YAAoBuL,EAAYnB,EAAoBhF,GAClD1E,MAAM0J,EAAUhF,GADElF,KAAAqL,OAIbvL,eAAegJ,GAQpB,OAPI9I,KAAKqL,KAAKxB,KACZ7J,KAAKkF,KAAK2F,OAAOugB,WAAWC,eAE5BrrB,KAAKqL,KAAKxB,MAAO,EACjB7J,KAAKkF,KAAK2F,OAAOugB,WAAWvhB,QAGvBgN,EAAA,EAASH,iGChBP4U,UAAwBzU,EAAA,EACnC/W,YAAoBgC,EAAgCypB,GAClD/qB,QADkBR,KAAA8B,aAAgC9B,KAAAurB,SAI7CzrB,aAAaS,GAClB,GAAIP,KAAKurB,OAAOC,OAAOxrB,KAAK8B,cAAgB2pB,EAAA,EAAaC,UACvD,eAAgB1rB,KAAKurB,OAAOrtB,uBAC1B8B,KAAK8B,WAAW5D,2BAOpB,OAHA8B,KAAKurB,OAAOI,QAAQprB,GACpBP,KAAK8B,WAAW8pB,QAAU,EAEnB/U,EAAA,EAASH,4KCfRmV,UAAZ,SAAYA,GACVA,IAAA,yBACAA,IAAA,yBACAA,IAAA,6BAHF,CAAYA,iBAMUC,EACpBhsB,YACkB5B,EACAmpB,EACTC,EACSC,GAHAvnB,KAAA9B,OACA8B,KAAAqnB,QACTrnB,KAAAsnB,OACStnB,KAAAunB,UAKXznB,QAAQS,GACbP,KAAKsnB,MAAQ,EACbtnB,KAAK+rB,SAASxrB,GAGTT,OAAOgC,GACZ,OAAI9B,KAAKsnB,OAAStnB,KAAKunB,QACdsE,EAAaG,UACXhsB,KAAKqnB,MAAQvlB,EAAWmc,UAAYnc,EAAW8pB,OACjDC,EAAaI,YAEbJ,EAAaH,iBAKJQ,EAGpBpsB,YACkBsJ,EACAlL,EACT2f,EAAgB,EAChB+N,EAAiB,EACjBO,GAJSnsB,KAAAoJ,KACApJ,KAAA9B,OACT8B,KAAA6d,QACA7d,KAAA4rB,SACA5rB,KAAAmsB,iBAMEC,EACXtsB,YACSusB,EACCC,EACAC,GAFDvsB,KAAAqsB,OACCrsB,KAAAssB,WACAtsB,KAAAusB,WAGHzsB,UAAUS,GACf,IACIisB,EADAC,KA6BJ,OA1BIzsB,KAAK0sB,UAAUnsB,GACjBisB,EAAmBxsB,KAAK2sB,oBAAoBpsB,GACnCP,KAAK4sB,qBAAqBrsB,KACnCisB,EAAmBxsB,KAAK6sB,YAAYtsB,SAGb6H,IAArBokB,GACFC,EAAYlwB,KAAKiwB,GAGfxsB,KAAK4sB,qBAAqBrsB,GAC5BisB,EAAmBxsB,KAAK6sB,YACtBtsB,EACAisB,GAAoBA,EAAiBpjB,IAE9BpJ,KAAK0sB,UAAUnsB,KACxBisB,EAAmBxsB,KAAK2sB,oBACtBpsB,EACAisB,GAAoBA,EAAiBpjB,UAIhBhB,IAArBokB,GACFC,EAAYlwB,KAAKiwB,GAGZC,EAGC3sB,UAAUS,GAClB,OAAOA,EAAOksB,YAAYK,KACxBhrB,GAAcA,EAAW+b,MAAQ7d,KAAKssB,UAIhCxsB,oBACRS,EACAwsB,GAEA,OAAOvwB,OAAA2L,EAAA,OAAA3L,CACL+D,EAAOksB,YAAYxY,OAAOnS,GACjBirB,IAAcjrB,EAAWsH,KAK5BtJ,qBAAqBS,GAC7B,OACEA,EAAOksB,YAAYpwB,OAAS2D,KAAKusB,UACjCvsB,KAAKqsB,KAAKhwB,OAASkE,EAAOksB,YAAYpwB,OAIhCyD,YACRS,EACAwsB,GAEA,MAAMC,EAAYzsB,EAAOksB,YAAYjoB,IAAI1C,GAAcA,EAAWsH,IAMlE,YAJkBhB,IAAd2kB,GACFC,EAAUzwB,KAAKwwB,GAGVvwB,OAAA2L,EAAA,OAAA3L,CACLwD,KAAKqsB,KAAKpY,OAAOnS,IAAetF,OAAA2L,EAAA,SAAA3L,CAASwwB,EAAWlrB,EAAWsH,8HC9GxD6jB,UAAyB1C,EAAA,EAGpCzqB,YACU2C,EACAyH,EACAhF,GAER1E,QAJQR,KAAAyC,UACAzC,KAAAkK,WACAlK,KAAAkF,OALFlF,KAAAktB,eAA2B3C,EAAA,EAAS7T,QAUrC5W,eAAegJ,GACpB,OAAIA,EAASyG,OAAO/L,SAAS0L,kBACpBpG,EAAS5E,GACd,IAAIipB,EAAA,EAAUntB,KAAKyC,QAAS2qB,EAAA,EAAU1iB,KAAM1K,KAAKkK,SAAUlK,KAAKkF,OAG3DqlB,EAAA,EAASpP,OAIbrb,aAAaS,GAIlB,OAHAP,KAAKqtB,gBAAgB9sB,GACrBP,KAAKstB,gBAAgB/sB,GACrBP,KAAKutB,gBAAgBhtB,GACdP,KAAKktB,eAGJptB,gBAAgBS,GACpBA,EAAOc,MAIXd,EAAOwT,UAAUoR,QAAQhf,QAAS6e,IAChC,GACEA,EAAclR,WACdkR,EAAclR,UAAUrL,KAAKyG,kBAC7B,CACA,MAAMzG,KAAEA,EAAIC,MAAEA,GAAUsc,EAAclR,UAEtC,OAAQrL,EAAKjF,SAAS0L,mBACpB,KAAKse,EAAA,EAAYvc,UAEXwc,EAAA,EAAWttB,OAAO,EAAG,IAAMsI,EAAKilB,WAClC1tB,KAAKkF,KAAK2F,OAAO8iB,YAAYllB,GAE/B,MACF,KAAK+kB,EAAA,EAAYpc,QACf,GAAIqc,EAAA,EAAWttB,OAAO,EAAG,GAAI,CAC3B,MAAMytB,EAAiBH,EAAA,EAAWrhB,YAAY1D,GAC9C1I,KAAKkF,KAAK2F,OAAOgjB,mBAAmBplB,EAAMmlB,GAE1CrtB,EAAO2D,GACL,IAAI4pB,EAAA,EAAgB9I,EAAe4I,EAAgB5tB,KAAKkF,YAS5DpF,gBAAgBS,GACpBA,EAAOc,MAIXd,EAAOwT,UAAUC,QAAQ7N,QAAQ,EAAGuC,QAAOD,WACzC,OAAQA,EAAKjF,SAAS0L,mBACpB,KAAKse,EAAA,EAAYvc,UACXwc,EAAA,EAAWttB,OAAO,EAAG,IAAMsI,EAAKilB,WAClC1tB,KAAKkF,KAAK2F,OAAO8iB,YAAYllB,GAE/B,MACF,KAAK+kB,EAAA,EAAYpc,QACf,GAAIqc,EAAA,EAAWttB,OAAO,EAAG,GAAI,CAC3B,MAAMytB,EAAiBH,EAAA,EAAWrhB,YAAY1D,GAC9C1I,KAAKkF,KAAK2F,OAAOgjB,mBAAmBplB,EAAMmlB,GAC1CrtB,EAAOwT,UAAUga,cAActlB,EAAMmlB,OAOrC9tB,gBAAgBS,GACxBA,EAAOwT,UAAUia,UAAU7nB,QAAS8nB,IAClC,IAAI1tB,EAAOc,MAIP4sB,EAAS/e,kBACX,GAAI+e,EAASna,UACX9T,KAAKkF,KAAK2F,OAAOqjB,6BACfD,EACAA,EAASna,UAAUrL,MAErBzI,KAAKmuB,cAAc5D,EAAA,EAASpP,YACvB,CACL,IAAI1E,EAAWlW,EAAO2D,GACpB,IAAIipB,EAAA,EACFntB,KAAKyC,QACL2qB,EAAA,EAAU1iB,KACV1K,KAAKkK,SACLlK,KAAKkF,OAGTlF,KAAKkF,KAAK2F,OAAOujB,oBAAoBH,EAAUxX,GAC/CzW,KAAKmuB,cAAc1X,MAMjB3W,cAAc2W,GAClBzW,KAAKktB,iBAAmB3C,EAAA,EAAShP,MAAQ9E,IAAa8T,EAAA,EAAS5S,IACjE3X,KAAKktB,eAAiB3C,EAAA,EAAS5S,IACtB3X,KAAKktB,iBAAmB3C,EAAA,EAAShP,KAC1Cvb,KAAKktB,eAAiB3C,EAAA,EAAShP,KAE/Bvb,KAAKktB,eAAiBzW,yGChIf4X,UAAiBhc,EAAA,EAI5BvS,YAA4B5B,EAAcsG,GACxChE,MAAMgE,GADoBxE,KAAA9B,OAHrB8B,KAAAsuB,aAKLtuB,KAAKuuB,SAAW,IAAIC,EAAA,EAGf1uB,QACLE,KAAKuuB,SAAW,IAAIC,EAAA,EAGf1uB,QACLE,KAAKmX,QACLnX,KAAKsuB,UAAUnoB,QAAQ2C,GACrB9I,KAAKuuB,SAAStoB,IAAI6C,EAASM,GAAIN,EAASmQ,QAIrCnZ,aAAagJ,GAClB,IAAIzC,EAQJ,GANArG,KAAK2gB,KAAK/hB,IACJA,EAAEkK,UAAYlK,EAAEkK,SAASM,KAAON,EAASM,KAC3C/C,EAAOzH,MAINyH,EACH,iBAAkByC,EAASM,MAAMN,EAAS5K,4BACxC8B,KAAK9B,OAIT,OAAOmI,EAGFvG,YAAYgJ,GACjB,IAAIoJ,EAQJ,GANAlS,KAAK2gB,KAAK,CAACta,EAAMhC,EAAGe,KACdiB,EAAKyC,UAAYzC,EAAKyC,SAASM,KAAON,EAASM,KACjD8I,EAAM,IAAIG,EAAA,EAAMhO,EAAGe,OAIlB8M,EACH,iBAAkBpJ,EAASM,MAAMN,EAAS5K,4BACxC8B,KAAK9B,OAIT,OAAOgU,EAGFpS,YAAYoS,EAAYpJ,GAC7B9I,KAAKsuB,UAAU/xB,KAAKuM,GAEpB9I,KAAKyS,GAAGP,EAAI7N,EAAG6N,EAAI9M,GAAG0D,SAAWA,EACjC9I,KAAKuuB,SAAStoB,IAAI6C,EAASM,GAAIN,EAASmQ,OAGnCnZ,eAAegJ,GACpB,IAAIoJ,EAAMlS,KAAKgS,YAAYlJ,GAClB9I,KAAKyS,GAAGP,EAAI7N,EAAG6N,EAAI9M,GAEvB0D,cAAWV,EAChB5L,OAAAiyB,EAAA,OAAAjyB,CAAOwD,KAAKsuB,UAAWtwB,GAAKA,EAAEoL,KAAON,EAASM,IAC9CpJ,KAAKuuB,SAAS5T,OAAO7R,EAASM,IAGzBtJ,eAAeuE,EAAWe,GAC/B,OAAOpF,KAAKwE,IAAIH,GAAGe,GAAG+S,iBAGjBrY,gBAAgBuE,EAAWe,GAChC,OAAOpF,KAAKwE,IAAIH,GAAGe,GAAG4D,kBAGjBlJ,QAAQuE,EAAWe,EAAWiB,GACnCrG,KAAKwE,IAAIH,GAAGe,GAAKiB,EAGZvG,YAAY4uB,GACjB,IAAIC,EAUJ,GARA3uB,KAAK2gB,KAAK,CAACta,EAAMhC,EAAGe,MACdiB,aAAgBuoB,EAAA,GAAgBvoB,aAAgBuoB,EAAA,IAC9CvoB,EAAK4D,kBAAoBykB,IAC3BC,EAAW,IAAItc,EAAA,EAAMhO,EAAGe,MAK1BupB,EACF,OAAOA,EAGT,iBAAkB3uB,KAAK9B,iCAAiCwwB,wGClGhDG,yBAAZ,SAAYA,GACVA,IAAA,iBACAA,IAAA,eACAA,IAAA,qBACAA,IAAA,mBAJF,CAAYA,iBAcCC,EAUXhvB,YAAYS,GATLP,KAAA+uB,YAUL/uB,KAAK6qB,aAAe,IAAImE,EAAahvB,KAAMO,GAC3CP,KAAKorB,WAAa,IAAI6D,EAAWjvB,KAAMO,GAEvCP,KAAKkvB,YAAc,IAAIC,EAAkBnvB,KAAMO,GAC/CP,KAAKovB,aAAe,IAAIC,EAAmBrvB,KAAMO,GACjDP,KAAKsvB,gBAAkB,IAAIC,EAAsBvvB,KAAMO,GACvDP,KAAKwvB,SAAW,IAAIC,EAAezvB,KAAMO,GAGpCT,QACLE,KAAK+uB,YAGAjvB,YACLS,EACAuM,EACA5D,EACAwmB,GAEA1vB,KAAK2vB,WACAD,EAAOxxB,YAAY4O,iBACpB5D,EAAMhL,2BAKL4B,iBACLS,EACAuM,EACA5D,EACAwmB,EACA5Z,GAEA9V,KAAK2vB,WACAD,EAAOxxB,YAAY4O,iBAAsB5D,EAAMhL,WAChD4X,EAAQ5X,2BAKP4B,oBACLE,KAAK4vB,WAAWf,EAASgB,MAAO,uBAG3B/vB,cACLE,KAAK4vB,WAAWf,EAASgB,MAAO,+BAG3B/vB,kBACLE,KAAK4vB,WAAWf,EAASgB,MAAO,qCAG3B/vB,QAAQ2I,GACbzI,KAAK4vB,WAAWf,EAASgB,sBAAuBpnB,EAAKvK,QAGhD4B,MAAM2I,GACXzI,KAAK4vB,WAAWf,EAASgB,oBAAqBpnB,EAAKvK,QAG9C4B,MAAM2I,GACXzI,KAAK4vB,WAAWf,EAASiB,kBAAmBrnB,EAAKvK,QAG5C4B,oBACLE,KAAK4vB,WAAWf,EAASgB,MAAO,kCAG3B/vB,oBACLE,KAAK4vB,WAAWf,EAASgB,MAAO,+BAG3B/vB,mBAAmBoJ,GACxBlJ,KAAK4vB,WAAWf,EAASiB,QAAS5mB,EAAMhL,cAGnC4B,sBAAsBoJ,GAC3BlJ,KAAK4vB,WACHf,EAASiB,QACN5mB,EAAMhL,gDAIN4B,gCAAgCoJ,GACrClJ,KAAK4vB,WACHf,EAASiB,QACN5mB,EAAMhL,wDAIN4B,4BACLE,KAAK4vB,WAAWf,EAASiB,KAAM,2CAG1BhwB,mBACLE,KAAK4vB,WAAWf,EAASiB,KAAM,6CAG1BhwB,sBACLE,KAAK4vB,WACHf,EAASiB,KACT,mDAIGhwB,gCACLE,KAAK4vB,WAAWf,EAASiB,KAAM,uCAG1BhwB,gCACLE,KAAK4vB,WACHf,EAASiB,KACT,qDAIGhwB,mBACLS,EACA4jB,EACAwG,EACAzhB,GAEIyhB,EACF3qB,KAAK4vB,WAAWf,EAASiB,KAAM,qCAE/B9vB,KAAK4vB,WACHf,EAASiB,QACN5mB,EAAMhL,sCAKR4B,eACLS,EACA4jB,EACAwG,EACAzhB,GAEIyhB,EACF3qB,KAAK4vB,WAAWf,EAASiB,KAAM,uCAE/B9vB,KAAK4vB,WACHf,EAASiB,QACN5mB,EAAMhL,sCAKR4B,eACLE,KAAK4vB,WAAWf,EAASiB,KAAM,uCAG1BhwB,eAAeS,GACpBP,KAAK4vB,WACHf,EAASkB,QACT,4CAIGjwB,kBAAkBS,GACvBP,KAAK4vB,WAAWf,EAASiB,KAAM,8BAG1BhwB,aAAa2I,EAAYC,GAChB,IAAVA,EACF1I,KAAK4vB,WAAWf,EAASiB,sBAAuBrnB,EAAKvK,QAErD8B,KAAK4vB,WAAWf,EAASiB,sBAAuBpnB,KAASD,EAAKvK,QAI3D4B,YAAY2I,EAAYC,GACf,IAAVA,EACF1I,KAAK4vB,WAAWf,EAASiB,sBAAuBrnB,EAAKvK,QAErD8B,KAAK4vB,WAAWf,EAASiB,oBAAqBpnB,KAASD,EAAKvK,QAIzD4B,qBACLE,KAAKgwB,KAAK,6BAGLlwB,6BAA6BmuB,EAAoBxlB,GACtDzI,KAAKiwB,SAASxnB,EAAKvK,gBAAgB+vB,EAAS/vB,gBAGvC4B,oBAAoBmuB,EAAoBxX,GAC7C,OAAQA,GACN,KAAKnW,EAAA,SAASqX,IACZ3X,KAAKkwB,6BACmBjC,EAAS/vB,qCAEjC,MACF,KAAKoC,EAAA,SAASib,KACZvb,KAAKkwB,2BAA2BjC,EAAS/vB,QACzC,MACF,KAAKoC,EAAA,SAASoW,QACd,KAAKpW,EAAA,SAAS6a,OACZnb,KAAKkwB,6BAA6BjC,EAAS/vB,0BAK1C4B,gBACLS,EACA4jB,EACAwG,EACAlU,EACA3N,GAEA,GAAKqb,EAIL,OAAQ1N,GACN,KAAKnW,EAAA,SAASqX,IACZ3X,KAAKkwB,UAAUpnB,EAAS5K,mCACxB,MACF,KAAKoC,EAAA,SAASikB,MACZvkB,KAAKgwB,QAAQlnB,EAAS5K,iCACtB,MACF,KAAKoC,EAAA,SAASib,KACZvb,KAAK2vB,WAAW7mB,EAAS5K,0BACzB,MACF,KAAKoC,EAAA,SAASoW,QACd,KAAKpW,EAAA,SAAS6a,OACPwP,GACH3qB,KAAKiwB,SAASnnB,EAAS5K,yBAMxB4B,YAAY2I,GACjB,OAAQA,EAAKmG,gBACX,KAAK6F,EAAA,EAAe1F,SAClB,OAAO/O,KAAKgwB,QAAQvnB,EAAKvK,yBAC3B,KAAKuW,EAAA,EAAezF,OAClB,OAAOhP,KAAKgwB,QAAQvnB,EAAKvK,8BAC3B,KAAKuW,EAAA,EAAexF,MAClB,OAAOjP,KAAK2vB,WAAWlnB,EAAKvK,6BAI3B4B,mBAAmB2I,EAAYC,GACpC1I,KAAK2vB,WAAWjnB,KAASD,EAAKvK,8BAGzB4B,MAAMqwB,GACXnwB,KAAK4vB,WAAWf,EAASgB,MAAOM,GAG3BrwB,KAAKqwB,GACVnwB,KAAK4vB,WAAWf,EAASiB,KAAMK,GAG1BrwB,QAAQqwB,GACbnwB,KAAK4vB,WAAWf,EAASkB,QAASI,GAG7BrwB,OAAOqwB,GACZnwB,KAAK4vB,WAAWf,EAASuB,OAAQD,GAGzBrwB,WAAW+d,EAAiBsS,GACpC,MAAME,EAAkC7zB,OAAA2H,EAAA,KAAA3H,CAAKwD,KAAK+uB,UAE9CsB,GAAWA,EAAQF,UAAYA,EACjCE,EAAQC,SAAW,EAEnBtwB,KAAK+uB,SAASxyB,MAAOshB,QAAOsS,UAASG,QAAS,WAK9CC,EACJzwB,YAAoB+K,EAA0BtK,GAA1BP,KAAA6K,SAA0B7K,KAAAO,SAEpCT,MAAMqwB,GACdnwB,KAAK6K,OAAOolB,MAAME,GAGVrwB,KAAKqwB,GACbnwB,KAAK6K,OAAOmlB,KAAKG,GAGTrwB,QAAQqwB,GAChBnwB,KAAK6K,OAAO8kB,QAAQQ,GAGZrwB,OAAOqwB,GACfnwB,KAAK6K,OAAOqlB,OAAOC,UAIjBhB,UAA0BoB,EACvBzwB,MAAMqkB,EAAewG,EAAmB7hB,GACzC6hB,EACF3qB,KAAKgwB,KAAK,iCACD7L,GACTnkB,KAAKgwB,QAAQlnB,EAAS5K,oCAInB4B,OAAOqkB,EAAewG,EAAmB7hB,GAC1C6hB,EACF3qB,KAAKiwB,MAAM,mCACF9L,GACTnkB,KAAKiwB,SAASnnB,EAAS5K,8BAIpB4B,SAASqkB,EAAewG,EAAmB7hB,GAC5C6hB,EACF3qB,KAAKgwB,KAAK,+BACD7L,GACTnkB,KAAKgwB,QAAQlnB,EAAS5K,+BAInB4B,SAAS2I,GACdzI,KAAK2vB,+BAA+BlnB,EAAKvK,uBAGpC4B,SAAS2I,GACdzI,KAAK2vB,8BAA8BlnB,EAAKvK,6BAItCuxB,UAAuBc,EACpBzwB,MAAMqkB,EAAewG,EAAmB7hB,GACzC6hB,EACF3qB,KAAK2vB,QAAQ,wBACJxL,GACTnkB,KAAK2vB,WAAW7mB,EAAS5K,2BAItB4B,UAAUqkB,EAAewG,EAAmB7hB,GAC7C6hB,EACF3qB,KAAK2vB,QAAQ,gBACJxL,GACTnkB,KAAK2vB,WAAW7mB,EAAS5K,mBAItB4B,iBACLqkB,EACAwG,EACA7hB,GAEI6hB,EACF3qB,KAAK2vB,QAAQ,2BACJxL,GACTnkB,KAAK2vB,WAAW7mB,EAAS5K,qCAKzBmxB,UAA2BkB,EACxBzwB,UACLqkB,EACA1N,EACA3N,GAGA9I,KAAKgwB,QAAQlnB,EAAS5K,qCAGjB4B,YACLE,KAAKgwB,KAAK,kDAGLlwB,SACLE,KAAKgwB,KAAK,0DAIRT,UAA8BgB,EAC3BzwB,OAAOS,GAEZ,OAAOP,KAAKgwB,KAAK,qDAGZlwB,SACL,OAAOE,KAAKiwB,MAAM,0CAGbnwB,MACLS,EACA4jB,EACAwG,EACAzhB,GAEAlJ,KAAKgwB,QAAQ9mB,EAAMhL,6BAGd4B,SACLS,EACA4jB,EACAwG,EACAlU,EACAvN,GAEAlJ,KAAKgwB,QAAQ9mB,EAAMhL,+BAIjB+wB,UAAmBsB,EAChBzwB,cACLE,KAAKiwB,MAAM,wBAGNnwB,gBACLE,KAAKiwB,MAAM,0BAGNnwB,OACLE,KAAKiwB,MAAM,qBAGNnwB,QACLE,KAAKiwB,MAAM,4BAITjB,UAAqBuB,EAClBzwB,MACLgN,EACA5D,EACAwmB,EACAjZ,EACAkU,GAEA,OAAQlU,GACN,KAAKnW,EAAA,SAASib,KACZ,OAAOvb,KAAKiwB,SACPP,EAAOxxB,YAAY4O,iBAAsB5D,EAAMhL,QAEtD,KAAKoC,EAAA,SAASqX,IACZ,OAAO3X,KAAK2vB,WACPD,EAAOxxB,YAAY4O,iBACpB5D,EAAMhL,2BAGZ,KAAKoC,EAAA,SAASoW,QACZ,OAAO1W,KAAKiwB,0BACU/mB,EAAMhL,gCAG9B,KAAKoC,EAAA,SAAS6a,OACZ,OAAOnb,KAAKgwB,QAAQN,EAAOxxB,wBAE7B,KAAKoC,EAAA,SAASikB,MACZ,OAAOvkB,KAAKiwB,SAAS/mB,EAAMhL,eAAewxB,EAAOxxB,UAIhD4B,QACLgN,EACA5D,EACAwmB,EACAjZ,EACAX,EACA6U,GAEA,OAAQlU,GACN,KAAKnW,EAAA,SAASib,KACZ,OAAOvb,KAAKiwB,SACPP,EAAOxxB,YAAY4O,iBAAsB5D,EAAMhL,WAChD4X,EAAQ5X,QAGd,KAAKoC,EAAA,SAASqX,IACZ,OAAO3X,KAAK2vB,WACPD,EAAOxxB,YAAY4O,iBACpB5D,EAAMhL,2BAGZ,KAAKoC,EAAA,SAASoW,QACZ,OAAO1W,KAAKiwB,0BACU/mB,EAAMhL,gCAG9B,KAAKoC,EAAA,SAAS6a,OACZ,OAAOnb,KAAKgwB,QAAQN,EAAOxxB,wBAE7B,KAAKoC,EAAA,SAASikB,MACZ,OAAOvkB,KAAKiwB,SACP/mB,EAAMhL,eAAe4X,EAAQ5X,WAAWwxB,EAAOxxB,uGCzgB/CsyB,EAAb1wB,cACSE,KAAAywB,MAAgB,EACfzwB,KAAA6Y,KAA4B,IAAIF,IAEjC7Y,IAAI5B,GACT,MAAMyd,EAAU3b,KAAK6Y,KAAKta,IAAIL,GAC1Byd,EACF3b,KAAK6Y,KAAKQ,IAAInb,EAAMyd,EAAU,GAE9B3b,KAAK6Y,KAAKQ,IAAInb,EAAM,GAIxB8J,UACE,OAAOxL,OAAA2L,EAAA,OAAA3L,CAAOoJ,MAAMyD,KAAKrJ,KAAK6Y,MAAO,EAAE3a,EAAMwK,KAAWxK,wICD/CwyB,UAAoBC,EAAA,EAC/B7wB,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMmwB,EAAA,EAASC,QAASvqB,EAAMsE,GAGzB7K,OACLoS,EACA3R,EACA2J,EACAhF,GAEIgW,EAAA,EAAW/a,OAAO,EAAG,IACvB+E,EAAK2F,OAAOgmB,eAAetwB,GAGvB2a,EAAA,EAAW/a,OAAO,EAAG,IACvBH,KAAK2W,SAASzE,EAAKhN,EAAMgF,EAAU3J,IAGrCP,KAAK8wB,WAAW5e,EAAK3R,EAAQ2J,EAAUhF,GAIjCpF,WACR,OAAO,IAAI4wB,EAAY1wB,KAAKqG,KAAMrG,KAAK2K,UAGzCuZ,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,GAG7BomB,kCACE,OAAO,GAGFjxB,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAOA,EAAS5E,GACd,IAAI8sB,EAAA,EACFhxB,KACAkK,EACAhF,EACA,CAACif,EAAMwG,IACLzlB,EAAK2F,OAAOqkB,YAAY+B,MAAM9M,EAAMwG,EAAU7hB,GAChD,CAACqb,EAAMwG,KAEL,GACE7hB,EAASoR,qBAAuBla,KAAK+wB,4BAErC7rB,EAAK2F,OAAOqkB,YAAYniB,OAAOoX,EAAMwG,EAAU7hB,OAC1C,CACL,IAAI8c,EAAS5lB,KAAKkxB,UAChBhf,EACAhI,EACAgR,EAAA,EAAWiW,aAAa,EAAG,GAC3B9qB,GAAQA,EAAK2C,gBAAgBF,IAE3B8c,EAAOlU,GAAGQ,GACZhN,EAAK2F,OAAOqkB,YAAYniB,OAAOoX,EAAMwG,EAAU7hB,IAE/C5D,EAAK2F,OAAOqkB,YAAYvY,SAASwN,EAAMwG,EAAU7hB,GACjDA,EAAS5E,GAAG,IAAIktB,EAAA,EAAUlsB,EAAMgF,EAAU0b,KAI9C,GAAI+E,EAAU,CACZ,MAAMpqB,EAAS2E,EAAK3E,OAClBwT,EAAYxT,EAAOwT,YAGfA,EAAUsd,SACV,EACA5oB,GAAQvD,EAAK2F,OAAOqkB,YAAYoC,SAAS7oB,KAGzCsL,EAAUwd,cACV,GAAKhxB,EAAOsb,SAASF,QACrBlT,GAAQvD,EAAK2F,OAAOqkB,YAAYsC,SAAS/oB,KAGzCsL,EAAU0d,aACV,GAAKlxB,EAAOsb,SAASF,QACrBlT,GAAQvD,EAAK2F,OAAOqkB,YAAYsC,SAAS/oB,KAIzCtC,QACJ,EAAEoZ,EAAMmS,EAAW7mB,MAMf0U,EAAKzL,WACL4d,GAAa,GACbxW,EAAA,EAAW/a,OAAO,EAAGuE,KAAK0C,MAAMsqB,MAEhC7mB,EAAO0U,EAAKzL,UAAUrL,MACtBzI,KAAK2xB,UAAUzf,EAAKhI,EAAUqV,EAAKzL,UAAUrL,MAC7ClI,EAAO2D,GAAG,IAAI0tB,EAAA,EAAgBrS,EAAM,EAAGra,OAM/C,OAAO2sB,EAAA,SAASnb,WAMd5W,UAAUoS,EAAYhI,EAAoBzB,GAClD,IAAImd,EAAS5lB,KAAKkxB,UAChBhf,EACAhI,EACAgR,EAAA,EAAW9O,YAAY,EAAG,GACzB/F,GAAeA,EAAK0C,WAEvBmB,EAASuI,GAAGmT,EAAOvhB,EAAGuhB,EAAOxgB,GAAGmS,QAAQ9O,EAAM,GAGtC3I,UACRgyB,EACA5nB,EACA6nB,EACAre,GAEA,IAAIse,EAAUF,EACZG,GAAW,EAyBb,OAvBAz1B,OAAA01B,EAAA,QAAA11B,CAAQ21B,EAAA,EAAUnqB,KAAK7B,QAAQuf,IAC7B,IAAKuM,EAAU,CACb,IAAIG,GAAY,EAEhB51B,OAAA21B,EAAA,EAAA31B,CACEs1B,EACAA,EAAO7rB,IAAIyf,EAAU2M,SAASN,IAC9B,CAAC1tB,EAAGe,MAECgtB,GACDloB,EAASsI,QAAQ,IAAI2f,EAAA,EAAM9tB,EAAGe,KAC9BsO,EAAQxJ,EAASuI,GAAGpO,EAAGe,KAEvB4sB,EAAU,IAAIG,EAAA,EAAM9tB,EAAGe,GACvB6sB,GAAW,GAEXG,GAAY,OAOfJ,iIC/JLM,UAA0BC,EAAA,EAC9BzyB,YAAoByL,EAAYrB,EAAoBhF,GAClD1E,MAAM0J,EAAUhF,GADElF,KAAAuL,OAIpBwf,gBACE,OAAO,IAAIyH,EAAA,EAAUxyB,KAAKyC,QAASgwB,EAAA,EAAU/nB,KAAM1K,KAAKkK,SAAUlK,KAAKkF,MAGzEzC,cACE,QAAUC,KAAMgwB,EAAA,EAAW/vB,KAAMC,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,IAG/DjD,eAAegJ,GACpB,MAAM6pB,EAAe7pB,EAAS5E,GAAGlE,KAAK+qB,WAYtC,OAVI/qB,KAAKokB,WAAWtb,KAClB9I,KAAKuL,KAAKZ,UAAW,GAGvB3K,KAAKkF,KAAK2F,OAAOukB,aAAawD,UAC5B5yB,KAAKokB,WAAWtb,GAChB6pB,EACA7pB,GAGK6pB,EAGF7yB,aAAaS,GAGlB,GAFAP,KAAKuL,KAAKZ,UAAW,EAEjBpK,EAAOwT,UAAU8e,UAAUzjB,UAG7B,OAFApP,KAAKkF,KAAK2F,OAAOukB,aAAariB,SAEvB+lB,EAAA,EAAS3X,OACX,CACL,MAAMwX,EAAepyB,EAAO2D,GAAGlE,KAAK+qB,WAGpC,OAFA/qB,KAAKkF,KAAK2F,OAAOukB,aAAawD,WAAU,EAAMD,EAAcpyB,GAErDoyB,UAKAI,UAAqBpC,EAAA,EAChC7wB,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMmwB,EAAA,EAASqC,SAAU3sB,EAAMsE,GAG1B7K,OACLoS,EACA3R,EACA2J,EACAhF,GAGK3E,EAAOwT,UAAUkf,WAAW7jB,UAEtBoV,EAAA,EAAWrkB,OAAO,EAAG,IAC9B+E,EAAK2F,OAAOgmB,eAAetwB,GAE3BP,KAAK2W,SAASzE,EAAKhN,EAAMgF,EAAU3J,IAEnCP,KAAK8wB,WAAW5e,EAAK3R,EAAQ2J,EAAUhF,GANvCA,EAAK2F,OAAOukB,aAAa8D,YAUnBpzB,WACR,OAAO,IAAIizB,EAAa/yB,KAAKqG,KAAMrG,KAAK2K,UAG1CuZ,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,GAGtB7K,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAI0b,EAAA,EAAWH,OAAOvb,EAASvF,YAAavD,KAAKkkB,YACxC4O,EAAA,EAASvO,MAGXzb,EAAS5E,GAAG,IAAIouB,EAAkBtyB,KAAMkK,EAAUhF,oHCxFhDiuB,UAAwBxC,EAAA,EACnC7wB,YACUszB,EACR/sB,EACAsE,GAAoB,EACb0oB,EAAgB,GAEvB7yB,MAAMmwB,EAAA,EAAS2C,YAAajtB,EAAMsE,GAL1B3K,KAAAozB,UAGDpzB,KAAAqzB,gBAKFvzB,WACL,OAAO,IAAIqzB,EACTnzB,KAAKozB,QACLpzB,KAAKqG,KACLrG,KAAK2K,SACL3K,KAAKqzB,eAITnP,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,GAG7BlI,cACE,QAAUC,KAAMgwB,EAAA,EAAWplB,MAAOvK,MAAO,EAAGH,MAAQC,MAAO,EAAGC,IAAK,KAG9DhD,OACLoS,EACA3R,EACA2J,EACAhF,GAEA,GAAIiI,EAAA,WAAWhN,OAAO,EAAG,GAAI,CAC3B+E,EAAK2F,OAAOgmB,eAAetwB,GAE3B,MAAMuI,EAAWoB,EAASuI,GAAGP,EAAI7N,EAAG6N,EAAI9M,GAAG0D,SACvCA,EACF9I,KAAK2W,SAASzE,EAAKhN,EAAMgF,EAAUpB,GAEnC9I,KAAKuzB,aAAarhB,EAAKhI,EAAUhF,EAAK2F,aAGxC7K,KAAK8wB,WAAW5e,EAAK3R,EAAQ2J,EAAUhF,GAIpCpF,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAK9I,KAAKuzB,aAAarhB,EAAKhI,EAAUhF,EAAK2F,QAIpC/B,EAAS5E,GACd,IAAIiJ,EAAA,UACFnN,KACAkK,EACAhF,EACA,CAACif,EAAMwG,IACLzlB,EAAK2F,OAAOykB,gBAAgB2B,MAC1B/rB,EAAK3E,OACL4jB,EACAwG,EACA7hB,GAEJ,CAACqb,EAAMwG,KACL,GAAIA,GAAYzlB,EAAK3E,OAAOwT,UAAUsd,SAASliB,KAE7C,OADAjK,EAAK2F,OAAOykB,gBAAgBviB,OAAO7H,EAAK3E,QACjC4M,EAAA,SAASgO,OAGlB,MAAM2D,EAAMhW,EAAS5E,GACnB,IAAIsuB,EAAA,EAAUxyB,KAAKyC,QAASgwB,EAAA,EAAU/nB,KAAMR,EAAUhF,IAWxD,OARAA,EAAK2F,OAAOykB,gBAAgB3Y,SAC1BzR,EAAK3E,OACL4jB,EACAwG,EACA7L,EACAhW,GAGKgW,KAjCJ3R,EAAA,SAASuJ,QAuCV5W,aACRoS,EACAhI,EACAW,GAEA,OAAI7K,KAAKqzB,eAAiB,GACxBxoB,EAAOykB,gBAAgBkE,UAChB,IAGTxzB,KAAKqzB,eAAiB,EAEtBnpB,EAASuI,GAAGP,EAAI7N,EAAG6N,EAAI9M,GAAGmS,QAAQvX,KAAKozB,UAAW,IAE3C,mIClGEK,UAAiBC,EAAA,EAC5B5zB,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMkzB,EAAA,EAASC,KAAMttB,EAAMsE,GAGtB7K,WACL,OAAO,IAAI2zB,EAASzzB,KAAKqG,KAAMrG,KAAK2K,UAG/B7K,OACLoS,EACA3R,EACA2J,EACAhF,GAEAA,EAAK2F,OAAO+oB,eAGd1P,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,EAGtB7K,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAOA,EAAS5E,GACd,IAAI2H,EAAA,UACF7L,KACAkK,EACAhF,EACA,CAACif,EAAMwG,IACLzlB,EAAK2F,OAAO2kB,SAASyB,MAAM9M,EAAMwG,EAAU7hB,GAC7C,CAACqb,EAAMwG,KAEL,IAAIkJ,EAAY7zB,KAAK6zB,UAAU3uB,EAAMgF,GAErC,OAAI2pB,GACF3uB,EAAK2F,OAAO2kB,SAASoD,UAAUzO,EAAMwG,EAAU7hB,GAE/CA,EAAS5E,GAAG2vB,GACL/qB,EAAS5E,GACd,IAAI4vB,EAAA,IAGEpxB,KAAMqxB,EAAA,EAAWpxB,KACjBC,MAAQC,MAAO,EAAGC,IAAK,GACvBC,MAAO,IAGXixB,EAAA,EAAUtpB,KACVR,EACAhF,MAIJA,EAAK2F,OAAO2kB,SAASyE,iBAAiB9P,EAAMwG,EAAU7hB,GAE/CA,EAAS5E,GAAG,IAAIgwB,EAAA,EAAUhqB,QAOnCpK,UAAUoF,EAAYgF,GAC5B,IAAIkJ,OAAQhL,EA0BZ,OAxBA5L,OAAAqP,EAAA,aAAArP,CACE0N,EACA,KAAM,EACN7D,IACE,GAAIA,aAAgBqtB,EAAA,EAAc,CAChC,IAAIS,EAAejvB,EAAKkvB,OAAO/tB,EAAK4D,iBAClCoqB,OAAUjsB,GAEZisB,EAAU73B,OAAAqP,EAAA,qBAAArP,CAAqB23B,EAAc9tB,GAC3CA,EAAK2C,sBAILoK,EAAQ,IAAIkhB,EAAA,EACVpvB,EACAgF,EACA,IAAI2B,EAAA,MAAMwoB,EAAQhwB,EAAGgwB,EAAQjvB,GAC7B+uB,OAOH/gB,yHCtGEmhB,UAAkB5D,EAAA,EAC7B7wB,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMmwB,EAAA,EAAS5iB,MAAO1H,EAAMsE,GAGvB7K,OACLoS,EACA3R,EACA2J,EACAhF,GAEIsvB,EAAA,EAAWr0B,OAAO,EAAG,IACvB+E,EAAK2F,OAAOgmB,eAAetwB,GAE3BP,KAAK2W,SAASzE,EAAKhN,EAAMgF,EAAU3J,IAEnCP,KAAK8wB,WAAW5e,EAAK3R,EAAQ2J,EAAUhF,GAIjCpF,WACR,OAAO,IAAIy0B,EAAUv0B,KAAKqG,KAAMrG,KAAK2K,UAGvCuZ,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,GAG7B2Y,eACE,OAAO,GAGFxjB,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAOA,EAAS5E,GACd,IAAIuwB,EAAA,EACFz0B,KACAkK,EACAhF,EACA,CAACif,EAAMwG,IACLzlB,EAAK2F,OAAO6pB,eAAexvB,EAAK3E,OAAQ4jB,EAAMwG,EAAU7hB,GAC1D,CAACqb,EAAMwG,IAED7hB,EAAS+Q,UAAU8a,EAAA,EAAW5a,OACzB6a,EAAA,SAASle,SAGlBxR,EAAK2F,OAAOgqB,mBAAmB3vB,EAAK3E,OAAQ4jB,EAAMwG,EAAU7hB,GAErDA,EAAS5E,GACd,IAAI4wB,EAAA,EAAeH,EAAA,EAAW5a,MAAO,OAAQ7U,EAAMlF,KAAKsjB,sGC3DvDyR,UAA0BC,EAAA,EACrCl1B,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMw0B,EAAA,EAASC,cAAe5uB,EAAMsE,GAG/B7K,OACLoS,EACA3R,EACA2J,EACAhF,GAEAA,EAAK2F,OAAO+oB,eAGJ9zB,WACR,OAAO,IAAIi1B,EAAkB/0B,KAAKqG,KAAMrG,KAAK2K,UAG/CuZ,iBACE,OAAOlkB,KAAK2K,SAAW,EAAI,GAGtB7K,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAOA,EAAS5E,GACd,IAAI2H,EAAA,UACF7L,KACAkK,EACAhF,EACA,CAACif,EAAMwG,KACDA,EACFzlB,EAAK2F,OAAOqqB,gCACH/Q,GACTjf,EAAK2F,OAAOsqB,gCAAgCrsB,IAGhD,CAACqb,EAAMwG,IACE7hB,EAAS5E,GAAG,IAAI2H,EAAA,mBAAmB3B,EAAUhF,GAAM,8GCvCvDkwB,UAAkBzE,EAAA,EAC7B7wB,YAAYuG,EAAYsE,GAAoB,GAC1CnK,MAAMmwB,EAAA,EAAS0E,MAAOhvB,EAAMsE,GAGvB7K,WACL,OAAO,IAAIs1B,EAAUp1B,KAAKqG,KAAMrG,KAAK2K,UAGvCuZ,iBACE,OAAOlkB,KAAK2K,SAAW,GAAK,EAG9BlI,cACE,QAAUC,KAAM4yB,EAAA,EAAW3yB,KAAMI,MAAO,EAAGH,MAAQC,MAAO,EAAGC,IAAK,KAG7DhD,OACLoS,EACA3R,EACA2J,EACAhF,GAEIiI,EAAA,WAAWhN,OAAO,EAAG,IACvB+E,EAAK2F,OAAOgmB,eAAetwB,GAGvB4M,EAAA,WAAWhN,OAAO,EAAG,IACvBH,KAAK2W,SAASzE,EAAKhN,EAAMgF,EAAU3J,IAGrCP,KAAK8wB,WAAW5e,EAAK3R,EAAQ2J,EAAUhF,GAIpCpF,SACLoS,EACAhN,EACAgF,EACApB,GAEA,OAAOA,EAAS5E,GACd,IAAIiJ,EAAA,UACFnN,KACAkK,EACAhF,EACA,CAACif,EAAMwG,IACLzlB,EAAK2F,OAAO0qB,gBACVrwB,EAAK3E,OACL4jB,EACAwG,EACAxd,EAAA,SAASoX,MACTzb,GAEJ,CAACqb,EAAMwG,KACDA,GACFzlB,EAAK2F,OAAO2qB,qBAGd,IAAI/e,EAAW3N,EAAS5E,GACtB,IAAIuxB,EAAA,EAAiBz1B,KAAKyC,QAASyH,EAAUhF,IAa/C,OAVKylB,GACHzlB,EAAK2F,OAAO0qB,gBACVrwB,EAAK3E,OACL4jB,EACAwG,EACAlU,EACA3N,GAIG2N,sFC9EJif,UAA0C7e,EAAA,EACrD/W,YACS61B,EACPzrB,EACAhF,EACQ0wB,GAERp1B,MAAM0J,EAAUhF,GALTlF,KAAA21B,UAGC31B,KAAA41B,aAKVlzB,WACE,OAAOmU,EAAA,EAAcgf,iBAGhB/1B,KAAKg2B,GACV91B,KAAK41B,WAAWE,GAGXh2B,QACLE,KAAKud,kHChBIwY,UAAgClf,EAAA,EAG3C/W,YAA4B+d,EAAe3T,EAAoBhF,GAC7D1E,MAAM0J,EAAUhF,GADUlF,KAAA6d,QAG1B7d,KAAKg2B,YAAc,IAAIC,EAAA,EAAiB/rB,EAAUhF,GAGpDxC,WACE,OAAOmU,EAAA,EAAcqf,eAGhBp2B,WAAWgC,EAAwBypB,GACxCvrB,KAAKO,OAAO2D,GAAG,IAAIiyB,EAAA,EAAgBr0B,EAAYypB,IAC/CvrB,KAAKO,OAAO2D,GAAG,IAAIkyB,EAAA,GAEnBp2B,KAAKmB,4FClBIk1B,UAAyBC,EAAA,EACpCzR,WACE,OAAOyR,EAAA,EAAkBC,QAG3B9J,kBACE,OAAOzsB,KAAKO,OAAOksB,+bCIjB+J,UAAoBpd,EAAA,QACjBtZ,UAAU2I,GACf,OAAOA,aAAgBguB,SAcrBA,UAAcrd,EAAA,cACXtZ,UAAU2I,GACf,OAAOA,aAAgB+tB,GAUpB,MAQME,EAAY,IACvB,IAAIF,EACF,mBACA,KACG9zB,KAAM0W,EAAA,WAAW9L,MAAO1K,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,IAC9DS,EAAA,EAAS6N,OAkBU,IAAI+H,EAAA,OAEvB,EACA,IACE,IAAIA,EAAA,cAAc,SAAU,EAAG5V,EAAA,EAASwN,OACpCtO,KAAM0W,EAAA,WAAWhM,MAAOxK,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,OAIjE,EACA,IACE,IAAIqW,EAAA,cAAc,SAAU,GAAK5V,EAAA,EAASwN,OACtCtO,KAAM0W,EAAA,WAAWhM,MAAOxK,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,QAK5C,IAAIqW,EAAA,OAEzB,EACA,IACE,IAAIA,EAAA,UAAU,WAAY,EAAG5V,EAAA,EAASwN,OAClCtO,KAAM0W,EAAA,eAAevL,OAAQlP,MAAO,OAI1C,EACA,IACE,IAAIya,EAAA,UAAU,OAAQ,EAAG5V,EAAA,EAASwN,OAC9BtO,KAAM0W,EAAA,eAAenL,MAAOtP,MAAO,OAIzC,GACA,IACE,IAAIya,EAAA,UAAU,OAAQ,EAAG5V,EAAA,EAASwN,OAC9BtO,KAAM0W,EAAA,eAAepL,UAAWrP,MAAO,OAG9C,IAAK,IAAM,kBChHkBya,EAAA,OAC9BtZ,cACEU,MAAM,iBAGDV,QAAQoF,GACbA,EAAK3E,OAAOqY,OAAO4D,SAAS,6ECFnBma,UAAyBC,EAAA,EAOpC92B,YAAYoK,EAAoBhF,GAC9B1E,MAAM0J,EAAUhF,GALVlF,KAAA62B,sBAAuCzuB,EACvCpI,KAAA82B,WACA92B,KAAA2T,QAKN3T,KAAK+2B,cACL/2B,KAAKgY,OAAShY,KAAKO,OAAOwR,YAAY/R,KAAKkK,UAC3ClK,KAAKqlB,UAAYrlB,KAAKg3B,gBAGxBt0B,WACE,OAAOk0B,EAAA,EAAc5mB,QAGhBlQ,kBACyBsI,IAA1BpI,KAAK62B,kBAKT72B,KAAK62B,kBAAoB,EAErB72B,KAAK62B,kBAAoB72B,KAAK82B,QAAQz6B,SACxC2D,KAAK62B,iBAAmB,GAG1B72B,KAAK2lB,aAAa3lB,KAAK82B,QAAQ92B,KAAK62B,oBAVlC72B,KAAKg3B,gBAaFl3B,sBACyBsI,IAA1BpI,KAAK62B,kBAKT72B,KAAK62B,kBAAoB,EAErB72B,KAAK62B,iBAAmB,IAC1B72B,KAAK62B,iBAAmB72B,KAAK82B,QAAQz6B,OAAS,GAGhD2D,KAAK2lB,aAAa3lB,KAAK82B,QAAQ92B,KAAK62B,oBAVlC72B,KAAKg3B,gBAaFl3B,WAAW4lB,GAChB,MAAM/T,EAAO3R,KAAKqlB,UAAUpf,IAAIyf,GACvB1lB,KAAKkK,SAASuI,GAAGd,EAAKtN,EAAGsN,EAAKvM,GAGhC+S,kBACLnY,KAAKO,OAAOwR,YAAY/R,KAAKkK,UAAUuI,GAAGd,EAAKtN,EAAGsN,EAAKvM,GAAGsN,UAE1D1S,KAAK2lB,aAAahU,GAClB3R,KAAK62B,sBAAmBzuB,GAIrBtI,SACAE,KAAKqlB,UAAU3T,GAAG1R,KAAKkK,SAAS8H,YAAYhS,KAAKO,UACpDP,KAAKO,OAAO2D,GACV,IAAIkV,EAAA,mBAAmBpZ,KAAK2T,KAAM3T,KAAKkF,KAAMlF,KAAKkK,SAAU,IAC1DlK,KAAKmB,YAMNrB,QACLE,KAAKi3B,YACLj3B,KAAK4L,SAAS,IAAIsrB,EAAcl3B,KAAKkK,SAAUlK,KAAKkF,OAG9CpF,gBACN,IAAIgG,EAWJ,OATI9F,KAAK82B,QAAQz6B,QACf2D,KAAK62B,iBAAmB,EACxB/wB,EAAQ9F,KAAK82B,QAAQ92B,KAAK62B,oBAE1B72B,KAAK62B,sBAAmBzuB,EACxBtC,EAAQ9F,KAAKkK,SAAS8H,YAAYhS,KAAKO,SAGzCP,KAAK2lB,aAAa7f,GACXA,EAGDhG,YACNE,KAAK2T,KAAKxN,QAAQ,EAAG9B,IAAGe,OAASpF,KAAKgY,OAAOvF,GAAGpO,EAAGe,GAAGoU,YAASpR,GAGzDtI,aAAa8lB,GACnB5lB,KAAKi3B,YACLj3B,KAAKqlB,UAAYO,EAAOC,OACxB7lB,KAAKm3B,WAGCr3B,WACNE,KAAK2T,QACL,IAAIyjB,GAAO,EACX,MAAMlf,EAAQlY,KAAKkK,SACjBgI,EAAMlS,KAAKkK,SAAS8H,YAAYhS,KAAKO,QAEvC/D,OAAA66B,EAAA,EAAA76B,CAAmB0V,EAAKlS,KAAKqlB,UAAW,CAAChhB,EAAGe,KACrC8S,EAAMzF,GAAGpO,EAAGe,GAAG4D,oBAClBouB,GAAO,GAGTp3B,KAAK2T,KAAKpX,KAAK,IAAI86B,EAAA,EAAMhzB,EAAGe,IAC5BpF,KAAKgY,OAAOvF,GAAGpO,EAAGe,GAAGoU,OAAS4d,EAAO,IAAM,MAIvCt3B,cACNE,KAAK82B,WAEL92B,KAAKO,OAAOwR,YAAY/R,KAAKkK,UAAUyW,KAAK,CAACta,EAAMhC,EAAGe,KAElDiB,EAAKqM,SACLrM,EAAKyC,UACLzC,EAAKyC,SAASM,KAAOpJ,KAAKO,OAAO6I,IAEjCpJ,KAAK82B,QAAQv6B,KAAK,IAAI86B,EAAA,EAAMhzB,EAAGe,wFCxGjCkyB,UAA0Ble,EAAA,YAI9BtZ,YACSilB,EACG7f,EACAgF,GAEV1J,QAJOR,KAAA+kB,WACG/kB,KAAAkF,OACAlF,KAAAkK,WALLlK,KAAAu3B,YAUGz3B,WAAWqL,GACnB,MAAMhB,EAAcnK,KAAKkF,KAAKkvB,OAAOjpB,EAASlB,iBAE9CjK,KAAKu3B,SAASh7B,MACZ,WACA,IAAIi7B,EAAA,EACFx3B,KAAKkF,KACLlF,KAAKkK,SACLiB,EAASssB,SAASz3B,KAAKkK,SAAUC,GACjCA,KAKCrK,OAAOyL,GACPA,EAAKZ,UAIV3K,KAAKu3B,SAASh7B,MACZ,SACA,IAAI6c,EAAA,YAAYpZ,KAAK+kB,SAAUxZ,EAAMvL,KAAKkK,SAAUlK,KAAKkF,eAKzDwyB,UAAgCJ,EAC1Bx3B,cAEHA,OAAOuL,GACRA,EAAKxB,KACP7J,KAAKu3B,SAASh7B,MACZ,YACA,IAAI6c,EAAA,eAAe/N,EAAMrL,KAAKkK,SAAUlK,KAAKkF,QAG/ClF,KAAKu3B,SAASh7B,MACZ,WACA,IAAIo7B,EAAA,EAActsB,EAAMrL,KAAKkK,SAAUlK,KAAKkF,eAMvCgyB,UAAsBN,EAAA,EACjCl0B,WACE,OAAOk0B,EAAA,EAAcgB,KAGhB93B,mBACLE,KAAK4L,SAAS,IAAIisB,EAAA,EAAmB73B,KAAKkK,SAAUlK,KAAKkF,OAGpDpF,aACLE,KAAK4L,SAAS,IAAIwN,EAAA,aAAapZ,KAAKkK,SAAUlK,KAAKkF,OAG9CpF,cACLE,KAAKO,OAAO2D,GAAG,IAAI4zB,EAAA,EAAU93B,KAAKkK,WAClClK,KAAKmB,UAGArB,cACLE,KAAK4L,SAAS,IAAIwN,EAAA,mBAAmBpZ,KAAKkK,SAAUlK,KAAKkF,OAGpDpF,eACLE,KAAK4L,SAAS,IAAIwN,EAAA,eAAepZ,KAAKkK,SAAUlK,KAAKkF,OAGhDpF,cACLE,KAAK4L,SAAS,IAAIwN,EAAA,cAAcpZ,KAAKkK,SAAUlK,KAAKkF,OAG/CpF,KAAK4lB,GACV,MACE/T,EADU3R,KAAKkK,SAAS8H,YAAYhS,KAAKO,QAC9B0F,IAAIyf,GACfrf,EAAOrG,KAAKkK,SAASuI,GAAGd,EAAKtN,EAAGsN,EAAKvM,GAEnCiB,EAAK2C,gBAAgBhJ,KAAKO,QAC5BP,KAAKO,OAAO2D,GAAG,IAAIszB,EAAA,EAAUx3B,KAAKkF,KAAMlF,KAAKkK,SAAUyH,IAC9CtL,EAAKyC,SACd9I,KAAKO,OAAO2D,GAAG,IAAIkV,EAAA,YAAY/S,EAAKyC,SAAU9I,KAAKkK,SAAUlK,KAAKkF,QAElElF,KAAKkF,KAAK2F,OAAOktB,oBACjB/3B,KAAKO,OACFwR,YAAY/R,KAAKkK,UACjBuI,GAAGd,EAAKtN,EAAGsN,EAAKvM,GAChBiT,IAAIhS,EAAM,IAGfrG,KAAKmB,UAGArB,gBACL,MAAMuG,EAAOrG,KAAKqG,KAChBsC,EAAQtC,EAAKsC,WAEDP,IAAVO,GAA8C,IAAvBA,EAAM+R,MAAMre,OACrC2D,KAAKkF,KAAK2F,OAAOmtB,kBACe,IAAvBrvB,EAAM+R,MAAMre,QACrB2D,KAAKO,OAAO2D,GAAG,IAAIkV,EAAA,iBAAiB/S,EAAMsC,EAAM+R,MAAO1a,KAAKkF,OAC5DlF,KAAKmB,WAELnB,KAAK4L,SAAS,IAAIwN,EAAA,gBAAgBpZ,KAAKkK,SAAUlK,KAAKkF,OAInDpF,iBACL,MAAMgW,EAAU9V,KAAKO,OAAOwT,UAAUgC,YAAYjC,UAE9CgC,GAAWA,EAAQrN,KACjBqN,EAAQrN,KAAKwvB,SAASj4B,KAAKO,QAC7BP,KAAK4L,SAAS,IAAI+qB,EAAiB32B,KAAKkK,SAAUlK,KAAKkF,OAEvDlF,KAAKkF,KAAK2F,OAAOqtB,oBAGnBl4B,KAAKkF,KAAK2F,OAAOstB,oBAIdr4B,gBACL,IAAIoS,EAAMlS,KAAKkK,SAAS8H,YAAYhS,KAAKO,QACvC2W,EAAU,IAAIogB,EAAkBplB,EAAKlS,KAAKkF,KAAMlF,KAAKkK,UACrDkuB,EAAgB,IAAIV,EAAwBxlB,EAAKlS,KAAKkF,KAAMlF,KAAKkK,UAEnElK,KAAKqG,KAAK8L,MAAM+E,GAEhBhF,EAAIS,WAAWxM,QAASL,IACtBsyB,EAAcrT,SAAWjf,EACzB9F,KAAKkK,SAASuI,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAAG+M,MAAMimB,KAG3C,MAAMb,EAAW/6B,OAAAwc,EAAA,OAAAxc,CAAO0a,EAAQqgB,SAAUa,EAAcb,UAExD,OAAQA,EAASl7B,QACf,KAAK,EACH2D,KAAKkF,KAAK2F,OAAOwtB,cACjB,MACF,KAAK,EACHr4B,KAAKO,OAAO2D,GAAGqzB,EAAS,GAAG,IAC3Bv3B,KAAKmB,UACL,MACF,QACEnB,KAAK4L,SACH,IAAI0sB,EAAA,EACFf,EACAv3B,KAAKkK,SACLlK,KAAKkF,KACL,EAAEhH,EAAMmc,MACNra,KAAKO,OAAO2D,GAAGmW,GACfra,KAAKmB,6ECnLnB,MAAMjB,GAAuBC,OAAQ,IAAMC,WAAY,GAEjDm4B,EAAc,CAClBr6B,EACAsE,KACAC,IAEO,IAAI2W,EAAA,WAAW,IAAIlY,EAAA,GACxBhD,KAAMA,EACNqE,OAAQ,GACRL,KAAMkX,EAAA,KAAKpG,gBACX5Q,aACAI,YAAaA,EACbC,QAASA,EAETO,eAAgB,EAChBC,iBAAkB,EAClBC,kBAAmB,EAEnBC,eACAC,aAAc,EAEdC,UAAW,GACXC,YAAa,GACbC,YAAa,EAEblB,kBAAmB,GACnBmB,SAAUA,EAAA,EAASC,MAEnBC,mBACAxD,aAoBSs4B,EAAiB,IAAIpf,EAAA,OAAuB,IAhBtC,IACVmf,EACL,WAEG71B,KAAM0W,EAAA,WAAWhM,MAAOxK,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,OAYG,EARhD,IACZw1B,EACL,UACG71B,KAAM0W,EAAA,eAAetL,MAAOnP,MAAO,MACnC+D,KAAM0W,EAAA,WAAW9L,MAAO1K,MAAQC,MAAO,EAAGC,IAAK,GAAKC,MAAO,qHC3BlE,MAAM01B,EAAkB,QAElBC,GACJjZ,UAAU,EACVkZ,QAAS,EACTC,QAAS,EACTC,WAAY,GACZC,UAAU,EACVpzB,MAAO,IACPzB,OAAQ,KAGJ80B,EAAiC,IAAIpgB,IAC3CogB,EAAM1f,IAAI,IAAK,IAAM,IAAID,EAAA,SAAS,IAAKA,EAAA,UAAUnQ,QACjD8vB,EAAM1f,IAAI,IAAK,IAAM,IAAID,EAAA,MACzB2f,EAAM1f,IAAI,IAAK,IAAM,IAAID,EAAA,MAAM,IAAKA,EAAA,UAAUnQ,QAC9C8vB,EAAM1f,IAAI,IAAK,IAAM,IAAID,EAAA,MAEzB,MAAM4f,EAA0B,IAAI5f,EAAA,OACjC,EAAI/S,GAAqB,IAAI4yB,EAAA,EAAY5yB,GAAM,KAC/C,EAAIA,GAAqB,IAAI6yB,EAAA,EAAa7yB,GAAM,KAChD,EAAIA,GAAqB,IAAI8yB,EAAA,EAAgBxwB,EAAA,EAAWtC,GAAM,KAC9D,EAAIA,GAAqB,IAAI+yB,EAAA,EAAS/yB,GAAM,KAC5C,EAAIA,GAAqB,IAAIgzB,EAAA,EAAUhzB,GAAM,KAC7C,EAAIA,GAAqB,IAAIizB,EAAA,EAAkBjzB,GAAM,KACrD,EAAIA,GAAqB,IAAIkzB,EAAA,EAAUlzB,GAAM,KAC7C,GAAKA,GAAqBA,WAGhBmzB,UAAqBpgB,EAAA,QACzBtZ,MAAMoF,EAAY3E,GACvB,MAAM2J,EAAYhF,EAAKlE,WAAakE,EAAKkvB,OAAOqE,GAEhDj8B,OAAA4c,EAAA,iBAAA5c,CACE0N,EACA7D,GAAQA,EAAK0C,WAAa1C,EAAK2C,kBAC/B,CAAC3E,EAAGe,KACF8E,EAAS+M,YAAY,IAAImC,EAAA,MAAM/U,EAAGe,GAAI7E,KAKrCT,SAASoF,GACdA,EAAKu0B,OAAOhB,EAAS,CAACrvB,EAAIlE,IACxB1I,OAAA4c,EAAA,aAAA5c,CAAa,EAAGwD,KAAK05B,YAAYjB,GAAUD,IAIvC14B,YAAY5B,GAClB,IAAIsG,EAAM,IAAI4U,EAAA,SACZlb,EACA1B,OAAA4c,EAAA,QAAA5c,CACEk8B,EAAOhzB,MACPgzB,EAAOz0B,OACPy0B,EAAOC,QACPD,EAAOE,QACPF,EAAOG,WACP,IAAM,IAAIzf,EAAA,KACV,IAAM,IAAIA,EAAA,SAAS,IAAKA,EAAA,UAAUnQ,OAClC,IAAM,IAAImQ,EAAA,OAkBd,OAdA5c,OAAA4c,EAAA,SAAA5c,CAASgI,EAAK,IAAM,IAAI4U,EAAA,KAAQ,KAAM,GAEtC5c,OAAAm9B,EAAA,EAAAn9B,CACEgI,EACA6B,GAAQA,EAAK0C,UACb,CAAC1C,EAAMhC,EAAGe,KACRZ,EAAIuG,QAAQ1G,EAAGe,EAAG4zB,EAAMlZ,KAAKzZ,MAIjC7J,OAAA4c,EAAA,WAAA5c,CAAWgI,GAIJA,+FCxGEwZ,UAAiBkE,EAAA,EAGrBpiB,IACLoJ,EACAgB,EACAhF,EACA00B,GAAqB,GAErB,GAAK55B,KAAK65B,UAAU3wB,EAAOgB,GAA3B,CAIA,GAAIlK,KAAKwqB,QAAUxqB,KAAK85B,eAAe5wB,EAAOgB,EAAUlK,KAAKwqB,QAC3D,OAAO,IAAI3e,EAAA,YAAY7L,KAAKwqB,OAAQtgB,EAAUhF,GAE9C,IAAK00B,EACH,KAAM,4BAIR,OADA55B,KAAK+5B,cAAc7wB,EAAOgB,GACnBlK,KAAKsa,IAAIpR,EAAOgB,EAAUhF,GAAM,IAInCpF,UAAUoJ,EAAiBgB,GAIjC,QAHiBlK,KAAKg6B,aAAa9wB,EAAOgB,EAAUpB,GAClD9I,KAAK82B,QAAQ5tB,EAAOJ,IAKhBhJ,eACNoJ,EACAgB,EACAsgB,GAEA,QAAepiB,IAAXoiB,EACF,OAAO,EAQT,QALiBxqB,KAAKg6B,aACpB9wB,EACAgB,EACCpB,GAAuBA,EAASM,KAAOohB,EAAOphB,IAK3CtJ,cAAcoJ,EAAiBgB,GACrClK,KAAKwqB,OAASxqB,KAAKg6B,aAAa9wB,EAAOgB,EAAUpB,GAC/C9I,KAAK82B,QAAQ5tB,EAAOJ,IAIhBhJ,aACNoJ,EACAgB,EACA+vB,GAEA,MAAMjiB,EAAS9O,EAAM6I,YAAY7H,GAEjC,OAAOA,EACJ8H,YAAY9I,GACZyJ,WACAnO,IAAI,EAAGH,IAAGe,OAAQ4S,EAAOvF,GAAGpO,EAAGe,GAAG0D,UAClCoW,KACEpW,KACCA,GAAWmxB,EAAUnxB,6FCnElBoxB,UAAehY,EAAA,EAGhBpiB,eAAeoJ,EAAiBgB,GAExC,OACGlK,KAAKm6B,aAAen6B,KAAKo6B,gBAAgBlxB,EAAOgB,IACjDlK,KAAKq6B,eAAenxB,EAAOgB,GAIrBpK,aACRE,KAAKs6B,cAAWlyB,EAGRtI,UACRE,KAAKs6B,cAAWlyB,EAIVtI,YACN,QAASE,KAAKs6B,SAGNx6B,KACRoJ,EACAgB,EACAhF,GAEA,IAAKlF,KAAKwR,YACR,KAAM,8BAER,OAAOxR,KAAKu6B,SAASrxB,EAAOlJ,KAAKwR,YAAatH,EAAUhF,GAGlDpF,gBAAgBoJ,EAAiBgB,GACvC,OAAOlK,KAAKg6B,aACV9wB,EACAgB,EACApB,GAAYA,EAASM,KAAOpJ,KAAKs6B,UAI7Bx6B,eAAeoJ,EAAiBgB,GAEtC,OACElK,KAAKg6B,aAAa9wB,EAAOgB,EAAUpB,GACjC9I,KAAK82B,QAAQ5tB,EAAOJ,KACjB9I,KAAKo6B,gBAAgBlxB,EAAOgB,GAI7BpK,aACNoJ,EACAgB,EACA+vB,GAEA,IAAI/8B,GAAkB,EAgBtB,OAdA8C,KAAKw6B,WACHtxB,EAAM6I,YAAY7H,GAClBA,EAAS8H,YAAY9I,GACrB,EAAG7E,IAAGe,KAAKiB,KACT,MAAMyC,EAAWzC,EAAKyC,UAEjB5L,GAAU4L,GAAYmxB,EAAUnxB,KACnC9I,KAAKwR,YAAc,IAAIa,EAAA,EAAMhO,EAAGe,GAChCpF,KAAKs6B,SAAWxxB,EAASM,GACzBlM,GAAS,KAKRA,EAGC4C,SACRoJ,EACAsI,EACAtH,EACAhF,GAEA,OAAOlF,KAAKyR,KAAKvI,EAAOgB,EAAUhF,EAAMY,GAAS0L,EAAYipB,OAAO30B,oGC7ElE40B,UAAkClkB,EAAA,EAAxC1W,kCACSE,KAAAmU,OAAQ,EAERrU,iBACLE,KAAKmU,OAAQ,SAIXwmB,UAAqCnkB,EAAA,EAGzC1W,YAAoBoF,EAAoBgF,GACtC1J,QADkBR,KAAAkF,OAAoBlF,KAAAkK,WAIjCpK,eAAeqL,GACpB,MAAMhB,EAAcnK,KAAKkF,KAAKkvB,OAAOjpB,EAASlB,iBAE9CjK,KAAKoT,MAAQ,IAAIvH,EAAA,UACf7L,KAAKkF,KACLlF,KAAKkK,SACLiB,EAASssB,SAASz3B,KAAKkK,SAAUC,GACjCA,UAKOywB,UAAkBtW,EAAA,EAC7BxkB,cACEU,MAAM6F,IACJ,MAAM6Q,EAAU,IAAIwjB,EAEpB,OADAr0B,EAAK8L,MAAM+E,GACJA,EAAQ/C,QAIZrU,IACLoJ,EACAgB,EACAhF,GAEA,GAAIgE,EAAM2xB,IAAIhvB,EAAA,QAAQivB,YACpB,OAAOt6B,MAAM8Z,IAAIpR,EAAOgB,EAAUhF,GAI5BpF,QACRoJ,EACAgB,EACAhF,GAGA,MAAMgS,EAAU,IAAIyjB,EAA6Bz1B,EAAMgF,GAIvD,OAHSA,EAASwB,aAAaxC,GAE1BiJ,MAAM+E,GACJA,EAAQ9D,yFC9DnB,MAAM2nB,EAAgB,QAETC,UAAgBnkB,EAAA,EAA7B/W,kCACUE,KAAAi7B,eAEEn7B,eAAeoJ,EAAiBgB,GACxC,OACElK,KAAKk7B,aAAahyB,EAAOgB,IACzBlK,KAAKm7B,gBAAgBjyB,EAAOgB,GAIxBpK,gBACNoJ,EACAgB,EACAkxB,EAAsBlyB,EAAM9F,aAAe,GAE3C,GAAIg4B,GAAe,EAEjB,OADAp7B,KAAKwR,iBAAcpJ,GACZ,EAGT,MAAMuL,EAAO3T,KAAK4R,UAAU1I,EAAOgB,EAAU,EAAG7F,IAAGe,QAQjD,OAPc5I,OAAA2H,EAAA,MAAA3H,CAAMwD,KAAKi7B,YAAa,EAAE/oB,EAAKW,KAIpCnO,KAAK5B,IAAI4B,KAAKqB,IAAI1B,EAAI6N,EAAI7N,GAAIK,KAAKqB,IAAIX,EAAI8M,EAAI9M,MAGxCg2B,IAGlB,OAAIznB,EAAKtX,QACP2D,KAAKwR,YAAcmC,EAAKlN,OACjB,GAEAzG,KAAKm7B,gBAAgBjyB,EAAOgB,EAAUkxB,EAAcL,GAIvDj7B,aAAaoJ,EAAiBgB,GAepC,OAdAlK,KAAKi7B,eAELj7B,KAAKw6B,WACHtxB,EAAM6I,YAAY7H,GAClBA,EAAS8H,YAAY9I,GACrB,CAACpD,EAAOO,KACN,MAAMyC,EAAWzC,EAAKyC,SAElBA,GAAY9I,KAAK82B,QAAQ5tB,EAAOJ,IAClC9I,KAAKi7B,YAAY1+B,MAAMuJ,EAAOgD,MAK7B9I,KAAKi7B,YAAY5+B,OAAS,oFC5DxBg/B,UAAiBxkB,EAAA,EAC5B/W,cACEU,MAAM6F,IAASA,EAAKi1B,kHCWxB,MAAMC,EAA0B,SAE1BC,UAA0BC,EAAA,EAG9B37B,YAAoBuG,GAClB7F,QADkBR,KAAAqG,OAFbrG,KAAAwrB,QAAkB,EAMlB1rB,UAGL,OAFAE,KAAKwrB,QAAS,EACdxrB,KAAKqG,KAAK8L,MAAMnS,MACTA,KAAKwrB,OAGP1rB,SACLE,KAAKwrB,QAAS,SAILkQ,UAAe7kB,EAAA,EAU1B/W,cACEU,QAJMR,KAAA6mB,KAAe0U,EACfv7B,KAAA27B,iBAA2B,EAIjC37B,KAAK7D,EAAI,IAET6D,KAAK47B,MAAQ,IAAIC,EAAA,MAEjB77B,KAAK87B,iBAEL97B,KAAK+7B,cAAgB,IACrB/7B,KAAKg8B,gBAAgBh8B,KAAK+7B,eAC1B/7B,KAAK2T,QAGA7T,IACLoJ,EACAgB,EACAhF,EACA00B,GAAqB,GAErB,KAAI55B,KAAK47B,MAAMK,QAAQ5/B,QAAU,GAAjC,CAIA,GAAI2D,KAAK27B,gBAAiB,CACxB,MAAMzpB,EAAMhI,EAAS8H,YAAY9I,GACjClJ,KAAKk8B,QAAQhqB,GACblS,KAAK27B,iBAAkB,EAKzB,OAFA37B,KAAK6mB,MAAQ,EAET7mB,KAAK2T,KAAKtX,OACL2D,KAAKm8B,aAAajzB,EAAOgB,EAAUhF,EAAM00B,IAE5C55B,KAAKo8B,eACPp8B,KAAKg8B,gBAAgBh8B,KAAKo8B,cAC1Bp8B,KAAK+7B,cAAgB/7B,KAAKo8B,cAG5Bp8B,KAAKq8B,gBAAgBnzB,EAAOgB,GACrBlK,KAAKm8B,aAAajzB,EAAOgB,EAAUhF,EAAM00B,KAI7C95B,QACLE,KAAK2T,QAGA7T,cAAcoS,EAAY7L,IAC3BrG,KAAK6mB,MAAQ0U,GAAmB,IAAIC,EAAkBn1B,GAAM61B,YAC9Dl8B,KAAKk8B,QAAQhqB,GAEflS,KAAK6mB,MAAQ,EAIR/mB,QAAQgG,GACb9F,KAAK47B,MAAMU,QAAQt8B,KAAK7D,EAAG2J,GACvB9F,KAAK+7B,eAAiB/7B,KAAK+7B,gBAAkB/7B,KAAK7D,GACpD6D,KAAK47B,MAAMW,QAAQv8B,KAAK+7B,cAAe/7B,KAAK7D,GAE9C6D,KAAK+7B,cAAgB/7B,KAAK7D,EAC1B6D,KAAKw8B,YACLx8B,KAAK6mB,KAAO,EAGN/mB,aAAaoJ,EAAiBgB,GAEpC,IAAKlK,KAAKo8B,aACR,KAAM,8BAER,MAAMlqB,EAAalS,KAAK47B,MAAMa,KAAKz8B,KAAKo8B,cAExCp8B,KAAK2T,KAAO3T,KAAK4R,UAAU1I,EAAOgB,EAAUpE,GAASoM,EAAIR,GAAG5L,IAGtDhG,gBAAgBoJ,EAAiBgB,GACvC,IAAIwyB,EAAqB18B,KAAK47B,MAAMK,QAAQ,GAC1CU,EAAuB38B,KAAK87B,cAAcY,GAC1CT,EAAQj8B,KAAK47B,MAAMgB,UAAU58B,KAAK+7B,eAEhCE,GACFA,EAAM91B,QAAS02B,IACTF,GAAgB38B,KAAK87B,cAAce,IAAW,KAChDH,EAAaG,EACbF,EAAe38B,KAAK87B,cAAcY,MAKxC18B,KAAKo8B,aAAeM,EACpB18B,KAAK88B,aAAa5zB,EAAOgB,GAGnBpK,aACNoJ,EACAgB,EACAhF,EACA00B,GAEA,MAAM9iB,EAA+B9W,KAAK2T,KAAK7W,QAE/C,OAAKga,EAQH5N,EACG6I,YAAY7H,GACZuI,GAAGqE,EAAUzS,EAAGyS,EAAU1R,GAC1B6M,YAEHjS,KAAK88B,aAAa5zB,EAAOgB,GAErBlK,KAAK2T,KAAKtX,OACL2D,KAAKsa,IAAIpR,EAAOgB,EAAUhF,GAAM,QADzC,GAIO,IAAI63B,EAAA,EAAU73B,EAAMgF,EAAU4M,GAlBjC8iB,GACF55B,KAAK2T,QACE3T,KAAKsa,IAAIpR,EAAOgB,EAAUhF,GAAM,KAEhC,IAAI83B,EAAA,GAAS1iB,IAAIpR,EAAOgB,EAAUhF,GAkBvCpF,gBAAgB+8B,GACtB78B,KAAK87B,cAAce,GAAU78B,KAAK6mB,KAG5B/mB,YACNE,KAAK7D,EAAI8gC,OAAOC,aAAal9B,KAAK7D,EAAEghC,WAAW,GAAK,iHCvK3CC,UAAe9Y,EAAA,EAC1BxkB,cACEU,MAAO6F,KAAuBA,EAAKsC,OAG9B7I,IACLoJ,EACAgB,EACAhF,GAEA,GAAIgE,EAAM2xB,IAAI/nB,EAAA,EAAQuqB,WACpB,OAAO78B,MAAM8Z,IAAIpR,EAAOgB,EAAUhF,GAI5BpF,QACRoJ,EACAgB,EACAhF,GAEA,MAAMmB,EAAO6D,EAASwB,aAAaxC,GAEnC,IAAK7C,EAAKsC,MACR,KAAM,kCAKR,OAFAO,EAAMhI,GAAG0W,UAAU,IAAI0lB,EAAA,EAAkBj3B,EAAKsC,MAAOzD,IAE9C,IAAI2G,EAAA,iBAAiBxF,EAAMA,EAAKsC,MAAM+R,MAAOxV,6FC9B3Cq4B,UAAmB1mB,EAAA,EACvB/W,IAAIoJ,EAAiBgB,GAC1B,IAAIhB,EAAM0P,OAAOwQ,MAIjB,OAAO,IAAIoU,EAAA,EAAUtzB,kHCFZuzB,UAAgB5mB,EAAA,EAKpB/W,IACLoJ,EACAgB,EACAhF,GAEA,IACGgE,EAAM2xB,IAAI/nB,EAAA,EAAQ4qB,YAClB19B,KAAK29B,WAAWz0B,KAChBlJ,KAAK65B,UAAU3wB,EAAOgB,EAAUhF,GAEjC,OAGF,IAAIyO,KAEJ,IAAK3T,KAAKwqB,OACR,KAAM,6CASR,OANAhuB,OAAAohC,EAAA,EAAAphC,CACE0N,EAAS8H,YAAY9I,GACrBgB,EAAS8H,YAAYhS,KAAKwqB,QAC1B,CAACnmB,EAAGe,IAAMuO,EAAKpX,KAAK,IAAIqhC,EAAA,EAAMv5B,EAAGe,KAG5B,IAAI0M,EAAA,mBACT6B,EACAzO,EACAgF,EACCuM,IACKA,IAAaonB,EAAA,EAASlmB,MACxB3X,KAAKwqB,YAASpiB,EACdpI,KAAK89B,oBAAiB11B,KAMtBtI,WAAWoJ,GAEjB,OADAlJ,KAAK+9B,SAAW70B,EAAM4M,aACG1N,IAAlBpI,KAAK+9B,SAGNj+B,UAAUoJ,EAAiBgB,EAAoBhF,GAIrD,OAHAlF,KAAK89B,eAAiB99B,KAAKwqB,OAC3BxqB,KAAKwqB,YAASpiB,KAEVpI,KAAK89B,iBACH99B,KAAKg+B,WAAW90B,EAAOgB,EAAUlK,KAAK89B,eAAe10B,MAKpDpJ,KAAKg6B,aAAa9wB,EAAOgB,EAAUpB,GACxC9I,KAAK82B,QAAQ5tB,EAAOJ,IAIhBhJ,WACNoJ,EACAgB,EACAowB,GAEA,OAAOt6B,KAAKg6B,aACV9wB,EACAgB,EACApB,GAAYwxB,IAAaxxB,EAASM,IAI9BtJ,aACNoJ,EACAgB,EACA+vB,GAEA,MAAMjiB,EAAS9O,EAAM6I,YAAY7H,GAC/BgI,EAAMhI,EAAS8H,YAAY9I,GAe7B,OAbAlJ,KAAKw6B,WAAWxiB,EAAQ9N,EAAS8H,YAAY9I,GAAQ,CAACpD,EAAOO,KAC3D,MAAMyC,EAAWzC,EAAKyC,UAGnB9I,KAAKwqB,QACN1hB,GACAmxB,EAAUnxB,KACT9I,KAAKi+B,UAAU/0B,EAAOgJ,EAAK8F,EAAQlS,KAEpC9F,KAAKwqB,OAAStgB,EAASuI,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAAG0D,cAIvC9I,KAAKwqB,OAGR1qB,UACNoJ,EACAgJ,EACA8F,EACA0X,GAEA,IAAIuO,GAAY,EAMhB,OAJAzhC,OAAAohC,EAAA,EAAAphC,CAAU0V,EAAKwd,EAAQ,CAACrrB,EAAGe,KACzB64B,EAAYA,GAAajmB,EAAOvF,GAAGpO,EAAGe,GAAG6M,SAAS/I,KAG7C+0B,4JC/GEC,UAAoBrnB,EAAA,EAC/B/W,YACU0qB,EACAtgB,EACAhF,GAER1E,QAJQR,KAAAwqB,SACAxqB,KAAAkK,WACAlK,KAAAkF,OAKHpF,eAAeoJ,GACpB,OAAOlJ,KAAKyqB,QAAQvhB,GAAO,GAGtBpJ,aAAaS,GAClB,MAAMkW,EAAWzW,KAAKyqB,QAAQlqB,GAAQ,GAMtC,OAJIkW,IAAaI,EAAA,EAASc,KACxBpX,EAAO2D,GAAG,IAAIi6B,EAAA,EAAmBn+B,KAAKwqB,OAAQxqB,KAAKkK,SAAUlK,KAAKkF,OAG7DuR,EAGC3W,QAAQoJ,EAAiByhB,GACjC,MAAOlU,EAAU3J,GAAU9M,KAAKqM,IAAInD,GAUpC,OARAlJ,KAAKkF,KAAK2F,OAAOggB,aAAauT,MAC5BtxB,EACA5D,EACAlJ,KAAKwqB,OACL/T,EACAkU,GAGKlU,EAGC3W,IAAIoJ,GACZ,GAAIgS,EAAA,EAAW4P,OAAO5hB,EAAM3F,YAAavD,KAAKwqB,OAAOjnB,aACnD,OAAQsT,EAAA,EAAS0N,MAAO,GAG1B,MAAMwG,EAAY,IAAIoC,EAAA,EACpBjS,EAAA,EAAW8P,aAAa9hB,EAAMzG,QAASyG,EAAMqG,OAAOrP,UACpDm+B,EAAA,EAAUC,OACVt+B,KAAKkK,SACLlK,KAAKkF,MAGP,OAAQlF,KAAKwqB,OAAOtmB,GAAG6mB,GAAYA,EAAUje,iGCpDpCyxB,UAAuBpT,EAAA,EAClCrrB,YAAoBuL,EAAYnB,EAAoBhF,GAClD1E,MAAM0J,EAAUhF,GADElF,KAAAqL,OAIbvL,eAAegJ,GAQpB,OAPI9I,KAAKqL,KAAKxB,MACZ7J,KAAKqL,KAAKxB,MAAO,EACjB7J,KAAKkF,KAAK2F,OAAOugB,WAAW5F,SAE5BxlB,KAAKkF,KAAK2F,OAAOugB,WAAWoT,gBAGvB3nB,EAAA,EAASH,yFChBP+nB,UAAyB5nB,EAAA,EACpC/W,YAAoB4+B,EAAwBx5B,GAC1C1E,QADkBR,KAAA0+B,SAAwB1+B,KAAAkF,OAIrCpF,eAAeoJ,GAKpB,OAJAA,EAAMygB,WAAW3pB,KAAK0+B,OAAQ,GAC9B1+B,KAAK0+B,OAAOC,QAAQ3+B,KAAKkF,MAEzBlF,KAAKkF,KAAK2F,OAAO+zB,MAAM5+B,KAAK0+B,QACrB7nB,EAAA,EAASH,iHCHPmoB,UAA2BhoB,EAAA,EACtC/W,YACU6T,EACAzO,EACAgF,EACA9I,GAERZ,QALQR,KAAA2T,OACA3T,KAAAkF,OACAlF,KAAAkK,WACAlK,KAAAoB,OAKHtB,eAAeoJ,GACpB,IAAI4M,EAAU5M,EAAM4M,QAEpB,IAAKA,EACH,KAAM,uDAKR,OAFA9V,KAAK8+B,YAAY51B,EAAO4M,EAAQrN,MAEzBoO,EAAA,EAASH,QAGX5W,aAAaS,GAClB,MAAMuV,EAAUvV,EAAOuV,QAEvB,IAAKA,EACH,KAAM,wCAQR,OALA9V,KAAK8+B,YAAYv+B,EAAQuV,EAAQrN,MAEjClI,EAAO2D,GAAG,IAAI66B,EAAA,EAAgBx+B,EAAOwT,UAAUgC,YAAa,EAAG/V,KAAKkF,OACpE3E,EAAO+hB,YAAYsH,SAAS9T,EAAQrN,KAAKlG,QAElCsU,EAAA,EAASH,QAGV5W,YAAYoJ,EAAiB4M,GACnC,IACE0U,EADEwU,KAGJh/B,KAAK2T,KAAKxN,QAAQL,IAChB,IAAK0kB,EAAQ,CACX,MAAMnkB,EAAOrG,KAAKkK,SAASuI,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAC7ColB,EAASnkB,EAAKyC,SACdk2B,EAAWziC,KAAKuJ,MAIpB9F,KAAKkF,KAAKsU,OAAS,IAAIylB,EAAA,EAAqBnpB,EAASkpB,EAAY,KAC3DxU,EACFxqB,KAAKoB,KACH8H,EAAMhF,GAAG,IAAIg7B,EAAA,EAAW1U,EAAQ1U,EAAS9V,KAAKkK,SAAUlK,KAAKkF,QAG/DlF,KAAKoB,KAAKyV,EAAA,EAASH,4FC5DdyoB,UAAyBtoB,EAAA,EACpC/W,YACUuG,EACAsC,EACAzD,GAER1E,QAJQR,KAAAqG,OACArG,KAAA2I,QACA3I,KAAAkF,OAKHpF,eAAegJ,GAKpB,OAJA9I,KAAK2I,MAAMxC,QAAQ,EAAGsC,OAAMC,YAC1BI,EAASyO,QAAQ9O,EAAMC,KAGlBmO,EAAA,EAASH,QAGX5W,aAAaS,GAClB,IAAI6+B,EAA0Cp/B,KAAKqG,KAAKsC,MAExD,QAAkBP,IAAdg3B,EACF,KAAM,8CAKR,OAHEp/B,KAAKq/B,cAAc9+B,EAAQ6+B,GAGtBvoB,EAAA,EAASH,QAGR5W,cAAcC,EAAiBq/B,GACvCp/B,KAAK2I,MAAMxC,QAAQ,EAAGsC,OAAMC,YAC1B3I,EAAQwX,QAAQ9O,EAAMC,GACtB3I,EAAQuiB,YAAYrc,IAAIwC,EAAKlG,OAASmG,GAEtC1I,KAAKkF,KAAK2F,OAAOy0B,aAAa72B,EAAMC,GACpC02B,EAAUzkB,OAAOlS,EAAMC,sFCrChB62B,UAA4B1oB,EAAA,EACvC/W,YAAoBgC,GAClBtB,QADkBR,KAAA8B,aAIbhC,aAAaS,GAClB,IAAIi/B,EAAmBj/B,EAAOksB,YAAYvN,KACxCpd,GAAcA,EAAWsH,KAAOpJ,KAAK8B,WAAWsH,IAWlD,OARIo2B,EAEFA,EAAiB3hB,OAAS,GAE1B7d,KAAK8B,WAAW+b,OAAS,EACzBtd,EAAOksB,YAAYlwB,KAAKyD,KAAK8B,aAGxB+U,EAAA,EAASH,iHCfP+oB,UAAuB5oB,EAAA,EAClC/W,YACUyf,EACA9W,EACAvD,GAER1E,QAJQR,KAAAuf,OACAvf,KAAAyI,OACAzI,KAAAkF,OAKHpF,aAAaS,GAClB,IACEm/B,EADcn/B,EAAOwT,UACC4rB,UAAU3/B,KAAKyI,MAEvC,QAAkBL,IAAds3B,EACF,aACE1/B,KAAKyI,KAAKvK,oDAMd,GAAI8B,KAAKuf,KAAKzL,UAAW,CACvB,MAAM2C,EAAWlW,EAAO2D,GAAG,IAAIsb,EAAA,EAAiBxf,KAAKuf,KAAMvf,KAAKkF,OAChE,GAAIuR,IAAaI,EAAA,EAASH,QACxB,OAAOD,EAIX,MAAM/N,EAAQ1I,KAAKuf,KAAK1L,cAAgB,EAAI6rB,EAAUh3B,MAQtD,OANAnI,EAAOopB,WAAW3pB,KAAKyI,KAAMC,GAC7B1I,KAAKuf,KAAKqgB,MAAM5/B,KAAKyI,KAAMC,GAC3B1I,KAAK6/B,QAAQt/B,EAAQP,KAAKyI,MAE1BzI,KAAKkF,KAAK2F,OAAOi1B,MAAM9/B,KAAKyI,MAErBoO,EAAA,EAASH,QAGV5W,QAAQS,EAAgBkI,GAC1BA,aAAgBs3B,EAAA,IAClBx/B,EAAOqjB,iBAAmBrjB,EAAOqjB,iBAAiBoc,OAAOv3B,EAAKjG,cAGhEiG,EAAKkG,QAAQxI,QAAQ2T,IACnBvZ,EAAO2D,GAAG,IAAI+7B,EAAA,EAAenmB,EAAQrR,EAAKvK,KAAM8B,KAAKkF,0FChD9Cg7B,UAA0BrpB,EAAA,EACrC/W,YACUsjB,EACAle,EACAme,GAER7iB,QAJQR,KAAAojB,aACApjB,KAAAkF,OACAlF,KAAAqjB,SAKHvjB,eAAegJ,GAQpB,OANI9I,KAAKqjB,OACPva,EAAS6Q,kBAAkB3Z,KAAKojB,WAAYpjB,KAAKqjB,QAEjDva,EAAS8Q,aAAa5Z,KAAKojB,YAGtBvM,EAAA,EAASH,wICRPypB,UAA2Bpc,EAAA,EACtCjkB,YAAYoK,EAAoBhF,EAAoBk7B,GAClD5/B,MAAM0J,EAAUhF,GADkClF,KAAAogC,WAI7CtgC,eAAeoJ,GAgBpB,OAfIlJ,KAAKokB,WAAWlb,GAEhBA,EAAMm3B,cAAcC,EAAA,EAAWC,wBAC9BvgC,KAAKwgC,SAASt3B,GAEflJ,KAAKkF,KAAK2F,OAAO41B,sBAAsBv3B,GAEvClJ,KAAKkF,KAAK2F,OAAO61B,mBAAmBx3B,GAGtClJ,KAAKwgC,SAASt3B,GAKTy3B,EAAA,EAASjqB,QAGX5W,aAAaS,GAgBlB,OAfIA,EAAO8/B,cAAcC,EAAA,EAAWC,uBAC7BvgC,KAAKogC,UACRpgC,KAAKkF,KAAK2F,OAAO+1B,4BAGnBrgC,EAAOW,GAAG0W,UAAU,IAAIipB,EAAA,EAAqB7gC,KAAKkK,SAAUlK,KAAKkF,OACjElF,KAAKkF,KAAKjE,YAAa,GACdjB,KAAKwgC,SAASjgC,GAClBP,KAAKogC,UACRpgC,KAAKkF,KAAK2F,OAAOi2B,mBAGnB9gC,KAAKkF,KAAK2F,OAAOk2B,sBAGZJ,EAAA,EAASjqB,QAGR5W,SAASoJ,GACjB,IAAI83B,GAAa,EAEjB,IACExkC,OAAAykC,EAAA,EAAAzkC,CACEwD,KAAKkK,SACL7D,GAAQA,EAAK66B,OACb,CAAC78B,EAAGe,KACF47B,GAAa,EACb93B,EAAMhF,GAAG,IAAIi9B,EAAA,EAAUnhC,KAAKkF,KAAMlF,KAAKkK,SAAU,IAAIk3B,EAAA,EAAM/8B,EAAGe,OAGlE,MAAAi8B,IAEF,OAAOL,mFC/DEM,UAAoBzqB,EAAA,EAC/B/W,YACUyhC,EACAh2B,EACArB,EACAhF,GAER1E,QALQR,KAAAuhC,eACAvhC,KAAAuL,OACAvL,KAAAkK,WACAlK,KAAAkF,OAKHpF,aAAaS,GAElB,OADAP,KAAKuL,KAAKi2B,OAAOxhC,KAAKuhC,aAAchhC,EAAQP,KAAKkK,SAAUlK,KAAKkF,MACzD2R,EAAA,EAASH,sFChBpB,MAAM+qB,EAAY,EACZC,EAAY,GACZC,EAAcj9B,KAAK+H,IAAkB,EAAZi1B,SAEzB/3B,UAAgB0I,EAAA,EACpBvS,SAAS8hC,GACP,OACEA,EAAKv9B,EAAIo9B,EAAYzhC,KAAKqE,EAAIrE,KAAKqF,GACnCu8B,EAAKx8B,EAAIq8B,EAAYzhC,KAAKoF,EAAIpF,KAAKsF,GACnCs8B,EAAKv9B,EAAIu9B,EAAKv8B,EAAIrF,KAAKqE,EAAIo9B,GAC3BG,EAAKx8B,EAAIw8B,EAAKt8B,EAAItF,KAAKoF,EAAIq8B,EAI/B3hC,cACE,OAAO,IAAIuS,EAAA,EACTrS,KAAKqE,EAAI,EAAI7H,OAAA6V,EAAA,EAAA7V,CAAKwD,KAAKqF,EAAI,GAC3BrF,KAAKoF,EAAI,EAAI5I,OAAA6V,EAAA,EAAA7V,CAAKwD,KAAKsF,EAAI,IAI/BxF,IAAIoY,EAAc2pB,EAAoBC,GACpC,IAAI3lC,EAAY,EAChB,KAAOA,EAAI6D,KAAKqF,GAAG,CACjB,IAAIhI,EAAY,EAChB,KAAOA,EAAI2C,KAAKsF,GACd4S,EAAMlY,KAAKqE,EAAIlI,GAAG6D,KAAKoF,EAAI/H,GAAKykC,IAChCD,EAAM7hC,KAAKqE,EAAIlI,GAAG6D,KAAKoF,EAAI/H,IAAK,EAChCA,IAGFlB,YAKA4lC,UAAgB1vB,EAAA,EAGpBvS,YAAYuE,EAAWe,EAAWC,EAAWC,GAC3C9E,MAAM6D,EAAGe,EAAGC,EAAGC,GACftF,KAAKgiC,MAAS39B,GAAKgB,GAAKD,GAAKE,GAAOD,GAAKhB,GAAKiB,GAAKF,EAGrDtF,IAAIoY,EAAc2pB,EAAoBI,GACpC,IAAKC,EAAIC,EAAI98B,GAAKrF,KAAKoiC,iBAEnBjmC,EAAI,EACR,KAAOA,EAAIkJ,GACLw8B,EAAMK,EAAK/lC,GAAGgmC,KAChBjqB,EAAMgqB,EAAK/lC,GAAGgmC,GAAMF,KAEtB9lC,GAAK,EAGP,IAAKkmC,EAAIC,EAAIh9B,GAAKtF,KAAKuiC,eACnBllC,EAAI,EACR,KAAOA,EAAIiI,GACLu8B,EAAMQ,GAAIC,EAAKjlC,KACjB6a,EAAMmqB,GAAIC,EAAKjlC,GAAK4kC,KAEtB5kC,GAAK,EAITyC,iBAIE,OAAIE,KAAKgiC,OAELt9B,KAAKyH,IAAInM,KAAKqE,EAAGrE,KAAKqF,GACtBX,KAAK5B,IAAI9C,KAAKoF,EAAGpF,KAAKsF,GACtBZ,KAAKqB,IAAI/F,KAAKqF,EAAIrF,KAAKqE,KAOvBK,KAAKyH,IAAInM,KAAKqE,EAAGrE,KAAKqF,GACtBX,KAAKyH,IAAInM,KAAKoF,EAAGpF,KAAKsF,GACtBZ,KAAKqB,IAAI/F,KAAKqF,EAAIrF,KAAKqE,IAI7BvE,eAIE,OAAIE,KAAKgiC,OAELt9B,KAAKyH,IAAInM,KAAKqE,EAAGrE,KAAKqF,GACtBX,KAAKyH,IAAInM,KAAKoF,EAAGpF,KAAKsF,GACtBZ,KAAKqB,IAAI/F,KAAKsF,EAAItF,KAAKoF,KAkK/Bo9B,EAAA,WACEC,EACAC,EACA/J,EACAC,EACAC,EACAiJ,EACAG,EACAU,GAGA,MAAMjiC,EAAU,UA3JhBZ,YACYogB,EACAC,EACFwY,EACAC,EACAC,GAJE74B,KAAAkgB,OACAlgB,KAAAmgB,OACFngB,KAAA24B,UACA34B,KAAA44B,UACA54B,KAAA64B,aAER,IAAI+J,EAAmB,IAAIh9B,MAAM5F,KAAK64B,YACnCgK,UAAKz6B,GACL5D,IAAIs+B,GAAK9iC,KAAK+iC,gBAEjB/iC,KAAK4iC,MAAQ5iC,KAAKgjC,UAAUhjC,KAAKijC,IAAIL,IACrC5iC,KAAKkjC,MAAQljC,KAAKmjC,WAAWnjC,KAAK4iC,OAG5B9iC,eACN,OAAO,IAAI6J,EACT,EACA,EACA3J,KAAK24B,QAAUn8B,OAAA6V,EAAA,EAAA7V,CAAKwD,KAAK44B,QAAU54B,KAAK24B,SACxC34B,KAAK24B,QAAUn8B,OAAA6V,EAAA,EAAA7V,CAAKwD,KAAK44B,QAAU54B,KAAK24B,UAMpC74B,IAAI8iC,GACV,OAAOA,EAAMQ,OAAO,CAACC,EAAwBC,KAC3C,IACE,IAAInnC,EAAI,EAAGonC,EAAS/mC,OAAA6V,EAAA,EAAA7V,CAAK,KAAO,IAAOkI,KAAK+H,GAC5CtQ,EAAIulC,EACJ6B,GAAS5B,EAAaxlC,IACtB,CAEA,MAAMqnC,EAAc9+B,KAAK8+B,IAAID,GACvBE,EAAc/+B,KAAK++B,IAAIF,GAC7B,IAAIzlC,EAAY,EACZ0I,EAAa,EACb4Z,EAAa,EAEbsjB,EAAa,IAAI/5B,EACnB25B,EAAYj/B,EACZi/B,EAAYl+B,EACZk+B,EAAYj+B,EACZi+B,EAAYh+B,GAGd,KAAOZ,KAAKqB,IAAIS,GAAMxG,KAAKkgB,KAAO,GAAKxb,KAAKqB,IAAIqa,GAAMpgB,KAAKmgB,KAAO,GAAG,CACnE,IAAIwjB,EAAMj/B,KAAK0C,MAAMtJ,EAAI0lC,GACrBI,EAAMl/B,KAAK0C,MAAMtJ,EAAI2lC,GAEzB,KAAOE,IAAQn9B,GAAMo9B,IAAQxjB,GAC3BtiB,GAAK,EACL6lC,EAAMj/B,KAAK0C,MAAMtJ,EAAI0lC,GACrBI,EAAMl/B,KAAK0C,MAAMtJ,EAAI2lC,GAOvB,GAJAC,EAAWjyB,KAAKkyB,EAAMn9B,EAAIo9B,EAAMxjB,GAChC5Z,EAAKm9B,EACLvjB,EAAKwjB,EAEDP,EAAYz2B,MAAMi3B,GAAQH,EAAWI,SAASD,IAEhD,OADAR,EAAY9mC,KAAKmnC,GACVL,GAKb,OAAOA,OAIHvjC,UAAU8iC,GAChB,GAAqB,IAAjBA,EAAMvmC,OACR,OAAOumC,EAGT,MAAM5iB,EAAOxjB,OAAA6V,EAAA,EAAA7V,CAAUomC,EAAMp+B,IAAIq/B,GAAQA,EAAKx/B,IAAM,EACpDu+B,EAAMz8B,QAAQ09B,IACZA,EAAKpyB,MAAMuO,EAAM,KAEnB4iB,EAAQA,EAAM3uB,OAAQ4vB,GAAkBA,EAAKx/B,EAAIw/B,EAAKx+B,EAAIrF,KAAKkgB,MAE/D,MAAMD,EAAOzjB,OAAA6V,EAAA,EAAA7V,CAAUomC,EAAMp+B,IAAIq/B,GAAQA,EAAKz+B,IAAM,EAIpD,OAHAw9B,EAAMz8B,QAAQ09B,IACZA,EAAKpyB,KAAK,GAAIwO,KAET2iB,EAAM3uB,OAAQ4vB,GAAkBA,EAAKz+B,EAAIy+B,EAAKv+B,EAAItF,KAAKmgB,MAGxDrgB,WAAW8iC,GACjB,IAAIhX,EAAkBgX,EAAMp+B,IAAIq/B,GACvBA,EAAKE,eAGd,MAAMC,EAAapY,EAAO9uB,QAE1B,IAAKknC,EACH,KAAM,0CAGR,IAAIC,GAA4BD,GAC5Bd,KAEJ,MAAMxa,EAAW,SAASwb,EAAeC,GAEvC,OAAOz/B,KAAAwH,IAACg4B,EAAO7/B,EAAI8/B,EAAO9/B,EAAM,GAAIK,KAAAwH,IAACg4B,EAAO9+B,EAAI++B,EAAO/+B,EAAM,IAG/D,KAAOwmB,EAAOvvB,QAAQ,CACpB,IAAI+nC,EAAaxY,EAAO9uB,QACxB,IAAKsnC,EACH,KAAM,0CAGR,IAAIC,EAAsBD,EAEtBE,EAAiBL,EAAgB,GACjC7I,EAAc1S,EAAS2b,EAAcC,GAEzCL,EAAgB99B,QAAQL,IACtB,MAAMy+B,EAAkB7b,EAAS5iB,EAAOu+B,GACpCE,EAAkBnJ,IACpBkJ,EAAiBx+B,EACjBs1B,EAAcmJ,KAIlBN,EAAgB1nC,KAAK8nC,GAErBnB,EAAM3mC,KACJ,IAAIwlC,EACFsC,EAAahgC,EACbggC,EAAaj/B,EACbk/B,EAAejgC,EACfigC,EAAel/B,IAKrB,OAAO89B,IAgBPT,EACAC,EACA/J,EACAC,EACAC,GAGF,IAAI3gB,EAAQ1b,OAAA6V,EAAA,EAAA7V,CAAYimC,EAAMC,EAAMC,GAChCd,EAAQrlC,OAAA6V,EAAA,EAAA7V,CAAYimC,EAAMC,EAAM,KAAM,GAE1C,IAAK,IAAIvmC,EAAI,EAAGA,EAAIuE,EAAQkiC,MAAMvmC,OAAQF,IACxCuE,EAAQkiC,MAAMzmC,GAAG8J,IAAIiS,EAAO2pB,EAAOC,GACrC,IAAK,IAAI3lC,EAAI,EAAGA,EAAIuE,EAAQwiC,MAAM7mC,OAAQF,IACxCuE,EAAQwiC,MAAM/mC,GAAG8J,IAAIiS,EAAO2pB,EAAOI,GAErC,OAAO/pB,iCC9RT,IAAYssB,kCAAZ,SAAYA,GACVA,EAAA,gBACAA,EAAA,gBACAA,EAAA,YAHF,CAAYA,+ECACC,EAOX3kC,YAAoB4kC,GAAA1kC,KAAA0kC,WANb1kC,KAAA2b,QAAkB,EAClB3b,KAAA2kC,kBAA4B,EAG3B3kC,KAAA4kC,cAAwB,EAG9B5kC,KAAK6kC,mBAAqB7kC,KAAK0kC,SAAS,GAGnC5kC,IAAIglC,GACT,GAAI9kC,KAAK4kC,aACP,SAGF5kC,KAAK2kC,mBAAqBG,EAE1B,IAAI/hB,KAEJ,MACG/iB,KAAK4kC,cACN5kC,KAAK2kC,mBAAqB3kC,KAAK6kC,oBAE/B7kC,KAAK+kC,UACLhiB,EAASxmB,KAAKyD,KAAK2b,SAGrB,OAAOoH,EAGCjjB,UACRE,KAAK2b,SAAW,EAEhB,IAAIkC,EAAQ7d,KAAK0kC,SAAS1kC,KAAK2b,QAAU,GAErCkC,GACF7d,KAAK2kC,mBAAqB3kC,KAAK6kC,mBAC/B7kC,KAAK6kC,mBAAqBhnB,IAE1B7d,KAAK2kC,kBAAoB3kC,KAAK6kC,mBAC9B7kC,KAAK4kC,cAAe,oFCvCbI,EAIXllC,YAAY6I,GAHJ3I,KAAAilC,YAAsB,EACtBjlC,KAAA2I,SAGNA,EAAMxC,QAAQ,EAAE5D,EAAQkG,KAAUzI,KAAKiG,IAAI1D,EAAQkG,IAG9C3I,IAAIyC,EAAgBkG,GACzB,GAAIlG,EAAS,EACX,KAAM,gCAGRvC,KAAK2I,MAAMpM,MAAMgG,EAAQkG,IACzBzI,KAAKilC,aAAevgC,KAAKwgC,KAAK3iC,GAGzBzC,KAAKqlC,GACV,GAA0B,IAAtBnlC,KAAK2I,MAAMtM,OACb,KAAM,0BAGR,IAAIyjB,EAAOtjB,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKilC,aAEvB,MAAMG,EAAQplC,KAAK2I,MAAMuW,KAAK,EAAE3c,EAAQkG,MACtCqX,GAAQvd,IAEO,GAGjB,QAAc6F,IAAVg9B,EACF,OAAOA,EAAM,GAAGD,GAGlB,KAAM,+BAGDrlC,MAAMusB,GACX,IAAIgZ,EAAY,IAAIL,MAKpB,OAHAhlC,KAAK2I,MAAMxC,QAAQ,EAAE5D,EAAQkG,KAAU48B,EAAUp/B,IAAI1D,EAAQkG,IAC7D4jB,EAAK1jB,MAAMxC,QAAQ,EAAE5D,EAAQkG,KAAU48B,EAAUp/B,IAAI1D,EAAQkG,IAEtD48B,2GCvCWC,EAGpBxlC,cAFUE,KAAAulC,UAMAzlC,aAAa0E,EAAeghC,GACpC,OAAOxlC,KAAKylC,UAAUjhC,EAAK,IAAIwwB,EAAA,EAAaxwB,EAAKghC,IAGzC1lC,WAAW0E,EAAeghC,GAClC,OAAOxlC,KAAKylC,UAAUjhC,EAAK,IAAIwwB,EAAA,EAAWxwB,EAAKghC,IAGzC1lC,UAAU0E,EAAe6B,GAS/B,OARA7J,OAAAkpC,EAAA,EAAAlpC,CACEgI,EACA6B,GAAQA,EAAK66B,OACb,CAAC78B,EAAGe,KACFZ,EAAIuG,QAAQ1G,EAAGe,EAAGiB,KAIf7B,4FCtBEmhC,EAUX7lC,YACSS,EACAqlC,GADA5lC,KAAAO,SACAP,KAAA4lC,mBATF5lC,KAAAiB,YAAsB,EACtBjB,KAAA6lC,SAAmB,EACnB7lC,KAAAwZ,OAA4B,KAC5BxZ,KAAAsB,MAAgB,EAEbtB,KAAA8lC,KAA6C,IAAIntB,IAMzD3Y,KAAK6K,OAAS,IAAIk7B,EAAA,EAAOxlC,GAGpBT,OACDE,KAAK6lC,SAAY7lC,KAAKO,OAAOW,GAAGyK,YAAc3L,KAAKwZ,SAGvDxZ,KAAK6lC,SAAU,EAEf7lC,KAAKgmC,YAELhmC,KAAK6lC,SAAU,GAGP/lC,YACR,IAAIE,KAAKO,OAAOW,GAAG8hB,YAAnB,CAIA,IAAKhjB,KAAKgB,WACR,KAAM,8BAGR,GAAIhB,KAAKwZ,OACPxZ,KAAKO,OAAOoiB,cAAc3iB,KAAKgB,YAC/BhB,KAAKwZ,OAAO6Q,YAAYrqB,KAAKO,OAAOwR,YAAY/R,KAAKgB,aAEjDhB,KAAKwZ,OAAOpY,SACdpB,KAAKwZ,OAAO0Q,SACZlqB,KAAKwZ,OAAS,UAEX,CACL,MAAQxZ,KAAKO,OAAOc,OAASrB,KAAKiB,YAChCjB,KAAKimC,aAAajmC,KAAKgB,YAGzBhB,KAAKO,OAAOoiB,cAAc3iB,KAAKgB,cAI5BlB,OAAO5B,GACZ,MAAMgM,EAAWlK,KAAK8lC,KAAKvnC,IAAIL,GAE/B,IAAKgM,EACH,YAAahM,iBAGf,GAAIgM,aAAoBg8B,EAAA,EACtB,OAAOh8B,EACF,GAAIA,aAAoBi8B,SAAU,CACvC,MAAMC,EAAgBl8B,EAAShM,EAAM8B,MAErC,OADAA,KAAK8lC,KAAKzsB,IAAInb,EAAMkoC,GACbA,EAEP,yBAA0BloC,iBAIvB4B,OAAO5B,EAAcmoC,GAC1B,GAAIrmC,KAAK8lC,KAAKQ,IAAIpoC,GAChB,yBAA0BA,qBAG5B8B,KAAK8lC,KAAKzsB,IAAInb,EAAMmoC,GAGdvmC,aAAaoK,GACnB,IAAIqkB,EAAWrkB,EAASqkB,SAExB,MAAMgY,EAAUhY,EAAStH,OAEzB,QAAgB7e,IAAZm+B,EACF,KAAM,2BAGR,MAAMr9B,EAAQgB,EAASokB,UAAUpP,KAAKpW,GAAYy9B,IAAYz9B,EAASM,IAEvE,GAAIF,EAAO,CACT,MAAM+P,EAAQ/P,EAAMoR,IAAIpQ,EAAUlK,MAClCA,KAAKsB,OAAS,EAIZ2X,GACA/O,EAASokB,UAAUpP,KAAKpW,GAAYy9B,IAAYz9B,EAASM,KAEzDmlB,EAAStoB,IAAIsgC,EAASttB,6GCpFjBokB,EAAbv9B,cACUE,KAAAya,IAAwB,IAAI+rB,EAAA,EAE7BxmC,KAAAqxB,SAAW,IAAIoV,EAAA,EAASC,EAAA,EAASjjC,OACjCzD,KAAA2mC,WAAa,IAAIF,EAAA,EACjBzmC,KAAA4mC,UAAY,IAAIH,EAAA,EAChBzmC,KAAA6mC,UAAY,IAAIJ,EAAA,EAAUC,EAAA,EAASjjC,OACnCzD,KAAAuxB,cAAgB,IAAIkV,EAAA,EAAcC,EAAA,EAASjjC,OAC3CzD,KAAAyxB,aAAe,IAAIgV,EAAA,EAAaC,EAAA,EAASjjC,OACzCzD,KAAA8mC,eAAiB,IAAIL,EAAA,EACrBzmC,KAAA+mC,gBAAkB,IAAIN,EAAA,EACtBzmC,KAAAizB,WAAa,IAAIwT,EAAA,EACjBzmC,KAAAgnC,cAAgB,IAAIP,EAAA,EACpBzmC,KAAAinC,SAAW,IAAIR,EAAA,EACfzmC,KAAA6yB,UAAY,IAAI4T,EAAA,EAAUC,EAAA,EAASjjC,OACnCzD,KAAAoW,kBAAoB,IAAIqwB,EAAA,EACxBzmC,KAAA+V,YAAc,IAAI0wB,EAAA,EAClBzmC,KAAAknC,UAAY,IAAIT,EAAA,EAEvBzY,gBACE,OACEhuB,KAAKqxB,SACLrxB,KAAKuxB,cACLvxB,KAAKyxB,aACLzxB,KAAK6mC,UACL7mC,KAAK6yB,WAIF/yB,QACL,OACEE,KAAKqxB,SACLrxB,KAAK2mC,WACL3mC,KAAK4mC,UACL5mC,KAAK6mC,UACL7mC,KAAKuxB,cACLvxB,KAAKyxB,aACLzxB,KAAK8mC,eACL9mC,KAAK+mC,gBACL/mC,KAAKizB,WACLjzB,KAAKgnC,cACLhnC,KAAKinC,SACLjnC,KAAK6yB,UACL7yB,KAAKoW,kBACLpW,KAAK+V,YACL/V,KAAKknC,WAITC,eACE,OAAO3qC,OAAA4qC,EAAA,OAAA5qC,CACLwD,KAAKgU,QACLxX,OAAA4qC,EAAA,QAAA5qC,CAAQwD,KAAKmlB,QAAQ3gB,IAAI+a,GAAQA,EAAKzL,aAI1CuzB,0BACE,OACErnC,KAAKqxB,SACLrxB,KAAK6mC,UACL7mC,KAAKizB,WACLjzB,KAAKgnC,cACLhnC,KAAKinC,SACLjnC,KAAK6yB,WACL5e,OAAQsL,IAAyBA,EAAKzL,WAAWzX,OAG9CyD,QACL,OAAOE,KAAKya,IAAIC,MAGX5a,UAAU2I,GACf,OAAOzI,KAAKya,IAAIyE,KAAKzW,GAGhB3I,SAAS2I,EAAYC,GAC1B1I,KAAKya,IAAI5R,IAAIJ,EAAMC,GAGd5I,cAAc2I,EAAYC,GAC/B1I,KAAKya,IAAIE,OAAOlS,EAAMC,kGCnGb4+B,EAMXxnC,YAAmBuG,GAAArG,KAAAqG,OALZrG,KAAA0S,SAAmB,EACnB1S,KAAAoY,OAAiB,EACjBpY,KAAAs7B,MAAgB,EAKvB3yB,YACE,OAAO3I,KAAKqG,KAAKsC,MAGnBG,eACE,OAAO9I,KAAKqG,KAAKyC,SAGZhJ,IAAIuG,EAAY+R,GACrBpY,KAAK0S,SAAU,EACf1S,KAAKoY,OAASA,EACdpY,KAAKs7B,MAAO,EACZt7B,KAAKqG,KAAOA,EAAKkD,QAGZzJ,SAASoJ,GACd,OAAOlJ,KAAKs7B,OAASt7B,KAAKqG,KAAK2C,gBAAgBE,GAG1CpJ,QACLE,KAAK0S,SAAU,EACf1S,KAAKwZ,YAASpR,EACdpI,KAAKqG,KAAKyC,cAAWV,EAGhBtI,MAAM0J,GACXxJ,KAAKqG,KAAK8L,MAAM3I,UAIP+9B,UAAe3J,EAAA,EAC1B99B,YAAY4F,EAAezB,GACzB,MAAMujC,EAAW,IAAI7W,EAAA,EACrBnwB,MAAMhE,OAAA2Q,EAAA,YAAA3Q,CAAYkJ,EAAOzB,EAAQ,IAAM,IAAIqjC,EAAWE,KAGjD1nC,eACLE,KAAK2gB,KAAKta,GAAQA,EAAK8Q,yIC9BdhV,UAAeslC,EAAA,EAoB1B3nC,YACS+d,EACA3c,EACPqO,EACAxN,GAEAvB,MAAM+O,GALCvP,KAAA6d,QACA7d,KAAAkB,KArBFlB,KAAAysB,eACAzsB,KAAA+T,UAAuB,IAAI5G,EAAA,UAE3BnN,KAAA4jB,oBACA5jB,KAAA0nC,oBAKA1nC,KAAA2nC,SAAqB,IAAIC,EAAA,EAkB9B5nC,KAAK6b,SAAW,IAAIgsB,EAAA,EAAa9lC,EAAW8Z,UAC5C7b,KAAK+gB,UAAY,IAAI8mB,EAAA,EAAc9lC,EAAWgf,WAC9C/gB,KAAK8b,aAAe,IAAI+rB,EAAA,EAAiB9lC,EAAW+Z,cACpD9b,KAAKghB,aAAe,IAAI6mB,EAAA,EAAK9lC,EAAWif,cACxChhB,KAAKihB,OAAS,IAAI4mB,EAAA,EAAK9lC,EAAWkf,QAClCjhB,KAAKkhB,SAAW,IAAI2mB,EAAA,EAAK9lC,EAAWmf,UAEpClhB,KAAKsiB,YAAc,IAAIulB,EAAA,EAAK,GAC5B7nC,KAAKuiB,iBAAmB,IAAIslB,EAAA,EAC1B7nC,KAAK6b,SAASF,QACd3b,KAAK8b,aAAaH,SAIf7b,IAAIoK,EAAoBhF,GAC7BlF,KAAKoa,YACLpa,KAAKkZ,WAAWhP,GAEhB,MAAMmQ,EAAUra,KAAKkB,GAAGoZ,IAAIta,KAAMkK,EAAUhF,GAM5C,OALImV,GACFra,KAAKkE,GAAGmW,GAEVra,KAAKkE,GAAG,IAAI4jC,EAAA,EAAW59B,EAAUhF,IAE1BlF,KAAKiZ,MAGPnZ,cAAcoK,GACnBlK,KAAKkZ,WAAWhP,GAGXpK,GAAGsT,GACR,OAAOA,EAAM20B,aAAa/nC,MAG5B8V,cAEE,OAAO9V,KAAK+T,UAAUgC,YAAYjC,UAGpC2D,qBACE,OAAOzX,KAAK+T,UAAUozB,SAGjBrnC,QAAQ2I,EAAYC,GACzB1I,KAAK+T,UAAU2P,SAASjb,EAAMC,GAGzB5I,WAAW2I,EAAYC,GAC5B1I,KAAK+T,UAAUga,cAActlB,EAAMC,GAGrCwR,0BACE,OACEla,KAAKuP,OAAOhN,OACZ/F,OAAA2L,EAAA,MAAA3L,CAAMwD,KAAK+T,UAAUozB,SAAU,EAAG1+B,OAAMC,WAAYD,EAAKlG,OAASmG,GAItEnF,kBACE,OAAOvD,KAAKuP,OAAOhM,YAAcvD,KAAK+gB,UAAUjE,sBAGlDhE,mBACE,MAAMkvB,EAAsBhoC,KAAK+gB,UAAUhE,kBAE3C,OAAOvgB,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKuP,OAAO7L,gBAAiB1D,KAAKioC,uBAAuBzjC,IACpEsI,IACC,IAAIo7B,EAAM1rC,OAAA2L,EAAA,UAAA3L,CAAUsQ,GAEpB,OADAo7B,EAAInlC,OAASilC,EACNE,IAKbzlC,cACE,MAAM0lC,EAAqBnoC,KAAK6b,SAASa,gBAEzC,OAAOlgB,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKuP,OAAO9M,QAASzC,KAAKooC,qBAAqB5jC,IAC1DsI,IACC,IAAIo7B,EAAM1rC,OAAA2L,EAAA,UAAA3L,CAAUsQ,GAEpB,OADAo7B,EAAInlC,OAASolC,EACND,IAKb1lC,kBAGE,OAAOhG,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKuP,OAAO/M,YAAaxC,KAAK4jB,mBAExClhB,KAAM2lC,EAAA,EAAer6B,UACrBrP,MALsB,EAKKqB,KAAK+T,UAAUszB,uBAKhDlkC,kBACE,OAAO3G,OAAA2L,EAAA,OAAA3L,CAAOwD,KAAKuP,OAAOpM,YAAanD,KAAK0nC,kBAGpC5nC,oBACR,MAAMwoC,EAActoC,KAAK+T,UAAUwd,cAAczd,UAC/Cy0B,EAAavoC,KAAK+T,UAAU0d,aAAa3d,UAG3C,OAAOtX,OAAA2L,EAAA,OAAA3L,CACL8rC,EAAcA,EAAY7/B,KAAKhG,WAC/B8lC,EAAaA,EAAW9/B,KAAKhG,YAIvB3C,sBACR,MAAM0oC,EAAYxoC,KAAK+T,UAAUgC,YAAYjC,UAC3C20B,EAAkBzoC,KAAK+T,UAAUqC,kBAAkBtC,UAGrD,OAAOtX,OAAA2L,EAAA,OAAA3L,CAELgsC,GAAYA,EAAU//B,KAAKhG,YAC3BgmC,EAAkBA,EAAgBhgC,KAAKhG,8FCvKhCimC,UAAqBC,EAAA,EAAlC7oC,kCACkBE,KAAA4oC,MAAgB,QAEtB9oC,gBACRE,KAAKod,UAAYpd,KAAKO,OAAOwT,UAAUC,QAGlClU,WACLE,KAAKmB,4FCLI0nC,UAA0BvS,EAAA,EACrCzR,WACE,OAAOyR,EAAA,EAAkBwS,KAG3BC,mBACE,OAAO/oC,KAAKO,OAAOsd,MAAMlC,QAG3BgpB,wBACE,SAAU3kC,KAAKO,OAAOsd,MAAM8mB,qBAC1B3kC,KAAKO,OAAOsd,MAAMgnB,sHCZXmE,UAAuBC,EAAA,EAApCnpC,kCACkBE,KAAA4oC,MAAgB,cAEtB9oC,gBACRE,KAAKod,UAAYpd,KAAKO,OAAOwT,UAC1BC,QACAC,OAAOC,GAAaA,EAAUzL,KAAK+F,QAAUgJ,EAAA,EAAU/H,QAGrD3P,UAAS2I,KAAEA,IAChBzI,KAAKO,OAAO2D,GAAG,IAAI2H,EAAA,iBAAiBpD,EAAMzI,KAAKkF,OAC/ClF,KAAKmB,oGCVI+nC,UAA2BP,EAAA,EAAxC7oC,kCACkBE,KAAA4oC,MAAgB,gBAEtB9oC,gBACRE,KAAKod,UAAYpd,KAAKO,OAAOwT,UAAUC,QAGlClU,UAAU6I,GACXA,EAAMtM,QACR2D,KAAKO,OAAO2D,GAAG,IAAIilC,EAAA,EAAenpC,KAAKqG,KAAMsC,EAAO3I,KAAKkF,OACzDlF,KAAKmB,WAELnB,KAAKud,2FCXE6rB,UAA6B9S,EAAA,EACxCzR,WACE,OAAOyR,EAAA,EAAkB+S,QAG3BnrC,WACE,OAAO8B,KAAKO,OAAOrC,KAGrBqE,aACE,OAAOvC,KAAKuP,OAAOhN,OAGrB0B,aACE,OAAOjE,KAAKuP,OAAOtL,OAGrBrC,aACE,OAAO5B,KAAKuP,OAAO3N,OAGrB+B,eACE,OAAO3D,KAAKuP,OAAO5L,SAGrBE,gBACE,OAAO7D,KAAKuP,OAAO1L,UAGrBE,gBACE,OAAO/D,KAAKuP,OAAOxL,UAGrBlC,WACE,OAAO7B,KAAKO,OAAOgP,OAAO1N,KAG5BP,YACE,OAAOtB,KAAKkF,KAAK5D,0GCvCTgoC,yBAAZ,SAAYA,GACVA,IAAA,aACAA,IAAA,mBACAA,IAAA,mBAHF,CAAYA,iBAMCC,UAAsBC,EAAA,EAIjC1pC,YAAYoK,EAAoBhF,GAC9B1E,MAAM0J,EAAUhF,EAAM,IAAKwqB,GAAU1vB,KAAKgY,OAAOxF,QAAQkd,IAG3DhtB,WACE,OAAOmU,EAAA,EAAc4yB,KAGvBb,YACE,OAAI5oC,KAAKylB,WAAW/S,QACX42B,EAAwBI,IACtB1pC,KAAKylB,WAAW6V,KAClBgO,EAAwBK,OAExBL,EAAwBM,OAInCC,WACE,IAAI9a,KAUJ,GARI/uB,KAAKylB,WAAW3c,WACd9I,KAAKylB,WAAW3c,SAASM,KAAOpJ,KAAKO,OAAO6I,GAC9C2lB,EAASxyB,KAAK,SAEdwyB,EAASxyB,YAAYyD,KAAKylB,WAAW3c,SAAS5K,SAI9C8B,KAAKylB,WAAW9c,MAClB,OAAQ3I,KAAKylB,WAAW9c,MAAM+R,MAAMre,QAClC,KAAK,EACH,MACF,KAAK,EACH0yB,EAASxyB,cAAcyD,KAAKylB,WAAW9c,MAAM+R,MAAM,GAAGjS,KAAKvK,QAC3D,MACF,QACE6wB,EAASxyB,KAAK,6BAIpB,OAAOwyB,EAGCjvB,QACRE,KAAK4L,SAAS,IAAIuB,EAAA,cAAcnN,KAAKkK,SAAUlK,KAAKkF,wFCrD3C4kC,UAAwBj+B,EAAA,gCAArC/L,kCACkBE,KAAA4oC,MAAgB,eAEtB9oC,gBACR,MAAM6I,EAAQ3I,KAAKqG,KAAKsC,MAExB,QAAcP,IAAVO,EACF,KAAM,oDAGR3I,KAAKod,UAAYzU,EAAM+R,MAAMlW,IAAI0P,KACtBzL,KAAMyL,EAAUzL,KAAMC,MAAOwL,EAAUxL,SAI7C5I,UAAU6I,GAEf3I,KAAKO,OAAO2D,GAAG,IAAI2H,EAAA,iBAAiB7L,KAAKqG,KAAMsC,EAAO3I,KAAKkF,OAC3DlF,KAAKmB,0GCpBI4oC,UAAmClzB,EAAA,EAG9C/W,YAA4B+d,EAAe3T,EAAoBhF,GAC7D1E,MAAM0J,EAAUhF,GADUlF,KAAA6d,QAE1B7d,KAAK21B,QAAU31B,KAAKkF,KAAK0gC,iBAAiBoE,UAAUhqC,KAAKO,QAG3DmC,WACE,OAAOmU,EAAA,EAAcozB,kBAGhBnqC,eAAe0sB,GACpBxsB,KAAKO,OAAO2D,GAAG,IAAI5D,EAAA,oBAAoBksB,IAEvCxsB,KAAK4L,SACH,IAAIs+B,EAAA,EAAwBlqC,KAAK6d,MAAO7d,KAAKkK,SAAUlK,KAAKkF,iGCdrDilC,UAA4BxB,EAAA,EAGvC7oC,YACUsqC,EACDhtB,EACPlT,EACAhF,GAEA1E,MAAM0J,EAAUhF,GALRlF,KAAAoqC,aACDpqC,KAAAod,YAJOpd,KAAA4oC,MAAgB,cAWtB9oC,iBAEHA,SAASoU,GACdlU,KAAKoqC,WAAWl2B,GAGXpU,QACLE,KAAK4L,SAAS,IAAIy+B,EAAA,EAAmBrqC,KAAKkK,SAAUlK,KAAKkF,wGCpBhDolC,UAA+BC,EAAA,EAI1CzqC,YAAYoK,EAAoBhF,GAC9B1E,MACE0J,EACAhF,EACA,IACA,EAAGb,IAAGe,OACJ8E,EAASuI,GAAGpO,EAAGe,GAAG4D,gBAAgBhJ,KAAKO,SACvCP,KAAKgY,OAAOvF,GAAGpO,EAAGe,GAAGk2B,MAI3B54B,WACE,OAAOmU,EAAA,EAAcoe,cAGvB2T,YACE,MAAO,6BAGTiB,WACE,SAGQ/pC,QACJE,KAAKqlB,UAAU3T,GAAG1R,KAAKkK,SAAS8H,YAAYhS,KAAKO,SACnDP,KAAKkF,KAAK2F,OAAO2/B,gCAEjBxqC,KAAKO,OAAO2D,GAAG,IAAI2N,EAAA,EAAU7R,KAAKkF,KAAMlF,KAAKkK,SAAUlK,KAAKqlB,YAG9DrlB,KAAKmB,4FCpCT,MAEaspC,EAAU,SACrBjmC,EACA0N,EACAD,EACAT,EACAk5B,GAA6B,GAE7B,IAAI34B,EAA0BvV,OAAAmuC,EAAA,EAAAnuC,CAAYgI,EAAIkB,MAAOlB,EAAIP,OAAQ,KAAO,GACpE2mC,KACAt4B,GAA0BJ,GAE1B2U,EAAO,EACX,KAAOvU,EAAcjW,SAAWuuC,EAAcvuC,QAAQ,CACpD,IAAIkW,KAEJD,EAAcnM,QAASL,IACrB,IAAKtB,EAAIgO,QAAQ1M,GACf,OAGF,MAAMO,EAAO7B,EAAIiO,GAAG3M,EAAMzB,EAAGyB,EAAMV,GAE/B6M,EAAS5L,KAA4C,IAAnC0L,EAAYjM,EAAMzB,GAAGyB,EAAMV,KAIjD2M,EAAYjM,EAAMzB,GAAGyB,EAAMV,GAAKyhB,EAC5BrV,EAAY1L,EAAOO,GACrBukC,EAAcruC,KAAKuJ,GAEnBA,EAAM6M,WAAWxM,QAAQyM,GAAQL,EAAWhW,KAAKqW,OAGrDiU,IAEAvU,EAAgBC,EAGlB,GAAIq4B,EAAcvuC,OAAQ,CAExB,IAAIwuC,EAAqBruC,OAAA2H,EAAA,OAAA3H,CAAOouC,GAChC,OACSE,EADLJ,GAAqBG,EACNA,EAEAD,EAAc,GAFM74B,GAKvC,UAIE+4B,EAAY,SAAShlC,EAAciM,GACvC,IAGI5K,EAHA4jC,EAAYjlC,EACZklC,GAASD,GAIb,KA3DyB,IA2DlBh5B,EAAYg5B,EAAU1mC,GAAG0mC,EAAU3lC,IAAmB,CAW3D,QAAcgD,KAVdjB,EAAQwjC,EAAA,EAAM3kC,IAAIkZ,KACf+rB,GAEGl5B,EAAYg5B,EAAU1mC,EAAI4mC,EAAG5mC,IAC7B0N,EAAYg5B,EAAU1mC,EAAI4mC,EAAG5mC,GAAG0mC,EAAU3lC,EAAI6lC,EAAG7lC,KAC/C2M,EAAYg5B,EAAU1mC,GAAG0mC,EAAU3lC,GAAK,IAM9C,SAGF2lC,EAAYA,EAAU9kC,IAAIkB,GAE1B6jC,EAAMtkC,QAAQqkC,GAGhB,OAAOC,4EC/EF,MAAME,EAAsB,SACjCC,EACAvf,GAEA,IAUEwf,EAVEC,EAAkB7uC,OAAA2L,EAAA,MAAA3L,CAAM2uC,GAC1BG,EAAsB9uC,OAAO+uC,KAAKJ,GAClCK,GACE3vB,SAAU,EACVkF,UAAW,EACXjF,aAAc,EACdkF,aAAc,EACdC,OAAQ,EACRC,SAAU,GAId,KAAOoqB,EAAoBjvC,QACzBivC,EAAsBA,EAAoBr3B,OACxCw3B,GAAaJ,EAAgBI,IAAc7f,IAE7Cwf,EAAkB5uC,OAAA2L,EAAA,OAAA3L,CAAO8uC,MAGvB1f,GAAUyf,EAAgBD,GAC1BI,EAAgBJ,IAAoB,EACpCC,EAAgBD,IAAoB,GAIxC,OAAQI,EAAiB5f,sEChBf8f,yBAAZ,SAAYA,GACVA,IAAA,uBAEAA,IAAA,uCACAA,IAAA,mCACAA,IAAA,+CACAA,IAAA,qDACAA,IAAA,iCACAA,IAAA,mCACAA,IAAA,6BATF,CAAYA,oJCjBkX,iECA4B,oDCAH,oDCAnB,oDCAyB,oDCAnC,oDCAzB,oDCAwB,oDCAE,oDCA6B,oDCA7B,oDCAqB,oDCA5B,oDCAmC,oDCAG,oDCAnB,oDCA0B,oDCAb,oDCApD,oDCAA,8ECAxLC,wBCUzJC,EAAA,EAAIC,QACjB3tC,KAAM,aACN4tC,OAAQ,OAAQ,OAAQ,gCCJ1BC,EAAAvvC,OAAAwvC,EAAA,EAAAxvC,CACAmvC,ECTA,WAA0B,IAAaM,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,cAAAC,OAAiCC,aAAjHvsC,KAAiHwsC,aAAjHxsC,KAAgJysC,GAAA,KAAAN,EAAA,QAAyBE,YAAA,OAAAK,UAA6BC,YAAtM3sC,KAAsM4sC,GAAtM5sC,KAAsM6sC,SAAtM7sC,KAAsOysC,GAAA,MAAtOzsC,KAAsO4sC,GAAtO5sC,KAAsO9B,cDYhQ,EACA,KACA,WACA,MAIA6tC,EAAApW,QAAAmX,OAAA,iBACA,IAAAC,EAAAhB,iBEpB2LiB,ECqD5KpB,EAAA,EAAIC,QACjB3tC,KAAM,0BACN4tC,OAAQ,QACRhsC,OACE,OACEmtC,kBAAkB,EAClBrhB,OAAQ5rB,KAAKwB,KAAKoqB,OAClBshB,oBACErxB,SAAU,EACVkF,UAAW,EACXjF,aAAc,EACdkF,aAAc,EACdC,OAAQ,EACRC,SAAU,GAEZisB,eAAgBntC,KAAKwB,KAAK2rC,iBAG9BC,YACEL,cAEFM,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACZ,IAAK,IACH,OAAOe,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IACH,OAAOntC,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IACH,OAAOntC,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IACH,OAAOntC,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IACH,OAAOntC,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IACH,OAAOntC,KAAKsb,SAAStb,KAAKmtC,eAAe,IAC3C,IAAK,IACH,OAAOntC,KAAKwc,SAASxc,KAAKmtC,eAAe,IAE3C,IAAK,IAGH,OAFAntC,KAAKitC,kBAAmB,QACvBjtC,KAAKktC,mBAAoBltC,KAAK4rB,QAAUpvB,OAAA8wC,EAAA,oBAAA9wC,CAAoBwD,KAAKwB,KAAK2pC,eAAgBnrC,KAAKwB,KAAKoqB,SAGnG,IAAK,IACL,IAAK,IACH,OAAI5rB,KAAKitC,iBACAjtC,KAAKwB,KAAK+rC,MAAMvtC,KAAKktC,yBAE5BltC,KAAKitC,kBAAmB,GAG5B,IAAK,IACH,OAAOjtC,KAAKwB,KAAKgsC,SAGvBC,kBAAkBhC,GACE,IAAdA,EACK,IACEA,EAAY,MACVA,IAEJA,EAAUiC,WAGrBnC,KAAKoC,IAED,KACA,KACA,KACA,KACA,KACA,MACAA,GAEJ7tC,eAAe8tC,GACb,OAAO5tC,KAAKwB,KAAK2pC,eAAeyC,GAAiB5tC,KAAKktC,mBAAmBU,IAE3E9tC,YAAY8tC,GACV,OAAO5tC,KAAKktC,mBAAmBU,GAAiB,GAElD9tC,YAAY8tC,GACV,OAAO5tC,KAAK4rB,QAAU5rB,KAAK6tC,eAAeD,IAE5C9tC,SAAS8tC,GACP5tC,KAAKitC,kBAAmB,EAEpBjtC,KAAK8tC,YAAYF,KACnB5tC,KAAK4rB,QAAU5rB,KAAK6tC,eAAeD,GACnC5tC,KAAKktC,mBAAmBU,IAAkB,IAG9C9tC,SAAS8tC,GACP5tC,KAAKitC,kBAAmB,EAEpBjtC,KAAK+tC,YAAYH,KACnB5tC,KAAKktC,mBAAmBU,IAAkB,EAC1C5tC,KAAK4rB,QAAU5rB,KAAK6tC,eAAeD,QC7J3CI,UAAAxxC,OAAAwvC,EAAA,EAAAxvC,CACAwwC,ECTA,WAA0B,IAAAiB,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAuB4B,EAAAxB,GAAA,6BAAAN,EAAA,SAAAA,EAAA,SAAAA,EAAA,MAAuEE,YAAA,wBAAkCF,EAAA,MAAAA,EAAA,MAAoBE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,mDAAA9B,EAAA,MAAwFE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,qDAAA9B,EAAA,MAA0FE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,qDAAA9B,EAAA,MAA0FE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,mDAAA9B,EAAA,MAAwFE,YAAA,aAAuB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,uDAAA9B,EAAA,MAA4FE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,wDAAA9B,EAAA,QAAA8B,EAAAE,GAAAF,EAAA,wBAAA/vC,EAAAyvC,GAAgJ,OAAAxB,EAAA,MAAgBE,YAAA,kBAA4BF,EAAA,MAAWE,YAAA,QAAkB4B,EAAAxB,GAAA,KAAAN,EAAA,OAAwBE,YAAA,QAAkB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA1C,KAAAoC,OAAAM,EAAAxB,GAAA,OAAAN,EAAA,MAA2DE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA/vC,EAAA,yBAAAiuC,EAAA,MAAmEE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAzsC,KAAA4sC,iBAAAlwC,OAAAiuC,EAAA,MAA6DE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAR,kBAAAQ,EAAAzsC,KAAA6sC,iBAAAnwC,QAAAiuC,EAAA,MAAoFE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAzsC,KAAA2pC,eAAAjtC,OAAAiuC,EAAA,MAA2DE,YAAA,aAAuBF,EAAA,KAAUE,YAAA,2BAAAC,OAA8CgC,WAAAL,EAAAF,YAAA7vC,IAAsCgG,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAA3yB,SAAApd,OAAqB+vC,EAAAxB,GAAA,OAAAwB,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAR,kBAAAQ,EAAAf,mBAAAhvC,MAAAiuC,EAAA,KAA4FE,YAAA,4BAAAC,OAA+CgC,WAAAL,EAAAH,YAAA5vC,IAAsCgG,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAzxB,SAAAte,OAAqB+vC,EAAAxB,GAAA,SAAAN,EAAA,MAA2BE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAJ,eAAA3vC,cAA+CiuC,EAAA,OAAeE,YAAA,gBAA0B4B,EAAAxB,GAAA,IAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,oDAAsFriB,OAAAqiB,EAAAriB,aAAqBugB,EAAA,OAAgBE,YAAA,iBAA2BF,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA+vC,EAAAhB,iBAAA,qBAA8Dd,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,SAAAsuC,WAAA,KAA6CL,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,WAA0B,UDYp3E,EACA,KACA,WACA,OAIA8vC,EAAArY,QAAAmX,OAAA,8BACA,IAAA4B,EAAAV,UEpBoLW,ECiBrK/C,EAAA,EAAIC,QACjB3tC,KAAM,mBACN4tC,OAAQ,QACRsB,YACEL,cAEFM,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,IAAI2vC,eAClB,IAAK,IACH,OAAO5uC,KAAKwB,KAAKqtC,WAAWvB,EAAA,OAAOxoC,MACrC,IAAK,IACH,OAAO9E,KAAKwB,KAAKqtC,WAAWvB,EAAA,OAAOwB,QACrC,IAAK,IACH,OAAO9uC,KAAKwB,KAAKgE,SACnB,IAAK,IACH,OAAOxF,KAAKwB,KAAKgsC,YC1BzBuB,EAAAvyC,OAAAwvC,EAAA,EAAAxvC,CACAmyC,ECRA,WAA0B,IAAa1C,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAlHrsC,KAAyIysC,GAAA,sBAAAN,EAAA,OAAyCE,YAAA,iBAA2BF,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,UAA0BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,YAA4BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,SAAAsuC,WAAA,KAA6CL,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,OAAAsuC,WAAA,MAA2C,UDW7d,EACA,KACA,KACA,MAIAuC,EAAApZ,QAAAmX,OAAA,uBACA,IAAAkC,EAAAD,UEiBA,ICpCwLE,EDoCzKrD,EAAA,EAAIC,QACjB3tC,KAAM,uBACN4tC,OAAQ,QACRjwC,KAAI,MAEA2wB,sBAAkBpkB,IAGtB8mC,UACEpvC,QACE,YAAiCsI,IAA1BpI,KAAKwsB,mBAGhB6gB,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACZ,IAAK,QAIH,YAHIe,KAAKwsB,kBACPxsB,KAAKwB,KAAK2tC,eAAenvC,KAAKwsB,mBAGlC,IAAK,IACH,OAAOxsB,KAAKwB,KAAKgsC,OACrB,QACE,OAAOxtC,KAAKovC,SAASh8B,EAAMnU,IAAIk+B,WAAW,GA5B5B,MA+BlBr9B,SAAS3D,GACP,MAAM2F,EAAa9B,KAAKwB,KAAKirB,YAAYtwB,GACzC6D,KAAKwsB,iBAAmB1qB,GAAc9B,KAAKwsB,kBAE7C6iB,SAASC,yBACsBA,SAGjClC,YACEL,gBEhEJwC,UAAA/yC,OAAAwvC,EAAA,EAAAxvC,CACAyyC,ECTA,WAA0B,IAAAhB,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAuB4B,EAAAxB,GAAA,6BAAAN,EAAA,OAAgDE,YAAA,oBAA+B4B,EAAAE,GAAAF,EAAAzsC,KAAA,qBAAAM,EAAA3F,GAAsD,OAAAgwC,EAAA,OAAiBE,YAAA,oBAAAC,OAAuCkD,UAAA1tC,IAAAmsC,EAAAzhB,kBAAiDtoB,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAzhB,iBAAA1qB,MAAoCqqC,EAAA,OAAYE,YAAA,OAAAoC,OAA0BgB,IAAAxB,EAAAoB,SAAAvtC,EAAA5D,SAAqCiuC,EAAA,OAAYE,YAAA,SAAmBF,EAAA,QAAaE,YAAA,QAAkB4B,EAAAxB,GAAA,KAAAN,EAAA,QAAyBE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,cAAAD,CAAA9xC,OAAA8xC,EAAAxB,GAAA,SAAAN,EAAA,QAAwEE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAAnsC,EAAA5D,KAAA,0BAAmEiuC,EAAA,OAAaE,YAAA,iBAA2B4B,EAAA,MAAA9B,EAAA,cAA+BsC,OAAO5B,KAAA,QAAA3uC,KAAA,OAAAsuC,WAAA,KAA+CyB,EAAAyB,KAAAvD,EAAA,cAA4BsC,OAAO5B,KAAA,IAAA3uC,KAAA,OAAAsuC,WAAAyB,EAAAV,UAAiD,UDYv/B,EACA,KACA,WACA,OAIAgC,EAAA5Z,QAAAmX,OAAA,2BACA,IAAA6C,EAAAJ,UEpBkLK,ECiBnKhE,EAAA,EAAIC,QACjB3tC,KAAM,iBACN4tC,OAAQ,QACRsB,YACEL,cAEFM,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,IAAI2vC,eAClB,IAAK,IACH,OAAO5uC,KAAKwB,KAAKquC,SAASvC,EAAA,WAC5B,IAAK,IACH,OAAOttC,KAAKwB,KAAKquC,SAASvC,EAAA,WAC5B,IAAK,IACH,OAAOttC,KAAKwB,KAAKgE,SACnB,IAAK,IACH,OAAOxF,KAAKwB,KAAKgsC,YC1BzBsC,EAAAtzC,OAAAwvC,EAAA,EAAAxvC,CACAozC,ECRA,WAA0B,IAAa3D,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAlHrsC,KAAyIysC,GAAA,WAAzIzsC,KAAyI4sC,GAAzI5sC,KAAyIwB,KAAAI,QAAA,sBAAAuqC,EAAA,OAA4EE,YAAA,iBAA2BF,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,WAA2BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,WAA2BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,SAAAsuC,WAAA,KAA6CL,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,OAAAsuC,WAAA,MAA2C,UDWhgB,EACA,KACA,KACA,MAIAsD,EAAAna,QAAAmX,OAAA,qBACA,IAAAiD,EAAAD,UEnBiLE,ECalKpE,EAAA,EAAIC,QACjB3tC,KAAM,gBACN4tC,OAAQ,QACRjwC,KAAI,MAEAqC,KAAM,KAGVkvC,YACEL,cAEFmC,UACEpvC,QACE,OAAOE,KAAK9B,KAAK7B,OAAS,IAG9BgxC,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACZ,IAAK,YAEH,YADAe,KAAK9B,KAAO8B,KAAK9B,KAAKwB,MAAM,GAAI,IAElC,IAAK,QAIH,YAHIM,KAAKutC,OACPvtC,KAAKwB,KAAKyuC,SAASjwC,KAAK9B,OAG5B,IAAK,IACH,OAAO8B,KAAKwB,KAAKgsC,OACnB,QAC2B,IAArBp6B,EAAMnU,IAAI5C,QAAgB2D,KAAK9B,KAAK7B,OAAS2D,KAAKwB,KAAK0uC,YACzDlwC,KAAK9B,KAAO8B,KAAK9B,KAAK8hC,OAAO5sB,EAAMnU,WCrC/CkxC,EAAA3zC,OAAAwvC,EAAA,EAAAxvC,CACAwzC,ECRA,WAA0B,IAAa/D,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAlHrsC,KAAyIysC,GAAA,qBAAzIzsC,KAAyI4sC,GAAzI5sC,KAAyI9B,SAAAiuC,EAAA,OAA4DE,YAAA,iBAArMrsC,KAAgO,MAAAmsC,EAAA,cAA+BsC,OAAO5B,KAAA,QAAA3uC,KAAA,UAAtQ8B,KAAoS0vC,KAAAvD,EAAA,cAA4BsC,OAAO5B,KAAA,IAAA3uC,KAAA,WAA0B,UDW3X,EACA,KACA,KACA,MAIAiyC,EAAAxa,QAAAmX,OAAA,oBACA,IAAAsD,EAAAD,UEnB8KE,ECW/JzE,EAAA,EAAIC,QACjB3tC,KAAM,mBACN4tC,OAAQ,YCLVwE,UAAA9zC,OAAAwvC,EAAA,EAAAxvC,CACA6zC,ECTA,WAA0B,IAAApC,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,oBAA8BF,EAAA,KAAA8B,EAAAxB,GAAA,iBAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAA1tC,OAAAgP,OAAA3N,OAAA,gBAAAqsC,EAAArB,GAAAqB,EAAA1tC,OAAAgP,OAAA1N,KAAA3D,SAAAiuC,EAAA,KAAA8B,EAAAxB,GAAA,qBAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAA1tC,OAAAgP,OAAAvN,kBAAA9D,KAAA,uBAAAiuC,EAAA,KAAA8B,EAAAxB,GAAA,iDAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAA1tC,OAAAgP,OAAAjN,cAAApE,KAAA,uBAAAiuC,EAAA,KAAA8B,EAAAxB,GAAA,cAAAwB,EAAArB,GAAAqB,EAAA1tC,OAAAgwC,KAAA,oDDYxI,EACA,KACA,WACA,OAIAD,EAAA3a,QAAAmX,OAAA,uBACA,IAAA0D,EAAAF,UEpBkLG,ECgBnK7E,EAAA,EAAIC,QACjB3tC,KAAM,cACN4tC,OAAQ,QACRsB,YACEL,aACAyD,oBAEFnD,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,IAAI2vC,eAClB,IAAK,IACH,OAAO5uC,KAAKwB,KAAKylB,YCpBzBypB,EAAAl0C,OAAAwvC,EAAA,EAAAxvC,CACAi0C,ECRA,WAA0B,IAAaxE,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,aAAlHrsC,KAAyIysC,GAAA,gBAAAN,EAAA,oBAAgDsC,OAAOluC,OAAhMP,KAAgMwB,KAAAjB,UAA0B4rC,EAAA,OAAYE,YAAA,iBAA2BF,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,WAA0B,YDW/U,EACA,KACA,KACA,MAIAwyC,EAAA/a,QAAAmX,OAAA,qBACA,IAAA6D,EAAAD,UEnB4KE,ECa7JhF,EAAA,EAAIC,QACjB3tC,KAAM,WACN4tC,OAAQ,QACRsB,YACEL,cAEFM,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,IAAI2vC,eAClB,IAAK,IACH,OAAO5uC,KAAKwB,KAAKqvC,eChBzBC,EAAAt0C,OAAAwvC,EAAA,EAAAxvC,CACAo0C,ECRA,WAA0B,IAAa3E,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,iBAA2BF,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,cAA8BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,cAA8BiuC,EAAA,cAAmBsC,OAAO5B,KAAA,IAAA3uC,KAAA,uBAAsC,UDWvV,EACA,KACA,KACA,MAIA4yC,EAAAnb,QAAAmX,OAAA,eACA,IAAAiE,EAAAD,iBE6BA,IChDqLE,EDgDtKpF,EAAA,EAAIC,QACjB3tC,KAAM,cACN4tC,OAAQ,SAAU,kBAClBhsC,OACE,OACEmxC,YAAQ7oC,EACRokB,iBAAkBxsB,KAAKkxC,OAAOzkB,YAAY,KAG9CyiB,UACEpvC,eACE,IAAIqxC,KACHxD,EAAgB,EAEjB,IAAK,IAAIttB,KAAOrgB,KAAKwsB,iBAAiBtO,KACpC,IAAK,IAAIqN,KAAUlL,EACbkL,IACF4lB,EAAa5lB,EAAOrtB,MAAQ++B,OAAOC,aAnBzB,GAmBsDyQ,MAKtE,OAAOwD,IAGX9D,SACEvtC,YAAYsxC,GACV,MAAMC,EAAeD,GAAqBpxC,KAAKixC,OAE3CI,GAAgBA,EAAa7lB,OAAOxrB,KAAKwsB,oBAAsBpT,EAAA,aAAasS,YAC9E1rB,KAAKsxC,MAAM,aAActxC,KAAKwsB,iBAAkB6kB,GAChDrxC,KAAKixC,YAAS7oC,IAGlBtI,eAAegC,GACTA,GAAc9B,KAAKwsB,kBAAoBxsB,KAAKwsB,iBAAiBtuB,OAAS4D,EAAW5D,OACnF8B,KAAKixC,YAAS7oC,EACdpI,KAAKwsB,iBAAmB1qB,IAG5BhC,WAAWyrB,GACLvrB,KAAKuxC,gBAAkBhmB,EAAOC,OAAOxrB,KAAKwsB,oBAAsBpT,EAAA,aAAasS,YAC/E1rB,KAAKixC,OAAS1lB,IAGlBzrB,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACH,OAAOe,KAAKwxC,eAAexxC,KAAKkxC,OAAOzkB,YAAYtF,SAAS/T,EAAMnU,KAAO,IAC3E,IAAK,IACL,IAAK,QACH,OAAOe,KAAKyxC,cACd,QACE,IAAK,IAAIlmB,KAAUvrB,KAAKwsB,iBAAiBL,QACvC,GAAInsB,KAAKmxC,aAAa5lB,EAAOrtB,QAAUkV,EAAMnU,IAAK,CAChDe,KAAK0xC,WAAWnmB,GAChB,SAKRzrB,UAAUyrB,GACR,IAAIomB,KAASpmB,EAAOjE,QAAQiE,EAAOhE,UAEnC,OAAIvnB,KAAKuxC,gBAAkBhmB,EAAOC,OAAOxrB,KAAKwsB,oBAAsBpT,EAAA,aAAasS,aACrE1rB,KAAKmxC,aAAa5lB,EAAOrtB,SAASyzC,IAErCA,GAGX7xC,mBAAmByrB,GACjB,GAAIvrB,KAAKixC,QAAUjxC,KAAKixC,OAAO/yC,OAASqtB,EAAOrtB,KAC7C,MAAO,YAET,OAAOqtB,EAAOC,OAAOxrB,KAAKwsB,mBAC1B,KAAKpT,EAAA,aAAasS,UAChB,MAAO,aACT,KAAKtS,EAAA,aAAa6S,YAChB,MAAO,eACT,KAAK7S,EAAA,aAAa4S,UAChB,MAAO,eAGXqjB,SAAS9jB,MACGA,EAAOrtB,cEjIvB0zC,UAAAp1C,OAAAwvC,EAAA,EAAAxvC,CACAw0C,ECTA,WAA0B,IAAA/C,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,mCAAAoC,OAAsDrlC,GAAA,uBAA0B+iC,EAAA,OAAYE,YAAA,eAA0B4B,EAAAE,GAAAF,EAAAiD,OAAA,qBAAApvC,EAAA6rC,GAA4D,OAAAxB,EAAA,OAAiBltC,IAAA6C,EAAAsH,GAAAijC,YAAA,mBAAAC,OAAwDuF,UAAA/vC,EAAA5D,MAAA+vC,EAAAzhB,iBAAAtuB,MAA0DgG,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAuD,eAAA1vC,OAAiCmsC,EAAAxB,GAAA,KAAAN,EAAA,OAAwBE,YAAA,QAAkB4B,EAAAxB,GAAAwB,EAAArB,GAAAe,EAAA,MAAAM,EAAAxB,GAAA,KAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAAnsC,EAAA5D,KAAA,qBAAA+vC,EAAArB,GAAA9qC,EAAA+b,OAAA,UAAkIsuB,EAAA,OAAaE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,kBAA4B4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,4CAA0EvlC,MAAAulC,EAAAzhB,iBAAAZ,aAAqCugB,EAAA,QAAA8B,EAAAE,GAAAF,EAAAzhB,iBAAA,cAAAnM,EAAAlkB,GAAoE,OAAAgwC,EAAA,MAAgBltC,IAAA9C,GAAM8xC,EAAAE,GAAA,WAAA5iB,EAAAluB,GAAiC,OAAA8uC,EAAA,MAAgBltC,IAAA5B,EAAAgvC,YAAA,SAAyB,EAAAF,EAAA,OAAqBE,YAAA,cAAAC,MAAA2B,EAAA6D,mBAAAvmB,GAAAkjB,OAAsErlC,GAAA/L,EAAA,cAAAlB,EAAA41C,QAAA,UAAAC,SAAA,uBAA8E9tC,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAyD,WAAAnmB,OAAyB4gB,EAAA,OAAYE,YAAA,OAAAoC,OAA0BgB,IAAA,kBAAAxB,EAAAoB,SAAA9jB,MAAgD4gB,EAAA,QAAaE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAgE,UAAA1mB,OAAA4gB,EAAA,aAA0DsC,OAAO/e,OAAAryB,EAAA,cAAAlB,EAAA+1C,SAAA,QAAAC,UAAA,wBAAiFhG,EAAA,KAAWE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA1iB,EAAArtB,KAAA,sBAAAiuC,EAAA,SAAAA,EAAA,KAAmFE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,oCAAkEtyB,QAAA4P,EAAAjE,KAAAxkB,IAAAyoB,EAAAhE,cAA4C,iBAAA0mB,EAAA6D,mBAAAvmB,GAAA4gB,EAAA,KAAkEE,YAAA,iBAA2B4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,4CAA0EmE,IAAA7mB,EAAAlE,MAAA4mB,EAAAzhB,iBAAAvO,aAAqD,KAAAgwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAzhB,iBAAAtuB,KAAA,mBAAA+vC,EAAAyB,KAAAvD,EAAA,KAAyFE,YAAA,gBAA0B4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA1iB,EAAArtB,KAAA,wCAAA+vC,EAAAyB,eAA+FzB,EAAA,OAAA9B,EAAA,SAA8BE,YAAA,UAAAoC,OAA6BsD,QAAA,WAAoB7tC,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAwD,kBAAoBxD,EAAAxB,GAAA,iBAAAwB,EAAAyB,MAAA,QDYlvE,EACA,KACA,WACA,OAIAkC,EAAAjc,QAAAmX,OAAA,kBACA,IAAAuF,EAAAT,UEpBmLU,ECoBpK1G,EAAA,EAAIC,QACjB3tC,KAAM,cACN4tC,OAAQ,QACRsB,YACEiF,eAEFhF,SACEvtC,QAAQsT,GACNpT,KAAKuyC,MAAMC,iBAAiBC,QAAQr/B,IAEtCtT,WAAWgC,EAAwBypB,GACjCvrB,KAAKwB,KAAKkwC,WAAW5vC,EAAYypB,OCxBvCmnB,EAAAl2C,OAAAwvC,EAAA,EAAAxvC,CACA81C,ECRA,WAA0B,IAAarG,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,kBAAlHrsC,KAA8IysC,GAAA,iBAA9IzsC,KAA8I4sC,GAA9I5sC,KAA8IwB,KAAAoqB,QAAA,YAAAugB,EAAA,eAAgFwG,IAAA,mBAAAlE,OAA8ByC,OAA5PlxC,KAA4PwB,KAAAw0B,YAAA4c,mBAAA,GAAqD1uC,IAAKwtC,WAAtT1xC,KAAsT0xC,eAA6B,QDW7W,EACA,KACA,KACA,MAIAgB,EAAA/c,QAAAmX,OAAA,sBACA,IAAA+F,EAAAH,iBEnBoKI,ECcrJlH,EAAA,EAAIC,QACjB3tC,KAAM,SACN4tC,OACEjhC,QACEnI,KAAM0W,EAAA,OACN25B,UAAU,IAGdl3C,KAAI,MAEAiT,OAAQ,IAGZogC,UACEpvC,WACE,MAAMkzC,EAA+BhzC,KAAK6K,OAAOkkB,SAAS1yB,OACxD0yB,EAAWvyB,OAAAwc,EAAA,UAAAxc,CAAUwD,KAAK6K,OAAOkkB,SAAUrqB,KAAK5B,IAAIkwC,EAAuBhzC,KAAK8O,OAAQ,IAE1F,OADA9O,KAAK8O,OAASkkC,EACPjkB,IAGXse,SACEvtC,QAAQnB,GACN,GAAIA,EAAQ,EACV,UAAWA,KAGfmB,SAASmzC,GACP,OAAQA,EAAOp1B,OACb,KAAKzE,EAAA,SAASyW,MACZ,MAAO,QACT,KAAKzW,EAAA,SAAS0W,KACZ,MAAO,OACT,KAAK1W,EAAA,SAAS2W,QACZ,MAAO,UACT,KAAK3W,EAAA,SAASgX,OACZ,MAAO,cC1CjB8iB,UAAA12C,OAAAwvC,EAAA,EAAAxvC,CACAs2C,ECTA,WAA0B,IAAA7E,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,UAAqB4B,EAAAE,GAAAF,EAAA,kBAAAgF,EAAA92C,GAA0C,OAAAgwC,EAAA,OAAiBltC,IAAA9C,EAAAmwC,MAAA2B,EAAAkF,SAAAF,KAAiChF,EAAAxB,GAAAwB,EAAArB,GAAAqG,EAAA9iB,SAAA,KAAA8d,EAAArB,GAAAqB,EAAA3d,QAAA2iB,EAAA3iB,qBDY3N,EACA,KACA,WACA,OAIA4iB,EAAAvd,QAAAmX,OAAA,aACA,IAAAhe,EAAAokB,gBEda3qC,EAYXzI,YACSszC,EACA50C,EACA60C,EACAC,EACAC,EACAC,EACAC,GANAzzC,KAAAozC,KACApzC,KAAAxB,IACAwB,KAAAqzC,IACArzC,KAAAszC,IACAtzC,KAAAuzC,KACAvzC,KAAAwzC,KACAxzC,KAAAyzC,KAKF3zC,UAAY,OAAOE,KAAKozC,GAIxBtzC,QAAQszC,GAAcpzC,KAAKozC,GAAKA,EAIhCtzC,SAAStB,EAAW60C,EAAWC,GACpCtzC,KAAKxB,EAAIA,EACTwB,KAAKqzC,EAAIA,EACTrzC,KAAKszC,EAAIA,EAKJxzC,QAAQ4zC,GACb1zC,KAAKxB,EAAIk1C,EACT1zC,KAAKqzC,EAAIK,EACT1zC,KAAKszC,EAAII,EAKJ5zC,cAActB,EAAW60C,EAAWC,GACzCtzC,KAAKuzC,GAAK/0C,EACVwB,KAAKwzC,GAAKH,EACVrzC,KAAKyzC,GAAKH,EAGLxzC,oBACLE,KAAKxB,EAAIwB,KAAKuzC,GACdvzC,KAAKqzC,EAAIrzC,KAAKwzC,GACdxzC,KAAKszC,EAAItzC,KAAKyzC,GAGT3zC,aACLE,KAAKxB,GAAKwB,KAAKuzC,GAAIvzC,KAAKuzC,GAAKvzC,KAAKxB,GAAG,GACrCwB,KAAKqzC,GAAKrzC,KAAKwzC,GAAIxzC,KAAKwzC,GAAKxzC,KAAKqzC,GAAG,GACrCrzC,KAAKszC,GAAKtzC,KAAKyzC,GAAIzzC,KAAKyzC,GAAKzzC,KAAKszC,GAAG,GAKhCxzC,aAAeE,KAAKxB,EAAIwB,KAAKqzC,EAAIrzC,KAAKszC,OAAIlrC,EAI1CtI,kBAAoBE,KAAKuzC,GAAKvzC,KAAKwzC,GAAKxzC,KAAKyzC,QAAKrrC,EAIlDtI,cACL,YAAesI,IAAXpI,KAAKxB,QAA8B4J,IAAXpI,KAAKqzC,QAA8BjrC,IAAXpI,KAAKszC,EAChD,IAAMtzC,KAAKxB,EAAEkvC,SAAS,IAAM1tC,KAAKqzC,EAAE3F,SAAS,IAAM1tC,KAAKszC,EAAE5F,SAAS,IAC/D,GAKP5tC,mBACL,YAAgBsI,IAAZpI,KAAKuzC,SAAgCnrC,IAAZpI,KAAKwzC,SAAgCprC,IAAZpI,KAAKyzC,GAClD,IAAMzzC,KAAKuzC,GAAG7F,SAAS,IAAM1tC,KAAKwzC,GAAG9F,SAAS,IAAM1tC,KAAKyzC,GAAG/F,SAAS,IAClE,GAKP5tC,cACL,YAAesI,IAAXpI,KAAKxB,QAA8B4J,IAAXpI,KAAKqzC,QAA8BjrC,IAAXpI,KAAKszC,SACzCtzC,KAAKxB,KAAKwB,KAAKqzC,KAAKrzC,KAAKszC,KAC7B,GAKPxzC,mBACL,YAAgBsI,IAAZpI,KAAKuzC,SAAgCnrC,IAAZpI,KAAKwzC,SAAgCprC,IAAZpI,KAAKyzC,UAC3CzzC,KAAKuzC,MAAMvzC,KAAKwzC,MAAMxzC,KAAKyzC,MAC/B,GAKP3zC,eACL,YAAesI,IAAXpI,KAAKxB,QAA8B4J,IAAXpI,KAAKqzC,QAA8BjrC,IAAXpI,KAAKszC,GAC9C90C,EAAKwB,KAAKxB,EAAG60C,EAAKrzC,KAAKqzC,EAAGC,EAAKtzC,KAAKszC,MAM1CxzC,oBACL,YAAesI,IAAXpI,KAAKxB,QAA8B4J,IAAXpI,KAAKqzC,QAA8BjrC,IAAXpI,KAAKszC,GAC9C90C,EAAKwB,KAAKuzC,GAAIF,EAAKrzC,KAAKwzC,GAAIF,EAAKtzC,KAAKyzC,OAM5C3zC,KAAK6zC,GACV3zC,KAAKozC,GAAKO,EAAMP,GAChBpzC,KAAKxB,EAAIm1C,EAAMn1C,EACfwB,KAAKqzC,EAAIM,EAAMN,EACfrzC,KAAKszC,EAAIK,EAAML,EACftzC,KAAKuzC,GAAKI,EAAMJ,GAChBvzC,KAAKwzC,GAAKG,EAAMH,GAChBxzC,KAAKyzC,GAAKE,EAAMF,GAKX3zC,QACL,OAAO,IAAIyI,EAAKvI,KAAKozC,GAAIpzC,KAAKxB,EAAGwB,KAAKqzC,EAAGrzC,KAAKszC,EAAGtzC,KAAKuzC,GAAIvzC,KAAKwzC,GAAIxzC,KAAKyzC,KASrE,MAEMG,EAAW,eACXC,EAAW,IAAItrC,EAFJ,KClEjB,MCrFDurC,EAAgB,ynBAwBhBC,EAAkB,2QAwUjB,MAAMC,EAAgB,SAASC,GACpC,OAAO,UAlSPn0C,YAAoBo0C,GAIlB,GAJkBl0C,KAAAk0C,OAClBl0C,KAAKk0C,KAAOA,EACZl0C,KAAKm0C,OAASC,SAASC,cAAc,WAEhCr0C,KAAKm0C,OAAOG,WAAY,KAAK,uBAElC,GADAt0C,KAAKu0C,GAAKv0C,KAAKm0C,OAAOG,WAAW,uBAC5Bt0C,KAAKu0C,GAAI,KAAK,sBAuBnB,GAtBAL,EAAKhsC,KAAKssC,YAAYx0C,KAAKm0C,QAE3Bn0C,KAAKy0C,WACLz0C,KAAK00C,aACL10C,KAAK20C,eAAkBn2C,EAAG,EAAK60C,EAAG,EAAKC,EAAG,EAAKC,GAAI,EAAKC,GAAI,EAAKC,GAAI,GAErEzzC,KAAK40C,SACH7vB,UAAa8vB,OAAQ,KAAMh5C,KAAM,KAAMi5C,SAAU,EAAGC,SAAU,KAAMC,KAAMh1C,KAAKu0C,GAAGU,aAClFC,UAAaL,OAAQ,KAAMh5C,KAAM,KAAMi5C,SAAU,EAAGC,SAAU,KAAMC,KAAMh1C,KAAKu0C,GAAGU,aAClFE,OAAaN,OAAQ,KAAMh5C,KAAM,KAAMi5C,SAAU,EAAGC,SAAU,KAAMC,KAAMh1C,KAAKu0C,GAAGa,cAClFC,SAAaR,OAAQ,KAAMh5C,KAAM,KAAMi5C,SAAU,EAAGC,SAAU,KAAMC,KAAMh1C,KAAKu0C,GAAGa,cAClFE,WAAaT,OAAQ,KAAMh5C,KAAM,KAAMi5C,SAAU,EAAGC,SAAU,KAAMC,KAAMh1C,KAAKu0C,GAAGa,eAK/Ep1C,KAAKu1C,YACRv1C,KAAKu1C,UAAYnB,SAASC,cAAc,WAC1Cr0C,KAAKu1C,UAAUC,MAAMzwB,SAAW,WAChC/kB,KAAKu1C,UAAUC,MAAMC,IAAM,MAC3Bz1C,KAAKu1C,UAAUC,MAAM9tC,KAAO,MAC5B1H,KAAK01C,IAAM11C,KAAKu1C,UAAUjB,WAAW,OAChCt0C,KAAK01C,IAAK,KAAM,qDAErB11C,KAAK21C,cACL31C,KAAKm0C,OAAOzuC,OAASwuC,EAAK0B,SAAW51C,KAAK61C,GAAK71C,KAAK81C,IAAM5B,EAAK7uC,EAC/DrF,KAAKm0C,OAAOlwC,OAASjE,KAAK61C,GAAK3B,EAAK5uC,EACpCtF,KAAKu1C,UAAU7vC,MAAQ,EACvB1F,KAAKu1C,UAAUtxC,OAAS,EAExBjE,KAAK21C,cAEL31C,KAAKu0C,GAAGN,SAAS,EAAG,EAAGj0C,KAAKm0C,OAAOzuC,MAAO1F,KAAKm0C,OAAOlwC,QAEtD,IAAI8xC,EAAe/1C,KAAKg2C,cAAch2C,KAAKu0C,GAAGT,cAAeA,GACzDmC,EAAiBj2C,KAAKg2C,cAAch2C,KAAKu0C,GAAGR,gBAAiBA,GAC7DmC,EAAUl2C,KAAKu0C,GAAG4B,gBAOtB,GANAn2C,KAAKu0C,GAAG6B,aAAaF,EAASH,GAC9B/1C,KAAKu0C,GAAG6B,aAAaF,EAASD,GAC9Bj2C,KAAKu0C,GAAG8B,YAAYH,GACpBl2C,KAAKu0C,GAAG+B,aAAaP,GACrB/1C,KAAKu0C,GAAG+B,aAAaL,IACVj2C,KAAKu0C,GAAGgC,oBAAoBL,EAASl2C,KAAKu0C,GAAGiC,aAC/C,CACP,MAAMC,4BAAgCz2C,KAAKu0C,GAAGmC,kBAAkBR,KAEhE,MADAl2C,KAAKu0C,GAAGoC,cAAcT,GAChBO,EAERz2C,KAAKu0C,GAAGqC,WAAWV,GAGnBl2C,KAAK40C,QAAQ7vB,SAASgwB,SAAY/0C,KAAKu0C,GAAGsC,kBAAkBX,EAAS,YACrEl2C,KAAK40C,QAAQM,SAASH,SAAY/0C,KAAKu0C,GAAGsC,kBAAkBX,EAAS,YACrEl2C,KAAK40C,QAAQO,MAAMJ,SAAe/0C,KAAKu0C,GAAGsC,kBAAkBX,EAAS,SACrEl2C,KAAK40C,QAAQS,QAAQN,SAAa/0C,KAAKu0C,GAAGsC,kBAAkBX,EAAS,WACrEl2C,KAAK40C,QAAQU,UAAUP,SAAW/0C,KAAKu0C,GAAGsC,kBAAkBX,EAAS,aAGrEl2C,KAAK82C,cACL,IAAIC,EAAqB/2C,KAAKu0C,GAAGyC,mBAAmBd,EAAS,eAC7Dl2C,KAAKu0C,GAAG0C,UAAUF,EAAoB/2C,KAAKm0C,OAAOzuC,MAAO1F,KAAKm0C,OAAOlwC,QACrEjE,KAAKk3C,mBAAqBl3C,KAAKu0C,GAAGyC,mBAAmBd,EAAS,eAC9Dl2C,KAAKu0C,GAAG0C,UAAUj3C,KAAKk3C,mBAAoBl3C,KAAKk0C,KAAK7uC,EAAGrF,KAAKk0C,KAAK5uC,GAClEtF,KAAKm3C,gBAAkBn3C,KAAKu0C,GAAGyC,mBAAmBd,EAAS,YAC3Dl2C,KAAKu0C,GAAG0C,UAAUj3C,KAAKm3C,gBAAiB,EAAK,GAI7C,IAAIC,EAAUp3C,KAAKu0C,GAAG8C,gBACtBr3C,KAAKu0C,GAAG+C,YAAYt3C,KAAKu0C,GAAGgD,WAAYH,GACxCp3C,KAAKw3C,WAAW,oGAChBx3C,KAAKu0C,GAAGkD,cAAcz3C,KAAKu0C,GAAGgD,WAAYv3C,KAAKu0C,GAAGmD,mBAAoB13C,KAAKu0C,GAAGoD,SAC9E33C,KAAKu0C,GAAGkD,cAAcz3C,KAAKu0C,GAAGgD,WAAYv3C,KAAKu0C,GAAGqD,mBAAoB53C,KAAKu0C,GAAGoD,SAC9E33C,KAAKu0C,GAAGkD,cAAcz3C,KAAKu0C,GAAGgD,WAAYv3C,KAAKu0C,GAAGsD,eAAgB73C,KAAKu0C,GAAGuD,eAC1E93C,KAAKu0C,GAAGkD,cAAcz3C,KAAKu0C,GAAGgD,WAAYv3C,KAAKu0C,GAAGwD,eAAgB/3C,KAAKu0C,GAAGuD,eAC1E93C,KAAKu0C,GAAGyD,cAAch4C,KAAKu0C,GAAG0D,UAE9BC,WAAW,KACTl4C,KAAK21C,cACL31C,KAAKm4C,eACLn4C,KAAKo4C,UACJ,KAGEt4C,oBAA8B,MAAO,QAEpCA,eACN,IAAIuF,EAAIrF,KAAKu1C,UAAU7vC,OAAS1F,KAAK81C,GAAK91C,KAAKq4C,KACzC/yC,EAAItF,KAAKu1C,UAAUtxC,QAAUjE,KAAK61C,GAAK71C,KAAKq4C,KAElD,MAAMC,EAAYt4C,KAAK00C,UAAUr4C,OAC7Bi8C,EAAY5zC,KAAKC,MAAMU,GAAKX,KAAKC,MAAMW,KAEzCA,GADAD,EAAIX,KAAKwgC,KAAKxgC,KAAK6zC,KAAKD,KAChB,EACRt4C,KAAKu1C,UAAU7vC,MAAQL,GAAKrF,KAAK81C,GAAK91C,KAAKq4C,KAC3Cr4C,KAAKu1C,UAAUtxC,OAASqB,GAAKtF,KAAK61C,GAAK71C,KAAKq4C,KAC5Cr4C,KAAK21C,cACL31C,KAAKu0C,GAAG0C,UAAUj3C,KAAKk3C,mBAAoB7xC,EAAGC,IAEhDtF,KAAKu0C,GAAG0C,UAAUj3C,KAAKm3C,gBAAiBn3C,KAAKq4C,IAAMr4C,KAAKu1C,UAAU7vC,MAAO1F,KAAKq4C,IAAMr4C,KAAKu1C,UAAUtxC,QAEnG,IAAWmvC,EAAPp1C,EAAI,EACRgC,KAAK01C,IAAI8C,UAAY,UACrBx4C,KAAK01C,IAAI+C,SAAS,EAAG,EAAGz4C,KAAKu1C,UAAU7vC,MAAO1F,KAAKu1C,UAAUtxC,QAC7DjE,KAAK01C,IAAI8C,UAAY,UAErB,MAAME,EAAU,GAAM14C,KAAK24C,IACrB7C,EAAK91C,KAAK81C,GAAK91C,KAAKq4C,IACpBxC,EAAK71C,KAAK61C,GAAK71C,KAAKq4C,IAC1B,IAAIjzC,EAAI,GAAMywC,EACd,IAAK,IAAIx4C,EAAI,EAAGA,EAAIiI,IAAKjI,EAAG,CAC1B,IAAIgH,EAAe,GAAXrE,KAAKq4C,IACb,IAAK,IAAIl8C,EAAI,EAAGA,EAAIkJ,QAEP+C,KADXgrC,EAAKpzC,KAAK00C,UAAU12C,MADG7B,IAAK6B,EAG5BgC,KAAK01C,IAAIkD,SAASxF,EAAI/uC,EAAIq0C,EAAStzC,GACnCf,GAAKyxC,EAEP,IAAK1C,EAAI,MACThuC,GAAKywC,EAEP71C,KAAKu0C,GAAGsE,WAAW74C,KAAKu0C,GAAGgD,WAAY,EAAGv3C,KAAKu0C,GAAGuE,KAAM94C,KAAKu0C,GAAGuE,KAAM94C,KAAKu0C,GAAGwE,cAAe/4C,KAAKu1C,WAG5Fz1C,WAAWk5C,EAAeC,GAAiB,GACjD,IAAKj5C,KAAKu0C,GAAI,OACd,IAAI2E,GAAU,EACd,IAAK,IAAI/8C,EAAI,EAAGA,EAAI68C,EAAM38C,SAAUF,EAC7B6D,KAAKy0C,QAAQuE,EAAM78C,MACtB+8C,GAAU,EACVl5C,KAAK00C,UAAUn4C,KAAKy8C,EAAM78C,IAC1B6D,KAAKy0C,QAAQuE,EAAM78C,IAAM6D,KAAK00C,UAAUr4C,OAAS,GAIjD68C,GAAWD,GAAOj5C,KAAKm4C,eAGtBr4C,YAAYrC,GACjBA,EAAIA,GAAK+B,OAAO25C,iBAAiBn5C,KAAKk0C,KAAKhsC,KAAM,MACjDlI,KAAK01C,IAAI0D,KAAO37C,EAAE47C,SAAW,IAAM57C,EAAE67C,WAAa,IAAM77C,EAAE87C,WAC1Dv5C,KAAK01C,IAAI8D,aAAe,SACxBx5C,KAAK01C,IAAI8C,UAAY,UACrBx4C,KAAK81C,GAAK91C,KAAK01C,IAAI+D,YAAY,KAAK/zC,MACpC1F,KAAK61C,GAAK1uB,SAAS1pB,EAAE47C,SAAU,IAC/Br5C,KAAK24C,IAAM34C,KAAKk0C,KAAK0B,SAAY51C,KAAK61C,GAAK71C,KAAK81C,GAAM,EAClD91C,KAAKk0C,KAAK0B,WAAU51C,KAAK81C,GAAK91C,KAAK61C,IACvC71C,KAAKq4C,IAAiC,EAA3B3zC,KAAKwgC,KAAe,GAAVllC,KAAK61C,IAE1B,MAAMV,EAAQ13C,EAAE03C,MAAMhhC,MAAM,QACtBkhC,EAAU53C,EAAEi8C,gBAAgBvlC,MAAM,QACxCnU,KAAK20C,cAAcn2C,EAAI2oB,SAASguB,EAAM,GAAI,IAAM,IAChDn1C,KAAK20C,cAActB,EAAIlsB,SAASguB,EAAM,GAAI,IAAM,IAChDn1C,KAAK20C,cAAcrB,EAAInsB,SAASguB,EAAM,GAAI,IAAM,IAChDn1C,KAAK20C,cAAcpB,GAAKpsB,SAASkuB,EAAQ,GAAI,IAAM,IACnDr1C,KAAK20C,cAAcnB,GAAKrsB,SAASkuB,EAAQ,GAAI,IAAM,IACnDr1C,KAAK20C,cAAclB,GAAKtsB,SAASkuB,EAAQ,GAAI,IAAM,IAG9Cv1C,SAEAA,SACLE,KAAKu0C,GAAGoF,MAAM35C,KAAKu0C,GAAGqF,kBACtB,MAAMv0C,EAAIrF,KAAKk0C,KAAK7uC,EAClBC,EAAItF,KAAKk0C,KAAK5uC,EAGhB,IAAIyzB,EAAQ/4B,KAAKk0C,KAAKW,OAGlBgF,GAFe75C,KAAKk0C,KAAK4F,aACR95C,KAAKk0C,KAAK6F,mBAChB,GAEf,IAAK,IAAI18C,EAAI,EAAGA,EAAIiI,IAAKjI,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAIkJ,IAAKlJ,EAAG,CAC1B,MAAMkK,EAAO0yB,EAAM17B,GAAGlB,GACtB,IAAIi3C,EAAKpzC,KAAKy0C,QAAQpuC,EAAK+sC,SAChBhrC,IAAPgrC,IACFpzC,KAAKw3C,WAAWnxC,EAAK+sC,IAAI,GACzByG,GAAW,EACXzG,EAAKpzC,KAAKy0C,QAAQpuC,EAAK+sC,KAEzB,MAAM4G,EAAkC,EAA9Bh6C,KAAK40C,QAAQO,MAAML,UAAgBz3C,EAAIgI,EAAIlJ,GAC/C89C,EAAuC,EAAlCj6C,KAAK40C,QAAQU,UAAUR,UAAgBz3C,EAAIgI,EAAIlJ,GACpDqC,OAAe4J,IAAX/B,EAAK7H,EAAkBwB,KAAK20C,cAAcn2C,EAAI6H,EAAK7H,EAAI,IAC3D60C,OAAejrC,IAAX/B,EAAKgtC,EAAkBrzC,KAAK20C,cAActB,EAAIhtC,EAAKgtC,EAAI,IAC3DC,OAAelrC,IAAX/B,EAAKitC,EAAkBtzC,KAAK20C,cAAcrB,EAAIjtC,EAAKitC,EAAI,IAC3DC,OAAiBnrC,IAAZ/B,EAAKktC,GAAmBvzC,KAAK20C,cAAcpB,GAAKltC,EAAKktC,GAAK,IAC/DC,OAAiBprC,IAAZ/B,EAAKmtC,GAAmBxzC,KAAK20C,cAAcnB,GAAKntC,EAAKmtC,GAAK,IAC/DC,OAAiBrrC,IAAZ/B,EAAKotC,GAAmBzzC,KAAK20C,cAAclB,GAAKptC,EAAKotC,GAAK,IACrE,IAAK,IAAI11C,EAAI,EAAGA,EAAI,IAAKA,EAAG,CAC1B,MAAMoB,EAAI66C,EAAIj8C,EAAIiC,KAAK40C,QAAQO,MAAML,SACrC90C,KAAK40C,QAAQO,MAAMt5C,KAAKsD,EAAI,GAAKX,EACjCwB,KAAK40C,QAAQO,MAAMt5C,KAAKsD,EAAI,GAAKk0C,EACjCrzC,KAAK40C,QAAQO,MAAMt5C,KAAKsD,EAAI,GAAKm0C,EACjCtzC,KAAK40C,QAAQS,QAAQx5C,KAAKsD,EAAI,GAAKo0C,EACnCvzC,KAAK40C,QAAQS,QAAQx5C,KAAKsD,EAAI,GAAKq0C,EACnCxzC,KAAK40C,QAAQS,QAAQx5C,KAAKsD,EAAI,GAAKs0C,EACnCzzC,KAAK40C,QAAQU,UAAUz5C,KAAKo+C,EAAKl8C,GAAKq1C,GAMxCyG,GAAU75C,KAAKm4C,eACnBn4C,KAAKu0C,GAAG2F,WAAWl6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQO,MAAMN,QAC5D70C,KAAKu0C,GAAG6F,WAAWp6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQO,MAAMt5C,KAAMmE,KAAK40C,QAAQO,MAAMH,MACrFh1C,KAAKu0C,GAAG2F,WAAWl6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQS,QAAQR,QAC9D70C,KAAKu0C,GAAG6F,WAAWp6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQS,QAAQx5C,KAAMmE,KAAK40C,QAAQS,QAAQL,MACzFh1C,KAAKu0C,GAAG2F,WAAWl6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQU,UAAUT,QAChE70C,KAAKu0C,GAAG6F,WAAWp6C,KAAKu0C,GAAG4F,aAAcn6C,KAAK40C,QAAQU,UAAUz5C,KAAMmE,KAAK40C,QAAQU,UAAUN,MAE7F,MAAMqF,EAASr6C,KAAK40C,QAAQ7vB,SAC5B/kB,KAAKu0C,GAAG+F,WAAWt6C,KAAKu0C,GAAGgG,UAAW,EAAGF,EAAOx+C,KAAKQ,OAASg+C,EAAOvF,UAI/Dh1C,cAAc4C,EAAc2gB,GAClC,MAAMm3B,EAASx6C,KAAKu0C,GAAGkG,aAAa/3C,GAIpC,GAHA1C,KAAKu0C,GAAGmG,aAAaF,EAAQn3B,GAC7BrjB,KAAKu0C,GAAGyB,cAAcwE,IACXx6C,KAAKu0C,GAAGoG,mBAAmBH,EAAQx6C,KAAKu0C,GAAGqG,gBAC7C,CACP,MAAMnE,EAAM,2BAA6Bz2C,KAAKu0C,GAAGsG,iBAAiBL,GAElE,MADAx6C,KAAKu0C,GAAG+B,aAAakE,GACf/D,EAER,OAAO+D,EAGD16C,cACN,IAAIg7C,EAAGT,EAAQzF,EAAU50C,KAAK40C,QAE9B,MAAMvvC,EAAIrF,KAAKk0C,KAAK7uC,EACdC,EAAItF,KAAKk0C,KAAK5uC,EAGpB,IAAKw1C,KAAK96C,KAAK40C,SACbyF,EAASzF,EAAQkG,IACVj/C,KAAO,IAAIk/C,aAA+B,EAAlBV,EAAOvF,SAAezvC,EAAIC,GAG3D,IAAK,IAAIjI,EAAI,EAAGA,EAAIiI,IAAKjI,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAIkJ,IAAKlJ,EAAG,CAE1B,MAAM69C,EAAgC,EAA5BpF,EAAQ7vB,SAAS+vB,UAAgBz3C,EAAIgI,EAAIlJ,GACnD6D,KAAKg7C,WAAWpG,EAAQ7vB,SAASlpB,KAAMm+C,EAAG79C,EAAI6D,KAAK81C,GAAIz4C,EAAI2C,KAAK61C,GAAI71C,KAAK81C,GAAI91C,KAAK61C,IAClF71C,KAAKg7C,WAAWpG,EAAQM,SAASr5C,KAAMm+C,EAAG,EAAK,EAAK,EAAK,GAI7D,IAAKc,KAAK96C,KAAK40C,SACbyF,EAASzF,EAAQkG,IACNjG,QAAQ70C,KAAKu0C,GAAG0G,aAAaZ,EAAOxF,QAC/CwF,EAAOxF,OAAS70C,KAAKu0C,GAAG2G,eACxBl7C,KAAKu0C,GAAG2F,WAAWl6C,KAAKu0C,GAAG4F,aAAcE,EAAOxF,QAChD70C,KAAKu0C,GAAG6F,WAAWp6C,KAAKu0C,GAAG4F,aAAcE,EAAOx+C,KAAMw+C,EAAOrF,MAC7Dh1C,KAAKu0C,GAAG4G,wBAAwBd,EAAOtF,UACvC/0C,KAAKu0C,GAAG6G,oBAAoBf,EAAOtF,SAAUsF,EAAOvF,SAAU90C,KAAKu0C,GAAG8G,OAAO,EAAO,EAAG,GAInFv7C,WAAWw7C,EAAen/C,EAAWkI,EAAWe,EAAWC,EAAWC,GAC5E,MAAMyB,EAAK1C,EACL4C,EAAK7B,EACLm2C,EAAKl3C,EAAIgB,EACTm2C,EAAKp2C,EAAIE,EAEfg2C,EAAMn/C,GAAK4K,EACXu0C,IAAMn/C,GAAK8K,EACXq0C,IAAMn/C,GAAKo/C,EACXD,IAAMn/C,GAAK8K,EACXq0C,IAAMn/C,GAAK4K,EACXu0C,IAAMn/C,GAAKq/C,EACXF,IAAMn/C,GAAK4K,EACXu0C,IAAMn/C,GAAKq/C,EACXF,IAAMn/C,GAAKo/C,EACXD,IAAMn/C,GAAK8K,EACXq0C,IAAMn/C,GAAKo/C,EACXD,IAAMn/C,GAAKq/C,IAKYvH,IChVrBwH,EAAuB,IACvBC,GAAyB,IACzBC,IAAgBn9C,EAAG,IAAK60C,EAAG,IAAKC,EAAG,SAE5BsI,WAAoBrzC,EACxBzI,QAAQsY,GACb,OAAOpY,KAGTF,YAAY+sC,EAAcruC,EAAIi9C,EAAcpI,EAAIoI,EAAcnI,EAAImI,GAChEj7C,MAAMqsC,EAAMruC,EAAG60C,EAAGC,GAGVxzC,cAAcuG,EAAe+R,GAMrC,OALA/R,EAAKw1C,cACHF,GAAYn9C,EAAI4Z,EAChBujC,GAAYtI,EAAIj7B,EAChBujC,GAAYrI,EAAIl7B,GAEX/R,EAGCvG,SAASuG,EAAe+R,GAMhC,OALA/R,EAAKy1C,SACHH,GAAYn9C,EAAI4Z,EAChBujC,GAAYtI,EAAIj7B,EAChBujC,GAAYrI,EAAIl7B,GAEX/R,SAII01C,WAAsBH,GACnC97C,YAAY+sC,GACVrsC,MAAMqsC,EAAM6O,GAAgBA,GAAgBA,WAInCM,WAAqBD,GAChCj8C,YACE+sC,EACOoP,EACAC,EACAC,GAEP37C,MAAMqsC,GAJC7sC,KAAAi8C,KACAj8C,KAAAk8C,KACAl8C,KAAAm8C,KAKFr8C,QAAQsY,GACb,IAAI/R,EAAOrG,KAAKuJ,QAGhB,OAFAlD,EAAKy1C,SAAS97C,KAAKi8C,GAAIj8C,KAAKk8C,GAAIl8C,KAAKm8C,IAE9B91C,SAIL+1C,WAAuBR,GAC3B97C,cACEU,MAAM,KAGDV,QAAQsY,GACb,IAAI/R,EAAOrG,KAAKuJ,QAIhB,OAHAvJ,KAAKq8C,SAASh2C,EAAM+R,GACpB/R,EAAKi2C,aAEEj2C,SAiDEk2C,WAAiBX,GAC5B97C,YACE+sC,EACOoP,EACAC,EACAC,GAEP37C,MAAMqsC,GAJC7sC,KAAAi8C,KACAj8C,KAAAk8C,KACAl8C,KAAAm8C,KAKFr8C,QAAQsY,GACb,IAAI/R,EAAOrG,KAAKuJ,QAGhB,OAFAlD,EAAKy1C,SAAS97C,KAAKi8C,GAAIj8C,KAAKk8C,GAAIl8C,KAAKm8C,IAE9B91C,GAIX,MAAMm2C,GAAS,IAAID,GAAS,IAAK,IAAK,IAAK,KACrCE,GAAS,IAAIF,GAAS,IAAK,IAAK,IAAK,KACrCG,GAAa,IAAIH,GAAS,IAAK,IAAK,IAAK,KACzCI,GAAU,IAAIJ,GAAS,IAAK,IAAK,IAAK,KACtCK,GAAiB,IAAIL,GAAS,IAAK,IAAK,IAAK,KAC7CM,GAAQ,IAAIN,GAAS,IAAK,IAAK,IAAK,GACpCO,GAAS,IAAIP,GAAS,IAAK,IAAK,IAAK,KAErCQ,GAAS,IAAIR,GAAS,IAAK,IAAK,IAAK,KAE9BS,GAAc,SAASv0C,GAClC,OAAQA,EAAK+F,OACX,KAAK8+B,EAAA,UAAUn9B,cACb,OAAOqsC,GACT,KAAKlP,EAAA,UAAU99B,WACb,OAAOitC,GACT,KAAKnP,EAAA,UAAU78B,UACb,OAAOisC,GACT,KAAKpP,EAAA,UAAUt9B,QACb,OAAO2sC,GACT,KAAKrP,EAAA,UAAUr9B,cACb,OAAO2sC,GACT,KAAKtP,EAAA,UAAU79B,OACb,OAAOstC,GACT,KAAKzP,EAAA,UAAU38B,MACb,OAAOksC,GACT,KAAKvP,EAAA,UAAU2P,QACb,OAAOH,GACT,QACE,OAAOL,KAIPS,GAAc,IAAId,GAClBe,GAAY,kBAjGSf,GAClBt8C,QAAQsY,GACb,IAAI/R,EAAOrG,KAAKuJ,QAGhB,OAFAvJ,KAAKq8C,SAASh2C,EAAM+R,GAEb/R,IA6FL+2C,GAAO,kBA/EiBxB,GAC5B97C,cACEU,MAAM,KAGDV,QAAQsY,GACb,IAAI/R,EAAOrG,KAAKuJ,QAIhB,OAHAvJ,KAAKq9C,cAAch3C,EAAM+R,GACzB/R,EAAKi3C,oBAEEj3C,IAsELk3C,GAAQ,kBA1FiB3B,GAC7B97C,cACEU,MAAM,KAGDV,QAAQsY,GACb,OAAOpY,KAAKq8C,SAASr8C,KAAKuJ,QAAS6O,KAqFjColC,GAAgB,kBAnEa5B,GACjC97C,cACEU,MAAM,OAkEJi9C,GAAc,kBA9Da7B,GAC/B97C,cACEU,MAAM,OA6DJk9C,GAAY,IAAI9B,GAAY,IAAK,EAAG,EAAG,GAEvC+B,GAAgB,IAAI/B,GAAY,IAAK,IAAK,IAAK,KAC/CgC,GAAqB,IAAIhC,GAAY,IAAK,EAAG,IAAK,KAClDiC,GAAa,IAAIjC,GAAY,IAAK,IAAK,IAAK,GAC5CkC,GAAY,IAAIlC,GAAY,IAAK,IAAK,GAAI,IAC1CmC,GAAiB,IAAInC,GAAY,IAAK,IAAK,IAAK,GAChDoC,GAAoB,IAAIpC,GAAY,IAAK,IAAK,IAAK,KACnDqC,GAAa,IAAIrC,GAAY,IAAK,EAAG,EAAG,KAqE9C,MAAMsC,GAAqB,kBAnEa5Q,EAAA,YAG/BxtC,OAAOmL,GACZjL,KAAKqG,KAAO+2C,GAGPt9C,QAAQ6E,GACb3E,KAAKqG,KAAOk3C,GAGPz9C,eAAeqL,GACpBnL,KAAKqG,KAAOm3C,GAGP19C,aAAaqL,GAClBnL,KAAKqG,KAAOo3C,GAGP39C,OAAOuL,GACRA,EAAKxB,KACP7J,KAAKqG,KAAO82C,GAEZn9C,KAAKqG,KAAO62C,GAITp9C,OAAOyL,GACZ,GAAKA,EAAKZ,SAKV,OAAQY,EAAK7I,MACb,KAAK4qC,EAAA,SAAS1c,QACZ5wB,KAAKqG,KAAOs3C,GACZ,MACF,KAAKrQ,EAAA,SAASrY,cACZj1B,KAAKqG,KAAOu3C,GACZ,MACF,KAAKtQ,EAAA,SAASv/B,MACZ/N,KAAKqG,KAAOw3C,GACZ,MACF,KAAKvQ,EAAA,SAAS3Z,KACZ3zB,KAAKqG,KAAOy3C,GACZ,MACF,KAAKxQ,EAAA,SAASta,SACZhzB,KAAKqG,KAAO03C,GACZ,MACF,KAAKzQ,EAAA,SAASha,YACZtzB,KAAKqG,KAAO23C,GACZ,MACF,KAAK1Q,EAAA,SAASjY,MACZr1B,KAAKqG,KAAO43C,QAxBZ1yC,EAAKlF,KAAK8L,MAAMnS,MA6BbF,UAAUwL,GACfA,EAAQjF,KAAK8L,MAAMnS,MAGXF,QAAQuG,GAChBrG,KAAKqG,KAAOq3C,KC9OVS,GAAS,IAAInC,GAAa,IAAK,EAAG,IAAK,GACvCoC,GAAM,IAAIpC,GAAa,IAAK,IAAK,GAAI,IACrCqC,GAAQ,IAAIrC,GAAa,IAAK,IAAK,IAAK,KACxCsC,GAAY,IAAI1C,GAAY,IAAK,EAAG,EAAG,GAEvC2C,IACJ,IAAIhC,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,MAG9B,ICtCmKiC,GDsCpJ5S,EAAA,EAAIC,QACjBC,OAAQ,QAAS,SAAU,OAC3BjwC,KAAI,MAEA4iD,UAAU,EACVC,KAAM,KACNC,IAAK,KACLC,aAAc,KACd93B,GAAI+3B,KAAKC,MACTC,SAAU,IACVl4B,KAAM,IAGVwmB,SACEvtC,QAAQuE,EAAWe,GACjB,MAAMoU,EAASxZ,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAAGoU,OAC7BnT,EAAOrG,KAAKy+C,SAAWz+C,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAAKpF,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAAGiB,KAEvE,IAAKA,EACH,OAAOi4C,GAGT,GAAI9kC,EAAQ,CACV,GAAInT,EAAKyC,SAAU,CACjB,IAAIk2C,EAAQh/C,KAAK0L,aAAarF,EAAKyC,UAAUS,QAE7C,OADAy1C,EAAMnD,cAAc,IAAK,EAAG,GACrBmD,EAEP,OAAO,IAAIpD,GAAYpiC,EAAQ,IAAK,IAAK,GAI7C,GAAInT,EAAKyC,SACP,OAAO9I,KAAK0L,aAAarF,EAAKyC,UAGhC,GAAIzC,EAAKsC,MACP,OAAQtC,EAAKsC,MAAM+R,MAAMre,QACzB,KAAK,EACH,MACF,KAAK,EACH,OAAO2gD,GAAY32C,EAAKsC,MAAM+R,MAAM,GAAGjS,MACzC,QACE,MAAMw2C,EAAQj/C,KAAK6mB,MAA4B,EAApB7mB,KAAKk/C,aAAmB,GACnD,GAAID,EAAQV,GAAkBliD,OAC5B,OAAOkiD,GAAkBU,GACpB,CACL,MAAME,EAASz6C,KAAKC,MAAM3E,KAAK6mB,MAA4B,EAApB7mB,KAAKk/C,aAAmB,IAE/D,OAAOlC,GAAY32C,EAAKsC,MAAM+R,MAAMykC,EAAS94C,EAAKsC,MAAM+R,MAAMre,QAAQoM,OAK5E,ODkLqB,SAASpC,GAElC,OADAA,EAAK8L,MAAM+rC,IACJA,GAAmB73C,KCpLf+4C,CAAY/4C,IAErBqF,aAAa5C,GACU,OAAjBA,EAAS5K,KACJkgD,GAGY,SAAjBt1C,EAAS5K,KACJmgD,GAGFF,GAETr+C,eACEE,KAAK0+C,KAAO,UJsFhB5+C,YACSoI,EACA7C,EACAC,EACP+5C,EACOzJ,GAAoB,GAJpB51C,KAAAkI,OACAlI,KAAAqF,IACArF,KAAAsF,IAEAtF,KAAA41C,WAEP51C,KAAKs/C,GAAK56C,KAAKC,MAAMU,EAAI,GACzBrF,KAAKu/C,GAAK76C,KAAKC,MAAMW,EAAI,GAEzBtF,KAAKkI,KAAKs3C,UAAY,IAGoB,IAAtCt3C,EAAKu3C,UAAUC,QAAQ9L,KACK,IAA1B1rC,EAAKu3C,UAAUpjD,OACjB6L,EAAKu3C,UAAY7L,EAEd1rC,EAAKu3C,WAAa,IAAM7L,GAI/B5zC,KAAK60C,OAAS,IAAIjvC,MAAMN,GACxB,IAAK,IAAIjI,EAAI,EAAGA,EAAIiI,IAAKjI,EAAG,CAC1B2C,KAAK60C,OAAOx3C,GAAK,IAAIuI,MAAMP,GAC3B,IAAK,IAAIlJ,EAAI,EAAGA,EAAIkJ,IAAKlJ,EACvB6D,KAAK60C,OAAOx3C,GAAGlB,GAAK03C,EAIxB7zC,KAAKq/C,SAAWA,EAASr/C,MAKnBF,YAAY6/C,GAClB,MAAMliD,EAAI+B,OAAO25C,iBAAiBn5C,KAAKkI,KAAM,MAE7ClI,KAAK85C,aAAer8C,EAAE03C,YAAS/sC,EAC/BpI,KAAK+5C,kBAAoBt8C,EAAEi8C,sBAAmBtxC,EAC1Cu3C,GACF3/C,KAAKq/C,SAAS1J,YAAYl4C,GASvBqC,oBACL,OAAOE,KAAKq/C,SAASO,oBAWhB9/C,IAAIuG,EAAYhC,EAAWe,GAC5Bf,EAAI,GAAKe,EAAI,GAAKf,GAAKrE,KAAKqF,GAAKD,GAAKpF,KAAKsF,IAC/CtF,KAAK60C,OAAOzvC,GAAGf,GAAKgC,GAWfvG,UAAUuG,EAAYhC,EAAWe,GACtCpF,KAAK60C,OAAOzvC,GAAGf,GAAKgC,EAiBfvG,UACL+/C,EACAx7C,EACAe,EACA5G,EACA60C,EACAC,EACAC,EACAC,EACAC,GAEA,MAAMqM,EAAMD,EAAIxjD,OAChB,KAAIgI,EAAI,GAAKe,EAAI,GAEjB,IAAK,IAAIjJ,EAAI,EAAGA,EAAI2jD,IAAO3jD,EAAG,CAK5B,GAJIkI,GAAKrE,KAAKqF,IACZhB,EAAI,IACFe,GAEAA,GAAKpF,KAAKsF,EAAG,OAEjB,MAAMe,EAAO,IAAIkC,EAAKs3C,EAAI1jD,GAAIqC,EAAG60C,EAAGC,EAAGC,EAAIC,EAAIC,GAC/CzzC,KAAK+/C,UAAU15C,EAAMhC,EAAGe,KACtBf,GAcCvE,IAAIuE,EAAWe,GACpB,OAAIf,EAAI,GAAKe,EAAI,GAAKf,GAAKrE,KAAKqF,GAAKD,GAAKpF,KAAKsF,EAAUuuC,EAClD7zC,KAAK60C,OAAOzvC,GAAGf,GAKjBvE,QACL,IAAK,IAAIzC,EAAI,EAAGA,EAAI2C,KAAKsF,IAAKjI,EAC5B,IAAK,IAAIlB,EAAI,EAAGA,EAAI6D,KAAKqF,IAAKlJ,EAC5B6D,KAAK60C,OAAOx3C,GAAGlB,GAAK03C,EAGxB7zC,KAAKq/C,SAAS1F,QAKT75C,SACLE,KAAKq/C,SAASjH,WIzOVp4C,KAAKuyC,MAAMyN,MACXt7C,KAAK5B,IAAI9C,KAAK6d,MAAMnY,MAAO,IAC3BhB,KAAK5B,IAAI9C,KAAK6d,MAAM5Z,OAAQ,IAC5B+vC,GACA,GAGFh0C,KAAK2+C,IAAM,UJkQf7+C,YACSm0C,EACAgM,EACA56C,EACAC,GAHAtF,KAAAi0C,WACAj0C,KAAAigD,WACAjgD,KAAAqF,IACArF,KAAAsF,IA7BDtF,KAAAkgD,cAAwB,EACxBlgD,KAAAmgD,cAAwB,EAGxBngD,KAAAogD,mBAA6B,EAI7BpgD,KAAAqgD,OAAiB,EACjBrgD,KAAAsgD,OAAiB,EAuBvBtgD,KAAKugD,UAAY,IAAI36C,MAAMquC,EAAS3uC,GACpCtF,KAAKwgD,WAAa,IAAI56C,MAAMquC,EAAS3uC,GAErC,IAAK,IAAIjI,EAAI,EAAGA,EAAI42C,EAAS3uC,IAAKjI,EAChC2C,KAAKugD,UAAUljD,GAAK,IAAIuI,MAAMquC,EAAS5uC,GACvCrF,KAAKwgD,WAAWnjD,GAAK,IAAIuI,MAAMquC,EAAS5uC,GAarCvF,YAAY2gD,EAAsCjnC,EAAiB8J,GACpE9J,IACFxZ,KAAK0gD,gBAAat4C,EACI,iBAAXoR,IACM,UAAXA,EAAoBxZ,KAAK0gD,WAAa,SAASr8C,EAAGe,EAAGC,EAAGC,EAAGq7C,EAAOC,EAAOC,GAC3E,MAAMC,EAAY,GAAJz7C,EAAS07C,EAAY,GAAJz7C,EAG/B,OAFAjB,GAAKy8C,EACL17C,GAAK27C,EACDr8C,KAAKqB,IAAI1B,GAAKy8C,EAAQD,GAAUn8C,KAAKqB,IAAIX,GAAK27C,EAAQF,EAAeF,EAC7DC,GAEM,WAAXpnC,EAAqBxZ,KAAK0gD,WAAa,SAASr8C,EAAGe,EAAGC,EAAGC,EAAGq7C,EAAOC,EAAOC,GACjF,MAAMC,EAAY,GAAJz7C,EAAS07C,EAAY,GAAJz7C,EAI/B,OAHAjB,GAAKy8C,EACL17C,GAAK27C,EACLF,EAAS,EAAMA,EACXn8C,KAAKqB,IAAI1B,GAAKy8C,EAAQD,GAAUn8C,KAAKqB,IAAIX,GAAK27C,EAAQF,EAAeD,EAC7DD,GAEM,aAAXnnC,EAAuBxZ,KAAK0gD,WAAa,SAASr8C,EAAGe,EAAGC,EAAGC,EAAGq7C,EAAOC,EAAOC,GACnF,MAAMC,EAAY,GAAJz7C,EAAS07C,EAAY,GAAJz7C,EAG/B,OAFAjB,GAAKy8C,GAEGz8C,GADRe,GAAK27C,GACW37C,GAAK07C,EAAQA,EAAQC,EAAQA,GAASF,EAAeF,EACzDC,GAEM,cAAXpnC,EAAwBxZ,KAAK0gD,WAAa,SAASr8C,EAAGe,EAAGC,EAAGC,EAAGq7C,EAAOC,EAAOC,GACpF,MAAMC,EAAY,GAAJz7C,EAAS07C,EAAY,GAAJz7C,EAI/B,OAHAjB,GAAKy8C,GAGGz8C,GAFRe,GAAK27C,GAEW37C,GAAK07C,EAAQA,EAAQC,EAAQA,IAD7CF,EAAS,EAAMA,GACsDF,EACzDC,GAEM,WAAXpnC,IAAqBxZ,KAAK0gD,WAAa,SAASr8C,EAAGe,EAAGC,EAAGC,EAAGq7C,EAAOC,EAAOC,GACjF,OAAIn8C,KAAKc,SAAWq7C,EAAeD,EACvBD,KAGZ3gD,KAAK0gD,aACP1gD,KAAKghD,iBAAkB,IAAKnC,MAAQoC,UACpCjhD,KAAKogD,mBAAqB98B,GAAY,MAG1CtjB,KAAKigD,SAAWQ,EASX3gD,YAAY2gD,GAA2CzgD,KAAKkhD,SAAWT,EAQvE3gD,cAAc2gD,GAAoDzgD,KAAKmhD,WAAaV,EASpF3gD,aAAa4F,EAAezB,GACjCjE,KAAKqF,EAAIK,EACT1F,KAAKsF,EAAIrB,EAaJnE,gBAAgBjB,GACrBmB,KAAKmgD,aAAethD,EACpBmB,KAAKkgD,cAAe,EAkBfpgD,OAAOuE,EAAYe,GACxBf,EAAIA,GAAK,EACTe,EAAIA,GAAK,EAGT,MAAMgjB,EAAK/jB,EAAIrE,KAAKi0C,SAASqL,GACvB/2B,EAAKnjB,EAAIpF,KAAKi0C,SAASsL,GACvB6B,GAAU,IAAKvC,MAAQoC,UAC7B,IAAII,EAIAh7C,EAHArG,KAAK0gD,YAAc1gD,KAAKghD,kBAAiBK,GAAaD,EAAUphD,KAAKghD,iBAAmBhhD,KAAKogD,oBAC7FiB,GAAaA,GAAa,IAAKrhD,KAAK0gD,gBAAat4C,GAKrD,IAAK,IAAI/K,EAAI,EAAGA,EAAI2C,KAAKi0C,SAAS3uC,IAAKjI,EACrC,IAAK,IAAIlB,EAAI,EAAGA,EAAI6D,KAAKi0C,SAAS5uC,IAAKlJ,EAAG,CACxC,MAAMmlD,EAAMnlD,EAAIisB,EAAIm5B,EAAMlkD,EAAIkrB,EAE9B,GAAIvoB,KAAKqF,IAAMi8C,EAAM,GAAKA,GAAOthD,KAAKqF,GACpCgB,EAAOwtC,OAEF,GAAI7zC,KAAKsF,IAAMi8C,EAAM,GAAKA,GAAOvhD,KAAKsF,GAC3Ce,EAAOwtC,OAEF,GAAI7zC,KAAKkhD,WAAalhD,KAAKkhD,SAASI,EAAKC,GAC9Cl7C,EAAOwtC,OAEF,GAAI7zC,KAAK0gD,aAAe1gD,KAAKkgD,aAClC75C,EAAOrG,KAAK0gD,WACVvkD,EACAkB,EACA2C,KAAKi0C,SAAS5uC,EACdrF,KAAKi0C,SAAS3uC,EACdtF,KAAKigD,SAASqB,EAAKC,GACnBvhD,KAAKugD,UAAUljD,GAAGlB,GAClBklD,GAAa,QAGV,GAAIrhD,KAAKmgD,eAAiBngD,KAAKkgD,aAAc,CAClD,MAAMsB,EAAUF,EAAMthD,KAAKqgD,OACrBoB,EAAUF,EAAMvhD,KAAKsgD,OACvBkB,GAAW,GAAKA,EAAUxhD,KAAKi0C,SAAS5uC,GAAKo8C,GAAW,GAAKA,EAAUzhD,KAAKi0C,SAAS3uC,GACvFe,EAAOrG,KAAKugD,UAAUkB,GAASD,MAClB3N,IAAUxtC,EAAOrG,KAAKigD,SAASqB,EAAKC,IAEjDl7C,EAAOrG,KAAKigD,SAASqB,EAAKC,QAEvBl7C,EAAOrG,KAAKigD,SAASqB,EAAKC,GAEjCvhD,KAAKwgD,WAAWnjD,GAAGlB,GAAKkK,EAEpBrG,KAAKmhD,YAAc96C,IAASwtC,IAC9BxtC,EAAOrG,KAAKmhD,WAAW96C,EAAMi7C,EAAKC,EAAKH,IAEzCphD,KAAKi0C,SAAS8L,UAAU15C,EAAMlK,EAAGkB,GAKrC2C,KAAKqgD,OAASj4B,EACdpoB,KAAKsgD,OAAS/3B,EAGd,MAAMm5B,EAAY1hD,KAAKugD,UACvBvgD,KAAKugD,UAAYvgD,KAAKwgD,WACtBxgD,KAAKwgD,WAAakB,EAClB1hD,KAAKkgD,cAAe,IItchBlgD,KAAK0+C,KACL,CAACr6C,EAAWe,IAAcpF,KAAK2hD,QAAQt9C,EAAGe,GAC1CpF,KAAK6d,MAAMnY,MACX1F,KAAK6d,MAAM5Z,QAGbjE,KAAK2+C,IAAIiD,YAAY,CAACv9C,EAAGe,IAChBpF,KAAKy+C,UAAYz+C,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAAGk2B,MAG9Ct7B,KAAK2+C,IAAIkD,cAAc,CAACx7C,EAAMhC,EAAGe,EAAG08C,IAC3B9hD,KAAK+hD,SAAS17C,EAAMhC,EAAGe,EAAG08C,IAGnCE,cAAchiD,KAAK4+C,cACnB5+C,KAAK4+C,aAAeqD,YAAY,KAAQjiD,KAAKkiD,aAAeliD,KAAK++C,WAEnEj/C,YACE,MAAMgnB,EAAK+3B,KAAKC,MACZ9+C,KAAK8mB,GAAK,IAAOA,IACnB9mB,KAAK8mB,GAAKA,GAGZ9mB,KAAK2+C,IAAIwD,OAAOniD,KAAKkS,IAAI7N,EAAGrE,KAAKkS,IAAI9M,GAErCpF,KAAK0+C,KAAKtG,SAEVp4C,KAAK6mB,MAAQ,GAEf/mB,SAASuG,EAAMhC,EAAGe,EAAG08C,GACnB,GAAI9hD,KAAKy+C,SACP,OAAOp4C,EAAK+7C,QAAQ,GAEtB,MAAMC,EAAUriD,KAAKkY,MAAMzF,GAAGpO,EAAGe,GAEjC,OAAIi9C,EAAQ3vC,SAAWrM,EAAK+7C,QACnB/7C,EAAK+7C,QAAQC,EAAQjqC,QAGvB/R,IAGX6oC,UACEpvC,QACE,OAAOE,KAAKy+C,SAAWz+C,KAAK6d,MAAQ7d,KAAKO,OAAOwR,YAAY/R,KAAK6d,QAEnE/d,eACE,OAAO,IAAOE,KAAK++C,WAGvBj/C,UACEE,KAAKsiD,gBAEPxiD,gBACEkiD,cAAchiD,KAAK4+C,eAErB2D,OACEziD,WACEE,KAAKsiD,gBAEPxiD,QACEkiD,cAAchiD,KAAK4+C,cACnB5+C,KAAKsiD,mBEzKXE,WAAAhmD,OAAAwvC,EAAA,EAAAxvC,CACAgiD,GCTA,WAA0B,IAAavS,EAAbjsC,KAAaksC,eAAkD,OAA/DlsC,KAAuCosC,MAAAD,IAAAF,GAAwB,OAAiB0G,IAAA,QAAAtG,YAAA,sBDY1G,EACA,KACA,KACA,OAIAmW,GAAA7sB,QAAAmX,OAAA,YACA,IAAA2V,GAAAD,WEpB8KE,GC6B/J9W,EAAA,EAAIC,QACjB3tC,KAAM,mBACN4tC,OAAQ,OAAQ,OAAQ,OAAQ,YAChCoD,UACEpvC,KACE,SAAUE,KAAK2iD,kBAEjB7iD,WACE,OAAOtD,OAAAwc,EAAA,IAAAxc,CAAIwD,KAAK4iD,KAAKz5B,eC9B3B05B,GAAArmD,OAAAwvC,EAAA,EAAAxvC,CACAkmD,GCRA,WAA0B,IAAAzU,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAAAoC,OAAoCrlC,GAAA6kC,EAAA7kC,MAAa+iC,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA/vC,SAAAiuC,EAAA,OAAuCE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA2U,KAAAjnC,YAAAwwB,EAAA,aAAqDsC,OAAO/e,OAAAue,EAAA7kC,GAAA8oC,SAAA,QAAAC,UAAAlE,EAAA7kC,GAAA05C,UAAA,UAAyE3W,EAAA,OAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA8U,aAAA5W,EAAA,KAAAA,EAAA,QAAoDE,YAAA,SAAmB4B,EAAAxB,GAAA,cAAAwB,EAAAxB,GAAA,KAAAN,EAAA,QAA8CE,YAAA,gBAA0B4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA2U,KAAAjnC,cAAAwwB,EAAA,KAAAA,EAAA,QAA0DE,YAAA,SAAmB4B,EAAAxB,GAAA,kBAAAwB,EAAAxB,GAAA,KAAAN,EAAA,QAAkDE,YAAA,gBAA0B4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA5kB,iBAAA,YDWnsB,EACA,KACA,KACA,MAIAw5B,GAAAltB,QAAAmX,OAAA,uBACA,IAAAkW,GAAAH,WEjBO,MAQMI,GAAa,UAASlgD,MAAEA,EAAOH,MAAMC,MAAEA,EAAKC,IAAEA,GAAKJ,KAAEA,IAChE,IAAI+Y,KAAUynC,GAAexgD,MAASG,KAASC,IAM/C,OAJIC,IACF0Y,OAAY1Y,KAGP0Y,GAGIynC,GAAiB,SAASh2C,GACrC,OAAQA,GACR,KAAKogC,EAAA,WAAWlgC,MACd,MAAO,KACT,KAAKkgC,EAAA,WAAWjgC,OACd,MAAO,KACT,KAAKigC,EAAA,WAAWhgC,MACd,MAAO,IACT,KAAKggC,EAAA,WAAW7/B,MACd,MAAO,KACT,KAAK6/B,EAAA,WAAW3qC,KACd,MAAO,KACT,QACE,MAAO,wBAIEwgD,GAAiB,UAASzgD,KAAEA,EAAI/D,MAAEA,IAC7C,OAAQ+D,GACR,KAAK4qC,EAAA,eAAev/B,MAClB,UAAWpP,IACb,KAAK2uC,EAAA,eAAez/B,OAClB,UAAWlP,IACb,KAAK2uC,EAAA,eAAer/B,MAClB,UAAWtP,IACb,KAAK2uC,EAAA,eAAex/B,MAClB,UAAWnP,IACb,KAAK2uC,EAAA,eAAet/B,UAClB,UAAWrP,IACb,QACE,MAAO,4BC4BX,IC9EmKykD,GD8EpJxX,EAAA,EAAIC,QACjB3tC,KAAM,QACN4tC,OAAQ,WAAY,YACpBsB,YACE4V,qBAEF9T,UACEpvC,gBACE,MAAM+d,EAAe7d,KAAK8I,SAAS+U,MACnC,SAAUA,EAAM8mB,kBAAqB9mB,EAAMgnB,mBAAqB,QAElE/kC,cACE,MAAM2rC,EAAuBzrC,KAAK8I,SAAS8P,OAC3C,SAAU6yB,EAAUrwB,cAAgBqwB,EAAU/kB,SAAW,GAAK,QAEhE5mB,cACE,OAAOE,KAAK8I,SAAStG,YAAYgC,IAAI2+C,IAAgBE,KAAK,OAE5DvjD,UACE,OAAOE,KAAK8I,SAASrG,QAAQ+B,IAAIy+C,IAAYI,KAAK,QAGtDhW,SACEiW,iBAAiB7X,GACXA,EAAUrwB,cAAgBqwB,EAAU/kB,WAC5B+kB,EAAUrwB,kBAAkBqwB,EAAU/kB,UAEzC+kB,EAAUrwB,gBEjGzBmoC,WAAA/mD,OAAAwvC,EAAA,EAAAxvC,CACA4mD,GCTA,WAA0B,IAAAnV,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,oBAA8BF,EAAA,OAAYE,YAAA,eAAyBF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAnlC,SAAA+U,MAAAlC,YAAAwwB,EAAA,OAAyDE,YAAA,SAAmB4B,EAAAxB,GAAA,WAAAN,EAAA,OAA8BE,YAAA,aAAuBF,EAAA,OAAYE,YAAA,0BAAAmJ,OAA8C9vC,MAAAuoC,EAAAuV,eAA2B/U,OAASgV,KAAA,uBAAsBtX,EAAA,OAAkBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAqV,iBAAArV,EAAAnlC,SAAA8P,YAAAuzB,EAAA,OAAwEE,YAAA,MAAAmJ,OAA0BvxC,OAAAgqC,EAAAyV,iBAA4BvX,EAAA,oBAA2BE,YAAA,YAAAoC,OAA+BkU,KAAA,WAAAzkD,KAAA,KAAAylD,YAAA,OAAAf,KAAA3U,EAAAnlC,SAAA+S,YAA+EswB,EAAA,oBAAyBE,YAAA,YAAAoC,OAA+BkU,KAAA,YAAAzkD,KAAA,KAAAylD,YAAA,WAAAf,KAAA3U,EAAAnlC,SAAAiY,aAAqForB,EAAA,oBAAyBE,YAAA,YAAAoC,OAA+BkU,KAAA,eAAAzkD,KAAA,KAAAylD,YAAA,eAAAf,KAAA3U,EAAAnlC,SAAAgT,gBAA+FqwB,EAAA,oBAAyBE,YAAA,YAAAoC,OAA+BkU,KAAA,eAAAzkD,KAAA,KAAAylD,YAAA,YAAAf,KAAA3U,EAAAnlC,SAAAkY,gBAA4FmrB,EAAA,oBAAyBE,YAAA,YAAAoC,OAA+BkU,KAAA,SAAAzkD,KAAA,KAAAylD,YAAA,WAAAf,KAAA3U,EAAAnlC,SAAAmY,UAA+EkrB,EAAA,oBAAyBE,YAAA,YAAAoC,OAA+BkU,KAAA,WAAAzkD,KAAA,KAAAylD,YAAA,UAAAf,KAAA3U,EAAAnlC,SAAAoY,YAAkFirB,EAAA,OAAYE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA/jC,SAAAhM,WAAAiuC,EAAA,OAAkDE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAzrC,kBAAA2pC,EAAA,OAAgDE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAxrC,eAAA,QDYjuD,EACA,KACA,WACA,OAIA8gD,GAAA5tB,QAAAmX,OAAA,YACA,IAAA8W,GAAAL,WEpBqKM,GCYtJjY,EAAA,EAAIC,QACjB3tC,KAAM,UACN4tC,OAAQ,WACRuB,SACEvtC,KAAK4C,GACH,OAAOA,GACL,KAAK0W,EAAA,WAAWW,MACd,MAAO,QACT,KAAKX,EAAA,WAAWgJ,SAEhB,KAAKhJ,EAAA,WAAWiJ,OAEhB,KAAKjJ,EAAA,WAAW+I,WACd,MAAO,WAGbriB,MAAM4C,GACJ,OAAOA,GACL,KAAK0W,EAAA,WAAWW,MACd,MAAO,UACT,KAAKX,EAAA,WAAWgJ,SACd,MAAO,WACT,KAAKhJ,EAAA,WAAWiJ,OACd,MAAO,WACT,KAAKjJ,EAAA,WAAW+I,WACd,MAAO,oBC7BjB2hC,WAAAtnD,OAAAwvC,EAAA,EAAAxvC,CACAqnD,GCTA,WAA0B,IAAA5V,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,SAAoB4B,EAAAE,GAAAF,EAAA,iBAAAn0B,GAAuC,OAAAqyB,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,OAAAoC,OAA0BgB,IAAA,kBAAAxB,EAAA8V,KAAAjqC,GAAA,UAAqDqyB,EAAA,OAAYE,YAAA,QAAAK,UAA8BC,YAAAsB,EAAArB,GAAAqB,EAAArF,MAAA9uB,iBDYtV,EACA,KACA,WACA,OAIAgqC,GAAAnuB,QAAAmX,OAAA,cACA,IAAAkX,GAAAF,WEpB4KG,GCQ7JrY,EAAA,EAAIC,QACjB3tC,KAAM,WACN4tC,OAAQ,UACRuB,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACL,IAAK,aACH,OAAOe,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAU3lC,OACpC,IAAK,IACL,IAAK,YACH,OAAO3H,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAU5lC,MACpC,IAAK,IACL,IAAK,UACH,OAAO1H,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAU9lC,IACpC,IAAK,IACL,IAAK,YACH,OAAOxH,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAU7lC,MACpC,IAAK,IACH,OAAOzH,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAU1lC,QACpC,IAAK,IACH,OAAO5H,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAUzlC,SACpC,IAAK,IACH,OAAO7H,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAUxlC,UACpC,IAAK,IACH,OAAO9H,KAAKkxC,OAAOz/B,KAAK67B,EAAA,UAAUvlC,WAEpC,IAAK,IACH,OAAO/H,KAAKkxC,OAAOgT,gBACrB,IAAK,IACH,OAAOlkD,KAAKkxC,OAAOiT,cAErB,IAAK,IACL,IAAK,IACH,OAAOnkD,KAAKkxC,OAAOkT,cAErB,IAAK,IACL,IAAK,IACH,OAAOpkD,KAAKkxC,OAAOmT,mBACrB,IAAK,IACH,OAAOrkD,KAAKkxC,OAAOoT,aACrB,IAAK,IACH,OAAOtkD,KAAKkxC,OAAOqT,iBACrB,IAAK,IACH,OAAOvkD,KAAKkxC,OAAOsT,gBACrB,IAAK,IACH,OAAOxkD,KAAKkxC,OAAOuT,cACrB,IAAK,IACH,OAAOzkD,KAAKkxC,OAAOwT,eAErB,IAAK,IACH,OAAO1kD,KAAKkxC,OAAOyT,eACrB,IAAK,IACH,OAAO3kD,KAAKkxC,OAAO0T,gBACrB,IAAK,IACH,OAAO5kD,KAAKkxC,OAAO2T,cACrB,IAAK,IACH,OAAO7kD,KAAKkxC,OAAO4T,kBAErB,QACEC,QAAQC,IAAI,QAAS5xC,EAAMnU,UC7DnCgmD,GAAAzoD,OAAAwvC,EAAA,EAAAxvC,CACAynD,GCRA,WAA0B,IAAahY,EAAbjsC,KAAaksC,eAAkD,OAA/DlsC,KAAuCosC,MAAAD,IAAAF,GAAwB,YDWzF,EACA,KACA,KACA,MAIAgZ,GAAAtvB,QAAAmX,OAAA,eACA,IAAAoY,GAAAD,WEnByLE,GC0B1KvZ,EAAA,EAAIC,QACjBC,OAAQ,UACRjwC,KAAI,MAEAo1C,OAAQ,OAGZ5D,SACEvtC,MAAMslD,GACJ,MAAMtvB,EAASsvB,GAAqBplD,KAAKixC,OACrCnb,GACF91B,KAAKkxC,OAAOM,eAAe1b,IAG/Bh2B,QAAQsT,GACN,OAAOA,EAAMnU,KACb,IAAK,IACHe,KAAKixC,OAASjxC,KAAKkxC,OAAOvb,QAAQ,GAClC,MACF,IAAK,IACH31B,KAAKixC,OAASjxC,KAAKkxC,OAAOvb,QAAQ,GAClC,MACF,IAAK,IACL,IAAK,QACH31B,KAAKwlB,QACP,QACE,SAGJ6pB,SAASC,yBACsBA,WChDnC+V,WAAA7oD,OAAAwvC,EAAA,EAAAxvC,CACA2oD,GCTA,WAA0B,IAAAlX,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,6BAAuCF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,+CAA6EpwB,MAAAowB,EAAAiD,OAAArzB,YAA0BsuB,EAAA,OAAgBE,YAAA,WAAsB4B,EAAAE,GAAAF,EAAAiD,OAAA,iBAAApb,EAAA6X,GAAoD,OAAAxB,EAAA,OAAiBltC,IAAA62B,EAAA1sB,GAAAijC,YAAA,iBAAAC,OAAkD2E,OAAAhD,EAAAgD,QAAAhD,EAAAgD,OAAA7nC,KAAA0sB,EAAA1sB,IAAsDlF,IAAKqqC,MAAA,SAAAC,GAAyBP,EAAAgD,OAAAnb,GAAoBkc,SAAA,SAAAxD,GAA6BP,EAAAzoB,MAAAsQ,OAAoBqW,EAAA,OAAYE,YAAA,OAAAoC,OAA0BgB,IAAAxB,EAAAoB,SAAAvZ,EAAA53B,SAAiC+vC,EAAAxB,GAAA,KAAAN,EAAA,QAAyBE,YAAA,QAAkB4B,EAAAxB,GAAAwB,EAAArB,GAAA,IAAAe,EAAA,YAAAM,EAAAxB,GAAA,OAAAN,EAAA,QAAqEE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAAnY,EAAA53B,KAAA,mBAAAiuC,EAAA,OAAA8B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,8CAA+IpwB,MAAAiY,EAAAjY,MAAA,aAAkCsuB,EAAA,OAAaE,YAAA,WAAqB,OAAA4B,EAAAgD,OAAA9E,EAAA,SAAoCsC,OAAOsD,QAAA,WAAoB7tC,IAAKqqC,MAAAN,EAAAzoB,SAAmByoB,EAAAxB,GAAA,iBAAAwB,EAAAyB,MAAA,UDYlkC,EACA,KACA,WACA,OAIA2V,GAAA1vB,QAAAmX,OAAA,4BACA,IAAAwY,GAAAD,WECA,ICrBoLE,GDqBrK3Z,EAAA,EAAIC,QACjB3tC,KAAM,YACN4tC,OAAQ,UACRjwC,KAAI,MAEAgpB,KAAM,EACN2gC,QAAS,GACTC,cAGJvW,UACEpvC,SACE,OAAOE,KAAKkxC,OAAO3wC,QAErBT,iBAEE,kBADa4E,KAAK0C,MAAwC,IAAlCpH,KAAKO,OAAO+hB,YAAY3G,SAAiB,UACjC3b,KAAKO,OAAOgiB,iBAAiBtG,aAGjEoxB,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,SACH,OAAOe,KAAKkxC,OAAO1rB,QACrB,IAAK,QACL,IAAK,IACH,OAAOxlB,KAAKkxC,OAAOwU,UAAU1lD,KAAKylD,SAASjhD,IAAImpC,GAAS3tC,KAAKkxC,OAAO9zB,UAAUuwB,KAChF,QACE,OAAO3tC,KAAKovC,SAASh8B,EAAMnU,IAAIk+B,WAAW,GA9B5B,MAiClBr9B,SAAS3D,GACHA,GAAK,GAAKA,EAAIuI,KAAKyH,IAAInM,KAAKwlD,QAASxlD,KAAKkxC,OAAO9zB,UAAU/gB,UACzD2D,KAAKkxC,OAAOzzB,eACdzd,KAAKkxC,OAAOyU,SAAS3lD,KAAKkxC,OAAO9zB,UAAUjhB,IAClC6D,KAAKylD,SAAS/F,QAAQvjD,IAAM,EACrC6D,KAAKylD,SAASloD,OAAOyC,KAAKylD,SAAS/F,QAAQvjD,GAAI,GAE/C6D,KAAKylD,SAASlpD,KAAKJ,KAIzBypD,YAAYzpD,GACH8gC,OAAOC,aA7CE,GA6C2B/gC,GAE7C2D,iBAAiB6tC,GACf,OAAO3tC,KAAKylD,SAAS/F,QAAQ/R,IAAU,GAEzCkY,eAAe9gC,GACRA,EAAStc,KAGL,eAFA,GAKXq9C,WAAW/gC,GACFrgB,KAAK0C,MAAM2d,EAAStc,KAAKlG,OAASwiB,EAASrc,MAAQ,KAAO,OErEvEq9C,WAAAvpD,OAAAwvC,EAAA,EAAAxvC,CACA+oD,GCTA,WAA0B,IAAAtX,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,QAAaE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAAtI,UAAAuD,EAAA,OAA+CE,YAAA,gBAAAK,UAAsCC,YAAAsB,EAAArB,GAAAqB,EAAA+X,mBAA0C7Z,EAAA,SAAcE,YAAA,4BAAuC4B,EAAAE,GAAAF,EAAAiD,OAAA,mBAAAnsB,EAAA4oB,GAAwD,OAAAxB,EAAA,MAAgBltC,IAAA0uC,EAAArB,MAAA2B,EAAA4X,eAAA9gC,KAA6ConB,EAAA,MAAWE,YAAA,aAAuB4B,EAAAgY,iBAAAtY,GAAAxB,EAAA,OAA0CE,YAAA,SAAmB4B,EAAAxB,GAAA,OAAAwB,EAAAyB,OAAAvD,EAAA,MAAoCE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA2X,YAAAjY,OAAAxB,EAAA,MAAoDE,YAAA,cAAwB4B,EAAAxB,GAAA,OAAAN,EAAA,MAAyBE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAA7nB,EAAAtc,KAAAvK,MAAA,KAAA+vC,EAAArB,GAAA7nB,EAAArc,OAAA,OAAAyjC,EAAA,MAAgFE,YAAA,WAAqB4B,EAAAxB,GAAA,IAAAwB,EAAArB,GAAAqB,EAAA6X,WAAA/gC,IAAA,qBDYp0B,EACA,KACA,KACA,OAIAghC,GAAApwB,QAAAmX,OAAA,uBACA,IAAAoZ,GAAAH,WEpBsLI,GCkBvKva,EAAA,EAAIC,QACjBC,OAAQ,UACR5tC,KAAM,qBACNmvC,SACEvtC,WAAWgC,EAAwBypB,GACjCvrB,KAAKkxC,OAAOQ,WAAW5vC,EAAYypB,IAErCzrB,QAAQsT,GACNpT,KAAKuyC,MAAMC,iBAAiBC,QAAQr/B,KAGxCg6B,YACEiF,iBCvBJ+T,GAAA5pD,OAAAwvC,EAAA,EAAAxvC,CACA2pD,GCRA,WAA0B,IAAala,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,UAAvHrsC,KAA2IysC,GAA3IzsC,KAA2I4sC,GAA3I5sC,KAA2IkuC,GAAA,IAAAD,CAAA,6CAAA9B,EAAA,eAA2FwG,IAAA,mBAAAlE,OAA8ByC,OAApQlxC,KAAoQkxC,OAAAlb,YAAA4c,mBAAA,GAAuD1uC,IAAKwtC,WAAhU1xC,KAAgU0xC,eAA6B,QDWvX,EACA,KACA,KACA,MAIA0U,GAAAzwB,QAAAmX,OAAA,yBACA,IAAAuZ,GAAAD,WEnBiLE,GCUlK1a,EAAA,EAAIC,QACjB3tC,KAAM,gBACN4tC,OAAQ,UACRoD,UACEpvC,QACE,OAAQE,KAAKkxC,OAAOtI,OACpB,KAAKxvB,EAAA,wBAAwBswB,IAC3B,MAAO,WACT,KAAKtwB,EAAA,wBAAwBuwB,OAC3B,MAAO,gBACT,KAAKvwB,EAAA,wBAAwBwwB,OAC3B,MAAO,kBACT,QACE,OAAO5pC,KAAKkxC,OAAOtI,SAIzByE,SACEvtC,MAAMymD,GACJvmD,KAAKkxC,OAAOsV,QAAQD,IAEtBzmD,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACL,IAAK,aACH,OAAOe,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUzR,OAC1C,IAAK,IACL,IAAK,YACH,OAAO3H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU1R,MAC1C,IAAK,IACL,IAAK,UACH,OAAO1H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU5R,IAC1C,IAAK,IACL,IAAK,YACH,OAAOxH,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU3R,MAC1C,IAAK,IACH,OAAOzH,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUxR,QAC1C,IAAK,IACH,OAAO5H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUvR,SAC1C,IAAK,IACH,OAAO7H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUtR,UAC1C,IAAK,IACH,OAAO9H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUrR,WAE1C,IAAK,SACL,IAAK,IACH/H,KAAKkxC,OAAO1rB,aChDpBkhC,WAAAlqD,OAAAwvC,EAAA,EAAAxvC,CACA8pD,GCTA,WAA0B,IAAArY,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,eAAyBF,EAAA,OAAYE,YAAA,QAAAK,UAA8BC,YAAAsB,EAAArB,GAAAqB,EAAArF,UAAiCqF,EAAAE,GAAAF,EAAAiD,OAAA,cAAAuF,GAAyC,OAAAtK,EAAA,OAAiBO,UAAUC,YAAAsB,EAAArB,GAAA6J,SAA6B,QDY/S,EACA,KACA,WACA,OAIAiQ,GAAA/wB,QAAAmX,OAAA,oBACA,IAAA6Z,GAAAD,WEpB+KE,GCQhKhb,EAAA,EAAIC,QACjB3tC,KAAM,cACN4tC,OAAQ,UACRuB,SACEvtC,MAAMymD,GACJvmD,KAAKkxC,OAAOsV,QAAQD,IAEtBzmD,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACL,IAAK,aACH,OAAOe,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUzR,OAC1C,IAAK,IACL,IAAK,YACH,OAAO3H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU1R,MAC1C,IAAK,IACL,IAAK,UACH,OAAO1H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU5R,IAC1C,IAAK,IACL,IAAK,YACH,OAAOxH,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAU3R,MAC1C,IAAK,IACH,OAAOzH,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUxR,QAC1C,IAAK,IACH,OAAO5H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUvR,SAC1C,IAAK,IACH,OAAO7H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUtR,UAC1C,IAAK,IACH,OAAO9H,KAAKkxC,OAAOuV,WAAWrtC,EAAA,UAAUrR,WAE1C,IAAK,IACH/H,KAAKkxC,OAAO2V,aACZ,MACF,IAAK,IACH7mD,KAAKkxC,OAAO4V,iBACZ,MACF,IAAK,IACH9mD,KAAKkxC,OAAO6V,SACZ,MACF,IAAK,SACH/mD,KAAKkxC,OAAO1rB,aCzCpBwhC,GAAAxqD,OAAAwvC,EAAA,EAAAxvC,CACAoqD,GCRA,WAA0B,IAAa3a,EAAbjsC,KAAaksC,eAAkD,OAA/DlsC,KAAuCosC,MAAAD,IAAAF,GAAwB,YDWzF,EACA,KACA,KACA,MAIA+a,GAAArxB,QAAAmX,OAAA,kBACA,IAAAma,GAAAD,WEnB6KE,GCc9Jtb,EAAA,EAAIC,QACjB3tC,KAAM,YACN4tC,OAAQ,UACRoD,UACEpvC,UACE,OAAQE,KAAKkxC,OAAOl2B,WACpB,KAAK5B,EAAA,UAAUklB,OACb,MAAO,sEACT,KAAKllB,EAAA,UAAUpJ,QACb,MAAO,0EACT,KAAKoJ,EAAA,UAAU1O,KACb,MAAO,wCACT,KAAK0O,EAAA,UAAU+I,WACb,MAAO,uDACT,QACE,MAAO,mEAGXriB,YACE,mBAAoBE,KAAKkxC,OAAOznB,6BAGpC4jB,SACEvtC,QAAQsT,QC7BZ+zC,WAAA3qD,OAAAwvC,EAAA,EAAAxvC,CACA0qD,GCTA,WAA0B,IAAajb,EAAbjsC,KAAaksC,eAA0BC,EAAvCnsC,KAAuCosC,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,aAAvHrsC,KAA8IysC,GAAA,aAAAN,EAAA,OAAgCE,YAAA,iBAA2BF,EAAA,cAAmBE,YAAA,qCAA+CF,EAAA,KAAUE,YAAA,OAAAK,UAA6BC,YAAlT3sC,KAAkT4sC,GAAlT5sC,KAAkTmwB,YAAmCgc,EAAA,UAAeE,YAAA,oBAAAK,UAA0CC,YAA9Y3sC,KAA8Y4sC,GAA9Y5sC,KAA8YonD,yBDYxa,EACA,KACA,KACA,OAIAD,GAAAxxB,QAAAmX,OAAA,gBACA,IAAAua,GAAAF,WEFA,IClBwLG,GDkBzK1b,EAAA,EAAIC,QACjB3tC,KAAM,uBACN4tC,OAAQ,UACRjwC,KAAI,MAEAgpB,KAAM,EACN2gC,QAAS,GACTC,cAGJvW,UACEpvC,QACE,OAAQE,KAAKkxC,OAAOxuC,MACpB,KAAK4qC,EAAA,cAAczX,iBACjB,MAAO,8BAIbwX,SACEvtC,WAAWg2B,GACT,OAAQ91B,KAAKkxC,OAAOxuC,MACpB,KAAK4qC,EAAA,cAAczX,iBACjB,OAAOC,EAAO,KAGlBh2B,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,SACH,OAAOe,KAAKkxC,OAAO1rB,QACrB,IAAK,QACL,IAAK,IACH,OAAOxlB,KAAKkxC,OAAOqW,YAAYvnD,KAAKylD,SAASjhD,IAAImpC,GAAS3tC,KAAKkxC,OAAO9zB,UAAUuwB,KAClF,QACE,OAAO3tC,KAAKovC,SAASh8B,EAAMnU,IAAIk+B,WAAW,GAnC5B,MAsClBr9B,SAAS3D,GACHA,GAAK,GAAKA,EAAIuI,KAAKyH,IAAInM,KAAKwlD,QAASxlD,KAAKkxC,OAAOvb,QAAQt5B,SAC3D2D,KAAKkxC,OAAOpxB,KAAK9f,KAAKkxC,OAAOvb,QAAQx5B,KAGzCypD,YAAYzpD,GACH8gC,OAAOC,aA5CE,GA4C2B/gC,MEpDjDqrD,WAAAhrD,OAAAwvC,EAAA,EAAAxvC,CACA8qD,GCTA,WAA0B,IAAArZ,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,QAAaE,YAAA,QAAAK,UAA8BC,YAAAsB,EAAArB,GAAAqB,EAAArF,UAAiCuD,EAAA,SAAcE,YAAA,0BAAqC4B,EAAAE,GAAAF,EAAAiD,OAAA,iBAAApb,EAAA6X,GAAoD,OAAAxB,EAAA,MAAgBltC,IAAA0uC,IAAUxB,EAAA,MAAWE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA2X,YAAAjY,OAAAxB,EAAA,MAAoDE,YAAA,cAAwB4B,EAAAxB,GAAA,OAAAN,EAAA,MAAyBE,YAAA,OAAAK,UAA6BC,YAAAsB,EAAArB,GAAAqB,EAAAwZ,WAAA3xB,mBDYpf,EACA,KACA,WACA,OAIA0xB,GAAA7xB,QAAAmX,OAAA,2BACA,IAAA4a,GAAAF,WEpBkLG,GCkBnK/b,EAAA,EAAIC,QACjB3tC,KAAM,WACN4tC,OAAQ,UACRuB,SACEvtC,QAAQsT,QCdZw0C,WAAAprD,OAAAwvC,EAAA,EAAAxvC,CACAmrD,GCTA,WAA0B,IAAA1Z,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAA,cAAAN,EAAA,QAAkCE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAAnI,mBAAAoD,EAAA,OAAwDE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAA,mBAAAN,EAAA,QAAuCE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAAvM,iCDYnd,EACA,KACA,WACA,OAIAijB,GAAAjyB,QAAAmX,OAAA,eACA,IAAA+a,GAAAD,WE0BA,IC9CuLE,GD8CxKlc,EAAA,EAAIC,QACjB3tC,KAAM,gBACN4tC,OAAQ,UACRjwC,KAAI,MAEAgpB,KAAM,EACN2gC,QAAS,KAGbtW,UACEpvC,SACE,OAAOE,KAAKkxC,OAAO3wC,QAErBT,iBAEE,kBADa4E,KAAK0C,MAAwC,IAAlCpH,KAAKO,OAAO+hB,YAAY3G,SAAiB,UACjC3b,KAAKO,OAAOgiB,iBAAiBtG,aAGjEoxB,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACL,IAAK,SACH,OAAOe,KAAKkxC,OAAO1rB,QACrB,QACE,OAAOxlB,KAAKovC,SAASh8B,EAAMnU,IAAIk+B,WAAW,GA3B5B,MA8BlBr9B,SAAS3D,GACP,GAAIA,GAAK,GAAKA,EAAIuI,KAAKyH,IAAInM,KAAKwlD,QAASxlD,KAAKkxC,OAAO9zB,UAAU/gB,QAAS,CACtE,MAAM0oB,EAAW/kB,KAAKkxC,OAAO9zB,UAAUjhB,GACnC4oB,EAAStc,KACXzI,KAAKkxC,OAAO1tB,QAAQuB,GACXA,EAASE,eAAe5oB,QACjC2D,KAAKkxC,OAAOpR,MAAM/a,KAIxBjlB,gBAAgBilB,GACd,GAAIA,EAAStc,MAAQsc,EAAStc,KAAK4G,cACjC,O7CpFuB,SAAS5G,GACtC,OAAIA,aAAgB6kC,EAAA,OACX7kC,EAAKhG,QAAQ+B,IAAIy+C,IAAYI,KAAK,KAChC56C,aAAgB6kC,EAAA,MAClB7kC,EAAKjG,YAAYgC,IAAI2+C,IAAgBE,KAAK,UAD5C,E6CiFM0E,CAAgBhjC,EAAStc,OAGpCm9C,YAAYzpD,GACH8gC,OAAOC,aA9CE,GA8C2B/gC,GAE7C0pD,eAAe9gC,GACRA,EAAStc,KAGL,eAFA,GAKXu/C,gBAAgB/5B,GACPA,EAAS/vB,KAElB4B,YAAY2I,GACV,GAAIA,EACF,SAAUu0C,GAAYv0C,GAAMw/C,aAAax/C,EAAKvK,QAGlDgqD,SAASnjC,GACHA,EAAStc,MAAQsc,EAASrc,SAClBqc,EAAStc,KAAKvK,QAAQ6mB,EAASrc,MAAQ,MAAQqc,EAASrc,SAAW,KAEtE,IAGX5I,WAAWilB,GACT,GAAIA,EAAStc,MAAQsc,EAASrc,MAC5B,UAAWqc,EAAStc,KAAKlG,OAASwiB,EAASrc,YAG/CshC,UAAUjlB,GACDA,EAAStc,MAAQsc,EAASE,eAAe5oB,OAElDyD,gBAAgBilB,GACd,OAAO/kB,KAAKgqC,UAAUjlB,GAAY,aAAe,mBEnHvDojC,WAAA3rD,OAAAwvC,EAAA,EAAAxvC,CACAsrD,GCTA,WAA0B,IAAA7Z,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAAA,EAAA,OAA2BE,YAAA,gBAAAK,UAAsCC,YAAAsB,EAAArB,GAAAqB,EAAA+X,mBAA0C7Z,EAAA,SAAcE,YAAA,0BAAqC4B,EAAAE,GAAAF,EAAAiD,OAAA,mBAAAnsB,EAAA4oB,GAAwD,OAAAxB,EAAA,MAAgBltC,IAAA0uC,EAAArB,MAAA2B,EAAAma,gBAAArjC,KAA8ConB,EAAA,MAAWE,YAAA,SAAmBF,EAAA,QAAaE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA2X,YAAAjY,OAAAxB,EAAA,QAAsDE,YAAA,SAAmB4B,EAAAxB,GAAA,OAAAN,EAAA,QAA2BE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA+Z,gBAAAjjC,EAAAC,mBAAAmnB,EAAA,QAA2EE,YAAA,cAAwB4B,EAAAxB,GAAA,SAAAN,EAAA,MAA2BE,YAAA,cAAwBF,EAAA,QAAaE,YAAA,OAAAC,MAAA2B,EAAA4X,eAAA9gC,KAAsDkpB,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAia,SAAAnjC,OAAAonB,EAAA,SAAuDE,YAAA,UAAAK,UAAgCC,YAAAsB,EAAArB,GAAAqB,EAAAoa,gBAAAtjC,SAAqDonB,EAAA,MAAaE,YAAA,WAAqB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAA6X,WAAA/gC,mBDY36B,EACA,KACA,KACA,OAIAojC,GAAAxyB,QAAAmX,OAAA,oBACA,IAAAwb,GAAAH,WEpByLI,GC2D1K3c,EAAA,EAAIC,QACjB3tC,KAAM,kBACN4tC,OAAQ,UACRuB,SACEvtC,QAAQsT,MAEVg6B,YACEoD,sBC1DJgY,WAAAhsD,OAAAwvC,EAAA,EAAAxvC,CACA+rD,GCTA,WAA0B,IAAAta,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,wCAAA9B,EAAA,QAA+EE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAAhzC,WAAAiuC,EAAA,OAAgDE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,0CAAA9B,EAAA,QAAiFE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAiD,OAAAtvC,OAAA,iBAAAuqC,EAAA,OAAyEE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,wCAAA9B,EAAA,QAA+EE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAiD,OAAArvC,KAAA3D,KAAA,eAAAiuC,EAAA,OAA0EE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,0CAAA9B,EAAA,QAAiFE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAAjtC,QAAA,UAAAkoC,EAAA,OAAuDE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,0CAAA9B,EAAA,QAAiFE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAA3uC,QAAA,YAAA4pC,EAAA,OAAyDE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,uCAAA9B,EAAA,QAA8EE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAiD,OAAAvtC,SAAA,gBAAAwoC,EAAA,OAA0EE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,wCAAA9B,EAAA,QAA+EE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAiD,OAAArtC,UAAA,gBAAAsoC,EAAA,OAA2EE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,wCAAA9B,EAAA,QAA+EE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,GAAAiD,OAAAntC,UAAA,kBAAAooC,EAAA,OAA6EE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,kBAA4BF,EAAA,QAAaE,YAAA,SAAmB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA,yCAAA9B,EAAA,QAAgFE,YAAA,UAAoB4B,EAAAxB,GAAAwB,EAAArB,GAAAqB,EAAAiD,OAAA5vC,cAAA6qC,EAAA,oBAAgEsC,OAAOluC,OAAA0tC,EAAAiD,OAAA3wC,WAA4B,QDYnxE,EACA,KACA,WACA,OAIAioD,GAAA7yB,QAAAmX,OAAA,sBACA,IAAA2b,GAAAD,WEpBqLE,GC+BtK9c,EAAA,EAAIC,QACjB3tC,KAAM,oBACN4tC,OAAQ,UACRuB,SACEvtC,QAAQsT,GACN,OAAQA,EAAMnU,KACd,IAAK,IACH,OAAOe,KAAKkxC,OAAOyT,eACrB,IAAK,IACH,OAAO3kD,KAAKkxC,OAAO0T,gBACrB,IAAK,IACH,OAAO5kD,KAAKkxC,OAAO2T,cACrB,IAAK,IACH,OAAO7kD,KAAKkxC,OAAO4T,kBACrB,IAAK,SACH,OAAO9kD,KAAKkxC,OAAO3zB,SACrB,QACEvd,KAAKuyC,MAAMoW,cAAclW,QAAQr/B,MAIvC87B,UACEpvC,OACE,OAAOE,KAAKkxC,OAAOrsB,MACjB,KAAKyoB,EAAA,kBAAkBxE,KACrB,OAAO+e,GACT,KAAKva,EAAA,kBAAkBxoB,UACrB,OAAOwjC,GACT,KAAKhb,EAAA,kBAAkB/W,QACrB,OAAO8b,EACT,KAAK/E,EAAA,kBAAkBjE,QACrB,OAAOof,GACT,QACE,OAAOZ,KAGbe,MAAK,MAEClmD,KAAM4qC,EAAA,kBAAkBxE,KAAM5qC,KAAM,WAAYe,IAAK,MACrDyD,KAAM4qC,EAAA,kBAAkBxoB,UAAW5mB,KAAM,YAAae,IAAK,MAC3DyD,KAAM4qC,EAAA,kBAAkB/W,QAASr4B,KAAM,cAAee,IAAK,MAC3DyD,KAAM4qC,EAAA,kBAAkBjE,QAASnrC,KAAM,cAAee,IAAK,MAGjEa,eACE,IAAIg2B,EAAS91B,KAAK4oD,MAAM1pC,KAAK,EAAGxc,UAAWA,IAAS1C,KAAKkxC,OAAOrsB,MAChE,OAAOiR,EAASA,EAAO53B,KAAO,aAGlCkvC,YACEya,YACAS,iBACAjW,iBC3EJwW,WAAArsD,OAAAwvC,EAAA,EAAAxvC,CACAksD,GCTA,WAA0B,IAAAza,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2B4B,EAAAE,GAAAF,EAAA,eAAA0E,GACrI,IAAAz0C,EAAAy0C,EAAAz0C,KACAe,EAAA0zC,EAAA1zC,IACA,OAAAktC,EAAA,OAAiBE,YAAA,cAAAC,OAAiCuF,UAAA5D,EAAA6a,eAAA5qD,KAAwC+vC,EAAAxB,GAAA,KAAAN,EAAA,QAAyBE,YAAA,QAAkB4B,EAAAxB,GAAAwB,EAAArB,GAAA3tC,MAAAgvC,EAAAxB,GAAA,MAAAwB,EAAArB,GAAAqB,EAAAC,GAAA,IAAAD,CAAA/vC,EAAA,kCAA6FiuC,EAAA8B,EAAAppB,MAAe8tB,IAAA,gBAAAoW,IAAA,YAAAta,OAA2CyC,OAAAjD,EAAAiD,WAAqB,QDSjT,EACA,KACA,WACA,OAIA2X,GAAAlzB,QAAAmX,OAAA,wBACA,IAAAkc,GAAAH,WEpBkKI,GCqDnJrd,EAAA,EAAIC,QACjB3tC,KAAM,OACN4tC,OAAQ,QACRjwC,KAAI,MAEAqtD,oBAAgB9gD,IAGpBglC,YACE4W,WACAl1B,SACA2zB,SACAmB,UAEF1U,UACEpvC,gBACE,GAAKE,KAAKkF,KAAKjE,YAAejB,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAIlD,OAAQ3L,KAAKkF,KAAK3E,OAAOW,GAAGyK,UAAUjJ,MACtC,KAAK0W,EAAA,cAAc8c,eACjB,OAAOmwB,GACT,KAAKjtC,EAAA,cAAc6wB,kBACjB,OAAOqb,GACT,KAAKlsC,EAAA,cAAcwe,KACjB,OAAOstB,GACT,KAAK9rC,EAAA,cAAckE,aACjB,OAAO4oC,GACT,KAAK9sC,EAAA,cAAcpJ,QACjB,OAAOi3C,GACT,KAAK7tC,EAAA,cAAc6b,cACnB,KAAK7b,EAAA,cAAcqwB,KACjB,OAAOkd,GACT,KAAKvtC,EAAA,cAAcoQ,MACjB,OAAO69B,GACT,KAAKjuC,EAAA,cAAcyc,iBACjB,OAAO6xB,GACT,KAAKtuC,EAAA,cAAc0B,cACjB,OAAOkuC,GACT,QACE,+BAAgChpD,KAAKkF,KAAK3E,OAAOW,GAAGyK,eAI1D0hC,SACEvtC,OACEE,KAAKkF,KAAKnE,QAEZjB,QAAQsT,GACN,MAAM8gC,EAAOl0C,KAAKuyC,MAAM4W,cACpBjV,GACFA,EAAKzB,QAAQr/B,OCjGrBg2C,WAAA5sD,OAAAwvC,EAAA,EAAAxvC,CACAysD,GCTA,WAA0B,IAAAhb,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAgC,EAAA,KAAA9B,EAAA,OAA4BsC,OAAOrlC,GAAA,iBAAoB6kC,EAAA/oC,KAAA,OAAAinC,EAAA,SAAgCE,YAAA,QAAAoC,OAA2B5wB,MAAAowB,EAAA/oC,KAAAlE,WAAAT,OAAA0tC,EAAA/oC,KAAA3E,OAAA2R,IAAA+7B,EAAA/oC,KAAAlE,WAAAgR,YAAAi8B,EAAA/oC,KAAA3E,WAA6G0tC,EAAAyB,KAAAzB,EAAA/oC,KAAA,OAAAinC,EAAA,SAAyCE,YAAA,eAAAoC,OAAkC3lC,SAAAmlC,EAAA/oC,KAAA3E,OAAA8oD,YAAApb,EAAA/oC,KAAAlE,cAA4DitC,EAAAyB,KAAAvD,EAAA,UAAwBE,YAAA,eAAAoC,OAAkC5jC,OAAAojC,EAAA/oC,KAAA2F,UAA0BshC,EAAA,WAAgBE,YAAA,eAAAoC,OAAkC9/B,QAAAs/B,EAAA/oC,KAAA3E,OAAAoO,WAAmCs/B,EAAA/oC,KAAA,WAAAinC,EAAA8B,EAAAkb,eAA8CxW,IAAA,gBAAAoW,IAAA,YAAAta,OAA2CyC,OAAAjD,EAAA/oC,KAAA3E,OAAAW,GAAAyK,aAAuCsiC,EAAAyB,MAAA,GAAAzB,EAAAyB,UDYxuB,EACA,KACA,KACA,OAIA0Z,GAAAzzB,QAAAmX,OAAA,WACA,IAAAnH,GAAAyjB,WEyCA,IC7DkKE,GD6DnJ1d,EAAA,EAAIC,QACjB3tC,KAAM,OACN4B,OACE,MAAMypD,EAAM,IAAIjc,EAAA,YAChB,OACEic,IAAKA,EACLC,WAAYD,EAAIE,eAChBP,oBAAgB9gD,EAChBye,KAAM,IAGVqoB,UACEpvC,WACE,GAAKE,KAAKupD,IAAI/nD,KAId,OAAQxB,KAAKupD,IAAI/nD,KAAKuqC,WACpB,KAAKuB,EAAA,cAAcyD,SACjB,OAAOA,EACT,KAAKzD,EAAA,cAAc0B,iBACjB,OAAOA,EACT,KAAK1B,EAAA,cAAcyC,eACjB,OAAOA,EACT,KAAKzC,EAAA,cAAcqC,qBACjB,OAAOA,EACT,KAAKrC,EAAA,cAAcoB,wBACjB,OAAOA,EACT,KAAKpB,EAAA,cAAc8C,cACjB,OAAOA,EACT,KAAK9C,EAAA,cAAcqD,eACjB,OAAOA,EACT,KAAKrD,EAAA,cAAcoc,YACjB,OAAO7W,IAGb/yC,gBACE,GAAIE,KAAKwpD,WAAWxoD,WAClB,OAAO,IAAIssC,EAAA,MACT5oC,KAAK0C,MAAyC,GAAnCpH,KAAKwpD,WAAWxoD,WAAW0E,OACtChB,KAAK0C,MAA0C,GAApCpH,KAAKwpD,WAAWxoD,WAAWiD,UAI5CnE,OACE,OAAOE,KAAKupD,IAAI9nD,WAGpB2rC,YACEqV,SACA9c,SAEF0H,SACEvtC,OACwBE,KAAKuyC,MAAMoX,cAE7B3pD,KAAKkF,MAAQlF,KAAKuyC,MAAMoX,cAC1B3pD,KAAKuyC,MAAMoX,cAAcC,OAIvB5pD,KAAKwpD,aACPxpD,KAAK6mB,MAAQ,EAET7mB,KAAK6mB,MAAQ,KACf7mB,KAAK6mB,KAAO,EACZ7mB,KAAKwpD,WAAWzoD,OAEZf,KAAKwpD,WAAWpoD,OAClBpB,KAAKwpD,WAAaxpD,KAAKupD,IAAIE,mBAKnC3pD,QAAQsT,GACN,MAAMu2C,EAAgB3pD,KAAKuyC,MAAMoX,cAC7BA,GACFA,EAAclX,QAAQr/B,GAGxB,MAAMy2C,EAAgB7pD,KAAKuyC,MAAMsX,cAC7BA,GACFA,EAAcpX,QAAQr/B,KAI5BtT,UACEE,KAAKkpD,eAAiB1pD,OAAOyiD,YAAYjiD,KAAK4pD,KAzF5B,IA0FlBxV,SAAS0V,iBAAiB,UAAW9pD,KAAKyyC,UAE5C3yC,gBACEkiD,cAAchiD,KAAKkpD,gBACnB9U,SAAS2V,oBAAoB,UAAW/pD,KAAKyyC,YEjJjDuX,WAAAxtD,OAAAwvC,EAAA,EAAAxvC,CACA8sD,GCTA,WAA0B,IAAArb,EAAAjuC,KAAaisC,EAAAgC,EAAA/B,eAA0BC,EAAA8B,EAAA7B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,oBAA8B4B,EAAA,KAAA9B,EAAA,QAAwBwG,IAAA,gBAAAlE,OAA2BvpC,KAAA+oC,EAAA/oC,QAAiB+oC,EAAA,WAAA9B,EAAA,SAA+BsC,OAAO5wB,MAAAowB,EAAAub,WAAAxoD,WAAAT,OAAA0tC,EAAAub,WAAAjpD,OAAA2R,IAAA+7B,EAAAgc,iBAA0Fhc,EAAAyB,KAAAzB,EAAAsb,IAAA,KAAApd,EAAA,OAAoCE,YAAA,4BAAsCF,EAAA,OAAYE,YAAA,UAAoB4B,EAAAxB,GAAA,sTAAAN,EAAA8B,EAAAic,UAAgVvX,IAAA,gBAAAoW,IAAA,YAAAta,OAA2CjtC,KAAAysC,EAAAsb,IAAA/nD,SAAqB,GAAAysC,EAAAyB,MAAA,QDYt0B,EACA,KACA,KACA,OAIAsa,GAAAr0B,QAAAmX,OAAA,WACA,IAAAqd,GAAAH,WETApe,EAAA,EAAIwe,IAAIC,EAAA,GAERC,MAAM,mBAAqBC,MAAO,aAAcC,KAAMC,GAAaA,EAASC,QAAQF,KAAM3gB,IACxF,MAAM8gB,EAAW,IAAIC,EAAA9P,GAAW+P,QAAShhB,EAAMihB,OAAQ,OAEvDlf,EAAA,EAAI33B,OAAO,IAAK,CAAChV,EAAa8rD,EAAgBC,EAAgBC,IACrDN,EAAS/rD,EAAEosD,KAAYD,KAAU9rD,KAAO+rD,OAAcD,KAAU9rD,IAAOgsD,IAKhFrf,EAAA,EAAI33B,OAAO,cAAgB05B,GAClB1Q,OAAOC,aAHM,GAGuByQ,IAG7C,IAAI/B,EAAA,GACFsf,GAAI,OACJ9S,OAAQ9yC,GAAKA,EAAE6kD","file":"main.0937fda8.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([156,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import { Creature } from '../models/creature'\nimport { Player } from '../models/player'\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  NOTHING,\n  RESIST,\n}\n\nexport abstract class PlayerEvent {\n  public abstract affectPlayer(subject: Player): Reaction\n}\n\nexport abstract class CreatureEvent extends PlayerEvent {\n  public abstract affectCreature(subject: Creature): Reaction\n  public affectPlayer(subject: Player): Reaction {\n    return this.affectCreature(subject)\n  }\n}\n","import { map } from 'jquery'\nimport { drop, last, reduce, times } from 'lodash'\nimport {\n  Clan,\n  Color,\n  Critical,\n  DamageType,\n  Game,\n  Gender,\n  Level,\n  Material,\n  PickProfessionEvent,\n  Player,\n  PlayerAI,\n  PlayerBorgAI,\n  PrimaryAttributes,\n  Profession,\n  Race,\n} from './engine'\nimport { Dispatcher } from './onisun/ai'\nimport { TitleDungeon } from './onisun/dungeons/title_dungeon'\nimport { MainMenu, Menu } from './onisun/menus'\nimport {\n  OnisunAttackerProfession,\n  OnisunProfessionPicker,\n  OnisunDefenderProfession,\n} from './onisun/professions'\nimport { humanRace } from './onisun/races'\n\nexport * from './engine'\nexport * from './onisun/ai'\nexport * from './onisun/items'\nexport * from './onisun/menus'\nexport * from './onisun/professions'\nexport * from './onisun/races'\nexport * from './onisun/talents'\n\nconst critical: Critical = { chance: 0.05, multiplier: 2 }\n\nexport class Onisun extends Game {\n  constructor(player: Player) {\n    super(player, new OnisunProfessionPicker())\n\n    const dungeon = new TitleDungeon()\n    dungeon.register(this)\n    dungeon.enter(this, player)\n  }\n}\n\nexport class TitleGame extends Game {\n  public turn(): void {\n    super.turn()\n\n    if (this.currentMap && this.playerTurn) {\n      this.player.ai.endTurn(this, this.currentMap)\n    }\n  }\n\n  get done(): boolean {\n    return this.player.dead || this.turns > 150\n  }\n}\n\nexport class Application {\n  public menu: Menu | null = null\n  public mainGame: Onisun | null = null\n\n  constructor() {\n    // this.menu = new MainMenu(this)\n    this.initGame(this.randomPlayer(new PlayerAI()))\n  }\n\n  public initGame(player: Player) {\n    this.mainGame = new Onisun(player)\n    this.menu = null\n  }\n\n  public newPlayer(\n    gender: Gender,\n    race: Race,\n    profession: Profession,\n    attributes: PrimaryAttributes,\n    name: string,\n    parentsProfession: Profession,\n    ai: PlayerAI = new PlayerAI()\n  ) {\n    let player = new Player(\n      this.buildLevels(race),\n      ai,\n      {\n        name: name,\n        race: race,\n        gender: gender,\n        clan: Clan.Player,\n        abilities: [],\n        leavesCorpseRatio: 0,\n\n        ownProfession: profession,\n        parentsProfession: parentsProfession,\n\n        // TODO: Review the rest\n\n        weight: 80,\n        protections: [],\n        damages: [\n          { type: DamageType.Pure, dice: { times: 3, max: 3 }, extra: 1 },\n        ],\n        maxHealthValue: 10,\n        regenerationRate: 1,\n        regenerationValue: 1,\n        resistances: [],\n        visionRadius: 10,\n        moveSpeed: 20,\n        attackSpeed: 20,\n        bodyControl: 5,\n        material: Material.flesh,\n        throwingDamages: [],\n\n        eyeColor: Color.Aqua,\n        hairColor: Color.Fuchsia,\n        skinColor: Color.Purple,\n\n        height: 100,\n        critical,\n      },\n      attributes\n    )\n\n    player.on(new PickProfessionEvent(profession))\n    player.on(new PickProfessionEvent(parentsProfession))\n\n    return player\n  }\n\n  private buildLevels(race: Race): Level {\n    return new Level(\n      drop(\n        reduce(\n          map(\n            drop(times(51, i => (i % 5) * 10 + ~~(i / 5) * 100), 2),\n            (x, i) => x * (i + 1)\n          ),\n          (acc, v) => {\n            acc.push((last(acc) || 0) + v)\n            return acc\n          },\n          [0]\n        ),\n        1\n      ).map(val => Math.floor(val * race.experienceRatio))\n    )\n  }\n\n  public randomPlayer(ai: PlayerAI): Player {\n    return this.newPlayer(\n      Gender.Male,\n      humanRace,\n      new OnisunAttackerProfession(),\n      humanRace.primaryAttributes,\n      'AI',\n      new OnisunDefenderProfession(),\n      ai\n    )\n  }\n\n  public newTitleGame() {\n    let player = this.randomPlayer(new PlayerBorgAI(new Dispatcher())),\n      game = new TitleGame(player, new OnisunProfessionPicker()),\n      dungeon = new TitleDungeon()\n\n    dungeon.register(game)\n    dungeon.enter(game, player)\n\n    return game\n  }\n}\n","import { min } from 'lodash'\n\nexport class Rect {\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {\n    if (w <= 0 || h <= 0) {\n      throw `Rect ${x} ${y} ${w} ${h}: size is negative or zero`\n    }\n  }\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\nexport const twoDimArray = function<T>(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => T\n): T[][] {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x: number, y: number): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (tile: T, x: number, y: number) => any): void {\n    this.map.forEach((column, x) => {\n      column.forEach((tile, y) => {\n        on(tile, x, y)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n\nexport const bresenhamInclusion = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  bresenham(p0, p1, on)\n  on(p1.x, p1.y)\n}\n\nexport class Direction extends Point {\n  private constructor(x: number, y: number) {\n    super(x, y)\n  }\n\n  static readonly up = new Direction(0, -1)\n  static readonly down = new Direction(0, 1)\n  static readonly left = new Direction(-1, 0)\n  static readonly right = new Direction(1, 0)\n\n  static readonly upLeft = new Direction(-1, -1)\n  static readonly upRight = new Direction(1, -1)\n  static readonly downLeft = new Direction(-1, 1)\n  static readonly downRight = new Direction(1, 1)\n\n  static readonly all = [\n    Direction.up,\n    Direction.down,\n    Direction.left,\n    Direction.right,\n    Direction.upLeft,\n    Direction.upRight,\n    Direction.downLeft,\n    Direction.downRight,\n  ]\n\n  public multiple(ratio: number): Point {\n    return new Point(this.x * ratio, this.y * ratio)\n  }\n}\n\nexport const minUnsafe = function<T>(list: T[]): T {\n  const elem = min(list)\n  if (elem !== undefined) {\n    return elem\n  }\n\n  throw 'minUnsafe got empty array'\n}\n","import { Creature } from './creature'\nimport { Point } from '../utils/utils'\nimport { LevelMap } from './level_map'\nimport { Item } from './item'\nimport { Game } from './game'\nimport { ItemsBunch } from '../lib/bunch'\nimport { Player } from './player'\nimport { Reaction } from '../events/internal'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n  Trap,\n  Trigger,\n}\n\nexport abstract class Tile {\n  public creature?: Creature\n  public items: ItemsBunch<Item> | undefined\n\n  constructor(public key: string, public kind: TileTypes) {}\n\n  public addItem(item: Item, count: number): void {\n    if (!this.items) {\n      this.items = new ItemsBunch()\n    }\n\n    this.items.put(item, count)\n  }\n\n  public free(creature?: Creature): boolean {\n    return this.isFloor() && this.passibleThrough(creature)\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public abstract visit(tileVisitor: TileVisitor): void\n\n  public clone(from: Tile = this): Tile {\n    let tile = this.buildNew() // TODO: Rethink & make clear\n\n    if (from.creature) {\n      tile.creature = from.creature\n    }\n    tile.items = from.items && from.items.clone()\n    return tile\n  }\n\n  protected abstract buildNew(): Tile\n}\n\nexport class Floor extends Tile {\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onFloor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Floor(this.key, this.kind)\n  }\n}\n\nexport class Corridor extends Floor {}\n\nexport class Room extends Floor {\n  constructor() {\n    super('R', TileTypes.Floor)\n  }\n}\n\nexport class Door extends Tile {\n  constructor(public open: boolean = Math.random() >= 0.5) {\n    super('D', TileTypes.Door)\n  }\n\n  public visibleThrough(): boolean {\n    return this.open\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onDoor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Door(this.open)\n  }\n}\n\nexport class Wall extends Tile {\n  constructor() {\n    super('W', TileTypes.Wall)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onWall(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Wall()\n  }\n}\n\nexport abstract class Stairway extends Tile {\n  private _enterPos: Point | undefined\n\n  constructor(\n    key: string,\n    type: TileTypes,\n    public currentMap: LevelMap,\n    public adjacentMapName: string\n  ) {\n    super(key, type)\n  }\n\n  public enterPos(levelMap: LevelMap, adjacentMap: LevelMap): Point {\n    if (this._enterPos) {\n      return this._enterPos\n    }\n\n    return (this._enterPos = adjacentMap.matchStairs(levelMap.name))\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapName: string) {\n    super('>', TileTypes.StairwayDown, currentMap, adjacentMapName)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayDown(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayDown(this.currentMap, this.adjacentMapName)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapName: string) {\n    super('<', TileTypes.StairwayUp, currentMap, adjacentMapName)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayUp(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayUp(this.currentMap, this.adjacentMapName)\n  }\n}\n\nexport enum TrapType {\n  AirBlow,\n  BareWire,\n  FallingRock,\n  Hole,\n  Light,\n  Teleportation,\n  Water,\n}\n\nexport abstract class Trap extends Tile {\n  constructor(\n    public readonly type: number,\n    public tile: Tile,\n    public revealed: boolean = false\n  ) {\n    super('^', TileTypes.Trap)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrap(this)\n  }\n\n  abstract get dodgeRatio(): number\n\n  public abstract activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction\n\n  protected disarmTile(\n    { x, y }: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    game.logger.succeededToUntrap(player)\n    levelMap.setTile(x, y, this.tile.clone(this))\n  }\n\n  public abstract untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void\n}\n\nexport abstract class TriggerTile extends Tile {\n  constructor(public singleUse: boolean = true, public tile: Tile) {\n    super('T', TileTypes.Trigger)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrigger(this)\n  }\n\n  public activate(game: Game, levelMap: LevelMap, actor: Creature): void {\n    if (this.singleUse) {\n      const { x, y } = levelMap.creaturePos(actor)\n      const tile = this.clone()\n      tile.creature = actor\n      levelMap.setTile(x, y, tile)\n    }\n\n    this.onTrigger(game, levelMap, actor)\n  }\n\n  public buildNew(): Tile {\n    return this.tile.clone()\n  }\n\n  protected abstract onTrigger(\n    game: Game,\n    levelMap: LevelMap,\n    actor: Creature\n  ): void\n}\n\nexport class LogMessageTrigger extends TriggerTile {\n  constructor(private message: string, singleUse: boolean = true, tile: Tile) {\n    super(singleUse, tile)\n  }\n\n  protected onTrigger(game: Game): void {\n    game.logger.info(this.message)\n  }\n}\n\n// TODO: Add return type?\nexport abstract class TileVisitor {\n  public onWall(wall: Wall): void {\n    this.default(wall)\n  }\n\n  public onFloor(floor: Floor): void {\n    this.default(floor)\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.onStairway(stairway)\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.onStairway(stairway)\n  }\n\n  public onDoor(door: Door): void {\n    this.default(door)\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    this.default(trigger)\n  }\n\n  public onTrap(trap: Trap): void {\n    this.default(trap)\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    this.default(stairway)\n  }\n\n  protected default(tile: Tile): void {}\n}\n","import { Player } from '../models/player'\nimport { LevelMap } from '../models/level_map'\nimport { Tile } from '../models/tile'\nimport {\n  Game,\n  IdlePresenter,\n  BaseInfoPresenter,\n  EquipmentPresenter,\n  HistoryInfoPresenter,\n  TalentsPresenter,\n} from '../../engine'\n\nexport enum PresenterType {\n  TalentsPicking,\n  Death,\n  Idle,\n  ItemsListing,\n  Missile,\n  ProfessionPicking,\n  Look,\n  Teleportation,\n  PickHandleOption,\n  CharacterInfo,\n}\n\nexport abstract class Presenter {\n  public player: Player\n\n  abstract get type(): PresenterType\n\n  constructor(protected levelMap: LevelMap, protected game: Game) {\n    this.player = this.game.player\n  }\n\n  get tile(): Tile {\n    return this.levelMap.creatureTile(this.player)\n  }\n\n  protected endTurn(): void {\n    this.game.player.ai.endTurn(this.game, this.levelMap)\n  }\n\n  protected redirect(presenter: Presenter): void {\n    this.game.player.ai.redirect(presenter)\n  }\n\n  public goIdle(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n\nexport abstract class BaseMenusPresenter extends Presenter {\n  public goToBaseInfo(): void {\n    this.redirect(new BaseInfoPresenter(this.levelMap, this.game))\n  }\n\n  public goToInventory(): void {\n    this.redirect(new EquipmentPresenter(this.levelMap, this.game))\n  }\n\n  public goToHistoryInfo(): void {\n    this.redirect(new HistoryInfoPresenter(this.levelMap, this.game))\n  }\n\n  public goToTalents(): void {\n    this.redirect(new TalentsPresenter(this.levelMap, this.game))\n  }\n}\n","import { includes, intersection, random, sum, sumBy, times } from 'lodash'\nimport { DamageType, ProtectionType } from '../../engine'\nimport { Protection } from '../models/item'\nimport { Resistance, Critical } from '../models/specie'\nimport { Damage, Dice } from './damage'\n\nexport type DamageOrResist = { damage: number; resist: boolean }\n\nexport class Calculator {\n  private constructor() {}\n\n  public static withCritical(\n    damages: Damage[],\n    { chance, multiplier }: Critical\n  ): Damage[] {\n    if (Math.random() > chance) {\n      return damages\n    }\n\n    return damages.map(\n      ({ type, dice: { times, max }, extra }): Damage => {\n        return {\n          type,\n          dice: { times, max: max * multiplier },\n          extra: extra * multiplier,\n        }\n      }\n    )\n  }\n\n  public static misses(attackerBC: number, victimBC: number): boolean {\n    return (\n      Math.random() > attackerBC / (attackerBC + Math.pow(victimBC * 0.25, 0.8))\n    )\n  }\n\n  // Random with luck based align to get low value\n  public static lowerWeight(max: number, min: number = 1): number {\n    let count = 0\n\n    for (let i = min; i < max; i++) {\n      if (this.chance(1, 3)) {\n        count += 1\n      }\n    }\n\n    return Math.max(1, count)\n  }\n  // Random with luck based align to get high value\n  public static higherWeight(max: number, min: number = 1): number {\n    return max + min - this.lowerWeight(max, min)\n  }\n\n  public static chance(hit: number, of: number): boolean {\n    return random(1, of) <= hit\n  }\n\n  // Function result varies from 0 to 1. Ratio defines the speed of growing.\n  // E.g. dodges(10, 1) = 0.93\n  //      dodges(10, 5) = 0.7\n  public static dodges(actorBC: number, ratio: number): boolean {\n    return Math.random() < (Math.atan(actorBC / ratio) / Math.PI) * 2\n  }\n\n  public static damage(\n    damages: Damage[],\n    protectionTypes: Protection[],\n    victimResistances: Resistance[]\n  ): DamageOrResist {\n    if (\n      damages.every(({ type, resistances }) =>\n        this.resistTo(type, resistances, victimResistances)\n      )\n    ) {\n      return { damage: 0, resist: true }\n    }\n\n    const damage = sumBy(\n      damages,\n      ({ extra, dice, type, resistances }): number => {\n        if (this.resistTo(type, resistances, victimResistances)) {\n          return 0\n        }\n\n        return Math.floor(\n          Math.max(\n            0,\n            extra +\n              this.dropDice(dice) -\n              this.protectionValue(type, protectionTypes)\n          )\n        )\n      }\n    )\n\n    return { damage, resist: false }\n  }\n\n  protected static resistTo(\n    damageType: DamageType,\n    resistances: Resistance[] | undefined,\n    victimResistances: Resistance[]\n  ): boolean {\n    if (resistances && intersection(victimResistances, resistances).length) {\n      return true\n    }\n\n    switch (damageType) {\n      case DamageType.Melee:\n      case DamageType.Pierce:\n      case DamageType.Blunt:\n        return includes(victimResistances, Resistance.Intangible)\n      case DamageType.Magic:\n        return includes(victimResistances, Resistance.MagicDamage)\n      case DamageType.Pure:\n        return false\n    }\n  }\n\n  protected static dropDice(dice: Dice): number {\n    return sum(times(dice.times, () => random(1, dice.max)))\n  }\n\n  protected static protectionValue(\n    damageType: DamageType,\n    protections: Protection[]\n  ): number {\n    return sum(\n      protections.map(\n        ({ type, value }: Protection): number =>\n          value * this.armorToDamageRatio(damageType, type)\n      )\n    )\n  }\n\n  protected static armorToDamageRatio = (\n    damageType: DamageType,\n    armorType: ProtectionType\n  ): number => {\n    switch (damageType) {\n      case DamageType.Melee:\n        switch (armorType) {\n          case ProtectionType.Medium:\n            return 2 / 3\n          case ProtectionType.Solid:\n            return 4 / 3\n          default:\n            return 1\n        }\n      case DamageType.Pierce:\n        switch (armorType) {\n          case ProtectionType.Light:\n            return 1 / 2\n          case ProtectionType.Medium:\n            return 4 / 3\n          case ProtectionType.Solid:\n            return 3\n          case ProtectionType.Unarmored:\n            return 3 / 4\n          default:\n            return 1\n        }\n      case DamageType.Blunt:\n        switch (armorType) {\n          case ProtectionType.Medium:\n            return 2\n          case ProtectionType.Solid:\n            return 1 / 2\n          case ProtectionType.Unarmored:\n            return 1 / 2\n          default:\n            return 1\n        }\n      case DamageType.Magic:\n        switch (armorType) {\n          case ProtectionType.Light:\n            return 5 / 4\n          case ProtectionType.Medium:\n            return 3 / 4\n          case ProtectionType.Heavy:\n            return 1 / 2\n          case ProtectionType.Solid:\n            return 3\n          default:\n            return 1\n        }\n      case DamageType.Pure:\n        return 0\n      default:\n        throw 'Got unknown type of damage!'\n    }\n  }\n}\n","import { Player } from './player'\nimport { CreatureSpecie } from './specie'\n\nimport { Game } from './game'\nimport { Damage } from '../lib/damage'\nimport { ImpactType } from '../lib/impact'\nimport { Material, WaterAffect } from '../lib/material'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnHead,\n  WearsOnBody,\n  Ring,\n  Amulet,\n  Throw,\n  Shoot,\n  Boots,\n  Tool,\n  Belt,\n  Gloves,\n  Gauntlets,\n  Cloak,\n  Scroll,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n  Potion,\n  MissileWeapon,\n  Boots,\n  Scrolls,\n  Hat,\n}\n\nexport enum ItemSubgroup {\n  MissileRock,\n  Sling,\n\n  Bow,\n  Arrows,\n}\n\nexport type ItemId = number\n\nexport enum CorrosionLevel {\n  None,\n  Slightly,\n  Mostly,\n  Fully,\n}\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n\n  public impacts: ImpactType[] = []\n  public corrosionLevel: CorrosionLevel = CorrosionLevel.None\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public weight: number,\n    public material: Material,\n    public readonly usages: Usage[] = [],\n    public id: ItemId = Item.getId()\n  ) {}\n\n  // TODO: Recalculate stats on corrosion\n  public corrode(): boolean {\n    switch (this.corrosionLevel) {\n      case CorrosionLevel.None:\n        this.corrosionLevel = CorrosionLevel.Slightly\n        return true\n      case CorrosionLevel.Slightly:\n        this.corrosionLevel = CorrosionLevel.Mostly\n        return true\n      case CorrosionLevel.Mostly:\n        this.corrosionLevel = CorrosionLevel.Fully\n        return true\n    }\n\n    return false\n  }\n\n  get affectedWithWater(): boolean {\n    return this.material.affectedWithWater !== undefined\n  }\n\n  get firm(): boolean {\n    return this.material.firm\n  }\n\n  get insulator(): boolean {\n    return this.material.insulator\n  }\n\n  get canSeeDetails(): boolean {\n    return true\n  }\n\n  public clone(): Item {\n    return new Item(this.group, this.name, this.weight, this.material)\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.name === item.name\n  }\n\n  public worksWith(item: Item): boolean {\n    return false\n  }\n\n  public canThrow(player: Player): boolean {\n    return true\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: CreatureSpecie) {\n    super(\n      ItemGroup.Consumable,\n      `${specie.name}'s corpse`,\n      specie.weight,\n      specie.material\n    )\n  }\n}\n\nexport abstract class Potion extends Item {\n  constructor(public name: string, material: Material = Material.glass) {\n    super(ItemGroup.Potion, name, 0.2, material)\n  }\n\n  abstract onDrink(game: Game): void\n}\n\nexport abstract class Weapon extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    material: Material,\n    protected rawDamages: Damage[],\n    usages: Usage[]\n  ) {\n    super(group, name, weight, material, usages)\n  }\n\n  get damages(): Damage[] {\n    switch (this.corrosionLevel) {\n      case CorrosionLevel.Slightly:\n        return this.damageWithCorrosion(1)\n      case CorrosionLevel.Mostly:\n        return this.damageWithCorrosion(2)\n      case CorrosionLevel.Fully:\n        return this.damageWithCorrosion(4)\n      default:\n        return this.rawDamages\n    }\n  }\n\n  protected damageWithCorrosion(penalty: number): Damage[] {\n    return this.rawDamages.map(({ dice, type, extra }: Damage) => {\n      return { dice, type, extra: extra - penalty }\n    })\n  }\n}\n\nexport abstract class Missile extends Weapon {\n  constructor(\n    name: string,\n    weight: number,\n    damages: Damage[],\n    material: Material\n  ) {\n    super(ItemGroup.Missile, name, weight, material, damages, [])\n  }\n}\n\nexport abstract class MissileWeapon extends Weapon {\n  constructor(\n    name: string,\n    weight: number,\n    damages: Damage[],\n    material: Material\n  ) {\n    super(ItemGroup.MissileWeapon, name, weight, material, damages, [\n      Usage.Shoot,\n    ])\n  }\n}\n\nexport class OneHandWeapon extends Weapon {\n  constructor(\n    name: string,\n    weight: number,\n    material: Material,\n    damages: Damage[]\n  ) {\n    super(ItemGroup.OneHandWeapon, name, weight, material, damages, [\n      Usage.WeaponOneHand,\n    ])\n  }\n}\n\nexport enum ProtectionType {\n  Light,\n  Medium,\n  Heavy,\n  Solid,\n  Unarmored,\n}\n\nexport type Protection = {\n  type: ProtectionType\n  value: number\n}\n\nexport abstract class Armor extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    material: Material,\n    protected readonly rawProtections: Protection[],\n    usage: Usage\n  ) {\n    super(group, name, weight, material, [usage])\n  }\n\n  get protections(): Protection[] {\n    switch (this.corrosionLevel) {\n      case CorrosionLevel.Slightly:\n        return this.protectionWithCorrosion(1)\n      case CorrosionLevel.Mostly:\n        return this.protectionWithCorrosion(2)\n      case CorrosionLevel.Fully:\n        return this.protectionWithCorrosion(4)\n      default:\n        return this.rawProtections\n    }\n  }\n\n  protected protectionWithCorrosion(penalty: number): Protection[] {\n    return this.rawProtections.map(({ type, value }: Protection) => {\n      return { type, value: value - penalty }\n    })\n  }\n}\n\nexport class BodyArmor extends Armor {\n  constructor(\n    name: string,\n    weight: number,\n    material: Material,\n    protections: Protection[]\n  ) {\n    super(\n      ItemGroup.BodyArmor,\n      name,\n      weight,\n      material,\n      protections,\n      Usage.WearsOnBody\n    )\n  }\n}\n\nexport class Boots extends Armor {\n  constructor(\n    name: string,\n    weight: number,\n    material: Material,\n    protections: Protection[]\n  ) {\n    super(ItemGroup.Boots, name, weight, material, protections, Usage.Boots)\n  }\n}\n\nexport class Hat extends Armor {\n  constructor(\n    name: string,\n    weight: number,\n    material: Material,\n    protections: Protection[]\n  ) {\n    super(ItemGroup.Hat, name, weight, material, protections, Usage.WearsOnHead)\n  }\n}\n\nexport class Scroll extends Item {\n  constructor(name: string) {\n    super(ItemGroup.Scrolls, name, 0.1, Material.paper, [Usage.Scroll])\n  }\n}\n","export enum WaterAffect {\n  Corrosion,\n  Destroy,\n}\n\nexport interface Material {\n  readonly affectedWithWater?: WaterAffect\n  readonly firm: boolean\n  readonly fragile: boolean\n  readonly insulator: boolean\n}\n\nexport namespace Material {\n  export const cloth: Material = {\n    affectedWithWater: undefined,\n    firm: false,\n    fragile: false,\n    insulator: false,\n  }\n\n  export const flesh: Material = {\n    affectedWithWater: undefined,\n    firm: true,\n    fragile: false,\n    insulator: true,\n  }\n\n  export const glass: Material = {\n    affectedWithWater: undefined,\n    firm: false,\n    fragile: true,\n    insulator: false,\n  }\n\n  export const iron: Material = {\n    affectedWithWater: WaterAffect.Corrosion,\n    firm: true,\n    fragile: false,\n    insulator: true,\n  }\n\n  export const leather: Material = {\n    affectedWithWater: undefined,\n    firm: false,\n    fragile: false,\n    insulator: false,\n  }\n\n  export const paper: Material = {\n    affectedWithWater: WaterAffect.Destroy,\n    firm: false,\n    fragile: false,\n    insulator: true,\n  }\n\n  export const stone: Material = {\n    affectedWithWater: undefined,\n    firm: true,\n    fragile: false,\n    insulator: true,\n  }\n\n  export const wood: Material = {\n    affectedWithWater: undefined,\n    firm: true,\n    fragile: false,\n    insulator: true,\n  }\n}\n","import { Point, twoDimArray } from '../utils/utils'\nimport { Creature, Clan } from '../models/creature'\n\nimport { MemoryTile, Memory } from '../models/memory'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { LevelMap, CreatureEvent, leePath } from '../../engine'\n\nexport abstract class AI {\n  public abstract act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined\n\n  protected moveTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.eq(point))\n  }\n\n  protected move(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): CreatureEvent | undefined {\n    const [point] = this.buildPath(actor, levelMap, dest)\n\n    if (point) {\n      return new MoveEvent(game, levelMap, point)\n    }\n  }\n\n  protected buildPath(\n    actor: Creature,\n    levelMap: LevelMap,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): Point[] {\n    return leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      dest\n    )\n  }\n\n  protected withinView(\n    map: Memory,\n    pos: Point,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Point[] = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Creature, enemy: Creature): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan === Clan.FreeForAll || enemy.clan === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan === Clan.Player && enemy.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan === Clan.Player && actor.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination?: Point = undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.foundNewTarget(actor, levelMap) || !this.destination) {\n      return this.checkCurrentTile(actor, levelMap, game)\n    }\n\n    const event = this.goTo(actor, levelMap, game, this.destination)\n    if (event) {\n      return event\n    }\n\n    this.destination = undefined\n    this.onCantMove(actor)\n\n    return\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    point: Point\n  ): CreatureEvent | undefined {\n    return this.moveTo(actor, point, levelMap, game)\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (this.destination && levelMap.creaturePos(actor).eq(this.destination)) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected abstract foundNewTarget(\n    actor: Creature,\n    levelMap: LevelMap\n  ): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return\n  }\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(protected matcher: (tile: MemoryTile) => boolean) {\n    super()\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event = super.checkCurrentTile(actor, levelMap, game)\n\n    if (event) {\n      return event\n    }\n\n    const pos = levelMap.creaturePos(actor)\n    if (this.matcher(actor.stageMemory(levelMap).at(pos.x, pos.y))) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    const path = leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      (point, tile) => this.matcher(tile),\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { Usage, Item, Missile, Weapon } from './item'\nimport { intersection } from 'lodash'\nimport { Inventory } from './inventory'\nimport { GroupedItem } from '../lib/bunch'\nimport { Material } from '../../engine'\n\nexport abstract class InventorySlot<Equipment extends Item = Item> {\n  public name: string = 'InventorySlot'\n\n  constructor(\n    // What kind of items can be put in slot\n    public readonly usages: Usage[],\n    // Has to put only a single item or can put a bunch of them\n    public readonly useSingleItem: boolean,\n    public equipment?: GroupedItem<Equipment>\n  ) {}\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    return inventory.cares().filter(itemGroup => this.match(itemGroup.item))\n  }\n\n  get insulator(): boolean {\n    return !!(this.equipment && this.equipment.item.insulator)\n  }\n\n  get firm(): boolean {\n    return !!(this.equipment && this.equipment.item.firm)\n  }\n\n  public equip(item: Equipment, count: number) {\n    if (this.equipment) {\n      throw `Slot ${this.name} is already equipped with ${this.equipment.item}`\n    }\n\n    this.equipment = { count, item }\n  }\n\n  public takeOff(): void {\n    if (!this.equipment) {\n      throw `Slot ${this.name} has nothing to take off`\n    }\n\n    this.equipment = undefined\n  }\n\n  protected match(item: Item): boolean {\n    return intersection(item.usages, this.usages).length > 0\n  }\n\n  protected withPairItem(\n    baseMatch: GroupedItem<Item>[],\n    item: Item\n  ): GroupedItem<Item>[] {\n    return baseMatch.filter(groupedItem => groupedItem.item.worksWith(item))\n  }\n}\n\nexport abstract class BodyPart<\n  Equipment extends Item = Item\n> extends InventorySlot<Equipment> {\n  public abstract material: Material\n\n  get affectedWithWater(): boolean {\n    return this.material.affectedWithWater !== undefined\n  }\n}\n\nexport class RightHandSlot extends BodyPart<Weapon> {\n  public name: string = 'Правая рука'\n  constructor(public material: Material) {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class LeftHandSlot extends BodyPart<Weapon> {\n  public name: string = 'Левая рука'\n  constructor(public material: Material) {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class HeadSlot extends BodyPart {\n  public name: string = 'Голова'\n  constructor(public material: Material) {\n    super([Usage.WearsOnHead], true)\n  }\n}\n\nexport class ChestSlot extends BodyPart {\n  public name: string = 'Корпус'\n  constructor(public material: Material) {\n    super([Usage.WearsOnBody], true)\n  }\n}\n\nexport class BootsSlot extends BodyPart {\n  public name: string = 'Ботинки'\n  constructor(public material: Material) {\n    super([Usage.Boots], true)\n  }\n}\n\nexport class GlovesSlot extends InventorySlot {\n  public name: string = 'Перчатки'\n  constructor() {\n    super([Usage.Gloves], true)\n  }\n}\n\nexport class GauntletsSlot extends InventorySlot {\n  public name: string = 'Наручи'\n  constructor() {\n    super([Usage.Gauntlets], true)\n  }\n}\n\nexport class BeltSlot extends InventorySlot {\n  public name: string = 'Пояс'\n  constructor() {\n    super([Usage.Belt], true)\n  }\n}\n\nexport class AmuletSlot extends InventorySlot {\n  public name: string = 'Амулет'\n  constructor() {\n    super([Usage.Amulet], true)\n  }\n}\n\nexport class LeftFingerSlot extends InventorySlot {\n  public name: string = 'Левый палец'\n  constructor() {\n    super([Usage.Ring], true)\n  }\n}\n\nexport class RightFingerSlot extends InventorySlot {\n  public name: string = 'Правый палец'\n  constructor() {\n    super([Usage.Ring], true)\n  }\n}\n\nexport class CloakSlot extends InventorySlot {\n  public name: string = 'Плащ'\n  constructor() {\n    super([Usage.Cloak], true)\n  }\n}\n\nexport class MissileWeaponSlot extends InventorySlot<Weapon> {\n  public name: string = 'Метательное'\n  constructor() {\n    super([Usage.Shoot], true)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = super.matchingItems(inventory),\n      missile = inventory.missileSlot.equipment\n\n    if (missile) {\n      return this.withPairItem(baseMatch, missile.item)\n    }\n\n    return baseMatch\n  }\n}\n\nexport class MissileSlot extends InventorySlot<Missile> {\n  public name: string = 'Снаряды'\n  constructor() {\n    super([Usage.Throw], false)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = inventory.cares(),\n      missileWeapon = inventory.missileWeaponSlot.equipment\n\n    if (missileWeapon) {\n      return this.withPairItem(baseMatch, missileWeapon.item)\n    }\n\n    return baseMatch\n  }\n}\n\nexport class ToolsSlot extends InventorySlot {\n  public name: string = 'Инструмент'\n  constructor() {\n    super([Usage.Tool], true)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { TileVisitor, TriggerTile } from '../models/tile'\nimport { Creature, Game, Trap, Point, Reaction } from '../../engine'\nimport { Player } from '../models/player'\n\nclass SteppingTileVisitor extends TileVisitor {\n  public reaction: Reaction = Reaction.NOTHING\n\n  constructor(\n    private pos: Point,\n    private creature: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public onTrap(trap: Trap): void {\n    this.reaction = trap.activate(\n      this.pos,\n      this.game,\n      this.levelMap,\n      this.creature\n    )\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    trigger.activate(this.game, this.levelMap, this.creature)\n  }\n}\n\nexport class MoveEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private nextPoint: Point,\n    private nextLevel: LevelMap = levelMap\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const pos = this.levelMap.creaturePos(actor)\n\n    if (this.nextLevel.name !== this.levelMap.name) {\n      this.levelMap.removeCreature(actor)\n      this.nextLevel.addCreature(this.nextPoint, actor)\n    } else {\n      this.levelMap.at(pos.x, pos.y).creature = undefined\n      this.levelMap.at(this.nextPoint.x, this.nextPoint.y).creature = actor\n    }\n\n    const visitor = new SteppingTileVisitor(\n      this.nextPoint,\n      actor,\n      this.levelMap,\n      this.game\n    )\n    this.nextLevel.at(this.nextPoint.x, this.nextPoint.y).visit(visitor)\n\n    return visitor.reaction\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (this.nextLevel && this.levelMap.name !== this.nextLevel.name) {\n      this.levelMap.reset()\n      this.nextLevel.enter()\n\n      this.affectCreature(player)\n\n      this.game.currentMap = this.nextLevel\n    } else {\n      this.affectCreature(player)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Corpse } from '../models/item'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { AIDieEvent } from '../ai/player_ai'\n\nexport enum DieReason {\n  Attack,\n  Missile,\n  Trap,\n  Overloaded,\n}\n\nexport class DieEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private reason: DieReason\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    let tile = this.levelMap.creatureTile(creature)\n\n    this.levelMap.removeCreature(creature)\n    creature.dead = true\n\n    if (creature.specie.leavesCorpseRatio > Math.random()) {\n      tile.addItem(new Corpse(creature.specie), 1)\n    }\n\n    creature.inventoryItems.forEach(invItem =>\n      tile.addItem(invItem.item, invItem.count)\n    )\n\n    return Reaction.DIE\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    player.ai.pushEvent(new AIDieEvent(this.reason, this.levelMap, this.game))\n    player.dead = true\n    this.game.playerTurn = true\n\n    return Reaction.DIE\n  }\n}\n","import { Fov } from '../utils/fov'\nimport { TileVisitor, Door, Tile } from '../models/tile'\nimport { LevelMap } from '../models/level_map'\nimport { Point } from '../utils/utils'\nimport { Memory } from '../models/memory'\n\nclass VisibilityTileVisitor extends TileVisitor {\n  public visible: boolean = false\n  private x: number | undefined\n  private y: number | undefined\n\n  constructor(private stage: LevelMap, private pos: Point) {\n    super()\n  }\n\n  public isSolid(x: number, y: number): boolean {\n    this.x = x\n    this.y = y\n    this.stage.at(x, y).visit(this)\n    return !this.visible\n  }\n\n  public onDoor(door: Door) {\n    this.default(door)\n    this.visible =\n      this.visible || (this.pos.x === this.x && this.pos.y === this.y)\n  }\n\n  protected default(tile: Tile) {\n    if (this.x && this.y) {\n      this.visible = this.stage.visibleThrough(this.x, this.y)\n    }\n  }\n}\n\nexport const buildFov = function(\n  pos: Point,\n  radius: number,\n  memory: Memory,\n  levelMap: LevelMap\n): void {\n  const see = (x: number, y: number, degree: number): void => {\n    memory.at(x, y).see(levelMap.at(x, y), degree)\n  }\n\n  new Fov(\n    pos.x,\n    pos.y,\n    radius,\n    levelMap.width,\n    levelMap.height,\n    new VisibilityTileVisitor(levelMap, pos),\n    see\n  ).calc()\n}\n","import { includes } from 'lodash'\nimport { Game, GroupedItem, ImpactBunch, LevelMap, Memory } from '../../engine'\nimport { MetaAI } from '../ai/meta_ai'\nimport { AfterEvent } from '../events/after_event'\nimport { CreatureEvent, Reaction } from '../events/internal'\nimport { ItemsBunch } from '../lib/bunch'\nimport { ImpactType } from '../lib/impact'\nimport { buildFov } from '../lib/map_fov'\nimport { HealthStat } from '../lib/stat'\nimport { Item, Missile, Protection } from './item'\nimport { Damage } from '../lib/damage'\nimport { CreatureSpecie, Resistance } from './specie'\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairway,\n  Inventory,\n  Throwing,\n\n  KnockWeaponOut,\n}\n\nexport type CreatureId = number\n\nexport abstract class Creature<Specie extends CreatureSpecie = CreatureSpecie> {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  protected stageMemories: Map<string, Memory> = new Map()\n\n  public dead: boolean = false\n\n  public health: HealthStat\n\n  constructor(public specie: Specie, public id: CreatureId = Creature.getId()) {\n    this.health = new HealthStat(specie)\n  }\n\n  get name(): string {\n    return this.specie.name\n  }\n\n  get clan(): Clan {\n    return this.specie.clan\n  }\n\n  get protections(): Protection[] {\n    return this.specie.protections\n  }\n\n  get throwDamages(): Damage[] {\n    return this.specie.throwingDamages\n  }\n\n  get damages(): Damage[] {\n    return this.specie.damages\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectCreature(this)\n  }\n\n  get speed(): number {\n    return this.specie.moveSpeed\n  }\n\n  public stageMemory(levelMap: LevelMap): Memory {\n    const memory = this.stageMemories.get(levelMap.name)\n\n    if (memory) {\n      return memory\n    }\n\n    return this.visionMask(levelMap)\n  }\n\n  public visionMask(levelMap: LevelMap): Memory {\n    let memory = this.stageMemories.get(levelMap.name)\n\n    if (memory) {\n      memory.resetVisible()\n    } else {\n      memory = new Memory(levelMap.width, levelMap.height)\n\n      this.stageMemories.set(levelMap.name, memory)\n    }\n\n    buildFov(levelMap.creaturePos(this), this.visionRadius, memory, levelMap)\n\n    return memory\n  }\n\n  public abstract act(levelMap: LevelMap, game: Game): number\n\n  private _impactsBunch: ImpactBunch | undefined\n\n  get impactsBunch(): ImpactBunch {\n    if (!this._impactsBunch) {\n      this._impactsBunch = new ImpactBunch()\n    }\n\n    return this._impactsBunch\n  }\n\n  public hasImpact(type: ImpactType): boolean {\n    return includes(this.impacts, type)\n  }\n\n  public addConstImpact(type: ImpactType, effect: string): void {\n    this.impactsBunch.addConstImpact(type, effect)\n  }\n\n  public addImpact(type: ImpactType, turns: number): void {\n    this.impactsBunch.addImpact(type, turns)\n  }\n\n  public removeConstImpact(type: ImpactType, effect: string): void {\n    this.impactsBunch.removeConstImpact(type, effect)\n  }\n\n  public removeImpact(type: ImpactType): void {\n    this.impactsBunch.removeImpact(type)\n  }\n\n  get visionRadius(): number {\n    if (this.hasImpact(ImpactType.Blind)) {\n      return 0\n    }\n\n    return this.specie.visionRadius\n  }\n\n  get bodyControl(): number {\n    return this.specie.bodyControl\n  }\n\n  get impacts(): ImpactType[] {\n    return this.impactsBunch.activeImpacts\n  }\n\n  public hasResistance(resistance: Resistance): boolean {\n    return includes(this.resistances, resistance)\n  }\n\n  get resistances(): Resistance[] {\n    return this.specie.resistances\n  }\n\n  get weightWithCarryings(): number {\n    return this.specie.weight\n  }\n\n  abstract get missile(): GroupedItem<Missile> | undefined\n  abstract get inventoryItems(): GroupedItem<Item>[]\n\n  public abstract addItem(item: Item, count: number): void\n  public abstract removeItem(item: Item, count: number): void\n\n  public statsTurn(): void {\n    this.health.turn()\n\n    if (this._impactsBunch) {\n      // TODO: When ran out - disappear\n      this._impactsBunch.turn()\n    }\n  }\n}\n\nexport class AICreature extends Creature {\n  private bag?: ItemsBunch<Item>\n\n  constructor(\n    public ai: MetaAI,\n    specie: CreatureSpecie,\n    id: CreatureId = Creature.getId()\n  ) {\n    super(specie, id)\n  }\n\n  public act(levelMap: LevelMap, game: Game): number {\n    this.statsTurn()\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n    this.on(new AfterEvent(levelMap, game))\n\n    return this.speed\n  }\n\n  get missile(): GroupedItem<Missile> | undefined {\n    // TODO: Remove perpetuum items?\n    if (this.specie.throwingItem) {\n      return { item: this.specie.throwingItem, count: 1 }\n    }\n  }\n\n  get inventoryItems(): GroupedItem<Item>[] {\n    return this.bag ? this.bag.bunch : []\n  }\n\n  public addItem(item: Item, count: number): void {\n    if (!this.bag) {\n      this.bag = new ItemsBunch()\n    }\n\n    this.bag.put(item, count)\n  }\n\n  public removeItem(item: Item, count: number): void {\n    if (!this.bag) {\n      throw `Creature ${this.name} tried to remove item ${\n        item.name\n      } but it does not present`\n    }\n\n    this.bag.remove(item, count)\n  }\n}\n","import { PresenterType, BaseMenusPresenter } from './internal'\nimport {\n  TalentsPresenter,\n  EquipmentPresenter,\n  BaseInfoPresenter,\n  HistoryInfoPresenter,\n} from '../../engine'\nimport { PlayerSpecie } from '../models/specie'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\n\nexport enum CharacterInfoPage {\n  Base,\n  Talents,\n  Equipment,\n  History,\n}\n\nexport abstract class CharacterInfoPresenter extends BaseMenusPresenter {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n  }\n\n  get type(): PresenterType {\n    return PresenterType.CharacterInfo\n  }\n\n  abstract get page(): CharacterInfoPage\n\n  protected get specie(): PlayerSpecie {\n    return this.game.player.specie\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Creature } from '../models/creature'\nimport { Damage } from '../lib/damage'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { Calculator } from '../lib/calculator'\n\nexport class HurtEvent extends CreatureEvent {\n  private doneDamage: number | undefined\n\n  constructor(\n    private damages: Damage[],\n    private dieReason: DieReason,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  get damage(): number {\n    if (this.doneDamage) {\n      return this.doneDamage\n    } else {\n      throw `HurtEvent.damage called but there is no done damage`\n    }\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    const { damage, resist } = Calculator.damage(\n      this.damages,\n      subject.protections,\n      subject.resistances\n    )\n\n    this.doneDamage = damage\n\n    if (resist) {\n      return Reaction.RESIST\n    }\n\n    if (damage >= subject.health.currentValue) {\n      subject.on(new DieEvent(this.game, this.levelMap, this.dieReason))\n      return Reaction.DIE\n    } else if (damage <= 0) {\n      return Reaction.NOTHING\n    } else {\n      subject.health.decrease(damage)\n      return Reaction.HURT\n    }\n  }\n}\n","import { CreatureSpecie } from '../models/specie'\nimport { Attribute } from './attribute'\n\nexport class Stat {\n  constructor(\n    public base: number,\n    public rate: number = 1,\n    public extra: number = 0\n  ) {}\n\n  get current(): number {\n    return this.base * this.rate - this.extra\n  }\n\n  public add(val: number): void {\n    this.base += val\n  }\n\n  public subtract(val: number): void {\n    this.base -= val\n  }\n}\n\nexport class CapacityLimitStat {\n  private strengthRatio: number = 5\n  private constitutionRatio: number = 3\n  private base: number = 10\n\n  constructor(private strength: number, private constitution: number) {}\n\n  public recalculate(strength: number, constitution: number) {\n    this.strength = strength\n    this.constitution = constitution\n  }\n\n  get stressed(): number {\n    return (\n      this.base +\n      this.strength * this.strengthRatio +\n      this.constitution * this.constitutionRatio\n    )\n  }\n\n  get loadedStart(): number {\n    return this.stressed * 1.5\n  }\n\n  get overloadedStart(): number {\n    return this.loadedStart * 2\n  }\n\n  get flattenedStart(): number {\n    return this.overloadedStart * 3\n  }\n}\n\nexport class HealthStat extends Attribute {\n  private regenerationRate: number\n  private regenerationValue: number\n\n  constructor(\n    specie: CreatureSpecie,\n    private currentTurn = 0,\n    currentValue = specie.maxHealthValue\n  ) {\n    super(specie.maxHealthValue, currentValue)\n\n    this.regenerationRate = specie.regenerationRate\n    this.regenerationValue = specie.regenerationValue\n  }\n\n  public turn(): void {\n    this.currentTurn += 1\n\n    if (this.currentTurn >= this.regenerationRate) {\n      this.currentTurn = 0\n      this.increase(this.regenerationValue)\n    }\n  }\n}\n\nexport class StrengthStat extends Stat {\n  get meleeAdjustment(): number {\n    if (this.current < 5) {\n      return -2\n    } else if (this.current > 10) {\n      return Math.floor((this.current - 10) / 2)\n    } else {\n      return 0\n    }\n  }\n}\n\nexport class ConstitutionStat extends Stat {\n  get levelUpHPBonus(): number {\n    if (this.current < 3) {\n      return -2\n    } else if (this.current < 6) {\n      return -1\n    } else if (this.current < 12) {\n      return 0\n    } else if (this.current < 15) {\n      return 1\n    } else if (this.current < 18) {\n      return 2\n    } else if (this.current < 20) {\n      return 3\n    } else {\n      return 4\n    }\n  }\n}\n\nexport class DexterityStat extends Stat {\n  get bodyControlAdjustment(): number {\n    if (this.current < 5) {\n      return -2\n    } else if (this.current > 10) {\n      return Math.floor((this.current - 10) * 0.9)\n    } else {\n      return 0\n    }\n  }\n\n  get missileAdjustment(): number {\n    if (this.current < 5) {\n      return -2\n    } else if (this.current > 10) {\n      return Math.floor((this.current - 10) / 2)\n    } else {\n      return 0\n    }\n  }\n}\n","import { Creature } from '../models/creature'\nimport { LevelMap, Game } from '../../engine'\nimport { CreatureEvent } from './internal'\n\nexport abstract class VisibleCreatureEvent extends CreatureEvent {\n  constructor(protected levelMap: LevelMap, protected game: Game) {\n    super()\n  }\n\n  protected playerSees(actor: Creature): boolean {\n    let { x, y } = this.levelMap.creaturePos(actor)\n    return this.game.player.stageMemory(this.levelMap).at(x, y).visible\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { LevelMap } from '../models/level_map'\n\nexport class StayEvent extends CreatureEvent {\n  constructor(private levelMap: LevelMap) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    let memory = creature.stageMemory(this.levelMap)\n\n    this.levelMap\n      .creaturePos(creature)\n      .wrappers()\n      .forEach(({ x, y }) => {\n        memory.at(x, y).see(this.levelMap.at(x, y), 0)\n      })\n\n    return Reaction.NOTHING\n  }\n}\n","import { Resistance } from '../models/specie'\n\nexport enum DamageType {\n  Melee,\n  Pierce,\n  Blunt,\n  Magic,\n  Pure,\n}\n\nexport type Dice = {\n  times: number\n  max: number\n}\n\nexport type Damage = {\n  extra: number\n  dice: Dice\n  type: DamageType\n  resistances?: Resistance[]\n}\n","import { Game, GroupedItem, Item, LevelMap } from '../../engine'\nimport { Presenter, PresenterType } from './internal'\n\nexport abstract class ItemsListingPresenter extends Presenter {\n  public positions: GroupedItem<Item>[] = []\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n    this.initPositions()\n  }\n\n  get type(): PresenterType {\n    return PresenterType.ItemsListing\n  }\n\n  abstract get title(): string\n  abstract get singleItemMode(): boolean\n\n  protected abstract initPositions(): void\n\n  public close(): void {\n    this.goIdle()\n  }\n}\n\nexport abstract class SingleItemUseListingPresenter extends ItemsListingPresenter {\n  get singleItemMode(): boolean {\n    return true\n  }\n\n  public abstract withItem(items: GroupedItem<Item>): void\n}\n\nexport abstract class MultipleItemUseListingPresenter extends ItemsListingPresenter {\n  get singleItemMode(): boolean {\n    return false\n  }\n\n  public abstract withItems(items: GroupedItem<Item>[]): void\n}\n","import { ProfessionPicker, Profession, Player, Talent } from '../engine'\nimport { AttackerTwoHandedWeapons, AttackerStrongGrip, DefenderSteelSkin } from './talents'\n\nenum OnisunProfessionId {\n  Attacker,\n  Defender,\n}\n\nexport class OnisunAttackerProfession extends Profession {\n  constructor(\n    level: number = 0,\n    public strongGrip: AttackerStrongGrip = new AttackerStrongGrip(\n      'strongGrip',\n      1,\n      0,\n      5\n    )\n  ) {\n    super(OnisunProfessionId.Attacker, 'warrior', level, 0, [\n      strongGrip,\n    ])\n  }\n\n  get depthCost(): number {\n    return 5\n  }\n\n  get grid(): (Talent | undefined)[][] {\n    return [\n      [undefined, this.strongGrip, undefined],\n    ]\n  }\n}\n\nexport class OnisunDefenderProfession extends Profession {\n  constructor(\n    level: number = 0,\n    public steelSkin: DefenderSteelSkin = new DefenderSteelSkin('steelSkin', 0, 0, 5)\n    ) {\n    super(OnisunProfessionId.Defender, 'defender', level, 0, [\n      steelSkin\n    ])\n  }\n\n  get depthCost(): number {\n    return 5\n  }\n\n  get grid(): (Talent | undefined)[][] {\n    return [[\n      this.steelSkin\n    ]]\n  }\n}\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    public attacker = new OnisunAttackerProfession(),\n    public defender = new OnisunDefenderProfession()\n  ) {\n    super([attacker, defender], 3, 6)\n  }\n}\n","import { AI } from './internal'\nimport { Player } from '../models/player'\nimport { Logger } from '../models/logger'\nimport { Game, ItemsBunch, Item } from '../../engine'\n\nexport abstract class AIEvent {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract run(): void\n}\n\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: ItemsBunch<Item>, game: Game) {\n    super(game)\n  }\n\n  public run(): void {}\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI | undefined = undefined) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n\n  public runEvents(): boolean {\n    let res = false\n    this.events.forEach(event => {\n      res = true\n      event.run()\n    })\n\n    this.resetEvents()\n    return res\n  }\n}\n","import { remove } from 'lodash'\n\ninterface Grouping {\n  groupsWith(item: Grouping): boolean\n}\n\nexport interface GroupedItem<Item> {\n  count: number\n  item: Item\n}\n\nexport class ItemsBunch<Item extends Grouping> {\n  public bunch: GroupedItem<Item>[] = []\n\n  public find(item: Item): GroupedItem<Item> | undefined {\n    return this.bunch.find(invItem => invItem.item.groupsWith(item))\n  }\n\n  public remove(item: Item, count: number): void {\n    const invItem = this.find(item)\n\n    if (invItem === undefined) {\n      // TODO: Fail if removes item that's not in bunch yet?\n      return\n    } else if (invItem.count === count) {\n      remove(this.bunch, inventoryItem =>\n        inventoryItem.item.groupsWith(invItem.item)\n      )\n    } else {\n      invItem.count -= count\n    }\n  }\n\n  public put(item: Item, count: number): void {\n    const invItem = this.bunch.find(inv => inv.item.groupsWith(item))\n\n    if (invItem) {\n      invItem.count += count\n    } else {\n      this.bunch.push({ count: count, item: item })\n    }\n  }\n\n  public clone(): ItemsBunch<Item> {\n    let bunch = new ItemsBunch<Item>()\n\n    this.bunch.forEach(groupedItem => {\n      bunch.put(groupedItem.item, groupedItem.count)\n    })\n\n    return bunch\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { InventorySlot } from '../models/inventory_slot'\nimport { TakeOffItemEvent } from './take_off_item_event'\nimport { Game } from '../models/game'\n\nexport class RemoveItemEvent extends CreatureEvent {\n  constructor(\n    private slot: InventorySlot,\n    private count: number,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (!this.slot.equipment) {\n      throw `RemoveItemEvent: ${this.slot.name} has no equipment`\n    }\n\n    if (this.slot.equipment.count === this.count) {\n      return player.on(new TakeOffItemEvent(this.slot, this.game))\n    } else {\n      this.slot.equipment.count -= this.count\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { LevelMap, Tile, Item } from '../../engine'\nimport { Pool } from './pool'\nimport { Creature } from '../models/creature'\nimport { Point, cycle } from '../utils/utils'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  doorTile: () => Tile,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, doorTile())\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let i = 1; i < level.width - 1; i++) {\n    for (let j = 1; j < level.height - 1; j++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        level.addCreature(new Point(i, j), creaturesPool.pick(null))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null), 1)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\n// TODO: Move away from generators\n// TODO: Do not throw\nexport const withMatchingTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n\nexport const safeWithMatchingTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean\n): { tile: Tile; x: number; y: number } | undefined {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1),\n      tile = level.at(x, y)\n\n    if (match(tile)) {\n      return { tile, x, y }\n    }\n\n    iters--\n  }\n}\n\nexport const withEachTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (tile: Tile, x: number, y: number) => void\n): void {\n  level.each((tile, x, y) => {\n    if (match(tile)) {\n      onValid(tile, x, y)\n    }\n  })\n}\n","import { Missile, Protection } from './item'\nimport { Damage } from '../lib/damage'\nimport { Clan, Ability } from './creature'\nimport { Material } from '../lib/material'\nimport { Gender } from '../lib/gender'\nimport { Race } from '../lib/race'\nimport { Profession } from './profession'\n\nexport enum Resistance {\n  Intangible,\n  MagicDamage,\n  TeleportationControl,\n  Insulator,\n}\n\nexport type Critical = {\n  chance: number\n  multiplier: number\n}\n\nexport interface CreatureSpecie {\n  name: string\n  weight: number\n  clan: Clan\n  abilities: Ability[]\n\n  protections: Protection[]\n  damages: Damage[]\n  bodyControl: number\n\n  throwingItem?: Missile\n  throwingDamages: Damage[]\n\n  maxHealthValue: number\n  regenerationRate: number\n  regenerationValue: number\n\n  resistances: Resistance[]\n\n  visionRadius: number\n  moveSpeed: number\n  attackSpeed: number\n\n  leavesCorpseRatio: number\n\n  material: Material\n\n  critical: Critical\n}\n\nexport enum Color {\n  Maroon = 'maroon',\n  Red = 'red',\n  Orange = 'orange',\n  Yellow = 'yellow',\n  Olive = 'olive',\n  Green = 'green',\n  Purple = 'purple',\n  Fuchsia = 'fuchsia',\n  Lime = 'lime',\n  Teal = 'teal',\n  Aqua = 'aqua',\n  Blue = 'blue',\n  Navy = 'navy',\n  Black = 'black',\n  Gray = 'gray',\n  Silver = 'silver',\n  White = 'white',\n}\n\nexport interface PlayerSpecie extends CreatureSpecie {\n  race: Race\n  gender: Gender\n  height: number\n\n  readonly hairColor: Color\n  readonly eyeColor: Color\n  readonly skinColor: Color\n\n  ownProfession: Profession\n  parentsProfession: Profession\n}\n","import { Race } from '../engine'\n\nexport const humanRace: Race = {\n  name: 'human',\n  primaryAttributes: {\n    strength: 8,\n    dexterity: 8,\n    constitution: 7,\n    intelligence: 7,\n    wisdom: 6,\n    charisma: 9,\n  },\n  experienceRatio: 0.9,\n}\n\nexport const dwarfRace: Race = {\n  name: 'human',\n  primaryAttributes: {\n    strength: 10,\n    dexterity: 7,\n    constitution: 9,\n    intelligence: 5,\n    wisdom: 7,\n    charisma: 7,\n  },\n  experienceRatio: 1,\n}\n\nexport const allRaces: Race[] = [humanRace, dwarfRace]\n","import { remove } from 'lodash'\n\nexport enum ImpactType {\n  Blind,\n  Stressed,\n  Loaded,\n  Overloaded,\n}\n\nclass Impact {\n  private constEffects: string[] = []\n  private tempEffects: number = 0\n\n  constructor() {}\n\n  public addTempEffect(turns: number): void {\n    this.tempEffects += turns\n  }\n\n  public addConstEffect(effect: string): void {\n    // TODO: Validate keys do not repeat\n    this.constEffects.push(effect)\n  }\n\n  public removeTempEffect(): void {\n    this.tempEffects = 0\n  }\n\n  public removeConstEffect(effect: string): void {\n    remove(this.constEffects, impact => impact === effect)\n  }\n\n  public active(): boolean {\n    return this.tempEffects > 0 || this.constEffects.length > 0\n  }\n\n  public turn(): void {\n    if (this.tempEffects >= 1) {\n      this.tempEffects -= 1\n    }\n  }\n}\n\nexport class ImpactBunch {\n  private impacts: Map<ImpactType, Impact> = new Map()\n\n  get activeImpacts(): ImpactType[] {\n    let types: ImpactType[] = []\n\n    this.impacts.forEach((impact, type) => {\n      if (impact.active()) {\n        types.push(type)\n      }\n    })\n\n    return types\n  }\n\n  public addImpact(type: ImpactType, turns: number): void {\n    this.impactByType(type).addTempEffect(turns)\n  }\n\n  public removeImpact(type: ImpactType): void {\n    this.impactByType(type).removeTempEffect()\n  }\n\n  public addConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).addConstEffect(effect)\n  }\n\n  public removeConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).removeConstEffect(effect)\n  }\n\n  public turn(): void {\n    this.impacts.forEach(impact => impact.turn())\n  }\n\n  protected impactByType(type: ImpactType): Impact {\n    let impact = this.impacts.get(type)\n    if (impact !== undefined) {\n      return impact\n    }\n\n    impact = new Impact()\n    this.impacts.set(type, impact)\n    return impact\n  }\n}\n","import { DieEvent, DieReason, Game, ImpactType, LevelMap } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { CreatureEvent, Reaction } from './internal'\n\nexport class AfterEvent extends CreatureEvent {\n  constructor(private levelMap: LevelMap, private game: Game) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    player.removeConstImpact(ImpactType.Overloaded, 'bag')\n    player.removeConstImpact(ImpactType.Stressed, 'bag')\n    player.removeConstImpact(ImpactType.Loaded, 'bag')\n\n    if (player.stuffWeight.current > player.carryingCapacity.flattenedStart) {\n      return player.on(\n        new DieEvent(this.game, this.levelMap, DieReason.Overloaded)\n      )\n    }\n\n    if (player.stuffWeight.current > player.carryingCapacity.overloadedStart) {\n      player.addConstImpact(ImpactType.Overloaded, 'bag')\n    } else if (\n      player.stuffWeight.current > player.carryingCapacity.loadedStart\n    ) {\n      player.addConstImpact(ImpactType.Loaded, 'bag')\n    } else if (player.stuffWeight.current > player.carryingCapacity.stressed) {\n      player.addConstImpact(ImpactType.Stressed, 'bag')\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import {\n  AfterEvent,\n  Game,\n  IdlePresenter,\n  LevelMap,\n  ProfessionPickingPresenter,\n  TalentsPickingPresenter,\n  TeleportationPresenter,\n} from '../../engine'\nimport { DieReason } from '../events/die_event'\nimport { CreatureEvent } from '../events/internal'\nimport { Player } from '../models/player'\nimport { DeathPresenter } from '../presenters/death_presenter'\nimport { Presenter } from '../presenters/internal'\nimport { AIEvent, MetaAI } from './meta_ai'\n\nexport class AINewLevelEvent extends AIEvent {\n  constructor(public level: number, private levelMap: LevelMap, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    if (this.level % 5 === 0) {\n      this.game.player.ai.presenter = new ProfessionPickingPresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    } else {\n      this.game.player.ai.presenter = new TalentsPickingPresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    }\n  }\n}\n\nexport class AIDieEvent extends AIEvent {\n  constructor(\n    private dieReason: DieReason,\n    private levelMap: LevelMap,\n    game: Game\n  ) {\n    super(game)\n  }\n\n  public run(): void {\n    this.game.player.rebuildVision(this.levelMap)\n    this.game.playerTurn = true\n    this.game.player.ai.presenter = new DeathPresenter(\n      this.dieReason,\n      this.levelMap,\n      this.game\n    )\n  }\n}\n\nexport class AITeleportationEvent extends AIEvent {\n  constructor(private levelMap: LevelMap, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    // TODO: Rethink whether should be here\n    this.game.player.rebuildVision(this.levelMap)\n    this.game.playerTurn = true\n    this.game.player.ai.presenter = new TeleportationPresenter(\n      this.levelMap,\n      this.game\n    )\n  }\n}\n\nexport class PlayerAI extends MetaAI {\n  public presenter: Presenter | null = null\n  public levelUps: number = 0\n\n  public act(\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.presenter = new IdlePresenter(levelMap, game)\n    game.playerTurn = true\n\n    return\n  }\n\n  public endTurn(game: Game, levelMap: LevelMap): void {\n    let event = this.events.pop()\n    if (event) {\n      event.run()\n    } else if (game && levelMap) {\n      game.player.on(new AfterEvent(levelMap, game))\n\n      let event = this.events.pop()\n      if (event) {\n        event.run()\n      } else {\n        game.player.ai.runEvents()\n        game.playerTurn = false\n        this.presenter = null\n      }\n    }\n  }\n\n  public redirect(presenter: Presenter): void {\n    this.presenter = presenter\n  }\n}\n\nexport class PlayerBorgAI extends PlayerAI {\n  constructor(private ai: MetaAI) {\n    super()\n  }\n\n  public act(\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event = this.ai.act(player, levelMap, game)\n\n    game.playerTurn = true\n\n    return event\n  }\n}\n","import { PlayerEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Game, AINewLevelEvent, LevelMap } from '../../engine'\n\nexport class AddExperienceEvent extends PlayerEvent {\n  constructor(\n    public actor: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectPlayer(subject: Player): Reaction {\n    subject.level.add(1).forEach(level => {\n      subject.ai.pushEvent(new AINewLevelEvent(level, this.levelMap, this.game))\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { ImpactType } from '../lib/impact'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { CreatureEvent, Reaction } from './internal'\n\nexport class AddImpactEvent extends CreatureEvent {\n  constructor(\n    private impactType: ImpactType,\n    private source: string,\n    private game: Game,\n    private duration?: number\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    // Different messages for player\n    if (this.duration) {\n      creature.addImpact(this.impactType, this.duration)\n    } else {\n      creature.addConstImpact(this.impactType, this.source)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import {\n  InventorySlot,\n  CreatureEvent,\n  Game,\n  Item,\n  Armor,\n  RemoveImpactEvent,\n  Reaction,\n} from '../../engine'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { findIndex } from 'lodash'\nimport { Protection, Weapon } from '../models/item'\n\nexport class TakeOffItemEvent extends CreatureEvent {\n  constructor(private slot: InventorySlot, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const equipment = this.slot.equipment\n\n    if (equipment === undefined) {\n      throw `Can not take off item from ${this.slot.name} - nothing equipped`\n    }\n\n    this.slot.takeOff()\n    this.onTakeOff(player, equipment.item)\n    player.inventory.putToBag(equipment.item, equipment.count)\n    this.game.logger.takeOff(equipment.item)\n\n    return Reaction.NOTHING\n  }\n\n  private onTakeOff(player: Player, item: Item): void {\n    if (item instanceof Armor) {\n      item.protections.forEach((itemProtection: Protection) => {\n        player.itemsProtections.splice(\n          findIndex(\n            player.itemsProtections,\n            protection => protection === itemProtection\n          ),\n          1\n        )\n      })\n    }\n\n    item.impacts.forEach(impact => {\n      player.on(new RemoveImpactEvent(impact, this.game, item.name))\n    })\n  }\n}\n","import { VisibleCreatureEvent } from './visible_creature_event'\nimport { Trap } from '../models/tile'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Calculator } from '../lib/calculator'\nimport { Reaction } from './internal'\n\nexport class TrapEvent extends VisibleCreatureEvent {\n  private dodgeRatio: number\n\n  constructor(\n    private trap: Trap,\n    levelMap: LevelMap,\n    game: Game,\n    private onCreatureDodge: (sees: boolean, isPlayer: boolean) => void,\n    private onCreatureActivated: (sees: boolean, isPlayer: boolean) => Reaction\n  ) {\n    super(levelMap, game)\n    // Calc ratio *before* any interaction with trap\n    this.dodgeRatio = trap.dodgeRatio\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: Special messages for dying.\n    const sees = this.playerSees(actor)\n    if (sees) {\n      this.trap.revealed = true\n    }\n\n    if (this.dodges(actor)) {\n      this.onCreatureDodge(sees, false)\n      return Reaction.DODGE\n    } else {\n      return this.onCreatureActivated(sees, false)\n    }\n  }\n\n  public affectPlayer(actor: Player): Reaction {\n    this.trap.revealed = true\n\n    if (this.dodges(actor)) {\n      this.onCreatureDodge(true, true)\n      return Reaction.DODGE\n    } else {\n      return this.onCreatureActivated(true, true)\n    }\n  }\n\n  protected dodges(actor: Creature): boolean {\n    return Calculator.dodges(actor.bodyControl, this.dodgeRatio)\n  }\n}\n","import {\n  Game,\n  Item,\n  InventorySlot,\n  GroupedItem,\n  PutOnItemsPresenter,\n  PutOnItemEvent,\n  TakeOffItemEvent,\n  LevelMap,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\nimport {\n  CharacterInfoPage,\n  CharacterInfoPresenter,\n} from './character_info_presenter'\n\nexport interface InventoryPresenterPosition {\n  inventorySlot: InventorySlot\n  item?: Item\n  count?: number\n  availableItems: GroupedItem<Item>[]\n}\n\nexport class EquipmentPresenter extends CharacterInfoPresenter {\n  public positions: InventoryPresenterPosition[] = []\n  private takeTime: boolean = false\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n    this.rebuildPositions()\n  }\n\n  get page(): CharacterInfoPage {\n    return CharacterInfoPage.Equipment\n  }\n\n  public takeOff(position: InventoryPresenterPosition) {\n    this.player.on(new TakeOffItemEvent(position.inventorySlot, this.game))\n    this.takeTime = true\n    this.rebuildPositions()\n  }\n\n  public putOn(position: InventoryPresenterPosition) {\n    this.redirect(\n      new PutOnItemsPresenter(\n        itemGroup => {\n          this.player.on(\n            new PutOnItemEvent(\n              position.inventorySlot,\n              itemGroup.item,\n              this.game\n            )\n          )\n\n          this.takeTime = true\n          this.rebuildPositions()\n          this.redirect(this)\n        },\n        position.availableItems,\n        this.levelMap,\n        this.game\n      )\n    )\n  }\n\n  public close() {\n    if (this.takeTime) {\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.levelMap, this.game))\n    }\n  }\n\n  private rebuildPositions(): void {\n    this.positions = this.player.inventory.slots().map(inventorySlot => {\n      return {\n        inventorySlot: inventorySlot,\n        item: inventorySlot.equipment && inventorySlot.equipment.item,\n        count: inventorySlot.equipment && inventorySlot.equipment.count,\n        availableItems: inventorySlot.matchingItems(this.player.inventory),\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Memory, MemoryTile } from '../models/memory'\nimport { Point, Direction } from '../utils/utils'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\n\nexport abstract class PickPointPresenter<Title, Body> extends Presenter {\n  public targetPos: Point\n  protected memory: Memory\n\n  constructor(\n    levelMap: LevelMap,\n    game: Game,\n    private effect: string,\n    private match: (point: Point) => boolean\n  ) {\n    super(levelMap, game)\n\n    this.memory = this.player.stageMemory(this.levelMap)\n    this.targetPos = levelMap.creaturePos(this.player)\n    this.drawTarget()\n  }\n\n  abstract get title(): Title\n\n  abstract get body(): Body[]\n\n  protected abstract close(): void\n\n  public act(): void {\n    this.removeEffect()\n    this.close()\n  }\n\n  get memoryTile(): MemoryTile {\n    return this.memory.at(this.targetPos.x, this.targetPos.y)\n  }\n\n  public moveTarget(direction: Direction): void {\n    const dest = this.targetPos.add(direction)\n\n    if (this.match(dest)) {\n      this.updateTarget(dest)\n    }\n  }\n\n  private removeEffect(): void {\n    this.memory.at(this.targetPos.x, this.targetPos.y).effect = undefined\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.removeEffect()\n    this.targetPos = newPos.copy()\n    this.drawTarget()\n  }\n\n  private drawTarget(): void {\n    this.memoryTile.effect = this.effect\n  }\n}\n","import {\n  MetaAI,\n  Escaper,\n  Explorer,\n  Chaser,\n  Attacker,\n  Picker,\n  Patrol,\n  Loiter,\n  Thrower,\n  Descender,\n  Creature,\n  LevelMap,\n  Game,\n  CreatureEvent,\n  SelfHealer,\n} from '../engine'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  constructor() {\n    super()\n    this.escaper = new Escaper()\n    this.explorer = new Explorer()\n    this.chaser = new Chaser()\n    this.attacker = new Attacker()\n    this.picker = new Picker()\n    this.patrol = new Patrol()\n    this.loiter = new Loiter()\n    this.thrower = new Thrower()\n\n    this.descender = new Descender()\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.runEvents()\n    let event: CreatureEvent | undefined\n\n    if (this.feelsGood(actor)) {\n      if ((event = this.attacker.act(actor, levelMap, game))) {\n      } else if ((event = this.thrower.act(actor, levelMap, game))) {\n      } else if ((event = this.chaser.act(actor, levelMap, game))) {\n      } else if ((event = this.picker.act(actor, levelMap, game))) {\n      } else {\n        event = this.explore(actor, levelMap, game)\n      }\n    } else if (\n      this.healthCritical(actor) &&\n      (event = this.escaper.act(actor, levelMap, game))\n    ) {\n    } else if ((event = this.attacker.act(actor, levelMap, game))) {\n    } else if ((event = this.thrower.act(actor, levelMap, game))) {\n    } else if ((event = this.chaser.act(actor, levelMap, game))) {\n    } else {\n      event = new SelfHealer().act(actor, levelMap)\n    }\n\n    this.resetEvents()\n\n    return event\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return actor.health.currentValue > actor.health.maximum * 0.9\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return actor.health.currentValue < actor.health.maximum / 4\n  }\n\n  private explore(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event: CreatureEvent | undefined\n\n    if ((event = this.explorer.act(actor, levelMap, game))) {\n      if (!actor.dead) {\n        this.patrol.trackMovement(\n          levelMap.creaturePos(actor),\n          levelMap.creatureTile(actor)\n        )\n      }\n    } else if ((event = this.descender.act(actor, levelMap, game))) {\n    } else if ((event = this.patrol.act(actor, levelMap, game))) {\n    } else {\n      event = this.loiter.act(actor, levelMap, game)\n    }\n\n    return event\n  }\n}\n","import {\n  forEach,\n  keys,\n  min,\n  remove,\n  size,\n  pullAt,\n  pickBy,\n  includes,\n} from 'lodash'\n\nexport class Timeline<T> {\n  public step: number = 0\n  public turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      if (!includes(this.turns[ts], item)) {\n        this.turns[ts].push(item)\n      }\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n\n    this.turns = pickBy(this.turns, (val: T[]) => val.length > 0)\n  }\n\n  public next(): T {\n    this.step = this.nextStep()\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element === undefined ? this.next() : element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = this.nextStep()\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n\n  private nextStep(): number {\n    let step = min(keys(this.turns).map(x => parseInt(x)))\n\n    if (step === undefined) {\n      throw 'Timeline.nextStep called when there is no ones turn'\n    }\n\n    return step\n  }\n}\n","import { Talent, Player } from '../engine'\n\nexport abstract class OnisunTalent extends Talent {\n  constructor(name: string, depth: number, rank: number, maxRank: number) {\n    super(name, depth, rank, maxRank)\n  }\n}\n\nexport class AttackerTwoHandedWeapons extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\nexport class AttackerLightWeapons extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\nexport class AttackerHeavyWeapons extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\nexport class AttackerTwoWeapons extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\nexport class AttackerDoubleTwoHandedWeapons extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\nexport class AttackerStrongGrip extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n\n\nexport class DefenderSteelSkin extends OnisunTalent {\n  public onObtain(player: Player): void {}\n}\n","interface SolidChecker {\n  isSolid(x: number, y: number): boolean\n}\n\nexport class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private solidChecker: SolidChecker,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.solidChecker.isSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.solidChecker.isSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (\n            this.solidChecker.isSolid(currentX, currentY) &&\n            distance < this.radius\n          ) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { remove, sum } from 'lodash'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, public current: number = max) {}\n\n  get maximum(): number {\n    return this.max\n  }\n\n  get atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  get currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  get currentValue(): number {\n    const value = super.currentValue\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point, LevelMap } from '../../engine'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Loiter extends AI {\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const pos = levelMap.creaturePos(actor)\n\n    return this.move(actor, levelMap, game, (point: Point) => !pos.eq(point))\n  }\n}\n","import { DieReason } from '../events/die_event'\nimport { Game } from '../models/game'\nimport { Presenter, PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class DeathPresenter extends Presenter {\n  constructor(public dieReason: DieReason, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n  }\n\n  get type(): PresenterType {\n    return PresenterType.Death\n  }\n\n  get playerName(): string {\n    return this.game.player.name\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Tile, GroupedItem, Game } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Item } from '../models/item'\n\nexport class DropItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    this.items.forEach(({ item, count }) => {\n      creature.removeItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    // TODO: Validate items are part of positions\n    this.items.forEach(({ item, count }) => {\n      player.removeItem(item, count)\n      player.stuffWeight.subtract(item.weight * count)\n\n      this.game.logger.droppedItem(item, count)\n      this.tile.addItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { Player } from '../models/player'\nimport { PlayerEvent, Reaction } from './internal'\n\nexport class LevelUpEvent extends PlayerEvent {\n  public affectPlayer(player: Player): Reaction {\n    this.updateHealth(player)\n\n    return Reaction.NOTHING\n  }\n\n  protected updateHealth(player: Player): void {\n    player.health.constantIncrease(player.constitution.levelUpHPBonus)\n\n    if (player.health.maximum < 1) {\n      player.health.constantIncrease(1 - player.health.maximum)\n    }\n\n    // TODO: Add per race / class hp increase\n  }\n}\n","import { Item } from './item'\nimport { Point } from '../utils/utils'\nimport { Memory } from './memory'\n\nexport abstract class TileEffect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightTileEffect extends TileEffect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { HurtEvent, LevelMap, Player } from '../../engine'\nimport { Calculator } from '../lib/calculator'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Item } from '../models/item'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { DieReason } from './die_event'\nimport { CreatureEvent, Reaction } from './internal'\n\nexport class ThrowEvent extends CreatureEvent {\n  constructor(\n    public victim: Creature,\n    public missile: Item,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    return this.process(actor, false)\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const reaction = this.process(player, true)\n\n    if (reaction === Reaction.DIE) {\n      player.on(new AddExperienceEvent(this.victim, this.levelMap, this.game))\n    }\n\n    return reaction\n  }\n\n  protected process(actor: Creature, isPlayer: boolean): Reaction {\n    const [reaction, damage] = this.throw(actor)\n\n    this.game.logger.attackLogger.missile(\n      damage,\n      actor,\n      this.victim,\n      reaction,\n      this.missile,\n      isPlayer\n    )\n\n    return reaction\n  }\n\n  protected throw(actor: Creature): [Reaction, number] {\n    if (Calculator.misses(actor.bodyControl, this.victim.bodyControl)) {\n      return [Reaction.DODGE, 0]\n    }\n\n    // TODO: Check if hit with shooter's BC\n    const hurtEvent = new HurtEvent(\n      Calculator.withCritical(actor.throwDamages, actor.specie.critical),\n      DieReason.Missile,\n      this.levelMap,\n      this.game\n    )\n\n    return [this.victim.on(hurtEvent), hurtEvent.damage]\n  }\n}\n","import { Reaction } from './internal'\nimport { VisibleCreatureEvent } from './visible_creature_event'\nimport { Creature } from '../models/creature'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Door } from '../models/tile'\n\nexport class OpenDoorEvent extends VisibleCreatureEvent {\n  constructor(private door: Door, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    if (this.door.open) {\n      this.game.logger.doorLogger.alreadyOpen()\n    } else {\n      this.door.open = true\n      this.game.logger.doorLogger.open()\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { PlayerEvent, Reaction } from './internal'\nimport { Talent, Profession, TalentStatus } from '../models/profession'\nimport { Player } from '../models/player'\n\nexport class PickTalentEvent extends PlayerEvent {\n  constructor(private profession: Profession, private talent: Talent) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (this.talent.status(this.profession) !== TalentStatus.Available) {\n      throw `Talent ${this.talent.name} for profession ${\n        this.profession.name\n      } can not be upgraded`\n    }\n\n    this.talent.upgrade(player)\n    this.profession.points += 1\n\n    return Reaction.NOTHING\n  }\n}\n","import { Player } from './player'\n\nimport { includes, sample } from 'lodash'\n\nexport enum TalentStatus {\n  Available,\n  Completed,\n  Unavailable,\n}\n\nexport abstract class Talent {\n  constructor(\n    public readonly name: string,\n    public readonly depth: number,\n    public rank: number,\n    public readonly maxRank: number\n  ) {}\n\n  protected abstract onObtain(player: Player): void\n\n  public upgrade(player: Player): void {\n    this.rank += 1\n    this.onObtain(player)\n  }\n\n  public status(profession: Profession): TalentStatus {\n    if (this.rank === this.maxRank) {\n      return TalentStatus.Completed\n    } else if (this.depth * profession.depthCost > profession.points) {\n      return TalentStatus.Unavailable\n    } else {\n      return TalentStatus.Available\n    }\n  }\n}\n\nexport abstract class Profession {\n  abstract get depthCost(): number\n\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1,\n    public points: number = 0,\n    public talents: Talent[]\n  ) {}\n\n  abstract get grid(): (Talent | undefined)[][]\n}\n\nexport class ProfessionPicker {\n  constructor(\n    public pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number\n  ) {}\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n    let pickedProfession: Profession | undefined\n\n    if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(player)\n    } else if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(player)\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    } else if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    return professions\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(\n      profession => profession.level < this.maxLevel\n    )\n  }\n\n  protected updatableProfession(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    return sample(\n      player.professions.filter(profession => {\n        return excludeId !== profession.id\n      })\n    )\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return (\n      player.professions.length < this.maxTaken &&\n      this.pool.length > player.professions.length\n    )\n  }\n\n  protected newFromPool(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    const excluding = player.professions.map(profession => profession.id)\n\n    if (excludeId !== undefined) {\n      excluding.push(excludeId)\n    }\n\n    return sample(\n      this.pool.filter(profession => !includes(excluding, profession.id))\n    )\n  }\n}\n","import { GroupedItem } from '../lib/bunch'\nimport { Calculator } from '../lib/calculator'\nimport { Damage } from '../lib/damage'\nimport { WaterAffect } from '../lib/material'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { BodyPart, InventorySlot } from '../models/inventory_slot'\nimport { Item } from '../models/item'\nimport { LevelMap } from '../models/level_map'\nimport { Player } from '../models/player'\nimport { DieReason } from './die_event'\nimport { HurtEvent } from './hurt_event'\nimport { CreatureEvent, Reaction } from './internal'\nimport { RemoveItemEvent } from './remove_item_event'\n\nexport class WaterDamageEvent extends CreatureEvent {\n  private playerReaction: Reaction = Reaction.NOTHING\n\n  constructor(\n    private damages: Damage[],\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    if (creature.specie.material.affectedWithWater) {\n      return creature.on(\n        new HurtEvent(this.damages, DieReason.Trap, this.levelMap, this.game)\n      )\n    } else {\n      return Reaction.RESIST\n    }\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    this.affectBodyParts(player)\n    this.affectInventory(player)\n    this.affectEquipment(player)\n    return this.playerReaction\n  }\n\n  protected affectEquipment(player: Player): void {\n    if (player.dead) {\n      return\n    }\n\n    player.inventory.slots().forEach((inventorySlot: InventorySlot) => {\n      if (\n        inventorySlot.equipment &&\n        inventorySlot.equipment.item.affectedWithWater\n      ) {\n        const { item, count } = inventorySlot.equipment\n\n        switch (item.material.affectedWithWater) {\n          case WaterAffect.Corrosion:\n            // TODO: Should corrode all items?\n            if (Calculator.chance(1, 3) && item.corrode()) {\n              this.game.logger.itemCorrode(item)\n            }\n            break\n          case WaterAffect.Destroy:\n            if (Calculator.chance(1, 4)) {\n              const destroyedCount = Calculator.lowerWeight(count)\n              this.game.logger.itemDestroyByWater(item, destroyedCount)\n              // TODO: Do not log  taking off item?\n              player.on(\n                new RemoveItemEvent(inventorySlot, destroyedCount, this.game)\n              )\n            }\n            break\n        }\n      }\n    })\n  }\n\n  protected affectInventory(player: Player): void {\n    if (player.dead) {\n      return\n    }\n\n    player.inventory.cares().forEach(({ count, item }: GroupedItem<Item>) => {\n      switch (item.material.affectedWithWater) {\n        case WaterAffect.Corrosion:\n          if (Calculator.chance(1, 4) && item.corrode()) {\n            this.game.logger.itemCorrode(item)\n          }\n          break\n        case WaterAffect.Destroy:\n          if (Calculator.chance(1, 6)) {\n            const destroyedCount = Calculator.lowerWeight(count)\n            this.game.logger.itemDestroyByWater(item, destroyedCount)\n            player.inventory.removeFromBag(item, destroyedCount)\n          }\n          break\n      }\n    })\n  }\n\n  protected affectBodyParts(player: Player): void {\n    player.inventory.bodyParts.forEach((bodyPart: BodyPart) => {\n      if (player.dead) {\n        return\n      }\n\n      if (bodyPart.affectedWithWater) {\n        if (bodyPart.equipment) {\n          this.game.logger.waterBodyPartEquipmentResist(\n            bodyPart,\n            bodyPart.equipment.item\n          )\n          this.trackReaction(Reaction.RESIST)\n        } else {\n          let reaction = player.on(\n            new HurtEvent(\n              this.damages,\n              DieReason.Trap,\n              this.levelMap,\n              this.game\n            )\n          )\n          this.game.logger.waterBodyPartDamage(bodyPart, reaction)\n          this.trackReaction(reaction)\n        }\n      }\n    })\n  }\n\n  protected trackReaction(reaction: Reaction): void {\n    if (this.playerReaction === Reaction.HURT && reaction === Reaction.DIE) {\n      this.playerReaction = Reaction.DIE\n    } else if (this.playerReaction === Reaction.HURT) {\n      this.playerReaction = Reaction.HURT\n    } else {\n      this.playerReaction = reaction\n    }\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from '../utils/utils'\nimport { Timeline } from '../lib/timeline'\nimport { Tile, StairwayDown, StairwayUp } from './tile'\n\nimport { remove } from 'lodash'\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public timeline: Timeline<CreatureId>\n\n  constructor(public readonly name: string, map: Tile[][]) {\n    super(map)\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public enter(): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add(creature.id, creature.speed)\n    )\n  }\n\n  public creatureTile(creature: Creature): Tile {\n    let tile: Tile | undefined\n\n    this.each(t => {\n      if (t.creature && t.creature.id === creature.id) {\n        tile = t\n      }\n    })\n\n    if (!tile) {\n      throw `Creature ${creature.id} ${creature.name} is not found on map ${\n        this.name\n      }`\n    }\n\n    return tile\n  }\n\n  public creaturePos(creature: Creature): Point {\n    let pos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile.creature && tile.creature.id === creature.id) {\n        pos = new Point(x, y)\n      }\n    })\n\n    if (!pos) {\n      throw `Creature ${creature.id} ${creature.name} is not found on map ${\n        this.name\n      }`\n    }\n\n    return pos\n  }\n\n  public addCreature(pos: Point, creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(pos.x, pos.y).creature = creature\n    this.timeline.add(creature.id, creature.speed)\n  }\n\n  public removeCreature(creature: Creature) {\n    let pos = this.creaturePos(creature),\n      tile = this.at(pos.x, pos.y)\n\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove(creature.id)\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public matchStairs(adjustName: string): Point {\n    let stairPos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n        if (tile.adjacentMapName === adjustName) {\n          stairPos = new Point(x, y)\n        }\n      }\n    })\n\n    if (stairPos) {\n      return stairPos\n    }\n\n    throw `LevelMap ${this.name} failed to find stairs to ${adjustName}`\n  }\n}\n","import { Creature } from './creature'\nimport { Item, Potion, CorrosionLevel } from './item'\n\nimport { last } from 'lodash'\nimport { Player } from './player'\nimport { BodyPart } from './inventory_slot'\nimport { Reaction } from '../../engine'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport interface LogMessage {\n  level: LogLevel\n  message: string\n  counter: number\n}\n\n// TODO: Do not display messages while being blind\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public attackLogger: AttackLogger\n  public doorLogger: DoorLogger\n  public trapAirBlow: TrapAirBlowLogger\n  public trapBareWire: TrapBareWireLogger\n  public trapHole: TrapHoleLogger\n  public trapFallingRock: TrapFallingRockLogger\n\n  constructor(player: Player) {\n    this.attackLogger = new AttackLogger(this, player)\n    this.doorLogger = new DoorLogger(this, player)\n\n    this.trapAirBlow = new TrapAirBlowLogger(this, player)\n    this.trapBareWire = new TrapBareWireLogger(this, player)\n    this.trapFallingRock = new TrapFallingRockLogger(this, player)\n    this.trapHole = new TrapHoleLogger(this, player)\n  }\n\n  public reset() {\n    this.messages = []\n  }\n\n  public killMessage(\n    player: Player,\n    damage: number,\n    actor: Creature,\n    target: Creature\n  ) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${\n        actor.name\n      } causes them to die`\n    )\n  }\n\n  public throwKillMessage(\n    player: Player,\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${actor.name} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public ranIntoAnObstacle(): void {\n    this.addMessage(LogLevel.DEBUG, 'You ran into a wall')\n  }\n\n  public howToHandle(): void {\n    this.addMessage(LogLevel.DEBUG, \"Don't know how to handle it\")\n  }\n\n  public noItemsToPickUp(): void {\n    this.addMessage(LogLevel.DEBUG, \"You don't see anything to pick up\")\n  }\n\n  public takeOff(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You took off ${item.name}`)\n  }\n\n  public putOn(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You put on ${item.name}`)\n  }\n\n  public drink(item: Potion): void {\n    this.addMessage(LogLevel.INFO, `You drunk ${item.name}`)\n  }\n\n  public nothingToShotWith(): void {\n    this.addMessage(LogLevel.DEBUG, 'You have nothing to shoot with')\n  }\n\n  public needMissileWeapon(): void {\n    this.addMessage(LogLevel.DEBUG, 'Мне нужен лук или типа того')\n  }\n\n  public creatureTeleported(actor: Creature): void {\n    this.addMessage(LogLevel.INFO, `${actor.name} иcчез`)\n  }\n\n  public creatureNotTeleported(actor: Creature): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `${actor.name} озарился светом, но ничего не произошло`\n    )\n  }\n\n  public creatureDodgesTeleportationTrap(actor: Creature): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `${actor.name} попал в ловушку телепортации но смог увернуться`\n    )\n  }\n\n  public playerTeleportationCaused(): void {\n    this.addMessage(LogLevel.INFO, `Что-то заставило меня телепортироваться`)\n  }\n\n  public playerTeleported(): void {\n    this.addMessage(LogLevel.INFO, `Яркая вспышка и я оказался в другом месте`)\n  }\n\n  public playerNotTeleported(): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `Я озарился ярким светом, но ничего не произошло`\n    )\n  }\n\n  public playerTeleportedWhereTheyWere(): void {\n    this.addMessage(LogLevel.INFO, `Я решил никуда не телепортироваться`)\n  }\n\n  public playerDodgesTeleportationTrap(): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `Я попал в ловушку телепортации но смог увернуться`\n    )\n  }\n\n  public lightTrapActivated(\n    player: Player,\n    sees: boolean,\n    isPlayer: boolean,\n    actor: Creature\n  ): void {\n    if (isPlayer) {\n      this.addMessage(LogLevel.INFO, `Яркая вспышка света ослепила меня`)\n    } else {\n      this.addMessage(\n        LogLevel.INFO,\n        `${actor.name} озарился яркой вспышкой света`\n      )\n    }\n  }\n\n  public lightTrapDodge(\n    player: Player,\n    sees: boolean,\n    isPlayer: boolean,\n    actor: Creature\n  ): void {\n    if (isPlayer) {\n      this.addMessage(LogLevel.INFO, `Вспышка света чуть не ослепила меня`)\n    } else {\n      this.addMessage(\n        LogLevel.INFO,\n        `${actor.name} озарился яркой вспышкой света`\n      )\n    }\n  }\n\n  public canNotUntrap(): void {\n    this.addMessage(LogLevel.INFO, `Не представляю, как это обезвредить`)\n  }\n\n  public failedToUntrap(player: Player): void {\n    this.addMessage(\n      LogLevel.WARNING,\n      `У меня не получилось обезвредить ловушку`\n    )\n  }\n\n  public succeededToUntrap(player: Player): void {\n    this.addMessage(LogLevel.INFO, `Успешно обезвредил ловушку`)\n  }\n\n  public pickedUpItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You picked up ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You picked up ${count} ${item.name}`)\n    }\n  }\n\n  public droppedItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You dropped a ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You dropped ${count} ${item.name}`)\n    }\n  }\n\n  public waterTrapActivated(): void {\n    this.info(`Я попал в ловушку с водой`)\n  }\n\n  public waterBodyPartEquipmentResist(bodyPart: BodyPart, item: Item): void {\n    this.debug(`${item.name} защитил ${bodyPart.name} от воды`)\n  }\n\n  public waterBodyPartDamage(bodyPart: BodyPart, reaction: Reaction): void {\n    switch (reaction) {\n      case Reaction.DIE:\n        this.danger(\n          `Вода попала мне на ${bodyPart.name}, рана не совместима с жизнью`\n        )\n        break\n      case Reaction.HURT:\n        this.danger(`Вода обожгла мне ${bodyPart.name}`)\n        break\n      case Reaction.NOTHING:\n      case Reaction.RESIST:\n        this.danger(`Вода попала мне на ${bodyPart.name}, но все обошлось`)\n        break\n    }\n  }\n\n  public waterTrapDamage(\n    player: Player,\n    sees: boolean,\n    isPlayer: boolean,\n    reaction: Reaction,\n    creature: Creature\n  ): void {\n    if (!sees) {\n      return\n    }\n\n    switch (reaction) {\n      case Reaction.DIE:\n        this.danger(`${creature.name} растворился в потоках воды`)\n        break\n      case Reaction.DODGE:\n        this.info(`${creature.name} уклонился от потока воды`)\n        break\n      case Reaction.HURT:\n        this.warning(`${creature.name} пострадал от воды`)\n        break\n      case Reaction.NOTHING:\n      case Reaction.RESIST:\n        if (!isPlayer) {\n          this.debug(`${creature.name} был облит водой`)\n        }\n        break\n    }\n  }\n\n  public itemCorrode(item: Item): void {\n    switch (item.corrosionLevel) {\n      case CorrosionLevel.Slightly:\n        return this.info(`${item.name} немного заржавел`)\n      case CorrosionLevel.Mostly:\n        return this.info(`${item.name} значительно проржавел`)\n      case CorrosionLevel.Fully:\n        return this.warning(`${item.name} полностью проржавел`)\n    }\n  }\n\n  public itemDestroyByWater(item: Item, count: number): void {\n    this.warning(`${count} ${item.name} были уничтожены водой`)\n  }\n\n  public debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  public info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  public warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  public danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    const lastRow: LogMessage | undefined = last(this.messages)\n\n    if (lastRow && lastRow.message === message) {\n      lastRow.counter += 1\n    } else {\n      this.messages.push({ level, message, counter: 1 })\n    }\n  }\n}\n\nclass SubLogger {\n  constructor(private logger: Logger, protected player: Player) {}\n\n  protected debug(message: string): void {\n    this.logger.debug(message)\n  }\n\n  protected info(message: string): void {\n    this.logger.info(message)\n  }\n\n  protected warning(message: string): void {\n    this.logger.warning(message)\n  }\n\n  protected danger(message: string): void {\n    this.logger.danger(message)\n  }\n}\n\nclass TrapAirBlowLogger extends SubLogger {\n  public dodge(sees: boolean, isPlayer: boolean, creature: Creature): void {\n    if (isPlayer) {\n      this.info(`Я увернулся от потока воздуха`)\n    } else if (sees) {\n      this.info(`${creature.name} увернулся от потока воздуха`)\n    }\n  }\n\n  public resist(sees: boolean, isPlayer: boolean, creature: Creature): void {\n    if (isPlayer) {\n      this.debug('Поток воздуха чуть не снес меня')\n    } else if (sees) {\n      this.debug(`${creature.name} попал в поток воздуха`)\n    }\n  }\n\n  public activate(sees: boolean, isPlayer: boolean, creature: Creature): void {\n    if (isPlayer) {\n      this.info('Меня снесло потоком воздуха')\n    } else if (sees) {\n      this.info(`${creature.name} снесло потоком воздуха`)\n    }\n  }\n\n  public handBlow(item: Item): void {\n    this.warning(`Поток воздуха выбил ${item.name} у меня из руки`)\n  }\n\n  public headBlow(item: Item): void {\n    this.warning(`Поток воздуха снял ${item.name} с моей головы`)\n  }\n}\n\nclass TrapHoleLogger extends SubLogger {\n  public dodge(sees: boolean, isPlayer: boolean, creature: Creature): void {\n    if (isPlayer) {\n      this.warning(`Я чуть не упал в яму`)\n    } else if (sees) {\n      this.warning(`${creature.name} чуть не упал в яму`)\n    }\n  }\n\n  public activated(sees: boolean, isPlayer: boolean, creature: Creature): void {\n    if (isPlayer) {\n      this.warning(`Я упал в яму`)\n    } else if (sees) {\n      this.warning(`${creature.name} упал в яму`)\n    }\n  }\n\n  public shallowActivated(\n    sees: boolean,\n    isPlayer: boolean,\n    creature: Creature\n  ): void {\n    if (isPlayer) {\n      this.warning(`Я упал в неглубокую яму`)\n    } else if (sees) {\n      this.warning(`${creature.name} упал в неглубокую яму`)\n    }\n  }\n}\n\nclass TrapBareWireLogger extends SubLogger {\n  public activated(\n    sees: boolean,\n    reaction: Reaction,\n    creature: Creature\n  ): void {\n    // TODO: Better messages\n    this.info(`${creature.name} наступил на оголенный провод`)\n  }\n\n  public doNotWant() {\n    this.info('Трогать оголенный провод руками так себе затея')\n  }\n\n  public resist(): void {\n    this.info('Я наступил на оголенный провод, но все обошлось')\n  }\n}\n\nclass TrapFallingRockLogger extends SubLogger {\n  public resist(player: Player): void {\n    // TODO: Different messages when head is firm or item if firm\n    return this.info('Камень упал мне на голову, но каска защитила меня')\n  }\n\n  public ranOut(): void {\n    return this.debug('Громкий щелчок, но ничего не произошло')\n  }\n\n  public dodge(\n    player: Player,\n    sees: boolean,\n    isPlayer: boolean,\n    actor: Creature\n  ): void {\n    this.info(`${actor.name} увернулся от ловушки`)\n  }\n\n  public activate(\n    player: Player,\n    sees: boolean,\n    isPlayer: boolean,\n    reaction: Reaction,\n    actor: Creature\n  ): void {\n    this.info(`${actor.name} попал в ловушку`)\n  }\n}\n\nclass DoorLogger extends SubLogger {\n  public alreadyOpen(): void {\n    this.debug('Door is already open')\n  }\n\n  public alreadyClosed(): void {\n    this.debug('Door is already closed')\n  }\n\n  public open(): void {\n    this.debug('I opened the door')\n  }\n\n  public close(): void {\n    this.debug('I closed the door')\n  }\n}\n\nclass AttackLogger extends SubLogger {\n  public melee(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    reaction: Reaction,\n    isPlayer: boolean\n  ): void {\n    switch (reaction) {\n      case Reaction.HURT:\n        return this.debug(\n          `${target.name} got ${damage} damage from ${actor.name}`\n        )\n      case Reaction.DIE:\n        return this.warning(\n          `${target.name} got ${damage} damage from ${\n            actor.name\n          } causes them to die`\n        )\n      case Reaction.NOTHING:\n        return this.debug(\n          `Удар пришелся по ${actor.name} но остался незамеченным`\n        )\n      //this.addMessage( LogLevel.DEBUG, `${actor.name} ударил по мне, но я не почувствовал боли`)\n      case Reaction.RESIST:\n        return this.info(`${target.name} игнорирует урон`)\n      // this.addMessage(LogLevel.DEBUG, `Я игнорирую урон ${target.name}`)\n      case Reaction.DODGE:\n        return this.debug(`${actor.name} misses ${target.name}!`)\n    }\n  }\n\n  public missile(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    reaction: Reaction,\n    missile: Item,\n    isPlayer: boolean\n  ): void {\n    switch (reaction) {\n      case Reaction.HURT:\n        return this.debug(\n          `${target.name} got ${damage} damage from ${actor.name} by ${\n            missile.name\n          }`\n        )\n      case Reaction.DIE:\n        return this.warning(\n          `${target.name} got ${damage} damage from ${\n            actor.name\n          } causes them to die`\n        )\n      case Reaction.NOTHING:\n        return this.debug(\n          `Удар пришелся по ${actor.name} но остался незамеченным`\n        )\n      //this.addMessage( LogLevel.DEBUG, `${actor.name} ударил по мне, но я не почувствовал боли`)\n      case Reaction.RESIST:\n        return this.info(`${target.name} игнорирует урон`)\n      // this.addMessage(LogLevel.DEBUG, `Я игнорирую урон ${target.name}`)\n      case Reaction.DODGE:\n        return this.debug(\n          `${actor.name} throws ${missile.name} in ${target.name}, but misses!`\n        )\n    }\n  }\n}\n","import { sortBy } from 'lodash'\n\nexport class KillStat {\n  public total: number = 0\n  private stat: Map<string, number> = new Map()\n\n  public add(name: string): void {\n    const current = this.stat.get(name)\n    if (current) {\n      this.stat.set(name, current + 1)\n    } else {\n      this.stat.set(name, 1)\n    }\n  }\n\n  get all(): [string, number][] {\n    return sortBy(Array.from(this.stat), ([name, count]) => name)\n  }\n}\n","import { Trap, Tile, TrapType } from '../tile'\nimport { Player } from '../player'\nimport { LevelMap } from '../level_map'\nimport { Game } from '../game'\nimport { Creature } from '../creature'\nimport { Point, Direction, bresenhamInclusion } from '../../utils/utils'\nimport { Calculator } from '../../lib/calculator'\nimport { TrapEvent } from '../../events/trap_event'\nimport { BodyPart } from '../inventory_slot'\nimport { Item } from '../item'\nimport { RemoveItemEvent } from '../../events/remove_item_event'\nimport { shuffle } from 'lodash'\nimport { MoveEvent } from '../../events/move_event'\nimport { Reaction } from '../../../engine'\n\nexport class AirBlowTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.AirBlow, tile, revealed)\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    if (Calculator.chance(4, 6)) {\n      game.logger.failedToUntrap(player)\n\n      // TODO: Activate on creature on trap or on player\n      if (Calculator.chance(3, 5)) {\n        this.activate(pos, game, levelMap, player)\n      }\n    } else {\n      this.disarmTile(pos, player, levelMap, game)\n    }\n  }\n\n  protected buildNew(): Tile {\n    return new AirBlowTrap(this.tile, this.revealed)\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 6 : 15\n  }\n\n  get creatureWeightBlowThreshold(): number {\n    return 60\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) =>\n          game.logger.trapAirBlow.dodge(sees, isPlayer, creature),\n        (sees, isPlayer) => {\n          // EXTRA: Blow away stuff lying on a trap cell\n          if (\n            creature.weightWithCarryings >= this.creatureWeightBlowThreshold\n          ) {\n            game.logger.trapAirBlow.resist(sees, isPlayer, creature)\n          } else {\n            let newPos = this.randomPos(\n              pos,\n              levelMap,\n              Calculator.higherWeight(3, 1),\n              tile => tile.passibleThrough(creature)\n            )\n            if (newPos.eq(pos)) {\n              game.logger.trapAirBlow.resist(sees, isPlayer, creature)\n            } else {\n              game.logger.trapAirBlow.activate(sees, isPlayer, creature)\n              creature.on(new MoveEvent(game, levelMap, newPos))\n            }\n          }\n\n          if (isPlayer) {\n            const player = game.player,\n              inventory = player.inventory,\n              slots: [BodyPart, number, (item: Item) => void][] = [\n                [\n                  inventory.headSlot,\n                  3,\n                  item => game.logger.trapAirBlow.headBlow(item),\n                ],\n                [\n                  inventory.rightHandSlot,\n                  40 / player.strength.current,\n                  item => game.logger.trapAirBlow.handBlow(item),\n                ],\n                [\n                  inventory.leftHandSlot,\n                  45 / player.strength.current,\n                  item => game.logger.trapAirBlow.handBlow(item),\n                ],\n              ]\n\n            slots.forEach(\n              ([slot, maxChance, logger]: [\n                BodyPart,\n                number,\n                (item: Item) => void\n              ]) => {\n                if (\n                  slot.equipment &&\n                  maxChance >= 3 &&\n                  Calculator.chance(1, Math.round(maxChance))\n                ) {\n                  logger(slot.equipment.item)\n                  this.throwItem(pos, levelMap, slot.equipment.item)\n                  player.on(new RemoveItemEvent(slot, 1, game))\n                }\n              }\n            )\n          }\n\n          return Reaction.NOTHING\n        }\n      )\n    )\n  }\n\n  protected throwItem(pos: Point, levelMap: LevelMap, item: Item): void {\n    let newPos = this.randomPos(\n      pos,\n      levelMap,\n      Calculator.lowerWeight(5, 1),\n      (tile: Tile) => tile.isFloor()\n    )\n    levelMap.at(newPos.x, newPos.y).addItem(item, 1)\n  }\n\n  protected randomPos(\n    origin: Point,\n    levelMap: LevelMap,\n    maxDistance: number,\n    matcher: (tile: Tile) => boolean\n  ): Point {\n    let lastPos = origin,\n      foundPos = false\n\n    shuffle(Direction.all).forEach(direction => {\n      if (!foundPos) {\n        let brokenLos = false\n\n        bresenhamInclusion(\n          origin,\n          origin.add(direction.multiple(maxDistance)),\n          (x, y) => {\n            if (\n              !brokenLos &&\n              levelMap.inRange(new Point(x, y)) &&\n              matcher(levelMap.at(x, y))\n            ) {\n              lastPos = new Point(x, y)\n              foundPos = true\n            } else {\n              brokenLos = true\n            }\n          }\n        )\n      }\n    })\n\n    return lastPos\n  }\n}\n","import { Trap, TrapType, Tile } from '../tile'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Creature } from '../creature'\nimport { Point } from '../../utils/utils'\nimport { Calculator } from '../../lib/calculator'\nimport { Player } from '../player'\nimport { HurtEvent } from '../../events/hurt_event'\nimport { DieReason } from '../../events/die_event'\nimport { Damage, DamageType } from '../../lib/damage'\nimport { VisibleCreatureEvent } from '../../events/visible_creature_event'\nimport { Reaction } from '../../events/internal'\n\nclass BareWireTrapEvent extends VisibleCreatureEvent {\n  constructor(private trap: Trap, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n  }\n\n  get hurtEvent(): HurtEvent {\n    return new HurtEvent(this.damages, DieReason.Trap, this.levelMap, this.game)\n  }\n\n  get damages(): Damage[] {\n    return [{ type: DamageType.Pure, dice: { times: 5, max: 2 }, extra: 5 }]\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    const hurtReaction = creature.on(this.hurtEvent)\n\n    if (this.playerSees(creature)) {\n      this.trap.revealed = true\n    }\n\n    this.game.logger.trapBareWire.activated(\n      this.playerSees(creature),\n      hurtReaction,\n      creature\n    )\n\n    return hurtReaction\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    this.trap.revealed = true\n\n    if (player.inventory.bootsSlot.insulator) {\n      this.game.logger.trapBareWire.resist()\n\n      return Reaction.RESIST\n    } else {\n      const hurtReaction = player.on(this.hurtEvent)\n      this.game.logger.trapBareWire.activated(true, hurtReaction, player)\n\n      return hurtReaction\n    }\n  }\n}\n\nexport class BareWireTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.BareWire, tile, revealed)\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    // TODO: Do stupid thing when has low\n    if (!player.inventory.glovesSlot.insulator) {\n      game.logger.trapBareWire.doNotWant()\n    } else if (Calculator.chance(1, 7)) {\n      game.logger.failedToUntrap(player)\n      // TODO: Activate on both player and creature standing on the trap\n      this.activate(pos, game, levelMap, player)\n    } else {\n      this.disarmTile(pos, player, levelMap, game)\n    }\n  }\n\n  protected buildNew(): Tile {\n    return new BareWireTrap(this.tile, this.revealed)\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 5 : 10\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    if (Calculator.dodges(creature.bodyControl, this.dodgeRatio)) {\n      return Reaction.DODGE\n    }\n\n    return creature.on(new BareWireTrapEvent(this, levelMap, game))\n  }\n}\n","import { Trap, TrapType, Tile } from '../tile'\nimport { Point, TrapEvent, Calculator, Item, Reaction } from '../../../engine'\nimport { Player } from '../player'\nimport { LevelMap } from '../level_map'\nimport { Game } from '../game'\nimport { Creature } from '../creature'\nimport { HurtEvent } from '../../events/hurt_event'\nimport { DieReason } from '../../events/die_event'\nimport { Damage, DamageType } from '../../lib/damage'\nimport { Logger } from '../logger'\n\nexport class FallingRockTrap extends Trap {\n  constructor(\n    private newRock: () => Item,\n    tile: Tile,\n    revealed: boolean = false,\n    public missilesCount = 5\n  ) {\n    super(TrapType.FallingRock, tile, revealed)\n  }\n\n  public buildNew(): Trap {\n    return new FallingRockTrap(\n      this.newRock,\n      this.tile,\n      this.revealed,\n      this.missilesCount\n    )\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 3 : 12\n  }\n\n  get damages(): Damage[] {\n    return [{ type: DamageType.Blunt, extra: 3, dice: { times: 2, max: 5 } }]\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    if (Calculator.chance(1, 4)) {\n      game.logger.failedToUntrap(player)\n\n      const creature = levelMap.at(pos.x, pos.y).creature\n      if (creature) {\n        this.activate(pos, game, levelMap, creature)\n      } else {\n        this.throwMissile(pos, levelMap, game.logger)\n      }\n    } else {\n      this.disarmTile(pos, player, levelMap, game)\n    }\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    if (!this.throwMissile(pos, levelMap, game.logger)) {\n      return Reaction.NOTHING\n    }\n\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) =>\n          game.logger.trapFallingRock.dodge(\n            game.player,\n            sees,\n            isPlayer,\n            creature\n          ),\n        (sees, isPlayer) => {\n          if (isPlayer && game.player.inventory.headSlot.firm) {\n            game.logger.trapFallingRock.resist(game.player)\n            return Reaction.RESIST\n          }\n\n          const res = creature.on(\n            new HurtEvent(this.damages, DieReason.Trap, levelMap, game)\n          )\n\n          game.logger.trapFallingRock.activate(\n            game.player,\n            sees,\n            isPlayer,\n            res,\n            creature\n          )\n\n          return res\n        }\n      )\n    )\n  }\n\n  protected throwMissile(\n    pos: Point,\n    levelMap: LevelMap,\n    logger: Logger\n  ): boolean {\n    if (this.missilesCount <= 0) {\n      logger.trapFallingRock.ranOut()\n      return false\n    }\n\n    this.missilesCount -= 1\n\n    levelMap.at(pos.x, pos.y).addItem(this.newRock(), 1)\n\n    return true\n  }\n}\n","import {\n  Creature,\n  Point,\n  safeWithMatchingTile,\n  TrapEvent,\n  withEachTile,\n} from '../../../engine'\nimport { CreatureEvent, Reaction } from '../../events/internal'\nimport { MoveEvent } from '../../events/move_event'\nimport { StayEvent } from '../../events/stay_event'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Player } from '../player'\nimport { StairwayDown, Tile, Trap, TrapType } from '../tile'\nimport { HurtEvent } from '../../events/hurt_event'\nimport { DamageType } from '../../lib/damage'\nimport { DieReason } from '../../events/die_event'\n\n// Leads to a random tile every time because tile might be taken\n// by another creature next time you are falling down\nexport class HoleTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.Hole, tile, revealed)\n  }\n\n  public buildNew(): Tile {\n    return new HoleTrap(this.tile, this.revealed)\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    game.logger.canNotUntrap()\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 1 : 5\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) =>\n          game.logger.trapHole.dodge(sees, isPlayer, creature),\n        (sees, isPlayer) => {\n          // TODO: Break fragile items\n          let fallEvent = this.fallEvent(game, levelMap)\n\n          if (fallEvent) {\n            game.logger.trapHole.activated(sees, isPlayer, creature)\n\n            creature.on(fallEvent)\n            return creature.on(\n              new HurtEvent(\n                [\n                  {\n                    type: DamageType.Pure,\n                    dice: { times: 3, max: 2 },\n                    extra: 2,\n                  },\n                ],\n                DieReason.Trap,\n                levelMap,\n                game\n              )\n            )\n          } else {\n            game.logger.trapHole.shallowActivated(sees, isPlayer, creature)\n\n            return creature.on(new StayEvent(levelMap))\n          }\n        }\n      )\n    )\n  }\n\n  private fallEvent(game: Game, levelMap: LevelMap): CreatureEvent | undefined {\n    let event = undefined\n\n    withEachTile(\n      levelMap,\n      () => true,\n      tile => {\n        if (tile instanceof StairwayDown) {\n          let downLevelMap = game.getMap(tile.adjacentMapName),\n            downPos = undefined\n\n          downPos = safeWithMatchingTile(downLevelMap, tile =>\n            tile.passibleThrough()\n          )\n\n          if (downPos) {\n            event = new MoveEvent(\n              game,\n              levelMap,\n              new Point(downPos.x, downPos.y),\n              downLevelMap\n            )\n          }\n        }\n      }\n    )\n\n    return event\n  }\n}\n","import { Trap, TrapType, Tile } from '../tile'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Creature } from '../creature'\nimport { TrapEvent } from '../../events/trap_event'\nimport { Point } from '../../utils/utils'\nimport { AddImpactEvent } from '../../events/add_impact_event'\nimport { ImpactType } from '../../lib/impact'\nimport { Calculator } from '../../lib/calculator'\nimport { Player } from '../player'\nimport { Reaction } from '../../../engine'\n\nexport class LightTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.Light, tile, revealed)\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    if (Calculator.chance(1, 3)) {\n      game.logger.failedToUntrap(player)\n      // TODO: Activate on creature on trap or on player\n      this.activate(pos, game, levelMap, player)\n    } else {\n      this.disarmTile(pos, player, levelMap, game)\n    }\n  }\n\n  protected buildNew(): Tile {\n    return new LightTrap(this.tile, this.revealed)\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 1 : 10\n  }\n\n  get duration(): number {\n    return 10\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) =>\n          game.logger.lightTrapDodge(game.player, sees, isPlayer, creature),\n        (sees, isPlayer) => {\n          // TODO: If player sees a creature log a message nevertheless\n          if (creature.hasImpact(ImpactType.Blind)) {\n            return Reaction.NOTHING\n          }\n\n          game.logger.lightTrapActivated(game.player, sees, isPlayer, creature)\n\n          return creature.on(\n            new AddImpactEvent(ImpactType.Blind, 'trap', game, this.duration)\n          )\n        }\n      )\n    )\n  }\n}\n","import { Point, TeleportationEvent, TrapEvent, Reaction } from '../../../engine'\nimport { Creature } from '../creature'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Player } from '../player'\nimport { Tile, Trap, TrapType } from '../tile'\n\nexport class TeleportationTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.Teleportation, tile, revealed)\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    game.logger.canNotUntrap()\n  }\n\n  protected buildNew(): Tile {\n    return new TeleportationTrap(this.tile, this.revealed)\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 3 : 10\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) => {\n          if (isPlayer) {\n            game.logger.playerDodgesTeleportationTrap()\n          } else if (sees) {\n            game.logger.creatureDodgesTeleportationTrap(creature)\n          }\n        },\n        (sees, isPlayer) => {\n          return creature.on(new TeleportationEvent(levelMap, game, false))\n        }\n      )\n    )\n  }\n}\n","import { Trap, TrapType, Tile } from '../tile'\nimport { Point, TrapEvent, Calculator, Reaction } from '../../../engine'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Creature } from '../creature'\nimport { Player } from '../player'\nimport { DamageType, Damage } from '../../lib/damage'\nimport { WaterDamageEvent } from '../../events/water_damage_event'\n\nexport class WaterTrap extends Trap {\n  constructor(tile: Tile, revealed: boolean = false) {\n    super(TrapType.Water, tile, revealed)\n  }\n\n  public buildNew(): Trap {\n    return new WaterTrap(this.tile, this.revealed)\n  }\n\n  get dodgeRatio(): number {\n    return this.revealed ? 10 : 8\n  }\n\n  get damages(): Damage[] {\n    return [{ type: DamageType.Pure, extra: 5, dice: { times: 2, max: 2 } }]\n  }\n\n  public untrap(\n    pos: Point,\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): void {\n    if (Calculator.chance(3, 4)) {\n      game.logger.failedToUntrap(player)\n\n      // TODO: Activate on creature on trap or on player\n      if (Calculator.chance(1, 4)) {\n        this.activate(pos, game, levelMap, player)\n      }\n    } else {\n      this.disarmTile(pos, player, levelMap, game)\n    }\n  }\n\n  public activate(\n    pos: Point,\n    game: Game,\n    levelMap: LevelMap,\n    creature: Creature\n  ): Reaction {\n    return creature.on(\n      new TrapEvent(\n        this,\n        levelMap,\n        game,\n        (sees, isPlayer) =>\n          game.logger.waterTrapDamage(\n            game.player,\n            sees,\n            isPlayer,\n            Reaction.DODGE,\n            creature\n          ),\n        (sees, isPlayer) => {\n          if (isPlayer) {\n            game.logger.waterTrapActivated()\n          }\n\n          let reaction = creature.on(\n            new WaterDamageEvent(this.damages, levelMap, game)\n          )\n\n          if (!isPlayer) {\n            game.logger.waterTrapDamage(\n              game.player,\n              sees,\n              isPlayer,\n              reaction,\n              creature\n            )\n          }\n\n          return reaction\n        }\n      )\n    )\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\n\nexport class PickSingleOptionPresenter<Option> extends Presenter {\n  constructor(\n    public options: Option[],\n    levelMap: LevelMap,\n    game: Game,\n    private withOption: (option: Option) => void\n  ) {\n    super(levelMap, game)\n  }\n\n  get type(): PresenterType {\n    return PresenterType.PickHandleOption\n  }\n\n  public pick(option: Option): void {\n    this.withOption(option)\n  }\n\n  public close(): void {\n    this.goIdle()\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Game, LevelMap, Talent } from '../../engine'\nimport { Profession } from '../models/profession'\nimport { LevelUpEvent } from '../events/level_up_event'\nimport { TalentsPresenter } from './talents_presenter'\nimport { PickTalentEvent } from '../events/pick_talent_event'\n\nexport class TalentsPickingPresenter extends Presenter {\n  public readonly talentsPage: TalentsPresenter\n\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n\n    this.talentsPage = new TalentsPresenter(levelMap, game)\n  }\n\n  get type(): PresenterType {\n    return PresenterType.TalentsPicking\n  }\n\n  public pickTalent(profession: Profession, talent: Talent): void {\n    this.player.on(new PickTalentEvent(profession, talent))\n    this.player.on(new LevelUpEvent())\n\n    this.endTurn()\n  }\n}\n","import {\n  CharacterInfoPresenter,\n  CharacterInfoPage,\n} from './character_info_presenter'\nimport { Profession } from '../models/profession'\n\nexport class TalentsPresenter extends CharacterInfoPresenter {\n  get page(): CharacterInfoPage {\n    return CharacterInfoPage.Talents\n  }\n\n  get professions(): Profession[] {\n    return this.player.professions\n  }\n}\n","import {\n  BodyArmor,\n  Boots,\n  DamageType,\n  ImpactType,\n  Item,\n  Missile,\n  MissileWeapon,\n  OneHandWeapon,\n  Player,\n  Pool,\n  ProtectionType,\n} from '../engine'\nimport { HealPotion } from './potions'\nimport { Material } from '../engine/lib/material'\n\nclass MissileRock extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Sling\n  }\n}\n\nclass Arrow extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Bow\n  }\n\n  public canThrow(player: Player): boolean {\n    return !!player.inventory.missileWeaponSlot.equipment\n  }\n}\n\nclass Sling extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof MissileRock\n  }\n}\n\nclass Bow extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof Arrow\n  }\n}\n\nexport const commonBow = () =>\n  new Bow(\n    'Обычный лук',\n    1,\n    [{ type: DamageType.Pierce, dice: { times: 1, max: 3 }, extra: 3 }],\n    Material.wood\n  )\n\nexport const smallRock = () =>\n  new MissileRock(\n    'Маленький камень',\n    0.3,\n    [{ type: DamageType.Blunt, dice: { times: 1, max: 3 }, extra: 2 }],\n    Material.stone\n  )\n\nexport const woodenArrow = () =>\n  new Arrow(\n    'Деревянная стрела',\n    0.2,\n    [{ type: DamageType.Pierce, dice: { times: 1, max: 4 }, extra: 3 }],\n    Material.wood\n  )\nexport const ironArrow = () =>\n  new Arrow(\n    'Железная стрела',\n    0.25,\n    [{ type: DamageType.Pierce, dice: { times: 2, max: 3 }, extra: 3 }],\n    Material.iron\n  )\n\nexport const weapons = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new OneHandWeapon('Катана', 1, Material.iron, [\n        { type: DamageType.Melee, dice: { times: 5, max: 2 }, extra: 0 },\n      ]),\n  ],\n  [\n    7,\n    () =>\n      new OneHandWeapon('Кинжал', 0.8, Material.iron, [\n        { type: DamageType.Melee, dice: { times: 1, max: 3 }, extra: 2 },\n      ]),\n  ],\n])\n\nexport const itemsPool = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new BodyArmor('Кольчуга', 5, Material.iron, [\n        { type: ProtectionType.Medium, value: 3 },\n      ]),\n  ],\n  [\n    5,\n    () =>\n      new BodyArmor('Латы', 3, Material.iron, [\n        { type: ProtectionType.Heavy, value: 5 },\n      ]),\n  ],\n  [\n    10,\n    () =>\n      new BodyArmor('Роба', 1, Material.iron, [\n        { type: ProtectionType.Unarmored, value: 1 },\n      ]),\n  ],\n  [100, () => new HealPotion()],\n])\n\nexport class LightSpeedBoots extends Boots {\n  public impacts: ImpactType[] = [ImpactType.Blind]\n\n  constructor() {\n    super('Кроссовки скорости света', 0.1, Material.cloth, [])\n  }\n}\n","import { Game, Potion } from '../engine'\n\nexport class HealPotion extends Potion {\n  constructor() {\n    super('Зелье лечения')\n  }\n\n  public onDrink(game: Game) {\n    game.player.health.increase(5)\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Point, bresenhamInclusion, Direction } from '../utils/utils'\nimport { Memory } from '../models/memory'\nimport { IdlePresenter } from './idle_presenter'\nimport { MissileAttackEvent, Game, LevelMap } from '../../engine'\n\nexport class MissilePresenter extends Presenter {\n  public targetPos: Point\n  private memory: Memory\n  private targetEnemyIndex: number | undefined = undefined\n  private enemies: Point[] = []\n  private path: Point[] = []\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n\n    this.findEnemies()\n    this.memory = this.player.stageMemory(this.levelMap)\n    this.targetPos = this.resetTargetId()\n  }\n\n  get type(): PresenterType {\n    return PresenterType.Missile\n  }\n\n  public nextTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex += 1\n\n    if (this.targetEnemyIndex >= this.enemies.length) {\n      this.targetEnemyIndex = 0\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public previousTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex -= 1\n\n    if (this.targetEnemyIndex < 0) {\n      this.targetEnemyIndex = this.enemies.length - 1\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public moveTarget(direction: Direction): void {\n    const dest = this.targetPos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (\n      tile.visibleThrough() &&\n      this.player.stageMemory(this.levelMap).at(dest.x, dest.y).visible\n    ) {\n      this.updateTarget(dest)\n      this.targetEnemyIndex = undefined\n    }\n  }\n\n  public attack(): void {\n    if (!this.targetPos.eq(this.levelMap.creaturePos(this.player))) {\n      this.player.on(\n        new MissileAttackEvent(this.path, this.game, this.levelMap, () =>\n          this.endTurn()\n        )\n      )\n    }\n  }\n\n  public close(): void {\n    this.resetPath()\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n\n  private resetTargetId(): Point {\n    let point: Point\n\n    if (this.enemies.length) {\n      this.targetEnemyIndex = 0\n      point = this.enemies[this.targetEnemyIndex]\n    } else {\n      this.targetEnemyIndex = undefined\n      point = this.levelMap.creaturePos(this.player)\n    }\n\n    this.updateTarget(point)\n    return point\n  }\n\n  private resetPath(): void {\n    this.path.forEach(({ x, y }) => (this.memory.at(x, y).effect = undefined))\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.resetPath()\n    this.targetPos = newPos.copy()\n    this.drawPath()\n  }\n\n  private drawPath(): void {\n    this.path = []\n    let stop = false\n    const stage = this.levelMap,\n      pos = this.levelMap.creaturePos(this.player)\n\n    bresenhamInclusion(pos, this.targetPos, (x, y) => {\n      if (!stage.at(x, y).passibleThrough()) {\n        stop = true\n      }\n\n      this.path.push(new Point(x, y))\n      this.memory.at(x, y).effect = stop ? 'o' : 'x'\n    })\n  }\n\n  private findEnemies(): void {\n    this.enemies = []\n\n    this.player.stageMemory(this.levelMap).each((tile, x, y) => {\n      if (\n        tile.visible &&\n        tile.creature &&\n        tile.creature.id !== this.player.id\n      ) {\n        this.enemies.push(new Point(x, y))\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType, BaseMenusPresenter } from './internal'\nimport {\n  Game,\n  Direction,\n  DropItemsPresenter,\n  DrinkPresenter,\n  BagPresenter,\n  AttackEvent,\n  PickUpItemsEvent,\n  PickUpPresenter,\n  TileVisitor,\n  Stairway,\n  LevelMap,\n  LookPresenter,\n  UntrapEvent,\n  Point,\n  BaseInfoPresenter,\n  CloseDoorEvent,\n} from '../../engine'\nimport { EquipmentPresenter } from './equipment_presenter'\nimport { MissilePresenter } from './missile_presenter'\nimport { MoveEvent } from '../events/move_event'\nimport { CreatureEvent, PlayerEvent } from '../events/internal'\nimport { concat } from 'lodash'\nimport { Trap, Door } from '../models/tile'\nimport { PickSingleOptionPresenter } from './pick_single_option_presenter'\nimport { StayEvent } from '../events/stay_event'\nimport { OpenDoorEvent } from '../events/open_door_event'\n\nclass HandleTileVisitor extends TileVisitor {\n  // TODO: Add direction since commands might duplicate\n  public commands: [string, PlayerEvent][] = []\n\n  constructor(\n    public position: Point,\n    protected game: Game,\n    protected levelMap: LevelMap\n  ) {\n    super()\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    const adjacentMap = this.game.getMap(stairway.adjacentMapName)\n\n    this.commands.push([\n      'stairway',\n      new MoveEvent(\n        this.game,\n        this.levelMap,\n        stairway.enterPos(this.levelMap, adjacentMap),\n        adjacentMap\n      ),\n    ])\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      return\n    }\n\n    this.commands.push([\n      'untrap',\n      new UntrapEvent(this.position, trap, this.levelMap, this.game),\n    ])\n  }\n}\n\nclass AdjustHandleTileVisitor extends HandleTileVisitor {\n  protected onStairway(): void {}\n\n  public onDoor(door: Door): void {\n    if (door.open) {\n      this.commands.push([\n        'closeDoor',\n        new CloseDoorEvent(door, this.levelMap, this.game),\n      ])\n    } else {\n      this.commands.push([\n        'openDoor',\n        new OpenDoorEvent(door, this.levelMap, this.game),\n      ])\n    }\n  }\n}\n\nexport class IdlePresenter extends BaseMenusPresenter {\n  get type(): PresenterType {\n    return PresenterType.Idle\n  }\n\n  public inventoryCommand(): void {\n    this.redirect(new EquipmentPresenter(this.levelMap, this.game))\n  }\n\n  public bagCommand(): void {\n    this.redirect(new BagPresenter(this.levelMap, this.game))\n  }\n\n  public stayCommand(): void {\n    this.player.on(new StayEvent(this.levelMap))\n    this.endTurn()\n  }\n\n  public dropCommand(): void {\n    this.redirect(new DropItemsPresenter(this.levelMap, this.game))\n  }\n\n  public drinkCommand(): void {\n    this.redirect(new DrinkPresenter(this.levelMap, this.game))\n  }\n\n  public lookCommand(): void {\n    this.redirect(new LookPresenter(this.levelMap, this.game))\n  }\n\n  public move(direction: Direction): void {\n    const pos = this.levelMap.creaturePos(this.player),\n      dest = pos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (tile.passibleThrough(this.player)) {\n      this.player.on(new MoveEvent(this.game, this.levelMap, dest))\n    } else if (tile.creature) {\n      this.player.on(new AttackEvent(tile.creature, this.levelMap, this.game))\n    } else {\n      this.game.logger.ranIntoAnObstacle()\n      this.player\n        .stageMemory(this.levelMap)\n        .at(dest.x, dest.y)\n        .see(tile, 0)\n    }\n\n    this.endTurn()\n  }\n\n  public pickUpCommand(): void {\n    const tile = this.tile,\n      items = tile.items\n\n    if (items === undefined || items.bunch.length === 0) {\n      this.game.logger.noItemsToPickUp()\n    } else if (items.bunch.length === 1) {\n      this.player.on(new PickUpItemsEvent(tile, items.bunch, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new PickUpPresenter(this.levelMap, this.game))\n    }\n  }\n\n  public missileCommand(): void {\n    const missile = this.player.inventory.missileSlot.equipment\n\n    if (missile && missile.item) {\n      if (missile.item.canThrow(this.player)) {\n        this.redirect(new MissilePresenter(this.levelMap, this.game))\n      } else {\n        this.game.logger.needMissileWeapon()\n      }\n    } else {\n      this.game.logger.nothingToShotWith()\n    }\n  }\n\n  public handleCommand(): void {\n    let pos = this.levelMap.creaturePos(this.player),\n      visitor = new HandleTileVisitor(pos, this.game, this.levelMap),\n      adjustVisitor = new AdjustHandleTileVisitor(pos, this.game, this.levelMap)\n\n    this.tile.visit(visitor)\n\n    pos.wrappers().forEach((point: Point) => {\n      adjustVisitor.position = point\n      this.levelMap.at(point.x, point.y).visit(adjustVisitor)\n    })\n\n    const commands = concat(visitor.commands, adjustVisitor.commands)\n\n    switch (commands.length) {\n      case 0:\n        this.game.logger.howToHandle()\n        break\n      case 1:\n        this.player.on(commands[0][1])\n        this.endTurn()\n        break\n      default:\n        this.redirect(\n          new PickSingleOptionPresenter(\n            commands,\n            this.levelMap,\n            this.game,\n            ([name, command]) => {\n              this.player.on(command)\n              this.endTurn()\n            }\n          )\n        )\n    }\n  }\n}\n","import {\n  Creature,\n  Clan,\n  Pool,\n  AICreature,\n  DamageType,\n  Protection,\n  ProtectionType,\n  Damage,\n  Critical,\n} from '../engine'\nimport { Dispatcher } from './ai'\nimport { Material } from '../engine/lib/material'\n\nconst critical: Critical = { chance: 0.05, multiplier: 2 }\n\nconst newCreature = (\n  name: string,\n  protections: Protection[] = [],\n  damages: Damage[]\n) => {\n  return new AICreature(new Dispatcher(), {\n    name: name,\n    weight: 10,\n    clan: Clan.PlayerOnlyEnemy,\n    abilities: [],\n    protections: protections,\n    damages: damages,\n\n    maxHealthValue: 1,\n    regenerationRate: 5,\n    regenerationValue: 1,\n\n    resistances: [],\n    visionRadius: 5,\n\n    moveSpeed: 20,\n    attackSpeed: 20,\n    bodyControl: 5,\n\n    leavesCorpseRatio: 50,\n    material: Material.flesh,\n\n    throwingDamages: [],\n    critical,\n  })\n}\n\nexport const rat = () => {\n  return newCreature(\n    'Rat',\n    [],\n    [{ type: DamageType.Melee, dice: { times: 2, max: 2 }, extra: 0 }]\n  )\n}\n\nexport const golem = () => {\n  return newCreature(\n    'Golem',\n    [{ type: ProtectionType.Solid, value: 5 }],\n    [{ type: DamageType.Blunt, dice: { times: 1, max: 5 }, extra: 10 }]\n  )\n}\n\nexport const creaturesPool1 = new Pool<null, Creature>([[100, rat], [3, golem]])\n","import {\n  addCreatures,\n  addDoors,\n  addItems,\n  withMatchingTile,\n  centralize,\n  Corridor,\n  Door,\n  drawn,\n  Dungeon,\n  dungeon,\n  Floor,\n  LevelMap,\n  Point,\n  Room,\n  Tile,\n  TileTypes,\n  Wall,\n  Game,\n  Player,\n  Pool,\n} from '../../engine'\nimport { creaturesPool1 } from '../creatures'\nimport { withEachTile } from '../../engine/lib/post'\nimport { AirBlowTrap } from '../../engine/models/traps/air_blow_trap'\nimport { BareWireTrap } from '../../engine/models/traps/bare_wire_trap'\nimport { FallingRockTrap } from '../../engine/models/traps/falling_rock_trap'\nimport { smallRock } from '../items'\nimport { HoleTrap } from '../../engine/models/traps/hole_trap'\nimport { LightTrap } from '../../engine/models/traps/light_trap'\nimport { TeleportationTrap } from '../../engine/models/traps/teleportation_trap'\nimport { WaterTrap } from '../../engine/models/traps/water_trap'\n\nconst titleId: string = 'title'\n\nconst config = {\n  addDoors: false,\n  minSize: 3,\n  maxSize: 8,\n  roomsCount: 20,\n  addTraps: false,\n  width: 100,\n  height: 100,\n}\n\nconst tiles: Map<string, () => Tile> = new Map()\ntiles.set('C', () => new Corridor('C', TileTypes.Floor))\ntiles.set('W', () => new Wall())\ntiles.set('R', () => new Floor('R', TileTypes.Floor))\ntiles.set('D', () => new Door())\n\nconst traps: Pool<Tile, Tile> = new Pool([\n  [1, (tile: Tile): Tile => new AirBlowTrap(tile, false)],\n  [1, (tile: Tile): Tile => new BareWireTrap(tile, false)],\n  [1, (tile: Tile): Tile => new FallingRockTrap(smallRock, tile, false)],\n  [1, (tile: Tile): Tile => new HoleTrap(tile, false)],\n  [1, (tile: Tile): Tile => new LightTrap(tile, false)],\n  [1, (tile: Tile): Tile => new TeleportationTrap(tile, false)],\n  [1, (tile: Tile): Tile => new WaterTrap(tile, false)],\n  [93, (tile: Tile): Tile => tile],\n])\n\nexport class TitleDungeon extends Dungeon {\n  public enter(game: Game, player: Player): void {\n    const levelMap = (game.currentMap = game.getMap(titleId))\n\n    withMatchingTile(\n      levelMap,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        levelMap.addCreature(new Point(x, y), player)\n      }\n    )\n  }\n\n  public register(game: Game): void {\n    game.addMap(titleId, (id, game) =>\n      addCreatures(0, this.generateMap(titleId), creaturesPool1)\n    )\n  }\n\n  private generateMap(name: string): LevelMap {\n    let map = new LevelMap(\n      name,\n      dungeon<Tile>(\n        config.width,\n        config.height,\n        config.minSize,\n        config.maxSize,\n        config.roomsCount,\n        () => new Room(),\n        () => new Corridor('C', TileTypes.Floor),\n        () => new Wall()\n      )\n    )\n\n    addDoors(map, () => new Door(), () => true)\n\n    withEachTile(\n      map,\n      tile => tile.isFloor(),\n      (tile, x, y) => {\n        map.setTile(x, y, traps.pick(tile))\n      }\n    )\n\n    centralize(map)\n\n    // addItems(0.05, map, weapons.merge(itemsPool))\n\n    return map\n  }\n}\n","import { AttackEvent, Game } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (!this.canAttack(actor, levelMap)) {\n      return\n    }\n\n    if (this.victim && this.victimInAccess(actor, levelMap, this.victim)) {\n      return new AttackEvent(this.victim, levelMap, game)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor, levelMap)\n      return this.act(actor, levelMap, game, false)\n    }\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap): boolean {\n    const creature = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(\n    actor: Creature,\n    levelMap: LevelMap,\n    victim: Creature | undefined\n  ): boolean {\n    if (victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      levelMap,\n      (creature: Creature) => creature.id === victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature, levelMap: LevelMap) {\n    this.victim = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): Creature | undefined {\n    const memory = actor.stageMemory(levelMap)\n\n    return levelMap\n      .creaturePos(actor)\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature)\n      .find(\n        (creature: Creature | undefined) =>\n          creature ? condition(creature) : false\n      )\n  }\n}\n","import { Creature, CreatureId } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point } from '../utils/utils'\nimport { FollowTargetAI } from './internal'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor, levelMap)) ||\n      this.foundNewVictim(actor, levelMap)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): CreatureEvent | undefined {\n    this.victimId = undefined\n    return\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.destination) {\n      throw 'Chaser.goTo: no destination'\n    }\n    return this.followTo(actor, this.destination, levelMap, game)\n  }\n\n  private buildVictimPath(actor: Creature, levelMap: LevelMap): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => creature.id === this.victimId\n    )\n  }\n\n  private foundNewVictim(actor: Creature, levelMap: LevelMap): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, levelMap, creature =>\n        this.enemies(actor, creature)\n      ) && this.buildVictimPath(actor, levelMap)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      ({ x, y }, tile) => {\n        const creature = tile.creature\n\n        if (!result && creature && condition(creature)) {\n          this.destination = new Point(x, y)\n          this.victimId = creature.id\n          result = true\n        }\n      }\n    )\n\n    return result\n  }\n\n  protected followTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.nextTo(point))\n  }\n}\n","import {\n  Ability,\n  Creature,\n  Game,\n  StairwayDown,\n  MoveEvent,\n  LevelMap,\n} from '../../engine'\nimport { CreatureEvent } from '../events/internal'\nimport { TileVisitor } from '../models/tile'\nimport { GoToTileAI } from './internal'\n\nclass StairwayDownFinderVisitor extends TileVisitor {\n  public match = false\n\n  public onStairwayDown(): void {\n    this.match = true\n  }\n}\n\nclass StairwayDownTileMoverVisitor extends TileVisitor {\n  public event: CreatureEvent | undefined\n\n  constructor(private game: Game, private levelMap: LevelMap) {\n    super()\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    const adjacentMap = this.game.getMap(stairway.adjacentMapName)\n\n    this.event = new MoveEvent(\n      this.game,\n      this.levelMap,\n      stairway.enterPos(this.levelMap, adjacentMap),\n      adjacentMap\n    )\n  }\n}\n\nexport class Descender extends GoToTileAI {\n  constructor() {\n    super(tile => {\n      const visitor = new StairwayDownFinderVisitor()\n      tile.visit(visitor)\n      return visitor.match\n    })\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.GoStairway)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    // Should stay here at least for a turn\n    const visitor = new StairwayDownTileMoverVisitor(game, levelMap),\n      tile = levelMap.creatureTile(actor)\n\n    tile.visit(visitor)\n    return visitor.event\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Point, LevelMap } from '../../engine'\n\nimport { sumBy } from 'lodash'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Creature][] = []\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    return (\n      this.foundEnemies(actor, levelMap) &&\n      this.buildEscapePath(actor, levelMap)\n    )\n  }\n\n  private buildEscapePath(\n    actor: Creature,\n    levelMap: LevelMap,\n    minDistance: number = actor.visionRadius / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.buildPath(actor, levelMap, ({ x, y }) => {\n      const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n        // I don't use pathfinding since it should try\n        // to run away from those who are visible, so the path\n        // to them should be straightforward.\n        return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n      })\n\n      return score >= minDistance\n    })\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildEscapePath(actor, levelMap, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature, levelMap: LevelMap): boolean {\n    this.escapesFrom = []\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      (point, tile) => {\n        const creature = tile.creature\n\n        if (creature && this.enemies(actor, creature)) {\n          this.escapesFrom.push([point, creature])\n        }\n      }\n    )\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from './internal'\n\nexport class Explorer extends GoToTileAI {\n  constructor() {\n    super(tile => !tile.seen)\n  }\n}\n","import { AI } from './internal'\n\nimport { Point } from '../utils/utils'\nimport { Creature } from '../models/creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { TileVisitor, Tile } from '../models/tile'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nclass PatrolTileVisitor extends TileVisitor {\n  public status: boolean = false\n\n  constructor(private tile: Tile) {\n    super()\n  }\n\n  public addNode(): boolean {\n    this.status = false\n    this.tile.visit(this)\n    return this.status\n  }\n\n  public onDoor() {\n    this.status = true\n  }\n}\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID | undefined\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n  private firstCallPatrol: boolean = true\n\n  constructor() {\n    super()\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.currentNodeID = 'a' // TODO: Check it, was undefined\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (this.graph.nodes().length <= 1) {\n      return\n    }\n\n    if (this.firstCallPatrol) {\n      const pos = levelMap.creaturePos(actor)\n      this.addNode(pos)\n      this.firstCallPatrol = false\n    }\n\n    this.step += 1\n\n    if (this.path.length) {\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor, levelMap)\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    }\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(pos: Point, tile: Tile): void {\n    if (this.step >= NEW_POINT_EVERY || new PatrolTileVisitor(tile).addNode()) {\n      this.addNode(pos)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(point: Point): void {\n    this.graph.setNode(this.i, point)\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.newNodeId()\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature, levelMap: LevelMap): void {\n    // TODO: Remove this\n    if (!this.targetNodeID) {\n      throw 'Patrol has no next targetID'\n    }\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.buildPath(actor, levelMap, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature, levelMap: LevelMap): void {\n    let seenLastID: NodeID = this.graph.nodes()[0],\n      seenLastStep: number = this.lastNodeVisit[seenLastID],\n      nodes = this.graph.neighbors(this.currentNodeID)\n\n    if (nodes) {\n      nodes.forEach((nodeID: NodeID) => {\n        if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n          seenLastID = nodeID\n          seenLastStep = this.lastNodeVisit[seenLastID]\n        }\n      })\n    }\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor, levelMap)\n  }\n\n  private moveToTarget(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean\n  ): CreatureEvent | undefined {\n    const nextPoint: Point | undefined = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        return this.act(actor, levelMap, game, false)\n      } else {\n        return new Loiter().act(actor, levelMap, game)\n      }\n    } else if (\n      actor\n        .stageMemory(levelMap)\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath(actor, levelMap)\n\n      if (this.path.length) {\n        return this.act(actor, levelMap, game, false)\n      }\n    } else {\n      return new MoveEvent(game, levelMap, nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n\n  private newNodeId(): void {\n    this.i = String.fromCharCode(this.i.charCodeAt(0) + 1)\n  }\n}\n","import { PickUpItemsEvent, LevelMap } from '../../engine'\nimport { Ability, Creature, AICreature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { GoToTileAI } from './internal'\nimport { AIItemPickedEvent } from './meta_ai'\nimport { CreatureEvent } from '../events/internal'\nimport { MemoryTile } from '../models/memory'\n\nexport class Picker extends GoToTileAI {\n  constructor() {\n    super((tile: MemoryTile) => !!tile.items)\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.Inventory)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: AICreature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const tile = levelMap.creatureTile(actor)\n\n    if (!tile.items) {\n      throw 'Picker.act : nothing to pick up'\n    }\n\n    actor.ai.pushEvent(new AIItemPickedEvent(tile.items, game))\n\n    return new PickUpItemsEvent(tile, tile.items.bunch, game)\n  }\n}\n","import { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { StayEvent } from '../events/stay_event'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class SelfHealer extends AI {\n  public act(actor: Creature, levelMap: LevelMap): CreatureEvent | undefined {\n    if (actor.health.atMax) {\n      return\n    }\n\n    return new StayEvent(levelMap)\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability, CreatureId } from '../models/creature'\nimport { Point, bresenham } from '../utils/utils'\nimport { MissileAttackEvent, GroupedItem } from '../../engine'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Memory } from '../models/memory'\nimport { CreatureEvent, Reaction } from '../events/internal'\nimport { Item } from '../models/item'\n\nexport class Thrower extends AI {\n  public victim: Creature | undefined\n  public previousVictim: Creature | undefined\n  public missiles: GroupedItem<Item> | undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (\n      !actor.can(Ability.Throwing) ||\n      !this.hasMissile(actor) ||\n      !this.canAttack(actor, levelMap, game)\n    ) {\n      return\n    }\n\n    let path: Point[] = []\n\n    if (!this.victim) {\n      throw 'Thrower.act called when there is no victim'\n    }\n\n    bresenham(\n      levelMap.creaturePos(actor),\n      levelMap.creaturePos(this.victim),\n      (x, y) => path.push(new Point(x, y))\n    )\n\n    return new MissileAttackEvent(\n      path,\n      game,\n      levelMap,\n      (reaction: Reaction) => {\n        if (reaction === Reaction.DIE) {\n          this.victim = undefined\n          this.previousVictim = undefined\n        }\n      }\n    )\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.missile\n    return this.missiles !== undefined\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap, game: Game): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (this.findWithId(actor, levelMap, this.previousVictim.id)) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findWithId(\n    actor: Creature,\n    levelMap: LevelMap,\n    victimId: CreatureId\n  ): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => victimId === creature.id\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    const memory = actor.stageMemory(levelMap),\n      pos = levelMap.creaturePos(actor)\n\n    this.withinView(memory, levelMap.creaturePos(actor), (point, tile) => {\n      const creature = tile.creature\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, pos, memory, point)\n      ) {\n        this.victim = levelMap.at(point.x, point.y).creature\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(\n    actor: Creature,\n    pos: Point,\n    memory: Memory,\n    target: Point\n  ): boolean {\n    let obstacles = false\n\n    bresenham(pos, target, (x, y) => {\n      obstacles = obstacles || memory.at(x, y).tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Calculator } from '../lib/calculator'\nimport { HurtEvent } from './hurt_event'\nimport { DieReason } from './die_event'\nimport { Player } from '../models/player'\n\nexport class AttackEvent extends CreatureEvent {\n  constructor(\n    private victim: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    return this.process(actor, false)\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const reaction = this.process(player, true)\n\n    if (reaction === Reaction.DIE) {\n      player.on(new AddExperienceEvent(this.victim, this.levelMap, this.game))\n    }\n\n    return reaction\n  }\n\n  protected process(actor: Creature, isPlayer: boolean): Reaction {\n    const [reaction, damage] = this.hit(actor)\n\n    this.game.logger.attackLogger.melee(\n      damage,\n      actor,\n      this.victim,\n      reaction,\n      isPlayer\n    )\n\n    return reaction\n  }\n\n  protected hit(actor: Creature): [Reaction, number] {\n    if (Calculator.misses(actor.bodyControl, this.victim.bodyControl)) {\n      return [Reaction.DODGE, 0]\n    }\n\n    const hurtEvent = new HurtEvent(\n      Calculator.withCritical(actor.damages, actor.specie.critical),\n      DieReason.Attack,\n      this.levelMap,\n      this.game\n    )\n\n    return [this.victim.on(hurtEvent), hurtEvent.damage]\n  }\n}\n","import { Reaction } from './internal'\nimport { VisibleCreatureEvent } from './visible_creature_event'\nimport { Creature } from '../models/creature'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Door } from '../models/tile'\n\nexport class CloseDoorEvent extends VisibleCreatureEvent {\n  constructor(private door: Door, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    if (this.door.open) {\n      this.door.open = false\n      this.game.logger.doorLogger.close()\n    } else {\n      this.game.logger.doorLogger.alreadyClosed()\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { Creature } from '../models/creature'\nimport { CreatureEvent, Reaction } from './internal'\nimport { Potion, Game } from '../../engine'\n\nexport class DrinkPotionEvent extends CreatureEvent {\n  constructor(private potion: Potion, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    actor.removeItem(this.potion, 1)\n    this.potion.onDrink(this.game)\n    // TODO: Different messages for player and creatures\n    this.game.logger.drink(this.potion)\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Point } from '../utils/utils'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { ItemFlightTileEffect } from '../models/tile_effect'\nimport { ThrowEvent } from './throw_event'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Missile } from '../models/item'\nimport { RemoveItemEvent } from './remove_item_event'\n\nexport class MissileAttackEvent extends CreatureEvent {\n  constructor(\n    private path: Point[],\n    private game: Game,\n    private levelMap: LevelMap,\n    private done: (reaction: Reaction) => void\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    let missile = actor.missile\n\n    if (!missile) {\n      throw 'MissileAttackEvent called when actor has no missiles'\n    }\n\n    this.withMissile(actor, missile.item)\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const missile = player.missile\n\n    if (!missile) {\n      throw 'MissileAttackEvent: slot has no items'\n    }\n\n    this.withMissile(player, missile.item)\n\n    player.on(new RemoveItemEvent(player.inventory.missileSlot, 1, this.game))\n    player.stuffWeight.subtract(missile.item.weight)\n\n    return Reaction.NOTHING\n  }\n\n  private withMissile(actor: Creature, missile: Missile): void {\n    let flightPath: Point[] = [],\n      victim: Creature | undefined\n\n    this.path.forEach(point => {\n      if (!victim) {\n        const tile = this.levelMap.at(point.x, point.y)\n        victim = tile.creature\n        flightPath.push(point)\n      }\n    })\n\n    this.game.effect = new ItemFlightTileEffect(missile, flightPath, () => {\n      if (victim) {\n        this.done(\n          actor.on(new ThrowEvent(victim, missile, this.levelMap, this.game))\n        )\n      } else {\n        this.done(Reaction.NOTHING)\n      }\n    })\n  }\n}\n","import { Game, GroupedItem, ItemsBunch, Tile } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Item } from '../models/item'\nimport { CreatureEvent, Reaction } from './internal'\n\nexport class PickUpItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    this.items.forEach(({ item, count }) => {\n      creature.addItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    let tileItems: ItemsBunch<Item> | undefined = this.tile.items\n\n    if (tileItems === undefined) {\n      throw 'Failed to pick up items - tile has no items'\n    } else {\n      this.withTileItems(player, tileItems)\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected withTileItems(subject: Player, tileItems: ItemsBunch<Item>) {\n    this.items.forEach(({ item, count }) => {\n      subject.addItem(item, count)\n      subject.stuffWeight.add(item.weight * count)\n\n      this.game.logger.pickedUpItem(item, count)\n      tileItems.remove(item, count)\n    })\n  }\n}\n","import { PlayerEvent, Reaction } from './internal'\nimport { Player } from '../../engine'\nimport { Profession } from '../models/profession'\n\nexport class PickProfessionEvent extends PlayerEvent {\n  constructor(private profession: Profession) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    let playerProfession = player.professions.find(\n      profession => profession.id === this.profession.id\n    )\n\n    if (playerProfession) {\n      // TODO: Validate does not exceed max level\n      playerProfession.level += 1\n    } else {\n      this.profession.level += 1\n      player.professions.push(this.profession)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { PlayerEvent, Reaction } from './internal'\nimport { InventorySlot, Item, Game } from '../../engine'\nimport { Player } from '../models/player'\nimport { TakeOffItemEvent } from './take_off_item_event'\nimport { Armor } from '../models/item'\nimport { AddImpactEvent } from './add_impact_event'\n\nexport class PutOnItemEvent extends PlayerEvent {\n  constructor(\n    private slot: InventorySlot,\n    private item: Item,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    let inventory = player.inventory,\n      groupItem = inventory.findInBag(this.item)\n\n    if (groupItem === undefined) {\n      throw `Item ${\n        this.item.name\n      } can not be equipped - not found in inventory`\n    }\n\n    // TODO: assert that can't equip more than have in inventory\n    // TODO: assert can equip\n    if (this.slot.equipment) {\n      const reaction = player.on(new TakeOffItemEvent(this.slot, this.game))\n      if (reaction !== Reaction.NOTHING) {\n        return reaction\n      }\n    }\n\n    const count = this.slot.useSingleItem ? 1 : groupItem.count\n\n    player.removeItem(this.item, count)\n    this.slot.equip(this.item, count)\n    this.onPutOn(player, this.item)\n\n    this.game.logger.putOn(this.item)\n\n    return Reaction.NOTHING\n  }\n\n  private onPutOn(player: Player, item: Item): void {\n    if (item instanceof Armor) {\n      player.itemsProtections = player.itemsProtections.concat(item.protections)\n    }\n\n    item.impacts.forEach(impact => {\n      player.on(new AddImpactEvent(impact, item.name, this.game))\n    })\n  }\n}\n","import { CreatureEvent, Reaction } from './internal'\nimport { Creature } from '../models/creature'\nimport { ImpactType, Game } from '../../engine'\n\nexport class RemoveImpactEvent extends CreatureEvent {\n  constructor(\n    private impactType: ImpactType,\n    private game: Game,\n    private source: string | undefined = undefined\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    // Different messages for player\n    if (this.source) {\n      creature.removeConstImpact(this.impactType, this.source)\n    } else {\n      creature.removeImpact(this.impactType)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { VisibleCreatureEvent } from './visible_creature_event'\nimport { Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { withMatchingTile } from '../lib/post'\nimport { MoveEvent } from './move_event'\nimport { Point } from '../utils/utils'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Resistance } from '../models/specie'\nimport { AITeleportationEvent } from '../ai/player_ai'\nimport { Reaction } from './internal'\n\n// TODO: Creature that teleports itself away\nexport class TeleportationEvent extends VisibleCreatureEvent {\n  constructor(levelMap: LevelMap, game: Game, private selfCast: boolean) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (this.playerSees(actor)) {\n      if (\n        actor.hasResistance(Resistance.TeleportationControl) ||\n        !this.teleport(actor)\n      ) {\n        this.game.logger.creatureNotTeleported(actor)\n      } else {\n        this.game.logger.creatureTeleported(actor)\n      }\n    } else {\n      this.teleport(actor)\n    }\n\n    // TODO: Add a message if player sees new position\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (player.hasResistance(Resistance.TeleportationControl)) {\n      if (!this.selfCast) {\n        this.game.logger.playerTeleportationCaused()\n      }\n\n      player.ai.pushEvent(new AITeleportationEvent(this.levelMap, this.game))\n      this.game.playerTurn = true\n    } else if (this.teleport(player)) {\n      if (!this.selfCast) {\n        this.game.logger.playerTeleported()\n      }\n    } else {\n      this.game.logger.playerNotTeleported()\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected teleport(actor: Creature): boolean {\n    let teleported = false\n\n    try {\n      withMatchingTile(\n        this.levelMap,\n        tile => tile.free(),\n        (x, y) => {\n          teleported = true\n          actor.on(new MoveEvent(this.game, this.levelMap, new Point(x, y)))\n        }\n      )\n    } catch {}\n\n    return teleported\n  }\n}\n","import { Player } from '../models/player'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Trap } from '../models/tile'\nimport { Point } from '../utils/utils'\nimport { PlayerEvent, Reaction } from './internal'\n\nexport class UntrapEvent extends PlayerEvent {\n  constructor(\n    private trapPosition: Point,\n    private trap: Trap,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    this.trap.untrap(this.trapPosition, player, this.levelMap, this.game)\n    return Reaction.NOTHING\n  }\n}\n","import { Rect, Point, rand, twoDimArray, minUnsafe } from '../utils/utils'\nimport { min } from 'lodash'\n\nconst THICKNESS = 0\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room<T> extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: T[][], walls: boolean[][], newRoomSpace: () => T): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        walls[this.x + i][this.y + j] = false\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road<T> extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: T[][], walls: boolean[][], newCorridor: () => T): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (walls[hx + i][hy]) {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (walls[vx][vy + j]) {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator<T> {\n  rooms: Room<T>[]\n  roads: Road<T>[]\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room<T>[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room<T> {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room<T>[]): Room<T>[] {\n    return rooms.reduce((pickedRooms: Room<T>[], currentRoom: Room<T>) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room<T>[]): Room<T>[] {\n    if (rooms.length === 0) {\n      return rooms\n    }\n\n    const minX = minUnsafe(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room<T>) => room.x + room.w < this.maxX)\n\n    const minY = minUnsafe(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room<T>) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room<T>[]): Road<T>[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    const firstPoint = points.shift()\n\n    if (!firstPoint) {\n      throw 'Dungeon.buildRoads rooms array is empty'\n    }\n\n    let connectedPoints: Point[] = [firstPoint]\n    let roads: Road<T>[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let maybePoint = points.shift()\n      if (!maybePoint) {\n        throw 'Dungeon.buildRoads rooms array is empty'\n      }\n\n      let currentPoint: Point = maybePoint\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function<T>(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number,\n  newRoomSpace: () => T,\n  newCorridor: () => T,\n  newWall: () => T\n): T[][] {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator<T>(\n    dimX,\n    dimY,\n    minSize,\n    maxSize,\n    roomsCount\n  )\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n  let walls = twoDimArray(dimX, dimY, () => true)\n\n  for (let i = 0; i < dungeon.rooms.length; i++)\n    dungeon.rooms[i].add(stage, walls, newRoomSpace)\n  for (let i = 0; i < dungeon.roads.length; i++)\n    dungeon.roads[i].add(stage, walls, newCorridor)\n\n  return stage\n}\n","export enum Gender {\n  Neuter = 'neuter',\n  Female = 'female',\n  Male = 'male',\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number[] {\n    if (this.doneLeveling) {\n      return []\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = []\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      this.levelUp()\n      levelUps.push(this.current)\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (input: Input) => Output][] = []\n\n  constructor(items: [number, (input: Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (input: Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    const found = this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })\n\n    if (found !== undefined) {\n      return found[1](input)\n    }\n\n    throw 'Pool failed to pick anything'\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import { withMatchingTile } from '../lib/post'\nimport { StairwayDown, StairwayUp, Tile } from './tile'\nimport { LevelMap } from './level_map'\nimport { Game } from './game'\nimport { Player } from './player'\n\nexport abstract class Dungeon {\n  protected levels: LevelMap[] = []\n\n  constructor() {}\n  public abstract enter(game: Game, player: Player): void\n  public abstract register(game: Game): void\n\n  protected addStairDown(map: LevelMap, adjustMapName: string): LevelMap {\n    return this.addStairs(map, new StairwayDown(map, adjustMapName))\n  }\n\n  protected addStairUp(map: LevelMap, adjustMapName: string): LevelMap {\n    return this.addStairs(map, new StairwayUp(map, adjustMapName))\n  }\n\n  private addStairs(map: LevelMap, tile: Tile): LevelMap {\n    withMatchingTile(\n      map,\n      tile => tile.free(),\n      (x, y) => {\n        map.setTile(x, y, tile)\n      }\n    )\n\n    return map\n  }\n}\n","import { ProfessionPicker } from './profession'\nimport { TileEffect } from './tile_effect'\nimport { LevelMap } from './level_map'\nimport { Logger } from './logger'\nimport { Player } from './player'\n\ntype MapGenerator = (name: string, game: Game) => LevelMap\n\nexport class Game {\n  public logger: Logger\n  public currentMap: LevelMap | undefined\n  public playerTurn: boolean = false\n  public running: boolean = false\n  public effect: TileEffect | null = null\n  public turns: number = 0\n\n  protected maps: Map<string, LevelMap | MapGenerator> = new Map()\n\n  constructor(\n    public player: Player,\n    public professionPicker: ProfessionPicker\n  ) {\n    this.logger = new Logger(player)\n  }\n\n  public turn(): void {\n    if (this.running || (this.player.ai.presenter && !this.effect)) {\n      return\n    }\n    this.running = true\n\n    this.mutexTurn()\n\n    this.running = false\n  }\n\n  protected mutexTurn(): void {\n    if (this.player.ai.runEvents()) {\n      return\n    }\n\n    if (!this.currentMap) {\n      throw 'mutexTurn: Map is undefined'\n    }\n\n    if (this.effect) {\n      this.player.rebuildVision(this.currentMap)\n      this.effect.patchMemory(this.player.stageMemory(this.currentMap))\n\n      if (this.effect.done()) {\n        this.effect.onDone()\n        this.effect = null\n      }\n    } else {\n      while (!this.player.dead && !this.playerTurn) {\n        this.levelMapTurn(this.currentMap)\n      }\n\n      this.player.rebuildVision(this.currentMap)\n    }\n  }\n\n  public getMap(name: string): LevelMap {\n    const levelMap = this.maps.get(name)\n\n    if (!levelMap) {\n      throw `Map ${name} is not found`\n    }\n\n    if (levelMap instanceof LevelMap) {\n      return levelMap\n    } else if (levelMap instanceof Function) {\n      const builtLevelMap = levelMap(name, this)\n      this.maps.set(name, builtLevelMap)\n      return builtLevelMap\n    } else {\n      throw `LevelMap with id ${name} is not found`\n    }\n  }\n\n  public addMap(name: string, generator: MapGenerator): void {\n    if (this.maps.has(name)) {\n      throw `Game.addMap: map ${name} already presence`\n    }\n\n    this.maps.set(name, generator)\n  }\n\n  private levelMapTurn(levelMap: LevelMap): void {\n    let timeline = levelMap.timeline\n\n    const actorId = timeline.next()\n\n    if (actorId === undefined) {\n      throw 'Timeline event is empty!'\n    }\n\n    const actor = levelMap.creatures.find(creature => actorId === creature.id)\n\n    if (actor) {\n      const speed = actor.act(levelMap, this)\n      this.turns += 1\n\n      // If they are still on a map\n      if (\n        speed &&\n        levelMap.creatures.find(creature => actorId === creature.id)\n      ) {\n        timeline.add(actorId, speed)\n      }\n    }\n  }\n}\n","import {\n  InventorySlot,\n  RightHandSlot,\n  LeftHandSlot,\n  ChestSlot,\n  MissileWeaponSlot,\n  MissileSlot,\n  BootsSlot,\n  HeadSlot,\n  AmuletSlot,\n  LeftFingerSlot,\n  RightFingerSlot,\n  GlovesSlot,\n  GauntletsSlot,\n  BeltSlot,\n  ToolsSlot,\n  CloakSlot,\n  BodyPart,\n} from './inventory_slot'\nimport { Item } from './item'\nimport { ItemsBunch, GroupedItem } from '../lib/bunch'\nimport { concat, compact } from 'lodash'\nimport { Material } from '../lib/material'\n\nexport class Inventory {\n  private bag: ItemsBunch<Item> = new ItemsBunch()\n\n  public headSlot = new HeadSlot(Material.flesh)\n  public amuletSlot = new AmuletSlot()\n  public cloakSlot = new CloakSlot()\n  public chestSlot = new ChestSlot(Material.flesh)\n  public rightHandSlot = new RightHandSlot(Material.flesh)\n  public leftHandSlot = new LeftHandSlot(Material.flesh)\n  public leftFingerSlot = new LeftFingerSlot()\n  public rightFingerSlot = new RightFingerSlot()\n  public glovesSlot = new GlovesSlot()\n  public gauntletsSlot = new GauntletsSlot()\n  public beltSlot = new BeltSlot()\n  public bootsSlot = new BootsSlot(Material.flesh)\n  public missileWeaponSlot = new MissileWeaponSlot()\n  public missileSlot = new MissileSlot()\n  public toolsSlot = new ToolsSlot()\n\n  get bodyParts(): BodyPart[] {\n    return [\n      this.headSlot,\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.chestSlot,\n      this.bootsSlot,\n    ]\n  }\n\n  public slots(): InventorySlot[] {\n    return [\n      this.headSlot,\n      this.amuletSlot,\n      this.cloakSlot,\n      this.chestSlot,\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.leftFingerSlot,\n      this.rightFingerSlot,\n      this.glovesSlot,\n      this.gauntletsSlot,\n      this.beltSlot,\n      this.bootsSlot,\n      this.missileWeaponSlot,\n      this.missileSlot,\n      this.toolsSlot,\n    ]\n  }\n\n  get allItems(): GroupedItem<Item>[] {\n    return concat(\n      this.cares(),\n      compact(this.slots().map(slot => slot.equipment))\n    )\n  }\n\n  get unarmoredSlotsCount(): number {\n    return [\n      this.headSlot,\n      this.chestSlot,\n      this.glovesSlot,\n      this.gauntletsSlot,\n      this.beltSlot,\n      this.bootsSlot,\n    ].filter((slot: InventorySlot) => !slot.equipment).length\n  }\n\n  public cares(): GroupedItem<Item>[] {\n    return this.bag.bunch\n  }\n\n  public findInBag(item: Item): GroupedItem<Item> | undefined {\n    return this.bag.find(item)\n  }\n\n  public putToBag(item: Item, count: number): void {\n    this.bag.put(item, count)\n  }\n\n  public removeFromBag(item: Item, count: number): void {\n    this.bag.remove(item, count)\n  }\n}\n","import { Tile, Wall, TileVisitor } from './tile'\nimport { Creature, twoDimArray, ItemsBunch } from '../../engine'\nimport { Mapped } from '../utils/utils'\nimport { Item } from './item'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile: Tile) {}\n\n  get items(): ItemsBunch<Item> | undefined {\n    return this.tile.items\n  }\n\n  get creature(): Creature | undefined {\n    return this.tile.creature\n  }\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    this.tile.visit(tileVisitor)\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = new Wall()\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { concat, cloneDeep, sumBy } from 'lodash'\nimport { Game, GroupedItem, Inventory, LevelMap, PlayerAI } from '../../engine'\nimport { AfterEvent } from '../events/after_event'\nimport { PlayerEvent, Reaction } from '../events/internal'\nimport { Level } from '../lib/level'\nimport {\n  CapacityLimitStat,\n  Stat,\n  StrengthStat,\n  DexterityStat,\n  ConstitutionStat,\n} from '../lib/stat'\nimport { Item, Missile, Protection, ProtectionType } from './item'\nimport { Damage } from '../lib/damage'\nimport { Profession } from './profession'\nimport { Resistance, PlayerSpecie } from './specie'\nimport { Creature } from './creature'\nimport { KillStat } from '../utils/kill_stat'\nimport { PrimaryAttributes } from '../lib/race'\n\nexport class Player extends Creature<PlayerSpecie> {\n  public professions: Profession[] = []\n  public inventory: Inventory = new Inventory()\n\n  public itemsProtections: Protection[] = []\n  public itemsResistances: Resistance[] = []\n\n  public stuffWeight: Stat\n  public carryingCapacity: CapacityLimitStat\n\n  public killStat: KillStat = new KillStat()\n\n  // Main attributes\n  public strength: StrengthStat\n  public dexterity: DexterityStat\n  public constitution: ConstitutionStat\n  public intelligence: Stat\n  public wisdom: Stat\n  public charisma: Stat\n\n  constructor(\n    public level: Level,\n    public ai: PlayerAI,\n    specie: PlayerSpecie,\n    attributes: PrimaryAttributes\n  ) {\n    super(specie)\n\n    this.strength = new StrengthStat(attributes.strength)\n    this.dexterity = new DexterityStat(attributes.dexterity)\n    this.constitution = new ConstitutionStat(attributes.constitution)\n    this.intelligence = new Stat(attributes.intelligence)\n    this.wisdom = new Stat(attributes.wisdom)\n    this.charisma = new Stat(attributes.charisma)\n\n    this.stuffWeight = new Stat(0)\n    this.carryingCapacity = new CapacityLimitStat(\n      this.strength.current,\n      this.constitution.current\n    )\n  }\n\n  public act(levelMap: LevelMap, game: Game): number {\n    this.statsTurn()\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n    this.on(new AfterEvent(levelMap, game))\n\n    return this.speed\n  }\n\n  public rebuildVision(levelMap: LevelMap): void {\n    this.visionMask(levelMap)\n  }\n\n  public on(event: PlayerEvent): Reaction {\n    return event.affectPlayer(this)\n  }\n\n  get missile(): GroupedItem<Missile> | undefined {\n    // TODO: Validate item on slot\n    return this.inventory.missileSlot.equipment\n  }\n\n  get inventoryItems(): GroupedItem<Item>[] {\n    return this.inventory.allItems\n  }\n\n  public addItem(item: Item, count: number): void {\n    this.inventory.putToBag(item, count)\n  }\n\n  public removeItem(item: Item, count: number): void {\n    this.inventory.removeFromBag(item, count)\n  }\n\n  get weightWithCarryings(): number {\n    return (\n      this.specie.weight +\n      sumBy(this.inventory.allItems, ({ item, count }) => item.weight * count)\n    )\n  }\n\n  get bodyControl(): number {\n    return this.specie.bodyControl + this.dexterity.bodyControlAdjustment\n  }\n\n  get throwDamages(): Damage[] {\n    const dexterityAdjustment = this.dexterity.missileAdjustment\n\n    return concat(this.specie.throwingDamages, this.missileItemsDamages()).map(\n      (damage: Damage) => {\n        let dmg = cloneDeep(damage)\n        dmg.extra += dexterityAdjustment\n        return dmg\n      }\n    )\n  }\n\n  get damages(): Damage[] {\n    const strengthAdjustment = this.strength.meleeAdjustment\n\n    return concat(this.specie.damages, this.meleeItemsDamages()).map(\n      (damage: Damage) => {\n        let dmg = cloneDeep(damage)\n        dmg.extra += strengthAdjustment\n        return dmg\n      }\n    )\n  }\n\n  get protections(): Protection[] {\n    const perEmptySlotArmor = 1\n\n    return concat(this.specie.protections, this.itemsProtections, [\n      {\n        type: ProtectionType.Unarmored,\n        value: perEmptySlotArmor * this.inventory.unarmoredSlotsCount,\n      },\n    ])\n  }\n\n  get resistances(): Resistance[] {\n    return concat(this.specie.resistances, this.itemsResistances)\n  }\n\n  protected meleeItemsDamages(): Damage[] {\n    const rightHandEq = this.inventory.rightHandSlot.equipment,\n      leftHandEq = this.inventory.leftHandSlot.equipment\n\n    // TODO: Default damage\n    return concat(\n      rightHandEq ? rightHandEq.item.damages : [],\n      leftHandEq ? leftHandEq.item.damages : []\n    )\n  }\n\n  protected missileItemsDamages(): Damage[] {\n    const missileEq = this.inventory.missileSlot.equipment,\n      missileWeaponEq = this.inventory.missileWeaponSlot.equipment\n\n    // TODO: Default damage\n    return concat(\n      // Can throw literally anything, so damage might be undefined\n      missileEq ? missileEq.item.damages || [] : [],\n      missileWeaponEq ? missileWeaponEq.item.damages : []\n    )\n  }\n}\n","import { SingleItemUseListingPresenter } from './items_listing_presenter'\n\nexport class BagPresenter extends SingleItemUseListingPresenter {\n  public readonly title: string = 'Сумка'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public withItem(): void {\n    this.endTurn()\n  }\n}\n","import {\n  CharacterInfoPresenter,\n  CharacterInfoPage,\n} from './character_info_presenter'\n\nexport class BaseInfoPresenter extends CharacterInfoPresenter {\n  get page(): CharacterInfoPage {\n    return CharacterInfoPage.Base\n  }\n\n  get currentLevel(): number {\n    return this.player.level.current\n  }\n\n  get currentExperience(): string {\n    return `${this.player.level.currentExperience}/${\n      this.player.level.requiredExperience\n    }`\n  }\n}\n","import { DrinkPotionEvent, GroupedItem } from '../../engine'\nimport { ItemGroup, Potion } from '../models/item'\nimport { SingleItemUseListingPresenter } from './items_listing_presenter'\n\nexport class DrinkPresenter extends SingleItemUseListingPresenter {\n  public readonly title: string = 'Что выпить?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory\n      .cares()\n      .filter(itemGroup => itemGroup.item.group === ItemGroup.Potion)\n  }\n\n  public withItem({ item }: GroupedItem<Potion>): void {\n    this.player.on(new DrinkPotionEvent(item, this.game))\n    this.endTurn()\n  }\n}\n","import { MultipleItemUseListingPresenter } from './items_listing_presenter'\nimport { GroupedItem } from '../lib/bunch'\nimport { Item } from '../models/item'\nimport { DropItemsEvent } from '../events/drop_items_event'\n\nexport class DropItemsPresenter extends MultipleItemUseListingPresenter {\n  public readonly title: string = 'Что положить?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public withItems(items: GroupedItem<Item>[]): void {\n    if (items.length) {\n      this.player.on(new DropItemsEvent(this.tile, items, this.game))\n      this.endTurn()\n    } else {\n      this.goIdle()\n    }\n  }\n}\n","import {\n  CharacterInfoPresenter,\n  CharacterInfoPage,\n} from './character_info_presenter'\nimport { Gender, Color, Race } from '../../engine'\n\nexport class HistoryInfoPresenter extends CharacterInfoPresenter {\n  get page(): CharacterInfoPage {\n    return CharacterInfoPage.History\n  }\n\n  get name(): string {\n    return this.player.name\n  }\n\n  get weight(): number {\n    return this.specie.weight\n  }\n\n  get height(): number {\n    return this.specie.height\n  }\n\n  get gender(): Gender {\n    return this.specie.gender\n  }\n\n  get eyeColor(): Color {\n    return this.specie.eyeColor\n  }\n\n  get hairColor(): Color {\n    return this.specie.hairColor\n  }\n\n  get skinColor(): Color {\n    return this.specie.skinColor\n  }\n\n  get race(): Race {\n    return this.player.specie.race\n  }\n\n  get turns(): number {\n    return this.game.turns\n  }\n}\n","import { PresenterType } from './internal'\n\nimport { LevelMap, Game, IdlePresenter } from '../../engine'\nimport { PickPointPresenter } from './pick_point_presenter'\n\nexport enum LookPresenterVisibility {\n  See,\n  Recall,\n  Hidden,\n}\n\nexport class LookPresenter extends PickPointPresenter<\n  LookPresenterVisibility,\n  string\n> {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(levelMap, game, '_', target => this.memory.inRange(target))\n  }\n\n  get type(): PresenterType {\n    return PresenterType.Look\n  }\n\n  get title(): LookPresenterVisibility {\n    if (this.memoryTile.visible) {\n      return LookPresenterVisibility.See\n    } else if (this.memoryTile.seen) {\n      return LookPresenterVisibility.Recall\n    } else {\n      return LookPresenterVisibility.Hidden\n    }\n  }\n\n  get body(): string[] {\n    let messages = []\n\n    if (this.memoryTile.creature) {\n      if (this.memoryTile.creature.id === this.player.id) {\n        messages.push('Это я')\n      } else {\n        messages.push(`Это ${this.memoryTile.creature.name}`)\n      }\n    }\n\n    if (this.memoryTile.items) {\n      switch (this.memoryTile.items.bunch.length) {\n        case 0:\n          break\n        case 1:\n          messages.push(`Лежит ${this.memoryTile.items.bunch[0].item.name}`)\n          break\n        default:\n          messages.push('Лежит несколько предметов')\n      }\n    }\n\n    return messages\n  }\n\n  protected close(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n","import {\n  Item,\n  PickUpItemsEvent,\n  MultipleItemUseListingPresenter,\n} from '../../engine'\nimport { GroupedItem } from '../lib/bunch'\n\nexport class PickUpPresenter extends MultipleItemUseListingPresenter {\n  public readonly title: string = 'Что поднять?'\n\n  protected initPositions(): void {\n    const items = this.tile.items\n\n    if (items === undefined) {\n      throw `Failed to show pick up dialog - tile has no items`\n    }\n\n    this.positions = items.bunch.map(itemGroup => {\n      return { item: itemGroup.item, count: itemGroup.count }\n    })\n  }\n\n  public withItems(items: GroupedItem<Item>[]): void {\n    // TODO: Validate items are part of positions\n    this.player.on(new PickUpItemsEvent(this.tile, items, this.game))\n    this.endTurn()\n  }\n}\n","import { PresenterType, Presenter } from './internal'\nimport { Profession } from '../models/profession'\nimport { TalentsPickingPresenter } from './talents_picking_presenter'\nimport { Game, LevelMap, PickProfessionEvent } from '../../engine'\n\nexport class ProfessionPickingPresenter extends Presenter {\n  public readonly options: Profession[]\n\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(levelMap, game)\n    this.options = this.game.professionPicker.available(this.player)\n  }\n\n  get type(): PresenterType {\n    return PresenterType.ProfessionPicking\n  }\n\n  public pickProfession(pickedProfession: Profession) {\n    this.player.on(new PickProfessionEvent(pickedProfession))\n\n    this.redirect(\n      new TalentsPickingPresenter(this.level, this.levelMap, this.game)\n    )\n  }\n}\n","import { GroupedItem } from '../lib/bunch'\nimport { SingleItemUseListingPresenter } from './items_listing_presenter'\nimport { Item } from '../models/item'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { EquipmentPresenter } from './equipment_presenter'\n\nexport class PutOnItemsPresenter extends SingleItemUseListingPresenter {\n  public readonly title: string = 'Что надеть?'\n\n  constructor(\n    private onWithItem: (itemGroup: GroupedItem<Item>) => void,\n    public positions: GroupedItem<Item>[],\n    levelMap: LevelMap,\n    game: Game\n  ) {\n    super(levelMap, game)\n  }\n\n  protected initPositions(): void {}\n\n  public withItem(itemGroup: GroupedItem<Item>): void {\n    this.onWithItem(itemGroup)\n  }\n\n  public close(): void {\n    this.redirect(new EquipmentPresenter(this.levelMap, this.game))\n  }\n}\n","import { PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { PickPointPresenter } from './pick_point_presenter'\nimport { MoveEvent } from '../events/move_event'\n\nexport class TeleportationPresenter extends PickPointPresenter<\n  string,\n  undefined\n> {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(\n      levelMap,\n      game,\n      'x',\n      ({ x, y }) =>\n        levelMap.at(x, y).passibleThrough(this.player) &&\n        this.memory.at(x, y).seen\n    )\n  }\n\n  get type(): PresenterType {\n    return PresenterType.Teleportation\n  }\n\n  get title(): string {\n    return 'Выберите зону телепортации'\n  }\n\n  get body(): undefined[] {\n    return []\n  }\n\n  protected close(): void {\n    if (this.targetPos.eq(this.levelMap.creaturePos(this.player))) {\n      this.game.logger.playerTeleportedWhereTheyWere()\n    } else {\n      this.player.on(new MoveEvent(this.game, this.levelMap, this.targetPos))\n    }\n\n    this.endTurn()\n  }\n}\n","import { Point, twoDimArray, Mapped } from './utils'\n\nimport { sample } from 'lodash'\n\nconst FIRST_STEP: number = 1\n\nexport const leePath = function<Tile>(\n  map: Mapped<Tile>,\n  pos: Point,\n  tangible: (tile: Tile) => boolean,\n  destination: (point: Point, tile: Tile) => boolean,\n  randomDestination: boolean = false\n): Point[] {\n  let stageMemory: number[][] = twoDimArray(map.width, map.height, () => -1)\n  let pointsToVisit: Point[] = []\n  let pointsToCheck: Point[] = [pos]\n\n  let step = 0\n  while (pointsToCheck.length && !pointsToVisit.length) {\n    let wavePoints: Point[] = []\n\n    pointsToCheck.forEach((point: Point) => {\n      if (!map.inRange(point)) {\n        return\n      }\n\n      const tile = map.at(point.x, point.y)\n      // TODO: Compare, current value might be lower\n      if (tangible(tile) || stageMemory[point.x][point.y] !== -1) {\n        return\n      }\n\n      stageMemory[point.x][point.y] = step\n      if (destination(point, tile)) {\n        pointsToVisit.push(point)\n      } else {\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      }\n    })\n    step++\n\n    pointsToCheck = wavePoints\n  }\n\n  if (pointsToVisit.length) {\n    // TODO: Remove this check\n    let randomPointToVisit = sample(pointsToVisit)\n    if (randomDestination && randomPointToVisit) {\n      return buildRoad(randomPointToVisit, stageMemory)\n    } else {\n      return buildRoad(pointsToVisit[0], stageMemory)\n    }\n  } else {\n    return []\n  }\n}\n\nconst buildRoad = function(point: Point, stageMemory: number[][]): Point[] {\n  let lastPoint = point\n  let chain = [lastPoint]\n\n  let delta: Point | undefined\n\n  while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n    delta = Point.dxy.find(\n      (dp): boolean => {\n        return (\n          stageMemory[lastPoint.x + dp.x] &&\n          stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n            stageMemory[lastPoint.x][lastPoint.y] - 1\n        )\n      }\n    )\n\n    if (delta === undefined) {\n      return []\n    }\n\n    lastPoint = lastPoint.add(delta)\n\n    chain.unshift(lastPoint)\n  }\n\n  return chain\n}\n","import { PrimaryAttributes } from '../lib/race'\n\nimport { clone, sample } from 'lodash'\n\nexport const randomizeAttributes = function(\n  baseAttributes: PrimaryAttributes,\n  points: number\n): [PrimaryAttributes, number] {\n  let totalAttributes = clone(baseAttributes),\n    availableAttributes = Object.keys(baseAttributes),\n    deltaAttributes: PrimaryAttributes = {\n      strength: 0,\n      dexterity: 0,\n      constitution: 0,\n      intelligence: 0,\n      wisdom: 0,\n      charisma: 0,\n    },\n    randomAttribute\n\n  while (availableAttributes.length) {\n    availableAttributes = availableAttributes.filter(\n      attribute => totalAttributes[attribute] <= points\n    )\n    randomAttribute = sample(availableAttributes)\n\n    if (randomAttribute) {\n      points -= totalAttributes[randomAttribute]\n      deltaAttributes[randomAttribute] += 1\n      totalAttributes[randomAttribute] += 1\n    }\n  }\n\n  return [deltaAttributes, points]\n}\n","import { Application } from '../onisun'\nimport { allRaces, humanRace } from './races'\nimport { OnisunProfessionPicker } from './professions'\n\nimport {\n  TalentsPresenter,\n  Gender,\n  Race,\n  PrimaryAttributes,\n  Player,\n  Profession,\n  Talent,\n  PickTalentEvent,\n} from '../engine'\n\nimport { sample, mergeWith } from 'lodash'\n\nexport enum MenuComponent {\n  MainMenu,\n\n  ChooseGenderMenu,\n  ChooseRaceMenu,\n  ChooseProfessionMenu,\n  AttributesSelectionMenu,\n  EnterNameMenu,\n  BackgroundMenu,\n  TalentsMenu,\n}\n\nexport abstract class Menu {\n  constructor(protected application: Application) {}\n\n  abstract get component(): MenuComponent\n\n  protected redirect(menu: Menu): void {\n    this.application.menu = menu\n  }\n}\n\nexport class MainMenu extends Menu {\n  public newGame(): void {\n    this.redirect(new ChooseGenderMenu(this.application))\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.MainMenu\n  }\n}\n\nexport class ChooseGenderMenu extends Menu {\n  get component(): MenuComponent {\n    return MenuComponent.ChooseGenderMenu\n  }\n\n  public withGender(gender: Gender): void {\n    this.redirect(new ChooseRaceMenu(gender, this.application))\n  }\n\n  public random(): void {\n    this.withGender(sample([Gender.Male, Gender.Female]) || Gender.Female)\n  }\n\n  public back(): void {\n    this.application.menu = new MainMenu(this.application)\n  }\n}\n\nexport class ChooseRaceMenu extends Menu {\n  constructor(public gender: Gender, application: Application) {\n    super(application)\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.ChooseRaceMenu\n  }\n\n  public withRace(race: Race): void {\n    this.redirect(new ChooseProfessionMenu(this.gender, race, this.application))\n  }\n\n  public random(): void {\n    this.withRace(sample(allRaces) || humanRace)\n  }\n\n  public back(): void {\n    this.application.menu = new ChooseGenderMenu(this.application)\n  }\n}\n\nexport class ChooseProfessionMenu extends Menu {\n  public readonly professions: Profession[]\n\n  constructor(\n    public gender: Gender,\n    public race: Race,\n    application: Application\n  ) {\n    super(application)\n\n    // TODO: Optimize\n    this.professions = new OnisunProfessionPicker().pool\n  }\n\n  public withProfession(profession: Profession): void {\n    this.redirect(\n      new AttributesSelectionMenu(\n        this.gender,\n        this.race,\n        profession,\n        this.application\n      )\n    )\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.ChooseProfessionMenu\n  }\n\n  public back(): void {\n    this.redirect(new ChooseRaceMenu(this.gender, this.application))\n  }\n}\n\nexport class AttributesSelectionMenu extends Menu {\n  public readonly attributeNames: string[]\n  public readonly racialAttributes: PrimaryAttributes\n  public readonly genderAttributes: PrimaryAttributes\n  public readonly baseAttributes: PrimaryAttributes\n\n  constructor(\n    public gender: Gender,\n    public race: Race,\n    public profession: Profession,\n    application: Application\n  ) {\n    super(application)\n\n    this.attributeNames = Object.keys(this.race.primaryAttributes)\n\n    this.racialAttributes = this.race.primaryAttributes\n    this.genderAttributes = this.calcGenderAttributes(gender)\n\n    this.baseAttributes = this.sumAttributes(\n      this.racialAttributes,\n      this.genderAttributes\n    )\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.AttributesSelectionMenu\n  }\n\n  get points(): number {\n    return 200\n  }\n\n  public ready(deltaAttributes: PrimaryAttributes): void {\n    this.redirect(\n      new EnterNameMenu(\n        this.gender,\n        this.race,\n        this.profession,\n        this.sumAttributes(this.baseAttributes, deltaAttributes),\n        this.application\n      )\n    )\n  }\n\n  public back(): void {\n    this.redirect(\n      new ChooseProfessionMenu(this.gender, this.race, this.application)\n    )\n  }\n\n  private calcGenderAttributes(gender: Gender): PrimaryAttributes {\n    if (gender === Gender.Male) {\n      return {\n        strength: 1,\n        dexterity: -1,\n        constitution: 0,\n        intelligence: 0,\n        wisdom: 0,\n        charisma: 0,\n      }\n    } else {\n      return {\n        strength: -1,\n        dexterity: 1,\n        constitution: 0,\n        intelligence: 0,\n        wisdom: 0,\n        charisma: 0,\n      }\n    }\n  }\n\n  private sumAttributes(\n    attr1: PrimaryAttributes,\n    attr2: PrimaryAttributes\n  ): PrimaryAttributes {\n    return mergeWith({}, attr1, attr2, (x, y) => {\n      if (x) {\n        return x + y\n      }\n    })\n  }\n}\n\nexport class EnterNameMenu extends Menu {\n  constructor(\n    public gender: Gender,\n    public race: Race,\n    public profession: Profession,\n    public attributes: PrimaryAttributes,\n    application: Application\n  ) {\n    super(application)\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.EnterNameMenu\n  }\n\n  get maxLength(): number {\n    return 20\n  }\n\n  public withName(name: string): void {\n    const parentsProfession = sample(new OnisunProfessionPicker().pool)\n\n    if (!parentsProfession) {\n      throw 'EnterNameMenu: failed to get parentsProfession'\n    }\n\n    this.redirect(\n      new BackgroundMenu(\n        this.application.newPlayer(\n          this.gender,\n          this.race,\n          this.profession,\n          this.attributes,\n          name,\n          parentsProfession\n        ),\n        this.application\n      )\n    )\n  }\n\n  public back(): void {\n    this.redirect(\n      new AttributesSelectionMenu(\n        this.gender,\n        this.race,\n        this.profession,\n        this.application\n      )\n    )\n  }\n}\n\nexport class BackgroundMenu extends Menu {\n  constructor(public player: Player, application: Application) {\n    super(application)\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.BackgroundMenu\n  }\n\n  public next(): void {\n    this.redirect(new TalentsMenu(this.player, this.application))\n  }\n}\n\nexport class TalentsMenu extends Menu {\n  public points: number\n  public talentsPage: { professions: Profession[] }\n\n  constructor(public player: Player, application: Application) {\n    super(application)\n\n    this.points = 3 // TODO ?\n    this.talentsPage = { professions: player.professions }\n  }\n\n  public pickTalent(profession: Profession, talent: Talent): void {\n    if (this.points > 0) {\n      this.points -= 1\n      this.player.on(new PickTalentEvent(profession, talent))\n    }\n\n    if (this.points <= 0) {\n      this.application.initGame(this.player)\n    }\n  }\n\n  get component(): MenuComponent {\n    return MenuComponent.TalentsMenu\n  }\n}\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuOption.vue?vue&type=style&index=0&id=ba0a0e9e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuOption.vue?vue&type=style&index=0&id=ba0a0e9e&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AttributesSelectionMenu.vue?vue&type=style&index=0&id=78106fd2&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AttributesSelectionMenu.vue?vue&type=style&index=0&id=78106fd2&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseProfessionMenu.vue?vue&type=style&index=0&id=522a786e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseProfessionMenu.vue?vue&type=style&index=0&id=522a786e&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PlayerBackground.vue?vue&type=style&index=0&id=3c8afd9a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PlayerBackground.vue?vue&type=style&index=0&id=3c8afd9a&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPage.vue?vue&type=style&index=0&id=7ee95f8b&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPage.vue?vue&type=style&index=0&id=7ee95f8b&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&id=4527f8a2&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&id=4527f8a2&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickPointView.vue?vue&type=style&index=0&id=7db82404&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickPointView.vue?vue&type=style&index=0&id=7db82404&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BasePage.vue?vue&type=style&index=0&id=072a3c41&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BasePage.vue?vue&type=style&index=0&id=072a3c41&lang=scss&scoped=true&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EquipmentPage.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EquipmentPage.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HistoryInfoPage.vue?vue&type=style&index=0&id=b70be12e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HistoryInfoPage.vue?vue&type=style&index=0&id=b70be12e&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CharacterInfoView.vue?vue&type=style&index=0&id=96dddce8&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CharacterInfoView.vue?vue&type=style&index=0&id=96dddce8&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Game.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Game.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Main.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Main.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuOption.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./MenuOption.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nexport default Vue.extend({\n  name: 'MenuOption',\n  props: ['char', 'name', 'separator']\n})\n","import { render, staticRenderFns } from \"./MenuOption.vue?vue&type=template&id=ba0a0e9e&scoped=true&lang=pug&\"\nimport script from \"./MenuOption.vue?vue&type=script&lang=ts&\"\nexport * from \"./MenuOption.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./MenuOption.vue?vue&type=style&index=0&id=ba0a0e9e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ba0a0e9e\",\n  null\n  \n)\n\ncomponent.options.__file = \"MenuOption.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"menu-option\",class:{ \"-separator\": _vm.separator }},[_vm._v(\"[\"),_c('span',{staticClass:\"char\",domProps:{\"textContent\":_vm._s(_vm.char)}}),_vm._v(\"]\\n\"+_vm._s(_vm.name))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AttributesSelectionMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AttributesSelectionMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nimport { PrimaryAttributes, randomizeAttributes } from 'src/onisun'\n\nexport default Vue.extend({\n  name: 'AttributesSelectionMenu',\n  props: ['menu'],\n  data() {\n    return {\n      needConfirmation: false,\n      points: this.menu.points,\n      selectedAttributes: {\n        strength: 0,\n        dexterity: 0,\n        constitution: 0,\n        intelligence: 0,\n        wisdom: 0,\n        charisma: 0,\n      } as PrimaryAttributes,\n      attributeNames: this.menu.attributeNames\n    }\n  },\n  components: {\n    MenuOption\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n        case 'a':\n          return this.decrease(this.attributeNames[0])\n        case 'A':\n          return this.increase(this.attributeNames[0])\n\n        case 'b':\n          return this.decrease(this.attributeNames[1])\n        case 'B':\n          return this.increase(this.attributeNames[1])\n\n        case 'c':\n          return this.decrease(this.attributeNames[2])\n        case 'C':\n          return this.increase(this.attributeNames[2])\n\n        case 'd':\n          return this.decrease(this.attributeNames[3])\n        case 'D':\n          return this.increase(this.attributeNames[3])\n\n        case 'e':\n          return this.decrease(this.attributeNames[4])\n        case 'E':\n          return this.increase(this.attributeNames[4])\n\n        case 'f':\n          return this.decrease(this.attributeNames[5])\n        case 'F':\n          return this.increase(this.attributeNames[5])\n\n        case '*':\n          this.needConfirmation = false;\n          [this.selectedAttributes, this.points] = randomizeAttributes(this.menu.baseAttributes, this.menu.points)\n          return\n\n        case 'R':\n        case 'r':\n          if (this.needConfirmation) {\n            return this.menu.ready(this.selectedAttributes)\n          } else {\n            this.needConfirmation = true\n            return\n          }\n        case '=':\n          return this.menu.back()\n      }\n    },\n    attributeModifier(attribute: number): string {\n      if (attribute === 0) {\n        return '–'\n      } else if (attribute > 0) {\n        return `+${attribute}`\n      } else {\n        return attribute.toString()\n      }\n    },\n    keys(index: number): string {\n      return [\n        'aA',\n        'bB',\n        'cC',\n        'dD',\n        'eE',\n        'fF',\n      ][index]\n    },\n    totalAttribute(attributeName: string): number {\n      return this.menu.baseAttributes[attributeName] + this.selectedAttributes[attributeName]\n    },\n    canDecrease(attributeName: string): boolean {\n      return this.selectedAttributes[attributeName] > 0\n    },\n    canIncrease(attributeName: string): boolean {\n      return this.points >= this.totalAttribute(attributeName)\n    },\n    increase(attributeName: string) {\n      this.needConfirmation = false\n\n      if (this.canIncrease(attributeName)) {\n        this.points -= this.totalAttribute(attributeName)\n        this.selectedAttributes[attributeName] += 1\n      }\n    },\n    decrease(attributeName: string) {\n      this.needConfirmation = false\n\n      if (this.canDecrease(attributeName)) {\n        this.selectedAttributes[attributeName] -= 1\n        this.points += this.totalAttribute(attributeName)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./AttributesSelectionMenu.vue?vue&type=template&id=78106fd2&scoped=true&lang=pug&\"\nimport script from \"./AttributesSelectionMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./AttributesSelectionMenu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./AttributesSelectionMenu.vue?vue&type=style&index=0&id=78106fd2&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"78106fd2\",\n  null\n  \n)\n\ncomponent.options.__file = \"AttributesSelectionMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"Choose your attributes:\")]),_c('table',[_c('thead',[_c('tr',{staticClass:\"attribute-row -head\"},[_c('th'),_c('th',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('name','presenters.primaryAttributeSelection')))]),_c('th',{staticClass:\"racial\"},[_vm._v(_vm._s(_vm._f(\"t\")('racial','presenters.primaryAttributeSelection')))]),_c('th',{staticClass:\"gender\"},[_vm._v(_vm._s(_vm._f(\"t\")('gender','presenters.primaryAttributeSelection')))]),_c('th',{staticClass:\"base\"},[_vm._v(_vm._s(_vm._f(\"t\")('base','presenters.primaryAttributeSelection')))]),_c('th',{staticClass:\"selected\"},[_vm._v(_vm._s(_vm._f(\"t\")('selected','presenters.primaryAttributeSelection')))]),_c('th',{staticClass:\"total\"},[_vm._v(_vm._s(_vm._f(\"t\")('total','presenters.primaryAttributeSelection')))])])]),_c('tbody',_vm._l((_vm.attributeNames),function(name,index){return _c('tr',{staticClass:\"attribute-row\"},[_c('th',{staticClass:\"key\"},[_vm._v(\"[\"),_c('div',{staticClass:\"key\"},[_vm._v(_vm._s(_vm.keys(index)))]),_vm._v(\"]\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")(name,'primaryAttributes')))]),_c('td',{staticClass:\"racial\"},[_vm._v(_vm._s(_vm.menu.racialAttributes[name]))]),_c('td',{staticClass:\"gender\"},[_vm._v(_vm._s(_vm.attributeModifier(_vm.menu.genderAttributes[name])))]),_c('td',{staticClass:\"base\"},[_vm._v(_vm._s(_vm.menu.baseAttributes[name]))]),_c('td',{staticClass:\"selected\"},[_c('a',{staticClass:\"select-button float-left\",class:{ \"invisible\": !_vm.canDecrease(name) },on:{\"click\":function($event){_vm.decrease(name)}}},[_vm._v(\"-\")]),_vm._v(_vm._s(_vm.attributeModifier(_vm.selectedAttributes[name]))),_c('a',{staticClass:\"select-button float-right\",class:{ \"invisible\": !_vm.canIncrease(name) },on:{\"click\":function($event){_vm.increase(name)}}},[_vm._v(\"+\")])]),_c('td',{staticClass:\"total\"},[_vm._v(_vm._s(_vm.totalAttribute(name)))])])}))]),_c('div',{staticClass:\"points mt-3\"},[_vm._v(\" \"+_vm._s(_vm._f(\"t\")('points','presenters.primaryAttributeSelection', '', { points: _vm.points })))]),_c('div',{staticClass:\"menu-options\"},[_c('MenuOption',{attrs:{\"char\":\"R\",\"name\":_vm.needConfirmation ? 'Confirm' : 'Ready'}}),_c('MenuOption',{attrs:{\"char\":\"*\",\"name\":\"Random\",\"separator\":true}}),_c('MenuOption',{attrs:{\"char\":\"=\",\"name\":\"Back\"}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseGenderMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseGenderMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nimport { Gender } from 'src/onisun'\n\nexport default Vue.extend({\n  name: 'ChooseGenderMenu',\n  props: ['menu'],\n  components: {\n    MenuOption\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key.toUpperCase()) {\n      case 'M':\n        return this.menu.withGender(Gender.Male)\n      case 'F':\n        return this.menu.withGender(Gender.Female)\n      case '*':\n        return this.menu.random()\n      case '=':\n        return this.menu.back()\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ChooseGenderMenu.vue?vue&type=template&id=75cd738d&lang=pug&\"\nimport script from \"./ChooseGenderMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./ChooseGenderMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ChooseGenderMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"Choose a gender:\")]),_c('div',{staticClass:\"menu-options\"},[_c('MenuOption',{attrs:{\"char\":\"M\",\"name\":\"Male\"}}),_c('MenuOption',{attrs:{\"char\":\"F\",\"name\":\"Female\"}}),_c('MenuOption',{attrs:{\"char\":\"*\",\"name\":\"Random\",\"separator\":true}}),_c('MenuOption',{attrs:{\"char\":\"=\",\"name\":\"Back\",\"separator\":true}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nimport { Profession } from 'src/onisun'\n\nconst LETTER_OFFSET = 97\n\n// TODO: Add random option\n\nexport default Vue.extend({\n  name: 'ChooseProfessionMenu',\n  props: ['menu'],\n  data() {\n    return {\n      pickedProfession: undefined as Profession | undefined\n    }\n  },\n  computed: {\n    ready(): boolean {\n      return this.pickedProfession !== undefined\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n        case 'Enter':\n          if (this.pickedProfession) {\n            this.menu.withProfession(this.pickedProfession)\n          }\n          return\n        case '=':\n          return this.menu.back()\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      const profession = this.menu.professions[i]\n      this.pickedProfession = profession || this.pickedProfession\n    },\n    iconPath(professionName: string): string {\n      return `assets/professions/${professionName}.svg`\n    }\n  },\n  components: {\n    MenuOption\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseProfessionMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseProfessionMenu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ChooseProfessionMenu.vue?vue&type=template&id=522a786e&scoped=true&lang=pug&\"\nimport script from \"./ChooseProfessionMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./ChooseProfessionMenu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ChooseProfessionMenu.vue?vue&type=style&index=0&id=522a786e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"522a786e\",\n  null\n  \n)\n\ncomponent.options.__file = \"ChooseProfessionMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"Choose your profession:\")]),_c('div',{staticClass:\"professions-list\"},_vm._l((_vm.menu.professions),function(profession,i){return _c('div',{staticClass:\"profession-option\",class:{ \"-picked\": profession === _vm.pickedProfession },on:{\"click\":function($event){_vm.pickedProfession = profession}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(profession.name)}}),_c('div',{staticClass:\"note\"},[_c('span',{staticClass:\"key\"},[_vm._v(\"[\"),_c('span',{staticClass:\"char\"},[_vm._v(_vm._s(_vm._f(\"indexLetter\")(i)))]),_vm._v(\"]\\n\")]),_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")(profession.name,'professions')))])])])})),_c('div',{staticClass:\"menu-options\"},[(_vm.ready)?_c('MenuOption',{attrs:{\"char\":\"Enter\",\"name\":\"Done\",\"separator\":true}}):_vm._e(),_c('MenuOption',{attrs:{\"char\":\"=\",\"name\":\"Back\",\"separator\":!_vm.ready}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseRaceMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChooseRaceMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nimport { Gender, dwarfRace, humanRace } from 'src/onisun'\n\nexport default Vue.extend({\n  name: 'ChooseRaceMenu',\n  props: ['menu'],\n  components: {\n    MenuOption\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key.toUpperCase()) {\n      case 'H':\n        return this.menu.withRace(humanRace)\n      case 'D':\n        return this.menu.withRace(dwarfRace)\n      case '*':\n        return this.menu.random()\n      case '=':\n        return this.menu.back()\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ChooseRaceMenu.vue?vue&type=template&id=dbd0c452&lang=pug&\"\nimport script from \"./ChooseRaceMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./ChooseRaceMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ChooseRaceMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"You are \"+_vm._s(_vm.menu.gender)+\". Choose a race:\")]),_c('div',{staticClass:\"menu-options\"},[_c('MenuOption',{attrs:{\"char\":\"H\",\"name\":\"Human\"}}),_c('MenuOption',{attrs:{\"char\":\"D\",\"name\":\"Dwarf\"}}),_c('MenuOption',{attrs:{\"char\":\"*\",\"name\":\"Random\",\"separator\":true}}),_c('MenuOption',{attrs:{\"char\":\"=\",\"name\":\"Back\",\"separator\":true}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EnterNameMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EnterNameMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nexport default Vue.extend({\n  name: 'EnterNameMenu',\n  props: ['menu'],\n  data() {\n    return {\n      name: ''\n    }\n  },\n  components: {\n    MenuOption\n  },\n  computed: {\n    ready(): boolean {\n      return this.name.length > 0\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n        case 'Backspace':\n          this.name = this.name.slice(0, -1)\n          return\n        case 'Enter':\n          if (this.ready) {\n            this.menu.withName(this.name)\n          }\n          return\n        case '=':\n          return this.menu.back()\n        default:\n          if (event.key.length === 1 && this.name.length < this.menu.maxLength) {\n            this.name = this.name.concat(event.key)\n          }\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./EnterNameMenu.vue?vue&type=template&id=733d3eb3&lang=pug&\"\nimport script from \"./EnterNameMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./EnterNameMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"EnterNameMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"What's your name: \"+_vm._s(_vm.name))]),_c('div',{staticClass:\"menu-options\"},[(_vm.ready)?_c('MenuOption',{attrs:{\"char\":\"Enter\",\"name\":\"Done\"}}):_vm._e(),_c('MenuOption',{attrs:{\"char\":\"=\",\"name\":\"Back\"}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PlayerBackground.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PlayerBackground.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  name: 'PlayerBackground',\n  props: ['player']\n})\n","import { render, staticRenderFns } from \"./PlayerBackground.vue?vue&type=template&id=3c8afd9a&scoped=true&lang=pug&\"\nimport script from \"./PlayerBackground.vue?vue&type=script&lang=ts&\"\nexport * from \"./PlayerBackground.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PlayerBackground.vue?vue&type=style&index=0&id=3c8afd9a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3c8afd9a\",\n  null\n  \n)\n\ncomponent.options.__file = \"PlayerBackground.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"background my-3\"},[_c('p',[_vm._v(\"You were born \"+_vm._s(_vm._f(\"t\")(_vm.player.specie.gender,'genders'))+\" \"+_vm._s(_vm.player.specie.race.name))]),_c('p',[_vm._v(\"Your parents were \"+_vm._s(_vm._f(\"t\")(_vm.player.specie.parentsProfession.name,'professions'))+\".\")]),_c('p',[_vm._v(\"During your live you obtained basic skills of \"+_vm._s(_vm._f(\"t\")(_vm.player.specie.ownProfession.name,'professions'))+\".\")]),_c('p',[_vm._v(\"Now at age \"+_vm._s(_vm.player.age || 30)+\" you decided to begin your journey.\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BackgroundMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BackgroundMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\nimport PlayerBackground from '../PlayerBackground.vue'\n\nexport default Vue.extend({\n  name: 'HistoryMenu',\n  props: ['menu'],\n  components: {\n    MenuOption,\n    PlayerBackground\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key.toUpperCase()) {\n      case 'N':\n        return this.menu.next()\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./BackgroundMenu.vue?vue&type=template&id=30feb434&lang=pug&\"\nimport script from \"./BackgroundMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./BackgroundMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"BackgroundMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle\"},[_vm._v(\"Background\")]),_c('PlayerBackground',{attrs:{\"player\":_vm.menu.player}}),_c('div',{staticClass:\"menu-options\"},[_c('MenuOption',{attrs:{\"char\":\"N\",\"name\":\"Next\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MainMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MainMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport MenuOption from '../MenuOption.vue'\n\nexport default Vue.extend({\n  name: 'MainMenu',\n  props: ['menu'],\n  components: {\n    MenuOption\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key.toUpperCase()) {\n      case 'N':\n        return this.menu.newGame()\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MainMenu.vue?vue&type=template&id=36483f21&lang=pug&\"\nimport script from \"./MainMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./MainMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MainMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"menu-options\"},[_c('MenuOption',{attrs:{\"char\":\"N\",\"name\":\"New game\"}}),_c('MenuOption',{attrs:{\"char\":\"T\",\"name\":\"Tutorial\"}}),_c('MenuOption',{attrs:{\"char\":\"R\",\"name\":\"Random challenge\"}})],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { TalentStatus, Profession, Talent } from 'src/engine'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'TalentsPage',\n  props: ['screen', 'pickingEnabled'],\n  data() {\n    return {\n      picked: undefined as Talent | undefined,\n      pickedProfession: this.screen.professions[0] as Profession\n    }\n  },\n  computed: {\n    nameToLetter() {\n      let nameToLetter: { [key: string]: string } = {},\n       index: number = 0\n\n      for (let row of this.pickedProfession.grid) {\n        for (let talent of row) {\n          if (talent) {\n            nameToLetter[talent.name] = String.fromCharCode(LETTER_OFFSET + index++)\n          }\n        }\n      }\n\n      return nameToLetter\n    }\n  },\n  methods: {\n    confirmPick(doubleClickTalent: Talent | undefined) {\n      const pickedTalent = doubleClickTalent || this.picked\n\n      if (pickedTalent && pickedTalent.status(this.pickedProfession) === TalentStatus.Available) {\n        this.$emit('pickTalent', this.pickedProfession, pickedTalent)\n        this.picked = undefined\n      }\n    },\n    pickProfession(profession: Profession): void {\n      if (profession && this.pickedProfession && this.pickedProfession.name !== profession.name) {\n        this.picked = undefined\n        this.pickedProfession = profession\n      }\n    },\n    pickTalent(talent: Talent) {\n      if (this.pickingEnabled && talent.status(this.pickedProfession) === TalentStatus.Available) {\n        this.picked = talent\n      }\n    },\n    onEvent(event: KeyboardEvent): void {\n      switch (event.key) {\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n        return this.pickProfession(this.screen.professions[parseInt(event.key) - 1])\n      case ' ':\n      case 'Enter':\n        return this.confirmPick()\n      default:\n        for (let talent of this.pickedProfession.talents) {\n          if (this.nameToLetter[talent.name] === event.key) {\n            this.pickTalent(talent)\n            break\n          }\n        }\n      }\n    },\n    talentTip(talent: Talent): string {\n      let tip = `${talent.rank}/${talent.maxRank}`\n\n      if (this.pickingEnabled && talent.status(this.pickedProfession) === TalentStatus.Available) {\n        return `${this.nameToLetter[talent.name]} ${tip}`\n      } else {\n        return tip\n      }\n    },\n    talentPickedStatus(talent: Talent): string | undefined {\n      if (this.picked && this.picked.name === talent.name) {\n        return '-selected'\n      }\n      switch(talent.status(this.pickedProfession)) {\n      case TalentStatus.Available:\n        return '-available'\n      case TalentStatus.Unavailable:\n        return '-unavailable'\n      case TalentStatus.Completed:\n        return '-completed'\n      }\n    },\n    iconPath(talent: Talent): string {\n      return `${talent.name}.svg`\n    }\n  }\n})\n","import mod from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPage.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPage.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./TalentsPage.vue?vue&type=template&id=7ee95f8b&scoped=true&lang=pug&\"\nimport script from \"./TalentsPage.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsPage.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./TalentsPage.vue?vue&type=style&index=0&id=7ee95f8b&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7ee95f8b\",\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsPage.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover talents-container\",attrs:{\"id\":\"talents-container\"}},[_c('div',{staticClass:\"professions\"},_vm._l((_vm.screen.professions),function(profession,index){return _c('div',{key:profession.id,staticClass:\"profession-block\",class:{ '-active': profession.name == _vm.pickedProfession.name },on:{\"click\":function($event){_vm.pickProfession(profession)}}},[_vm._v(\"[\"),_c('div',{staticClass:\"key\"},[_vm._v(_vm._s(index + 1))]),_vm._v(\"] \"+_vm._s(_vm._f(\"t\")(profession.name,'professions'))+\" (\"+_vm._s(profession.level)+\")\")])})),_c('div',{staticClass:\"talents\"},[_c('div',{staticClass:\"subtitle mb-3\"},[_vm._v(_vm._s(_vm._f(\"t\")('talentsTaken','presenters.talentsPage', '', { count: _vm.pickedProfession.points })))]),_c('table',_vm._l((_vm.pickedProfession.grid),function(row,i){return _c('tr',{key:i},_vm._l((row),function(talent,j){return _c('td',{key:j,staticClass:\"cell\"},[(talent)?_c('div',{staticClass:\"talent-cell\",class:_vm.talentPickedStatus(talent),attrs:{\"id\":j + 'talentTree-'+i,\"variant\":\"primary\",\"dblclick\":\"confirmPick(talent)\"},on:{\"click\":function($event){_vm.pickTalent(talent)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/talents/' + _vm.iconPath(talent)}}),_c('span',{staticClass:\"level\"},[_vm._v(_vm._s(_vm.talentTip(talent)))]),_c('b-popover',{attrs:{\"target\":j + 'talentTree-'+i,\"triggers\":\"hover\",\"container\":\"talents-container\"}},[[_c('p',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")(talent.name,'talents', 'name')))]),_c('small',[_c('p',{staticClass:\"rank\"},[_vm._v(_vm._s(_vm._f(\"t\")('rank','presenters.talentsPage', '', { current: talent.rank, max: talent.maxRank })))]),(_vm.talentPickedStatus(talent) === '-unavailable')?_c('p',{staticClass:\"requirements\"},[_vm._v(_vm._s(_vm._f(\"t\")('requirements','presenters.talentsPage', '', { req: talent.depth * _vm.pickedProfession.depthCost }))+\"\\n\"+_vm._s(_vm._f(\"t\")(_vm.pickedProfession.name,'professions')))]):_vm._e(),_c('p',{staticClass:\"description\"},[_vm._v(_vm._s(_vm._f(\"t\")(talent.name,'talents', 'description')))])])]],2)],1):_vm._e()])}))}))]),(_vm.picked)?_c('b-btn',{staticClass:\"confirm\",attrs:{\"variant\":\"default\"},on:{\"click\":function($event){_vm.confirmPick()}}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickTalentsMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickTalentsMenu.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PlayerBackground from '../PlayerBackground.vue'\nimport TalentsPage from '../views/CharacterInfoPages/TalentsPage.vue'\n\nimport { Profession, Talent } from '../../src/onisun'\n\nexport default Vue.extend({\n  name: 'HistoryMenu',\n  props: ['menu'],\n  components: {\n    TalentsPage\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      this.$refs.talentsComponent.onEvent(event)\n    },\n    pickTalent(profession: Profession, talent: Talent): void {\n      this.menu.pickTalent(profession, talent)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PickTalentsMenu.vue?vue&type=template&id=361adc06&lang=pug&\"\nimport script from \"./PickTalentsMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./PickTalentsMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PickTalentsMenu.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"subtitle mb-3\"},[_vm._v(\"Pick talents (\"+_vm._s(_vm.menu.points)+\" left)\")]),_c('TalentsPage',{ref:\"talentsComponent\",attrs:{\"screen\":_vm.menu.talentsPage,\"picking-enabled\":true},on:{\"pickTalent\":_vm.pickTalent}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { takeRight } from 'lodash'\n\nimport { LogLevel, LogMessage, Logger } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: {\n    logger: {\n      type: Logger,\n      required: true\n    }\n  },\n  data() {\n    return {\n      lastId: 0,\n    }\n  },\n  computed: {\n    messages() {\n      const currentMessagesCount: number = this.logger.messages.length,\n        messages = takeRight(this.logger.messages, Math.max(currentMessagesCount - this.lastId, 5))\n      this.lastId = currentMessagesCount\n      return messages\n    }\n  },\n  methods: {\n    counter(value: number) {\n      if (value > 1) {\n        return `x${value}`\n      }\n    },\n    rowClass(record: LogMessage) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'debug'\n        case LogLevel.INFO:\n          return 'info'\n        case LogLevel.WARNING:\n          return 'warning'\n        case LogLevel.DANGER:\n          return 'danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=4926948c&scoped=true&lang=pug&\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts&\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4926948c\",\n  null\n  \n)\n\ncomponent.options.__file = \"Logger.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logger\"},_vm._l((_vm.messages),function(record,i){return _c('div',{key:i,class:_vm.rowClass(record)},[_vm._v(_vm._s(record.message)+\"\\n\"+_vm._s(_vm.counter(record.counter)))])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('幅').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Tile as UniTile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n  TileVisitor,\n\n  Wall,\n  Floor,\n  Tile,\n  StairwayDown,\n  StairwayUp,\n  Door,\n  Trap,\n  TriggerTile,\n  TrapType,\n  FallingRockTrap,\n} from '../src/onisun'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends UniTile {\n  public lighted(degree: number): UniTile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: UniTile, degree: number): UniTile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: UniTile, degree: number): UniTile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nclass ClosedDoorTile extends DisplayTile {\n  constructor() {\n    super('＋')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nclass OpenDoorTile extends ClosedDoorTile {\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('・')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('＃')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDownD extends DisplayTile {\n  constructor() {\n    super('＞')\n  }\n}\n\nexport class StairwayUpD extends DisplayTile {\n  constructor() {\n    super('＜')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('刀', 200, 200, 200)\nconst CORPSE = new ItemTile('体', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('胸', 200, 200, 200)\nconst MISSILE = new ItemTile('石', 200, 200, 200)\nconst MISSILE_WEAPON = new ItemTile(']', 200, 200, 200)\nconst BOOTS = new ItemTile('[', 255, 255, 0)\nconst SCROLL = new ItemTile('?', 255, 255, 255)\n\nconst POTION = new ItemTile('！', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    case ItemGroup.MissileWeapon:\n      return MISSILE_WEAPON\n    case ItemGroup.Potion:\n      return POTION\n    case ItemGroup.Boots:\n      return BOOTS\n    case ItemGroup.Scrolls:\n      return SCROLL\n    default:\n      return CORPSE\n  }\n}\n\nconst CLOSED_DOOR = new ClosedDoorTile()\nconst OPEN_DOOR = new OpenDoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDownD()\nconst STAIRWAY_UP = new StairwayUpD()\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst AIR_BLOW_TRAP = new DisplayTile('^', 255, 255, 255)\nconst TELEPORTATION_TRAP = new DisplayTile('^', 0, 191, 255)\nconst LIGHT_TRAP = new DisplayTile('^', 255, 255, 0)\nconst HOLE_TRAP = new DisplayTile('^', 139, 69, 19)\nconst BARE_WIRE_TRAP = new DisplayTile('^', 255, 165, 0)\nconst FALLING_ROCK_TRAP = new DisplayTile('^', 200, 200, 200)\nconst WATER_TRAP = new DisplayTile('^', 0, 0, 205)\n\nexport class DisplayTileVisitor extends TileVisitor {\n  public tile: DisplayTile\n\n  public onWall(wall: Wall): void {\n    this.tile = WALL\n  }\n\n  public onFloor(floor: Floor): void {\n    this.tile = FLOOR\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.tile = STAIRWAY_DOWN\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.tile = STAIRWAY_UP\n  }\n\n  public onDoor(door: Door): void {\n    if (door.open) {\n      this.tile = OPEN_DOOR\n    } else {\n      this.tile = CLOSED_DOOR\n    }\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      trap.tile.visit(this)\n      return\n    }\n\n    switch (trap.type) {\n    case TrapType.AirBlow:\n      this.tile = AIR_BLOW_TRAP\n      break\n    case TrapType.Teleportation:\n      this.tile = TELEPORTATION_TRAP\n      break\n    case TrapType.Light:\n      this.tile = LIGHT_TRAP\n      break\n    case TrapType.Hole:\n      this.tile = HOLE_TRAP\n      break\n    case TrapType.BareWire:\n      this.tile = BARE_WIRE_TRAP\n      break\n    case TrapType.FallingRock:\n      this.tile = FALLING_ROCK_TRAP\n      break\n    case TrapType.Water:\n      this.tile = WATER_TRAP\n      break\n    }\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    trigger.tile.visit(this)\n  }\n\n  protected default(tile: Tile): void {\n    this.tile = NULL_TILE\n  }\n}\n\nconst displayTileVisitor = new DisplayTileVisitor()\n\nexport const displayTile = function(tile): DisplayTile {\n  tile.visit(displayTileVisitor)\n  return displayTileVisitor.tile\n}\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  ItemTile,\n  DisplayTile,\n\n  displayItem,\n  displayTile,\n} from './scene_tiles'\nimport { Creature, Point } from 'src/engine';\n\nconst HUMAN  = new CreatureTile('＠', 0, 255, 0)\nconst RAT = new CreatureTile('r', 197, 65, 38)\nconst GOLEM = new CreatureTile('G', 120, 120, 120)\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('｜', 200, 200, 200),\n  new ItemTile('／', 200, 200, 200),\n  new ItemTile('ー', 200, 200, 200),\n  new ItemTile('＼', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player', 'pos'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      interval: 100,\n      step: 0,\n    }\n  },\n  methods: {\n    getTile(x: number, y: number) {\n      const effect = this.stage.at(x, y).effect\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULL_TILE\n      }\n\n      if (effect) {\n        if (tile.creature) {\n          let dTile = this.creatureTile(tile.creature).clone()\n          dTile.setBackground(200, 0, 0)\n          return dTile\n        } else {\n          return new DisplayTile(effect, 200, 200, 0)\n        }\n      }\n\n      if (tile.creature) {\n        return this.creatureTile(tile.creature)\n      }\n\n      if (tile.items) {\n        switch (tile.items.bunch.length) {\n        case 0:\n          break;\n        case 1:\n          return displayItem(tile.items.bunch[0].item)\n        default:\n          const frame = this.step % (this.animationFps * 3 + 4)\n          if (frame < nextItemAnimation.length) {\n            return nextItemAnimation[frame]\n          } else {\n            const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n            return displayItem(tile.items.bunch[itemId % tile.items.bunch.length].item)\n          }\n        }\n      }\n\n      return displayTile(tile)\n    },\n    creatureTile(creature: Creature) {\n      if (creature.name == 'Rat') {\n        return RAT\n      }\n\n      if (creature.name == 'Golem') {\n        return GOLEM\n      }\n\n      return HUMAN\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        Math.max(this.level.width, 40),\n        Math.max(this.level.height, 40),\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x: number, y: number) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.ts = ts\n      }\n\n      this.eng.update(this.pos.x, this.pos.y);\n      // this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level)\n    },\n    animationFps(): number {\n      return 1000 / this.interval\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    },\n    level() {\n      clearInterval(this.drawInterval)\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=0e91ae7c&lang=pug&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Scene.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { sum } from 'lodash'\n\nexport default Vue.extend({\n  name: 'PrimaryAttribute',\n  props: ['name', 'slug', 'attr', 'fullName'],\n  computed: {\n    id(): string {\n      return `${this.slug}-container`\n    },\n    modifier(): number {\n      return sum(this.attr.modifiers)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PrimaryAttribute.vue?vue&type=template&id=f39b08e2&lang=pug&\"\nimport script from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\nexport * from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PrimaryAttribute.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover\",attrs:{\"id\":_vm.id}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.attr.current))]),_c('b-popover',{attrs:{\"target\":_vm.id,\"triggers\":\"hover\",\"container\":_vm.id,\"placement\":\"top\"}},[[_c('big',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.fullName))]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Базовый:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.attr.current))])]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Модификатор:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.modifier))])])]],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { Item, Weapon, Armor, DamageType, ProtectionType, Damage, Protection } from '../src/onisun'\n\nexport const showItemDetails = function(item: Item): string | undefined {\n  if (item instanceof Weapon) {\n    return item.damages.map(showDamage).join(',')\n  } else if (item instanceof Armor) {\n    return item.protections.map(showProtection).join(',')\n  }\n}\n\nexport const showDamage = function({ extra, dice: { times, max }, type }: Damage): string {\n  let base = `${showDamageType(type)} ${times}d${max}`\n\n  if (extra) {\n    base += `+${extra}`\n  }\n\n  return base\n}\n\nexport const showDamageType = function(damageType: DamageType): string {\n  switch (damageType) {\n  case DamageType.Melee:\n    return 'Me'\n  case DamageType.Pierce:\n    return 'Pi'\n  case DamageType.Blunt:\n    return 'B'\n  case DamageType.Magic:\n    return 'Mg'\n  case DamageType.Pure:\n    return 'Pu'\n  default:\n    return 'unknown damage type'\n  }\n}\n\nexport const showProtection = function({ type, value } : Protection): string {\n  switch (type) {\n  case ProtectionType.Light:\n    return `L${value}`\n  case ProtectionType.Medium:\n    return `M${value}`\n  case ProtectionType.Heavy:\n    return `H${value}`\n  case ProtectionType.Solid:\n    return `S${value}`\n  case ProtectionType.Unarmored:\n    return `U${value}`\n  default:\n    return 'unknown protection type'\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PrimaryAttribute from './PrimaryAttribute.vue'\nimport { Attribute, Level } from 'src/engine'\n\nimport {\n  showProtection, showDamage\n} from './shows'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature', 'levelMap'],\n  components: {\n    PrimaryAttribute\n  },\n  computed: {\n    levelProgress(): string {\n      const level: Level = this.creature.level\n      return `${level.currentExperience  / level.requiredExperience * 100}%`\n    },\n    healthLevel(): string {\n      const attribute: Attribute = this.creature.health\n      return `${attribute.currentValue / (attribute.maximum || 0) * 100}%`\n    },\n    protections(): string {\n      return this.creature.protections.map(showProtection).join(', ')\n    },\n    damages(): string {\n      return this.creature.damages.map(showDamage).join(', ')\n    }\n  },\n  methods: {\n    displayAttribute(attribute: Attribute) {\n      if (attribute.currentValue != attribute.maximum) {\n        return `${attribute.currentValue} / ${attribute.maximum}`\n      } else {\n        return attribute.currentValue\n      }\n    },\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Stats.vue?vue&type=template&id=20a5072e&scoped=true&lang=pug&\"\nimport script from \"./Stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./Stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"20a5072e\",\n  null\n  \n)\n\ncomponent.options.__file = \"Stats.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel container\"},[_c('div',{staticClass:\"level cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.level.current))]),_c('div',{staticClass:\"note\"},[_vm._v(\"Уровень\"),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-bar bg-success\",style:({ width: _vm.levelProgress }),attrs:{\"role\":\"progressbar\"}})])])]),_c('div',{staticClass:\"hp cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.displayAttribute(_vm.creature.health)))]),_c('div',{staticClass:\"bar\",style:({ height: _vm.healthLevel })})]),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"strength\",\"name\":\"St\",\"full-name\":\"Сила\",\"attr\":_vm.creature.strength}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"dexterity\",\"name\":\"Dx\",\"full-name\":\"Ловкость\",\"attr\":_vm.creature.dexterity}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"constitution\",\"name\":\"Co\",\"full-name\":\"Телосложение\",\"attr\":_vm.creature.constitution}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"intelligence\",\"name\":\"In\",\"full-name\":\"Интеллект\",\"attr\":_vm.creature.intelligence}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"wisdom\",\"name\":\"Ws\",\"full-name\":\"Мудрость\",\"attr\":_vm.creature.wisdom}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"charisma\",\"name\":\"Ch\",\"full-name\":\"Харизма\",\"attr\":_vm.creature.charisma}}),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.levelMap.name))])]),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.protections))])]),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.damages))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { ImpactType } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Impacts',\n  props: ['impacts'],\n  methods: {\n    icon(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return 'blind'\n        case ImpactType.Stressed:\n          return 'weight'\n        case ImpactType.Loaded:\n          return 'weight'\n        case ImpactType.Overloaded:\n          return 'weight'\n      }\n    },\n    title(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return 'Слепота'\n        case ImpactType.Stressed:\n          return 'Нагружен'\n        case ImpactType.Loaded:\n          return 'Груженый'\n        case ImpactType.Overloaded:\n          return 'Перегруженый'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Impacts.vue?vue&type=template&id=436b0ad3&scoped=true&lang=pug&\"\nimport script from \"./Impacts.vue?vue&type=script&lang=ts&\"\nexport * from \"./Impacts.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"436b0ad3\",\n  null\n  \n)\n\ncomponent.options.__file = \"Impacts.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel\"},_vm._l((_vm.impacts),function(impact){return _c('div',{staticClass:\"impact-block\"},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/impacts/' + _vm.icon(impact) + '.svg'}}),_c('div',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title(impact))}})])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { Direction } from '../../src/onisun'\n\nexport default Vue.extend({\n  name: 'IdleView',\n  props: ['screen'],\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.move(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.move(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.move(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.move(Direction.down)\n      case 'y':\n        return this.screen.move(Direction.upLeft)\n      case 'u':\n        return this.screen.move(Direction.upRight)\n      case 'b':\n        return this.screen.move(Direction.downLeft)\n      case 'n':\n        return this.screen.move(Direction.downRight)\n\n      case 'H':\n        return this.screen.handleCommand()\n      case 'L':\n        return this.screen.lookCommand()\n\n      case 's':\n      case '.':\n        return this.screen.stayCommand()\n\n      case 'i':\n      case '#':\n        return this.screen.inventoryCommand()\n      case 'I':\n        return this.screen.bagCommand()\n      case 't':\n        return this.screen.missileCommand()\n      case ',':\n        return this.screen.pickUpCommand()\n      case 'd':\n        return this.screen.dropCommand()\n      case 'D':\n        return this.screen.drinkCommand()\n\n      case '@':\n        return this.screen.goToBaseInfo()\n      case '#':\n        return this.screen.goToInventory()\n      case '%':\n        return this.screen.goToTalents()\n      case '&':\n        return this.screen.goToHistoryInfo()\n\n      default:\n        console.log('Key: ', event.key)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./IdleView.vue?vue&type=template&id=110b55fd&lang=pug&\"\nimport script from \"./IdleView.vue?vue&type=script&lang=ts&\"\nexport * from \"./IdleView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"IdleView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const option = doubleClickOption || this.picked\n      if (option) {\n        this.screen.pickProfession(option)\n      }\n    },\n    onEvent(event: KeyboardEvent) {\n      switch(event.key) {\n      case 'a':\n        this.picked = this.screen.options[0]\n        break\n      case 'b':\n        this.picked = this.screen.options[1]\n        break\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        return\n      }\n    },\n    iconPath(professionName: string): string {\n      return `assets/professions/${professionName}.svg`\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ProfessionPickingView.vue?vue&type=template&id=4527f8a2&scoped=true&lang=pug&\"\nimport script from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ProfessionPickingView.vue?vue&type=style&index=0&id=4527f8a2&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4527f8a2\",\n  null\n  \n)\n\ncomponent.options.__file = \"ProfessionPickingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal text-center\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm._f(\"t\")('title','presenters.professionPickingView', '', { level: _vm.screen.level })))]),_c('div',{staticClass:\"content\"},_vm._l((_vm.screen.options),function(option,index){return _c('div',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option},\"dblclick\":function($event){_vm.close(option)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(option.name)}}),_vm._v(\"[\"),_c('span',{staticClass:\"key\"},[_vm._v(_vm._s(index === 0 ? 'a' : 'b'))]),_vm._v(\"]\\n\"),_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")(option.name,'professions')))]),_c('div',[_vm._v(_vm._s(_vm._f(\"t\")('rank','presenters.professionPickingView', '', { level: option.level + 1 })))])])})),_c('div',{staticClass:\"bottom\"},[(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":_vm.close}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { Player, GroupedItem, Item } from 'src/onisun'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    player(): Player {\n      return this.screen.player\n    },\n    carryingWeight(): string {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return `Нагрузка ${weight} из ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.withItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        if (this.screen.singleItemMode) {\n          this.screen.withItem(this.screen.positions[i])\n        } else if (this.selected.indexOf(i) >= 0) {\n          this.selected.splice(this.selected.indexOf(i), 1)\n        } else {\n          this.selected.push(i)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index: number) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position: GroupedItem<Item>) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    itemWeight(position: GroupedItem<Item>): number {\n      return Math.round(position.item.weight * position.count * 100) / 100\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ItemsListingView.vue?vue&type=template&id=18517940&lang=pug&\"\nimport script from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ItemsListingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"subtitle my-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"container positions-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.positionStatus(position)},[_c('td',{staticClass:\"selected\"},[(_vm.positionSelected(index))?_c('div',{staticClass:\"sign\"},[_vm._v(\"+\")]):_vm._e()]),_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(position.item.name)+\" (\"+_vm._s(position.count)+\")\")]),_c('td',{staticClass:\"weight\"},[_vm._v(\"[\"+_vm._s(_vm.itemWeight(position))+\"kg]\")])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPickingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsPickingView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { TalentStatus, Profession, Talent } from 'src/engine'\n\nimport TalentsPage from './CharacterInfoPages/TalentsPage.vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  name: 'TalentsPickingView',\n  methods: {\n    pickTalent(profession: Profession, talent: Talent): void {\n      this.screen.pickTalent(profession, talent)\n    },\n    onEvent(event: KeyboardEvent): void {\n      this.$refs.talentsComponent.onEvent(event)\n    },\n  },\n  components: {\n    TalentsPage,\n  }\n})\n","import { render, staticRenderFns } from \"./TalentsPickingView.vue?vue&type=template&id=c970e684&lang=pug&\"\nimport script from \"./TalentsPickingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsPickingView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsPickingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm._f(\"t\")('title','presenters.talentsPickingView')))]),_c('TalentsPage',{ref:\"talentsComponent\",attrs:{\"screen\":_vm.screen.talentsPage,\"picking-enabled\":true},on:{\"pickTalent\":_vm.pickTalent}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickPointView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickPointView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { Direction, LookPresenterVisibility } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'PickPointView',\n  props: ['screen'],\n  computed: {\n    title(): string {\n      switch (this.screen.title) {\n      case LookPresenterVisibility.See:\n        return 'Вижу ...'\n      case LookPresenterVisibility.Recall:\n        return 'Вспоминаю ...'\n      case LookPresenterVisibility.Hidden:\n        return 'Без понятия ...'\n      default:\n        return this.screen.title\n      }\n    }\n  },\n  methods: {\n    close(inputKey: KeyboardEvent) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case 'Escape':\n      case ' ':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PickPointView.vue?vue&type=template&id=7db82404&scoped=true&lang=pug&\"\nimport script from \"./PickPointView.vue?vue&type=script&lang=ts&\"\nexport * from \"./PickPointView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PickPointView.vue?vue&type=style&index=0&id=7db82404&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7db82404\",\n  null\n  \n)\n\ncomponent.options.__file = \"PickPointView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"look-modal\"},[_c('div',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title)}}),_vm._l((_vm.screen.body),function(msg){return _c('div',{domProps:{\"textContent\":_vm._s(msg)}})})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { Direction } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'MissileView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case '>':\n        this.screen.nextTarget()\n        break\n      case '<':\n        this.screen.previousTarget()\n        break\n      case 't':\n        this.screen.attack()\n        break\n      case 'Escape':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MissileView.vue?vue&type=template&id=7bd4158e&lang=pug&\"\nimport script from \"./MissileView.vue?vue&type=script&lang=ts&\"\nexport * from \"./MissileView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MissileView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { DieReason } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'DeathView',\n  props: ['screen'],\n  computed: {\n    message(): string {\n      switch (this.screen.dieReason) {\n      case DieReason.Attack:\n        return 'Смерть в бою честь для героя. Но жить мне все-таки нравилось больше'\n      case DieReason.Missile:\n        return 'Раньше меня вела дорога приключений, но теперь и мне прострелили колено'\n      case DieReason.Trap:\n        return 'Я так и не научился смотреть под ноги'\n      case DieReason.Overloaded:\n        return 'Тяжко уйти от бремени, которое сам себе навязываешь.'\n      default:\n        return 'Скучная смерть, которая даже не заслужила отдельного сообщения'\n      }\n    },\n    signature(): string {\n      return `Признался ${this.screen.playerName} перед смертью`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./DeathView.vue?vue&type=template&id=600d877a&lang=pug&\"\nimport script from \"./DeathView.vue?vue&type=script&lang=ts&\"\nexport * from \"./DeathView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./DeathView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"DeathView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"h4 title\"},[_vm._v(\"Ты умер\")]),_c('div',{staticClass:\"content mt-5\"},[_c('blockquote',{staticClass:\"blockquote text-center signature\"},[_c('p',{staticClass:\"mb-0\",domProps:{\"textContent\":_vm._s(_vm.message)}}),_c('footer',{staticClass:\"blockquote-footer\",domProps:{\"textContent\":_vm._s(_vm.signature)}})])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { PresenterType } from '../../src/onisun'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'PickSingleOptionView',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    title(): string {\n      switch (this.screen.type) {\n      case PresenterType.PickHandleOption:\n        return 'С чем взаимодействовать?'\n      }\n    }\n  },\n  methods: {\n    optionName(option): string {\n      switch (this.screen.type) {\n      case PresenterType.PickHandleOption:\n        return option[0]\n      }\n    },\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.options.length)) {\n        this.screen.pick(this.screen.options[i])\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PickSingleOptionView.vue?vue&type=template&id=08d3fe9c&scoped=true&lang=pug&\"\nimport script from \"./PickSingleOptionView.vue?vue&type=script&lang=ts&\"\nexport * from \"./PickSingleOptionView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"08d3fe9c\",\n  null\n  \n)\n\ncomponent.options.__file = \"PickSingleOptionView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title)}}),_c('table',{staticClass:\"container options-list\"},_vm._l((_vm.screen.options),function(option,index){return _c('tr',{key:index},[_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\",domProps:{\"textContent\":_vm._s(_vm.optionName(option))}})])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BasePage.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./BasePage.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  name: 'BasePage',\n  props: ['screen'],\n  methods: {\n    onEvent(event: KeyboardEvent): void {}\n  }\n})\n","import { render, staticRenderFns } from \"./BasePage.vue?vue&type=template&id=072a3c41&scoped=true&lang=pug&\"\nimport script from \"./BasePage.vue?vue&type=script&lang=ts&\"\nexport * from \"./BasePage.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./BasePage.vue?vue&type=style&index=0&id=072a3c41&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"072a3c41\",\n  null\n  \n)\n\ncomponent.options.__file = \"BasePage.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"content-col\"},[_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(\"Level:\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.currentLevel))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(\"Experience:\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.currentExperience))])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  LeftHandSlot,\n  RightHandSlot,\n  ChestSlot,\n  MissileSlot,\n  MissileWeaponSlot,\n  InventoryPresenterPosition,\n  Item,\n  Player,\n  Weapon,\n  Armor,\n  Damage,\n  DamageType,\n  Protection,\n  ProtectionType,\n} from '../../../src/engine'\n\nimport {\n  displayItem,\n} from './../../scene_tiles'\n\nimport {\n  showItemDetails\n} from '../../shows'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'EquipmentPage',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n    }\n  },\n  computed: {\n    player(): Player {\n      return this.screen.player\n    },\n    carryingWeight() {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return `Нагрузка ${weight} из ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent): void {\n      switch (event.key) {\n      case ' ':\n      case 'Escape':\n        return this.screen.close()\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        const position = this.screen.positions[i]\n        if (position.item) {\n          this.screen.takeOff(position)\n        } else if (position.availableItems.length) {\n          this.screen.putOn(position)\n        }\n      }\n    },\n    positionDetails(position: InventoryPresenterPosition): string  | undefined {\n      if (position.item && position.item.canSeeDetails) {\n        return showItemDetails(position.item)\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionStatus(position: InventoryPresenterPosition) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    displayBodyPart(bodyPart: ChestSlot): string {\n      return bodyPart.name\n    },\n    displayItem(item: Item): string | undefined {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    itemName(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `${position.item.name} ${position.count > 1 ? `(${position.count})` : ''}`\n      } else {\n        return '-'\n      }\n    },\n    itemWeight(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `[${position.item.weight * position.count}kg]`\n      }\n    },\n    available(position: InventoryPresenterPosition) {\n      return position.item || position.availableItems.length\n    },\n    availableStatus(position: InventoryPresenterPosition) {\n      return this.available(position) ? '-available' : '-unavailable'\n    }\n  }\n})\n","import mod from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EquipmentPage.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./EquipmentPage.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./EquipmentPage.vue?vue&type=template&id=4ce7291e&lang=pug&\"\nimport script from \"./EquipmentPage.vue?vue&type=script&lang=ts&\"\nexport * from \"./EquipmentPage.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./EquipmentPage.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"EquipmentPage.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"subtitle mb-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"content inventory-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.availableStatus(position)},[_c('td',{staticClass:\"slot\"},[_c('span',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('span',{staticClass:\"dash\"},[_vm._v(\"—\")]),_c('span',{staticClass:\"part\"},[_vm._v(_vm._s(_vm.displayBodyPart(position.inventorySlot)))]),_c('span',{staticClass:\"separator\"},[_vm._v(\":\")])]),_c('td',{staticClass:\"name-slot\"},[_c('span',{staticClass:\"name\",class:_vm.positionStatus(position)},[_vm._v(_vm._s(_vm.itemName(position)))]),_c('small',{staticClass:\"details\",domProps:{\"textContent\":_vm._s(_vm.positionDetails(position))}})]),_c('td',{staticClass:\"weight\"},[_vm._v(_vm._s(_vm.itemWeight(position)))])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HistoryInfoPage.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/ts-loader/index.js??ref--14-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./HistoryInfoPage.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PlayerBackground from '../../PlayerBackground.vue'\n\nexport default Vue.extend({\n  name: 'HistoryInfoPage',\n  props: ['screen'],\n  methods: {\n    onEvent(event: KeyboardEvent): void {}\n  },\n  components: {\n    PlayerBackground\n  }\n})\n","import { render, staticRenderFns } from \"./HistoryInfoPage.vue?vue&type=template&id=b70be12e&scoped=true&lang=pug&\"\nimport script from \"./HistoryInfoPage.vue?vue&type=script&lang=ts&\"\nexport * from \"./HistoryInfoPage.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./HistoryInfoPage.vue?vue&type=style&index=0&id=b70be12e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b70be12e\",\n  null\n  \n)\n\ncomponent.options.__file = \"HistoryInfoPage.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_c('div',{staticClass:\"content-col\"},[_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('name','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.name))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('gender','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm._f(\"t\")(_vm.screen.gender,'genders')))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('race','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm._f(\"t\")(_vm.screen.race.name,'races')))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('height','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.height)+\"sm\")])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('weight','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.weight)+\"kg\")])])]),_c('div',{staticClass:\"content-col\"},[_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('eye','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm._f(\"t\")(_vm.screen.eyeColor,'colors')))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('hair','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm._f(\"t\")(_vm.screen.hairColor,'colors')))])]),_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('skin','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm._f(\"t\")(_vm.screen.skinColor,'colors')))])])]),_c('div',{staticClass:\"content-col\"},[_c('div',{staticClass:\"attribute-row\"},[_c('span',{staticClass:\"name\"},[_vm._v(_vm._s(_vm._f(\"t\")('turns','presenters.baseInfo'))+\":\\n\")]),_c('span',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.screen.turns))])])]),_c('PlayerBackground',{attrs:{\"player\":_vm.screen.player}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CharacterInfoView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CharacterInfoView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue, { Component } from 'vue'\n\nimport BasePage from './CharacterInfoPages/BasePage.vue'\nimport EquipmentPage from './CharacterInfoPages/EquipmentPage.vue'\nimport HistoryInfoPage from './CharacterInfoPages/HistoryInfoPage.vue'\nimport TalentsPage from './CharacterInfoPages/TalentsPage.vue'\n\nimport { CharacterInfoPage, CharacterInfoPresenter } from '../../src/onisun'\n\ntype Option = {\n  type: CharacterInfoPage,\n  name: string,\n  key: string\n}\n\nexport default Vue.extend({\n  name: 'CharacterInfoView',\n  props: ['screen'],\n  methods: {\n    onEvent(event: KeyboardEvent): void {\n      switch (event.key) {\n      case '@':\n        return this.screen.goToBaseInfo()\n      case '#':\n        return this.screen.goToInventory()\n      case '%':\n        return this.screen.goToTalents()\n      case '&':\n        return this.screen.goToHistoryInfo()\n      case 'Escape':\n        return this.screen.goIdle()\n      default:\n        this.$refs.pageComponent.onEvent(event)\n      }\n    }\n  },\n  computed: {\n    page(): Component {\n      switch(this.screen.page) {\n        case CharacterInfoPage.Base:\n          return BasePage\n        case CharacterInfoPage.Equipment:\n          return EquipmentPage\n        case CharacterInfoPage.Talents:\n          return TalentsPage\n        case CharacterInfoPage.History:\n          return HistoryInfoPage\n        default:\n          return BasePage\n      }\n    },\n    pages(): Option[] {\n      return [\n        { type: CharacterInfoPage.Base, name: 'baseInfo', key: '@' },\n        { type: CharacterInfoPage.Equipment, name: 'equipment', key: '#' },\n        { type: CharacterInfoPage.Talents, name: 'talentsInfo', key: '%' },\n        { type: CharacterInfoPage.History, name: 'historyInfo', key: '&' },\n      ]\n    },\n    activeOption(): string {\n      let option = this.pages.find(({ type }) => type === this.screen.page)\n      return option ? option.name : 'baseInfo'\n    }\n  },\n  components: {\n    BasePage,\n    EquipmentPage,\n    TalentsPage,\n  }\n})\n","import { render, staticRenderFns } from \"./CharacterInfoView.vue?vue&type=template&id=96dddce8&scoped=true&lang=pug&\"\nimport script from \"./CharacterInfoView.vue?vue&type=script&lang=ts&\"\nexport * from \"./CharacterInfoView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./CharacterInfoView.vue?vue&type=style&index=0&id=96dddce8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"96dddce8\",\n  null\n  \n)\n\ncomponent.options.__file = \"CharacterInfoView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_vm._l((_vm.pages),function(ref){\nvar name = ref.name;\nvar key = ref.key;\nreturn _c('div',{staticClass:\"head-option\",class:{ '-active': _vm.activeOption === name }},[_vm._v(\"[\"),_c('span',{staticClass:\"key\"},[_vm._v(_vm._s(key))]),_vm._v(\"]\\n\"+_vm._s(_vm._f(\"t\")(name,'presenters.infoViewsHead')))])}),_c(_vm.page,{ref:\"pageComponent\",tag:\"component\",attrs:{\"screen\":_vm.screen}})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Game.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Game.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue,{ VueConstructor } from 'vue'\nimport * as _ from 'lodash'\n\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\nimport Stats from './Stats.vue'\nimport Impacts from './Impacts.vue'\n\nimport Idle from './views/IdleView.vue'\nimport ProfessionPickingView from './views/ProfessionPickingView.vue'\nimport ItemsListingView from './views/ItemsListingView.vue'\nimport TalentsPickingView from './views/TalentsPickingView.vue'\nimport PickPointView from './views/PickPointView.vue'\nimport MissileView from './views/MissileView.vue'\nimport DeathView from './views/DeathView.vue'\nimport PickSingleOptionView from './views/PickSingleOptionView.vue'\nimport CharacterInfoView from './views/CharacterInfoView.vue'\n\nimport { LevelMap, PresenterType, Presenter } from '../src/engine'\n\nimport { setInterval, clearInterval } from 'timers'\n\nexport default Vue.extend({\n  name: 'Game',\n  props: ['game'],\n  data() {\n    return {\n      loopIntervalId: undefined as number | undefined\n    }\n  },\n  components: {\n    Impacts,\n    Logger,\n    Scene,\n    Stats,\n  },\n  computed: {\n    viewComponent(): VueConstructor | undefined {\n      if (!this.game.playerTurn || !this.game.player.ai.presenter) {\n        return\n      }\n\n      switch (this.game.player.ai.presenter.type) {\n      case PresenterType.TalentsPicking:\n        return TalentsPickingView\n      case PresenterType.ProfessionPicking:\n        return ProfessionPickingView\n      case PresenterType.Idle:\n        return Idle\n      case PresenterType.ItemsListing:\n        return ItemsListingView\n      case PresenterType.Missile:\n        return MissileView\n      case PresenterType.Teleportation:\n      case PresenterType.Look:\n        return PickPointView\n      case PresenterType.Death:\n        return DeathView\n      case PresenterType.PickHandleOption:\n        return PickSingleOptionView\n      case PresenterType.CharacterInfo:\n        return CharacterInfoView\n      default:\n        throw `App: unknown presenter ${this.game.player.ai.presenter}`\n      }\n    }\n  },\n  methods: {\n    loop() {\n      this.game.turn()\n    },\n    onEvent(event: KeyboardEvent) {\n      const view = this.$refs.viewComponent\n      if (view) {\n        view.onEvent(event)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Game.vue?vue&type=template&id=bd47d198&lang=pug&\"\nimport script from \"./Game.vue?vue&type=script&lang=ts&\"\nexport * from \"./Game.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Game.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Game.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{attrs:{\"id\":\"game-screen\"}},[(_vm.game.player)?_c('Scene',{staticClass:\"scene\",attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player,\"pos\":_vm.game.currentMap.creaturePos(_vm.game.player)}}):_vm._e(),(_vm.game.player)?_c('Stats',{staticClass:\"player-stats\",attrs:{\"creature\":_vm.game.player,\"level-map\":_vm.game.currentMap}}):_vm._e(),_c('Logger',{staticClass:\"logger-panel\",attrs:{\"logger\":_vm.game.logger}}),_c('Impacts',{staticClass:\"effect-panel\",attrs:{\"impacts\":_vm.game.player.impacts}}),(_vm.game.playerTurn)?_c(_vm.viewComponent,{ref:\"viewComponent\",tag:\"component\",attrs:{\"screen\":_vm.game.player.ai.presenter}}):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue,{ Component } from 'vue'\n\nimport AttributesSelectionPage from './Menu/AttributesSelectionMenu.vue'\nimport ChooseGenderPage from './Menu/ChooseGenderMenu.vue'\nimport ChooseProfessionPage from './Menu/ChooseProfessionMenu.vue'\nimport ChooseRacePage from './Menu/ChooseRaceMenu.vue'\nimport EnterNamePage from './Menu/EnterNameMenu.vue'\nimport BackgroundPage from './Menu/BackgroundMenu.vue'\nimport MainMenuPage from './Menu/MainMenu.vue'\nimport PickTalentsPage from './Menu/PickTalentsMenu.vue'\n\nimport Game from './Game.vue'\n\nimport {\n  Application,\n  Point,\n  TitleGame,\n  Gender,\n  Race,\n  humanRace,\n  MainMenu,\n  MenuComponent,\n  Onisun\n} from '../src/onisun'\n\nimport Scene from './Scene.vue'\n\nconst LOOP_INTERVAL = 10\n\nexport default Vue.extend({\n  name: 'Main',\n  data() {\n    const app = new Application()\n    return {\n      app: app,\n      background: app.newTitleGame() as TitleGame,\n      loopIntervalId: undefined as number | undefined,\n      step: 0\n    }\n  },\n  computed: {\n    menuPage(): Component | undefined {\n      if (!this.app.menu) {\n        return\n      }\n\n      switch (this.app.menu.component) {\n        case MenuComponent.MainMenu:\n          return MainMenuPage\n        case MenuComponent.ChooseGenderMenu:\n          return ChooseGenderPage\n        case MenuComponent.ChooseRaceMenu:\n          return ChooseRacePage\n        case MenuComponent.ChooseProfessionMenu:\n          return ChooseProfessionPage\n        case MenuComponent.AttributesSelectionMenu:\n          return AttributesSelectionPage\n        case MenuComponent.EnterNameMenu:\n          return EnterNamePage\n        case MenuComponent.BackgroundMenu:\n          return BackgroundPage\n        case MenuComponent.TalentsMenu:\n          return PickTalentsPage\n      }\n    },\n    backgroundPos(): Point | undefined {\n      if (this.background.currentMap) {\n        return new Point(\n          Math.round(this.background.currentMap.width * 0.5),\n          Math.round(this.background.currentMap.height * 0.4)\n        )\n      }\n    },\n    game(): Onisun | null {\n      return this.app.mainGame\n    }\n  },\n  components: {\n    Scene,\n    Game\n  },\n  methods: {\n    loop() {\n      const gameComponent = this.$refs.gameComponent\n\n      if (this.game && this.$refs.gameComponent) {\n        this.$refs.gameComponent.loop()\n        return\n      }\n\n      if (this.background) {\n        this.step += 1\n\n        if (this.step >= 10) {\n          this.step = 0\n          this.background.turn()\n\n          if (this.background.done) {\n            this.background = this.app.newTitleGame()\n          }\n        }\n      }\n    },\n    onEvent(event: KeyboardEvent) {\n      const gameComponent = this.$refs.gameComponent\n      if (gameComponent) {\n        gameComponent.onEvent(event)\n      }\n\n      const menuComponent = this.$refs.menuComponent\n      if (menuComponent) {\n        menuComponent.onEvent(event)\n      }\n    }\n  },\n  created() {\n    this.loopIntervalId = window.setInterval(this.loop, LOOP_INTERVAL)\n    document.addEventListener('keydown', this.onEvent)\n  },\n  beforeDestroy() {\n    clearInterval(this.loopIntervalId)\n    document.removeEventListener('keydown', this.onEvent)\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Main.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Main.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Main.vue?vue&type=template&id=36264d0c&lang=pug&\"\nimport script from \"./Main.vue?vue&type=script&lang=ts&\"\nexport * from \"./Main.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Main.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Main.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container-fluid\"},[(_vm.game)?_c('Game',{ref:\"gameComponent\",attrs:{\"game\":_vm.game}}):(_vm.background)?_c('Scene',{attrs:{\"level\":_vm.background.currentMap,\"player\":_vm.background.player,\"pos\":_vm.backgroundPos}}):_vm._e(),(_vm.app.menu)?_c('div',{staticClass:\"title-view screen-modal\"},[_c('pre',{staticClass:\"title\"},[_vm._v(\" ██████╗ ███╗   ██╗██╗███████╗██╗   ██╗███╗   ██╗\\n██╔═══██╗████╗  ██║██║██╔════╝██║   ██║████╗  ██║\\n██║   ██║██╔██╗ ██║██║███████╗██║   ██║██╔██╗ ██║\\n██║   ██║██║╚██╗██║██║╚════██║██║   ██║██║╚██╗██║\\n╚██████╔╝██║ ╚████║██║███████║╚██████╔╝██║ ╚████║\\n ╚═════╝ ╚═╝  ╚═══╝╚═╝╚══════╝ ╚═════╝ ╚═╝  ╚═══╝\")]),_c(_vm.menuPage,{ref:\"menuComponent\",tag:\"component\",attrs:{\"menu\":_vm.app.menu}})],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport BootstrapVue from 'bootstrap-vue'\n\nimport Polyglot from 'node-polyglot'\n\nimport './application.scss'\nimport 'bootstrap/dist/css/bootstrap.css'\nimport 'bootstrap-vue/dist/bootstrap-vue.css'\n\nimport Main from './Main.vue'\n\nVue.use(BootstrapVue)\n\nfetch('locales/en.json', { cache: 'no-store' }).then((response) => response.json()).then((body) => {\n  const polyglot = new Polyglot({ phrases: body, locale: 'en' })\n\n  Vue.filter('t', (key: string, prefix: string, suffix: string, args: any) => {\n    return polyglot.t(suffix ? `${prefix}.${key}.${suffix}` : `${prefix}.${key}`, args)\n  })\n\n  const LETTER_OFFSET = 97\n\n  Vue.filter('indexLetter', (index: number) => {\n    return String.fromCharCode(LETTER_OFFSET + index)\n  })\n\n  new Vue({\n    el: '#app',\n    render: h => h(Main)\n  })\n})\n"],"sourceRoot":""}