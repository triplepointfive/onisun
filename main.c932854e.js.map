{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/grid.ts","webpack:///./src/App.vue?7183","webpack:///./src/Cell.vue?8e61","webpack:///./src/Cell.vue","webpack:///./src/Cell.vue?0939","webpack:///./src/fov.ts","webpack:///./src/App.vue","webpack:///./src/App.vue?fa88","webpack:///./src/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","p","jsonpArray","window","oldJsonpFunction","bind","slice","TileTypes","Direction","MapBlockState","Tile","[object Object]","key","display","type","this","register","tile","repository","Floor","Wall","Door","Block","content","weight","Dimensions","some","row","id","map","join","block","matchHorizontal","matchVertical","lodash__WEBPACK_IMPORTED_MODULE_0__","reverse","rotate","matrix","temp","left","right","top","bottom","BlockRepository","borderBlock","blocks","uniqBlockIds","Set","neighbors","addBlock","mirrored","has","add","findNeighbors","horizontalBlock","mirrorHorizontally","mirrorVertically","rotationBlock","rotateRight","availableBlocks","undefined","Bottom","Top","Right","Left","Math","random","centralBlock","forEach","matchTop","addNeighbor","matchBootom","matchLeft","matchRight","central","neighbor","direction","MapBlock","state","EMPTY","CONFIRMED","Random","Map","width","height","blockRepository","blockMap","steps","initializeBlockMap","confirmBlock","shuffledBlocks","available","k","fillMap","buildMap","addDoors","iterateHeight","iterateWidth","blockRow","concat","Array","fill","addDoor","retrive","__webpack_exports__","vue__WEBPACK_IMPORTED_MODULE_0__","extend","radius","player","x","y","components","Cell","_Cell_vue__WEBPACK_IMPORTED_MODULE_1__","computed","_fov__WEBPACK_IMPORTED_MODULE_2__","visibleThrough","build","methods","_grid__WEBPACK_IMPORTED_MODULE_4__","rawToTiles","lodash__WEBPACK_IMPORTED_MODULE_3__","postProcess","toMap","tiles","tileRow","split","fov","visible","opacity","degree","background","color","eval","vue_runtime_esm","props","cell","grid","__vue_styles__","context","Component","component_normalizer","_vm","_h","$createElement","_self","_c","class","style","domProps","textContent","_s","symbol","on","mouseover","$event","$emit","Fov","startx","starty","checkSolid","lightMap","doubleRadius","dx","dy","castLight","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","round","currentY","leftSlope","rightSlope","doubleDistance","src_App","App","attrs","staticClass","_l","visibility","click","updatePlayerPosition","_v","directives","rawName","expression","input","target","composing","$set","el","render","h"],"mappings":"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","file":"main.c932854e.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"\" + ({}[chunkId]||chunkId) + \".\" + {}[chunkId] + \".js\"\n \t}\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([22,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as _ from \"lodash\";\n\ntype BlockId = string;\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n}\n\nexport class Tile {\n  private static repository: { [key: string]: Tile } = {};\n\n  private static register(key: string, tile: Tile) {\n    if (this.repository[key]) {\n      throw `Tile '${key}' is already registered!`;\n    }\n\n    this.repository[key] = tile;\n  }\n\n  public static retrive(key: string): Tile {\n    let tile = this.repository[key];\n\n    if (!tile) {\n      throw `Tile '${key}' is not registered!`;\n    }\n\n    return tile;\n  }\n\n  // TODO: rename type to kind\n  constructor(public key: string, public display: string, public type: TileTypes) {\n    Tile.register(key, this);\n  }\n\n  public visibleThrough(): boolean {\n    return this.type === TileTypes.Floor;\n  }\n};\n\nnew Tile(\"R\", \" \", TileTypes.Floor);\nnew Tile(\"C\", \" \", TileTypes.Floor);\nnew Tile(\"W\", \"#\", TileTypes.Wall);\nnew Tile(\"D\", \"+\", TileTypes.Door);\n\nexport class Block {\n  public static readonly Dimensions = 3;\n\n  public id: BlockId;\n\n  constructor(public content: Tile[][], public weight: number) {\n    if (content.length !== Block.Dimensions || content.some(row => row.length !== Block.Dimensions)) {\n      throw `Invalid block '${content}'`;\n    }\n\n    this.id = content.map(row => row.map(tile => tile.key).join(\"\")).join(\"\");\n  }\n\n  public matchRight(block: Block): boolean {\n    return this.matchHorizontal(this, block);\n  }\n\n  public matchLeft(block: Block): boolean {\n    return this.matchHorizontal(block, this);\n  }\n\n  public matchTop(block: Block): boolean {\n    return this.matchVertical(block, this);\n  }\n\n  public matchBootom(block: Block): boolean {\n    return this.matchVertical(this, block);\n  }\n\n  public mirrorVertically(): Block {\n    return new Block(_.cloneDeep(this.content).reverse(), this.weight);\n  }\n\n  public mirrorHorizontally(): Block {\n    return new Block(_.cloneDeep(this.content).map(row => row.reverse()), this.weight);\n  }\n\n  public rotateRight(): Block {\n    return new Block(this.rotate(_.cloneDeep(this.content)), this.weight);\n  }\n\n  private rotate(matrix: any[][]): any[][] {\n    matrix = matrix.reverse();\n\n    let temp: number;\n    for (let i = 0; i < matrix.length; i++) {\n      for (let j = 0; j < i; j++) {\n        temp = matrix[i][j];\n        matrix[i][j] = matrix[j][i];\n        matrix[j][i] = temp;\n      }\n    }\n\n    return matrix;\n  }\n\n  private matchHorizontal(left: Block, right: Block): boolean {\n    return _.isEqual(\n      left.content.map(row => row[Block.Dimensions - 1]),\n      right.content.map(row => row[0]),\n    );\n  }\n\n  private matchVertical(top: Block, bottom: Block): boolean {\n    return _.isEqual(\n      top.content[Block.Dimensions - 1],\n      bottom.content[0],\n    );\n  }\n}\n\nenum Direction {\n  Top,\n  Bottom,\n  Left,\n  Right,\n};\n\ninterface Neighbors {\n  [key: string]: Block[];\n}\n\nexport class BlockRepository {\n  public blocks: Block[] = [];\n  public uniqBlockIds: Set<string> = new Set();\n\n  public neighbors: { [key: string]: Neighbors } = {};\n\n  constructor(public borderBlock: Block) {\n    this.addBlock(borderBlock);\n  }\n\n  public addBlock(block: Block, mirrored: boolean = false): void {\n    if (this.uniqBlockIds.has(block.id)) {\n      return;\n    }\n\n    this.blocks.push(block);\n    this.uniqBlockIds.add(block.id);\n\n    this.findNeighbors(block);\n\n    if (!mirrored) {\n      const horizontalBlock = block.mirrorHorizontally();\n\n      this.addBlock(horizontalBlock, true);\n      this.addBlock(block.mirrorVertically(), true);\n      this.addBlock(horizontalBlock.mirrorVertically(), true);\n    }\n\n    let rotationBlock = block.rotateRight();\n    for (let i = 0; i < 3; i++) {\n      this.addBlock(rotationBlock, true);\n      rotationBlock = rotationBlock.rotateRight();\n    }\n  }\n\n  public available(top: Block | undefined, bottom: Block | undefined,\n                   left: Block | undefined, right: Block | undefined): Block[] {\n    let availableBlocks = this.blocks;\n\n    if (top !== undefined) {\n      availableBlocks = _.intersection(availableBlocks, this.neighbors[top.id][Direction.Bottom]);\n    }\n\n    if (bottom !== undefined) {\n      availableBlocks = _.intersection(availableBlocks, this.neighbors[bottom.id][Direction.Top]);\n    }\n\n    if (left !== undefined) {\n      availableBlocks = _.intersection(availableBlocks, this.neighbors[left.id][Direction.Right]);\n    }\n\n    if (right !== undefined) {\n      availableBlocks = _.intersection(availableBlocks, this.neighbors[right.id][Direction.Left]);\n    }\n\n    return _.sortBy(availableBlocks, block => Math.random() * block.weight);\n    // return _.sortBy(availableBlocks, block => 1 * block.weight).reverse();\n  }\n\n  private findNeighbors(centralBlock: Block) {\n    this.blocks.forEach((block) => {\n      if (centralBlock.matchTop(block)) {\n        this.addNeighbor(centralBlock, block, Direction.Top);\n        this.addNeighbor(block, centralBlock, Direction.Bottom);\n      }\n\n      if (centralBlock.matchBootom(block)) {\n        this.addNeighbor(centralBlock, block, Direction.Bottom);\n        this.addNeighbor(block, centralBlock, Direction.Top);\n      }\n\n      if (centralBlock.matchLeft(block)) {\n        this.addNeighbor(centralBlock, block, Direction.Left);\n        this.addNeighbor(block, centralBlock, Direction.Right);\n      }\n\n      if (centralBlock.matchRight(block)) {\n        this.addNeighbor(centralBlock, block, Direction.Right);\n        this.addNeighbor(block, centralBlock, Direction.Left);\n      }\n    });\n  }\n\n  private addNeighbor(central: Block, neighbor: Block, direction: Direction) {\n    if (!this.neighbors[central.id]) {\n      this.neighbors[central.id] = {\n        [Direction.Top]: [],\n        [Direction.Bottom]: [],\n        [Direction.Left]: [],\n        [Direction.Right]: [],\n      };\n    }\n\n    this.neighbors[central.id][direction].push(neighbor);\n  }\n}\n\nenum MapBlockState {\n  EMPTY,\n  CONFIRMED,\n};\n\nclass MapBlock {\n  private state: MapBlockState;\n  public block?: Block;\n\n  constructor() {\n    this.state = MapBlockState.EMPTY;\n  }\n\n  public isFinished(): boolean {\n    return this.block !== undefined && this.state === MapBlockState.CONFIRMED;\n  }\n\n  public confirmBlock() {\n    this.state = MapBlockState.CONFIRMED;\n  }\n}\n\nclass Random {\n  public static addDoor(): boolean {\n    return Math.random() > 0.5;\n  }\n}\n\nexport class Map {\n  private blockMap: MapBlock[][] = [];\n  private map: Tile[][] = [];\n\n  private steps = 0;\n\n  constructor(public width: number, public height: number, private blockRepository: BlockRepository) {\n    this.initializeBlockMap();\n  }\n\n  public initializeBlockMap() {\n    for (let i = 0; i < this.height; i++) {\n      let row = [];\n\n      for (let j = 0; j < this.width; j++) {\n        let block = new MapBlock();\n\n        if (i === 0 || j === 0 || i === this.height - 1 || j === this.width - 1) {\n          block.confirmBlock();\n          block.block = this.blockRepository.borderBlock;\n        }\n\n        row.push(block);\n      }\n\n      this.blockMap.push(row);\n    }\n  }\n\n  public toMap(): Tile[][] {\n    return this.map;\n  }\n\n  public fillMap(i: number, j: number): boolean {\n    if (this.blockMap[i][j].block !== undefined) {\n      return true;\n    }\n    this.steps += 1;\n\n    if (this.steps > 100000) {\n      throw \"failed to generate\";\n    }\n\n    const top = this.blockMap[i - 1][j].block;\n    const bottom = this.blockMap[i + 1][j].block;\n    const left = this.blockMap[i][j - 1].block;\n    const right = this.blockMap[i][j + 1].block;\n\n    const shuffledBlocks = this.blockRepository.available(top, bottom, left, right);\n    for (let k = 0; k < shuffledBlocks.length; k++) {\n      const block: Block = shuffledBlocks[k];\n\n      this.blockMap[i][j].block = block;\n\n      const state = this.fillMap(i - 1, j)\n                 && this.fillMap(i, j - 1)\n                 && this.fillMap(i + 1, j)\n                 && this.fillMap(i, j + 1);\n\n      if (state) {\n        break;\n      }\n      else {\n        this.blockMap[i][j].block = undefined;\n      }\n    }\n\n    return this.blockMap[i][j].block !== undefined;\n  }\n\n  public postProcess(): void {\n    this.buildMap();\n    this.addDoors();\n  }\n\n  private buildMap(): void {\n    const iterateHeight = this.height - 1;\n    const iterateWidth = this.width - 1;\n\n    for (let i = 1; i < iterateHeight; i++) {\n      for (let k = 0; k < Block.Dimensions - (i === iterateHeight - 1 ? 0 : 1); k++) {\n        let row: Tile[] = [];\n\n        for (let j = 1; j < iterateWidth; j++) {\n          const block: Block | undefined = this.blockMap[i][j].block;\n\n          if (block) {\n            const blockRow = block.content[k];\n            row = row.concat(j === iterateWidth - 1 ? blockRow : _.initial(blockRow));\n          } else {\n            const blockRow: Tile[] = new Array(Block.Dimensions).fill(\" \");\n            row = row.concat(blockRow);\n          }\n        }\n\n        this.map.push(row);\n      }\n    }\n  }\n\n  private addDoors(): void {\n    for (let i = 1; i < this.map.length; i++) {\n      const row: Tile[] = this.map[i];\n\n      for (let j = 1; j < row.length; j++) {\n        if (row[j].key === \"C\" && (this.map[i][j - 1].key === \"R\" || this.map[i - 1][j].key === \"R\") && Random.addDoor()) {\n          row[j] = Tile.retrive(\"D\");\n        }\n      }\n    }\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport Component from 'vue-class-component'\n\nimport Cell from './Cell.vue'\n\nimport { Visibility, Fov } from './fov'\n\nimport * as _ from 'lodash'\n\nimport { Block, Map, Tile, BlockRepository } from './grid'\n\nexport default Vue.extend({\n  data() {\n    return {\n      blocks: [\n        { content: [\n          \"WWW\",\n          \"WWW\",\n          \"WWW\",\n        ], weight: 0.5},\n\n        { content: [\n          \"RRR\",\n          \"RRR\",\n          \"RRR\",\n        ], weight: 20},\n\n        { content: [\n          \"WCW\",\n          \"RRR\",\n          \"RRR\",\n        ], weight: 20},\n        { content: [\n          \"WWC\",\n          \"RRR\",\n          \"RRR\",\n        ], weight: 20},\n        { content: [\n          \"CWC\",\n          \"RRR\",\n          \"RRR\",\n        ], weight: 20},\n        { content: [\n          \"WWW\",\n          \"RRR\",\n          \"RRR\",\n        ], weight: 20},\n\n        { content: [\n          \"WCW\",\n          \"CRR\",\n          \"WRR\",\n        ], weight: 20},\n        { content: [\n          \"WWW\",\n          \"WRR\",\n          \"WRR\",\n        ], weight: 20},\n        { content: [\n          \"WWW\",\n          \"CRR\",\n          \"WRR\",\n        ], weight: 20},\n        { content: [\n          \"WWC\",\n          \"WRR\",\n          \"WRR\",\n        ], weight: 20},\n        { content: [\n          \"WWC\",\n          \"WRR\",\n          \"CRR\",\n        ], weight: 20},\n\n        { content: [\n          \"WWW\",\n          \"CCW\",\n          \"WCW\",\n        ], weight: 20},\n        { content: [\n          \"WWW\",\n          \"CCC\",\n          \"WWW\",\n        ], weight: 20},\n        { content: [\n          \"WCW\",\n          \"CCC\",\n          \"WWW\",\n        ], weight: 20},\n        { content: [\n          \"WCW\",\n          \"CCC\",\n          \"WCW\",\n        ], weight: 20},\n      ],\n      map: [],\n      radius: 10,\n      player: {\n        x: 1,\n        y: 1,\n      }\n    }\n  },\n  components: {\n    Cell\n  },\n  computed: {\n    fov(): Visibility[][] {\n      if (this.map) {\n        return new Fov(\n          this.player.x,\n          this.player.y,\n          this.radius,\n          this.map[0].length,\n          this.map.length,\n          (x: number, y: number) => !this.map[y][x].visibleThrough()\n        ).build();\n      }\n\n      return [];\n    }\n  },\n  methods: {\n    updatePlayerPosition(x: number, y: number) {\n      this.player.x = x;\n      this.player.y = y;\n    },\n    buildMap() {\n      let blockRepository = new BlockRepository(\n        new Block(this.rawToTiles(this.blocks[0].content), this.blocks[0].weight));\n      _.tail(this.blocks).forEach(({ content, weight }) => {\n        blockRepository.addBlock(new Block(this.rawToTiles(content), weight));\n      });\n\n      let blockMap = new Map(20, 20, blockRepository);\n      blockMap.fillMap(1, 1);\n      blockMap.postProcess();\n      return blockMap.toMap();\n    },\n    rawToTiles(map: string[]): Tile[][] {\n      let tiles: Tile[][] = [];\n      map.forEach((row) => {\n        let tileRow: Tile[] = [];\n        row.split(\"\").forEach((key) => {\n          tileRow.push(Tile.retrive(key));\n        });\n        tiles.push(tileRow);\n      });\n      return tiles;\n    },\n    visibility(i: number, j: number) {\n      if (this.fov[i][j].visible) {\n        return { 'opacity': this.fov[i][j].degree }\n      } else {\n        return { background: 'black', color: 'black' }\n      }\n    }\n  },\n  created() {\n    // TODO: OMG\n    eval(\"this.map = this.buildMap()\");\n  }\n})\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport { Tile, TileTypes } from './grid'\n\nexport default Vue.extend({\n  props: [\"cell\", 'player'],\n  computed: {\n    style() {\n      if (this.player) {\n        return 'player'\n      } else if (this.cell.type == TileTypes.Wall) {\n        return 'wall'\n      } else if (this.cell.type == TileTypes.Door) {\n        return 'door'\n      }\n\n      return 'floor'\n    },\n    symbol():any {\n      if (this.player) {\n        return '俺'\n      } else if (this.cell.display == ' ') {\n        return '・'\n      } else if (this.cell.display == '+') {\n        return '戸'\n      } else if (this.cell.display == '#') {\n        return '＃'\n      } else {\n        return 'E'\n      }\n    }\n  }\n})\n","function injectStyle (context) {\n  require(\"!!../node_modules/mini-css-extract-plugin/dist/loader.js!css-loader?{\\\"autoprefixer\\\":false,\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./Cell.vue\")\n}\n/* script */\nexport * from \"!!ts-loader?{\\\"appendTsSuffixTo\\\":[{}]}!../node_modules/vue-loader/lib/selector?type=script&index=0!./Cell.vue\"\nimport __vue_script__ from \"!!ts-loader?{\\\"appendTsSuffixTo\\\":[{}]}!../node_modules/vue-loader/lib/selector?type=script&index=0!./Cell.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-d3779db4\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=slm&optionsId=0!../node_modules/vue-loader/lib/selector?type=template&index=0!./Cell.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('td',{class:_vm.style,domProps:{\"textContent\":_vm._s(_vm.symbol)},on:{\"mouseover\":function($event){_vm.$emit('click')}}})}\nvar staticRenderFns = []\nexport { render, staticRenderFns }","export type Visibility = {\n  visible: boolean;\n  degree: number;\n};\n\nexport class Fov {\n  private lightMap: Visibility[][] = [];\n  private doubleRadius: number;\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private checkSolid: (x: number, y: number) => boolean\n  ) {\n    this.doubleRadius = this.radius * this.radius;\n  }\n\n  public build(): Visibility[][] {\n    this.lightMap = new Array(this.height);\n\n    for (let i = 0; i < this.height; i++) {\n      this.lightMap[i] = new Array(this.width);\n\n      for (let j = 0; j < this.width; j++) {\n        this.lightMap[i][j] = { visible: true, degree: 0.1 };\n      }\n    }\n\n    this.lightMap[this.starty][this.startx] = { visible: true, degree: 1 };\n\n    if (!this.checkSolid(this.startx, this.starty)) {\n      [[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0);\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy);\n      });\n    }\n\n    return this.lightMap;\n  }\n\n  private castLight(row: number, start: number, end: number, xx: number, xy: number, yx: number, yy: number) {\n    if (start < end) { return; }\n\n    let newStart = 0.0;\n    let blocked = false;\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance;\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy);\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy);\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5);\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5);\n\n        if (!(currentX >= 0 && currentY >= 0 && currentX < this.width && currentY < this.height) || start < rightSlope) {\n          continue;\n        } else if (end > leftSlope) {\n          break;\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.lightMap[currentY][currentX] = {\n            visible: true,\n            degree: 1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          };\n        }\n\n        if (blocked) { // previous cell was a blocking one\n          if (this.checkSolid(currentX, currentY)) { // hit a wall\n            newStart = rightSlope;\n          } else {\n            blocked = false;\n            start = newStart;\n          }\n        } else {\n          if (this.checkSolid(currentX, currentY) && distance < this.radius) { // hit a wall within sight line\n              blocked = true;\n              this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy);\n              newStart = rightSlope;\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y;\n  }\n}\n","function injectStyle (context) {\n  require(\"!!../node_modules/mini-css-extract-plugin/dist/loader.js!css-loader?{\\\"autoprefixer\\\":false,\\\"sourceMap\\\":false,\\\"minimize\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"scoped\\\":false,\\\"sourceMap\\\":false}!sass-loader?{\\\"sourceMap\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\n/* script */\nexport * from \"!!ts-loader?{\\\"appendTsSuffixTo\\\":[{}]}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!ts-loader?{\\\"appendTsSuffixTo\\\":[{}]}!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3b7b820a\\\",\\\"hasScoped\\\":false,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/template-compiler/preprocessor?engine=slm&optionsId=0!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('div',{staticClass:\"col\"},[_c('table',{staticClass:\"game-table\"},_vm._l((_vm.map),function(row,i){return _c('tr',{staticClass:\"row\"},_vm._l((row),function(cell,j){return _c('Cell',{key:i + '-' + j,style:(_vm.visibility(i, j)),attrs:{\"cell\":cell,\"player\":_vm.player.x == j && _vm.player.y == i},on:{\"click\":function($event){_vm.updatePlayerPosition(j, i)}}})}))})),_c('button',{on:{\"click\":function($event){_vm.map = _vm.buildMap()}}},[_vm._v(\"Generate!\")]),_c('label',[_vm._v(\"radius\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.radius),expression:\"radius\"}],attrs:{\"type\":\"number\"},domProps:{\"value\":(_vm.radius)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.radius=$event.target.value}}})]),_c('div',{staticClass:\"col\"},_vm._l((_vm.blocks),function(tile,i){return _c('div',{staticClass:\"block\"},[_c('div',{staticClass:\"wrapper\"},[_c('table',{staticClass:\"content game-table\"},_vm._l((_vm.rawToTiles(tile.content)),function(row,i){return _c('tr',{staticClass:\"row\"},_vm._l((row),function(cell,j){return _c('Cell',{key:i + '-' + j,attrs:{\"cell\":cell}})}))})),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(tile.weight),expression:\"tile.weight\"}],attrs:{\"type\":\"number\"},domProps:{\"value\":(tile.weight)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tile, \"weight\", $event.target.value)}}})])])}))])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }","import Vue from \"vue\";\nimport App from \"./App.vue\";\n\nimport \"./application.css\";\n\nimport \"bootstrap\"\n\nnew Vue({\n  el: \"#app\",\n  render: h => h(App)\n});\n"],"sourceRoot":""}