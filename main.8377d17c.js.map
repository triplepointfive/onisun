{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/Logger.vue?5783","webpack:///./components/Scene.vue?bf04","webpack:///./components/stats.vue?0476","webpack:///./components/views/ProfessionPickingView.vue?aab7","webpack:///./components/views/ItemsListingView.vue?a6a8","webpack:///./components/views/TalentsTreeView.vue?d891","webpack:///./components/views/InventoryView.vue?5002","webpack:///./components/App.vue?6fed","webpack:///./src/engine/utils.ts","webpack:///./src/engine/fov.ts","webpack:///./src/engine/characteristics.ts","webpack:///./src/engine/items/internal.ts","webpack:///./src/engine/tile.ts","webpack:///./src/engine/creature.ts","webpack:///./src/engine/ai/internal.ts","webpack:///./src/engine/ai/attacker.ts","webpack:///./src/engine/ai/chaser.ts","webpack:///./src/engine/ai/meta_ai.ts","webpack:///./src/engine/ai/escaper.ts","webpack:///./src/engine/ai/explorer.ts","webpack:///./src/engine/ai/loiter.ts","webpack:///./src/engine/ai/patrol.ts","webpack:///./src/engine/ai/player_ai.ts","webpack:///./src/engine/ai/picker.ts","webpack:///./src/engine/ai/selfhealer.ts","webpack:///./src/engine/ai/descender.ts","webpack:///./src/engine/ai/thrower.ts","webpack:///./src/engine/effect.ts","webpack:///./src/engine/generator/post.ts","webpack:///./src/engine/dungeon.ts","webpack:///./src/engine/inventory_slot.ts","webpack:///./src/engine/inventory.ts","webpack:///./src/engine/logger.ts","webpack:///./src/engine/profession.ts","webpack:///./src/engine/timeline.ts","webpack:///./src/engine/level_map.ts","webpack:///./src/engine/level.ts","webpack:///./src/engine/memory.ts","webpack:///./src/engine/game.ts","webpack:///./src/engine/pool.ts","webpack:///./src/engine/generator/drawn.ts","webpack:///./src/engine/generator/dungeon.ts","webpack:///./src/engine/presenters/internal.ts","webpack:///./src/engine/presenters/idle_presenter.ts","webpack:///./src/engine/events/internal.ts","webpack:///./src/engine/events/add_experience_event.ts","webpack:///./src/engine/events/attack_event.ts","webpack:///./src/engine/events/drink_potion_event.ts","webpack:///./src/engine/events/drop_items_event.ts","webpack:///./src/engine/events/throw_event.ts","webpack:///./src/engine/events/missile_attack_event.ts","webpack:///./src/engine/events/pick_up_items_event.ts","webpack:///./src/engine/events/put_on_item_event.ts","webpack:///./src/engine/events/take_off_item_event.ts","webpack:///./src/engine/events/trap_event.ts","webpack:///./src/engine/presenters/inventory_presenter.ts","webpack:///./src/engine/presenters/missile_presenter.ts","webpack:///./src/engine/presenters/items_listing_presenter.ts","webpack:///./src/engine/presenters/talents_tree_presenter.ts","webpack:///./src/engine/presenters/profession_picking_presenter.ts","webpack:///./components/Logger.vue?93db","webpack:///./components/Logger.vue?dfa9","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?1a76","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./src/onisun/talents.ts","webpack:///./src/onisun/professions.ts","webpack:///./src/onisun/items.ts","webpack:///./src/onisun/potions.ts","webpack:///./src/onisun/creatures.ts","webpack:///./src/engine/ai/dispatcher.ts","webpack:///./src/onisun/tiles.ts","webpack:///./src/onisun/dungeons/tutorial_dungeon.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/Scene.vue?a309","webpack:///./components/Scene.vue?972d","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?9a37","webpack:///./components/PrimaryAttribute.vue?99e7","webpack:///./components/PrimaryAttribute.vue?fa93","webpack:///./components/PrimaryAttribute.vue","webpack:///./components/PrimaryAttribute.vue?7f35","webpack:///./components/stats.vue?ed27","webpack:///./components/stats.vue?81dd","webpack:///./components/stats.vue","webpack:///./components/stats.vue?8715","webpack:///./components/views/IdleView.vue?bc3e","webpack:///./components/views/IdleView.vue?d3da","webpack:///./components/views/IdleView.vue","webpack:///./components/views/IdleView.vue?a410","webpack:///./components/views/ProfessionPickingView.vue?69ea","webpack:///./components/views/ProfessionPickingView.vue?b4ad","webpack:///./components/views/ProfessionPickingView.vue","webpack:///./components/views/ProfessionPickingView.vue?b37c","webpack:///./components/views/ItemsListingView.vue?4aeb","webpack:///./components/views/ItemsListingView.vue?a2d9","webpack:///./components/views/ItemsListingView.vue","webpack:///./components/views/ItemsListingView.vue?868a","webpack:///./components/views/TalentsTreeView.vue?3b29","webpack:///./components/views/TalentsTreeView.vue?639b","webpack:///./components/views/TalentsTreeView.vue","webpack:///./components/views/TalentsTreeView.vue?6f68","webpack:///./components/views/InventoryView.vue?c09a","webpack:///./components/views/InventoryView.vue?0d4b","webpack:///./components/views/InventoryView.vue","webpack:///./components/views/InventoryView.vue?2096","webpack:///./components/views/MissileView.vue?1488","webpack:///./components/views/MissileView.vue?2e63","webpack:///./components/views/MissileView.vue","webpack:///./components/views/MissileView.vue?e1ae","webpack:///./components/App.vue?a6a8","webpack:///./components/App.vue?c0b2","webpack:///./src/onisun.ts","webpack:///./components/App.vue","webpack:///./components/App.vue?be4d","webpack:///./components/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Rect","[object Object]","x","y","w","h","this","succ","String","fromCharCode","charCodeAt","rand","max","Math","floor","random","twoDimArray","width","height","field","Array","min","list","Point","point","abs","dxy","map","add","Mapped","on","forEach","column","tile","cycle","dx","pop","unshift","bresenham","p0","p1","x0","x1","y0","y1","steps","delta","round","bresenhamInclusion","Direction","super","up","down","left","right","upLeft","upRight","downLeft","downRight","Fov","startx","starty","radius","solidChecker","markVisible","doubleRadius","isSolid","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","characteristics_Attribute","current","modifiers","modifier","increase","decrease","lodash","val","PositiveAttribute","currentValue","AttributeSet","attack","defense","dexterity","health","speed","pairSet","Modifier","weight","Characteristics","with","char","mod","addModifier","removeModifier","victim","dex","pow","misses","missile","regenerationValue","specie","constantIncrease","Usage","ItemGroup","ItemSubgroup","internal_Item","group","usages","id","getId","lastId","creature","characteristics","item","player","inventoryItemId","GroupedItem","count","groupsWith","internal_ItemsBunch","bunch","find","invItem","inventoryItem","inv","groupedItem","put","Corpse","Consumable","Potion","Missile","MissileWeapon","Shoot","BodyArmor","WearsOnBody","OneHandWeapon","WeaponOneHand","TileTypes","Clan","Ability","tile_Tile","kind","items","Floor","actor","Wall","buildNew","clone","tileVisitor","onFloor","Corridor","tile_Room","Door","onDoor","onWall","Stairway","StairwayDown","currentMap","adjacentMapId","onStairwayDown","StairwayUp","onStairwayUp","Trap","revealed","type","onTrap","game","affect","TileVisitor","wall","default","stairway","onStairway","door","trap","allAbilities","GoStairwayDown","Inventory","PutOn","Throwing","Specie","clan","abilities","creature_Phantom","refToReal","ability","Reaction","creature_VisibilityTileVisitor","stage","visible","at","visit","pos","visibleThrough","creature_SteppingTileVisitor","activate","creature_Creature","ai","stageMemories","dead","inventory","inventory_Inventory","level","previousPos","copy","currentLevel","addCreature","visionMask","removeCreature","addItem","slots","equipment","cares","event","affectCreature","levelId","act","nextPoint","nextLevel","leave","enter","undefined","phantom","stageMemory","resetVisible","memory_Memory","visitor","degree","see","calc","Player","professions","affectPlayer","FIRST_STEP","internal_AI","prevAI","destination","eq","path","leePath","move","nextTo","randomDestination","pointsToVisit","pointsToCheck","step","wavePoints","inRange","tangible","wrappers","dist","buildRoad","lastPoint","chain","dp","tileVisited","enemy","FreeForAll","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","goTo","onMove","onReach","onCantMove","moveTo","GoToTileAI","metaAI","matcher","attacker_Attacker","canAttack","firstTurn","victimInAccess","pickNewVictim","attack_event_AttackEvent","DIE","findCreature","enemies","real","condition","memory","chaser_Chaser","reset","victimId","victimSet","buildVictimPath","foundNewVictim","followTo","withinView","AIEvent","logger","AIItemPickedEvent","meta_ai_MetaAI","aiToRun","events","resetEvents","STEP_DISTANCE","escaper_Escaper","escapesFrom","foundEnemies","buildPath","minDistance","explorer_Explorer","seen","loiter_Loiter","NEW_POINT_EVERY","patrol_PatrolTileVisitor","status","patrol_Patrol","graph","graphlib","lastNodeVisit","markNodeVisited","currentNodeID","nodes","moveToTarget","targetNodeID","pickUpNewTarget","addNode","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","player_ai_AINewLevelEvent","presenter","profession_picking_presenter_ProfessionPickingPresenter","talents_tree_presenter_TalentsTreePresenter","player_ai_PlayerAI","levelUps","idle_presenter_IdlePresenter","picker_Picker","desiredItemId","can","available","findItem","pushEvent","putToBag","selfhealer_SelfHealer","atMax","descender_Descender","canDescend","thrower_Thrower","hasMissile","missile_attack_event_MissileAttackEvent","reaction","previousVictim","missiles","missileSlot","obstacles","target","Effect","onDone","ItemFlightEffect","frames","done","effect","patchMemory","addDoors","doorTile","addDoor","setTile","addCreatures","chance","creaturesPool","passibleThrough","pick","addToMap","addItems","itemsPool","centralize","minX","minY","maxX","maxY","addOnTile","match","onValid","iters","dungeon_Dungeon","levels","adjustMapId","addStairs","isFloor","inventory_slot_InventorySlot","useSingleItem","filter","itemGroup","onTakeOff","groupItem","findInBag","removeFromBag","onPutOn","inventory_slot_RightHandSlot","inventory_slot_LeftHandSlot","inventory_slot_BodySlot","inventory_slot_BootsSlot","Boots","inventory_slot_MissileWeaponSlot","baseMatch","matchingItems","worksWith","inventory_slot_MissileSlot","Throw","missileWeapon","missileWeaponSlot","bag","rightHandSlot","leftHandSlot","bodySlot","bootsSlot","remove","LogLevel","TalentStatus","logger_Logger","messages","damage","debug","warning","addMessage","DEBUG","INFO","DANGER","message","WARNING","lastRow","counter","timeline_Timeline","turns","ts","element","parseInt","actors","level_map_LevelMap","creatures","timeline","enterPos","adjustId","stairPos","each","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","levelUp","MemoryTile","baseTile","game_Game","running","maps","Map","rebuildVision","levelMapTurn","levelMap","Function","set","generator","actorId","next","pool_Pool","totalWeight","ceil","input","pool","totalPool","Profession","points","talents","depthCost","profession_ProfessionPicker","maxLevel","maxTaken","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","profession","some","excludeProfessions","excluding","concat","Talent","depth","rank","maxRank","description","drawn","drawMap","collection","charAt","THICKNESS","RAY_TURNS","DELTA_ANGLE","PI","dungeon_Room","rect","walls","newRoomSpace","dungeon_Road","lined","newCorridor","hx","hy","horizontalLine","vx","vy","verticalLine","PresenterType","IdleInputKey","generator_dungeon","dimX","dimY","minSize","maxSize","roomsCount","newWall","dungeon","rooms","fill","_","generateRoom","normalize","ray","roads","buildRoads","reduce","pickedRooms","currentRoom","angle","cos","sin","roomToMove","ndx","ndy","every","room","notCross","pointWithin","connectedPoints","point1","point2","currentPoint","pointToConnect","currentDistance","CreatureEvent","subject","add_experience_event_AddExperienceEvent","NOTHING","missMessage","DODGE","damageTo","killMessage","die","hurtMessage","HURT","drink_potion_event_DrinkPotionEvent","potion","onDrink","drink","drop_items_event_DropItemsEvent","droppedItem","throw_event_ThrowEvent","throwMisses","throwMissMessage","THROW_DODGE","throwDamageTo","throwKillMessage","throwHurtMessage","slot","removeItem","flightPath","pick_up_items_event_PickUpItemsEvent","tileItems","pickedUpItem","put_on_item_event_PutOnItemEvent","equip","putOn","take_off_item_event_TakeOffItemEvent","takeOff","trap_event_TrapEvent","creatureSteppedInTrap","doDamage","youSteppedInTrap","Presenter","endTurn","redirect","inventory_presenter_InventoryPresenter","positions","takeTime","rebuildPositions","position","inventorySlot","items_listing_presenter_PutOnItemsPresenter","availableItems","missile_presenter_MissilePresenter","targetEnemyIndex","findEnemies","resetTargetId","updateTarget","direction","dest","targetPos","resetPath","stop","newPos","drawPath","idle_presenter_HandleTileVisitor","adjacentMap","getMap","matchStairs","howToHandle","Idle","Right","Left","Down","Up","UpRight","UpLeft","DownRight","DownLeft","Handle","handle","PickUp","pickUpDialog","missileDialog","Drop","items_listing_presenter_DropItemsPresenter","Drink","items_listing_presenter_DrinkPresenter","Bag","BagPresenter","ranIntoAnObstacle","noItemsToPickUp","items_listing_presenter_PickUpPresenter","canThrow","needMissileWeapon","nothingToShotWith","items_listing_presenter_ItemsListingPresenter","ItemsListing","initPositions","title","onWithItem","singleItemMode","AbilitiesPicking","options","talent","assign","professionId","talentId","Completed","Unavailable","Available","ProfessionPicking","professionPicker","pickedProfession","playerProfession","components_Loggervue_type_script_lang_ts_","vue_runtime_esm","extend","props","computed","methods","record","component","componentNormalizer","_vm","_h","$createElement","_c","_self","staticClass","_l","class","rowClass","_v","_s","__file","components_Logger","unicodetiles_Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","elem","appendChild","charMap","charArray","defaultColors","attribs","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","OnisunTalentId","OnisunProfessionId","talents_OnisunTalent","AttackerTwoHandedWeapons","professions_OnisunAttackerProfession","Attacker","professions_OnisunDefenderProfession","Defender","professions_OnisunProfessionPicker","attacker","defender","items_MissileRock","items_Sling","items_Arrow","items_Bow","noMod","commonBow","smallRock","woodenArrow","ironArrow","weapons","newCreature","firstCallPatrol","escaper","explorer","chaser","picker","patrol","loiter","thrower","descender","regenerateEvery","regenerate","runEvents","feelsGood","setAi","seesItems","pickItem","explore","healthCritical","rest","maximum","trackMovement","rat","orc","undead","robot","creaturesPool1","OnisunTrapType","tiles_OnisunFireTrap","Fire","tiles_OnisunIceTrap","Ice","initId","config","simple","tutorial_dungeon_TutorialDungeon","addMap","addStairDown","generateMap","addStairUp","merge","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","MISSILE_WEAPON","POTION","displayItem","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","NULL_TILE","FIRE_TRAP","ICE_TRAP","displayTileVisitor","HUMAN","HUMAN2","HUMAN3","HUMAN4","HUMAN5","RAT","Scenevue_type_script_lang_ts_NULL_TILE","nextItemAnimation","components_Scenevue_type_script_lang_ts_","wholeMap","term","eng","drawInterval","Date","now","interval","dTile","creatureTile","frame","animationFps","itemId","displayTile","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","duration","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","update","lighted","fovTile","initViewport","watch","Scene_component","ref","Scene","components_PrimaryAttributevue_type_script_lang_ts_","slug","attr","PrimaryAttribute_component","attrs","triggers","container","placement","fullName","PrimaryAttribute","components_statsvue_type_script_lang_ts_","components","attribute","displayAttribute","stats_component","levelProgress","role","healthLevel","full-name","stats","views_IdleViewvue_type_script_lang_ts_","inputKey","screen","onInput","close","IdleView_component","IdleView","views_ProfessionPickingViewvue_type_script_lang_ts_","picked","doubleClickOption","option","iconPath","ProfessionPickingView_component","click","$event","dblclick","src","variant","_e","ProfessionPickingView","views_ItemsListingViewvue_type_script_lang_ts_","page","perPage","selected","pickUpItems","index","selectAt","withItem","indexLetter","positionStatus","ItemsListingView_component","positionSelected","ItemsListingView","views_TalentsTreeViewvue_type_script_lang_ts_","professionIndex","groups","availableIndex","letter","groupedTalents","tip","AttackerHeavyWeapons","AttackerLightWeapons","AttackerTwoWeapons","AttackerDoubleTwoHandedWeapons","AttackerStrongGrip","TalentsTreeView_component","card","model","callback","$$v","expression","no-body","talentStatus","pickTalent","talentTip","TalentsTreeView","views_InventoryViewvue_type_script_lang_ts_","displayBodyPart","bodyPart","getChar","itemName","InventoryView_component","availableStatus","itemWeight","InventoryView","views_MissileViewvue_type_script_lang_ts_","moveTarget","nextTarget","previousTarget","MissileView_component","MissileView","components_Appvue_type_script_lang_ts_","initPlayer","playerSpecie","dagger","katana","wooden","iron","rock","bow","loopIntervalId","Logger","Stats","turn","viewComponent","onEvent","main","loop","addEventListener","removeEventListener","App_component","tag","App","use","es","el"],"mappings":"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","file":"main.8377d17c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([25,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","export class Rect {\n  // TODO: Validate?\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {}\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\n// TODO: Remove this\nexport const succ = function(c: string): string {\n  return String.fromCharCode(c.charCodeAt(0) + 1)\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\nexport const twoDimArray = function<T>(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => T\n): T[][] {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport const max = function(list: Array<number>): number {\n  return Math.max.apply(Math, list)\n}\n\nexport const min = function(list: Array<number>): number {\n  return Math.min.apply(Math, list)\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x: number, y: number): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (tile: T, x: number, y: number) => any): void {\n    this.map.forEach((column, x) => {\n      column.forEach((tile, y) => {\n        on(tile, x, y)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n\nexport const bresenhamInclusion = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  bresenham(p0, p1, on)\n  on(p1.x, p1.y)\n}\n\nexport class Direction extends Point {\n  private constructor(x: number, y: number) {\n    super(x, y)\n  }\n\n  static readonly up = new Direction(0, -1)\n  static readonly down = new Direction(0, 1)\n  static readonly left = new Direction(-1, 0)\n  static readonly right = new Direction(1, 0)\n\n  static readonly upLeft = new Direction(-1, -1)\n  static readonly upRight = new Direction(1, -1)\n  static readonly downLeft = new Direction(-1, 1)\n  static readonly downRight = new Direction(1, 1)\n}\n","interface SolidChecker {\n  isSolid(x: number, y: number): boolean\n}\n\nexport class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private solidChecker: SolidChecker,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.solidChecker.isSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.solidChecker.isSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (\n            this.solidChecker.isSolid(currentX, currentY) &&\n            distance < this.radius\n          ) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { remove, sum } from 'lodash'\nimport { Specie } from './creature'\nimport { Item } from './items'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, public current: number = max) {}\n\n  public maximum(): number {\n    return this.max\n  }\n\n  public atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  public currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  public currentValue(): number {\n    const value = super.currentValue()\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n\nexport class AttributeSet<T> {\n  constructor(\n    public attack: T,\n    public defense: T,\n    public dexterity: T,\n    public health: T,\n    public radius: T,\n    public speed: T\n  ) {}\n\n  public with(pairSet: AttributeSet<any>, on: (first: T, second: any) => void) {\n    on(this.attack, pairSet.attack)\n    on(this.defense, pairSet.defense)\n    on(this.health, pairSet.health)\n    on(this.radius, pairSet.radius)\n    on(this.speed, pairSet.speed)\n  }\n}\n\nexport class Modifier extends AttributeSet<number> {\n  constructor({\n    attack = 0,\n    defense = 0,\n    dexterity = 0,\n    health = 0,\n    radius = 0,\n    speed = 0,\n  }) {\n    super(attack, defense, dexterity, health, radius, speed)\n  }\n\n  public withWeight(\n    pairSet: Modifier,\n    weight: Modifier,\n    on: (first: number, second: number, weight: number) => void\n  ) {\n    on(this.attack, pairSet.attack, weight.attack)\n    on(this.defense, pairSet.defense, weight.defense)\n    on(this.health, pairSet.health, weight.health)\n    on(this.radius, pairSet.radius, weight.radius)\n    on(this.speed, pairSet.speed, weight.speed)\n  }\n}\n\nexport class Characteristics extends AttributeSet<Attribute> {\n  constructor({\n    attack,\n    defense,\n    dexterity,\n    health,\n    radius,\n    speed,\n  }: {\n    attack: number\n    defense: number\n    dexterity: number\n    health: number\n    radius: number\n    speed: number\n  }) {\n    super(\n      new PositiveAttribute(attack),\n      new PositiveAttribute(defense),\n      new PositiveAttribute(dexterity),\n      new Attribute(health),\n      new PositiveAttribute(radius),\n      new PositiveAttribute(speed)\n    )\n  }\n\n  public addModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.addModifier(mod)\n      }\n    })\n  }\n\n  public removeModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.removeModifier(mod)\n      }\n    })\n  }\n\n  public damageTo(victim: Characteristics): number {\n    return Math.round(\n      (10 * this.attack.currentValue()) / victim.defense.currentValue()\n    )\n  }\n\n  public misses(victim: Characteristics): boolean {\n    let dex = this.dexterity.currentValue()\n\n    return (\n      Math.random() >\n      dex / (dex + Math.pow(victim.dexterity.currentValue() * 0.25, 0.8))\n    )\n  }\n\n  public throwMisses(victim: Characteristics): boolean {\n    return this.misses(victim)\n  }\n\n  public throwDamageTo(victim: Characteristics, missile: Item): number {\n    return 10\n  }\n\n  public regenerate(): void {\n    this.health.increase(this.regenerationValue())\n  }\n\n  protected regenerationValue(): number {\n    return 1\n  }\n\n  public regenerateEvery(): number {\n    return 8\n  }\n\n  public levelUp(specie: Specie) {\n    this.health.constantIncrease(3)\n\n    if (Math.random() > 0.5) {\n      this.attack.constantIncrease(1)\n    } else {\n      this.defense.constantIncrease(1)\n    }\n  }\n}\n","import { Specie, Creature, Player } from '../creature'\nimport { Modifier } from '../characteristics'\n\nimport { remove } from 'lodash'\nimport { Game } from '../game'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnBody,\n  Throw,\n  Shoot,\n  Boots,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n  Potion,\n  MissileWeapon,\n}\n\nexport enum ItemSubgroup {\n  MissileRock,\n  Sling,\n\n  Bow,\n  Arrows,\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n  public weight: number = 100\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public readonly usages: Usage[] = [],\n    public readonly modifier: Modifier = new Modifier({}),\n    public id: ItemId = Item.getId()\n  ) {}\n\n  public clone(): Item {\n    return new Item(this.group, this.name)\n  }\n\n  public onPutOn(creature: Creature): void {\n    creature.characteristics.addModifier(this.modifier)\n  }\n\n  public onTakeOff(creature: Creature): void {\n    creature.characteristics.removeModifier(this.modifier)\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.name === item.name\n  }\n\n  public worksWith(item: Item): boolean {\n    return false\n  }\n\n  public canThrow(player: Player): boolean {\n    return true\n  }\n}\n\nlet inventoryItemId = 1\nexport class GroupedItem {\n  public id: number\n\n  constructor(public count: number, public item: Item) {\n    this.id = inventoryItemId++\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.item.groupsWith(item)\n  }\n}\n\nexport class ItemsBunch {\n  public bunch: GroupedItem[] = []\n\n  public find(item: Item): GroupedItem {\n    return this.bunch.find(invItem => invItem.groupsWith(item))\n  }\n\n  public remove(item: Item, count: number): void {\n    const invItem: GroupedItem = this.find(item)\n\n    if (!invItem) {\n      // TODO: Fail if removes item that's not in bunch yet?\n      return\n    } else if (invItem.count === count) {\n      remove(this.bunch, inventoryItem => inventoryItem.id === invItem.id)\n    } else {\n      invItem.count -= count\n    }\n  }\n\n  public put(item: Item, count: number): void {\n    const invItem = this.bunch.find(inv => inv.groupsWith(item))\n\n    if (invItem) {\n      invItem.count += count\n    } else {\n      this.bunch.push(new GroupedItem(count, item))\n    }\n  }\n\n  public clone(): ItemsBunch {\n    let bunch = new ItemsBunch()\n\n    this.bunch.forEach(groupedItem => {\n      bunch.put(groupedItem.item, groupedItem.count)\n    })\n\n    return bunch\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: Specie) {\n    super(ItemGroup.Consumable, `${specie.name}'s corpse`)\n  }\n}\n\nexport abstract class Potion extends Item {\n  constructor(public name: string) {\n    super(ItemGroup.Potion, name)\n  }\n\n  abstract onDrink(game: Game): void\n}\n\nexport abstract class Missile extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.Missile, name, [], modifier)\n  }\n}\n\nexport abstract class MissileWeapon extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, [Usage.Shoot], modifier)\n  }\n}\n\nexport class BodyArmor extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.BodyArmor, name, [Usage.WearsOnBody], modifier)\n  }\n}\n\nexport class OneHandWeapon extends Item {\n  constructor(name: string, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, [Usage.WeaponOneHand], modifier)\n  }\n}\n","import { Phantom, Creature } from './creature'\nimport { Item } from './items'\nimport { Point } from './utils'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { ItemsBunch } from './items/internal'\nimport { Game } from './game'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n  Trap,\n}\n\nexport abstract class Tile {\n  public creature?: Phantom\n  public items: ItemsBunch\n\n  constructor(public key: string, public kind: TileTypes) {}\n\n  public addItem(item: Item, count: number): void {\n    if (!this.items) {\n      this.items = new ItemsBunch()\n    }\n\n    this.items.put(item, count)\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public abstract visit(tileVisitor: TileVisitor): void\n\n  public clone(): Tile {\n    let tile = this.buildNew()\n\n    if (this.creature) {\n      tile.creature = this.creature.clone()\n    }\n    tile.items = this.items && this.items.clone()\n    return tile\n  }\n\n  protected abstract buildNew(): Tile\n}\n\nexport class Floor extends Tile {\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onFloor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Floor(this.key, this.kind)\n  }\n}\n\nexport class Corridor extends Floor {}\n\nexport class Room extends Floor {\n  constructor() {\n    super('R', TileTypes.Floor)\n  }\n}\n\nexport class Door extends Tile {\n  constructor() {\n    super('D', TileTypes.Door)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onDoor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Door()\n  }\n}\n\nexport class Wall extends Tile {\n  constructor() {\n    super('W', TileTypes.Wall)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onWall(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Wall()\n  }\n}\n\nexport abstract class Stairway extends Tile {\n  public currentMap: LevelMap\n  public adjacentMapId: LevelMapId\n  public enterPos: Point\n\n  public visibleThrough(): boolean {\n    return true\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(public currentMap: LevelMap, public adjacentMapId: LevelMapId) {\n    super('>', TileTypes.StairwayDown)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayDown(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayDown(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(public currentMap: LevelMap, public adjacentMapId: LevelMapId) {\n    super('<', TileTypes.StairwayUp)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayUp(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayUp(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport abstract class Trap extends Tile {\n  constructor(public revealed: boolean = false, public readonly type: number) {\n    super('^', TileTypes.Trap)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrap(this)\n  }\n\n  public activate(game: Game, actor: Creature): void {\n    this.affect(game, actor)\n  }\n\n  protected abstract affect(game: Game, actor: Creature): void\n}\n\nexport abstract class TileVisitor {\n  public onWall(wall: Wall): void {\n    this.default(wall)\n  }\n\n  public onFloor(floor: Floor): void {\n    this.default(floor)\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.onStairway(stairway)\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.onStairway(stairway)\n  }\n\n  public onDoor(door: Door): void {\n    this.default(door)\n  }\n\n  public onTrap(trap: Trap): void {\n    this.default(trap)\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    this.default(stairway)\n  }\n\n  protected default(tile: Tile): void {}\n}\n","import { CreatureEvent } from './events/internal'\n\nimport { Point } from './utils'\nimport { MetaAI, PlayerAI } from './ai'\nimport { Fov } from './fov'\n\nimport {\n  Characteristics,\n  Corpse,\n  LevelMap,\n  LevelMapId,\n  Memory,\n  Inventory,\n  Game,\n} from '../engine'\n\nimport { Level } from './level'\nimport { includes } from 'lodash'\nimport { Profession } from './profession'\nimport { TileVisitor, Door, Tile, Trap } from './tile'\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairwayDown,\n  Inventory,\n  PutOn,\n  Throwing,\n}\n\nexport const allAbilities = [\n  Ability.GoStairwayDown,\n  Ability.Inventory,\n  Ability.PutOn,\n  Ability.Throwing,\n]\n\nexport class Specie {\n  constructor(\n    public readonly name: string,\n    public readonly clan: Clan,\n    public readonly abilities: Ability[]\n  ) {}\n}\n\nexport type CreatureId = number\n\nexport class Phantom {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  public refToReal?: Creature\n\n  constructor(public specie: Specie, public id: CreatureId = Phantom.getId()) {}\n\n  public name(): string {\n    return this.specie.name\n  }\n\n  public clan(): Clan {\n    return this.specie.clan\n  }\n\n  public clone(): Phantom {\n    return new Phantom(this.specie, this.id)\n  }\n\n  public real(): Creature {\n    return this.refToReal\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n}\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  THROW_DODGE,\n  NOTHING,\n}\n\nclass VisibilityTileVisitor extends TileVisitor {\n  public visible: boolean = false\n  private x: number\n  private y: number\n\n  constructor(private creature: Creature, private stage: LevelMap) {\n    super()\n  }\n\n  public isSolid(x: number, y: number): boolean {\n    this.x = x\n    this.y = y\n    this.stage.at(x, y).visit(this)\n    return !this.visible\n  }\n\n  public onDoor(door: Door) {\n    this.visible =\n      this.creature.pos.x === this.x && this.creature.pos.y === this.y\n  }\n\n  protected default(tile: Tile) {\n    this.visible = this.stage.visibleThrough(this.x, this.y)\n  }\n}\n\nclass SteppingTileVisitor extends TileVisitor {\n  constructor(private creature: Creature, private game: Game) {\n    super()\n  }\n\n  public onTrap(trap: Trap): void {\n    trap.activate(this.game, this.creature)\n  }\n}\n\nexport class Creature extends Phantom {\n  public ai: MetaAI\n  public stageMemories: { [key: string]: Memory } = {}\n  public currentLevel: LevelMap\n  public inventory: Inventory\n\n  public previousPos: Point\n  public pos: Point\n  public dead: boolean = false\n\n  constructor(\n    public characteristics: Characteristics,\n    ai: MetaAI,\n    specie: Specie\n  ) {\n    super(specie)\n    this.ai = ai\n\n    this.inventory = new Inventory()\n  }\n\n  public addToMap(pos: Point, level: LevelMap) {\n    this.pos = pos\n    this.previousPos = this.pos.copy()\n    this.currentLevel = level\n    level.addCreature(this)\n    this.visionMask(level)\n  }\n\n  public die(): void {\n    this.currentLevel.removeCreature(this)\n    this.dead = true\n\n    let tile = this.currentLevel.at(this.pos.x, this.pos.y)\n    tile.addItem(new Corpse(this.specie), 1)\n\n    this.inventory.slots().forEach(({ equipment }) => {\n      if (equipment) {\n        tile.addItem(equipment.item, equipment.count)\n      }\n    })\n\n    this.inventory.cares().forEach(invItem => {\n      tile.addItem(invItem.item, invItem.count)\n    })\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectCreature(this)\n  }\n\n  public real(): Creature {\n    return this\n  }\n\n  public speed(): number {\n    return this.characteristics.speed.currentValue()\n  }\n\n  public radius(): number {\n    return this.characteristics.radius.currentValue()\n  }\n\n  public stageMemory(levelId: LevelMapId = this.currentLevel.id): Memory {\n    return this.stageMemories[levelId]\n  }\n\n  public act(stage: LevelMap) {\n    this.visionMask(stage)\n    this.previousPos = this.pos.copy()\n    this.ai.act(this, true)\n  }\n\n  public move(nextPoint: Point, nextLevel = this.currentLevel) {\n    if (nextLevel.id !== this.currentLevel.id) {\n      this.currentLevel.leave(this)\n\n      nextLevel.enter(this, nextPoint)\n      nextLevel.game.currentMap = nextLevel\n      this.currentLevel = nextLevel\n    } else {\n      this.currentLevel.at(this.pos.x, this.pos.y).creature = undefined\n    }\n\n    this.pos = nextPoint.copy()\n\n    this.currentLevel.at(this.pos.x, this.pos.y).creature = this\n\n    this.currentLevel\n      .at(this.pos.x, this.pos.y)\n      .visit(new SteppingTileVisitor(this, this.currentLevel.game))\n  }\n\n  public clone(): Phantom {\n    let phantom = new Phantom(this.specie, this.id)\n    phantom.refToReal = this\n    return phantom\n  }\n\n  public visionMask(stage: LevelMap): void {\n    if (!this.stageMemories[stage.id]) {\n      this.stageMemories[stage.id] = new Memory(stage.width, stage.height)\n    } else {\n      this.stageMemory().resetVisible()\n    }\n\n    const see = (x: number, y: number, degree: number): void => {\n      this.stageMemory()\n        .at(x, y)\n        .see(stage.at(x, y), degree)\n    }\n\n    const visitor = new VisibilityTileVisitor(this, stage)\n\n    new Fov(\n      this.pos.x,\n      this.pos.y,\n      this.radius(),\n      stage.width,\n      stage.height,\n      visitor,\n      see\n    ).calc()\n  }\n}\n\nexport class Player extends Creature {\n  public ai: PlayerAI\n  public professions: Profession[] = []\n\n  constructor(\n    public level: Level,\n    characteristics: Characteristics,\n    ai: PlayerAI,\n    specie: Specie\n  ) {\n    super(characteristics, ai, specie)\n  }\n\n  public rebuildVision(): void {\n    this.visionMask(this.currentLevel)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectPlayer(this)\n  }\n}\n","import { Point, twoDimArray } from '../utils'\nimport { Creature, Phantom, Clan } from '../creature'\n\nimport { sample } from 'lodash'\nimport { MetaAI } from './meta_ai'\nimport { MemoryTile } from '../memory'\n\nconst FIRST_STEP: number = 1\n\ntype AIId = number\n\nexport abstract class AI {\n  private static lastId: AIId = 0\n  public static getId(): AIId {\n    return this.lastId++\n  }\n\n  constructor(public prevAI?: MetaAI, public id: AIId = AI.getId()) {}\n\n  public abstract act(actor: Creature, firstTurn: boolean): void\n\n  public abstract available(actor: Creature): boolean\n\n  public reset(): void {}\n\n  protected moveTo(actor: Creature, destination: Point): boolean {\n    // TODO: Rethink of it\n    if (actor.pos.eq(destination)) {\n      return true\n    }\n\n    const path = this.leePath(actor, point => destination.eq(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected followTo(actor: Creature, destination: Point): boolean {\n    const path = this.leePath(actor, point => destination.nextTo(point))\n\n    if (path.length) {\n      actor.move(path[0])\n    }\n\n    return !!path.length\n  }\n\n  protected leePath(\n    actor: Creature,\n    destination: (point: Point, tile: MemoryTile) => boolean,\n    randomDestination: boolean = false\n  ): Point[] {\n    const map = actor.stageMemory()\n\n    let stageMemory: number[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => undefined\n    )\n    let pointsToVisit: Point[] = []\n    let pointsToCheck: Point[] = [actor.pos]\n\n    let step = 0\n    while (pointsToCheck.length && !pointsToVisit.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        // TODO: Compare, current value might be lower\n        if (\n          tile.tangible(actor) ||\n          stageMemory[point.x][point.y] !== undefined\n        ) {\n          return\n        }\n\n        stageMemory[point.x][point.y] = step\n        if (destination(point, tile)) {\n          pointsToVisit.push(point)\n        } else {\n          point.wrappers().forEach(dist => wavePoints.push(dist))\n        }\n      })\n      step++\n\n      pointsToCheck = wavePoints\n    }\n\n    if (pointsToVisit.length) {\n      if (randomDestination) {\n        return this.buildRoad(sample(pointsToVisit), stageMemory)\n      } else {\n        return this.buildRoad(pointsToVisit[0], stageMemory)\n      }\n    } else {\n      return []\n    }\n  }\n\n  private buildRoad(point: Point, stageMemory: number[][]): Point[] {\n    let lastPoint = point\n    let chain = [lastPoint]\n\n    let delta: Point = undefined\n\n    while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n      delta = Point.dxy.find(\n        (dp): boolean => {\n          return (\n            stageMemory[lastPoint.x + dp.x] &&\n            stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n              stageMemory[lastPoint.x][lastPoint.y] - 1\n          )\n        }\n      )\n\n      if (!delta) {\n        return []\n      }\n\n      lastPoint = lastPoint.add(delta)\n\n      chain.unshift(lastPoint)\n    }\n\n    return chain\n  }\n\n  protected withinView(\n    actor: Creature,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    const map = actor.stageMemory()\n\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [actor.pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Array<Point> = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Phantom, enemy: Phantom): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan() === Clan.FreeForAll || enemy.clan() === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan() === Clan.Player && enemy.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan() === Clan.Player && actor.clan() === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination: Point = undefined\n\n  public available(actor: Creature): boolean {\n    return this.foundNewTarget(actor) || !!this.destination\n  }\n\n  public act(actor: Creature): void {\n    if (!this.destination) {\n      throw `FollowTargetAI's act got called when there is no destination!`\n    }\n\n    if (this.goTo(actor)) {\n      this.onMove(actor)\n      // If got the destination\n      if (this.destination.eq(actor.pos)) {\n        this.destination = undefined\n        this.onReach(actor)\n      }\n    } else {\n      // If can not move\n      this.destination = undefined\n      this.onCantMove(actor)\n    }\n  }\n\n  public reset(): void {\n    this.destination = undefined\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.moveTo(actor, this.destination)\n  }\n\n  protected abstract foundNewTarget(actor: Creature): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(actor: Creature): void {}\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(\n    metaAI: MetaAI,\n    protected matcher: (tile: MemoryTile) => boolean\n  ) {\n    super(metaAI)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    const path = this.leePath(actor, (point, tile) => this.matcher(tile), true)\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Phantom, Creature, Reaction } from '../creature'\nimport { AttackEvent } from '../../engine'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public available(actor: Creature): boolean {\n    return this.canAttack(actor)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.victimInAccess(actor)) {\n      this.attack(actor)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor)\n      this.act(actor, false)\n    }\n  }\n\n  protected attack(actor: Creature) {\n    if (this.victim.on(new AttackEvent(actor)) === Reaction.DIE) {\n      this.victim = undefined\n    }\n  }\n\n  private canAttack(actor: Creature): boolean {\n    const creature = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(actor: Creature): boolean {\n    if (this.victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      creature => creature.id === this.victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature) {\n    this.victim = this.findCreature(actor, creature =>\n      this.enemies(actor, creature)\n    ).real()\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): Phantom {\n    const memory = actor.stageMemory()\n    return actor.pos\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature())\n      .find(creature => creature && condition(creature))\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature, CreatureId } from '../creature'\nimport { Point } from '../utils'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  public reset(): void {\n    super.reset()\n    this.victimId = undefined\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor)) ||\n      this.foundNewVictim(actor)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): void {\n    this.victimId = undefined\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(actor: Creature): boolean {\n    return this.followTo(actor, this.destination)\n  }\n\n  private buildVictimPath(actor: Creature): boolean {\n    return this.findCreature(actor, creature => creature.id === this.victimId)\n  }\n\n  private foundNewVictim(actor: Creature): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, creature => this.enemies(actor, creature)) &&\n      this.buildVictimPath(actor)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      const creature = tile.creature()\n\n      if (!result && creature && condition(creature)) {\n        this.destination = new Point(x, y)\n        this.victimId = creature.id\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Player } from '../creature'\nimport { ItemsBunch, Item } from '../items/internal'\nimport { Logger } from '../logger'\nimport { Game } from '../../engine'\n\nexport abstract class AIEvent {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract act(): void\n  public abstract immediate(): boolean\n}\n\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: ItemsBunch, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    this.player.inventory.cares().forEach(item => {\n      // const wearing = this.whereToWear(item.item)\n      // if (wearing) {\n      //   // TODO: Use matching slot\n      //   new AIPutOnItem(wearing.inventorySlot, item.item, this.game).act()\n      // }\n    })\n  }\n\n  public immediate(): boolean {\n    return false\n  }\n\n  // private whereToWear(item: Item): Wearing {\n  //   const matches: Wearing[] = compact(\n  //     flatten(\n  //       item.usages.map(usage =>\n  //         this.player.inventory.slots().filter(wearing => includes(wearing.inventorySlot.usages, usage))\n  //       )\n  //     ).map(wearing => this.player.inventory.matchingEquip(wearing.inventorySlot))\n  //   )\n\n  //   if (matches.length === 0) {\n  //     return null\n  //   }\n\n  //   const weightModifier = new Modifier({\n  //     attack: 1,\n  //     defense: 1,\n  //     health: 1,\n  //     radius: 0.5,\n  //     speed: 1,\n  //   })\n\n  //   const { wearing } = matches.reduce(\n  //     (acc, wearing) => {\n  //       let weight = 0\n\n  //       if (wearing.equipment) {\n  //         item.modifier.withWeight(\n  //           wearing.equipment.item.modifier,\n  //           weightModifier,\n  //           (f, s, w) => (weight += w * (f - s))\n  //         )\n  //       } else {\n  //         item.modifier.with(weightModifier, (f, w) => (weight += f * w))\n  //       }\n\n  //       if (acc.weight > weight) {\n  //         return acc\n  //       } else {\n  //         return { weight, wearing }\n  //       }\n  //     },\n  //     { weight: 0, wearing: null }\n  //   )\n\n  //   return wearing\n  // }\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI = null) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n\n  public runEvents(): void {\n    this.events.forEach(event => {\n      event.act()\n    })\n\n    this.resetEvents()\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Phantom, Creature } from '../creature'\n\nimport { sumBy } from 'lodash'\nimport { Point } from '../../engine'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Phantom][] = []\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return this.foundEnemies(actor) && this.buildPath(actor)\n  }\n\n  private buildPath(\n    actor: Creature,\n    minDistance: number = actor.radius() / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.leePath(\n      actor,\n      ({ x, y }) => {\n        const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n          // I don't use pathfinding since it should try\n          // to run away from those who are visible, so the path\n          // to them should be straightforward.\n          return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n        })\n\n        return score >= minDistance\n      },\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildPath(actor, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature): boolean {\n    this.escapesFrom = []\n\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (creature && this.enemies(actor, creature)) {\n        this.escapesFrom.push([point, creature])\n      }\n    })\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from '../ai'\nimport { MetaAI } from './meta_ai'\n\nexport class Explorer extends GoToTileAI {\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => !tile.seen)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../creature'\n\nexport class Loiter extends AI {\n  // private turns: number = 0\n\n  act(actor: Creature, firstTurn: boolean = true): void {\n    // if (this.turns > 1) {\n    //   actor.ai = this.prevAI\n    //   this.prevAI.act(actor, false)\n    //   return\n    // }\n\n    const path = this.leePath(actor, point => !actor.pos.eq(point), true)\n\n    if (path.length) {\n      // this.turns += 1\n      actor.move(path[0])\n    }\n  }\n\n  public available(actor: Creature): boolean {\n    return true\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, succ } from '../utils'\nimport { Creature } from '../creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { MetaAI } from './meta_ai'\nimport { TileVisitor } from '../tile'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nclass PatrolTileVisitor extends TileVisitor {\n  public status: boolean = false\n\n  public addNode(actor: Creature): boolean {\n    this.status = false\n    actor.currentLevel.at(actor.previousPos.x, actor.previousPos.y).visit(this)\n    return this.status\n  }\n\n  public onDoor() {\n    this.status = true\n  }\n}\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n\n  constructor(ai: MetaAI) {\n    super(ai)\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public available(actor: Creature): boolean {\n    return this.graph.nodes().length > 1\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    if (this.path.length) {\n      this.moveToTarget(actor, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor)\n      this.moveToTarget(actor, firstTurn)\n    }\n    this.step += 1\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(actor: Creature): void {\n    if (\n      this.step >= NEW_POINT_EVERY ||\n      new PatrolTileVisitor().addNode(actor)\n    ) {\n      this.addNode(actor.pos.x, actor.pos.y)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(x: number, y: number): void {\n    this.graph.setNode(this.i, new Point(x, y))\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.i = succ(this.i)\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature): void {\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.leePath(actor, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature): void {\n    let seenLastID: NodeID = this.graph.nodes()[0],\n      seenLastStep: number = this.lastNodeVisit[seenLastID],\n      nodes = this.graph.neighbors(this.currentNodeID)\n\n    if (nodes) {\n      nodes.forEach((nodeID: NodeID) => {\n        if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n          seenLastID = nodeID\n          seenLastStep = this.lastNodeVisit[seenLastID]\n        }\n      })\n    }\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor)\n  }\n\n  private moveToTarget(actor: Creature, firstTurn: boolean): void {\n    const nextPoint: Point = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        this.act(actor, false)\n      } else {\n        new Loiter(this.prevAI).act(actor, firstTurn)\n      }\n    } else if (\n      actor\n        .stageMemory()\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath\n\n      if (this.path.length) {\n        return this.act(actor, false)\n      }\n    } else {\n      actor.move(nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n}\n","import { MetaAI, AIEvent } from './meta_ai'\nimport { Player } from '../creature'\nimport {\n  IdlePresenter,\n  Game,\n  TalentsTreePresenter,\n  ProfessionPickingPresenter,\n} from '../../engine'\nimport { Presenter } from '../presenters/internal'\n\nexport class AINewLevelEvent extends AIEvent {\n  constructor(public level: number, game: Game) {\n    super(game)\n  }\n\n  public act(): void {\n    if (this.level % 3 === 0) {\n      this.game.ai.presenter = new ProfessionPickingPresenter(\n        this.level,\n        this.game\n      )\n    } else {\n      this.game.ai.presenter = new TalentsTreePresenter(this.level, this.game)\n    }\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class PlayerAI extends MetaAI {\n  public presenter: Presenter = null\n  private player: Player\n  private game: Game\n  public levelUps: number = 0\n\n  public act(player: Player): void {\n    this.player = player\n    this.game = player.currentLevel.game\n\n    this.presenter = new IdlePresenter(this.game)\n    this.game.ai = this\n  }\n\n  public endTurn(): void {\n    let event = this.events.pop()\n    if (event) {\n      event.act()\n    } else {\n      this.game.ai = null\n      this.presenter = null\n    }\n  }\n\n  public redirect(presenter: Presenter): void {\n    this.presenter = presenter\n  }\n}\n","import { FollowTargetAI } from '../ai'\nimport { Creature, Ability } from '../creature'\nimport { Item, ItemId } from '../items'\nimport { Point } from '../utils'\nimport { AIItemPickedEvent } from './meta_ai'\n\nexport class Picker extends FollowTargetAI {\n  private desiredItemId: ItemId = null\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.Inventory) && super.available(actor)\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    return (\n      this.findItem(actor, item => item.id === this.desiredItemId) ||\n      this.findItem(actor, item => true)\n    )\n  }\n\n  protected onReach(actor: Creature): void {\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    this.prevAI.pushEvent(\n      new AIItemPickedEvent(tile.items, actor.currentLevel.game)\n    )\n\n    tile.items.bunch.forEach(groupedItem => {\n      actor.inventory.putToBag(groupedItem.item, groupedItem.count)\n    })\n\n    tile.items = undefined\n\n    this.desiredItemId = null\n  }\n\n  private findItem(\n    actor: Creature,\n    condition: (item: Item) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(actor, ({ x, y }, tile) => {\n      if (!tile.items()) {\n        return\n      }\n\n      const item = tile\n        .items()\n        .bunch.find(groupedItem => condition(groupedItem.item))\n\n      if (item && !result) {\n        this.desiredItemId = item.id\n        this.destination = new Point(x, y)\n        result = true\n      }\n    })\n\n    return result\n  }\n}\n","import { AI } from '../ai'\nimport { Creature } from '../creature'\n\nexport class SelfHealer extends AI {\n  public available(actor: Creature): boolean {\n    return !actor.characteristics.health.atMax()\n  }\n\n  public act(actor: Creature): void {\n    // Does nothing, just waiting\n    // actor.characteristics.regenerate()\n  }\n}\n","import { GoToTileAI, MetaAI } from '../ai'\nimport { Ability, Creature, StairwayDown, TileTypes } from '../../engine'\n\nexport class Descender extends GoToTileAI {\n  private canDescend: boolean = false\n\n  constructor(metaAI: MetaAI) {\n    super(metaAI, tile => tile.tile.kind === TileTypes.StairwayDown)\n  }\n\n  public available(actor: Creature): boolean {\n    return actor.can(Ability.GoStairwayDown) && super.available(actor)\n  }\n\n  public reset(): void {\n    super.reset()\n    this.canDescend = false\n  }\n\n  protected foundNewTarget(actor: Creature): boolean {\n    // When we are on a stairway\n    this.canDescend = this.matcher(\n      actor.stageMemory().at(actor.pos.x, actor.pos.y)\n    )\n\n    if (this.canDescend) {\n      this.destination = actor.pos\n      return true\n    } else {\n      return super.foundNewTarget(actor)\n    }\n  }\n\n  protected onReach(actor: Creature) {\n    // Should stay here at least for a turn\n    const tile = actor.currentLevel.at(actor.pos.x, actor.pos.y)\n    if (this.canDescend && tile instanceof StairwayDown) {\n      // tile.go(actor)\n    }\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability, Phantom, Reaction } from '../creature'\nimport { GroupedItem } from '../items/internal'\nimport { Point, bresenham } from '../utils'\nimport { MissileAttackEvent } from '../../engine'\n\nexport class Thrower extends AI {\n  public victim: Creature\n  public previousVictim: Creature\n  public missiles: GroupedItem\n\n  public available(actor: Creature): boolean {\n    return (\n      actor.can(Ability.Throwing) &&\n      this.hasMissile(actor) &&\n      this.canAttack(actor)\n    )\n  }\n\n  public act(actor: Creature): void {\n    let path: Point[] = []\n\n    bresenham(actor.pos, this.victim.pos, (x, y) => path.push(new Point(x, y)))\n\n    actor.on(\n      new MissileAttackEvent(\n        path,\n        actor.currentLevel.game,\n        (reaction: Reaction) => {\n          if (reaction === Reaction.DIE) {\n            this.victim = undefined\n            this.previousVictim = undefined\n          }\n        }\n      )\n    )\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.inventory.missileSlot.equipment\n    return this.missiles !== undefined\n  }\n\n  private canAttack(actor: Creature): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (\n        this.findCreature(\n          actor,\n          creature => this.previousVictim.id === creature.id\n        )\n      ) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, creature => this.enemies(actor, creature))\n  }\n\n  private findCreature(\n    actor: Creature,\n    condition: (creature: Phantom) => boolean\n  ): boolean {\n    this.withinView(actor, (point, tile) => {\n      const creature = tile.creature()\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, point)\n      ) {\n        this.victim = actor.currentLevel.at(point.x, point.y).creature.real()\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(actor: Creature, target: Point): boolean {\n    let obstacles = false\n\n    bresenham(actor.pos, target, (x, y) => {\n      obstacles =\n        obstacles ||\n        actor\n          .stageMemory()\n          .at(x, y)\n          .tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import { Item } from './items/internal'\nimport { Point } from './utils'\nimport { Memory } from './memory'\n\nexport abstract class Effect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightEffect extends Effect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { LevelMap, Tile, Item } from '../../engine'\nimport { Pool } from '../pool'\nimport { Creature } from '../creature'\nimport { Point, cycle } from '../utils'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  doorTile: () => Tile,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, doorTile())\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        creaturesPool.pick(null).addToMap(new Point(i, j), level)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null), 1)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\nexport const addOnTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n","import { LevelMap, LevelMapId } from './level_map'\nimport { Game } from './game'\nimport { addOnTile } from './generator/post'\nimport { StairwayDown, StairwayUp, Tile } from './tile'\n\nexport abstract class Dungeon {\n  protected levels: LevelMap[] = []\n\n  constructor(protected game: Game) {}\n  public abstract build(): void\n  public abstract enter(): void\n\n  protected addStairDown(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayDown(map, adjustMapId))\n  }\n\n  protected addStairUp(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayUp(map, adjustMapId))\n  }\n\n  private addStairs(map: LevelMap, tile: Tile): LevelMap {\n    addOnTile(\n      map,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        map.setTile(x, y, tile)\n      }\n    )\n\n    return map\n  }\n}\n","import { Item, GroupedItem } from './items'\nimport { Creature } from './creature'\nimport { Usage } from './items/internal'\nimport { intersection } from 'lodash'\nimport { Inventory } from './inventory'\n\nexport abstract class InventorySlot {\n  public name: string\n\n  constructor(\n    // What kind of items can be put in slot\n    public readonly usages: Usage[],\n    // Has to put only a single item or can put a bunch of them\n    public readonly useSingleItem: boolean,\n    public equipment?: GroupedItem\n  ) {}\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    return inventory.cares().filter(itemGroup => this.match(itemGroup.item))\n  }\n\n  public removeItem(actor: Creature, count: number): void {\n    if (this.equipment) {\n      if (this.equipment.count === count) {\n        this.equipment.item.onTakeOff(actor)\n        this.equipment = undefined\n      } else {\n        this.equipment.count -= count\n      }\n    } else {\n      // TODO: fail here\n    }\n  }\n\n  public equip(actor: Creature, item: Item) {\n    let inventory = actor.inventory,\n      groupItem = inventory.findInBag(item)\n    // TODO: assert item in a bag?\n    // TODO: assert that can't equip more than have in inventory\n    // TODO: assert can equip\n    if (this.equipment) {\n      inventory.putToBag(this.equipment.item, this.equipment.count)\n      this.equipment.item.onTakeOff(actor)\n    }\n    const count = this.useSingleItem ? 1 : groupItem.count\n    this.equipment = new GroupedItem(count, item)\n    inventory.removeFromBag(item, count)\n    item.onPutOn(actor)\n  }\n\n  public takeOff(actor: Creature): void {\n    if (this.equipment) {\n      actor.inventory.putToBag(this.equipment.item, this.equipment.count)\n      this.equipment.item.onTakeOff(actor)\n      this.equipment = null\n    } else {\n      throw `Slot ${this.name} has nothing to take off`\n    }\n  }\n\n  protected match(item: Item): boolean {\n    return intersection(item.usages, this.usages).length > 0\n  }\n}\n\nexport class RightHandSlot extends InventorySlot {\n  public name: string = 'Правая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class LeftHandSlot extends InventorySlot {\n  public name: string = 'Левая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class BodySlot extends InventorySlot {\n  public name: string = 'Корпус'\n  constructor() {\n    super([Usage.WearsOnBody], true)\n  }\n}\n\nexport class BootsSlot extends InventorySlot {\n  public name: string = 'Ботинки'\n  constructor() {\n    super([Usage.Boots], true)\n  }\n}\n\nexport class MissileWeaponSlot extends InventorySlot {\n  public name: string = 'Метательное'\n  constructor() {\n    super([Usage.Shoot], true)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    let baseMatch = super.matchingItems(inventory),\n      missile = inventory.missileSlot.equipment\n\n    if (missile) {\n      return baseMatch.filter(groupedItem =>\n        groupedItem.item.worksWith(missile.item)\n      )\n    }\n\n    return baseMatch\n  }\n}\n\nexport class MissileSlot extends InventorySlot {\n  public name: string = 'Снаряды'\n  constructor() {\n    super([Usage.Throw], false)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem[] {\n    let baseMatch = inventory.cares(),\n      missileWeapon = inventory.missileWeaponSlot.equipment\n\n    if (missileWeapon) {\n      return baseMatch.filter(groupedItem =>\n        groupedItem.item.worksWith(missileWeapon.item)\n      )\n    }\n\n    return baseMatch\n  }\n}\n","import {\n  InventorySlot,\n  RightHandSlot,\n  LeftHandSlot,\n  BodySlot,\n  MissileWeaponSlot,\n  MissileSlot,\n  BootsSlot,\n} from './inventory_slot'\n\nimport { Item, GroupedItem, ItemsBunch } from './items'\n\nexport class Inventory {\n  private bag: ItemsBunch = new ItemsBunch()\n\n  public rightHandSlot = new RightHandSlot()\n  public leftHandSlot = new LeftHandSlot()\n  public bodySlot = new BodySlot()\n  public missileWeaponSlot = new MissileWeaponSlot()\n  public missileSlot = new MissileSlot()\n  public bootsSlot = new BootsSlot()\n\n  // public inSlot(slot: InventorySlot): GroupedItem {\n  //   const wearing = this.matchingEquip(slot)\n  //   return wearing && wearing.equipment\n  // }\n\n  // public removeWearing(\n  //   actor: Creature,\n  //   slot: InventorySlot,\n  //   count: number\n  // ): void {\n  //   let wearing = this.matchingEquip(slot)\n\n  //   if (wearing && wearing.equipment) {\n  //     if (wearing.equipment.count === count) {\n  //       wearing.equipment.item.onTakeOff(actor)\n  //       wearing.equipment = undefined\n  //     } else {\n  //       wearing.equipment.count -= count\n  //     }\n  //   } else {\n  //     // TODO: fail here\n  //   }\n  // }\n\n  public slots(): InventorySlot[] {\n    return [\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.bodySlot,\n      this.bootsSlot,\n      this.missileWeaponSlot,\n      this.missileSlot,\n    ]\n  }\n\n  public cares(): GroupedItem[] {\n    return this.bag.bunch\n  }\n\n  // public matchingEquip(slot: InventorySlot): Wearing {\n  //   return this.wearings.find(wearSlot => wearSlot.inventorySlot.id === slot.id)\n  // }\n\n  public findInBag(item: Item): GroupedItem {\n    return this.bag.find(item)\n  }\n\n  public putToBag(item: Item, count: number): void {\n    this.bag.put(item, count)\n  }\n\n  public removeFromBag(item: Item, count: number): void {\n    this.bag.remove(item, count)\n  }\n}\n","import { Creature } from './creature'\nimport { Item, Potion } from './items/internal'\n\nimport { last } from 'lodash'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport interface LogMessage {\n  level: LogLevel\n  message: string\n  counter?: number\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name()} got ${damage} damage from ${actor.name()}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} causes them to die`\n    )\n  }\n\n  public missMessage(actor: Creature, target: Creature) {\n    this.debug(`${actor.name()} misses ${target.name()}!`)\n  }\n\n  public throwMissMessage(actor: Creature, target: Creature, missile: Item) {\n    this.debug(\n      `${actor.name()} throws ${missile.name} in ${target.name()}, but misses!`\n    )\n  }\n\n  public throwKillMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public throwHurtMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.debug(\n      `${target.name()} got ${damage} damage from ${actor.name()} by ${\n        missile.name\n      }`\n    )\n  }\n\n  public ranIntoAnObstacle(): void {\n    this.addMessage(LogLevel.DEBUG, 'You ran into a wall')\n  }\n\n  public howToHandle(): void {\n    this.addMessage(LogLevel.DEBUG, \"Don't know how to handle it\")\n  }\n\n  public noItemsToPickUp(): void {\n    this.addMessage(LogLevel.DEBUG, \"You don't see anything to pick up\")\n  }\n\n  public takeOff(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You took off ${item.name}`)\n  }\n\n  public putOn(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You put on ${item.name}`)\n  }\n\n  public drink(item: Potion): void {\n    this.addMessage(LogLevel.INFO, `You drunk ${item.name}`)\n  }\n\n  public nothingToShotWith(): void {\n    this.addMessage(LogLevel.DEBUG, 'You have nothing to shoot with')\n  }\n\n  public needMissileWeapon(): void {\n    this.addMessage(LogLevel.DEBUG, 'Мне нужен лук или типа того')\n  }\n\n  public youSteppedInTrap(): void {\n    this.addMessage(LogLevel.DANGER, 'Я наступил в ловушку')\n  }\n\n  public creatureSteppedInTrap(creature: Creature): void {\n    this.addMessage(LogLevel.DANGER, `${creature.name()} наступил в ловушку`)\n  }\n\n  public pickedUpItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You picked up ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You picked up ${count} ${item.name}`)\n    }\n  }\n\n  public droppedItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You dropped a ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You dropped ${count} ${item.name}`)\n    }\n  }\n\n  protected debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  protected info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  protected warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  protected danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    const lastRow: LogMessage = last(this.messages)\n\n    if (lastRow && lastRow.message === message) {\n      lastRow.counter = (lastRow.counter || 1) + 1\n    } else {\n      this.messages.push({ level, message, counter: null })\n    }\n  }\n}\n","import { Player } from './creature'\n\nimport { includes, sample, compact } from 'lodash'\nimport { Game } from './game'\n\nexport class Profession {\n  public talents: Talent[] = []\n  public readonly depthCost: number = 3\n\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1,\n    public points: number = 0\n  ) {}\n}\n\nexport class ProfessionPicker {\n  constructor(\n    private pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number\n  ) {}\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n\n    if (this.canUpdate(player)) {\n      professions.push(this.updatableProfession(player))\n    } else if (this.canTakeNewProfession(player)) {\n      professions.push(this.newFromPool(player))\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      professions.push(\n        this.newFromPool(player, professions.map(profession => profession.id))\n      )\n    } else if (this.canUpdate(player)) {\n      professions.push(\n        this.updatableProfession(\n          player,\n          professions.map(profession => profession.id)\n        )\n      )\n    }\n\n    return compact(professions)\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(\n      profession => profession.level < this.maxLevel\n    )\n  }\n\n  protected updatableProfession(\n    player: Player,\n    excludeProfessions: number[] = []\n  ): Profession {\n    return sample(\n      player.professions.filter(\n        profession => !includes(excludeProfessions, profession.id)\n      )\n    )\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return (\n      player.professions.length < this.maxTaken &&\n      this.pool.length > player.professions.length\n    )\n  }\n\n  protected newFromPool(\n    player: Player,\n    excludeProfessions: number[] = []\n  ): Profession {\n    const excluding = excludeProfessions.concat(\n      player.professions.map(profession => profession.id)\n    )\n    return sample(\n      this.pool.filter(profession => !includes(excluding, profession.id))\n    )\n  }\n}\n\nexport enum TalentStatus {\n  Available,\n  Completed,\n  Unavailable,\n}\n\nexport abstract class Talent {\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public readonly depth: number,\n    public rank: number,\n    public readonly maxRank: number,\n    public readonly description: string\n  ) {}\n\n  public abstract onObtain(game: Game): void\n}\n","import { forEach, keys, min, remove, size, pullAt } from 'lodash'\n\nexport class Timeline<T> {\n  private step: number = 0\n  private turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      this.turns[ts].push(item)\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n  }\n\n  public next(): T {\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = min(keys(this.turns).map(x => parseInt(x)))\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from './utils'\nimport { Timeline } from './timeline'\nimport { Game } from './game'\nimport { Tile, StairwayDown, StairwayUp } from './tile'\n\nimport { remove } from 'lodash'\n\nexport type LevelMapId = number\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public game: Game\n  public timeline: Timeline<CreatureId>\n  public name: string\n\n  constructor(public readonly id: LevelMapId, map: Tile[][]) {\n    super(map)\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public leave(actor: Creature): void {\n    this.reset()\n    this.removeCreature(actor)\n  }\n\n  public enter(actor: Creature, enterPos: Point): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add(creature.id, creature.speed())\n    )\n\n    actor.addToMap(enterPos, this)\n  }\n\n  public addCreature(creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(creature.pos.x, creature.pos.y).creature = creature\n    this.timeline.add(creature.id, creature.speed())\n  }\n\n  public removeCreature(creature: Creature) {\n    let tile = this.at(creature.pos.x, creature.pos.y)\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove(creature.id)\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public matchStairs(adjustId: LevelMapId, enterPos: Point): Point {\n    let stairPos: Point\n\n    this.each((tile, x, y) => {\n      if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n        if (tile.adjacentMapId === adjustId) {\n          tile.enterPos = enterPos\n          stairPos = new Point(x, y)\n        }\n      }\n    })\n\n    return stairPos\n  }\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number[] {\n    if (this.doneLeveling) {\n      return\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = []\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      this.levelUp()\n      levelUps.push(this.current)\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { Tile, Wall, TileVisitor } from './tile'\nimport { Creature, Phantom, twoDimArray } from '../engine'\nimport { ItemsBunch } from './items/internal'\nimport { Mapped } from './utils'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile?: Tile) {}\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public items(): ItemsBunch {\n    return this.tile.items\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public creature(): Phantom {\n    return this.tile && this.tile.creature\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    this.tile.visit(tileVisitor)\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = new Wall()\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { Logger, LevelMap, Player, LevelMapId, PlayerAI } from '../engine'\nimport { ProfessionPicker } from './profession'\nimport { Effect } from './effect'\n\ntype MapGenerator = (id: LevelMapId, game: Game) => LevelMap\n\nexport abstract class Game {\n  public logger: Logger = new Logger()\n  public currentMap: LevelMap\n  public player: Player\n  public ai: PlayerAI = null\n  public running: boolean = false\n  public professionPicker: ProfessionPicker\n  public effect: Effect\n\n  protected maps: Map<LevelMapId, LevelMap | MapGenerator> = new Map()\n\n  public turn() {\n    if (this.running || (this.ai && !this.effect)) {\n      return\n    }\n    this.running = true\n\n    // this.player.ai.runEvents()\n\n    const effect = this.effect\n    if (this.effect) {\n      if (this.effect.done()) {\n        this.effect.onDone()\n        this.effect = null\n      }\n\n      this.player.rebuildVision()\n      effect.patchMemory(this.player.stageMemory())\n\n      this.running = false\n    } else {\n      while (!this.player.dead && !this.ai) {\n        this.levelMapTurn()\n      }\n\n      this.player.rebuildVision()\n    }\n\n    this.running = false\n  }\n\n  public getMap(id: LevelMapId): LevelMap {\n    let levelMap: LevelMap | MapGenerator = this.maps.get(id)\n\n    if (levelMap instanceof LevelMap) {\n      return levelMap\n    } else if (levelMap instanceof Function) {\n      levelMap = levelMap(id, this)\n      this.maps.set(id, levelMap)\n      return levelMap\n    } else {\n      throw `LevelMap with id ${id} is not found`\n    }\n  }\n\n  public addMap(id: LevelMapId, generator: MapGenerator): void {\n    // TODO: Raise if presence\n    this.maps.set(id, generator)\n  }\n\n  private levelMapTurn(): void {\n    let timeline = this.currentMap.timeline,\n      map = this.currentMap\n\n    const actorId = timeline.next()\n\n    if (actorId !== undefined) {\n      const actor = map.creatures.find(creature => actorId === creature.id)\n\n      if (actor) {\n        actor.act(map)\n\n        // If they are still on a map\n        if (map.creatures.find(creature => actorId === creature.id)) {\n          timeline.add(actorId, actor.speed())\n        }\n      }\n\n      return\n    } else {\n      throw 'Timeline event is empty!'\n    }\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (input: Input) => Output][] = []\n\n  constructor(items: [number, (input: Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (input: Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    return this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })[1](input)\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import { twoDimArray } from '../utils'\n\nexport default function<T>(\n  drawMap: string[],\n  collection: Map<string, () => T>\n): T[][] {\n  return twoDimArray(drawMap[0].length, drawMap.length, (x, y) =>\n    collection.get(drawMap[y].charAt(x))()\n  )\n}\n","import { Rect, Point, rand, min, twoDimArray } from '../utils'\n\nconst THICKNESS = 0\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room<T> extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: T[][], walls: boolean[][], newRoomSpace: () => T): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        walls[this.x + i][this.y + j] = false\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road<T> extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: T[][], walls: boolean[][], newCorridor: () => T): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (walls[hx + i][hy]) {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (walls[vx][vy + j]) {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator<T> {\n  rooms: Room<T>[]\n  roads: Road<T>[]\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room<T>[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room<T> {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room<T>[]): Room<T>[] {\n    return rooms.reduce((pickedRooms: Room<T>[], currentRoom: Room<T>) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room<T>[]): Room<T>[] {\n    const minX = min(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room<T>) => room.x + room.w < this.maxX)\n\n    const minY = min(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room<T>) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room<T>[]): Road<T>[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    let connectedPoints: Point[] = [points.shift()]\n    let roads: Road<T>[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let currentPoint = points.shift()\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function<T>(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number,\n  newRoomSpace: () => T,\n  newCorridor: () => T,\n  newWall: () => T\n): T[][] {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator<T>(\n    dimX,\n    dimY,\n    minSize,\n    maxSize,\n    roomsCount\n  )\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n  let walls = twoDimArray(dimX, dimY, () => true)\n\n  for (let i = 0; i < dungeon.rooms.length; i++)\n    dungeon.rooms[i].add(stage, walls, newRoomSpace)\n  for (let i = 0; i < dungeon.roads.length; i++)\n    dungeon.roads[i].add(stage, walls, newCorridor)\n\n  return stage\n}\n","import { Game } from '../game'\nimport { Player } from '../creature'\nimport { LevelMap } from '../level_map'\nimport { Tile } from '../tile'\n\nexport enum PresenterType {\n  ProfessionPicking,\n  Idle,\n  AbilitiesPicking,\n  Inventory,\n  ItemsListing,\n  Missile,\n}\n\nexport abstract class Presenter {\n  public player: Player\n\n  constructor(public readonly type: PresenterType, protected game: Game) {\n    this.player = this.game.player\n  }\n\n  public build() {}\n\n  protected currentLevel(): LevelMap {\n    return this.player.currentLevel\n  }\n\n  protected tile(): Tile {\n    return this.currentLevel().at(this.player.pos.x, this.player.pos.y)\n  }\n\n  protected endTurn(): void {\n    this.game.ai.endTurn()\n  }\n\n  protected redirect(presenter: Presenter): void {\n    this.game.ai.redirect(presenter)\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Direction,\n  DropItemsPresenter,\n  DrinkPresenter,\n  BagPresenter,\n  AttackEvent,\n  PickUpItemsEvent,\n  PickUpPresenter,\n  TileVisitor,\n  Player,\n  Stairway,\n} from '../../engine'\nimport { InventoryPresenter } from './inventory_presenter'\nimport { MissilePresenter } from './missile_presenter'\n\nexport enum IdleInputKey {\n  Right,\n  Left,\n  Down,\n  Up,\n\n  UpRight,\n  UpLeft,\n  DownRight,\n  DownLeft,\n\n  Handle,\n  Missile,\n\n  Inventory,\n  Bag,\n  PickUp,\n  Drop,\n  Drink,\n}\n\nclass HandleTileVisitor extends TileVisitor {\n  constructor(\n    private game: Game,\n    private player: Player,\n    private done: () => void\n  ) {\n    super()\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    // TODO: Do not do this if already connected\n    const adjacentMap = this.game.getMap(stairway.adjacentMapId)\n    stairway.enterPos = adjacentMap.matchStairs(\n      this.player.currentLevel.id,\n      this.player.pos\n    )\n    this.player.move(stairway.enterPos, adjacentMap)\n\n    this.done()\n  }\n\n  protected default(): void {\n    this.game.logger.howToHandle()\n  }\n}\n\nexport class IdlePresenter extends Presenter {\n  constructor(game: Game) {\n    super(PresenterType.Idle, game)\n  }\n\n  public onInput(key: IdleInputKey) {\n    switch (key) {\n      case IdleInputKey.Right:\n        return this.move(Direction.right)\n      case IdleInputKey.Left:\n        return this.move(Direction.left)\n      case IdleInputKey.Down:\n        return this.move(Direction.down)\n      case IdleInputKey.Up:\n        return this.move(Direction.up)\n\n      case IdleInputKey.UpRight:\n        return this.move(Direction.upRight)\n      case IdleInputKey.UpLeft:\n        return this.move(Direction.upLeft)\n      case IdleInputKey.DownRight:\n        return this.move(Direction.downRight)\n      case IdleInputKey.DownLeft:\n        return this.move(Direction.downLeft)\n\n      case IdleInputKey.Handle:\n        return this.handle()\n\n      case IdleInputKey.PickUp:\n        return this.pickUpDialog()\n      case IdleInputKey.Missile:\n        return this.missileDialog()\n\n      case IdleInputKey.Drop:\n        this.redirect(new DropItemsPresenter(this.game))\n        return\n      case IdleInputKey.Drink:\n        this.redirect(new DrinkPresenter(this.game))\n        return\n      case IdleInputKey.Inventory:\n        this.redirect(new InventoryPresenter(this.game))\n        return\n      case IdleInputKey.Bag:\n        this.redirect(new BagPresenter(this.game))\n        return\n    }\n  }\n\n  private move(direction: Direction): void {\n    const stage = this.player.currentLevel,\n      dest = this.player.pos.add(direction),\n      tile = stage.at(dest.x, dest.y)\n\n    if (tile.passibleThrough(this.player)) {\n      this.player.move(dest)\n    } else if (tile.creature) {\n      tile.creature.real().on(new AttackEvent(this.player))\n    } else {\n      this.game.logger.ranIntoAnObstacle()\n    }\n\n    this.endTurn()\n  }\n\n  private pickUpDialog(): void {\n    const tile = this.tile(),\n      items = tile.items\n\n    switch ((items && items.bunch.length) || 0) {\n      case 0:\n        this.game.logger.noItemsToPickUp()\n        return\n      case 1:\n        this.player.on(new PickUpItemsEvent(tile, items.bunch, this.game))\n        this.endTurn()\n        return\n      default:\n        this.redirect(new PickUpPresenter(this.game))\n        return\n    }\n  }\n\n  private missileDialog(): void {\n    const missile = this.player.inventory.missileSlot.equipment\n\n    if (missile && missile.item) {\n      if (missile.item.canThrow(this.player)) {\n        this.redirect(new MissilePresenter(this.game))\n      } else {\n        this.game.logger.needMissileWeapon()\n      }\n    } else {\n      this.game.logger.nothingToShotWith()\n    }\n  }\n\n  private handle(): void {\n    this.tile().visit(\n      new HandleTileVisitor(this.game, this.player, () => this.endTurn())\n    )\n  }\n}\n","import { Creature, Reaction, Player } from '../creature'\n\nexport abstract class CreatureEvent {\n  public abstract affectCreature(subject: Creature): Reaction\n  public affectPlayer(subject: Player): Reaction {\n    return this.affectCreature(subject)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction, Player } from '../creature'\nimport { AINewLevelEvent } from '../ai'\n\nexport class AddExperienceEvent extends CreatureEvent {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(subject: Player): Reaction {\n    subject.level.add(1).forEach(level => {\n      subject.ai.pushEvent(\n        new AINewLevelEvent(level, subject.currentLevel.game)\n      )\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../creature'\nimport { AddExperienceEvent } from './add_experience_event'\n\nexport class AttackEvent extends CreatureEvent {\n  constructor(public actor: Creature) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    if (this.actor.characteristics.misses(subject.characteristics)) {\n      subject.currentLevel.game.logger.missMessage(this.actor, subject)\n      return Reaction.DODGE\n    }\n\n    const damage = this.actor.characteristics.damageTo(subject.characteristics)\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.killMessage(damage, this.actor, subject)\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.hurtMessage(damage, this.actor, subject)\n      return Reaction.HURT\n    }\n  }\n}\n","import { Potion } from '../items'\n\nimport { Game } from '../game'\n\nimport { Creature, Reaction } from '../creature'\nimport { CreatureEvent } from './internal'\n\nexport class DrinkPotionEvent extends CreatureEvent {\n  constructor(private potion: Potion, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    actor.inventory.removeFromBag(this.potion, 1)\n    this.potion.onDrink(this.game)\n    // TODO: Different messages for player and creatures\n    this.game.logger.drink(this.potion)\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { GroupedItem } from '../items'\nimport { Game } from '../game'\nimport { Tile } from '../../engine'\nimport { Creature, Reaction } from '../creature'\n\nexport class DropItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    // TODO: Validate items are part of positions\n    this.items.forEach(({ item, count }) => {\n      subject.inventory.removeFromBag(item, count)\n      this.game.logger.droppedItem(item, count)\n      this.tile.addItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../creature'\nimport { Item } from '../items'\nimport { AddExperienceEvent } from './add_experience_event'\n\nexport class ThrowEvent extends CreatureEvent {\n  constructor(public actor: Creature, public missile: Item) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    if (this.actor.characteristics.throwMisses(subject.characteristics)) {\n      subject.currentLevel.game.logger.throwMissMessage(\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.THROW_DODGE\n    }\n\n    const damage = this.actor.characteristics.throwDamageTo(\n      subject.characteristics,\n      this.missile\n    )\n\n    if (damage >= subject.characteristics.health.currentValue()) {\n      this.actor.on(new AddExperienceEvent(subject))\n      subject.currentLevel.game.logger.throwKillMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      subject.die()\n      return Reaction.DIE\n    } else {\n      subject.characteristics.health.decrease(damage)\n      subject.currentLevel.game.logger.throwHurtMessage(\n        damage,\n        this.actor,\n        subject,\n        this.missile\n      )\n      return Reaction.HURT\n    }\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Point } from '../utils'\nimport { Game } from '../game'\nimport { Creature, Reaction } from '../creature'\nimport { ItemFlightEffect } from '../effect'\nimport { ThrowEvent } from './throw_event'\n\nexport class MissileAttackEvent extends CreatureEvent {\n  constructor(\n    private path: Point[],\n    private game: Game,\n    private done: (reaction: Reaction) => void\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const slot = actor.inventory.missileSlot,\n      missile = slot.equipment.item\n\n    slot.removeItem(actor, 1)\n\n    let flightPath: Point[] = [],\n      victim: Creature\n\n    this.path.forEach(point => {\n      if (!victim) {\n        const tile = actor.currentLevel.at(point.x, point.y)\n        victim = tile.creature && tile.creature.real()\n        flightPath.push(point)\n      }\n    })\n\n    this.game.effect = new ItemFlightEffect(missile, flightPath, () => {\n      if (victim) {\n        this.done(victim.on(new ThrowEvent(actor, missile)))\n      } else {\n        this.done(Reaction.NOTHING)\n      }\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { GroupedItem } from '../items'\nimport { Game } from '../game'\nimport { Tile } from '../../engine'\nimport { Reaction, Creature } from '../creature'\n\nexport class PickUpItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: Ensure never happens\n    // if (!this.items.length) {\n    //   this.redirect(new IdlePresenter(this.game))\n    // }\n\n    let tileItems = this.tile.items\n\n    this.items.forEach(({ item, count }) => {\n      actor.inventory.putToBag(item, count)\n      this.game.logger.pickedUpItem(item, count)\n      tileItems.remove(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { InventorySlot } from '../../engine'\nimport { Item } from '../items'\nimport { Game } from '../game'\nimport { Creature, Reaction } from '../creature'\n\nexport class PutOnItemEvent extends CreatureEvent {\n  constructor(\n    private slot: InventorySlot,\n    private item: Item,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    this.slot.equip(creature, this.item)\n    this.game.logger.putOn(this.item)\n\n    return Reaction.NOTHING\n  }\n}\n","import { InventorySlot, CreatureEvent } from '../../engine'\nimport { Game } from '../game'\nimport { Reaction, Creature } from '../creature'\n\nexport class TakeOffItemEvent extends CreatureEvent {\n  constructor(private slot: InventorySlot, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: assert slot is not empty\n    const groupedItem = this.slot.equipment\n    this.slot.takeOff(actor)\n    this.game.logger.takeOff(groupedItem.item)\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Trap } from '../tile'\nimport { Creature, Reaction, Player } from '../creature'\nimport { Game } from '../game'\n\nexport class TrapEvent extends CreatureEvent {\n  constructor(private trap: Trap, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: Special messages for dying.\n    if (this.game.player.stageMemory().at(actor.pos.x, actor.pos.y).visible) {\n      this.trap.revealed = true\n      this.game.logger.creatureSteppedInTrap(actor)\n    }\n\n    return this.doDamage(actor)\n  }\n\n  public affectPlayer(actor: Player): Reaction {\n    this.game.logger.youSteppedInTrap()\n    this.trap.revealed = true\n\n    return this.doDamage(actor)\n  }\n\n  private doDamage(actor: Creature): Reaction {\n    const damage = 10\n\n    if (damage >= actor.characteristics.health.currentValue()) {\n      actor.die()\n      return Reaction.DIE\n    } else {\n      actor.characteristics.health.decrease(damage)\n      return Reaction.HURT\n    }\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Item,\n  InventorySlot,\n  GroupedItem,\n  PutOnItemsPresenter,\n  PutOnItemEvent,\n  TakeOffItemEvent,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\n\ninterface InventoryPosition {\n  inventorySlot: InventorySlot\n  item: Item\n  count: number\n  availableItems: GroupedItem[]\n}\n\nexport class InventoryPresenter extends Presenter {\n  public positions: InventoryPosition[] = []\n  private takeTime: boolean = false\n\n  constructor(game: Game) {\n    super(PresenterType.Inventory, game)\n    this.rebuildPositions()\n  }\n\n  public takeOff(position: InventoryPosition) {\n    this.player.on(new TakeOffItemEvent(position.inventorySlot, this.game))\n    this.takeTime = true\n    this.rebuildPositions()\n  }\n\n  public putOn(position: InventoryPosition) {\n    this.redirect(\n      new PutOnItemsPresenter(\n        itemGroup => {\n          this.player.on(\n            new PutOnItemEvent(\n              position.inventorySlot,\n              itemGroup.item,\n              this.game\n            )\n          )\n\n          this.takeTime = true\n          this.rebuildPositions()\n          this.redirect(this)\n        },\n        position.availableItems,\n        this.game\n      )\n    )\n  }\n\n  public close() {\n    if (this.takeTime) {\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.game))\n    }\n  }\n\n  private rebuildPositions(): void {\n    this.positions = this.player.inventory.slots().map(inventorySlot => {\n      return {\n        inventorySlot: inventorySlot,\n        item: inventorySlot.equipment && inventorySlot.equipment.item,\n        count: inventorySlot.equipment && inventorySlot.equipment.count,\n        availableItems: inventorySlot.matchingItems(this.player.inventory),\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Game } from '../game'\nimport { Point, bresenhamInclusion, Direction } from '../utils'\nimport { Memory } from '../memory'\nimport { IdlePresenter } from './idle_presenter'\nimport { MissileAttackEvent } from '../../engine'\n\nexport class MissilePresenter extends Presenter {\n  public targetPos: Point\n  private memory: Memory\n  private targetEnemyIndex: number = undefined\n  private enemies: Point[] = []\n  private path: Point[] = []\n\n  constructor(game: Game) {\n    super(PresenterType.Missile, game)\n\n    this.findEnemies()\n    this.memory = this.player.stageMemory()\n    this.resetTargetId()\n  }\n\n  public nextTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      return this.resetTargetId()\n    }\n\n    this.targetEnemyIndex += 1\n\n    if (this.targetEnemyIndex >= this.enemies.length) {\n      this.targetEnemyIndex = 0\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public previousTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      return this.resetTargetId()\n    }\n\n    this.targetEnemyIndex -= 1\n\n    if (this.targetEnemyIndex < 0) {\n      this.targetEnemyIndex = this.enemies.length - 1\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public moveTarget(direction: Direction): void {\n    const stage = this.player.currentLevel,\n      dest = this.targetPos.add(direction),\n      tile = stage.at(dest.x, dest.y)\n\n    if (\n      tile.visibleThrough() &&\n      this.player.stageMemory().at(dest.x, dest.y).visible\n    ) {\n      this.updateTarget(dest)\n      this.targetEnemyIndex = undefined\n    }\n  }\n\n  public attack(): void {\n    if (!this.targetPos.eq(this.player.pos)) {\n      this.player.on(\n        new MissileAttackEvent(this.path, this.game, () => this.endTurn())\n      )\n    }\n  }\n\n  public close(): void {\n    this.resetPath()\n    this.redirect(new IdlePresenter(this.game))\n  }\n\n  private resetTargetId(): void {\n    if (this.enemies.length) {\n      this.targetEnemyIndex = 0\n      this.updateTarget(this.enemies[this.targetEnemyIndex])\n    } else {\n      this.targetEnemyIndex = undefined\n      this.updateTarget(this.player.pos)\n    }\n  }\n\n  private resetPath(): void {\n    this.path.forEach(({ x, y }) => (this.memory.at(x, y).effect = undefined))\n  }\n\n  private drawPath(): void {\n    this.path = []\n    let stop = false\n    const stage = this.player.currentLevel\n\n    bresenhamInclusion(this.player.pos, this.targetPos, (x, y) => {\n      if (!stage.at(x, y).passibleThrough()) {\n        stop = true\n      }\n\n      this.path.push(new Point(x, y))\n      this.memory.at(x, y).effect = stop ? 'o' : 'x'\n    })\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.resetPath()\n    this.targetPos = newPos.copy()\n    this.drawPath()\n  }\n\n  private findEnemies(): void {\n    this.enemies = []\n\n    this.player.stageMemory().each((tile, x, y) => {\n      if (\n        tile.visible &&\n        tile.creature() &&\n        tile.creature().id !== this.player.id\n      ) {\n        this.enemies.push(new Point(x, y))\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Item,\n  PickUpItemsEvent,\n  DrinkPotionEvent,\n  DropItemsEvent,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\nimport { GroupedItem, ItemGroup, Potion } from '../items/internal'\nimport { InventoryPresenter } from './inventory_presenter'\n\ninterface ItemsListingPosition {\n  item: Item\n  count: number\n}\n\nabstract class ItemsListingPresenter extends Presenter {\n  public positions: ItemsListingPosition[]\n  public title: string\n\n  constructor(game: Game) {\n    super(PresenterType.ItemsListing, game)\n    this.initPositions()\n  }\n\n  protected abstract initPositions(): void\n\n  public close(): void {\n    this.redirect(new IdlePresenter(this.game))\n  }\n}\n\nexport class PickUpPresenter extends ItemsListingPresenter {\n  public title: string = 'What to pick up?'\n\n  protected initPositions(): void {\n    const items = this.player.currentLevel.at(\n      this.player.pos.x,\n      this.player.pos.y\n    ).items\n    this.positions = items.bunch.map(itemGroup => {\n      return { item: itemGroup.item, count: itemGroup.count }\n    })\n  }\n\n  public pickUpItems(items: GroupedItem[]): void {\n    // TODO: Validate items are part of positions\n    this.player.on(new PickUpItemsEvent(this.tile(), items, this.game))\n    this.endTurn()\n  }\n}\n\nexport class DropItemsPresenter extends ItemsListingPresenter {\n  public title: string = 'What to drop?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: GroupedItem[]): void {\n    const tile = this.tile()\n\n    if (tile.items && tile.items.bunch.length) {\n      this.player.on(new DropItemsEvent(tile, items, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.game))\n    }\n  }\n}\n\nexport class PutOnItemsPresenter extends ItemsListingPresenter {\n  public title: string = 'What to put on?'\n  public singleItemMode: boolean = true\n\n  constructor(\n    private onWithItem: (itemGroup: ItemsListingPosition) => void,\n    public positions: ItemsListingPosition[],\n    game: Game\n  ) {\n    super(game)\n  }\n\n  protected initPositions(): void {}\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Validate items are part of positions\n    // new AIDropItems(items, this.game).act()\n  }\n\n  public withItem(itemGroup: ItemsListingPosition): void {\n    this.onWithItem(itemGroup)\n  }\n\n  public close(): void {\n    this.redirect(new InventoryPresenter(this.game))\n  }\n}\n\nexport class DrinkPresenter extends ItemsListingPresenter {\n  public title: string = 'Что выпить?'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory\n      .cares()\n      .filter(itemGroup => itemGroup.item.group === ItemGroup.Potion)\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.player.on(new DrinkPotionEvent(itemGroup.item, this.game))\n    this.endTurn()\n  }\n}\n\nexport class BagPresenter extends ItemsListingPresenter {\n  public title: string = 'Сумка'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.endTurn()\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Game } from '../../engine'\nimport { Profession, Talent, TalentStatus } from '../profession'\n\ninterface TalentWithStatus extends Talent {\n  status: TalentStatus\n}\n\ninterface TalentsTreePresenterProfession {\n  profession: Profession\n  talents: TalentWithStatus[]\n}\n\nexport class TalentsTreePresenter extends Presenter {\n  public options: TalentsTreePresenterProfession[] = []\n\n  constructor(public readonly level: number, game: Game) {\n    super(PresenterType.AbilitiesPicking, game)\n\n    this.options = this.player.professions.map(profession => {\n      return {\n        profession,\n        talents: profession.talents.map(talent => {\n          return Object.assign({}, talent, {\n            status: this.status(talent, profession),\n          })\n        }),\n      }\n    })\n  }\n\n  public onInput(professionId: number, talentId: number) {\n    const profession = this.player.professions.find(\n      profession => profession.id === professionId\n    )\n    profession.talents.find(talent => talent.id === talentId).rank += 1\n    profession.points += 1\n\n    this.player.characteristics.levelUp(this.player.specie)\n\n    this.endTurn()\n  }\n\n  private status(talent: Talent, profession: Profession): TalentStatus {\n    if (talent.rank === talent.maxRank) {\n      return TalentStatus.Completed\n    } else if (talent.depth * profession.depthCost > profession.points) {\n      return TalentStatus.Unavailable\n    } else {\n      return TalentStatus.Available\n    }\n  }\n}\n","import { Game } from '../game'\nimport { PresenterType, Presenter } from './internal'\nimport { Profession } from '../profession'\nimport { TalentsTreePresenter } from './talents_tree_presenter'\n\nexport class ProfessionPickingPresenter extends Presenter {\n  public options: Profession[]\n  public title: string\n\n  constructor(public readonly level: number, game: Game) {\n    super(PresenterType.ProfessionPicking, game)\n    this.options = this.game.professionPicker.available(this.player)\n\n    this.title = `Gained ${level} level`\n  }\n\n  public onInput(pickedProfession: Profession) {\n    let playerProfession = this.player.professions.find(\n      profession => profession.id === pickedProfession.id\n    )\n    if (playerProfession) {\n      playerProfession.level += 1\n    } else {\n      this.player.professions.push(pickedProfession)\n    }\n\n    this.redirect(new TalentsTreePresenter(this.level, this.game))\n  }\n}\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { takeRight } from 'lodash'\n\nimport { LogLevel } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: ['logger'],\n  data() {\n    return {\n      lastId: 0,\n    }\n  },\n  computed: {\n    messages() {\n      return takeRight(this.logger.messages, 5)\n    }\n  },\n  methods: {\n    counter(value) {\n      if (value) {\n        return `x${value}`\n      }\n    },\n    rowClass(record) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'debug'\n        case LogLevel.INFO:\n          return 'info'\n        case LogLevel.WARNING:\n          return 'warning'\n        case LogLevel.DANGER:\n          return 'danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=c5c9c21c&scoped=true&lang=pug&\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts&\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&id=c5c9c21c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"c5c9c21c\",\n  null\n  \n)\n\ncomponent.options.__file = \"Logger.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logger\"},_vm._l((_vm.messages),function(record,i){return _c('div',{key:i,class:_vm.rowClass(record)},[_vm._v(_vm._s(record.message)+\"\\n\"+_vm._s(_vm.counter(record.counter)))])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('幅').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Talent, Game } from '../engine'\n\n// TODO: Validate all Talent's ids are uniq\nexport enum OnisunTalentId {\n  AttackerTwoHandedWeapons,\n  AttackerHeavyWeapons,\n  AttackerLightWeapons,\n  AttackerTwoWeapons,\n  AttackerDoubleTwoHandedWeapons,\n  AttackerStrongGrip,\n}\n\nexport abstract class OnisunTalent extends Talent {\n  constructor(\n    id: number,\n    name: string,\n    depth: number,\n    rank: number,\n    maxRank: number,\n    description: string = ''\n  ) {\n    super(id, name, depth, rank, maxRank, description)\n  }\n}\n\nexport class AttackerTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerTwoHandedWeapons, 'Двуручные оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerLightWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerLightWeapons, 'Легкие оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerHeavyWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerHeavyWeapons, 'Тяжелые оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerTwoWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerTwoWeapons,\n      'Два оружия',\n      1,\n      0,\n      1,\n      'Позволяет брать оружие в каждую руку'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerDoubleTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerDoubleTwoHandedWeapons,\n      'Два двуручных оружия',\n      2,\n      0,\n      2\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerStrongGrip extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerStrongGrip,\n      'Крепкий хват',\n      2,\n      0,\n      2,\n      'Оружие не выбивается из рук'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n","import { ProfessionPicker, Profession, Player } from '../engine'\nimport { AttackerTwoHandedWeapons } from './talents'\n\nenum OnisunProfessionId {\n  Attacker,\n  Defender,\n}\n\nexport class OnisunAttackerProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Attacker, 'Оружейник', level)\n\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunDefenderProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Defender, 'Защитник', level)\n  }\n}\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    player: Player,\n    public attacker = new OnisunAttackerProfession(),\n    public defender = new OnisunDefenderProfession()\n  ) {\n    super([attacker, defender], 3, 6)\n  }\n}\n","import {\n  Missile,\n  MissileWeapon,\n  Item,\n  Modifier,\n  Player,\n  OneHandWeapon,\n  BodyArmor,\n  Pool,\n} from '../engine'\nimport { HealPotion } from './potions'\n\nclass MissileRock extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Sling\n  }\n}\n\nclass Arrow extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Bow\n  }\n\n  public canThrow(player: Player): boolean {\n    return !!player.inventory.missileWeaponSlot.equipment\n  }\n}\n\nclass Sling extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof MissileRock\n  }\n}\n\nclass Bow extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof Arrow\n  }\n}\n\nconst noMod = new Modifier({})\n\nexport const commonBow = () => new Bow('Common bow', noMod)\n\nexport const smallRock = () => new MissileRock('Small rock', noMod)\n\nexport const woodenArrow = () => new Arrow('Wooden arrow', noMod)\nexport const ironArrow = () => new Arrow('Iron arrow', noMod)\n\nexport const weapons = new Pool<null, Item>([\n  [1, () => new OneHandWeapon('Katana', new Modifier({ attack: 10 }))],\n  [3, () => new OneHandWeapon('Axe', new Modifier({ attack: 7 }))],\n  [7, () => new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))],\n  [5, () => new OneHandWeapon('Hammer', new Modifier({ attack: 5 }))],\n])\n\nexport const itemsPool = new Pool<null, Item>([\n  [1, () => new BodyArmor('Кольчуга', new Modifier({ defense: 10 }))],\n  [5, () => new BodyArmor('Латы', new Modifier({ defense: 5 }))],\n  [10, () => new BodyArmor('Роба', new Modifier({ defense: 1 }))],\n  [100, () => new HealPotion()],\n])\n","import { Potion } from '../engine/items'\nimport { Game } from '../engine'\n\nexport class HealPotion extends Potion {\n  constructor() {\n    super('Зелье лечения')\n  }\n\n  public onDrink(game: Game) {\n    game.player.characteristics.health.increase(5)\n  }\n}\n","import {\n  Characteristics,\n  Creature,\n  Dispatcher,\n  Specie,\n  Clan,\n  Pool,\n} from '../engine'\n\nconst newCreature = (characteristics: Characteristics, name: string) => {\n  return new Creature(\n    characteristics,\n    new Dispatcher(),\n    new Specie(name, Clan.PlayerOnlyEnemy, [])\n  )\n}\n\nconst floatingEye = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 100,\n      radius: 5,\n      speed: 200,\n    }),\n    'Floating eye'\n  )\n}\n\nconst rat = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 1,\n      radius: 5,\n      speed: 90,\n    }),\n    'Rat'\n  )\n}\n\nconst orc = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 3,\n      defense: 3,\n      dexterity: 2,\n      health: 5,\n      radius: 5,\n      speed: 100,\n    }),\n    'Orc'\n  )\n}\n\nconst undead = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 2,\n      defense: 7,\n      dexterity: 1,\n      health: 10,\n      radius: 5,\n      speed: 120,\n    }),\n    'Undead'\n  )\n}\n\nconst robot = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 5,\n      defense: 5,\n      dexterity: 3,\n      health: 7,\n      radius: 7,\n      speed: 90,\n    }),\n    'Robot'\n  )\n}\n\nconst dragon = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 7,\n      defense: 7,\n      dexterity: 7,\n      health: 30,\n      radius: 5,\n      speed: 100,\n    }),\n    'Dragon'\n  )\n}\n\nexport const creaturesPool1 = new Pool<null, Creature>([\n  [10, rat],\n  [1, floatingEye],\n])\nexport const creaturesPool2 = new Pool<null, Creature>([[1, rat], [2, orc]])\nexport const creaturesPool3 = new Pool<null, Creature>([\n  [1, rat],\n  [1, orc],\n  [2, undead],\n])\nexport const creaturesPool4 = new Pool<null, Creature>([\n  [2, undead],\n  [2, robot],\n])\nexport const creaturesPool5 = new Pool<null, Creature>([\n  [2, robot],\n  [1, dragon],\n])\n","import {\n  AI,\n  Attacker,\n  Chaser,\n  Escaper,\n  Explorer,\n  Loiter,\n  Picker,\n  Patrol,\n  SelfHealer,\n  Descender,\n  Thrower,\n} from '../ai'\nimport { Creature } from '../creature'\nimport { MetaAI } from './meta_ai'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  private firstCallPatrol: boolean = true\n\n  private step: number = 0\n\n  constructor() {\n    super()\n    this.escaper = new Escaper(this)\n    this.explorer = new Explorer(this)\n    this.chaser = new Chaser(this)\n    this.attacker = new Attacker(this)\n    this.picker = new Picker(this)\n    this.patrol = new Patrol(this)\n    this.loiter = new Loiter(this)\n    this.thrower = new Thrower(this)\n\n    this.descender = new Descender(this)\n  }\n\n  public act(actor: Creature, firstTurn: boolean = true): void {\n    // Never dispatch twice\n    if (!firstTurn) {\n      throw 'Meta AI called recursively'\n    }\n\n    this.step += 1\n\n    if (this.step % actor.characteristics.regenerateEvery() === 0) {\n      actor.characteristics.regenerate()\n    }\n\n    this.runEvents()\n\n    if (this.feelsGood(actor)) {\n      if (this.attacker.available(actor)) {\n        this.setAi(this.attacker)\n      } else if (this.thrower.available(actor)) {\n        this.setAi(this.thrower)\n      } else if (this.chaser.available(actor)) {\n        this.setAi(this.chaser)\n      } else if (this.seesItems(actor)) {\n        this.pickItem(actor)\n      } else {\n        this.explore(actor)\n      }\n    } else if (this.healthCritical(actor) && this.escaper.available(actor)) {\n      this.setAi(this.escaper)\n    } else if (this.attacker.available(actor)) {\n      this.setAi(this.attacker)\n    } else if (this.thrower.available(actor)) {\n      this.setAi(this.thrower)\n    } else if (this.chaser.available(actor)) {\n      this.setAi(this.chaser)\n    } else {\n      this.rest(actor)\n    }\n\n    this.resetEvents()\n    this.aiToRun.act(actor, firstTurn)\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() >\n      actor.characteristics.health.maximum() * 0.9\n    )\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue() <\n      actor.characteristics.health.maximum() / 4\n    )\n  }\n\n  private seesItems(actor: Creature): boolean {\n    return this.picker.available(actor)\n  }\n\n  private pickItem(actor: Creature): void {\n    this.setAi(this.picker)\n  }\n\n  private explore(actor: Creature): void {\n    if (this.explorer.available(actor)) {\n      this.patrol.trackMovement(actor)\n      this.setAi(this.explorer)\n    } else if (this.descender.available(actor)) {\n      this.setAi(this.descender)\n    } else if (this.patrol.available(actor)) {\n      if (this.firstCallPatrol) {\n        this.firstCallPatrol = false\n        this.patrol.addNode(actor.pos.x, actor.pos.y)\n      }\n      this.setAi(this.patrol)\n    } else {\n      this.setAi(this.loiter)\n    }\n  }\n\n  private rest(actor: Creature): void {\n    this.setAi(new SelfHealer(this))\n  }\n\n  private setAi(ai: AI): void {\n    if (this.aiToRun && this.aiToRun.id !== ai.id) {\n      this.aiToRun.reset()\n    }\n\n    this.aiToRun = ai\n  }\n}\n","import { TrapEvent, Creature, Tile, Trap, Game } from '../engine'\n\nexport enum OnisunTrapType {\n  Fire,\n  Ice,\n}\n\nexport class OnisunFireTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, OnisunTrapType.Fire)\n  }\n\n  protected buildNew(): Tile {\n    return new OnisunFireTrap(this.revealed)\n  }\n\n  protected affect(game: Game, creature: Creature): void {\n    creature.on(new TrapEvent(this, game))\n  }\n}\n\nexport class OnisunIceTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, OnisunTrapType.Ice)\n  }\n\n  protected buildNew(): Tile {\n    return new OnisunIceTrap(this.revealed)\n  }\n\n  protected affect(game: Game, creature: Creature): void {\n    creature.on(new TrapEvent(this, game))\n  }\n}\n","import {\n  Dungeon,\n  addOnTile,\n  Point,\n  LevelMap,\n  dungeon,\n  addDoors,\n  centralize,\n  addItems,\n  drawn,\n  addCreatures,\n} from '../../engine'\nimport { weapons, itemsPool } from '../items'\nimport { creaturesPool1 } from '../creatures'\nimport {\n  Tile,\n  TileTypes,\n  Door,\n  Wall,\n  Floor,\n  Corridor,\n  Room,\n} from '../../engine/tile'\nimport { OnisunFireTrap, OnisunIceTrap } from '../tiles'\n\nconst initId: number = -1\n\nconst config = {\n  addDoors: false,\n  minSize: 3,\n  maxSize: 10,\n  roomsCount: 10,\n  simple: true,\n}\n\nconst tiles: Map<string, () => Tile> = new Map()\ntiles.set('C', () => new Corridor('C', TileTypes.Floor))\ntiles.set('W', () => new Wall())\ntiles.set('R', () => new Floor('R', TileTypes.Floor))\ntiles.set('D', () => new Door())\n\nexport class TutorialDungeon extends Dungeon {\n  public enter(): void {\n    this.game.currentMap = this.game.getMap(initId)\n\n    addOnTile(\n      this.game.currentMap,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        this.game.player.addToMap(new Point(x, y), this.game.currentMap)\n      }\n    )\n  }\n\n  public build(): void {\n    this.game.addMap(-1, (id, game) =>\n      addCreatures(\n        0.1,\n        this.addStairDown(this.generateMap(id), 0),\n        creaturesPool1\n      )\n    )\n\n    for (let i = 0; i < 5; i++) {\n      this.game.addMap(i, (id, game) => {\n        return addCreatures(\n          i * 0.01,\n          this.addStairUp(\n            this.addStairDown(this.generateMap(id), i + 1),\n            i - 1\n          ),\n          creaturesPool1\n        )\n      })\n    }\n\n    this.game.addMap(5, (id, game) => this.addStairUp(this.generateMap(id), 4))\n  }\n\n  private generateMap(id: number): LevelMap {\n    let map = new LevelMap(\n      id,\n      dungeon<Tile>(\n        40,\n        30,\n        config.minSize,\n        config.maxSize,\n        config.roomsCount,\n        () => new Room(),\n        () => new Corridor('C', TileTypes.Floor),\n        () => new Wall()\n      )\n    )\n\n    if (config.simple) {\n      map = new LevelMap(\n        id,\n        drawn(\n          [\n            'WWWWWWWWWWWWWWWWWWWWWW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WWWWWWWWWWWWWWWWWWWWWW',\n          ],\n          tiles\n        )\n      )\n    }\n\n    if (config.addDoors) {\n      addDoors(map, tiles.get('D'))\n    }\n    centralize(map)\n    map.game = this.game\n    map.name = `MP ${id}`\n\n    for (let i = 0; i < 10; i++) {\n      addOnTile(\n        map,\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (x, y) => {\n          map.setTile(x, y, new OnisunFireTrap())\n        }\n      )\n\n      addOnTile(\n        map,\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (x, y) => {\n          map.setTile(x, y, new OnisunIceTrap())\n        }\n      )\n    }\n\n    addItems(0.05, map, weapons.merge(itemsPool))\n\n    return map\n  }\n}\n","import { Tile as UniTile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n  TileVisitor,\n\n  Wall,\n  Floor,\n  Tile,\n  StairwayDown,\n  StairwayUp,\n  Door,\n  Trap,\n} from '../src/engine'\n\nimport {\n  OnisunTrapType,\n} from '../src/onisun'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends UniTile {\n  public lighted(degree: number): UniTile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: UniTile, degree: number): UniTile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: UniTile, degree: number): UniTile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('戸')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('・')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('＃')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDownD extends DisplayTile {\n  constructor() {\n    super('＞')\n  }\n}\n\nexport class StairwayUpD extends DisplayTile {\n  constructor() {\n    super('＜')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('刀', 200, 200, 200)\nconst CORPSE = new ItemTile('体', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('胸', 200, 200, 200)\nconst MISSILE = new ItemTile('石', 200, 200, 200)\nconst MISSILE_WEAPON = new ItemTile(']', 200, 200, 200)\n\nconst POTION = new ItemTile('！', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    case ItemGroup.MissileWeapon:\n      return MISSILE_WEAPON\n    case ItemGroup.Potion:\n      return POTION\n    default:\n      throw `Unknown group ${item} with type ${item.group}`\n  }\n}\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDownD()\nconst STAIRWAY_UP = new StairwayUpD()\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst FIRE_TRAP = new DisplayTile('^', 200, 0, 0)\nconst ICE_TRAP = new DisplayTile('^', 0, 0, 200)\n\nexport class DisplayTileVisitor extends TileVisitor {\n  public tile: DisplayTile\n\n  public onWall(wall: Wall): void {\n    this.tile = WALL\n  }\n\n  public onFloor(floor: Floor): void {\n    this.tile = FLOOR\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.tile = STAIRWAY_DOWN\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.tile = STAIRWAY_UP\n  }\n\n  public onDoor(door: Door): void {\n    this.tile = DOOR\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      this.tile = FLOOR\n      return\n    }\n\n    switch (trap.type) {\n    case OnisunTrapType.Fire:\n      this.tile = FIRE_TRAP\n      break\n    case OnisunTrapType.Ice:\n      this.tile = ICE_TRAP\n      break\n    }\n  }\n\n  protected default(tile: Tile): void {\n    this.tile = NULL_TILE\n  }\n}\n\nconst displayTileVisitor = new DisplayTileVisitor()\n\nexport const displayTile = function(tile): DisplayTile {\n  tile.visit(displayTileVisitor)\n  return displayTileVisitor.tile\n}\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  ItemTile,\n  DisplayTile,\n\n  displayItem,\n  displayTile,\n} from './scene_tiles'\n\nconst HUMAN  = new CreatureTile('俺', 0, 255, 0)\nconst HUMAN2 = new CreatureTile('俺', 255, 0, 0)\nconst HUMAN3 = new CreatureTile('俺', 0, 0, 255)\nconst HUMAN4 = new CreatureTile('俺', 255, 0, 255)\nconst HUMAN5 = new CreatureTile('俺', 0, 255, 255)\n\nconst RAT = new CreatureTile('ｄ', 197, 65, 38)\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('｜', 200, 200, 200),\n  new ItemTile('／', 200, 200, 200),\n  new ItemTile('ー', 200, 200, 200),\n  new ItemTile('＼', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      interval: 100,\n      step: 0,\n    }\n  },\n  methods: {\n    getTile(x, y) {\n      const effect = this.stage.at(x, y).effect\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULL_TILE\n      }\n\n      if (effect) {\n        if (tile.creature) {\n          let dTile = this.creatureTile(tile.creature).clone()\n          dTile.setBackground(200, 0, 0)\n          return dTile\n        } else {\n          return new DisplayTile(effect, 200, 200, 0)\n        }\n      }\n\n      if (tile.creature) {\n        return this.creatureTile(tile.creature)\n      }\n\n      if (tile.items) {\n        switch (tile.items.bunch.length) {\n        case 0:\n          break;\n        case 1:\n          return displayItem(tile.items.bunch[0].item)\n        default:\n          const frame = this.step % (this.animationFps * 3 + 4)\n          if (frame < nextItemAnimation.length) {\n            return nextItemAnimation[frame]\n          } else {\n            const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n            return displayItem(tile.items.bunch[itemId % tile.items.bunch.length].item)\n          }\n        }\n      }\n\n      return displayTile(tile)\n    },\n    creatureTile(creature) {\n      if (creature.name() == 'Rat') {\n        return RAT\n      }\n\n      switch (creature.id % 5) {\n        case 0:\n          return HUMAN5\n        case 1:\n          return HUMAN4\n        case 2:\n          return HUMAN3\n        case 3:\n          return HUMAN2\n        case 4:\n          return HUMAN\n      }\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        Math.max(this.level.width, 40),\n        Math.max(this.level.height, 40),\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x, y) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.ts = ts\n      }\n\n      this.eng.update(this.player.pos.x, this.player.pos.y);\n      // this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level.id)\n    },\n    animationFps() {\n      return 1000 / this.interval\n    },\n    tileItems() {\n      let items = this.stage.at(this.player.pos.x, this.player.pos.y).items()\n      return items && items.bunch\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=323bde2e&lang=pug&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Scene.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { sum } from 'lodash'\n\nexport default Vue.extend({\n  name: 'PrimaryAttribute',\n  props: ['name', 'slug', 'attr', 'fullName'],\n  computed: {\n    id() {\n      return `${this.slug}-container`\n    },\n    modifier() {\n      return sum(this.attr.modifiers)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PrimaryAttribute.vue?vue&type=template&id=6e52ba73&lang=pug&\"\nimport script from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\nexport * from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PrimaryAttribute.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover\",attrs:{\"id\":_vm.id}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.attr.currentValue()))]),_c('b-popover',{attrs:{\"target\":_vm.id,\"triggers\":\"hover\",\"container\":_vm.id,\"placement\":\"top\"}},[[_c('big',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.fullName))]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Базовый:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.attr.current))])]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Модификатор:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.modifier))])])]],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./stats.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PrimaryAttribute from './PrimaryAttribute.vue'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature'],\n  components: {\n    PrimaryAttribute\n  },\n  computed: {\n    levelProgress() {\n      const level = this.creature.level\n      return `${level.currentExperience  / level.requiredExperience * 100}%`\n    },\n    healthLevel() {\n      const attribute = this.creature.characteristics.health\n      return `${attribute.currentValue() / (attribute.maximum() || 0) * 100}%`\n    }\n  },\n  methods: {\n    displayAttribute(attribute) {\n      if (attribute.currentValue() != attribute.maximum()) {\n        return `${attribute.currentValue()} / ${attribute.maximum()}`\n      } else {\n        return attribute.currentValue()\n      }\n    },\n  }\n})\n","import { render, staticRenderFns } from \"./stats.vue?vue&type=template&id=2de6dc4a&scoped=true&lang=pug&\"\nimport script from \"./stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./stats.vue?vue&type=style&index=0&id=2de6dc4a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2de6dc4a\",\n  null\n  \n)\n\ncomponent.options.__file = \"stats.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel container\"},[_c('div',{staticClass:\"level cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.level.current))]),_c('div',{staticClass:\"note\"},[_vm._v(\"Уровень\"),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-bar bg-success\",style:({ width: _vm.levelProgress }),attrs:{\"role\":\"progressbar\"}})])])]),_c('div',{staticClass:\"hp cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.displayAttribute(_vm.creature.characteristics.health)))]),_c('div',{staticClass:\"bar\",style:({ height: _vm.healthLevel })})]),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"attack\",\"name\":\"А\",\"full-name\":\"Атака\",\"attr\":_vm.creature.characteristics.attack}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"defense\",\"name\":\"З\",\"full-name\":\"Защита\",\"attr\":_vm.creature.characteristics.defense}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"speed\",\"name\":\"С\",\"full-name\":\"Скорость\",\"attr\":_vm.creature.characteristics.speed}}),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.currentLevel.name))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'IdleView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.close(IdleInputKey.Right)\n\n      case 'h':\n      case 'ArrowLeft':\n        return this.close(IdleInputKey.Left)\n\n      case 'k':\n      case 'ArrowUp':\n        return this.close(IdleInputKey.Up)\n\n      case 'j':\n      case 'ArrowDown':\n        return this.close(IdleInputKey.Down)\n\n      case 'y':\n        return this.close(IdleInputKey.UpLeft)\n      case 'u':\n        return this.close(IdleInputKey.UpRight)\n      case 'b':\n        return this.close(IdleInputKey.DownLeft)\n      case 'n':\n        return this.close(IdleInputKey.DownRight)\n\n      case 'H':\n        return this.close(IdleInputKey.Handle)\n\n      case 'i':\n        return this.close(IdleInputKey.Inventory)\n      case 'I':\n        return this.close(IdleInputKey.Bag)\n      case 't':\n        return this.close(IdleInputKey.Missile)\n      case ',':\n        return this.close(IdleInputKey.PickUp)\n      case 'd':\n        return this.close(IdleInputKey.Drop)\n      case 'D':\n        return this.close(IdleInputKey.Drink)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./IdleView.vue?vue&type=template&id=9a78bdc0&lang=pug&\"\nimport script from \"./IdleView.vue?vue&type=script&lang=ts&\"\nexport * from \"./IdleView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"IdleView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const option = doubleClickOption || this.picked\n      if (option) {\n        this.screen.onInput(option)\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case 'a':\n        this.picked = this.screen.options[0]\n        break\n      case 'b':\n        this.picked = this.screen.options[1]\n        break\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        return\n      }\n    },\n    iconPath(professionId: number) {\n      return 'assets/professions/' + [\n        'acrobatic.svg',\n        'button-finger.svg',\n        'disintegrate.svg',\n        'flying-fox.svg',\n        'amputation.svg',\n        'catch.svg',\n        'divert.svg',\n        'fruiting.svg',\n        'annexation.svg',\n        'conversation.svg',\n        'dodging.svg',\n        'grab.svg',\n        'arrest.svg',\n        'convince.svg',\n        'drinking.svg',\n        'journey.svg',\n        'back-forth.svg',\n        'coronation.svg',\n        'drop-weapon.svg',\n        'juggler.svg',\n        'backstab.svg',\n        'crafting.svg',\n        'drowning.svg',\n        'jump-across.svg',\n        'boot-stomp.svg',\n        'crush.svg',\n        'eating.svg',\n        'kindle.svg',\n        'bowman.svg',\n        'discussion.svg',\n        'expander.svg',\n        'kneeling.svg',\n      ][professionId]\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ProfessionPickingView.vue?vue&type=template&id=18864c57&lang=pug&\"\nimport script from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ProfessionPickingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal text-center\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"content\"},_vm._l((_vm.screen.options),function(option){return _c('div',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option},\"dblclick\":function($event){_vm.close(option)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(option.id)}}),_c('div',{staticClass:\"name\"},[_vm._v(_vm._s(option.name))])])})),_c('div',{staticClass:\"bottom\"},[(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":_vm.close}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        if (this.screen.singleItemMode) {\n          this.screen.withItem(this.screen.positions[i])\n        } else if (this.selected.indexOf(i) >= 0) {\n          this.selected.splice(this.selected.indexOf(i), 1)\n        } else {\n          this.selected.push(i)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ItemsListingView.vue?vue&type=template&id=59570fee&lang=pug&\"\nimport script from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ItemsListingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('table',{staticClass:\"container positions-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.positionStatus(position)},[_c('td',{staticClass:\"selected\"},[(_vm.positionSelected(index))?_c('div',{staticClass:\"sign\"},[_vm._v(\"+\")]):_vm._e()]),_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(position.item.name)+\" (\"+_vm._s(position.count)+\")\")]),_c('td',{staticClass:\"weight\"},[_vm._v(\"[\"+_vm._s(position.item.weight)+\"g]\")])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { OnisunTalentId } from 'src/onisun'\nimport { TalentStatus } from 'src/engine';\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null,\n      professionIndex: 0\n    }\n  },\n  computed: {\n    option() {\n      return this.screen.options[this.professionIndex]\n    },\n    profession() {\n      return this.option.profession\n    },\n    groupedTalents() {\n      let groups = new Array(5)\n      for (let i = 0; i < groups.length; i++) {\n        groups[i] = []\n      }\n\n      let availableIndex = 0\n\n      this.option.talents.forEach(talent => {\n        if (talent.status === TalentStatus.Available) {\n          Object.assign(talent, {\n            letter: String.fromCharCode(LETTER_OFFSET + availableIndex++)\n          })\n        }\n\n        groups[talent.depth].push(talent)\n      })\n\n      return groups\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const talent = doubleClickOption || this.picked\n\n      if (!talent || talent.status !== TalentStatus.Available) {\n        return\n      }\n\n      this.screen.onInput(this.profession.id, talent.id)\n      this.picked = null\n    },\n    pickTalent(talent) {\n      if (talent.status === TalentStatus.Available) {\n        this.picked = talent\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        this.groupedTalents.forEach(group => group.forEach(talent => {\n          if (talent.letter === event.key) {\n            this.picked = talent\n          }\n        }))\n\n        const index = parseInt(event.key)\n        if (index >= 1 && index <= this.screen.options.length) {\n          this.professionIndex = index - 1\n        }\n      }\n    },\n    talentTip(talent) {\n      let tip = `${talent.rank}/${talent.maxRank}`\n      if (talent.rank >= talent.maxRank) {\n        return tip\n      } else {\n        return `${talent.letter} ${tip}`\n      }\n    },\n    talentStatus(talent) {\n      if (this.picked && this.picked.id === talent.id) {\n        return '-selected'\n      }\n      switch(talent.status) {\n      case TalentStatus.Available:\n        return '-available'\n      case TalentStatus.Unavailable:\n        return '-unavailable'\n      case TalentStatus.Completed:\n        return '-completed'\n      }\n    },\n    iconPath(talentId) {\n      switch(talentId) {\n        case OnisunTalentId.AttackerTwoHandedWeapons:\n          return 'AttackerTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerHeavyWeapons:\n          return 'AttackerHeavyWeapons.svg'\n        case OnisunTalentId.AttackerLightWeapons:\n          return 'AttackerLightWeapons.svg'\n        case OnisunTalentId.AttackerTwoWeapons:\n          return 'AttackerTwoWeapons.svg'\n        case OnisunTalentId.AttackerDoubleTwoHandedWeapons:\n          return 'AttackerDoubleTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerStrongGrip:\n          return 'AttackerStrongGrip.svg'\n      }\n    }\n  },\n  watch: {\n    professionIndex() {\n      this.picked =  null\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./TalentsTreeView.vue?vue&type=template&id=4bac4be6&lang=pug&\"\nimport script from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsTreeView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover screen-modal text-center\",attrs:{\"id\":\"talents-tree-container\"}},[_c('b-tabs',{staticClass:\"tabs-list\",attrs:{\"card\":\"\"},model:{value:(_vm.professionIndex),callback:function ($$v) {_vm.professionIndex=$$v},expression:\"professionIndex\"}},_vm._l((_vm.screen.player.professions),function(profession){return _c('b-tab',{key:profession.id,attrs:{\"title\":profession.name,\"no-body\":\"\"}})})),_c('table',{staticClass:\"content\"},_vm._l((_vm.groupedTalents),function(group,i){return _c('tr',{key:i},_vm._l((group),function(talent,j){return _c('td',{key:j,staticClass:\"cell\"},[_c('div',{staticClass:\"talent-cell\",class:_vm.talentStatus(talent),attrs:{\"id\":j + 'talentTree-'+i,\"variant\":\"primary\"},on:{\"click\":function($event){_vm.pickTalent(talent)},\"dblclick\":function($event){_vm.close(talent)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/talents/' + _vm.iconPath(talent.id)}}),_c('span',{staticClass:\"level\"},[_vm._v(_vm._s(_vm.talentTip(talent)))]),_c('b-popover',{attrs:{\"target\":j + 'talentTree-'+i,\"triggers\":\"hover\",\"container\":\"talents-tree-container\"}},[[_c('p',{staticClass:\"name\"},[_vm._v(_vm._s(talent.name))]),_c('small',[_c('p',{staticClass:\"rank\"},[_vm._v(\"Уровень \"+_vm._s(talent.rank)+\"/\"+_vm._s(talent.maxRank))]),(_vm.talentStatus(talent) === '-unavailable')?_c('p',{staticClass:\"requirements\"},[_vm._v(\"Требуется \"+_vm._s(talent.depth * _vm.profession.depthCost)+\" очков в \"+_vm._s(_vm.profession.name))]):_vm._e(),_c('p',{staticClass:\"description\"},[_vm._v(_vm._s(talent.description))])])]],2)],1)])}))})),(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"default\"},on:{\"click\":function($event){_vm.close()}}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  LeftHandSlot,\n  RightHandSlot,\n  BodySlot,\n  MissileSlot,\n  MissileWeaponSlot,\n} from '../../src/engine'\n\nimport {\n  displayItem,\n} from './../scene_tiles'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case ' ':\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ',':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        const position = this.screen.positions[i]\n        if (position.item) {\n          this.screen.takeOff(position)\n        } else if (position.availableItems.length) {\n          this.screen.putOn(position)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    displayBodyPart(bodyPart) {\n      return bodyPart.name\n    },\n    displayItem(item) {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    itemName(position) {\n      if (position.item) {\n        return `${position.item.name} (${position.count})`\n      } else {\n        return '-'\n      }\n    },\n    itemWeight(position) {\n      if (position.item) {\n        return `[${position.item.weight}g]`\n      }\n    },\n    available(position) {\n      return position.item || position.availableItems.length\n    },\n    availableStatus(position) {\n      return this.available(position) ? '-available' : '-unavailable'\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./InventoryView.vue?vue&type=template&id=b7d20764&lang=pug&\"\nimport script from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nexport * from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./InventoryView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"InventoryView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(\"Инвентарь\")]),_c('table',{staticClass:\"content inventory-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.availableStatus(position)},[_c('td',{staticClass:\"slot\"},[_c('span',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('span',{staticClass:\"dash\"},[_vm._v(\"—\")]),_c('span',{staticClass:\"part\"},[_vm._v(_vm._s(_vm.displayBodyPart(position.inventorySlot)))]),_c('span',{staticClass:\"separator\"},[_vm._v(\":\")])]),_c('td',{staticClass:\"name\",class:_vm.positionStatus(position)},[_vm._v(_vm._s(_vm.itemName(position)))]),_c('td',{staticClass:\"weight\"},[_vm._v(_vm._s(_vm.itemWeight(position)))])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey, Direction } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'MissileView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case '>':\n        this.screen.nextTarget()\n        break\n      case '<':\n        this.screen.previousTarget()\n        break\n      case 't':\n        this.screen.attack()\n        break\n      case 'Escape':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MissileView.vue?vue&type=template&id=297d01f1&lang=pug&\"\nimport script from \"./MissileView.vue?vue&type=script&lang=ts&\"\nexport * from \"./MissileView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MissileView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport * as _ from 'lodash'\n\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\nimport Stats from './stats.vue'\n\nimport Idle from './views/IdleView.vue'\nimport ProfessionPickingView from './views/ProfessionPickingView.vue'\nimport ItemsListingView from './views/ItemsListingView.vue'\nimport TalentsTreeView from './views/TalentsTreeView.vue'\nimport InventoryView from './views/InventoryView.vue'\nimport MissileView from './views/MissileView.vue'\n\nimport { LevelMap, PresenterType } from '../src/engine'\n\nimport {\n  Onisun,\n} from '../src/onisun'\nimport { setInterval, clearInterval } from 'timers';\n\nexport default Vue.extend({\n  data() {\n    return {\n      game: new Onisun(),\n      ts: Date.now(),\n      loopIntervalId: undefined\n    }\n  },\n  components: {\n    Logger,\n    Scene,\n    Stats,\n  },\n  computed: {\n    viewComponent() {\n      switch (this.game.ai && this.game.ai.presenter.type) {\n      case PresenterType.AbilitiesPicking:\n        return TalentsTreeView\n      case PresenterType.ProfessionPicking:\n        return ProfessionPickingView\n      case PresenterType.Idle:\n        return Idle\n      case PresenterType.ItemsListing:\n        return ItemsListingView\n      case PresenterType.Inventory:\n        return InventoryView\n      case PresenterType.Missile:\n        return MissileView\n      }\n    }\n  },\n  methods: {\n    loop() {\n      this.game.turn()\n    },\n    onEvent(event) {\n      const view = this.$refs.viewComponent\n      if (view) {\n        view.onEvent(event)\n      }\n    }\n  },\n  created() {\n    this.loopIntervalId = setInterval(this.loop, 10)\n    document.addEventListener('keydown', this.onEvent)\n  },\n  beforeDestroy() {\n    clearInterval(this.loopIntervalId)\n    document.removeEventListener('keydown', this.onEvent)\n  }\n})\n","import {\n  Clan,\n  Player,\n  Specie,\n  allAbilities,\n  OneHandWeapon,\n  Modifier,\n  Characteristics,\n  Game,\n  Level,\n  PlayerAI,\n} from './engine'\n\nimport { OnisunProfessionPicker } from './onisun/professions'\nimport { woodenArrow, ironArrow, commonBow, smallRock } from './onisun/items'\nimport { TutorialDungeon } from './onisun/dungeons/tutorial_dungeon'\n\nexport * from './onisun/professions'\nexport * from './onisun/talents'\nexport * from './onisun/items'\nexport * from './onisun/tiles'\n\nexport class Onisun extends Game {\n  public professionPicker: OnisunProfessionPicker\n\n  constructor() {\n    super()\n    this.player = this.initPlayer()\n    this.professionPicker = new OnisunProfessionPicker(this.player)\n    this.player.professions.push(this.professionPicker.attacker)\n\n    const dungeon = new TutorialDungeon(this)\n    dungeon.build()\n    dungeon.enter()\n  }\n\n  protected initPlayer(): Player {\n    const playerSpecie = new Specie('Player', Clan.Player, allAbilities)\n\n    let player = new Player(\n      new Level([1, 3, 5, 10, 20]),\n      new Characteristics({\n        attack: 1,\n        defense: 4,\n        dexterity: 3,\n        health: 100,\n        radius: 10,\n        speed: 80,\n      }),\n      new PlayerAI(),\n      playerSpecie\n    )\n\n    const dagger = new OneHandWeapon('Dagger', new Modifier({ attack: 3 }))\n    const katana = new OneHandWeapon('Katana', new Modifier({ attack: 10 }))\n\n    const wooden = woodenArrow()\n    const iron = ironArrow()\n    const rock = smallRock()\n\n    const bow = commonBow()\n\n    player.inventory.putToBag(dagger, 2)\n    player.inventory.putToBag(katana, 1)\n\n    player.inventory.putToBag(wooden, 5)\n    player.inventory.putToBag(iron, 5)\n    player.inventory.putToBag(rock, 5)\n\n    player.inventory.putToBag(bow, 2)\n\n    // player.putOn(RightHandSlot, dagger)\n    player.inventory.missileWeaponSlot.equip(player, bow)\n    player.inventory.missileSlot.equip(player, wooden)\n\n    return player\n  }\n}\n","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=c2617d5c&lang=pug&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{staticClass:\"container-fluid\",attrs:{\"id\":\"app\"}},[(_vm.game.player && !_vm.game.player.dead)?_c('Scene',{staticClass:\"scene\",attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player}}):_vm._e(),(_vm.game.player && !_vm.game.player.dead)?_c('Stats',{staticClass:\"player-stats\",attrs:{\"creature\":_vm.game.player}}):_vm._e(),_c('Logger',{staticClass:\"logger-panel\",attrs:{\"logger\":_vm.game.logger}}),(_vm.game.player && _vm.game.player.dead)?_c('div',[_vm._v(\"You are dead\")]):_vm._e(),(_vm.game.ai)?_c(_vm.viewComponent,{ref:\"viewComponent\",tag:\"component\",attrs:{\"screen\":_vm.game.ai.presenter}}):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './App.vue'\nimport BootstrapVue from 'bootstrap-vue'\n\nVue.use(BootstrapVue)\n\nimport './application.scss'\n\nimport 'bootstrap/dist/css/bootstrap.css'\nimport 'bootstrap-vue/dist/bootstrap-vue.css'\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n"],"sourceRoot":""}