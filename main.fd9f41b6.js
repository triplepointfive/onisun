!function(t){function e(e){for(var i,n,o=e[0],h=e[1],l=e[2],u=0,d=[];u<o.length;u++)n=o[u],r[n]&&d.push(r[n][0]),r[n]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(t[i]=h[i]);for(c&&c(e);d.length;)d.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,o=1;o<s.length;o++){var h=s[o];0!==r[h]&&(i=!1)}i&&(a.splice(e--,1),t=n(n.s=s[0]))}return t}var i={},r={1:0},a=[];function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=i,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/onisun/";var o=window.webpackJsonp=window.webpackJsonp||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var c=h;a.push([183,0]),s()}({1:function(t,e,s){"use strict";s.d(e,"c",function(){return i}),s.d(e,"f",function(){return r}),s.d(e,"e",function(){return a}),s.d(e,"g",function(){return n}),s.d(e,"d",function(){return o}),s.d(e,"b",function(){return h}),s.d(e,"a",function(){return l});class i{constructor(t,e,s,i){this.x=t,this.y=e,this.w=s,this.h=i}move(t,e){this.x+=t,this.y+=e}}const r=function(t){return String.fromCharCode(t.charCodeAt(0)+1)},a=function(t){return Math.floor(Math.random()*t)},n=function(t,e,s){let i=Array(t),r=0;for(;r<t;){i[r]=new Array(e);let t=0;for(;t<e;)i[r][t]=s(r,t),t++;r++}return i},o=function(t){return Math.min.apply(Math,t)};class h{constructor(t,e){this.x=t,this.y=e}eq(t){return this.x===t.x&&this.y===t.y}nextTo(t){return Math.abs(this.x-t.x)<=1&&Math.abs(this.y-t.y)<=1}copy(){return new h(this.x,this.y)}add(t){return new h(this.x+t.x,this.y+t.y)}wrappers(){return h.dxy.map(t=>this.add(t))}}h.dxy=[new h(-1,-1),new h(0,-1),new h(1,-1),new h(-1,0),new h(1,0),new h(-1,1),new h(0,1),new h(1,1)];class l{constructor(t){this.map=t,this.width=t[0].length,this.height=t.length}at(t,e){return this.map[e][t]}}},10:function(t,e,s){"use strict";s.d(e,"a",function(){return i}),s.d(e,"b",function(){return n});var i,r=s(0);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.DANGER=3]="DANGER"}(i||(i={}));class a{constructor(t,e,s){this.level=t,this.ts=e,this.message=s}}class n{constructor(){this.messages=[]}hurtMessage(t,e,s){this.debug(`${s.name()} got ${t} damage from ${e.name()}`)}killMessage(t,e,s){this.warning(`${s.name()} got ${t} damage from ${e.name()} causes them to die`)}debug(t){this.addMessage(i.DEBUG,t)}info(t){this.addMessage(i.INFO,t)}warning(t){this.addMessage(i.WARNING,t)}danger(t){this.addMessage(i.DANGER,t)}addMessage(t,e){this.messages.push(new a(t,r(),e))}}},11:function(t,e,s){"use strict";var i=s(1);class r{constructor(t,e,s,i,r,a,n){this.startx=t,this.starty=e,this.radius=s,this.width=i,this.height=r,this.checkSolid=a,this.markVisible=n,this.doubleRadius=this.radius*this.radius}calc(){this.markVisible(this.startx,this.starty,1),this.checkSolid(this.startx,this.starty)||[[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([t,e])=>{this.castLight(1,1,0,0,t,e,0),this.castLight(1,1,0,t,0,0,e)})}castLight(t,e,s,i,r,a,n){if(e<s)return;let o=0,h=!1;for(let l=t;l<=this.radius&&!h;l++){let t=-l;for(let c=-l;c<=0;c++){let u=Math.round(this.startx+c*i+t*r),d=Math.round(this.starty+c*a+t*n),g=(c-.5)/(t+.5),f=(c+.5)/(t-.5);if(u>=0&&d>=0&&u<this.width&&d<this.height&&!(e<f)){if(s>g)break;this.doubleDistance(c,t)<=this.doubleRadius&&this.markVisible(u,d,1-this.doubleDistance(c,t)/this.doubleRadius),h?this.checkSolid(u,d)?o=f:(h=!1,e=o):this.checkSolid(u,d)&&l<this.radius&&(h=!0,this.castLight(l+1,e,g,i,r,a,n),o=f)}}}}doubleDistance(t,e){return t*t+e*e}}var a,n,o=s(6),h=s(2);s.d(e,"b",function(){return a}),s.d(e,"c",function(){return n}),s.d(e,"a",function(){return g});class l{constructor(t){this.tile=t,this.visible=!1,this.degree=0,this.seen=!1}see(t,e){this.visible=!0,this.degree=e,this.seen=!0,this.tile=t.clone()}items(){return this.tile.items}tangible(t){return this.seen&&!this.tile.passibleThrough(t)}creature(){return this.tile&&this.tile.creature}reset(){this.visible=!1,this.tile.creature=void 0}}class c extends i.a{constructor(t,e){const s=o.b.retrive("W");super(Object(i.g)(e,t,()=>new l(s)))}inRange(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height}resetVisible(){this.map.forEach(t=>{t.forEach(t=>{t.reset()})})}}class u{constructor(t,e,s=u.getId()){this.id=s,this.pos=new i.b(t,e)}static getId(){return this.lastId++}clone(){return new u(this.pos.x,this.pos.y,this.id)}real(){return this.refToReal}}u.lastId=0;class d{constructor(t,e){this.actor=t,this.damage=e}affect(t){return this.damage>t.health?(t.currentLevel.logger.killMessage(this.damage,this.actor,t),t.die(),n.HURT):(t.health-=this.damage,t.currentLevel.logger.hurtMessage(this.damage,this.actor,t),n.DIE)}}!function(t){t[t.Attack=0]="Attack"}(a||(a={})),function(t){t[t.DIE=0]="DIE",t[t.HURT=1]="HURT",t[t.NOTHING=2]="NOTHING"}(n||(n={}));class g extends u{constructor(t,e,s,i,r,a){super(t,e),this.health=s,this.radius=i,this.speed=r,this.stageMemories={},this.previousPos=this.pos.copy(),this.ai=a,this.inventory=new h.b([h.a.LeftHand,h.a.RightHand,h.a.Legs,h.a.Finger,h.a.Head,h.a.Eye,h.a.Neck,h.a.Back,h.a.Body])}wear(t){this.inventory.equip(t)}name(){return`${this.id}`}addToMap(t){this.currentLevel=t,this.visionMask(t),t.addCreature(this)}emit(t){switch(t){case a.Attack:return new d(this,this.speed);default:throw`Unknow event type ${t} for ${this}`}}die(){this.currentLevel.removeCreature(this)}on(t){return t.affect(this)}real(){return this}initiativity(){return this.speed}stageMemory(t=this.currentLevel.id){return this.stageMemories[t]}act(t){this.visionMask(t),this.previousPos=this.pos.copy(),this.ai.act(this,!0),t.at(this.previousPos.x,this.previousPos.y).creature=void 0,t.at(this.pos.x,this.pos.y).creature=this}move(t){this.pos=t.copy()}clone(){let t=new u(this.pos.x,this.pos.y,this.id);return t.refToReal=this,t}visionMask(t){this.stageMemories[t.id]?this.stageMemory().resetVisible():this.stageMemories[t.id]=new c(t.width,t.height);new r(this.pos.x,this.pos.y,this.radius,t.width,t.height,this.isSolid(t),(e,s,i)=>{this.stageMemory().at(e,s).see(t.at(e,s),i)}).calc()}isSolid(t){return(e,s)=>!t.visibleThrough(e,s)&&!(t.at(e,s).isDoor()&&this.pos.x===e&&this.pos.y===s)}}},13:function(t,e,s){},14:function(t,e,s){},148:function(t,e,s){"use strict";var i=s(7).a.extend({props:["cell","player"],computed:{style(){return this.player?"player":this.cell.isWall()?"wall":this.cell.isDoor()?"door":"floor"},symbol(){return this.player?"俺":" "==this.cell.display?"・":"+"==this.cell.display?"戸":"#"==this.cell.display?"＃":"E"}}}),r=(s(179),s(8)),a=Object(r.a)(i,function(){var t=this.$createElement;return(this._self._c||t)("td",[this._v('\n  :class="style"\n  v-text="symbol"\n  @click="$emit(\'setPosition\')"\n')])},[],!1,null,null,null);e.a=a.exports},149:function(t,e,s){"use strict";var i=s(7),r=s(3),a=s(10),n=s(0),o=i.a.extend({name:"Logger",props:["logger"],computed:{messages(){return Object(r.takeRight)(this.logger.messages,5)}},methods:{ts:t=>n(t.ts).format("hh:mm:ss"),rowClass(t){switch(t.level){case a.a.DEBUG:return"table-secondary";case a.a.INFO:return"table-info";case a.a.WARNING:return"table-warning";case a.a.DANGER:return"table-danger"}}}}),h=(s(176),s(8)),l=Object(h.a)(o,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"container",staticClass:"logger"},[s("table",{staticClass:"table table-sm table-striped"},[s("tbody",t._l(t.messages,function(e){return s("tr",{class:t.rowClass(e)},[s("td",[t._v(t._s(t.ts(e)))]),t._v(" "),s("td",[t._v(t._s(e.message))])])}))])])},[],!1,null,null,null);e.a=l.exports},15:function(t,e,s){},150:function(t,e,s){"use strict";var i=s(7);class r{constructor(t,e,s,i,r,a,n){this.ch=t,this.r=e,this.g=s,this.b=i,this.br=r,this.bg=a,this.bb=n}getChar(){return this.ch}setChar(t){this.ch=t}setColor(t,e,s){this.r=t,this.g=e,this.b=s}setGrey(t){this.r=t,this.g=t,this.b=t}setBackground(t,e,s){this.br=t,this.bg=e,this.bb=s}backgroundToColor(){this.r=this.br,this.g=this.bg,this.b=this.bb}swapColors(){this.r=[this.br,this.br=this.r][0],this.g=[this.bg,this.bg=this.g][0],this.b=[this.bb,this.bb=this.b][0]}resetColor(){this.r=this.g=this.b=void 0}resetBackground(){this.br=this.bg=this.bb=void 0}getColorHex(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""}getBackgroundHex(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""}getColorRGB(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?`rgb(${this.r},${this.g},${this.b})`:""}getBackgroundRGB(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?`rgb(${this.br},${this.bg},${this.bb})`:""}getColorJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}}getBackgroundJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}}copy(t){this.ch=t.ch,this.r=t.r,this.g=t.g,this.b=t.b,this.br=t.br,this.bg=t.bg,this.bb=t.bb}clone(){return new r(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)}}const a="unicodetiles",n=new r(" ");const o="\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n",h="\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n";const l=function(t){return new class{constructor(t){if(this.view=t,this.view=t,this.canvas=document.createElement("canvas"),!this.canvas.getContext)throw"Canvas not supported";if(this.gl=this.canvas.getContext("experimental-webgl"),!this.gl)throw"WebGL not supported";if(t.elem.appendChild(this.canvas),this.charMap={},this.charArray=[],this.defaultColors={r:1,g:1,b:1,br:0,bg:0,bb:0},this.attribs={position:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},texCoord:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},color:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},bgColor:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},charIndex:{buffer:null,data:null,itemSize:1,location:null,hint:this.gl.DYNAMIC_DRAW}},this.offscreen||(this.offscreen=document.createElement("canvas")),this.offscreen.style.position="absolute",this.offscreen.style.top="0px",this.offscreen.style.left="0px",this.ctx=this.offscreen.getContext("2d"),!this.ctx)throw"Failed to acquire offscreen canvas drawing context";this.updateStyle(),this.canvas.width=(t.squarify?this.th:this.tw)*t.w,this.canvas.height=this.th*t.h,this.offscreen.width=0,this.offscreen.height=0,this.updateStyle(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height);let e=this.compileShader(this.gl.VERTEX_SHADER,o),s=this.compileShader(this.gl.FRAGMENT_SHADER,h),i=this.gl.createProgram();if(this.gl.attachShader(i,e),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.deleteShader(e),this.gl.deleteShader(s),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS)){const t=`Error linking program: ${this.gl.getProgramInfoLog(i)}`;throw this.gl.deleteProgram(i),t}this.gl.useProgram(i),this.attribs.position.location=this.gl.getAttribLocation(i,"position"),this.attribs.texCoord.location=this.gl.getAttribLocation(i,"texCoord"),this.attribs.color.location=this.gl.getAttribLocation(i,"color"),this.attribs.bgColor.location=this.gl.getAttribLocation(i,"bgColor"),this.attribs.charIndex.location=this.gl.getAttribLocation(i,"charIndex"),this.initBuffers();let r=this.gl.getUniformLocation(i,"uResolution");this.gl.uniform2f(r,this.canvas.width,this.canvas.height),this.tileCountsLocation=this.gl.getUniformLocation(i,"uTileCounts"),this.gl.uniform2f(this.tileCountsLocation,this.view.w,this.view.h),this.paddingLocation=this.gl.getUniformLocation(i,"uPadding"),this.gl.uniform2f(this.paddingLocation,0,0);let a=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.cacheChars(" !\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.activeTexture(this.gl.TEXTURE0),setTimeout(()=>{this.updateStyle(),this.buildTexture(),this.render()},100)}getRendererString(){return"webgl"}buildTexture(){let t=this.offscreen.width/(this.tw+this.pad),e=this.offscreen.height/(this.th+this.pad);const s=this.charArray.length;s>Math.floor(t)*Math.floor(e)&&(e=(t=Math.ceil(Math.sqrt(s)))+2,this.offscreen.width=t*(this.tw+this.pad),this.offscreen.height=e*(this.th+this.pad),this.updateStyle(),this.gl.uniform2f(this.tileCountsLocation,t,e)),this.gl.uniform2f(this.paddingLocation,this.pad/this.offscreen.width,this.pad/this.offscreen.height);let i,r=0;this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.offscreen.width,this.offscreen.height),this.ctx.fillStyle="#ffffff";const a=.5*this.gap,n=this.tw+this.pad,o=this.th+this.pad;let h=.5*o;for(let s=0;s<e;++s){let e=.5*this.pad;for(let s=0;s<t&&void 0!==(i=this.charArray[r]);++s,++r)this.ctx.fillText(i,e+a,h),e+=n;if(!i)break;h+=o}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.offscreen)}cacheChars(t,e=!0){if(!this.gl)return;let s=!1;for(let e=0;e<t.length;++e)this.charMap[t[e]]||(s=!0,this.charArray.push(t[e]),this.charMap[t[e]]=this.charArray.length-1);s&&e&&this.buildTexture()}updateStyle(t){t=t||window.getComputedStyle(this.view.elem,null),this.ctx.font=t.fontSize+"/"+t.lineHeight+" "+t.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.tw=this.ctx.measureText("幅").width,this.th=parseInt(t.fontSize,10),this.gap=this.view.squarify?this.th-this.tw:0,this.view.squarify&&(this.tw=this.th),this.pad=2*Math.ceil(.2*this.th);const e=t.color.match(/\d+/g),s=t.backgroundColor.match(/\d+/g);this.defaultColors.r=parseInt(e[0],10)/255,this.defaultColors.g=parseInt(e[1],10)/255,this.defaultColors.b=parseInt(e[2],10)/255,this.defaultColors.br=parseInt(s[0],10)/255,this.defaultColors.bg=parseInt(s[1],10)/255,this.defaultColors.bb=parseInt(s[2],10)/255}clear(){}render(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);const t=this.view.w,e=this.view.h;let s=this.view.buffer,i=(this.view.defaultColor,this.view.defaultBackground,!1);for(let r=0;r<e;++r)for(let e=0;e<t;++e){const a=s[r][e];let n=this.charMap[a.ch];void 0===n&&(this.cacheChars(a.ch,!1),i=!0,n=this.charMap[a.ch]);const o=6*this.attribs.color.itemSize*(r*t+e),h=6*this.attribs.charIndex.itemSize*(r*t+e),l=void 0===a.r?this.defaultColors.r:a.r/255,c=void 0===a.g?this.defaultColors.g:a.g/255,u=void 0===a.b?this.defaultColors.b:a.b/255,d=void 0===a.br?this.defaultColors.br:a.br/255,g=void 0===a.bg?this.defaultColors.bg:a.bg/255,f=void 0===a.bb?this.defaultColors.bb:a.bb/255;for(let t=0;t<6;++t){const e=o+t*this.attribs.color.itemSize;this.attribs.color.data[e+0]=l,this.attribs.color.data[e+1]=c,this.attribs.color.data[e+2]=u,this.attribs.bgColor.data[e+0]=d,this.attribs.bgColor.data[e+1]=g,this.attribs.bgColor.data[e+2]=f,this.attribs.charIndex.data[h+t]=n}}i&&this.buildTexture(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.color.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.color.data,this.attribs.color.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.bgColor.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.bgColor.data,this.attribs.bgColor.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.charIndex.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.charIndex.data,this.attribs.charIndex.hint);const r=this.attribs.position;this.gl.drawArrays(this.gl.TRIANGLES,0,r.data.length/r.itemSize)}compileShader(t,e){const s=this.gl.createShader(t);if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const t="Error compiling shader: "+this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),t}return s}initBuffers(){let t,e,s=this.attribs;const i=this.view.w,r=this.view.h;for(t in this.attribs)(e=s[t]).data=new Float32Array(6*e.itemSize*i*r);for(let t=0;t<r;++t)for(let e=0;e<i;++e){const r=6*s.position.itemSize*(t*i+e);this.insertQuad(s.position.data,r,e*this.tw,t*this.th,this.tw,this.th),this.insertQuad(s.texCoord.data,r,0,0,1,1)}for(t in this.attribs)(e=s[t]).buffer&&this.gl.deleteBuffer(e.buffer),e.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.data,e.hint),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.itemSize,this.gl.FLOAT,!1,0,0)}insertQuad(t,e,s,i,r,a){const n=s,o=i,h=s+r,l=i+a;t[e]=n,t[++e]=o,t[++e]=h,t[++e]=o,t[++e]=n,t[++e]=l,t[++e]=n,t[++e]=l,t[++e]=h,t[++e]=o,t[++e]=h,t[++e]=l}}(t)};var c=s(9);const u=120,d=180,g={r:255,g:165,b:0};class f extends r{lighted(t){return this}constructor(t,e=u,s=u,i=u){super(t,e,s,i)}litBackground(t,e){return t.setBackground(g.r*e,g.g*e,g.b*e),t}litColor(t,e){return t.setColor(g.r*e,g.g*e,g.b*e),t}}class m extends f{constructor(t){super(t,d,d,d)}}class p extends m{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}class v extends f{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}const b=new v("刀",200,200,200),_=new v("体",200,200,200),w=function(t){switch(t.kind){case c.b.Katana:return b;case c.b.Corpse:return _;default:throw`Unknow item ${t} with type ${t.kind}`}};var y=s(5),x=s(2);const C=new p("俺",0,255,0),E=new p("俺",255,0,0),j=new p("俺",0,0,255),k=new p("俺",255,0,255),M=new p("俺",0,255,255),T=new class extends f{constructor(){super("戸")}lighted(t){let e=this.clone();return this.litColor(e,t),e.swapColors(),e}},I=new class extends f{constructor(){super("＃")}lighted(t){let e=this.clone();return this.litBackground(e,t),e.backgroundToColor(),e}},P=new class extends f{constructor(){super("・")}lighted(t){return this.litColor(this.clone(),t)}},D=new r("　",0,0,0),O=[new v("｜",200,200,200),new v("／",200,200,200),new v("ー",200,200,200),new v("＼",200,200,200)];var R=i.a.extend({props:["level"],data(){return{term:null,eng:null,drawInterval:null,ts:Date.now(),fps:0,counter:0,interval:100,nextStep:!1,step:0,pause:!1,player:this.level.creatures[0]}},methods:{aiName(t){return t instanceof y.h?"Patrol":t instanceof y.e?"Escaper":t instanceof y.c?"Chaser":t instanceof y.f?"Explorer":t instanceof y.j?"Waiter":t instanceof y.g?`Loiter (${this.aiName(t.prevAI)})`:t instanceof y.d?`Dispatcher (${this.aiName(t.prevAI)})`:t instanceof y.i?"Picker":void 0},getTile(t,e){const s=this.stage.at(t,e).tile;if(!s)return D;if(s.creature)switch(s.creature.id%5){case 0:return M;case 1:return k;case 2:return j;case 3:return E;case 4:return C}if(s.items.length){if(1===s.items.length)return w(s.items[0]);const t=this.step%(3*this.animationFps+4);if(t<O.length)return O[t];{const t=Math.floor(this.step/(3*this.animationFps+4));return w(s.items[t%s.items.length])}}switch(s.display){case"#":return I;case"+":return T;case" ":return P;default:return D}},initViewport(){this.term=new class{constructor(t,e,s,i,r=!1){this.elem=t,this.w=e,this.h=s,this.squarify=r,this.cx=Math.floor(e/2),this.cy=Math.floor(s/2),this.elem.innerHTML="",-1===t.className.indexOf(a)&&(0===t.className.length?t.className=a:t.className+=" "+a),this.buffer=new Array(s);for(let t=0;t<s;++t){this.buffer[t]=new Array(e);for(let s=0;s<e;++s)this.buffer[t][s]=n}this.renderer=i(this)}updateStyle(t){const e=window.getComputedStyle(this.elem,null);this.defaultColor=e.color||void 0,this.defaultBackground=e.backgroundColor||void 0,t&&this.renderer.updateStyle(e)}getRendererString(){return this.renderer.getRendererString()}put(t,e,s){e<0||s<0||e>=this.w||s>=this.h||(this.buffer[s][e]=t)}unsafePut(t,e,s){this.buffer[s][e]=t}putString(t,e,s,i,a,n,o,h,l){const c=t.length;if(!(e<0||s<0))for(let u=0;u<c;++u){if(e>=this.w&&(e=0,++s),s>=this.h)return;const c=new r(t[u],i,a,n,o,h,l);this.unsafePut(c,e,s),++e}}get(t,e){return t<0||e<0||t>=this.w||e>=this.h?n:this.buffer[e][t]}clear(){for(let t=0;t<this.h;++t)for(let e=0;e<this.w;++e)this.buffer[t][e]=n;this.renderer.clear()}render(){this.renderer.render()}}(this.$refs.scene,this.level.width,this.level.height,l,!0),this.eng=new class{constructor(t,e,s,i){this.viewport=t,this.tileFunc=e,this.w=s,this.h=i,this.refreshCache=!0,this.cacheEnabled=!1,this.transitionDuration=0,this.cachex=0,this.cachey=0,this.tileCache=new Array(t.h),this.tileCache2=new Array(t.h);for(let e=0;e<t.h;++e)this.tileCache[e]=new Array(t.w),this.tileCache2[e]=new Array(t.w)}setTileFunc(t,e,s){e&&(this.transition=void 0,"string"==typeof e&&("boxin"===e?this.transition=function(t,e,s,i,r,a,n){const o=.5*s,h=.5*i;return t-=o,e-=h,Math.abs(t)<o*n&&Math.abs(e)<h*n?r:a}:"boxout"===e?this.transition=function(t,e,s,i,r,a,n){const o=.5*s,h=.5*i;return t-=o,e-=h,n=1-n,Math.abs(t)<o*n&&Math.abs(e)<h*n?a:r}:"circlein"===e?this.transition=function(t,e,s,i,r,a,n){const o=.5*s,h=.5*i;return(t-=o)*t+(e-=h)*e<(o*o+h*h)*n?r:a}:"circleout"===e?this.transition=function(t,e,s,i,r,a,n){const o=.5*s,h=.5*i;return(t-=o)*t+(e-=h)*e>(o*o+h*h)*(n=1-n)?r:a}:"random"===e&&(this.transition=function(t,e,s,i,r,a,n){return Math.random()>n?a:r})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=s||500)),this.tileFunc=t}setMaskFunc(t){this.maskFunc=t}setShaderFunc(t){this.shaderFunc=t}setWorldSize(t,e){this.w=t,this.h=e}setCacheEnabled(t){this.cacheEnabled=t,this.refreshCache=!0}update(t,e){t=t||0,e=e||0;const s=t-this.viewport.cx,i=e-this.viewport.cy,r=(new Date).getTime();let a,o;this.transition&&this.transitionTimer&&(a=(r-this.transitionTimer)/this.transitionDuration),a&&a>=1&&(this.transition=void 0);for(let t=0;t<this.viewport.h;++t)for(let e=0;e<this.viewport.w;++e){const h=e+s,l=t+i;if(this.w&&(h<0||h>=this.w))o=n;else if(this.h&&(l<0||l>=this.w))o=n;else if(this.maskFunc&&!this.maskFunc(h,l))o=n;else if(this.transition&&!this.refreshCache)o=this.transition(e,t,this.viewport.w,this.viewport.h,this.tileFunc(h,l),this.tileCache[t][e],a||0);else if(this.cacheEnabled&&!this.refreshCache){const t=h-this.cachex,e=l-this.cachey;t>=0&&t<this.viewport.w&&e>=0&&e<this.viewport.h?(o=this.tileCache[e][t])===n&&(o=this.tileFunc(h,l)):o=this.tileFunc(h,l)}else o=this.tileFunc(h,l);this.tileCache2[t][e]=o,this.shaderFunc&&o!==n&&(o=this.shaderFunc(o,h,l,r)),this.viewport.unsafePut(o,e,t)}this.cachex=s,this.cachey=i;const h=this.tileCache;this.tileCache=this.tileCache2,this.tileCache2=h,this.refreshCache=!1}}(this.term,(t,e)=>this.getTile(t,e),this.level.width,this.level.height),this.eng.setMaskFunc((t,e)=>this.stage.at(t,e).seen),this.eng.setShaderFunc((t,e,s,i)=>this.lighting(t,e,s,i)),clearInterval(this.drawInterval),this.drawInterval=setInterval(()=>{this.drawScene()},this.interval)},drawScene(){if(this.done)return;const t=Date.now();this.ts+1e3<t&&(this.fps=this.counter,this.counter=0,this.ts=t),this.done=!0,this.pause&&!this.nextStep||(this.nextStep=!1,this.level.turn(),this.player=this.level.creatures[0]),this.eng.update(this.term.cx,this.term.cy),this.term.render(),this.done=!1,this.counter+=1,this.step+=1},lighting(t,e,s,i){const r=this.stage.at(e,s);return r.visible&&t.lighted?t.lighted(r.degree):t},displayItem(t){if(t)return`${w(t).getChar()} ${t.name}`},displayBodyPart(t){switch(t){case x.a.LeftHand:case x.a.RightHand:return"手";case x.a.Legs:return"足";case x.a.Finger:return"指";case x.a.Head:return"頭";case x.a.Eye:return"目";case x.a.Neck:return"首";case x.a.Back:return"背";case x.a.Body:return"体";default:throw`Unknow body part ${t}`}}},computed:{stage(){return this.player.stageMemory(this.level.id)},animationFps(){return 1e3/this.interval}},mounted(){this.initViewport()},beforeDestroy(){clearInterval(this.drawInterval)},watch:{level(){this.initViewport()},interval(){this.initViewport()}}}),A=(s(162),s(8)),S=Object(A.a)(R,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"scene"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col mr-0"},[s("div",{ref:"scene",staticClass:"unicodetiles"})]),t._v(" "),s("div",{staticClass:"col pl-0"},[s("div",{staticClass:"fps mb-2 "},[t._v("FPS "+t._s(t.fps))]),t._v(" "),t._l(t.level.creatures,function(e){return s("dl",{key:e.id,staticClass:"row small"},[s("dd",{staticClass:"col-sm-4"},[t._v("\n          ID\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n          "+t._s(e.id)+"\n        ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          POS\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n          "+t._s(e.pos)+"\n        ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          健康\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n          "+t._s(e.health)+"\n        ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          Initiation\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n          "+t._s(e.initiativity())+"\n        ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          AI\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n          "+t._s(t.aiName(e.ai))+"\n        ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          服\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[s("table",t._l(e.inventory.wears(),function(e,i){return s("tr",{key:"bodyPart"+i},[s("td",[t._v("\n                "+t._s(t.displayBodyPart(e.bodyPart))+"\n              ")]),t._v(" "),s("td",[t._v("\n                "+t._s(t.displayItem(e.equipment))+"\n              ")])])}))]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n          鞄\n        ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[s("ul",t._l(e.inventory.cares(),function(e){return s("li",{key:e.id},[t._v("\n                "+t._s(t.displayItem(e))+"\n            ")])}))])])}),t._v(" "),s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-2"},[t._v("Map")]),t._v(" "),s("div",{staticClass:"col-sm-10"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.interval,expression:"interval"}],staticClass:"form-control",attrs:{id:"interval",type:"number"},domProps:{value:t.interval},on:{input:function(e){e.target.composing||(t.interval=e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"interval"}},[t._v("\n              Tick interval\n            ")])]),t._v(" "),s("button",{staticClass:"btn btn-secondary",on:{click:function(e){t.nextStep=!0}}},[t._v("\n            Next step\n          ")]),t._v(" "),s("button",{staticClass:"btn btn-secondary",on:{click:function(e){t.pause=!t.pause}}},[t._v("\n            "+t._s(t.pause?"Start":"Pause")+"\n          ")])])])],2)])])},[],!1,null,null,null);e.a=S.exports},151:function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(6);const r=function(t,e=(()=>!0)){for(let s=1;s<t.height-1;s++)for(let r=1;r<t.width;r++){const a=t.at(r,s),n=t.at(r,s-1),o=t.at(r,s+1),h=t.at(r-1,s),l=t.at(r+1,s);e()&&"C"===a.key&&("D"!==h.key&&"D"!==l.key&&"D"!==n.key&&"D"!==o.key&&("R"!==h.key&&"R"!==l.key&&"R"!==n.key&&"R"!==o.key||("W"===h.key&&"W"===l.key||"W"===n.key&&"W"===o.key)&&t.setTile(r,s,i.b.retrive("D"))))}return t}},152:function(t,e,s){"use strict";s.d(e,"a",function(){return l});var i=s(1),r=s(6);const a=0,n=function(){return r.b.retrive("R")},o=function(){return r.b.retrive("C")},h=function(){return r.b.retrive("W")},l=function(t,e,s=5,a=5,n=3){const o=new class{constructor(t,e,s,i,r){this.maxX=t,this.maxY=e,this.minSize=s,this.maxSize=i,this.roomsCount=r;let a=[],n=0;for(;n<this.roomsCount;)a.push(this.generateRoom()),n+=1;this.rooms=this.normalize(this.fuzzifyRooms(a)),this.roads=this.buildRoads(this.rooms)}generateRoom(){return new c(0,0,this.minSize+Object(i.e)(this.maxSize-this.minSize),this.minSize+Object(i.e)(this.maxSize-this.minSize))}fuzzifyRooms(t){let e=[t.shift()];for(;t.length;){let s=t.shift(),r=Object(i.e)(360)/180*Math.PI;const a=Math.cos(r),n=Math.sin(r);let o=0,h=0,l=0;for(;!e.every(t=>s.notCross(t));){let t=Math.round(o*a),e=Math.round(o*n);for(;o+=1,t=Math.round(o*a),e=Math.round(o*n),t===h&&e===l;);s.move(t-h,e-l),h=t,l=e}e.push(s)}return e}normalize(t){const e=Object(i.d)(t.map(t=>t.x))-1,s=Object(i.d)(t.map(t=>t.y))-1;return t.forEach(t=>{t.move(-e,-s)}),t.filter(t=>t.x+t.w<this.maxX&&t.y+t.h<this.maxY)}buildRoads(t){let e=t.map(t=>t.pointWithin()),s=[e.shift()],i=[];const r=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)};for(;e.length;){let t=e.shift(),a=s[0],n=r(t,a);s.forEach(e=>{const s=r(e,t);s<n&&(a=e,n=s)}),s.push(t),i.push(new u(t.x,t.y,a.x,a.y))}return i}}(t,e,s,a,n);let l=Object(i.g)(t,e,h);for(let t=0;t<o.rooms.length;t++)o.rooms[t].add(l);for(let t=0;t<o.roads.length;t++)o.roads[t].add(l);return new r.a(l)};class c extends i.c{notCross(t){return t.x-a>this.x+this.w||t.y-a>this.y+this.h||t.x+t.w<this.x-a||t.y+t.h<this.y-a}pointWithin(){return new i.b(this.x+1+Object(i.e)(this.w-1),this.y+1+Object(i.e)(this.h-1))}add(t){let e=0;for(;e<this.w;){let s=0;for(;s<this.h;)t[this.x+e][this.y+s]=n(),s++;e++}}}class u extends i.c{constructor(t,e,s,i){super(t,e,s,i),this.lined=t>=s&&e>=i||s>=t&&i>=e}add(t){let[e,s,i]=this.horizontalLine(),r=0;for(;r<i;)"W"===t[e+r][s].key&&(t[e+r][s]=o()),r+=1;let[a,n,h]=this.verticallLine(),l=0;for(;l<h;)"W"===t[a][n+l].key&&(t[a][n+l]=o()),l+=1}horizontalLine(){return this.lined?[Math.min(this.x,this.w),Math.max(this.y,this.h),Math.abs(this.w-this.x)]:[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.w-this.x)]}verticallLine(){return this.lined,[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.h-this.y)]}}},154:function(t,e,s){"use strict";s.r(e);var i=s(7),r=s(17).a,a=(s(160),s(8)),n=Object(a.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"app"}},[t.map.creatures.length?s("Scene",{attrs:{level:t.map}}):t._e(),t._v(" "),s("Logger",{attrs:{logger:t.map.logger}}),t._v(" "),s("div",{staticClass:"mb-5"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.formula,expression:"formula"}],attrs:{type:"text",placeholder:"formula"},domProps:{value:t.formula},on:{input:function(e){e.target.composing||(t.formula=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.minVal,expression:"minVal"}],attrs:{type:"number",placeholder:"min"},domProps:{value:t.minVal},on:{input:function(e){e.target.composing||(t.minVal=e.target.value)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.maxVal,expression:"maxVal"}],attrs:{type:"number",placeholder:"max"},domProps:{value:t.maxVal},on:{input:function(e){e.target.composing||(t.maxVal=e.target.value)}}}),t._v(" "),s("table",[s("tr",[s("th",[t._v("D\\A")]),t._v(" "),t._l(t.values,function(e){return s("th",{key:e},[t._v(t._s(e))])})],2),t._v(" "),t._l(t.values,function(e){return s("tr",{key:e},[s("th",[t._v(t._s(e))]),t._v(" "),t._l(t.values,function(i){return s("td",{key:i,staticStyle:{border:"1px solid black"}},[t._v("\n          "+t._s(t.calc(i,e))+"\n        ")])})],2)})],2)]),t._v(" "),s("div",{},[s("div",{},[s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-sm-2 col-form-label",attrs:{for:"radius"}},[t._v("\n          Radius\n        ")]),t._v(" "),s("div",{staticClass:"col-sm-10"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.radius,expression:"radius"}],staticClass:"form-control",attrs:{id:"radius",type:"number"},domProps:{value:t.radius},on:{input:function(e){e.target.composing||(t.radius=e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-2"},[t._v("\n          Map\n        ")]),t._v(" "),s("div",{staticClass:"col-sm-10"},[s("div",{staticClass:"form-check"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.addDoors,expression:"generatorOptions.addDoors"}],staticClass:"form-check-input",attrs:{id:"doors",type:"checkbox"},domProps:{checked:Array.isArray(t.generatorOptions.addDoors)?t._i(t.generatorOptions.addDoors,null)>-1:t.generatorOptions.addDoors},on:{change:function(e){var s=t.generatorOptions.addDoors,i=e.target,r=!!i.checked;if(Array.isArray(s)){var a=t._i(s,null);i.checked?a<0&&t.$set(t.generatorOptions,"addDoors",s.concat([null])):a>-1&&t.$set(t.generatorOptions,"addDoors",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.generatorOptions,"addDoors",r)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"doors"}},[t._v("\n              Add doors\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.roomsCount,expression:"generatorOptions.roomsCount"}],staticClass:"form-control",attrs:{id:"roomsCount",type:"number"},domProps:{value:t.generatorOptions.roomsCount},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"roomsCount",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"roomsCount"}},[t._v("\n              roomsCount\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.minSize,expression:"generatorOptions.minSize"}],staticClass:"form-control",attrs:{id:"minSize",type:"number"},domProps:{value:t.generatorOptions.minSize},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"minSize",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"minSize"}},[t._v("\n              minSize\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.maxSize,expression:"generatorOptions.maxSize"}],staticClass:"form-control",attrs:{id:"maxSize",type:"number"},domProps:{value:t.generatorOptions.maxSize},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"maxSize",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"maxSize"}},[t._v("\n              maxSize\n            ")])])])]),t._v(" "),s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-10"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.generateMap()}}},[t._v("\n            Rebuild!\n          ")])])])])])],1)},[],!1,null,null,null).exports;s(158),s(156);new i.a({el:"#app",render:t=>t(n)})},158:function(t,e,s){},16:function(t,e,s){},160:function(t,e,s){"use strict";var i=s(13);s.n(i).a},162:function(t,e,s){"use strict";var i=s(14);s.n(i).a},17:function(module,__webpack_exports__,__webpack_require__){"use strict";var vue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_Cell_vue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(148),_Logger_vue__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(149),_Scene_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(150),_map__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6),_creature__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11),_generator_dungeon__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(152),_generator_post__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(151),_items__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9),_ai__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5);__webpack_exports__.a=vue__WEBPACK_IMPORTED_MODULE_0__.a.extend({data:()=>({map:new _map__WEBPACK_IMPORTED_MODULE_4__.a([[]]),radius:10,ts:Date.now(),generatorOptions:{addDoors:!1,minSize:5,maxSize:5,roomsCount:3},minVal:1,maxVal:10,formula:"Math.floor(10 * a / d)"}),computed:{values(){let t=[];for(let e=this.minVal;e<=this.maxVal;e++)t.push(e);return t}},components:{Cell:_Cell_vue__WEBPACK_IMPORTED_MODULE_1__.a,Logger:_Logger_vue__WEBPACK_IMPORTED_MODULE_2__.a,Scene:_Scene_vue__WEBPACK_IMPORTED_MODULE_3__.a},methods:{calc(a,d){try{return eval(this.formula)}catch(t){return"E"}},generateMap(){this.map=this.buildMap();let t=1,e=1;for(;!this.map.visibleThrough(t,e);)t<this.map.width-1?t+=1:(t=1,e+=1);const s=new _creature__WEBPACK_IMPORTED_MODULE_5__.a(t,e,50,this.radius,10,new _ai__WEBPACK_IMPORTED_MODULE_9__.d);for(s.addToMap(this.map),s.wear(new _items__WEBPACK_IMPORTED_MODULE_8__.c),t=this.map.width-1,e=this.map.height-1;!this.map.visibleThrough(t,e);)t>1?t-=1:(t=this.map.width-1,e-=1);const i=new _creature__WEBPACK_IMPORTED_MODULE_5__.a(t,e,100,this.radius,5,new _ai__WEBPACK_IMPORTED_MODULE_9__.d);i.addToMap(this.map),i.wear(new _items__WEBPACK_IMPORTED_MODULE_8__.c)},buildMap(){let t=Object(_generator_dungeon__WEBPACK_IMPORTED_MODULE_6__.a)(50,50,this.generatorOptions.minSize,this.generatorOptions.maxSize,this.generatorOptions.roomsCount);return this.generatorOptions.addDoors?Object(_generator_post__WEBPACK_IMPORTED_MODULE_7__.a)(t):t}},created(){this.generateMap()}})},176:function(t,e,s){"use strict";var i=s(15);s.n(i).a},177:function(t,e,s){var i={"./af":146,"./af.js":146,"./ar":145,"./ar-dz":144,"./ar-dz.js":144,"./ar-kw":143,"./ar-kw.js":143,"./ar-ly":142,"./ar-ly.js":142,"./ar-ma":141,"./ar-ma.js":141,"./ar-sa":140,"./ar-sa.js":140,"./ar-tn":139,"./ar-tn.js":139,"./ar.js":145,"./az":138,"./az.js":138,"./be":137,"./be.js":137,"./bg":136,"./bg.js":136,"./bm":135,"./bm.js":135,"./bn":134,"./bn.js":134,"./bo":133,"./bo.js":133,"./br":132,"./br.js":132,"./bs":131,"./bs.js":131,"./ca":130,"./ca.js":130,"./cs":129,"./cs.js":129,"./cv":128,"./cv.js":128,"./cy":127,"./cy.js":127,"./da":126,"./da.js":126,"./de":125,"./de-at":124,"./de-at.js":124,"./de-ch":123,"./de-ch.js":123,"./de.js":125,"./dv":122,"./dv.js":122,"./el":121,"./el.js":121,"./en-au":120,"./en-au.js":120,"./en-ca":119,"./en-ca.js":119,"./en-gb":118,"./en-gb.js":118,"./en-ie":117,"./en-ie.js":117,"./en-il":116,"./en-il.js":116,"./en-nz":115,"./en-nz.js":115,"./eo":114,"./eo.js":114,"./es":113,"./es-do":112,"./es-do.js":112,"./es-us":111,"./es-us.js":111,"./es.js":113,"./et":110,"./et.js":110,"./eu":109,"./eu.js":109,"./fa":108,"./fa.js":108,"./fi":107,"./fi.js":107,"./fo":106,"./fo.js":106,"./fr":105,"./fr-ca":104,"./fr-ca.js":104,"./fr-ch":103,"./fr-ch.js":103,"./fr.js":105,"./fy":102,"./fy.js":102,"./gd":101,"./gd.js":101,"./gl":100,"./gl.js":100,"./gom-latn":99,"./gom-latn.js":99,"./gu":98,"./gu.js":98,"./he":97,"./he.js":97,"./hi":96,"./hi.js":96,"./hr":95,"./hr.js":95,"./hu":94,"./hu.js":94,"./hy-am":93,"./hy-am.js":93,"./id":92,"./id.js":92,"./is":91,"./is.js":91,"./it":90,"./it.js":90,"./ja":89,"./ja.js":89,"./jv":88,"./jv.js":88,"./ka":87,"./ka.js":87,"./kk":86,"./kk.js":86,"./km":85,"./km.js":85,"./kn":84,"./kn.js":84,"./ko":83,"./ko.js":83,"./ky":82,"./ky.js":82,"./lb":81,"./lb.js":81,"./lo":80,"./lo.js":80,"./lt":79,"./lt.js":79,"./lv":78,"./lv.js":78,"./me":77,"./me.js":77,"./mi":76,"./mi.js":76,"./mk":75,"./mk.js":75,"./ml":74,"./ml.js":74,"./mn":73,"./mn.js":73,"./mr":72,"./mr.js":72,"./ms":71,"./ms-my":70,"./ms-my.js":70,"./ms.js":71,"./mt":69,"./mt.js":69,"./my":68,"./my.js":68,"./nb":67,"./nb.js":67,"./ne":66,"./ne.js":66,"./nl":65,"./nl-be":64,"./nl-be.js":64,"./nl.js":65,"./nn":63,"./nn.js":63,"./pa-in":62,"./pa-in.js":62,"./pl":61,"./pl.js":61,"./pt":60,"./pt-br":59,"./pt-br.js":59,"./pt.js":60,"./ro":58,"./ro.js":58,"./ru":57,"./ru.js":57,"./sd":56,"./sd.js":56,"./se":55,"./se.js":55,"./si":54,"./si.js":54,"./sk":53,"./sk.js":53,"./sl":52,"./sl.js":52,"./sq":51,"./sq.js":51,"./sr":50,"./sr-cyrl":49,"./sr-cyrl.js":49,"./sr.js":50,"./ss":48,"./ss.js":48,"./sv":47,"./sv.js":47,"./sw":46,"./sw.js":46,"./ta":45,"./ta.js":45,"./te":44,"./te.js":44,"./tet":43,"./tet.js":43,"./tg":42,"./tg.js":42,"./th":41,"./th.js":41,"./tl-ph":40,"./tl-ph.js":40,"./tlh":39,"./tlh.js":39,"./tr":38,"./tr.js":38,"./tzl":37,"./tzl.js":37,"./tzm":36,"./tzm-latn":35,"./tzm-latn.js":35,"./tzm.js":36,"./ug-cn":34,"./ug-cn.js":34,"./uk":33,"./uk.js":33,"./ur":32,"./ur.js":32,"./uz":31,"./uz-latn":30,"./uz-latn.js":30,"./uz.js":31,"./vi":29,"./vi.js":29,"./x-pseudo":28,"./x-pseudo.js":28,"./yo":27,"./yo.js":27,"./zh-cn":26,"./zh-cn.js":26,"./zh-hk":25,"./zh-hk.js":25,"./zh-tw":24,"./zh-tw.js":24};function r(t){var e=a(t);return s(e)}function a(t){var e=i[t];if(!(e+1)){var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}return e}r.keys=function(){return Object.keys(i)},r.resolve=a,t.exports=r,r.id=177},179:function(t,e,s){"use strict";var i=s(16);s.n(i).a},183:function(t,e,s){t.exports=s(154)},2:function(t,e,s){"use strict";s.d(e,"a",function(){return i}),s.d(e,"b",function(){return a});var i,r=s(3);!function(t){t[t.LeftHand=0]="LeftHand",t[t.RightHand=1]="RightHand",t[t.Legs=2]="Legs",t[t.Finger=3]="Finger",t[t.Head=4]="Head",t[t.Eye=5]="Eye",t[t.Neck=6]="Neck",t[t.Back=7]="Back",t[t.Body=8]="Body"}(i||(i={}));class a{constructor(t){this.wearings=[],this.bag=[],this.wearings=t.map(t=>({bodyPart:t}))}wears(){return this.wearings}cares(){return this.bag}equip(t){this.wearings.forEach(e=>{if(e.bodyPart===t.bodyPart())return e.equipment&&this.putToBag(e.equipment),e.equipment=t})}takeOff(t){this.wearings.forEach(e=>{if(e.equipment&&e.equipment.id===t.id)return this.putToBag(e.equipment),e.equipment=null})}putToBag(t){this.bag.push(t)}removeFromBag(t){Object(r.remove)(this.bag,e=>e.id===t.id)}}},5:function(t,e,s){"use strict";var i=s(1),r=s(3);const a=1;class n{constructor(t){this.prevAI=t}moveTo(t,e){const s=this.leePath(t,t=>e.eq(t));return s.length&&t.move(s[0]),!!s.length}followTo(t,e){const s=this.leePath(t,t=>e.nextTo(t));return s.length&&t.move(s[0]),!!s.length}leePath(t,e,s=!1){const a=t.stageMemory();let n=Object(i.g)(a.height,a.width,()=>void 0),o=[],h=[t.pos],l=0;for(;h.length&&!o.length;){let s=[];h.forEach(i=>{if(!a.inRange(i))return;const r=a.at(i.x,i.y);r.tangible(t)||void 0!==n[i.x][i.y]||(n[i.x][i.y]=l,e(i,r)?o.push(i):i.wrappers().forEach(t=>s.push(t)))}),l++,h=s}return o.length?s?this.buildRoad(Object(r.sample)(o),n):this.buildRoad(o[0],n):[]}buildRoad(t,e){let s=t,r=[s],n=void 0;for(;e[s.x][s.y]!==a;){if(!(n=i.b.dxy.find(t=>e[s.x+t.x]&&e[s.x+t.x][s.y+t.y]===e[s.x][s.y]-1)))return[];s=s.add(n),r.unshift(s)}return r}withinView(t,e){const s=t.stageMemory();let r=Object(i.g)(s.height,s.width,()=>!1),a=[t.pos];for(;a.length;){let t=[];a.forEach(i=>{if(!s.inRange(i))return;const a=s.at(i.x,i.y);a.visible&&!r[i.x][i.y]&&(r[i.x][i.y]=!0,e(i,a),i.wrappers().forEach(e=>t.push(e)))}),a=t}}}var o=s(11);class h extends n{available(t){return this.canAttack(t)}act(t,e=!0){if(this.victimSet()&&this.victimInAccess(t))this.attack(t);else{if(!e)throw"Attacker got called twice";this.findNewVictim(t),this.act(t,!1)}}attack(t){this.victim.on(t.emit(o.b.Attack))===o.c.DIE&&(this.victim=void 0)}canAttack(t){const e=t.stageMemory();return t.pos.wrappers().some(({x:t,y:s})=>void 0!==e.at(t,s).creature())}victimInAccess(t){const e=t.stageMemory();return t.pos.wrappers().some(({x:t,y:s})=>e.at(t,s).creature()&&e.at(t,s).creature().id===this.victim.id)}victimSet(){return void 0!==this.victim}updateVictimPosition(t){this.findCreature(t,t=>t.id===this.victim.id)}findNewVictim(t){this.findCreature(t,e=>e.id!==t.id)}findCreature(t,e){return this.withinView(t,({x:t,y:s},i)=>{const r=i.creature();if(r&&e(r))return this.victim=r.real(),!0}),!1}}class l extends n{available(t){return!0}act(t){this.victimSet()?(this.updateVictimPosition(t),this.chase(t)):this.foundNewVictim(t)?this.chase(t):this.victimPos&&this.moveTo(t,this.victimPos)&&this.victimPos.eq(t.pos)&&(this.victimPos=void 0),this.victimSet()&&this.caught(t)&&this.resetVictim()}victimSet(){return void 0!==this.victimId}updateVictimPosition(t){this.findCreature(t,t=>t.id===this.victimId)}chase(t){this.followTo(t,this.victimPos)}foundNewVictim(t){return this.findCreature(t,e=>e.id!==t.id)}caught(t){return t.pos.nextTo(this.victimPos)}resetVictim(){this.victimId=void 0}findCreature(t,e){return this.withinView(t,({x:t,y:s},r)=>{const a=r.creature();if(a&&e(a))return this.victimPos=new i.b(t,s),this.victimId=a.id,!0}),!1}}class c extends n{constructor(){super(),this.events=[],this.escaper=new d(this),this.explorer=new f(this),this.chaser=new l(this),this.attacker=new h(this),this.picker=new b(this)}available(t){return!0}act(t,e=!0){if(!e)throw"Meta AI called recursively";this.feelsGood(t)?this.enemyClose(t)?this.attack(t):this.seesItems(t)?this.pickItem(t):this.explore(t):this.enemyClose(t)?this.runAway(t):this.rest(t),this.events=[]}feelsGood(t){return!0}enemyClose(t){return this.escaper.available(t)}seesItems(t){return this.picker.available(t)}attack(t){this.attacker.available(t)?this.attacker.act(t):this.chaser.act(t)}pickItem(t){this.picker.act(t)}explore(t){this.explorer.act(t)}runAway(t){this.escaper.act(t)}rest(t){}}const u=2;class d extends n{constructor(){super(...arguments),this.escapesFrom=[]}available(t){return this.foundEnemies(t)}act(t){this.foundEnemies(t)&&this.buildPath(t),this.runningTo?this.moveTo(t,this.runningTo)&&this.runningTo.eq(t.pos)&&(this.runningTo=void 0):t.ai=new m(this)}buildPath(t,e=t.radius/2){if(e<=1)return void(this.runningTo=void 0);const s=this.leePath(t,({x:t,y:s})=>{return Object(r.sumBy)(this.escapesFrom,e=>Math.max(Math.abs(t-e.pos.x),Math.abs(s-e.pos.y)))>=e},!0);s.length?this.runningTo=s.pop():this.buildPath(t,e-u)}foundEnemies(t){return this.escapesFrom=[],this.withinView(t,(e,s)=>{const i=s.creature();i&&i.id!==t.id&&this.escapesFrom.push(i)}),this.escapesFrom.length>0}}const g=10;class f extends n{constructor(){super(...arguments),this.path=[],this.step=g}available(t){return!!this.path.length||(this.buildNewPath(t),this.path.length>0)}act(t,e=!0){if(this.step>=g&&this.updatePatrol(t),this.path.length){const s=this.path.shift();t.stageMemory().at(s.x,s.y).tangible(t)?(this.path=[],e&&this.act(t,!1)):(this.step++,t.move(s),this.shouldAddNode(t)&&this.updatePatrol(t))}else this.buildNewPath(t),this.path.length?e&&this.act(t,!1):this.patrol.available(t)?(this.patrol.addNode(t.pos.x,t.pos.y),t.ai=this.patrol,t.ai.act(t,!1)):t.ai=new m(this)}buildNewPath(t){this.path=this.leePath(t,e=>!t.stageMemory().at(e.x,e.y).seen)}updatePatrol(t){void 0===this.patrol?this.patrol=new v(t.pos.x,t.pos.y):this.patrol.addNode(t.pos.x,t.pos.y),this.step=0}shouldAddNode(t){return t.stageMemory().at(t.previousPos.x,t.previousPos.y).tile.isDoor()}}class m extends n{constructor(){super(...arguments),this.turns=0}act(t,e=!0){if(this.turns>1)return t.ai=this.prevAI,void this.prevAI.act(t,!1);const s=this.leePath(t,e=>!t.pos.eq(e),!0);s.length&&(this.turns+=1,t.move(s[0]))}available(t){return!0}}var p=s(153);class v extends n{constructor(t,e){super(),this.i="a",this.step=0,this.graph=new p.Graph,this.addNode(t,e,!1),this.lastNodeVisit={},this.markNodeVisited(this.currentNodeID),this.path=[]}available(t){return this.graph.nodes().length>1}act(t,e=!0){this.path.length?this.moveToTarget(t,e):(this.targetNodeID&&(this.markNodeVisited(this.targetNodeID),this.currentNodeID=this.targetNodeID),this.pickUpNewTarget(t),this.moveToTarget(t,e)),this.step+=1}addNode(t,e,s=!0){this.graph.setNode(this.i,new i.b(t,e)),s&&this.graph.setEdge(this.currentNodeID,this.i),this.currentNodeID=this.i,this.i=Object(i.f)(this.i)}buildNewPath(t){const e=this.graph.node(this.targetNodeID);this.path=this.leePath(t,t=>e.eq(t))}pickUpNewTarget(t){let e=this.graph.nodes()[0],s=this.lastNodeVisit[e];this.graph.neighbors(this.currentNodeID).forEach(t=>{s>(this.lastNodeVisit[t]||0)&&(e=t,s=this.lastNodeVisit[e])}),this.targetNodeID=e,this.buildNewPath(t)}moveToTarget(t,e){const s=this.path.shift();if(s)if(t.stageMemory().at(s.x,s.y).tangible()){if(this.buildNewPath,this.path.length)return this.act(t,!1);let e=new m(this);e.available(t)&&(t.ai=e,e.act(t))}else t.move(s);else t.ai=new m(this)}markNodeVisited(t){this.lastNodeVisit[t]=this.step}}class b extends n{constructor(){super(...arguments),this.desiredItemId=null,this.desiredItemPos=null}available(t){return this.seesItem(t)}act(t,e=!0){if(!e)throw"Picker got called twice";if(t.pos.eq(this.desiredItemPos)){const e=t.currentLevel.at(t.pos.x,t.pos.y);return e.items.forEach(e=>{t.inventory.putToBag(e)}),e.items=[],this.desiredItemId=null,void(this.desiredItemPos=null)}this.moveTo(t,this.desiredItemPos)}canTakeMore(t){return!0}seesItem(t){return this.findItem(t,t=>t.id===this.desiredItemId),null!==this.desiredItemId||(this.desiredItemId=null,this.desiredItemPos=null,this.findItem(t,t=>!0),null!==this.desiredItemId)}findItem(t,e){return this.withinView(t,({x:t,y:s},r)=>{const a=r.items().find(e);if(a)return this.desiredItemId=a.id,this.desiredItemPos=new i.b(t,s),!0}),!1}}class _ extends n{act(t){}available(t){return!0}}s.d(e,"a",function(){return n}),s.d(e,"b",function(){return h}),s.d(e,"c",function(){return l}),s.d(e,"d",function(){return c}),s.d(e,"e",function(){return d}),s.d(e,"f",function(){return f}),s.d(e,"g",function(){return m}),s.d(e,"h",function(){return v}),s.d(e,"i",function(){return b}),s.d(e,"j",function(){return _})},6:function(t,e,s){"use strict";var i,r=s(9),a=s(1),n=s(10),o=s(3);class h{constructor(){this.step=0,this.turns={}}add(t,e){const s=this.step+e;this.turns[s]?this.turns[s].push(t):this.turns[s]=[t]}remove(t){Object(o.forEach)(this.turns,(e,s)=>{Object(o.remove)(e,e=>e==t)})}actors(){if(0===Object(o.size)(this.turns))return[];this.step=Object(o.min)(Object(o.keys)(this.turns).map(parseInt));const t=this.turns[this.step];return delete this.turns[this.step],t}}s.d(e,"b",function(){return l}),s.d(e,"a",function(){return c}),function(t){t[t.Wall=0]="Wall",t[t.Door=1]="Door",t[t.Floor=2]="Floor"}(i||(i={}));class l{constructor(t,e,s){this.key=t,this.display=e,this.kind=s,this.items=[]}static retrive(t){this.repository[t];switch(t){case"R":return new l("R"," ",i.Floor);case"C":return new l("C"," ",i.Floor);case"W":return new l("W","#",i.Wall);case"D":return new l("D","+",i.Door);default:throw`Tile '${t}' is not registered!`}}isDoor(){return this.kind===i.Door}isWall(){return this.kind===i.Wall}visibleThrough(){return this.kind===i.Floor}passibleThrough(t){return t&&this.creature?this.kind!==i.Wall&&this.creature.id===t.id:this.kind!==i.Wall&&!this.creature}clone(){let t=l.retrive(this.key);return this.creature&&(t.creature=this.creature.clone()),this.items.forEach(e=>t.items.push(e.clone())),t}uniq(){return void 0!==this.creature}}l.repository={};class c extends a.a{constructor(t){super(t),this.creatures=[],this.id=c.getId(),this.logger=new n.b,this.timeline=new h}static getId(){return this.lastId++}addCreature(t){this.creatures.push(t),this.at(t.pos.x,t.pos.y).creature=t,this.timeline.add(t.id,t.initiativity())}removeCreature(t){let e=this.at(t.pos.x,t.pos.y);e.creature=void 0,e.items.push(new r.a(t)),t.inventory.wears().forEach(({bodyPart:t,equipment:s})=>{s&&e.items.push(s)}),t.inventory.cares().forEach(t=>{e.items.push(t)}),Object(o.remove)(this.creatures,e=>e.id===t.id),this.timeline.remove(t.id)}visibleThrough(t,e){return this.map[e][t].visibleThrough()}passibleThrough(t,e){return this.map[e][t].passibleThrough()}at(t,e){return this.map[e][t]}setTile(t,e,s){this.map[e][t]=s}inRange(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height}turn(){const t=this.timeline.actors();this.creatures.forEach(e=>{Object(o.includes)(t,e.id)&&e.act(this)}),this.creatures.forEach(e=>{Object(o.includes)(t,e.id)&&this.timeline.add(e.id,e.initiativity()),e.visionMask(this)})}}c.lastId=0},9:function(t,e,s){"use strict";var i,r;!function(t){t[t.Armor=0]="Armor",t[t.Weapon=1]="Weapon",t[t.Corpse=2]="Corpse"}(i||(i={})),function(t){t[t.Katana=0]="Katana",t[t.Corpse=1]="Corpse"}(r||(r={}));class a{constructor(t,e,s,i=a.getId()){this.group=t,this.kind=e,this.name=s,this.id=i}static getId(){return this.lastId++}clone(){return new a(this.group,this.kind,this.name)}}a.lastId=0;class n extends a{}class o extends a{constructor(t){super(i.Corpse,r.Corpse,"corpse")}}var h=s(2);class l extends n{constructor(t,e){super(i.Weapon,t,e)}bodyPart(){return h.a.RightHand}}class c extends l{constructor(){super(r.Katana,"Katana")}}s.d(e,!1,function(){return a}),s.d(e,!1,function(){}),s.d(e,!1,function(){return i}),s.d(e,"b",function(){return r}),s.d(e,!1,function(){return n}),s.d(e,"a",function(){return o}),s.d(e,"c",function(){return c}),s.d(e,!1,function(){return l})}});
//# sourceMappingURL=main.fd9f41b6.js.map