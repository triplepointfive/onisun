!function(t){function e(e){for(var i,n,h=e[0],o=e[1],c=e[2],u=0,d=[];u<h.length;u++)n=h[u],r[n]&&d.push(r[n][0]),r[n]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i]);for(l&&l(e);d.length;)d.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],i=!0,h=1;h<s.length;h++){var o=s[h];0!==r[o]&&(i=!1)}i&&(a.splice(e--,1),t=n(n.s=s[0]))}return t}var i={},r={1:0},a=[];function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=i,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/onisun/";var h=window.webpackJsonp=window.webpackJsonp||[],o=h.push.bind(h);h.push=e,h=h.slice();for(var c=0;c<h.length;c++)e(h[c]);var l=o;a.push([173,0]),s()}({10:function(t,e,s){},142:function(t,e,s){"use strict";s.r(e);var i=s(2),r=i.a.extend({props:["cell","player"],computed:{style(){return this.player?"player":this.cell.isWall()?"wall":this.cell.isDoor()?"door":"floor"},symbol(){return this.player?"俺":" "==this.cell.display?"・":"+"==this.cell.display?"戸":"#"==this.cell.display?"＃":"E"}}}),a=(s(169),s(4)),n=Object(a.a)(r,function(){var t=this.$createElement;return(this._self._c||t)("td",[this._v('\n  :class="style"\n  v-text="symbol"\n  @click="$emit(\'setPosition\')"\n')])},[],!1,null,null,null).exports,h=s(1);class o{constructor(t,e,s,i){this.x=t,this.y=e,this.w=s,this.h=i}move(t,e){this.x+=t,this.y+=e}}const c=function(t){return String.fromCharCode(t.charCodeAt(0)+1)},l=function(t){return Math.floor(Math.random()*t)},u=function(t,e,s){let i=Array(t);for(let r=0;r<t;r++){i[r]=new Array(e);for(let t=0;t<e;t++)i[r][t]=s(r,t)}return i},d=function(t){return Math.min.apply(Math,t)};class p{constructor(t,e){this.x=t,this.y=e}eq(t){return this.x===t.x&&this.y===t.y}nextTo(t){return Math.abs(this.x-t.x)<=1&&Math.abs(this.y-t.y)<=1}copy(){return new p(this.x,this.y)}add(t){return new p(this.x+t.x,this.y+t.y)}wrappers(){return p.dxy.map(t=>this.add(t))}}p.dxy=[new p(-1,-1),new p(0,-1),new p(1,-1),new p(-1,0),new p(1,0),new p(-1,1),new p(0,1),new p(1,1)];class m{constructor(t){this.map=t,this.width=t.length,this.height=t[0].length}at(t,e){return this.map[t][e]}inRange(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height}each(t){this.map.forEach(e=>{e.forEach(e=>{t(e)})})}}const g=function(t,e){let s;if(e>0)for(let i=0;i<e;i++)s=t.pop(),t.unshift(s);else if(e<0)for(let i=e;i<0;i++)s=t.shift(),t.push(s);return t},f=function(t,e,s){let[i,r,a,n]=[t.x,e.x,t.y,e.y],h=Math.max(Math.abs(i-r),Math.abs(a-n));const o=new p((r-i)/h,(n-a)/h);for(;h>1;)i+=o.x,a+=o.y,s(Math.round(i),Math.round(a)),h-=1};class v{constructor(t,e,s,i,r,a,n){this.startx=t,this.starty=e,this.radius=s,this.width=i,this.height=r,this.checkSolid=a,this.markVisible=n,this.doubleRadius=this.radius*this.radius}calc(){this.markVisible(this.startx,this.starty,1),this.checkSolid(this.startx,this.starty)||[[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([t,e])=>{this.castLight(1,1,0,0,t,e,0),this.castLight(1,1,0,t,0,0,e)})}castLight(t,e,s,i,r,a,n){if(e<s)return;let h=0,o=!1;for(let c=t;c<=this.radius&&!o;c++){let t=-c;for(let l=-c;l<=0;l++){let u=Math.round(this.startx+l*i+t*r),d=Math.round(this.starty+l*a+t*n),p=(l-.5)/(t+.5),m=(l+.5)/(t-.5);if(u>=0&&d>=0&&u<this.width&&d<this.height&&!(e<m)){if(s>p)break;this.doubleDistance(l,t)<=this.doubleRadius&&this.markVisible(u,d,1-this.doubleDistance(l,t)/this.doubleRadius),o?this.checkSolid(u,d)?h=m:(o=!1,e=h):this.checkSolid(u,d)&&c<this.radius&&(o=!0,this.castLight(c+1,e,p,i,r,a,n),h=m)}}}}doubleDistance(t,e){return t*t+e*e}}var w,b,y;!function(t){t[t.WeaponOneHand=0]="WeaponOneHand",t[t.WearsOnBody=1]="WearsOnBody",t[t.Throw=2]="Throw"}(w||(w={})),function(t){t[t.BodyArmor=0]="BodyArmor",t[t.OneHandWeapon=1]="OneHandWeapon",t[t.Consumable=2]="Consumable",t[t.Missile=3]="Missile"}(b||(b={}));class x{constructor(t,e,s=[],i=x.getId()){this.group=t,this.name=e,this.usages=s,this.id=i}static getId(){return this.lastId++}clone(){return new x(this.group,this.name)}}x.lastId=0;class C extends x{constructor(t){super(b.Consumable,`${t.name}'s corpse`),this.specie=t}}class M extends x{constructor(t,e,s,i){super(t,e,i),this.modifier=s}onPutOn(t){t.characteristics.addModifier(this.modifier)}onTakeOff(t){t.characteristics.removeModifier(this.modifier)}}class k extends M{constructor(t,e){super(b.Missile,t,e,[w.Throw])}}class _ extends M{constructor(t,e){super(b.BodyArmor,t,e,[w.WearsOnBody])}}class T extends M{constructor(t,e){super(b.OneHandWeapon,t,e,[w.WeaponOneHand])}}!function(t){t[t.LeftHand=0]="LeftHand",t[t.RightHand=1]="RightHand",t[t.Legs=2]="Legs",t[t.Finger=3]="Finger",t[t.Head=4]="Head",t[t.Eye=5]="Eye",t[t.Neck=6]="Neck",t[t.Back=7]="Back",t[t.Body=8]="Body",t[t.MissileWeapon=9]="MissileWeapon",t[t.Missile=10]="Missile"}(y||(y={}));const j={[y.RightHand]:w.WeaponOneHand,[y.Body]:w.WearsOnBody,[y.Missile]:w.Throw};class R{constructor(t){this.wearings=[],this.bag=[],this.wearings=t.map(t=>({bodyPart:t}))}inSlot(t){const e=this.wears().find(({bodyPart:e})=>t===j[e]);return e&&e.equipment?[e.equipment]:[]}wears(){return this.wearings}cares(){return this.bag}canWear(t){return this.wearings.some(e=>Object(h.includes)(t.usages,j[e.bodyPart]))}matchingEquip(t){return this.wearings.filter(e=>Object(h.includes)(t.usages,j[e.bodyPart]))}equip(t,e){this.matchingEquip(e).forEach(s=>{s.equipment&&(this.putToBag(s.equipment),s.equipment.onTakeOff(t)),s.equipment=e,e.onPutOn(t)})}takeOff(t,e){this.wearings.forEach(s=>{s.equipment&&s.equipment.id===e.id&&(this.putToBag(s.equipment),e.onTakeOff(t),s.equipment=null)})}putToBag(t){this.bag.push(t)}removeFromBag(t){Object(h.remove)(this.bag,e=>e.id===t.id)}}class E{constructor(t){this.game=t}build(){}onInput(t){this.game.screen=void 0}}class I extends E{constructor(t,e){super(t),this.player=e,this.options=this.game.professionPicker.available(this.player)}onInput(t){for(;this.player.levelUps>0;)this.player.characteristics.levelUp(this.player.specie),this.player.levelUps-=1;let e=this.player.professions.find(e=>e.id===t.id);e?e.level+=1:this.player.professions.push(t),this.game.screen=void 0}}var S,A;!function(t){t[t.Player=0]="Player",t[t.PlayerOnlyEnemy=1]="PlayerOnlyEnemy",t[t.FreeForAll=2]="FreeForAll"}(S||(S={})),function(t){t[t.GoStairwayDown=0]="GoStairwayDown",t[t.Inventory=1]="Inventory",t[t.PutOn=2]="PutOn",t[t.Throwing=3]="Throwing"}(A||(A={}));const D=Object.keys(A).map(t=>A[t]);class O{constructor(t,e,s){this.name=t,this.clan=e,this.abilities=s}}class P{constructor(t,e=P.getId()){this.specie=t,this.id=e}static getId(){return this.lastId++}name(){return this.specie.name}clan(){return this.specie.clan}clone(){return new P(this.specie,this.id)}real(){return this.refToReal}can(t){return Object(h.includes)(this.specie.abilities,t)}}P.lastId=0;class N{}class W extends N{constructor(t){super(),this.actor=t}affect(t){if(this.actor.characteristics.misses(t.characteristics))return t.currentLevel.game.logger.missMessage(this.actor,t),z.DODGE;const e=this.actor.characteristics.damageTo(t.characteristics);return e>=t.characteristics.health.currentValue()?(this.actor.on(new L(t)),t.currentLevel.game.logger.killMessage(e,this.actor,t),t.die(),z.DIE):(t.characteristics.health.decrease(e),t.currentLevel.game.logger.hurtMessage(e,this.actor,t),z.HURT)}}class F extends N{constructor(t,e){super(),this.actor=t,this.missile=e}affect(t){if(this.actor.characteristics.throwMisses(t.characteristics))return t.currentLevel.game.logger.throwMissMessage(this.actor,t,this.missile),z.THROW_DODGE;const e=this.actor.characteristics.throwDamageTo(t.characteristics,this.missile);return e>=t.characteristics.health.currentValue()?(this.actor.on(new L(t)),t.currentLevel.game.logger.throwKillMessage(e,this.actor,t,this.missile),t.die(),z.DIE):(t.characteristics.health.decrease(e),t.currentLevel.game.logger.throwHurtMessage(e,this.actor,t,this.missile),z.HURT)}}class L extends N{constructor(t){super(),this.actor=t}affect(t){return t instanceof U&&(t.levelUps+=t.level.add(1)),z.NOTHING}}var z;!function(t){t[t.DIE=0]="DIE",t[t.HURT=1]="HURT",t[t.DODGE=2]="DODGE",t[t.THROW_DODGE=3]="THROW_DODGE",t[t.NOTHING=4]="NOTHING"}(z||(z={}));class B extends P{constructor(t,e,s){super(s),this.characteristics=t,this.stageMemories={},this.ai=e,this.inventory=new R([y.LeftHand,y.RightHand,y.Legs,y.Finger,y.Head,y.Eye,y.Neck,y.Back,y.Body,y.MissileWeapon,y.Missile])}putOn(t){this.inventory.equip(this,t),this.inventory.removeFromBag(t)}takeOff(t){this.inventory.takeOff(this,t)}addToMap(t,e){this.pos=t,this.previousLevel=this.currentLevel,this.currentLevel=e,e.addCreature(this),this.visionMask(e)}die(){this.currentLevel.removeCreature(this);let t=this.currentLevel.at(this.pos.x,this.pos.y);t.items.push(new C(this.specie)),this.inventory.wears().forEach(({equipment:e})=>{e&&t.items.push(e)}),this.inventory.cares().forEach(e=>{t.items.push(e)})}on(t){return t.affect(this)}real(){return this}speed(){return this.characteristics.speed.currentValue()}radius(){return this.characteristics.radius.currentValue()}stageMemory(t=this.currentLevel.id){return this.stageMemories[t]}act(t){this.visionMask(t),this.previousPos=this.pos.copy(),this.ai.act(this,!0),(this.previousLevel||this.currentLevel).at(this.previousPos.x,this.previousPos.y).creature=void 0,this.currentLevel.at(this.pos.x,this.pos.y).creature=this,this.previousLevel=void 0}move(t){this.pos=t.copy()}clone(){let t=new P(this.specie,this.id);return t.refToReal=this,t}visionMask(t){this.stageMemories[t.id]?this.stageMemory().resetVisible():this.stageMemories[t.id]=new St(t.width,t.height);new v(this.pos.x,this.pos.y,this.radius(),t.width,t.height,this.isSolid(t),(e,s,i)=>{this.stageMemory().at(e,s).see(t.at(e,s),i)}).calc()}isSolid(t){return(e,s)=>!t.visibleThrough(e,s)&&!(t.at(e,s).isDoor()&&this.pos.x===e&&this.pos.y===s)}}class U extends B{constructor(t,e,s,i){super(e,s,i),this.level=t,this.dead=!1,this.levelUps=0,this.professions=[]}act(t){super.act(t),this.levelUps>0&&(t.game.screen=new I(t.game,this))}die(){super.die(),this.dead=!0}rebuildVision(){this.visionMask(this.currentLevel)}}const V=1;class ${constructor(t,e=$.getId()){this.prevAI=t,this.id=e}static getId(){return this.lastId++}reset(){}moveTo(t,e){if(t.pos.eq(e))return!0;const s=this.leePath(t,t=>e.eq(t));return s.length&&t.move(s[0]),!!s.length}followTo(t,e){const s=this.leePath(t,t=>e.nextTo(t));return s.length&&t.move(s[0]),!!s.length}leePath(t,e,s=!1){const i=t.stageMemory();let r=u(i.width,i.height,()=>void 0),a=[],n=[t.pos],o=0;for(;n.length&&!a.length;){let s=[];n.forEach(n=>{if(!i.inRange(n))return;const h=i.at(n.x,n.y);h.tangible(t)||void 0!==r[n.x][n.y]||(r[n.x][n.y]=o,e(n,h)?a.push(n):n.wrappers().forEach(t=>s.push(t)))}),o++,n=s}return a.length?s?this.buildRoad(Object(h.sample)(a),r):this.buildRoad(a[0],r):[]}buildRoad(t,e){let s=t,i=[s],r=void 0;for(;e[s.x][s.y]!==V;){if(!(r=p.dxy.find(t=>e[s.x+t.x]&&e[s.x+t.x][s.y+t.y]===e[s.x][s.y]-1)))return[];s=s.add(r),i.unshift(s)}return i}withinView(t,e){const s=t.stageMemory();let i=u(s.width,s.height,()=>!1),r=[t.pos];for(;r.length;){let t=[];r.forEach(r=>{if(!s.inRange(r))return;const a=s.at(r.x,r.y);a.visible&&!i[r.x][r.y]&&(i[r.x][r.y]=!0,e(r,a),r.wrappers().forEach(e=>t.push(e)))}),r=t}}enemies(t,e){return t.id!==e.id&&(t.clan()===S.FreeForAll||e.clan()===S.FreeForAll||(t.clan()===S.Player&&e.clan()===S.PlayerOnlyEnemy||e.clan()===S.Player&&t.clan()===S.PlayerOnlyEnemy))}}$.lastId=0;class q extends ${constructor(){super(...arguments),this.destination=void 0}available(t){return this.foundNewTarget(t)||!!this.destination}act(t){if(!this.destination)throw"FollowTargetAI's act got called when there is no destination!";this.goTo(t)?(this.onMove(t),this.destination.eq(t.pos)&&(this.destination=void 0,this.onReach(t))):(this.destination=void 0,this.onCantMove(t))}reset(){this.destination=void 0}goTo(t){return this.moveTo(t,this.destination)}onMove(t){}onReach(t){}onCantMove(t){}}class H extends q{constructor(t,e){super(t),this.matcher=e}foundNewTarget(t){const e=this.leePath(t,(t,e)=>this.matcher(e),!0);return!!e.length&&(this.destination=e.pop(),!0)}}class G extends ${available(t){return this.canAttack(t)}act(t,e=!0){if(this.victimInAccess(t))this.attack(t);else{if(!e)throw"Attacker got called twice";this.pickNewVictim(t),this.act(t,!1)}}attack(t){this.victim.on(new W(t))===z.DIE&&(this.victim=void 0)}canAttack(t){return!!this.findCreature(t,e=>this.enemies(t,e))}victimInAccess(t){if(void 0===this.victim)return!1;return!!this.findCreature(t,t=>t.id===this.victim.id)}pickNewVictim(t){this.victim=this.findCreature(t,e=>this.enemies(t,e)).real()}findCreature(t,e){const s=t.stageMemory();return t.pos.wrappers().map(({x:t,y:e})=>s.at(t,e).creature()).find(t=>t&&e(t))}}class Y extends q{reset(){super.reset(),this.victimId=void 0}foundNewTarget(t){return this.victimSet()&&this.buildVictimPath(t)||this.foundNewVictim(t)}onCantMove(){this.victimId=void 0}onReach(){this.victimId=void 0}victimSet(){return!!this.victimId}goTo(t){return this.followTo(t,this.destination)}buildVictimPath(t){return this.findCreature(t,t=>t.id===this.victimId)}foundNewVictim(t){return this.findCreature(t,e=>this.enemies(t,e))&&this.buildVictimPath(t)}findCreature(t,e){let s=!1;return this.withinView(t,({x:t,y:i},r)=>{const a=r.creature();!s&&a&&e(a)&&(this.destination=new p(t,i),this.victimId=a.id,s=!0)}),s}}var X;!function(t){t[t.ItemPickedUp=0]="ItemPickedUp"}(X||(X={}));class J{constructor(t){this.type=t}}class K extends J{constructor(t){super(X.ItemPickedUp),this.items=t}}class Q extends ${constructor(t=null){super(),this.aiToRun=t,this.events=[]}available(t){return!0}pushEvent(t){this.events.push(t)}resetEvents(){this.events=[]}}class Z{constructor(t,e=t){this.max=t,this.current=e,this.modifiers=[]}maximum(){return this.max}atMax(){return this.max===this.current}decrease(t){this.current-=t}increase(t){this.current=Math.min(this.current+t,this.max)}constantIncrease(t){this.max+=t,this.increase(t)}constantDecrease(t){this.max-=t,this.decrease(t)}addModifier(t){this.modifiers.push(t)}removeModifier(t){Object(h.remove)(this.modifiers,e=>e===t)}currentValue(){return this.current+Object(h.sum)(this.modifiers)}}class tt extends Z{currentValue(){const t=super.currentValue();return t>=1?t:1}constantDecrease(t){this.max=Math.max(1,this.max-t),this.decrease(t)}decrease(t){this.current=Math.max(1,this.current-t)}}class et{constructor(t,e,s,i,r,a){this.attack=t,this.defense=e,this.dexterity=s,this.health=i,this.radius=r,this.speed=a}with(t,e){e(this.attack,t.attack),e(this.defense,t.defense),e(this.health,t.health),e(this.radius,t.radius),e(this.speed,t.speed)}}class st extends et{constructor({attack:t=0,defense:e=0,dexterity:s=0,health:i=0,radius:r=0,speed:a=0}){super(t,e,s,i,r,a)}withWeight(t,e,s){s(this.attack,t.attack,e.attack),s(this.defense,t.defense,e.defense),s(this.health,t.health,e.health),s(this.radius,t.radius,e.radius),s(this.speed,t.speed,e.speed)}}class it extends et{constructor({attack:t,defense:e,dexterity:s,health:i,radius:r,speed:a}){super(new tt(t),new tt(e),new tt(s),new Z(i),new tt(r),new tt(a))}addModifier(t){this.with(t,(t,e)=>{0!==e&&t.addModifier(e)})}removeModifier(t){this.with(t,(t,e)=>{0!==e&&t.removeModifier(e)})}damageTo(t){return Math.round(10*this.attack.currentValue()/t.defense.currentValue())}misses(t){let e=this.dexterity.currentValue();return Math.random()>e/(e+Math.pow(.25*t.dexterity.currentValue(),.8))}throwMisses(t){return this.misses(t)}throwDamageTo(t,e){return 10}regenerate(){this.health.increase(this.regenerationValue())}regenerationValue(){return 1}regenerateEvery(){return 8}levelUp(t){this.health.constantIncrease(3),Math.random()>.5?this.attack.constantIncrease(1):this.defense.constantIncrease(1)}}class rt extends ${available(t){return t.can(A.PutOn)}act(t,e=!0){t.inventory.cares().forEach(e=>{if(e instanceof M&&t.inventory.canWear(e)){this.whereToWear(t,e)&&t.putOn(e)}})}whereToWear(t,e){const s=t.inventory.matchingEquip(e);if(0===s.length)return null;const i=new st({attack:1,defense:1,health:1,radius:.5,speed:1}),{wearing:r}=s.reduce((t,s)=>{let r=0;return s.equipment?e.modifier.withWeight(s.equipment.modifier,i,(t,e,s)=>r+=s*(t-e)):e.modifier.with(i,(t,e)=>r+=t*e),t.weight>r?t:{weight:r,wearing:s}},{weight:0,wearing:null});return r}}class at extends Q{constructor(){super(),this.firstCallPatrol=!0,this.step=0,this.escaper=new ht(this),this.explorer=new ot(this),this.chaser=new Y(this),this.attacker=new G(this),this.picker=new pt(this),this.patrol=new dt(this),this.loiter=new ct(this),this.thrower=new wt(this),this.descender=new gt(this)}act(t,e=!0){if(!e)throw"Meta AI called recursively";this.step+=1,this.step%t.characteristics.regenerateEvery()==0&&t.characteristics.regenerate(),this.events.forEach(e=>{switch(e.type){case X.ItemPickedUp:new rt(this).act(t)}}),this.feelsGood(t)?this.attacker.available(t)?this.setAi(this.attacker):this.thrower.available(t)?this.setAi(this.thrower):this.chaser.available(t)?this.setAi(this.chaser):this.seesItems(t)?this.pickItem(t):this.explore(t):this.healthCritical(t)&&this.escaper.available(t)?this.setAi(this.escaper):this.attacker.available(t)?this.setAi(this.attacker):this.thrower.available(t)?this.setAi(this.thrower):this.chaser.available(t)?this.setAi(this.chaser):this.rest(t),this.resetEvents(),this.aiToRun.act(t,e)}feelsGood(t){return t.characteristics.health.currentValue()>.9*t.characteristics.health.maximum()}healthCritical(t){return t.characteristics.health.currentValue()<t.characteristics.health.maximum()/4}seesItems(t){return this.picker.available(t)}pickItem(t){this.setAi(this.picker)}explore(t){this.explorer.available(t)?(this.patrol.trackMovement(t),this.setAi(this.explorer)):this.descender.available(t)?this.setAi(this.descender):this.patrol.available(t)?(this.firstCallPatrol&&(this.firstCallPatrol=!1,this.patrol.addNode(t.pos.x,t.pos.y)),this.setAi(this.patrol)):this.setAi(this.loiter)}rest(t){this.setAi(new mt(this))}setAi(t){this.aiToRun&&this.aiToRun.id!==t.id&&this.aiToRun.reset(),this.aiToRun=t}}const nt=2;class ht extends q{constructor(){super(...arguments),this.escapesFrom=[]}foundNewTarget(t){return this.foundEnemies(t)&&this.buildPath(t)}buildPath(t,e=t.radius()/2){if(e<=1)return this.destination=void 0,!1;const s=this.leePath(t,({x:t,y:s})=>{return Object(h.sumBy)(this.escapesFrom,([e,i])=>Math.max(Math.abs(t-e.x),Math.abs(s-e.y)))>=e},!0);return s.length?(this.destination=s.pop(),!0):this.buildPath(t,e-nt)}foundEnemies(t){return this.escapesFrom=[],this.withinView(t,(e,s)=>{const i=s.creature();i&&this.enemies(t,i)&&this.escapesFrom.push([e,i])}),this.escapesFrom.length>0}}class ot extends H{constructor(t){super(t,t=>!t.seen)}}class ct extends ${act(t,e=!0){const s=this.leePath(t,e=>!t.pos.eq(e),!0);s.length&&t.move(s[0])}available(t){return!0}}var lt=s(141);const ut=10;class dt extends ${constructor(t){super(t),this.step=ut,this.i="a",this.graph=new lt.Graph,this.lastNodeVisit={},this.markNodeVisited(this.currentNodeID),this.path=[]}available(t){return this.graph.nodes().length>1}act(t,e=!0){this.path.length?this.moveToTarget(t,e):(this.targetNodeID&&(this.markNodeVisited(this.targetNodeID),this.currentNodeID=this.targetNodeID),this.pickUpNewTarget(t),this.moveToTarget(t,e)),this.step+=1}reset(){this.path=[]}trackMovement(t){(this.step>=ut||this.shouldAddNode(t))&&this.addNode(t.pos.x,t.pos.y),this.step+=1}addNode(t,e){this.graph.setNode(this.i,new p(t,e)),this.currentNodeID&&this.currentNodeID!==this.i&&this.graph.setEdge(this.currentNodeID,this.i),this.currentNodeID=this.i,this.i=c(this.i),this.step=0}buildNewPath(t){const e=this.graph.node(this.targetNodeID);this.path=this.leePath(t,t=>e.eq(t))}pickUpNewTarget(t){let e=this.graph.nodes()[0],s=this.lastNodeVisit[e];this.graph.neighbors(this.currentNodeID).forEach(t=>{s>(this.lastNodeVisit[t]||0)&&(e=t,s=this.lastNodeVisit[e])}),this.targetNodeID=e,this.buildNewPath(t)}moveToTarget(t,e){const s=this.path.shift();if(s)if(t.stageMemory().at(s.x,s.y).tangible()){if(this.buildNewPath,this.path.length)return this.act(t,!1)}else t.move(s);else e?(this.path=[],this.act(t,!1)):new ct(this.prevAI).act(t,e)}markNodeVisited(t){this.lastNodeVisit[t]=this.step}shouldAddNode(t){return t.stageMemory().at(t.previousPos.x,t.previousPos.y).tile.isDoor()}}class pt extends q{constructor(){super(...arguments),this.desiredItemId=null}available(t){return t.can(A.Inventory)&&super.available(t)}foundNewTarget(t){return this.findItem(t,t=>t.id===this.desiredItemId)||this.findItem(t,t=>!0)}onReach(t){const e=t.currentLevel.at(t.pos.x,t.pos.y);this.prevAI.pushEvent(new K(e.items)),e.items.forEach(e=>{t.inventory.putToBag(e)}),e.items=[],this.desiredItemId=null}findItem(t,e){let s=!1;return this.withinView(t,({x:t,y:i},r)=>{const a=r.items().find(e);a&&!s&&(this.desiredItemId=a.id,this.destination=new p(t,i),s=!0)}),s}}class mt extends ${available(t){return!t.characteristics.health.atMax()}act(t){}}class gt extends H{constructor(t){super(t,t=>t.tile.kind===bt.StairwayDown),this.canDescend=!1}available(t){return t.can(A.GoStairwayDown)&&super.available(t)}reset(){super.reset(),this.canDescend=!1}foundNewTarget(t){return this.canDescend=this.matcher(t.stageMemory().at(t.pos.x,t.pos.y)),this.canDescend?(this.destination=t.pos,!0):super.foundNewTarget(t)}onReach(t){const e=t.currentLevel.at(t.pos.x,t.pos.y);this.canDescend&&e instanceof Ct&&e.go(t)}}class ft{constructor(t){this.onDone=t}speed(){return-1}}class vt extends ft{constructor(t,e,s){super(s),this.item=t,this.frames=e}patchMemory(t){if(this.done())return;const[e]=this.frames.splice(0,1),s=t.at(e.x,e.y);s.visible?s.effect="-":this.patchMemory(t)}done(){return 0===this.frames.length}}class wt extends ${available(t){return t.can(A.Throwing)&&this.hasMissile(t)&&this.canAttack(t)}act(t){const e=this.missiles.pop();let s=[];f(t.pos,this.victim.pos,(t,e)=>s.push(new p(t,e)));const i=new vt(e,s,()=>{this.victim.on(new F(t,e))===z.DIE&&(this.victim=void 0,this.previousVictim=void 0)});t.currentLevel.addEffect(i)}hasMissile(t){return this.missiles=t.inventory.inSlot(w.Throw),this.missiles.length>0}canAttack(t){return this.previousVictim=this.victim,this.victim=void 0,!(!this.previousVictim||!this.findCreature(t,t=>this.previousVictim.id===t.id))||this.findCreature(t,e=>this.enemies(t,e))}findCreature(t,e){return this.withinView(t,(s,i)=>{const r=i.creature();!this.victim&&r&&e(r)&&!this.obstacles(t,s)&&(this.victim=t.currentLevel.at(s.x,s.y).creature.real())}),!!this.victim}obstacles(t,e){let s=!1;return f(t.pos,e,(e,i)=>{s=s||t.stageMemory().at(e,i).tangible(t)}),s}}var bt;!function(t){t[t.Wall=0]="Wall",t[t.Door=1]="Door",t[t.Floor=2]="Floor",t[t.StairwayDown=3]="StairwayDown",t[t.StairwayUp=4]="StairwayUp"}(bt||(bt={}));class yt{constructor(t,e,s){this.key=t,this.display=e,this.kind=s,this.items=[]}static retrieve(t){switch(t){case"R":return new yt("R"," ",bt.Floor);case"C":return new yt("C"," ",bt.Floor);case"W":return new yt("W","#",bt.Wall);case"D":return new yt("D","+",bt.Door);case">":return new yt(">",">",bt.StairwayDown);case"<":return new yt("<","<",bt.StairwayUp);default:throw`Tile '${t}' is not registered!`}}addItem(t){this.items.push(t)}isDoor(){return this.kind===bt.Door}isWall(){return this.kind===bt.Wall}isFloor(){return this.kind===bt.Floor}visibleThrough(){return this.isFloor()||this.kind===bt.StairwayDown||this.kind===bt.StairwayUp}passibleThrough(t){return t&&this.creature?this.kind!==bt.Wall&&this.creature.id===t.id:this.kind!==bt.Wall&&!this.creature}clone(){let t=yt.retrieve(this.key);return this.creature&&(t.creature=this.creature.clone()),this.items.forEach(e=>t.items.push(e.clone())),t}uniq(){return void 0!==this.creature}}yt.repository={};class xt extends yt{go(t){this.currentMap.leave(t),this.adjacentMap.enter(t,this.enterPos),this.adjacentMap.game.currentMap=this.adjacentMap}}class Ct extends xt{constructor(t,e,s){super(">",">",bt.StairwayDown),this.currentMap=t,this.adjacentMap=e,this.enterPos=s}}var Mt,kt=s(0);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.DANGER=3]="DANGER"}(Mt||(Mt={}));class _t{constructor(t,e,s){this.level=t,this.ts=e,this.message=s}}class Tt{constructor(){this.messages=[]}hurtMessage(t,e,s){this.debug(`${s.name()} got ${t} damage from ${e.name()}`)}killMessage(t,e,s){this.warning(`${s.name()} got ${t} damage from ${e.name()} causes them to die`)}missMessage(t,e){this.debug(`${t.name()} misses ${e.name()}!`)}throwMissMessage(t,e,s){this.debug(`${t.name()} throws ${s.name} in ${e.name()}, but misses!`)}throwKillMessage(t,e,s,i){this.warning(`${s.name()} got ${t} damage from ${e.name()} by ${i.name} causes them to die`)}throwHurtMessage(t,e,s,i){this.debug(`${s.name()} got ${t} damage from ${e.name()} by ${i.name}`)}debug(t){this.addMessage(Mt.DEBUG,t)}info(t){this.addMessage(Mt.INFO,t)}warning(t){this.addMessage(Mt.WARNING,t)}danger(t){this.addMessage(Mt.DANGER,t)}addMessage(t,e){this.messages.push(new _t(t,kt(),e))}}class jt{constructor(){this.step=0,this.turns={}}add(t,e){const s=this.step+e;this.turns[s]?this.turns[s].push(t):this.turns[s]=[t]}remove(t){Object(h.forEach)(this.turns,(e,s)=>{Object(h.remove)(e,e=>e===t)})}next(){this.step=Object(h.min)(Object(h.keys)(this.turns).map(t=>parseInt(t)));const[t]=Object(h.pullAt)(this.turns[this.step],0);return 0===this.turns[this.step].length&&delete this.turns[this.step],t}actors(){if(0===Object(h.size)(this.turns))return[];this.step=Object(h.min)(Object(h.keys)(this.turns).map(t=>parseInt(t)));const t=this.turns[this.step];return delete this.turns[this.step],t}}class Rt extends m{constructor(t){super(t),this.creatures=[],this.id=Rt.getId(),this.timeline=new jt}static getId(){return this.lastId++}reset(){this.timeline=new jt}leave(t){this.reset(),this.removeCreature(t)}enter(t,e){this.reset(),this.creatures.forEach(t=>this.timeline.add([t.id,void 0],t.speed())),t.addToMap(e,this)}addCreature(t){this.creatures.push(t),this.at(t.pos.x,t.pos.y).creature=t,this.timeline.add([t.id,void 0],t.speed())}removeCreature(t){this.at(t.pos.x,t.pos.y).creature=void 0,Object(h.remove)(this.creatures,e=>e.id===t.id),this.timeline.remove([t.id,void 0])}visibleThrough(t,e){return this.map[t][e].visibleThrough()}passibleThrough(t,e){return this.map[t][e].passibleThrough()}setTile(t,e,s){this.map[t][e]=s}addEffect(t){this.timeline.add([void 0,t],t.speed())}turn(){if(this.game.screen)return;const[t,e]=this.timeline.next();if(void 0!==t){const e=this.creatures.find(e=>t===e.id);e&&(e.act(this),this.creatures.find(e=>t===e.id)&&this.timeline.add([t,void 0],e.speed())),this.game.player.rebuildVision()}else{if(!e)throw"Timeline event is empty!";e.done()?e.onDone():this.timeline.add([void 0,e],e.speed()),this.game.player.rebuildVision(),e.patchMemory(this.game.player.stageMemory())}}}Rt.lastId=0;class Et{constructor(t){this.requires=t,this.current=1,this.currentExperience=0,this.doneLeveling=!1,this.requiredExperience=this.requires[0]}add(t){if(this.doneLeveling)return;this.currentExperience+=t;let e=0;for(;!this.doneLeveling&&this.currentExperience>=this.requiredExperience;)e+=1,this.levelUp();return e}levelUp(){this.current+=1;let t=this.requires[this.current-1];t?(this.currentExperience-=this.requiredExperience,this.requiredExperience=t):(this.currentExperience=this.requiredExperience,this.doneLeveling=!0)}}class It{constructor(t){this.tile=t,this.visible=!1,this.degree=0,this.seen=!1}see(t,e){this.visible=!0,this.degree=e,this.seen=!0,this.tile=t.clone()}items(){return this.tile.items}tangible(t){return this.seen&&!this.tile.passibleThrough(t)}creature(){return this.tile&&this.tile.creature}reset(){this.visible=!1,this.effect=void 0,this.tile.creature=void 0}}class St extends m{constructor(t,e){const s=yt.retrieve("W");super(u(t,e,()=>new It(s)))}resetVisible(){this.each(t=>t.reset())}}class At{constructor(t){this.professionPicker=t,this.logger=new Tt,this.screen=null}}class Dt{constructor(t){this.totalWeight=0,this.items=[],t.forEach(([t,e])=>this.add(t,e))}add(t,e){if(t<1)throw"Item's weight is lower than 1";this.items.push([t,e]),this.totalWeight+=Math.ceil(t)}pick(t){if(0===this.items.length)throw"Tried to use empty pool";let e=Object(h.random)(this.totalWeight);return this.items.find(([t,s])=>(e-=t)<=0)[1](t)}merge(t){let e=new Dt([]);return this.items.forEach(([t,s])=>e.add(t,s)),t.items.forEach(([t,s])=>e.add(t,s)),e}}class Ot{constructor(t,e,s=1){this.id=t,this.name=e,this.level=s}}class Pt{}const Nt=function(t,e=(()=>!0)){for(let s=1;s<t.height-1;s++)for(let i=1;i<t.width;i++){const r=t.at(i,s),a=t.at(i,s-1),n=t.at(i,s+1),h=t.at(i-1,s),o=t.at(i+1,s);e()&&"C"===r.key&&("D"!==h.key&&"D"!==o.key&&"D"!==a.key&&"D"!==n.key&&("R"!==h.key&&"R"!==o.key&&"R"!==a.key&&"R"!==n.key||("W"===h.key&&"W"===o.key||"W"===a.key&&"W"===n.key)&&t.setTile(i,s,yt.retrieve("D"))))}return t},Wt=function(t,e,s){for(let i=1;i<e.height-1;i++)for(let r=1;r<e.width-1;r++)e.at(r,i).passibleThrough()&&Math.random()<t&&s.pick(null).addToMap(new p(r,i),e);return e},Ft=function(t,e,s){for(let i=1;i<e.height-1;i++)for(let r=1;r<e.width-1;r++){const a=e.at(r,i);a.passibleThrough()&&Math.random()<t&&a.addItem(s.pick(null))}return e},Lt=function(t){let e=t.width,s=t.height,i=0,r=0;for(let a=1;a<t.height-1;a++)for(let n=1;n<t.width-1;n++)t.at(n,a).passibleThrough()&&(r=Math.max(a,r),i=Math.max(n,i),s=Math.min(a,s),e=Math.min(n,e));const a=Math.floor((t.width-(i-e))/2)-e,n=Math.floor((t.height-(r-s))/2)-s;return g(t.map,a),t.map.forEach(t=>g(t,n)),t},zt=function(t,e,s){let i=t.width*t.height;for(;i>0;){const r=Object(h.random)(0,t.width-1),a=Object(h.random)(0,t.height-1);if(e(t.at(r,a)))return s(r,a),t;i--}throw"post add failed to add tile"},Bt=function(t,e){zt(t,t=>t.isFloor()&&t.passibleThrough(),(s,i)=>{let r;zt(e,t=>t.isFloor()&&t.passibleThrough(),(a,n)=>{const h=new class extends xt{constructor(t,e,s){super("<","<",bt.StairwayUp),this.currentMap=t,this.adjacentMap=e,this.enterPos=s}}(e,t,new p(s,i));e.setTile(a,n,h),r=new Ct(t,e,new p(a,n))}),t.setTile(s,i,r)})};var Ut=function(t){return new Rt(u(t[0].length,t.length,(e,s)=>yt.retrieve(t[s].charAt(e))))};const Vt=0,$t=function(){return yt.retrieve("R")},qt=function(){return yt.retrieve("C")},Ht=function(){return yt.retrieve("W")},Gt=60,Yt=Math.PI/(2*Gt);class Xt extends o{notCross(t){return t.x-Vt>this.x+this.w||t.y-Vt>this.y+this.h||t.x+t.w<this.x-Vt||t.y+t.h<this.y-Vt}pointWithin(){return new p(this.x+1+l(this.w-1),this.y+1+l(this.h-1))}add(t){let e=0;for(;e<this.w;){let s=0;for(;s<this.h;)t[this.x+e][this.y+s]=$t(),s++;e++}}}class Jt extends o{constructor(t,e,s,i){super(t,e,s,i),this.lined=t>=s&&e>=i||s>=t&&i>=e}add(t){let[e,s,i]=this.horizontalLine(),r=0;for(;r<i;)"W"===t[e+r][s].key&&(t[e+r][s]=qt()),r+=1;let[a,n,h]=this.verticalLine(),o=0;for(;o<h;)"W"===t[a][n+o].key&&(t[a][n+o]=qt()),o+=1}horizontalLine(){return this.lined?[Math.min(this.x,this.w),Math.max(this.y,this.h),Math.abs(this.w-this.x)]:[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.w-this.x)]}verticalLine(){return this.lined,[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.h-this.y)]}}var Kt=function(t,e,s,i,r){const a=new class{constructor(t,e,s,i,r){this.maxX=t,this.maxY=e,this.minSize=s,this.maxSize=i,this.roomsCount=r;let a=new Array(this.roomsCount).fill(void 0).map(t=>this.generateRoom());this.rooms=this.normalize(this.ray(a)),this.roads=this.buildRoads(this.rooms)}generateRoom(){return new Xt(0,0,this.minSize+l(this.maxSize-this.minSize),this.minSize+l(this.maxSize-this.minSize))}ray(t){return t.reduce((t,e)=>{for(let s=0,i=l(360)/180*Math.PI;s<Gt;i+=Yt,s++){const s=Math.cos(i),r=Math.sin(i);let a=1,n=0,h=0,o=new Xt(e.x,e.y,e.w,e.h);for(;Math.abs(n)<this.maxX/2&&Math.abs(h)<this.maxY/2;){let e=Math.round(a*s),i=Math.round(a*r);for(;e===n&&i===h;)a+=1,e=Math.round(a*s),i=Math.round(a*r);if(o.move(e-n,i-h),n=e,h=i,t.every(t=>o.notCross(t)))return t.push(o),t}}return t},[])}normalize(t){const e=d(t.map(t=>t.x))-1;t.forEach(t=>{t.move(-e,0)}),t=t.filter(t=>t.x+t.w<this.maxX);const s=d(t.map(t=>t.y))-1;return t.forEach(t=>{t.move(0,-s)}),t.filter(t=>t.y+t.h<this.maxY)}buildRoads(t){let e=t.map(t=>t.pointWithin()),s=[e.shift()],i=[];const r=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)};for(;e.length;){let t=e.shift(),a=s[0],n=r(t,a);s.forEach(e=>{const s=r(e,t);s<n&&(a=e,n=s)}),s.push(t),i.push(new Jt(t.x,t.y,a.x,a.y))}return i}}(t,e,s,i,r);let n=u(t,e,Ht);for(let t=0;t<a.rooms.length;t++)a.rooms[t].add(n);for(let t=0;t<a.roads.length;t++)a.roads[t].add(n);return new Rt(n)},Qt=i.a.extend({name:"Logger",props:["logger"],computed:{messages(){return Object(h.takeRight)(this.logger.messages,5)}},methods:{ts:t=>kt(t.ts).format("hh:mm:ss"),rowClass(t){switch(t.level){case Mt.DEBUG:return"table-secondary";case Mt.INFO:return"table-info";case Mt.WARNING:return"table-warning";case Mt.DANGER:return"table-danger"}}}}),Zt=(s(154),Object(a.a)(Qt,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"container",staticClass:"logger"},[s("table",{staticClass:"table table-sm table-striped"},[s("tbody",t._l(t.messages,function(e,i){return s("tr",{key:i,class:t.rowClass(e)},[s("td",[t._v(t._s(t.ts(e)))]),t._v(" "),s("td",[t._v(t._s(e.message))])])}))])])},[],!1,null,null,null).exports);class te{constructor(t,e,s,i,r,a,n){this.ch=t,this.r=e,this.g=s,this.b=i,this.br=r,this.bg=a,this.bb=n}getChar(){return this.ch}setChar(t){this.ch=t}setColor(t,e,s){this.r=t,this.g=e,this.b=s}setGrey(t){this.r=t,this.g=t,this.b=t}setBackground(t,e,s){this.br=t,this.bg=e,this.bb=s}backgroundToColor(){this.r=this.br,this.g=this.bg,this.b=this.bb}swapColors(){this.r=[this.br,this.br=this.r][0],this.g=[this.bg,this.bg=this.g][0],this.b=[this.bb,this.bb=this.b][0]}resetColor(){this.r=this.g=this.b=void 0}resetBackground(){this.br=this.bg=this.bb=void 0}getColorHex(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""}getBackgroundHex(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""}getColorRGB(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?`rgb(${this.r},${this.g},${this.b})`:""}getBackgroundRGB(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?`rgb(${this.br},${this.bg},${this.bb})`:""}getColorJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}}getBackgroundJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}}copy(t){this.ch=t.ch,this.r=t.r,this.g=t.g,this.b=t.b,this.br=t.br,this.bg=t.bg,this.bb=t.bb}clone(){return new te(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)}}const ee="unicodetiles",se=new te(" ");const ie="\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n",re="\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n";const ae=function(t){return new class{constructor(t){if(this.view=t,this.view=t,this.canvas=document.createElement("canvas"),!this.canvas.getContext)throw"Canvas not supported";if(this.gl=this.canvas.getContext("experimental-webgl"),!this.gl)throw"WebGL not supported";if(t.elem.appendChild(this.canvas),this.charMap={},this.charArray=[],this.defaultColors={r:1,g:1,b:1,br:0,bg:0,bb:0},this.attribs={position:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},texCoord:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},color:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},bgColor:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},charIndex:{buffer:null,data:null,itemSize:1,location:null,hint:this.gl.DYNAMIC_DRAW}},this.offscreen||(this.offscreen=document.createElement("canvas")),this.offscreen.style.position="absolute",this.offscreen.style.top="0px",this.offscreen.style.left="0px",this.ctx=this.offscreen.getContext("2d"),!this.ctx)throw"Failed to acquire offscreen canvas drawing context";this.updateStyle(),this.canvas.width=(t.squarify?this.th:this.tw)*t.w,this.canvas.height=this.th*t.h,this.offscreen.width=0,this.offscreen.height=0,this.updateStyle(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height);let e=this.compileShader(this.gl.VERTEX_SHADER,ie),s=this.compileShader(this.gl.FRAGMENT_SHADER,re),i=this.gl.createProgram();if(this.gl.attachShader(i,e),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.deleteShader(e),this.gl.deleteShader(s),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS)){const t=`Error linking program: ${this.gl.getProgramInfoLog(i)}`;throw this.gl.deleteProgram(i),t}this.gl.useProgram(i),this.attribs.position.location=this.gl.getAttribLocation(i,"position"),this.attribs.texCoord.location=this.gl.getAttribLocation(i,"texCoord"),this.attribs.color.location=this.gl.getAttribLocation(i,"color"),this.attribs.bgColor.location=this.gl.getAttribLocation(i,"bgColor"),this.attribs.charIndex.location=this.gl.getAttribLocation(i,"charIndex"),this.initBuffers();let r=this.gl.getUniformLocation(i,"uResolution");this.gl.uniform2f(r,this.canvas.width,this.canvas.height),this.tileCountsLocation=this.gl.getUniformLocation(i,"uTileCounts"),this.gl.uniform2f(this.tileCountsLocation,this.view.w,this.view.h),this.paddingLocation=this.gl.getUniformLocation(i,"uPadding"),this.gl.uniform2f(this.paddingLocation,0,0);let a=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.cacheChars(" !\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.activeTexture(this.gl.TEXTURE0),setTimeout(()=>{this.updateStyle(),this.buildTexture(),this.render()},100)}getRendererString(){return"webgl"}buildTexture(){let t=this.offscreen.width/(this.tw+this.pad),e=this.offscreen.height/(this.th+this.pad);const s=this.charArray.length;s>Math.floor(t)*Math.floor(e)&&(e=(t=Math.ceil(Math.sqrt(s)))+2,this.offscreen.width=t*(this.tw+this.pad),this.offscreen.height=e*(this.th+this.pad),this.updateStyle(),this.gl.uniform2f(this.tileCountsLocation,t,e)),this.gl.uniform2f(this.paddingLocation,this.pad/this.offscreen.width,this.pad/this.offscreen.height);let i,r=0;this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.offscreen.width,this.offscreen.height),this.ctx.fillStyle="#ffffff";const a=.5*this.gap,n=this.tw+this.pad,h=this.th+this.pad;let o=.5*h;for(let s=0;s<e;++s){let e=.5*this.pad;for(let s=0;s<t&&void 0!==(i=this.charArray[r]);++s,++r)this.ctx.fillText(i,e+a,o),e+=n;if(!i)break;o+=h}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.offscreen)}cacheChars(t,e=!0){if(!this.gl)return;let s=!1;for(let e=0;e<t.length;++e)this.charMap[t[e]]||(s=!0,this.charArray.push(t[e]),this.charMap[t[e]]=this.charArray.length-1);s&&e&&this.buildTexture()}updateStyle(t){t=t||window.getComputedStyle(this.view.elem,null),this.ctx.font=t.fontSize+"/"+t.lineHeight+" "+t.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.tw=this.ctx.measureText("幅").width,this.th=parseInt(t.fontSize,10),this.gap=this.view.squarify?this.th-this.tw:0,this.view.squarify&&(this.tw=this.th),this.pad=2*Math.ceil(.2*this.th);const e=t.color.match(/\d+/g),s=t.backgroundColor.match(/\d+/g);this.defaultColors.r=parseInt(e[0],10)/255,this.defaultColors.g=parseInt(e[1],10)/255,this.defaultColors.b=parseInt(e[2],10)/255,this.defaultColors.br=parseInt(s[0],10)/255,this.defaultColors.bg=parseInt(s[1],10)/255,this.defaultColors.bb=parseInt(s[2],10)/255}clear(){}render(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);const t=this.view.w,e=this.view.h;let s=this.view.buffer,i=(this.view.defaultColor,this.view.defaultBackground,!1);for(let r=0;r<e;++r)for(let e=0;e<t;++e){const a=s[r][e];let n=this.charMap[a.ch];void 0===n&&(this.cacheChars(a.ch,!1),i=!0,n=this.charMap[a.ch]);const h=6*this.attribs.color.itemSize*(r*t+e),o=6*this.attribs.charIndex.itemSize*(r*t+e),c=void 0===a.r?this.defaultColors.r:a.r/255,l=void 0===a.g?this.defaultColors.g:a.g/255,u=void 0===a.b?this.defaultColors.b:a.b/255,d=void 0===a.br?this.defaultColors.br:a.br/255,p=void 0===a.bg?this.defaultColors.bg:a.bg/255,m=void 0===a.bb?this.defaultColors.bb:a.bb/255;for(let t=0;t<6;++t){const e=h+t*this.attribs.color.itemSize;this.attribs.color.data[e+0]=c,this.attribs.color.data[e+1]=l,this.attribs.color.data[e+2]=u,this.attribs.bgColor.data[e+0]=d,this.attribs.bgColor.data[e+1]=p,this.attribs.bgColor.data[e+2]=m,this.attribs.charIndex.data[o+t]=n}}i&&this.buildTexture(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.color.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.color.data,this.attribs.color.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.bgColor.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.bgColor.data,this.attribs.bgColor.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.charIndex.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.charIndex.data,this.attribs.charIndex.hint);const r=this.attribs.position;this.gl.drawArrays(this.gl.TRIANGLES,0,r.data.length/r.itemSize)}compileShader(t,e){const s=this.gl.createShader(t);if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const t="Error compiling shader: "+this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),t}return s}initBuffers(){let t,e,s=this.attribs;const i=this.view.w,r=this.view.h;for(t in this.attribs)(e=s[t]).data=new Float32Array(6*e.itemSize*i*r);for(let t=0;t<r;++t)for(let e=0;e<i;++e){const r=6*s.position.itemSize*(t*i+e);this.insertQuad(s.position.data,r,e*this.tw,t*this.th,this.tw,this.th),this.insertQuad(s.texCoord.data,r,0,0,1,1)}for(t in this.attribs)(e=s[t]).buffer&&this.gl.deleteBuffer(e.buffer),e.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.data,e.hint),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.itemSize,this.gl.FLOAT,!1,0,0)}insertQuad(t,e,s,i,r,a){const n=s,h=i,o=s+r,c=i+a;t[e]=n,t[++e]=h,t[++e]=o,t[++e]=h,t[++e]=n,t[++e]=c,t[++e]=n,t[++e]=c,t[++e]=o,t[++e]=h,t[++e]=o,t[++e]=c}}(t)},ne=120,he=180,oe={r:255,g:165,b:0};class ce extends te{lighted(t){return this}constructor(t,e=ne,s=ne,i=ne){super(t,e,s,i)}litBackground(t,e){return t.setBackground(oe.r*e,oe.g*e,oe.b*e),t}litColor(t,e){return t.setColor(oe.r*e,oe.g*e,oe.b*e),t}}class le extends ce{constructor(t){super(t,he,he,he)}}class ue extends le{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}class de extends ce{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}const pe=new de("刀",200,200,200),me=new de("体",200,200,200),ge=new de("胸",200,200,200),fe=new de("石",200,200,200),ve=function(t){switch(t.group){case b.OneHandWeapon:return pe;case b.Consumable:return me;case b.BodyArmor:return ge;case b.Missile:return fe;default:throw`Unknown group ${t} with type ${t.group}`}};var we=i.a.extend({name:"Stats",props:["creature"],computed:{},methods:{aiName(t){return t instanceof dt?"Patrol":t instanceof ht?"Escaper":t instanceof Y?"Chaser":t instanceof ot?"Explorer":t instanceof class extends ${act(t){}available(t){return!0}}?"Waiter":t instanceof ct?"Loiter":t instanceof at?`Dispatcher (${this.aiName(t.aiToRun)})`:t instanceof G?"Attacker":t instanceof mt?"SelfHealer":t instanceof pt?"Picker":t instanceof wt?"Thrower":void 0},displayItem(t){if(t)return`${ve(t).getChar()} ${t.name}`},displayAttribute:t=>t.currentValue()!=t.maximum()?`${t.currentValue()} [${t.maximum()}]`:t.currentValue(),displayAttributeWithModifiers(t){if(t.currentValue()!=t.maximum()){const e=t.modifiers.map(t=>t>0?`+ ${t}`:`- ${t}`);return`${t.currentValue()} = [${t.maximum()}] ${e}`}return t.currentValue()},groupedCares(t){let e={};return t.forEach(t=>{e[t.name]?e[t.name]+=1:e[t.name]=1}),e},displayBodyPart(t){switch(t){case y.LeftHand:case y.RightHand:return"手";case y.Legs:return"足";case y.Finger:return"指";case y.Head:return"頭";case y.Eye:return"目";case y.Neck:return"首";case y.Back:return"背";case y.Body:return"体";case y.MissileWeapon:return"MissileWeapon";case y.Missile:return"Missile";default:throw`Unknow body part ${t}`}}}}),be=Object(a.a)(we,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("dl",{staticClass:"row small"},[s("dd",{staticClass:"col-sm-4"},[t._v("\n    ID\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.creature.id)+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    POS\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.creature.pos)+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Level\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.creature.level.current)+" ["+t._s(t.creature.level.currentExperience)+" - "+t._s(t.creature.level.requiredExperience)+"]\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Здоровье\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.displayAttribute(t.creature.characteristics.health))+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Атака\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.displayAttributeWithModifiers(t.creature.characteristics.attack))+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Защита\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.displayAttributeWithModifiers(t.creature.characteristics.defense))+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Скорость\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.displayAttributeWithModifiers(t.creature.characteristics.speed))+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    AI\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[t._v("\n    "+t._s(t.aiName(t.creature.ai))+"\n  ")]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    服\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[s("table",t._l(t.creature.inventory.wears(),function(e,i){return s("tr",{key:"bodyPart"+i},[s("td",[t._v("\n          "+t._s(t.displayBodyPart(e.bodyPart))+"\n        ")]),t._v(" "),s("td",[t._v("\n          "+t._s(t.displayItem(e.equipment))+"\n        ")])])}))]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    鞄\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[s("ul",t._l(t.groupedCares(t.creature.inventory.cares()),function(e,i){return s("li",{key:i},[t._v("\n          "+t._s(i)+" "+t._s(1===e?"":": "+e)+"\n      ")])}))]),t._v(" "),s("dd",{staticClass:"col-sm-4"},[t._v("\n    Профессии\n  ")]),t._v(" "),s("dt",{staticClass:"col-sm-8"},[s("ul",t._l(t.creature.professions,function(e){return s("li",{key:e.name},[t._v("\n          "+t._s(e.name)+" "+t._s(e.level)+"\n      ")])}))])])},[],!1,null,null,null).exports;const ye=new ue("俺",0,255,0),xe=new ue("俺",255,0,0),Ce=new ue("俺",0,0,255),Me=new ue("俺",255,0,255),ke=new ue("俺",0,255,255),_e=new ue("ｄ",197,65,38),Te=new class extends ce{constructor(){super("戸")}lighted(t){let e=this.clone();return this.litColor(e,t),e.swapColors(),e}},je=new class extends ce{constructor(){super("＃")}lighted(t){let e=this.clone();return this.litBackground(e,t),e.backgroundToColor(),e}},Re=new class extends ce{constructor(){super("・")}lighted(t){return this.litColor(this.clone(),t)}},Ee=new class extends ce{constructor(){super("＞")}},Ie=new class extends ce{constructor(){super("＜")}},Se=new ce("　",0,0,0),Ae=[new de("｜",200,200,200),new de("／",200,200,200),new de("ー",200,200,200),new de("＼",200,200,200)];var De=i.a.extend({props:["level","player"],data:()=>({wholeMap:!1,term:null,eng:null,drawInterval:null,ts:Date.now(),fps:0,counter:0,interval:100,nextStep:!1,step:0,pause:!1}),components:{Stats:be},methods:{getTile(t,e){const s=this.stage.at(t,e).effect;if(s)return new ce(s,200,200,0);const i=this.wholeMap?this.stage.at(t,e):this.stage.at(t,e).tile;if(!i)return Se;if(i.creature){if("Rat"==i.creature.name())return _e;switch(i.creature.id%5){case 0:return ke;case 1:return Me;case 2:return Ce;case 3:return xe;case 4:return ye}}if(i.items.length){if(1===i.items.length)return ve(i.items[0]);const t=this.step%(3*this.animationFps+4);if(t<Ae.length)return Ae[t];{const t=Math.floor(this.step/(3*this.animationFps+4));return ve(i.items[t%i.items.length])}}switch(i.display){case"#":return je;case"+":return Te;case" ":return Re;case"<":return Ie;case">":return Ee;default:return Se}},initViewport(){this.term=new class{constructor(t,e,s,i,r=!1){this.elem=t,this.w=e,this.h=s,this.squarify=r,this.cx=Math.floor(e/2),this.cy=Math.floor(s/2),this.elem.innerHTML="",-1===t.className.indexOf(ee)&&(0===t.className.length?t.className=ee:t.className+=" "+ee),this.buffer=new Array(s);for(let t=0;t<s;++t){this.buffer[t]=new Array(e);for(let s=0;s<e;++s)this.buffer[t][s]=se}this.renderer=i(this)}updateStyle(t){const e=window.getComputedStyle(this.elem,null);this.defaultColor=e.color||void 0,this.defaultBackground=e.backgroundColor||void 0,t&&this.renderer.updateStyle(e)}getRendererString(){return this.renderer.getRendererString()}put(t,e,s){e<0||s<0||e>=this.w||s>=this.h||(this.buffer[s][e]=t)}unsafePut(t,e,s){this.buffer[s][e]=t}putString(t,e,s,i,r,a,n,h,o){const c=t.length;if(!(e<0||s<0))for(let l=0;l<c;++l){if(e>=this.w&&(e=0,++s),s>=this.h)return;const c=new te(t[l],i,r,a,n,h,o);this.unsafePut(c,e,s),++e}}get(t,e){return t<0||e<0||t>=this.w||e>=this.h?se:this.buffer[e][t]}clear(){for(let t=0;t<this.h;++t)for(let e=0;e<this.w;++e)this.buffer[t][e]=se;this.renderer.clear()}render(){this.renderer.render()}}(this.$refs.scene,this.level.width,this.level.height,ae,!0),this.eng=new class{constructor(t,e,s,i){this.viewport=t,this.tileFunc=e,this.w=s,this.h=i,this.refreshCache=!0,this.cacheEnabled=!1,this.transitionDuration=0,this.cachex=0,this.cachey=0,this.tileCache=new Array(t.h),this.tileCache2=new Array(t.h);for(let e=0;e<t.h;++e)this.tileCache[e]=new Array(t.w),this.tileCache2[e]=new Array(t.w)}setTileFunc(t,e,s){e&&(this.transition=void 0,"string"==typeof e&&("boxin"===e?this.transition=function(t,e,s,i,r,a,n){const h=.5*s,o=.5*i;return t-=h,e-=o,Math.abs(t)<h*n&&Math.abs(e)<o*n?r:a}:"boxout"===e?this.transition=function(t,e,s,i,r,a,n){const h=.5*s,o=.5*i;return t-=h,e-=o,n=1-n,Math.abs(t)<h*n&&Math.abs(e)<o*n?a:r}:"circlein"===e?this.transition=function(t,e,s,i,r,a,n){const h=.5*s,o=.5*i;return(t-=h)*t+(e-=o)*e<(h*h+o*o)*n?r:a}:"circleout"===e?this.transition=function(t,e,s,i,r,a,n){const h=.5*s,o=.5*i;return(t-=h)*t+(e-=o)*e>(h*h+o*o)*(n=1-n)?r:a}:"random"===e&&(this.transition=function(t,e,s,i,r,a,n){return Math.random()>n?a:r})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=s||500)),this.tileFunc=t}setMaskFunc(t){this.maskFunc=t}setShaderFunc(t){this.shaderFunc=t}setWorldSize(t,e){this.w=t,this.h=e}setCacheEnabled(t){this.cacheEnabled=t,this.refreshCache=!0}update(t,e){t=t||0,e=e||0;const s=t-this.viewport.cx,i=e-this.viewport.cy,r=(new Date).getTime();let a,n;this.transition&&this.transitionTimer&&(a=(r-this.transitionTimer)/this.transitionDuration),a&&a>=1&&(this.transition=void 0);for(let t=0;t<this.viewport.h;++t)for(let e=0;e<this.viewport.w;++e){const h=e+s,o=t+i;if(this.w&&(h<0||h>=this.w))n=se;else if(this.h&&(o<0||o>=this.h))n=se;else if(this.maskFunc&&!this.maskFunc(h,o))n=se;else if(this.transition&&!this.refreshCache)n=this.transition(e,t,this.viewport.w,this.viewport.h,this.tileFunc(h,o),this.tileCache[t][e],a||0);else if(this.cacheEnabled&&!this.refreshCache){const t=h-this.cachex,e=o-this.cachey;t>=0&&t<this.viewport.w&&e>=0&&e<this.viewport.h?(n=this.tileCache[e][t])===se&&(n=this.tileFunc(h,o)):n=this.tileFunc(h,o)}else n=this.tileFunc(h,o);this.tileCache2[t][e]=n,this.shaderFunc&&n!==se&&(n=this.shaderFunc(n,h,o,r)),this.viewport.unsafePut(n,e,t)}this.cachex=s,this.cachey=i;const h=this.tileCache;this.tileCache=this.tileCache2,this.tileCache2=h,this.refreshCache=!1}}(this.term,(t,e)=>this.getTile(t,e),this.level.width,this.level.height),this.eng.setMaskFunc((t,e)=>this.wholeMap||this.stage.at(t,e).seen),this.eng.setShaderFunc((t,e,s,i)=>this.lighting(t,e,s,i)),clearInterval(this.drawInterval),this.drawInterval=setInterval(()=>{this.drawScene()},this.interval)},drawScene(){if(this.done)return;const t=Date.now();this.ts+1e3<t&&(this.fps=this.counter,this.counter=0,this.ts=t),this.done=!0,this.pause&&!this.nextStep||(this.nextStep=!1,this.level.turn()),this.eng.update(this.term.cx,this.term.cy),this.term.render(),this.done=!1,this.counter+=1,this.step+=1},lighting(t,e,s,i){if(this.wholeMap)return t.lighted(1);const r=this.stage.at(e,s);return r.visible&&t.lighted?t.lighted(r.degree):t}},computed:{stage(){return this.wholeMap?this.level:this.player.stageMemory(this.level.id)},animationFps(){return 1e3/this.interval}},mounted(){this.initViewport()},beforeDestroy(){clearInterval(this.drawInterval)},watch:{interval(){this.initViewport()}}}),Oe=(s(152),Object(a.a)(De,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"scene"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col mr-0"},[s("div",{ref:"scene",staticClass:"unicodetiles"})]),t._v(" "),s("div",{staticClass:"col pl-0"},[s("div",{staticClass:"fps mb-2 "},[t._v("FPS "+t._s(t.fps))]),t._v(" "),s("div",[t._v("MAP "+t._s(t.level.id))]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.wholeMap,expression:"wholeMap"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.wholeMap)?t._i(t.wholeMap,null)>-1:t.wholeMap},on:{change:function(e){var s=t.wholeMap,i=e.target,r=!!i.checked;if(Array.isArray(s)){var a=t._i(s,null);i.checked?a<0&&(t.wholeMap=s.concat([null])):a>-1&&(t.wholeMap=s.slice(0,a).concat(s.slice(a+1)))}else t.wholeMap=r}}}),t._v(" "),s("Stats",{attrs:{creature:t.player}}),t._v(" "),s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-2"},[t._v("Map")]),t._v(" "),s("div",{staticClass:"col-sm-10"},[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.interval,expression:"interval"}],staticClass:"form-control",attrs:{id:"interval",type:"number"},domProps:{value:t.interval},on:{input:function(e){e.target.composing||(t.interval=e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"interval"}},[t._v("\n              Tick interval\n            ")])]),t._v(" "),s("button",{staticClass:"btn btn-secondary",on:{click:function(e){t.nextStep=!0}}},[t._v("\n            Next step\n          ")]),t._v(" "),s("button",{staticClass:"btn btn-secondary",on:{click:function(e){t.pause=!t.pause}}},[t._v("\n            "+t._s(t.pause?"Start":"Pause")+"\n          ")])])])],1)])])},[],!1,null,null,null).exports),Pe=i.a.extend({props:["screen"],data:()=>({picked:null}),computed:{valid(){}},methods:{close(){this.screen.onInput(this.picked)}}}),Ne=(s(150),Object(a.a)(Pe,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"level-up text-center"},[s("div",t._l(t.screen.options,function(e){return s("span",{key:e.id,staticClass:"option p-2 m-3",class:{picked:t.picked&&t.picked.id===e.id},on:{click:function(s){t.picked=e}}},[t._v("\n      "+t._s(e.name)+"\n    ")])})),t._v(" "),null!==t.picked?s("a",{on:{click:t.close}},[t._v("Подтвердить")]):t._e()])},[],!1,null,null,null).exports);let We={addDoors:!1,minSize:3,maxSize:10,roomsCount:10};const Fe=new Dt([[1,()=>new T("Katana",new st({attack:10}))],[3,()=>new T("Axe",new st({attack:7}))],[7,()=>new T("Dagger",new st({attack:3}))],[5,()=>new T("Hammer",new st({attack:5}))]]),Le=new Dt([[1,()=>new _("Кольчуга",new st({defense:10}))],[5,()=>new _("Латы",new st({defense:5}))],[10,()=>new _("Роба",new st({defense:1}))]]),ze=(t,e)=>new B(t,new at,new O(e,S.PlayerOnlyEnemy,[])),Be=()=>ze(new it({attack:1,defense:1,dexterity:1,health:1,radius:5,speed:90}),"Rat"),Ue=()=>ze(new it({attack:3,defense:3,dexterity:2,health:5,radius:5,speed:100}),"Orc"),Ve=()=>ze(new it({attack:2,defense:7,dexterity:1,health:10,radius:5,speed:120}),"Undead"),$e=()=>ze(new it({attack:5,defense:5,dexterity:3,health:7,radius:7,speed:90}),"Robot"),qe=new Dt([[1,Be]]),He=new Dt([[1,Be],[2,Ue]]),Ge=new Dt([[1,Be],[1,Ue],[2,Ve]]),Ye=new Dt([[2,Ve],[2,$e]]),Xe=new Dt([[2,$e],[1,()=>ze(new it({attack:7,defense:7,dexterity:7,health:30,radius:5,speed:100}),"Dragon")]]);class Je extends Pt{constructor(t,e,s){super(),this.pool=t,this.maxLevel=e,this.maxTaken=s}available(t){let e=[];return this.canUpdate(t)?e.push(this.updatableProfession(t)):this.canTakeNewProfession(t)&&e.push(this.newFromPool(t)),this.canTakeNewProfession(t)?e.push(this.newFromPool(t,e.map(t=>t.id))):this.canUpdate(t)&&e.push(this.updatableProfession(t,e.map(t=>t.id))),e}canUpdate(t){return t.professions.some(t=>t.level<this.maxLevel)}updatableProfession(t,e=[]){return Object(h.sample)(t.professions.filter(s=>t.professions.length<this.maxTaken&&!Object(h.includes)(e,s.id)))}canTakeNewProfession(t){return t.professions.length<this.maxTaken}newFromPool(t,e=[]){const s=e.concat(t.professions.map(t=>t.id));return Object(h.sample)(this.pool.filter(t=>!Object(h.includes)(s,t.id)))}}class Ke extends At{constructor(t){let e=[];["Lorem","ipsum","dolor","sit","amet","consectetur","adipiscing","elit","Suspendisse","dignissim","mi","tincidunt"].forEach((t,s)=>{e.push(new Ot(s,t,1))}),super(new Je(e,3,6)),this.player=this.initPlayer();let s=this.generateMap(t),i=this.generateMap(t),r=this.generateMap(t),a=this.generateMap(t),n=this.generateMap(t);Wt(.05,s,qe),Wt(.06,i,He),Wt(.07,r,Ge),Wt(.08,a,Ye),Wt(.09,n,Xe),Bt(s,i),Bt(i,r),Bt(r,a),Bt(a,n),this.currentMap=s,zt(this.currentMap,t=>t.isFloor()&&t.passibleThrough(),(t,e)=>{this.player.addToMap(new p(t,e),this.currentMap)})}initPlayer(){const t=new T("Dagger",new st({attack:3})),e=new k("Rock",new st({})),s=new O("Player",S.Player,D);let i=new U(new Et([1,1,1,3,10]),new it({attack:1,defense:4,dexterity:3,health:10,radius:10,speed:100}),new at,s);return i.putOn(t),i.putOn(e),i}generateMap(t){let e=Kt(20,40,t.minSize,t.maxSize,t.roomsCount);return e=Ut(["WWWWWWWWWWW","WRRRRRRRRRW","WRRRRRRRRRW","WRRRRRRRRRW","WRRRRRRRRRW","WRRRRRRRRRW","WWWWWWWWWWW"]),t.addDoors&&Nt(e),Lt(e),e.game=this,Ft(.01,e,Fe.merge(Le)),e}}var Qe=i.a.extend({data:()=>({game:new Ke(We),ts:Date.now(),generatorOptions:We}),components:{Cell:n,Logger:Zt,Scene:Oe,LevelUp:Ne},methods:{generateMap(){this.game=new Ke(this.generatorOptions)}}}),Ze=(s(148),Object(a.a)(Qe,function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.game?s("div",{staticClass:"container",attrs:{id:"app"}},[t.game.player&&!t.game.player.dead?s("Scene",{attrs:{level:t.game.currentMap,player:t.game.player}}):t._e(),t._v(" "),t.game.player&&t.game.player.dead?s("div",[t._v("You are dead")]):t._e(),t._v(" "),t.game.screen?s("LevelUp",{attrs:{screen:t.game.screen}}):t._e(),t._v(" "),s("Logger",{attrs:{logger:t.game.logger}}),t._v(" "),s("div",{},[s("div",{},[s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-2"},[t._v("\n          Map\n        ")]),t._v(" "),s("div",{staticClass:"col-sm-10"},[s("div",{staticClass:"form-check"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.addDoors,expression:"generatorOptions.addDoors"}],staticClass:"form-check-input",attrs:{id:"doors",type:"checkbox"},domProps:{checked:Array.isArray(t.generatorOptions.addDoors)?t._i(t.generatorOptions.addDoors,null)>-1:t.generatorOptions.addDoors},on:{change:function(e){var s=t.generatorOptions.addDoors,i=e.target,r=!!i.checked;if(Array.isArray(s)){var a=t._i(s,null);i.checked?a<0&&t.$set(t.generatorOptions,"addDoors",s.concat([null])):a>-1&&t.$set(t.generatorOptions,"addDoors",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.generatorOptions,"addDoors",r)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"doors"}},[t._v("\n              Add doors\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.roomsCount,expression:"generatorOptions.roomsCount"}],staticClass:"form-control",attrs:{id:"roomsCount",type:"number"},domProps:{value:t.generatorOptions.roomsCount},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"roomsCount",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"roomsCount"}},[t._v("\n              roomsCount\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.minSize,expression:"generatorOptions.minSize"}],staticClass:"form-control",attrs:{id:"minSize",type:"number"},domProps:{value:t.generatorOptions.minSize},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"minSize",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"minSize"}},[t._v("\n              minSize\n            ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.generatorOptions.maxSize,expression:"generatorOptions.maxSize"}],staticClass:"form-control",attrs:{id:"maxSize",type:"number"},domProps:{value:t.generatorOptions.maxSize},on:{input:function(e){e.target.composing||t.$set(t.generatorOptions,"maxSize",e.target.value)}}}),t._v(" "),s("label",{staticClass:"form-check-label",attrs:{for:"maxSize"}},[t._v("\n              maxSize\n            ")])])])]),t._v(" "),s("div",{staticClass:"form-group row"},[s("div",{staticClass:"col-sm-10"},[s("button",{staticClass:"btn btn-primary",on:{click:function(e){t.generateMap()}}},[t._v("\n            Rebuild!\n          ")])])])])])],1):t._e()},[],!1,null,null,null).exports);s(146),s(144);new i.a({el:"#app",render:t=>t(Ze)})},146:function(t,e,s){},148:function(t,e,s){"use strict";var i=s(6);s.n(i).a},150:function(t,e,s){"use strict";var i=s(7);s.n(i).a},152:function(t,e,s){"use strict";var i=s(8);s.n(i).a},154:function(t,e,s){"use strict";var i=s(9);s.n(i).a},155:function(t,e,s){var i={"./af":134,"./af.js":134,"./ar":133,"./ar-dz":132,"./ar-dz.js":132,"./ar-kw":131,"./ar-kw.js":131,"./ar-ly":130,"./ar-ly.js":130,"./ar-ma":129,"./ar-ma.js":129,"./ar-sa":128,"./ar-sa.js":128,"./ar-tn":127,"./ar-tn.js":127,"./ar.js":133,"./az":126,"./az.js":126,"./be":125,"./be.js":125,"./bg":124,"./bg.js":124,"./bm":123,"./bm.js":123,"./bn":122,"./bn.js":122,"./bo":121,"./bo.js":121,"./br":120,"./br.js":120,"./bs":119,"./bs.js":119,"./ca":118,"./ca.js":118,"./cs":117,"./cs.js":117,"./cv":116,"./cv.js":116,"./cy":115,"./cy.js":115,"./da":114,"./da.js":114,"./de":113,"./de-at":112,"./de-at.js":112,"./de-ch":111,"./de-ch.js":111,"./de.js":113,"./dv":110,"./dv.js":110,"./el":109,"./el.js":109,"./en-au":108,"./en-au.js":108,"./en-ca":107,"./en-ca.js":107,"./en-gb":106,"./en-gb.js":106,"./en-ie":105,"./en-ie.js":105,"./en-il":104,"./en-il.js":104,"./en-nz":103,"./en-nz.js":103,"./eo":102,"./eo.js":102,"./es":101,"./es-do":100,"./es-do.js":100,"./es-us":99,"./es-us.js":99,"./es.js":101,"./et":98,"./et.js":98,"./eu":97,"./eu.js":97,"./fa":96,"./fa.js":96,"./fi":95,"./fi.js":95,"./fo":94,"./fo.js":94,"./fr":93,"./fr-ca":92,"./fr-ca.js":92,"./fr-ch":91,"./fr-ch.js":91,"./fr.js":93,"./fy":90,"./fy.js":90,"./gd":89,"./gd.js":89,"./gl":88,"./gl.js":88,"./gom-latn":87,"./gom-latn.js":87,"./gu":86,"./gu.js":86,"./he":85,"./he.js":85,"./hi":84,"./hi.js":84,"./hr":83,"./hr.js":83,"./hu":82,"./hu.js":82,"./hy-am":81,"./hy-am.js":81,"./id":80,"./id.js":80,"./is":79,"./is.js":79,"./it":78,"./it.js":78,"./ja":77,"./ja.js":77,"./jv":76,"./jv.js":76,"./ka":75,"./ka.js":75,"./kk":74,"./kk.js":74,"./km":73,"./km.js":73,"./kn":72,"./kn.js":72,"./ko":71,"./ko.js":71,"./ky":70,"./ky.js":70,"./lb":69,"./lb.js":69,"./lo":68,"./lo.js":68,"./lt":67,"./lt.js":67,"./lv":66,"./lv.js":66,"./me":65,"./me.js":65,"./mi":64,"./mi.js":64,"./mk":63,"./mk.js":63,"./ml":62,"./ml.js":62,"./mn":61,"./mn.js":61,"./mr":60,"./mr.js":60,"./ms":59,"./ms-my":58,"./ms-my.js":58,"./ms.js":59,"./mt":57,"./mt.js":57,"./my":56,"./my.js":56,"./nb":55,"./nb.js":55,"./ne":54,"./ne.js":54,"./nl":53,"./nl-be":52,"./nl-be.js":52,"./nl.js":53,"./nn":51,"./nn.js":51,"./pa-in":50,"./pa-in.js":50,"./pl":49,"./pl.js":49,"./pt":48,"./pt-br":47,"./pt-br.js":47,"./pt.js":48,"./ro":46,"./ro.js":46,"./ru":45,"./ru.js":45,"./sd":44,"./sd.js":44,"./se":43,"./se.js":43,"./si":42,"./si.js":42,"./sk":41,"./sk.js":41,"./sl":40,"./sl.js":40,"./sq":39,"./sq.js":39,"./sr":38,"./sr-cyrl":37,"./sr-cyrl.js":37,"./sr.js":38,"./ss":36,"./ss.js":36,"./sv":35,"./sv.js":35,"./sw":34,"./sw.js":34,"./ta":33,"./ta.js":33,"./te":32,"./te.js":32,"./tet":31,"./tet.js":31,"./tg":30,"./tg.js":30,"./th":29,"./th.js":29,"./tl-ph":28,"./tl-ph.js":28,"./tlh":27,"./tlh.js":27,"./tr":26,"./tr.js":26,"./tzl":25,"./tzl.js":25,"./tzm":24,"./tzm-latn":23,"./tzm-latn.js":23,"./tzm.js":24,"./ug-cn":22,"./ug-cn.js":22,"./uk":21,"./uk.js":21,"./ur":20,"./ur.js":20,"./uz":19,"./uz-latn":18,"./uz-latn.js":18,"./uz.js":19,"./vi":17,"./vi.js":17,"./x-pseudo":16,"./x-pseudo.js":16,"./yo":15,"./yo.js":15,"./zh-cn":14,"./zh-cn.js":14,"./zh-hk":13,"./zh-hk.js":13,"./zh-tw":12,"./zh-tw.js":12};function r(t){var e=a(t);return s(e)}function a(t){var e=i[t];if(!(e+1)){var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}return e}r.keys=function(){return Object.keys(i)},r.resolve=a,t.exports=r,r.id=155},169:function(t,e,s){"use strict";var i=s(10);s.n(i).a},173:function(t,e,s){t.exports=s(142)},6:function(t,e,s){},7:function(t,e,s){},8:function(t,e,s){},9:function(t,e,s){}});
//# sourceMappingURL=main.afb10c70.js.map