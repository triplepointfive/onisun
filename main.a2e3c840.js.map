{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/Logger.vue?32ca","webpack:///./components/Scene.vue?bf04","webpack:///./components/Stats.vue?40b5","webpack:///./components/Impacts.vue?9a34","webpack:///./components/views/ProfessionPickingView.vue?aab7","webpack:///./components/views/ItemsListingView.vue?a6a8","webpack:///./components/views/TalentsTreeView.vue?d891","webpack:///./components/views/InventoryView.vue?5002","webpack:///./components/views/DeathView.vue?7f85","webpack:///./components/App.vue?6fed","webpack:///./src/engine/utils/utils.ts","webpack:///./src/engine/lib/stat.ts","webpack:///./src/engine/utils/fov.ts","webpack:///./src/engine/lib/bunch.ts","webpack:///./src/engine/models/tile.ts","webpack:///./src/engine/models/creature.ts","webpack:///./src/engine/events/internal.ts","webpack:///./src/engine/events/after_event.ts","webpack:///./src/engine/events/move_event.ts","webpack:///./src/engine/ai/internal.ts","webpack:///./src/engine/ai/attacker.ts","webpack:///./src/engine/ai/chaser.ts","webpack:///./src/engine/ai/meta_ai.ts","webpack:///./src/engine/ai/escaper.ts","webpack:///./src/engine/ai/explorer.ts","webpack:///./src/engine/ai/picker.ts","webpack:///./src/engine/ai/loiter.ts","webpack:///./src/engine/ai/patrol.ts","webpack:///./src/engine/ai/thrower.ts","webpack:///./src/engine/ai/descender.ts","webpack:///./src/engine/events/stay_event.ts","webpack:///./src/engine/ai/selfhealer.ts","webpack:///./src/engine/presenters/internal.ts","webpack:///./src/engine/models/items.ts","webpack:///./src/engine/events/die_event.ts","webpack:///./src/engine/presenters/death_presenter.ts","webpack:///./src/engine/ai/player_ai.ts","webpack:///./src/engine/events/add_experience_event.ts","webpack:///./src/engine/lib/attribute.ts","webpack:///./src/engine/events/attack_event.ts","webpack:///./src/engine/events/drink_potion_event.ts","webpack:///./src/engine/events/drop_items_event.ts","webpack:///./src/engine/models/tile_effect.ts","webpack:///./src/engine/events/throw_event.ts","webpack:///./src/engine/events/missile_attack_event.ts","webpack:///./src/engine/events/pick_up_items_event.ts","webpack:///./src/engine/events/put_on_item_event.ts","webpack:///./src/engine/events/take_off_item_event.ts","webpack:///./src/engine/events/trap_event.ts","webpack:///./src/engine/generator/post.ts","webpack:///./src/engine/generator/drawn.ts","webpack:///./src/engine/generator/dungeon.ts","webpack:///./src/engine/lib/impact.ts","webpack:///./src/engine/models/logger.ts","webpack:///./src/engine/models/talent.ts","webpack:///./src/engine/presenters/idle_presenter.ts","webpack:///./src/engine/lib/level.ts","webpack:///./src/engine/lib/pool.ts","webpack:///./src/engine/lib/timeline.ts","webpack:///./src/engine/models/characteristics.ts","webpack:///./src/engine/models/dungeon.ts","webpack:///./src/engine/models/level_map.ts","webpack:///./src/engine/models/game.ts","webpack:///./src/engine/models/inventory_slot.ts","webpack:///./src/engine/models/inventory.ts","webpack:///./src/engine/models/memory.ts","webpack:///./src/engine/models/profession.ts","webpack:///./src/engine/presenters/inventory_presenter.ts","webpack:///./src/engine/presenters/missile_presenter.ts","webpack:///./src/engine/presenters/items_listing_presenter.ts","webpack:///./src/engine/presenters/talents_tree_presenter.ts","webpack:///./src/engine/presenters/profession_picking_presenter.ts","webpack:///./src/engine/utils/lee_path.ts","webpack:///./components/Logger.vue?93db","webpack:///./components/Logger.vue?dfa9","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?fdba","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./src/onisun/talents.ts","webpack:///./src/onisun/professions.ts","webpack:///./src/onisun/items.ts","webpack:///./src/onisun/potions.ts","webpack:///./src/onisun/creatures.ts","webpack:///./src/engine/ai/dispatcher.ts","webpack:///./src/onisun/tiles.ts","webpack:///./src/onisun/dungeons/tutorial_dungeon.ts","webpack:///./src/onisun.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/Scene.vue?a309","webpack:///./components/Scene.vue?972d","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?af94","webpack:///./components/PrimaryAttribute.vue?99e7","webpack:///./components/PrimaryAttribute.vue?fa93","webpack:///./components/PrimaryAttribute.vue","webpack:///./components/PrimaryAttribute.vue?bd9e","webpack:///./components/Stats.vue?2674","webpack:///./components/Stats.vue?772b","webpack:///./components/Stats.vue","webpack:///./components/Stats.vue?a336","webpack:///./components/Impacts.vue?11e4","webpack:///./components/Impacts.vue?fd8b","webpack:///./components/Impacts.vue","webpack:///./components/Impacts.vue?27df","webpack:///./components/views/IdleView.vue?bc3e","webpack:///./components/views/IdleView.vue?d3da","webpack:///./components/views/IdleView.vue","webpack:///./components/views/IdleView.vue?a410","webpack:///./components/views/ProfessionPickingView.vue?69ea","webpack:///./components/views/ProfessionPickingView.vue?b4ad","webpack:///./components/views/ProfessionPickingView.vue","webpack:///./components/views/ProfessionPickingView.vue?de9c","webpack:///./components/views/ItemsListingView.vue?4aeb","webpack:///./components/views/ItemsListingView.vue?a2d9","webpack:///./components/views/ItemsListingView.vue","webpack:///./components/views/ItemsListingView.vue?2d36","webpack:///./components/views/TalentsTreeView.vue?3b29","webpack:///./components/views/TalentsTreeView.vue?639b","webpack:///./components/views/TalentsTreeView.vue","webpack:///./components/views/TalentsTreeView.vue?5c94","webpack:///./components/views/InventoryView.vue?c09a","webpack:///./components/views/InventoryView.vue?0d4b","webpack:///./components/views/InventoryView.vue","webpack:///./components/views/InventoryView.vue?0bea","webpack:///./components/views/MissileView.vue?1488","webpack:///./components/views/MissileView.vue?2e63","webpack:///./components/views/MissileView.vue","webpack:///./components/views/MissileView.vue?e1ae","webpack:///./components/views/DeathView.vue?a86c","webpack:///./components/views/DeathView.vue?9ad1","webpack:///./components/views/DeathView.vue","webpack:///./components/views/DeathView.vue?0102","webpack:///./components/App.vue?a6a8","webpack:///./components/App.vue?c0b2","webpack:///./components/App.vue","webpack:///./components/App.vue?f1be","webpack:///./components/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Rect","[object Object]","x","y","w","h","this","succ","String","fromCharCode","charCodeAt","rand","max","Math","floor","random","twoDimArray","width","height","field","Array","Point","point","abs","dxy","map","add","Mapped","on","forEach","column","tile","cycle","list","dx","pop","unshift","bresenham","p0","p1","x0","x1","y0","y1","steps","delta","round","bresenhamInclusion","Direction","super","up","down","left","right","upLeft","upRight","downLeft","downRight","minUnsafe","elem","lodash","undefined","Stat","base","rate","extra","current","val","CapacityLimitStat","strength","constitution","strengthRatio","constitutionRatio","stressed","loadedStart","overloadedStart","flattenedStart","Fov","startx","starty","radius","solidChecker","markVisible","doubleRadius","isSolid","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","bunch_ItemsBunch","bunch","item","find","invItem","groupsWith","count","inventoryItem","inv","groupedItem","put","TileTypes","Clan","Ability","tile_Tile","kind","items","Floor","actor","creature","Wall","id","buildNew","clone","tileVisitor","onFloor","Corridor","tile_Room","Door","onDoor","onWall","Stairway","type","currentMap","adjacentMapId","StairwayDown","onStairwayDown","StairwayUp","onStairwayUp","Trap","revealed","onTrap","game","levelMap","affect","TileVisitor","wall","default","stairway","onStairway","door","trap","CreatureEvent","subject","affectCreature","after_event_AfterEvent","removeImpact","ImpactType","Overloaded","Stressed","Loaded","stuffWeight","carryingCapacity","die_event_DieEvent","DieReason","addImpact","Reaction","NOTHING","allAbilities","GoStairwayDown","Inventory","PutOn","Throwing","Specie","weight","clan","abilities","creature_VisibilityTileVisitor","stage","pos","visible","at","visit","visibleThrough","creature_Creature","characteristics","specie","getId","stageMemories","dead","inventory","inventory_Inventory","lastId","ability","event","speed","currentValue","stageMemory","resetVisible","memory_Memory","creaturePos","degree","see","calc","effect","impactsBunch","ImpactBunch","addConstImpact","removeConstImpact","impacts","activeImpacts","creature_Player","level","ai","professions","visionMask","command","act","affectPlayer","move_event_SteppingTileVisitor","activate","move_event_MoveEvent","nextPoint","nextLevel","removeCreature","addCreature","player","reset","enter","internal_AI","destination","move","eq","dest","buildPath","leePath","tangible","tileVisited","pointsToCheck","wavePoints","inRange","wrappers","dist","enemy","FreeForAll","Player","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","checkCurrentTile","goTo","onCantMove","moveTo","onReach","internal_GoToTileAI","matcher","path","attacker_Attacker","firstTurn","canAttack","victim","victimInAccess","attack_event_AttackEvent","pickNewVictim","findCreature","enemies","condition","memory","chaser_Chaser","victimSet","buildVictimPath","foundNewVictim","victimId","followTo","withinView","nextTo","AIEvent","logger","AIItemPickedEvent","cares","meta_ai_MetaAI","aiToRun","events","run","resetEvents","STEP_DISTANCE","escaper_Escaper","escapesFrom","foundEnemies","buildEscapePath","minDistance","explorer_Explorer","seen","picker_Picker","can","creatureTile","pushEvent","pick_up_items_event_PickUpItemsEvent","loiter_Loiter","NEW_POINT_EVERY","patrol_PatrolTileVisitor","status","patrol_Patrol","step","firstCallPatrol","graph","graphlib","lastNodeVisit","currentNodeID","markNodeVisited","nodes","addNode","moveToTarget","targetNodeID","pickUpNewTarget","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","thrower_Thrower","hasMissile","missile_attack_event_MissileAttackEvent","reaction","DIE","previousVictim","missiles","missileSlot","equipment","findWithId","obstacles","target","descender_StairwayDownFinderVisitor","match","descender_StairwayDownTileMoverVisitor","adjacentMap","getMap","enterPos","matchStairs","descender_Descender","visitor","stay_event_StayEvent","selfhealer_SelfHealer","health","atMax","PresenterType","Usage","ItemGroup","ItemSubgroup","DamageType","ProtectionType","Presenter","endTurn","presenter","redirect","death_presenter_DeathPresenter","dieReason","Death","playerName","player_ai_AINewLevelEvent","profession_picking_presenter_ProfessionPickingPresenter","talents_tree_presenter_TalentsTreePresenter","player_ai_AIDieEvent","player_ai_PlayerAI","levelUps","idle_presenter_IdlePresenter","runEvents","add_experience_event_AddExperienceEvent","attribute_Attribute","modifiers","maximum","modifier","min","increase","decrease","PositiveAttribute","AttributeSet","attack","defense","dexterity","pairSet","Modifier","items_Item","group","usages","canSeeDetails","addModifier","removeModifier","Corpse","Consumable","Potion","Missile","MissileWeapon","Shoot","Weapon","damages","usage","OneHandWeapon","WeaponOneHand","Armor","protections","BodyArmor","WearsOnBody","Boots","reason","addItem","slots","misses","missMessage","DODGE","damage","damageTo","killMessage","Attack","hurtMessage","HURT","drink_potion_event_DrinkPotionEvent","potion","removeFromBag","onDrink","drink","drop_items_event_DropItemsEvent","subtract","droppedItem","TileEffect","onDone","ItemFlightTileEffect","frames","done","patchMemory","throw_event_ThrowEvent","missile","throwMisses","throwMissMessage","THROW_DODGE","throwDamageTo","throwKillMessage","throwHurtMessage","slot","removeItem","flightPath","tileItems","withTileItems","putToBag","pickedUpItem","remove","put_on_item_event_PutOnItemEvent","equip","putOn","take_off_item_event_TakeOffItemEvent","takeOff","trap_event_TrapEvent","creatureSteppedInTrap","doDamage","youSteppedInTrap","addDoors","doorTile","addDoor","setTile","addCreatures","chance","creaturesPool","passibleThrough","pick","addItems","itemsPool","centralize","minX","minY","maxX","maxY","addOnTile","onValid","iters","drawn","drawMap","collection","charAt","THICKNESS","RAY_TURNS","DELTA_ANGLE","PI","dungeon_Room","rect","walls","newRoomSpace","dungeon_Road","lined","newCorridor","hx","hy","horizontalLine","vx","vy","verticalLine","generator_dungeon","dimX","dimY","minSize","maxSize","roomsCount","newWall","dungeon","rooms","fill","_","generateRoom","normalize","ray","roads","buildRoads","reduce","pickedRooms","currentRoom","angle","cos","sin","roomToMove","ndx","ndy","every","room","notCross","filter","points","pointWithin","firstPoint","connectedPoints","point1","point2","pow","maybePoint","currentPoint","pointToConnect","currentDistance","LogLevel","TalentStatus","IdleInputKey","impact_Impact","constEffects","tempEffects","turns","impact","Map","types","active","impactByType","addTempEffect","removeTempEffect","addConstEffect","removeConstEffect","turn","set","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","levelUp","pool_Pool","totalWeight","ceil","input","found","pool","totalPool","timeline_Timeline","ts","element","nextStep","next","actors","parseInt","characteristics_Characteristics","with","char","mod","dex","regenerationValue","constantIncrease","dungeon_Dungeon","levels","adjustMapId","addStairs","isFloor","level_map_LevelMap","creatures","timeline","each","adjustId","stairPos","logger_Logger","messages","debug","warning","addMessage","DEBUG","INFO","DANGER","message","WARNING","lastRow","counter","game_Game","professionPicker","running","maps","rebuildVision","levelMapTurn","Function","builtLevelMap","generator","actorId","inventory_slot_InventorySlot","useSingleItem","itemGroup","onTakeOff","groupItem","findInBag","onPutOn","baseMatch","worksWith","inventory_slot_RightHandSlot","inventory_slot_LeftHandSlot","inventory_slot_BodySlot","inventory_slot_BootsSlot","inventory_slot_MissileWeaponSlot","matchingItems","withPairItem","inventory_slot_MissileSlot","Throw","missileWeapon","missileWeaponSlot","bag","rightHandSlot","leftHandSlot","bodySlot","bootsSlot","MemoryTile","baseTile","Profession","talents","depthCost","profession_ProfessionPicker","maxLevel","maxTaken","pickedProfession","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","some","profession","excludeId","excluding","Talent","depth","rank","maxRank","description","inventory_presenter_InventoryPresenter","positions","takeTime","rebuildPositions","position","inventorySlot","items_listing_presenter_PutOnItemsPresenter","availableItems","missile_presenter_MissilePresenter","targetEnemyIndex","findEnemies","targetPos","resetTargetId","updateTarget","direction","resetPath","newPos","copy","drawPath","stop","idle_presenter_HandleTileVisitor","howToHandle","Idle","Right","Left","Down","Up","UpRight","UpLeft","DownRight","DownLeft","Handle","handle","PickUp","pickUpDialog","missileDialog","Drop","items_listing_presenter_DropItemsPresenter","Drink","items_listing_presenter_DrinkPresenter","Bag","BagPresenter","ranIntoAnObstacle","noItemsToPickUp","items_listing_presenter_PickUpPresenter","canThrow","needMissileWeapon","nothingToShotWith","items_listing_presenter_ItemsListingPresenter","ItemsListing","title","initPositions","onWithItem","singleItemMode","AbilitiesPicking","options","talent","assign","professionId","talentId","Available","Completed","Unavailable","ProfessionPicking","available","playerProfession","randomDestination","pointsToVisit","randomPointToVisit","buildRoad","lastPoint","chain","dp","components_Loggervue_type_script_lang_ts_","vue_runtime_esm","extend","props","computed","methods","record","component","componentNormalizer","_vm","_h","$createElement","_c","_self","staticClass","_l","class","rowClass","_v","_s","__file","components_Logger","unicodetiles_Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","appendChild","charMap","charArray","defaultColors","attribs","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","OnisunTalentId","OnisunProfessionId","talents_OnisunTalent","AttackerTwoHandedWeapons","professions_OnisunAttackerProfession","Attacker","professions_OnisunDefenderProfession","Defender","professions_OnisunProfessionPicker","attacker","defender","items_MissileRock","items_Sling","items_Arrow","items_Bow","noMod","commonBow","smallRock","woodenArrow","ironArrow","weapons","Melee","dice","times","Medium","Heavy","Unarmored","items_LightSpeedBoots","Blind","newCreature","escaper","explorer","chaser","picker","patrol","loiter","thrower","descender","regenerateEvery","regenerate","feelsGood","explore","healthCritical","trackMovement","rat","orc","undead","robot","creaturesPool1","OnisunTrapType","tiles_OnisunFireTrap","Fire","tiles_OnisunIceTrap","Ice","initId","config","simple","tutorial_dungeon_TutorialDungeon","addMap","addStairDown","generateMap","addStairUp","merge","onisun_Onisun","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","MISSILE_WEAPON","BOOTS","POTION","displayItem","console","error","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","NULL_TILE","FIRE_TRAP","ICE_TRAP","displayTileVisitor","HUMAN","RAT","Scenevue_type_script_lang_ts_NULL_TILE","nextItemAnimation","components_Scenevue_type_script_lang_ts_","wholeMap","term","eng","drawInterval","Date","now","interval","dTile","frame","animationFps","itemId","displayTile","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","duration","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","update","lighted","fovTile","initViewport","watch","Scene_component","ref","Scene","components_PrimaryAttributevue_type_script_lang_ts_","slug","attr","PrimaryAttribute_component","attrs","triggers","container","placement","fullName","PrimaryAttribute","components_Statsvue_type_script_lang_ts_","components","attribute","displayAttribute","Stats_component","levelProgress","role","healthLevel","full-name","Stats","components_Impactsvue_type_script_lang_ts_","Impacts_component","src","icon","domProps","textContent","Impacts","views_IdleViewvue_type_script_lang_ts_","inputKey","screen","onInput","close","IdleView_component","IdleView","views_ProfessionPickingViewvue_type_script_lang_ts_","picked","doubleClickOption","option","pickProfession","iconPath","ProfessionPickingView_component","click","$event","dblclick","variant","_e","ProfessionPickingView","views_ItemsListingViewvue_type_script_lang_ts_","page","perPage","selected","pickUpItems","index","selectAt","withItem","indexLetter","positionStatus","itemWeight","ItemsListingView_component","carryingWeight","positionSelected","ItemsListingView","views_TalentsTreeViewvue_type_script_lang_ts_","professionIndex","groups","availableIndex","letter","pickTalent","groupedTalents","tip","AttackerHeavyWeapons","AttackerLightWeapons","AttackerTwoWeapons","AttackerDoubleTwoHandedWeapons","AttackerStrongGrip","TalentsTreeView_component","card","model","callback","$$v","expression","no-body","talentStatus","talentTip","TalentsTreeView","views_InventoryViewvue_type_script_lang_ts_","showDamage","join","showProtection","showDamageType","damageType","Pierce","Blunt","Magic","Pure","Light","Solid","displayBodyPart","bodyPart","getChar","itemName","InventoryView_component","availableStatus","positionDetails","InventoryView","views_MissileViewvue_type_script_lang_ts_","moveTarget","nextTarget","previousTarget","MissileView_component","MissileView","views_DeathViewvue_type_script_lang_ts_","DeathView_component","signature","DeathView","components_Appvue_type_script_lang_ts_","initPlayer","register","prof","dagger","katana","plateArmor","wooden","iron","rock","bow","loopIntervalId","Logger","viewComponent","onEvent","main","loop","addEventListener","removeEventListener","App_component","level-map","tag","App","use","es","el"],"mappings":"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","file":"main.a2e3c840.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([27,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=e78aa69c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=e78aa69c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=b8b31b14&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=b8b31b14&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","import { min } from 'lodash'\n\nexport class Rect {\n  // TODO: Validate?\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {}\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\n// TODO: Remove this\nexport const succ = function(c: string): string {\n  return String.fromCharCode(c.charCodeAt(0) + 1)\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\nexport const twoDimArray = function<T>(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => T\n): T[][] {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x: number, y: number): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (tile: T, x: number, y: number) => any): void {\n    this.map.forEach((column, x) => {\n      column.forEach((tile, y) => {\n        on(tile, x, y)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n\nexport const bresenhamInclusion = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  bresenham(p0, p1, on)\n  on(p1.x, p1.y)\n}\n\nexport class Direction extends Point {\n  private constructor(x: number, y: number) {\n    super(x, y)\n  }\n\n  static readonly up = new Direction(0, -1)\n  static readonly down = new Direction(0, 1)\n  static readonly left = new Direction(-1, 0)\n  static readonly right = new Direction(1, 0)\n\n  static readonly upLeft = new Direction(-1, -1)\n  static readonly upRight = new Direction(1, -1)\n  static readonly downLeft = new Direction(-1, 1)\n  static readonly downRight = new Direction(1, 1)\n}\n\nexport const minUnsafe = function<T>(list: T[]): T {\n  const elem = min(list)\n  if (elem !== undefined) {\n    return elem\n  }\n\n  throw 'minUnsafe got empty array'\n}\n","export class Stat {\n  constructor(\n    public base: number,\n    public rate: number = 1,\n    public extra: number = 0\n  ) {}\n\n  get current(): number {\n    return this.base * this.rate - this.extra\n  }\n\n  public add(val: number): void {\n    this.base += val\n  }\n\n  public subtract(val: number): void {\n    this.base -= val\n  }\n}\n\nexport class CapacityLimitStat {\n  private strengthRatio: number = 5\n  private constitutionRatio: number = 3\n  private base: number = 10\n\n  constructor(private strength: number, private constitution: number) {}\n\n  public recalculate(strength: number, constitution: number) {\n    this.strength = strength\n    this.constitution = constitution\n  }\n\n  get stressed(): number {\n    return (\n      this.base +\n      this.strength * this.strengthRatio +\n      this.constitution * this.constitutionRatio\n    )\n  }\n\n  get loadedStart(): number {\n    return this.stressed * 1.5\n  }\n\n  get overloadedStart(): number {\n    return this.loadedStart * 2\n  }\n\n  get flattenedStart(): number {\n    return this.overloadedStart * 3\n  }\n}\n","interface SolidChecker {\n  isSolid(x: number, y: number): boolean\n}\n\nexport class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private solidChecker: SolidChecker,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.solidChecker.isSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.solidChecker.isSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (\n            this.solidChecker.isSolid(currentX, currentY) &&\n            distance < this.radius\n          ) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { remove } from 'lodash'\n\ninterface Grouping {\n  groupsWith(item: Grouping): boolean\n}\n\nexport interface GroupedItem<Item> {\n  count: number\n  item: Item\n}\n\nexport class ItemsBunch<Item extends Grouping> {\n  public bunch: GroupedItem<Item>[] = []\n\n  public find(item: Item): GroupedItem<Item> | undefined {\n    return this.bunch.find(invItem => invItem.item.groupsWith(item))\n  }\n\n  public remove(item: Item, count: number): void {\n    const invItem = this.find(item)\n\n    if (invItem === undefined) {\n      // TODO: Fail if removes item that's not in bunch yet?\n      return\n    } else if (invItem.count === count) {\n      remove(this.bunch, inventoryItem =>\n        inventoryItem.item.groupsWith(invItem.item)\n      )\n    } else {\n      invItem.count -= count\n    }\n  }\n\n  public put(item: Item, count: number): void {\n    const invItem = this.bunch.find(inv => inv.item.groupsWith(item))\n\n    if (invItem) {\n      invItem.count += count\n    } else {\n      this.bunch.push({ count: count, item: item })\n    }\n  }\n\n  public clone(): ItemsBunch<Item> {\n    let bunch = new ItemsBunch<Item>()\n\n    this.bunch.forEach(groupedItem => {\n      bunch.put(groupedItem.item, groupedItem.count)\n    })\n\n    return bunch\n  }\n}\n","import { Creature } from './creature'\nimport { Point } from '../utils/utils'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { Item } from './items'\nimport { Game } from './game'\nimport { ItemsBunch } from '../lib/bunch'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n  Trap,\n}\n\nexport abstract class Tile {\n  public creature?: Creature\n  public items: ItemsBunch<Item> | undefined\n\n  constructor(public key: string, public kind: TileTypes) {}\n\n  public addItem(item: Item, count: number): void {\n    if (!this.items) {\n      this.items = new ItemsBunch()\n    }\n\n    this.items.put(item, count)\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public abstract visit(tileVisitor: TileVisitor): void\n\n  public clone(): Tile {\n    let tile = this.buildNew()\n\n    if (this.creature) {\n      tile.creature = this.creature\n    }\n    tile.items = this.items && this.items.clone()\n    return tile\n  }\n\n  protected abstract buildNew(): Tile\n}\n\nexport class Floor extends Tile {\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onFloor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Floor(this.key, this.kind)\n  }\n}\n\nexport class Corridor extends Floor {}\n\nexport class Room extends Floor {\n  constructor() {\n    super('R', TileTypes.Floor)\n  }\n}\n\nexport class Door extends Tile {\n  constructor() {\n    super('D', TileTypes.Door)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onDoor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Door()\n  }\n}\n\nexport class Wall extends Tile {\n  constructor() {\n    super('W', TileTypes.Wall)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onWall(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Wall()\n  }\n}\n\nexport abstract class Stairway extends Tile {\n  public enterPos: Point | undefined\n\n  constructor(\n    key: string,\n    type: TileTypes,\n    public currentMap: LevelMap,\n    public adjacentMapId: LevelMapId\n  ) {\n    super(key, type)\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapId: LevelMapId) {\n    super('>', TileTypes.StairwayDown, currentMap, adjacentMapId)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayDown(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayDown(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapId: LevelMapId) {\n    super('<', TileTypes.StairwayUp, currentMap, adjacentMapId)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayUp(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayUp(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport abstract class Trap extends Tile {\n  constructor(public revealed: boolean = false, public readonly type: number) {\n    super('^', TileTypes.Trap)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrap(this)\n  }\n\n  public activate(game: Game, levelMap: LevelMap, actor: Creature): void {\n    this.affect(game, levelMap, actor)\n  }\n\n  protected abstract affect(\n    game: Game,\n    levelMap: LevelMap,\n    actor: Creature\n  ): void\n}\n\n// TODO: Add return type?\nexport abstract class TileVisitor {\n  public onWall(wall: Wall): void {\n    this.default(wall)\n  }\n\n  public onFloor(floor: Floor): void {\n    this.default(floor)\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.onStairway(stairway)\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.onStairway(stairway)\n  }\n\n  public onDoor(door: Door): void {\n    this.default(door)\n  }\n\n  public onTrap(trap: Trap): void {\n    this.default(trap)\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    this.default(stairway)\n  }\n\n  protected default(tile: Tile): void {}\n}\n","import { includes } from 'lodash'\nimport {\n  Characteristics,\n  Game,\n  ImpactBunch,\n  Inventory,\n  LevelMap,\n  Memory,\n  PlayerAI,\n} from '../../engine'\nimport { CreatureEvent } from '../events/internal'\nimport { ImpactType } from '../lib/impact'\nimport { Level } from '../lib/level'\nimport { CapacityLimitStat, Stat } from '../lib/stat'\nimport { Fov } from '../utils/fov'\nimport { Point } from '../utils/utils'\nimport { Profession } from './profession'\nimport { Door, Tile, TileVisitor } from './tile'\nimport { AfterEvent } from '../events/after_event'\nimport { MetaAI } from '../ai/meta_ai'\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairwayDown,\n  Inventory,\n  PutOn,\n  Throwing,\n}\n\nexport const allAbilities = [\n  Ability.GoStairwayDown,\n  Ability.Inventory,\n  Ability.PutOn,\n  Ability.Throwing,\n]\n\nexport class Specie {\n  constructor(\n    public readonly name: string,\n    public readonly weight: number,\n    public readonly clan: Clan,\n    public readonly abilities: Ability[]\n  ) {}\n}\n\nexport type CreatureId = number\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  THROW_DODGE,\n  NOTHING,\n}\n\nclass VisibilityTileVisitor extends TileVisitor {\n  public visible: boolean = false\n  private x: number | undefined\n  private y: number | undefined\n\n  constructor(private stage: LevelMap, private pos: Point) {\n    super()\n  }\n\n  public isSolid(x: number, y: number): boolean {\n    this.x = x\n    this.y = y\n    this.stage.at(x, y).visit(this)\n    return !this.visible\n  }\n\n  public onDoor(door: Door) {\n    this.visible = this.pos.x === this.x && this.pos.y === this.y\n  }\n\n  protected default(tile: Tile) {\n    if (this.x && this.y) {\n      this.visible = this.stage.visibleThrough(this.x, this.y)\n    }\n  }\n}\n\nexport abstract class Creature {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  protected stageMemories: { [key: string]: Memory } = {}\n  public inventory: Inventory\n\n  public dead: boolean = false\n\n  private impactsBunch: ImpactBunch | undefined\n\n  public stuffWeight: Stat\n  public carryingCapacity: CapacityLimitStat\n\n  constructor(\n    public characteristics: Characteristics,\n    public specie: Specie,\n    public id: CreatureId = Creature.getId()\n  ) {\n    this.inventory = new Inventory()\n\n    this.stuffWeight = new Stat(0)\n    this.carryingCapacity = new CapacityLimitStat(1, 4)\n  }\n\n  get name(): string {\n    return this.specie.name\n  }\n\n  get clan(): Clan {\n    return this.specie.clan\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectCreature(this)\n  }\n\n  public speed(): number {\n    return this.characteristics.speed.currentValue\n  }\n\n  public radius(): number {\n    return this.characteristics.radius.currentValue\n  }\n\n  public stageMemory(levelMap: LevelMap): Memory {\n    return this.stageMemories[levelMap.id]\n  }\n\n  public abstract act(levelMap: LevelMap, game: Game): void\n\n  public visionMask(stage: LevelMap): void {\n    if (!this.stageMemories[stage.id]) {\n      this.stageMemories[stage.id] = new Memory(stage.width, stage.height)\n    } else {\n      this.stageMemory(stage).resetVisible()\n    }\n\n    const see = (x: number, y: number, degree: number): void => {\n      this.stageMemory(stage)\n        .at(x, y)\n        .see(stage.at(x, y), degree)\n    }\n\n    const pos = stage.creaturePos(this)\n\n    new Fov(\n      pos.x,\n      pos.y,\n      this.radius(),\n      stage.width,\n      stage.height,\n      new VisibilityTileVisitor(stage, pos),\n      see\n    ).calc()\n  }\n\n  public addImpact(type: ImpactType, effect: string): void {\n    if (!this.impactsBunch) {\n      this.impactsBunch = new ImpactBunch()\n    }\n\n    this.impactsBunch.addConstImpact(type, effect)\n  }\n\n  public removeImpact(type: ImpactType, effect: string): void {\n    // TODO: Should never get here\n    if (!this.impactsBunch) {\n      this.impactsBunch = new ImpactBunch()\n    }\n\n    this.impactsBunch.removeConstImpact(type, effect)\n  }\n\n  get impacts(): ImpactType[] {\n    if (this.impactsBunch) {\n      return this.impactsBunch.activeImpacts\n    }\n\n    return []\n  }\n}\n\nexport class AICreature extends Creature {\n  constructor(\n    characteristics: Characteristics,\n    public ai: MetaAI,\n    specie: Specie,\n    id: CreatureId = Creature.getId()\n  ) {\n    super(characteristics, specie, id)\n  }\n\n  public act(levelMap: LevelMap, game: Game): void {\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n\n    this.on(new AfterEvent(levelMap, game))\n  }\n}\n\nexport class Player extends Creature {\n  public professions: Profession[] = []\n\n  constructor(\n    public level: Level,\n    characteristics: Characteristics,\n    public ai: PlayerAI,\n    specie: Specie\n  ) {\n    super(characteristics, specie)\n  }\n\n  public act(levelMap: LevelMap, game: Game): void {\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n\n    this.on(new AfterEvent(levelMap, game))\n  }\n\n  public rebuildVision(levelMap: LevelMap): void {\n    this.visionMask(levelMap)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectPlayer(this)\n  }\n}\n","import { Creature, Reaction, Player } from '../models/creature'\n\nexport abstract class CreatureEvent {\n  public abstract affectCreature(subject: Creature): Reaction\n  public affectPlayer(subject: Player): Reaction {\n    return this.affectCreature(subject)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Reaction, Creature } from '../models/creature'\nimport { LevelMap, Game, ImpactType, DieEvent, DieReason } from '../../engine'\n\nexport class AfterEvent extends CreatureEvent {\n  constructor(private levelMap: LevelMap, private game: Game) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    creature.removeImpact(ImpactType.Overloaded, 'bag')\n    creature.removeImpact(ImpactType.Stressed, 'bag')\n    creature.removeImpact(ImpactType.Loaded, 'bag')\n\n    if (\n      creature.stuffWeight.current > creature.carryingCapacity.flattenedStart\n    ) {\n      return creature.on(\n        new DieEvent(this.game, this.levelMap, DieReason.Overloaded)\n      )\n    }\n\n    if (\n      creature.stuffWeight.current > creature.carryingCapacity.overloadedStart\n    ) {\n      creature.addImpact(ImpactType.Overloaded, 'bag')\n    } else if (\n      creature.stuffWeight.current > creature.carryingCapacity.loadedStart\n    ) {\n      creature.addImpact(ImpactType.Loaded, 'bag')\n    } else if (\n      creature.stuffWeight.current > creature.carryingCapacity.stressed\n    ) {\n      creature.addImpact(ImpactType.Stressed, 'bag')\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { TileVisitor } from '../models/tile'\nimport { Creature, Game, Trap, Point, Reaction } from '../../engine'\nimport { Player } from '../models/creature'\n\nclass SteppingTileVisitor extends TileVisitor {\n  constructor(\n    private creature: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public onTrap(trap: Trap): void {\n    trap.activate(this.game, this.levelMap, this.creature)\n  }\n}\n\nexport class MoveEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private nextPoint: Point,\n    private nextLevel: LevelMap | undefined = undefined\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const pos = this.levelMap.creaturePos(actor)\n\n    if (this.nextLevel && this.nextLevel.id !== this.levelMap.id) {\n      this.levelMap.removeCreature(actor)\n      this.nextLevel.addCreature(this.nextPoint, actor)\n    } else {\n      this.levelMap.at(pos.x, pos.y).creature = undefined\n      this.levelMap.at(this.nextPoint.x, this.nextPoint.y).creature = actor\n    }\n\n    ;(this.nextLevel || this.levelMap)\n      .at(this.nextPoint.x, this.nextPoint.y)\n      .visit(new SteppingTileVisitor(actor, this.levelMap, this.game))\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (this.nextLevel && this.levelMap.id !== this.nextLevel.id) {\n      this.levelMap.reset()\n      this.nextLevel.enter()\n\n      this.affectCreature(player)\n\n      this.game.currentMap = this.nextLevel\n    } else {\n      this.affectCreature(player)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { Point, twoDimArray } from '../utils/utils'\nimport { Creature, Clan } from '../models/creature'\n\nimport { MemoryTile, Memory } from '../models/memory'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { LevelMap, CreatureEvent, leePath } from '../../engine'\n\nexport abstract class AI {\n  public abstract act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined\n\n  protected moveTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.eq(point))\n  }\n\n  protected move(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): CreatureEvent | undefined {\n    const [point] = this.buildPath(actor, levelMap, dest)\n\n    if (point) {\n      return new MoveEvent(game, levelMap, point)\n    }\n  }\n\n  protected buildPath(\n    actor: Creature,\n    levelMap: LevelMap,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): Point[] {\n    return leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      dest\n    )\n  }\n\n  protected withinView(\n    map: Memory,\n    pos: Point,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Point[] = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Creature, enemy: Creature): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan === Clan.FreeForAll || enemy.clan === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan === Clan.Player && enemy.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan === Clan.Player && actor.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination?: Point = undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.foundNewTarget(actor, levelMap) || !this.destination) {\n      return this.checkCurrentTile(actor, levelMap, game)\n    }\n\n    const event = this.goTo(actor, levelMap, game, this.destination)\n    if (event) {\n      return event\n    }\n\n    this.destination = undefined\n    this.onCantMove(actor)\n\n    return\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    point: Point\n  ): CreatureEvent | undefined {\n    return this.moveTo(actor, point, levelMap, game)\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (this.destination && levelMap.creaturePos(actor).eq(this.destination)) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected abstract foundNewTarget(\n    actor: Creature,\n    levelMap: LevelMap\n  ): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return\n  }\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(protected matcher: (tile: MemoryTile) => boolean) {\n    super()\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event = super.checkCurrentTile(actor, levelMap, game)\n\n    if (event) {\n      return event\n    }\n\n    const pos = levelMap.creaturePos(actor)\n    if (this.matcher(actor.stageMemory(levelMap).at(pos.x, pos.y))) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    const path = leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      (point, tile) => this.matcher(tile),\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { AttackEvent, Game } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (!this.canAttack(actor, levelMap)) {\n      return\n    }\n\n    if (this.victim && this.victimInAccess(actor, levelMap, this.victim)) {\n      return new AttackEvent(this.victim, levelMap, game)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor, levelMap)\n      return this.act(actor, levelMap, game, false)\n    }\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap): boolean {\n    const creature = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(\n    actor: Creature,\n    levelMap: LevelMap,\n    victim: Creature | undefined\n  ): boolean {\n    if (victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      levelMap,\n      (creature: Creature) => creature.id === victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature, levelMap: LevelMap) {\n    this.victim = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): Creature | undefined {\n    const memory = actor.stageMemory(levelMap)\n\n    return levelMap\n      .creaturePos(actor)\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature)\n      .find(\n        (creature: Creature | undefined) =>\n          creature ? condition(creature) : false\n      )\n  }\n}\n","import { Creature, CreatureId } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point } from '../utils/utils'\nimport { FollowTargetAI } from './internal'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor, levelMap)) ||\n      this.foundNewVictim(actor, levelMap)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): CreatureEvent | undefined {\n    this.victimId = undefined\n    return\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.destination) {\n      throw 'Chaser.goTo: no destination'\n    }\n    return this.followTo(actor, this.destination, levelMap, game)\n  }\n\n  private buildVictimPath(actor: Creature, levelMap: LevelMap): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => creature.id === this.victimId\n    )\n  }\n\n  private foundNewVictim(actor: Creature, levelMap: LevelMap): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, levelMap, creature =>\n        this.enemies(actor, creature)\n      ) && this.buildVictimPath(actor, levelMap)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      ({ x, y }, tile) => {\n        const creature = tile.creature\n\n        if (!result && creature && condition(creature)) {\n          this.destination = new Point(x, y)\n          this.victimId = creature.id\n          result = true\n        }\n      }\n    )\n\n    return result\n  }\n\n  protected followTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.nextTo(point))\n  }\n}\n","import { AI } from './internal'\nimport { Player } from '../models/creature'\nimport { Logger } from '../models/logger'\nimport { Game, ItemsBunch, Item } from '../../engine'\n\nexport abstract class AIEvent {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract run(): void\n  public abstract immediate(): boolean\n}\n\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: ItemsBunch<Item>, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    this.player.inventory.cares().forEach(item => {\n      // const wearing = this.whereToWear(item.item)\n      // if (wearing) {\n      //   // TODO: Use matching slot\n      //   new AIPutOnItem(wearing.inventorySlot, item.item, this.game).run()\n      // }\n    })\n  }\n\n  public immediate(): boolean {\n    return false\n  }\n\n  // private whereToWear(item: Item): Wearing {\n  //   const matches: Wearing[] = compact(\n  //     flatten(\n  //       item.usages.map(usage =>\n  //         this.player.inventory.slots().filter(wearing => includes(wearing.inventorySlot.usages, usage))\n  //       )\n  //     ).map(wearing => this.player.inventory.matchingEquip(wearing.inventorySlot))\n  //   )\n\n  //   if (matches.length === 0) {\n  //     return null\n  //   }\n\n  //   const weightModifier = new Modifier({\n  //     attack: 1,\n  //     defense: 1,\n  //     health: 1,\n  //     radius: 0.5,\n  //     speed: 1,\n  //   })\n\n  //   const { wearing } = matches.reduce(\n  //     (acc, wearing) => {\n  //       let weight = 0\n\n  //       if (wearing.equipment) {\n  //         item.modifier.withWeight(\n  //           wearing.equipment.item.modifier,\n  //           weightModifier,\n  //           (f, s, w) => (weight += w * (f - s))\n  //         )\n  //       } else {\n  //         item.modifier.with(weightModifier, (f, w) => (weight += f * w))\n  //       }\n\n  //       if (acc.weight > weight) {\n  //         return acc\n  //       } else {\n  //         return { weight, wearing }\n  //       }\n  //     },\n  //     { weight: 0, wearing: null }\n  //   )\n\n  //   return wearing\n  // }\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI | undefined = undefined) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n\n  public runEvents(): void {\n    this.events.forEach(event => {\n      event.run()\n    })\n\n    this.resetEvents()\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Point, LevelMap } from '../../engine'\n\nimport { sumBy } from 'lodash'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Creature][] = []\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    return (\n      this.foundEnemies(actor, levelMap) &&\n      this.buildEscapePath(actor, levelMap)\n    )\n  }\n\n  private buildEscapePath(\n    actor: Creature,\n    levelMap: LevelMap,\n    minDistance: number = actor.radius() / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.buildPath(actor, levelMap, ({ x, y }) => {\n      const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n        // I don't use pathfinding since it should try\n        // to run away from those who are visible, so the path\n        // to them should be straightforward.\n        return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n      })\n\n      return score >= minDistance\n    })\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildEscapePath(actor, levelMap, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature, levelMap: LevelMap): boolean {\n    this.escapesFrom = []\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      (point, tile) => {\n        const creature = tile.creature\n\n        if (creature && this.enemies(actor, creature)) {\n          this.escapesFrom.push([point, creature])\n        }\n      }\n    )\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from './internal'\n\nexport class Explorer extends GoToTileAI {\n  constructor() {\n    super(tile => !tile.seen)\n  }\n}\n","import { PickUpItemsEvent, LevelMap } from '../../engine'\nimport { Ability, Creature, AICreature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { GoToTileAI } from './internal'\nimport { AIItemPickedEvent } from './meta_ai'\nimport { CreatureEvent } from '../events/internal'\nimport { MemoryTile } from '../models/memory'\n\nexport class Picker extends GoToTileAI {\n  constructor() {\n    super((tile: MemoryTile) => !!tile.items)\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.Inventory)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: AICreature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const tile = levelMap.creatureTile(actor)\n\n    if (!tile.items) {\n      throw 'Picker.act : nothing to pick up'\n    }\n\n    actor.ai.pushEvent(new AIItemPickedEvent(tile.items, game))\n\n    return new PickUpItemsEvent(tile, tile.items.bunch, game)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point, LevelMap } from '../../engine'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Loiter extends AI {\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const pos = levelMap.creaturePos(actor)\n\n    return this.move(actor, levelMap, game, (point: Point) => !pos.eq(point))\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, succ } from '../utils/utils'\nimport { Creature } from '../models/creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { TileVisitor, Tile } from '../models/tile'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nclass PatrolTileVisitor extends TileVisitor {\n  public status: boolean = false\n\n  constructor(private tile: Tile) {\n    super()\n  }\n\n  public addNode(): boolean {\n    this.status = false\n    this.tile.visit(this)\n    return this.status\n  }\n\n  public onDoor() {\n    this.status = true\n  }\n}\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID | undefined\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n  private firstCallPatrol: boolean = true\n\n  constructor() {\n    super()\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.currentNodeID = 'a' // TODO: Check it, was undefined\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (this.graph.nodes().length <= 1) {\n      return\n    }\n\n    if (this.firstCallPatrol) {\n      const pos = levelMap.creaturePos(actor)\n      this.addNode(pos)\n      this.firstCallPatrol = false\n    }\n\n    this.step += 1\n\n    if (this.path.length) {\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor, levelMap)\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    }\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(pos: Point, tile: Tile): void {\n    if (this.step >= NEW_POINT_EVERY || new PatrolTileVisitor(tile).addNode()) {\n      this.addNode(pos)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(point: Point): void {\n    this.graph.setNode(this.i, point)\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.i = succ(this.i)\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature, levelMap: LevelMap): void {\n    // TODO: Remove this\n    if (!this.targetNodeID) {\n      throw 'Patrol has no next targetID'\n    }\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.buildPath(actor, levelMap, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature, levelMap: LevelMap): void {\n    let seenLastID: NodeID = this.graph.nodes()[0],\n      seenLastStep: number = this.lastNodeVisit[seenLastID],\n      nodes = this.graph.neighbors(this.currentNodeID)\n\n    if (nodes) {\n      nodes.forEach((nodeID: NodeID) => {\n        if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n          seenLastID = nodeID\n          seenLastStep = this.lastNodeVisit[seenLastID]\n        }\n      })\n    }\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor, levelMap)\n  }\n\n  private moveToTarget(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean\n  ): CreatureEvent | undefined {\n    const nextPoint: Point | undefined = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        return this.act(actor, levelMap, game, false)\n      } else {\n        return new Loiter().act(actor, levelMap, game)\n      }\n    } else if (\n      actor\n        .stageMemory(levelMap)\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath(actor, levelMap)\n\n      if (this.path.length) {\n        return this.act(actor, levelMap, game, false)\n      }\n    } else {\n      return new MoveEvent(game, levelMap, nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability, Reaction, CreatureId } from '../models/creature'\nimport { Point, bresenham } from '../utils/utils'\nimport { MissileAttackEvent, GroupedItem } from '../../engine'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Memory } from '../models/memory'\nimport { CreatureEvent } from '../events/internal'\nimport { Item } from '../models/items'\n\nexport class Thrower extends AI {\n  public victim: Creature | undefined\n  public previousVictim: Creature | undefined\n  public missiles: GroupedItem<Item> | undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (\n      !actor.can(Ability.Throwing) ||\n      !this.hasMissile(actor) ||\n      !this.canAttack(actor, levelMap, game)\n    ) {\n      return\n    }\n\n    let path: Point[] = []\n\n    if (!this.victim) {\n      throw 'Thrower.act called when there is no victim'\n    }\n\n    bresenham(\n      levelMap.creaturePos(actor),\n      levelMap.creaturePos(this.victim),\n      (x, y) => path.push(new Point(x, y))\n    )\n\n    return new MissileAttackEvent(\n      path,\n      game,\n      levelMap,\n      (reaction: Reaction) => {\n        if (reaction === Reaction.DIE) {\n          this.victim = undefined\n          this.previousVictim = undefined\n        }\n      }\n    )\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.inventory.missileSlot.equipment\n    return this.missiles !== undefined\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap, game: Game): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (this.findWithId(actor, levelMap, this.previousVictim.id)) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findWithId(\n    actor: Creature,\n    levelMap: LevelMap,\n    victimId: CreatureId\n  ): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => victimId === creature.id\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    const memory = actor.stageMemory(levelMap),\n      pos = levelMap.creaturePos(actor)\n\n    this.withinView(memory, levelMap.creaturePos(actor), (point, tile) => {\n      const creature = tile.creature\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, pos, memory, point)\n      ) {\n        this.victim = levelMap.at(point.x, point.y).creature\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(\n    actor: Creature,\n    pos: Point,\n    memory: Memory,\n    target: Point\n  ): boolean {\n    let obstacles = false\n\n    bresenham(pos, target, (x, y) => {\n      obstacles = obstacles || memory.at(x, y).tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import {\n  Ability,\n  Creature,\n  Game,\n  StairwayDown,\n  MoveEvent,\n  LevelMap,\n} from '../../engine'\nimport { CreatureEvent } from '../events/internal'\nimport { TileVisitor } from '../models/tile'\nimport { GoToTileAI } from './internal'\n\nclass StairwayDownFinderVisitor extends TileVisitor {\n  public match = false\n\n  public onStairwayDown(): void {\n    this.match = true\n  }\n}\n\nclass StairwayDownTileMoverVisitor extends TileVisitor {\n  public event: CreatureEvent | undefined\n\n  constructor(\n    private actor: Creature,\n    private game: Game,\n    private levelMap: LevelMap\n  ) {\n    super()\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    // TODO: Do not do this if already connected\n    const adjacentMap = this.game.getMap(stairway.adjacentMapId)\n    stairway.enterPos = adjacentMap.matchStairs(\n      this.levelMap.id,\n      this.levelMap.creaturePos(this.actor)\n    )\n\n    this.event = new MoveEvent(\n      this.game,\n      this.levelMap,\n      stairway.enterPos,\n      adjacentMap\n    )\n  }\n}\n\nexport class Descender extends GoToTileAI {\n  constructor() {\n    super(tile => {\n      const visitor = new StairwayDownFinderVisitor()\n      tile.visit(visitor)\n      return visitor.match\n    })\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.GoStairwayDown)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    // Should stay here at least for a turn\n    const visitor = new StairwayDownTileMoverVisitor(actor, game, levelMap),\n      tile = levelMap.creatureTile(actor)\n\n    tile.visit(visitor)\n    return visitor.event\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Reaction, Creature } from '../models/creature'\n\nexport class StayEvent extends CreatureEvent {\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n}\n","import { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { Game } from '../models/game'\nimport { StayEvent } from '../events/stay_event'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class SelfHealer extends AI {\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.characteristics.health.atMax) {\n      return\n    }\n\n    return new StayEvent()\n  }\n}\n","import { Player } from '../models/creature'\nimport { LevelMap } from '../models/level_map'\nimport { Tile } from '../models/tile'\nimport { Game } from '../../engine'\n\nexport enum PresenterType {\n  AbilitiesPicking,\n  Death,\n  Idle,\n  Inventory,\n  ItemsListing,\n  Missile,\n  ProfessionPicking,\n}\n\nexport abstract class Presenter {\n  public player: Player\n\n  constructor(\n    public readonly type: PresenterType,\n    protected levelMap: LevelMap,\n    protected game: Game\n  ) {\n    this.player = this.game.player\n  }\n\n  public build() {}\n\n  get tile(): Tile {\n    return this.levelMap.creatureTile(this.player)\n  }\n\n  protected endTurn(): void {\n    this.game.player.ai.endTurn()\n  }\n\n  protected redirect(presenter: Presenter): void {\n    this.game.player.ai.redirect(presenter)\n  }\n}\n","import { Specie, Creature, Player } from './creature'\n\nimport { Game } from './game'\nimport { Modifier } from '../lib/attribute'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnBody,\n  Throw,\n  Shoot,\n  Boots,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n  Potion,\n  MissileWeapon,\n  Boots,\n}\n\nexport enum ItemSubgroup {\n  MissileRock,\n  Sling,\n\n  Bow,\n  Arrows,\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public weight: number,\n    public readonly usages: Usage[] = [],\n    public readonly modifier: Modifier = new Modifier({}),\n    public id: ItemId = Item.getId()\n  ) {}\n\n  get canSeeDetails(): boolean {\n    return true\n  }\n\n  public clone(): Item {\n    return new Item(this.group, this.name, this.weight)\n  }\n\n  public onPutOn(creature: Creature): void {\n    creature.characteristics.addModifier(this.modifier)\n  }\n\n  public onTakeOff(creature: Creature): void {\n    creature.characteristics.removeModifier(this.modifier)\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.name === item.name\n  }\n\n  public worksWith(item: Item): boolean {\n    return false\n  }\n\n  public canThrow(player: Player): boolean {\n    return true\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: Specie) {\n    super(ItemGroup.Consumable, `${specie.name}'s corpse`, specie.weight)\n  }\n}\n\nexport abstract class Potion extends Item {\n  constructor(public name: string) {\n    super(ItemGroup.Potion, name, 0.2)\n  }\n\n  abstract onDrink(game: Game): void\n}\n\nexport abstract class Missile extends Item {\n  constructor(name: string, weight: number, modifier: Modifier) {\n    super(ItemGroup.Missile, name, weight, [], modifier)\n  }\n}\n\nexport abstract class MissileWeapon extends Item {\n  constructor(name: string, weight: number, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, weight, [Usage.Shoot], modifier)\n  }\n}\n\nexport enum DamageType {\n  Melee,\n  Pierce,\n  Blunt,\n  Magic,\n  Pure,\n}\n\nexport type Dice = {\n  times: number\n  max: number\n}\n\nexport type Damage = {\n  extra: number\n  dice: Dice\n  type: DamageType\n}\n\nexport abstract class Weapon extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    public readonly damages: Damage[],\n    usage: Usage\n  ) {\n    super(group, name, weight, [usage])\n  }\n}\n\nexport class OneHandWeapon extends Weapon {\n  constructor(name: string, weight: number, damages: Damage[]) {\n    super(ItemGroup.OneHandWeapon, name, weight, damages, Usage.WeaponOneHand)\n  }\n}\n\nexport enum ProtectionType {\n  Light,\n  Medium,\n  Heavy,\n  Solid,\n  Unarmored,\n}\n\nexport type Protection = {\n  type: ProtectionType\n  value: number\n}\n\nexport abstract class Armor extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    public readonly protections: Protection[],\n    usage: Usage\n  ) {\n    super(group, name, weight, [usage])\n  }\n}\n\nexport class BodyArmor extends Armor {\n  constructor(name: string, weight: number, protections: Protection[]) {\n    super(ItemGroup.BodyArmor, name, weight, protections, Usage.WearsOnBody)\n  }\n}\n\nexport class Boots extends Armor {\n  constructor(name: string, weight: number, protections: Protection[]) {\n    super(ItemGroup.Boots, name, weight, protections, Usage.Boots)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction, Player } from '../models/creature'\nimport { Corpse } from '../models/items'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { AIDieEvent } from '../ai/player_ai'\n\nexport enum DieReason {\n  Attack,\n  Missile,\n  Trap,\n  Overloaded,\n}\n\nexport class DieEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private reason: DieReason\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    let tile = this.levelMap.creatureTile(creature)\n\n    this.levelMap.removeCreature(creature)\n    creature.dead = true\n\n    tile.addItem(new Corpse(creature.specie), 1)\n\n    creature.inventory.slots().forEach(({ equipment }) => {\n      if (equipment) {\n        tile.addItem(equipment.item, equipment.count)\n      }\n    })\n\n    creature.inventory.cares().forEach(invItem => {\n      tile.addItem(invItem.item, invItem.count)\n    })\n\n    return Reaction.DIE\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    player.ai.pushEvent(new AIDieEvent(this.reason, this.levelMap, this.game))\n\n    return Reaction.DIE\n  }\n}\n","import { DieReason } from '../events/die_event'\nimport { Game } from '../models/game'\nimport { Presenter, PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class DeathPresenter extends Presenter {\n  constructor(public dieReason: DieReason, levelMap: LevelMap, game: Game) {\n    super(PresenterType.Death, levelMap, game)\n  }\n\n  get playerName(): string {\n    return this.game.player.name\n  }\n}\n","import { MetaAI, AIEvent } from './meta_ai'\nimport { Player } from '../models/creature'\nimport {\n  IdlePresenter,\n  Game,\n  TalentsTreePresenter,\n  ProfessionPickingPresenter,\n  LevelMap,\n  AfterEvent,\n} from '../../engine'\nimport { Presenter } from '../presenters/internal'\nimport { DieReason } from '../events/die_event'\nimport { DeathPresenter } from '../presenters/death_presenter'\nimport { CreatureEvent } from '../events/internal'\nimport { Level } from '../lib/level'\n\nexport class AINewLevelEvent extends AIEvent {\n  constructor(public level: number, private levelMap: LevelMap, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    if (!this.game.ai) {\n      throw 'AINewLevelEvent.run: game.ai is undefined'\n    }\n\n    if (this.level % 3 === 0) {\n      this.game.ai.presenter = new ProfessionPickingPresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    } else {\n      this.game.ai.presenter = new TalentsTreePresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    }\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class AIDieEvent extends AIEvent {\n  constructor(\n    private dieReason: DieReason,\n    private levelMap: LevelMap,\n    game: Game\n  ) {\n    super(game)\n  }\n\n  public run(): void {\n    if (!this.game.ai) {\n      throw 'AINewLevelEvent.run: game.ai is undefined'\n    }\n\n    this.game.ai.presenter = new DeathPresenter(\n      this.dieReason,\n      this.levelMap,\n      this.game\n    )\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class PlayerAI extends MetaAI {\n  public presenter: Presenter | null = null\n  private game: Game | undefined\n  private levelMap: LevelMap | undefined\n  public levelUps: number = 0\n\n  public act(\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.game = game\n    this.levelMap = levelMap\n\n    this.presenter = new IdlePresenter(levelMap, this.game)\n    this.game.ai = this\n\n    return\n  }\n\n  public endTurn(): void {\n    let event = this.events.pop()\n    if (event) {\n      event.run()\n    } else if (this.game && this.levelMap) {\n      this.game.player.on(new AfterEvent(this.levelMap, this.game))\n\n      let event = this.events.pop()\n      if (event) {\n        event.run()\n      } else {\n        this.game.player.ai.runEvents()\n        this.game.ai = null\n        this.presenter = null\n      }\n    }\n  }\n\n  public redirect(presenter: Presenter): void {\n    this.presenter = presenter\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction, Player } from '../models/creature'\nimport { Game, AINewLevelEvent, LevelMap } from '../../engine'\n\nexport class AddExperienceEvent extends CreatureEvent {\n  constructor(\n    public actor: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(subject: Player): Reaction {\n    subject.level.add(1).forEach(level => {\n      subject.ai.pushEvent(new AINewLevelEvent(level, this.levelMap, this.game))\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { remove, sum } from 'lodash'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, public current: number = max) {}\n\n  get maximum(): number {\n    return this.max\n  }\n\n  get atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  get currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  get currentValue(): number {\n    const value = super.currentValue\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n\nexport class AttributeSet<T> {\n  constructor(\n    public attack: T,\n    public defense: T,\n    public dexterity: T,\n    public health: T,\n    public radius: T,\n    public speed: T\n  ) {}\n\n  public with(pairSet: AttributeSet<any>, on: (first: T, second: any) => void) {\n    on(this.attack, pairSet.attack)\n    on(this.defense, pairSet.defense)\n    on(this.health, pairSet.health)\n    on(this.radius, pairSet.radius)\n    on(this.speed, pairSet.speed)\n  }\n}\n\nexport class Modifier extends AttributeSet<number> {\n  constructor({\n    attack = 0,\n    defense = 0,\n    dexterity = 0,\n    health = 0,\n    radius = 0,\n    speed = 0,\n  }) {\n    super(attack, defense, dexterity, health, radius, speed)\n  }\n\n  public withWeight(\n    pairSet: Modifier,\n    weight: Modifier,\n    on: (first: number, second: number, weight: number) => void\n  ) {\n    on(this.attack, pairSet.attack, weight.attack)\n    on(this.defense, pairSet.defense, weight.defense)\n    on(this.health, pairSet.health, weight.health)\n    on(this.radius, pairSet.radius, weight.radius)\n    on(this.speed, pairSet.speed, weight.speed)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { LevelMap } from '../models/level_map'\n\nexport class AttackEvent extends CreatureEvent {\n  constructor(\n    private subject: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (actor.characteristics.misses(this.subject.characteristics)) {\n      this.game.logger.missMessage(actor, this.subject)\n      return Reaction.DODGE\n    }\n\n    const damage = actor.characteristics.damageTo(this.subject.characteristics)\n\n    if (damage >= this.subject.characteristics.health.currentValue) {\n      actor.on(new AddExperienceEvent(this.subject, this.levelMap, this.game))\n      this.game.logger.killMessage(damage, actor, this.subject)\n      this.subject.on(new DieEvent(this.game, this.levelMap, DieReason.Attack))\n      return Reaction.DIE\n    } else {\n      this.subject.characteristics.health.decrease(damage)\n      this.game.logger.hurtMessage(damage, actor, this.subject)\n      return Reaction.HURT\n    }\n  }\n}\n","import { Creature, Reaction } from '../models/creature'\nimport { CreatureEvent } from './internal'\nimport { Potion, Game } from '../../engine'\n\nexport class DrinkPotionEvent extends CreatureEvent {\n  constructor(private potion: Potion, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    actor.inventory.removeFromBag(this.potion, 1)\n    this.potion.onDrink(this.game)\n    // TODO: Different messages for player and creatures\n    this.game.logger.drink(this.potion)\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Tile, GroupedItem, Game } from '../../engine'\nimport { Creature, Reaction } from '../models/creature'\nimport { Item } from '../models/items'\n\nexport class DropItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    // TODO: Validate items are part of positions\n    this.items.forEach(({ item, count }) => {\n      subject.inventory.removeFromBag(item, count)\n      subject.stuffWeight.subtract(item.weight * count)\n\n      this.game.logger.droppedItem(item, count)\n      this.tile.addItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { Item } from './items'\nimport { Point } from '../utils/utils'\nimport { Memory } from './memory'\n\nexport abstract class TileEffect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightTileEffect extends TileEffect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { Item } from '../models/items'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { LevelMap } from '../../engine'\n\nexport class ThrowEvent extends CreatureEvent {\n  constructor(\n    public subject: Creature,\n    public missile: Item,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (this.subject.characteristics.throwMisses(actor.characteristics)) {\n      this.game.logger.throwMissMessage(this.subject, actor, this.missile)\n      return Reaction.THROW_DODGE\n    }\n\n    const damage = this.subject.characteristics.throwDamageTo(\n      actor.characteristics,\n      this.missile\n    )\n\n    if (damage >= actor.characteristics.health.currentValue) {\n      this.subject.on(new AddExperienceEvent(actor, this.levelMap, this.game))\n      this.game.logger.throwKillMessage(\n        damage,\n        this.subject,\n        actor,\n        this.missile\n      )\n      actor.on(new DieEvent(this.game, this.levelMap, DieReason.Missile))\n      return Reaction.DIE\n    } else {\n      actor.characteristics.health.decrease(damage)\n      this.game.logger.throwHurtMessage(\n        damage,\n        this.subject,\n        actor,\n        this.missile\n      )\n      return Reaction.HURT\n    }\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Point } from '../utils/utils'\nimport { Creature, Reaction } from '../models/creature'\nimport { ItemFlightTileEffect } from '../models/tile_effect'\nimport { ThrowEvent } from './throw_event'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\n\nexport class MissileAttackEvent extends CreatureEvent {\n  constructor(\n    private path: Point[],\n    private game: Game,\n    private levelMap: LevelMap,\n    private done: (reaction: Reaction) => void\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const slot = actor.inventory.missileSlot\n\n    if (slot.equipment === undefined) {\n      throw 'MissileAttackEvent: slot has no items'\n    }\n\n    const missile = slot.equipment.item\n\n    slot.removeItem(actor, 1)\n\n    actor.stuffWeight.subtract(missile.weight)\n\n    let flightPath: Point[] = [],\n      victim: Creature | undefined\n\n    this.path.forEach(point => {\n      if (!victim) {\n        const tile = this.levelMap.at(point.x, point.y)\n        victim = tile.creature\n        flightPath.push(point)\n      }\n    })\n\n    this.game.effect = new ItemFlightTileEffect(missile, flightPath, () => {\n      if (victim) {\n        this.done(\n          victim.on(new ThrowEvent(actor, missile, this.levelMap, this.game))\n        )\n      } else {\n        this.done(Reaction.NOTHING)\n      }\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Tile, GroupedItem, Game, ItemsBunch } from '../../engine'\nimport { Reaction, Creature } from '../models/creature'\nimport { Item } from '../models/items'\n\nexport class PickUpItemsEvent extends CreatureEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    let tileItems: ItemsBunch<Item> | undefined = this.tile.items\n\n    if (tileItems === undefined) {\n      throw 'Failed to pick up items - tile has no items'\n    } else {\n      this.withTileItems(subject, tileItems)\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected withTileItems(subject: Creature, tileItems: ItemsBunch<Item>) {\n    this.items.forEach(({ item, count }) => {\n      subject.inventory.putToBag(item, count)\n      subject.stuffWeight.add(item.weight * count)\n\n      this.game.logger.pickedUpItem(item, count)\n      tileItems.remove(item, count)\n    })\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { InventorySlot, Item, Game } from '../../engine'\nimport { Creature, Reaction } from '../models/creature'\n\nexport class PutOnItemEvent extends CreatureEvent {\n  constructor(\n    private slot: InventorySlot,\n    private item: Item,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    this.slot.equip(creature, this.item)\n    this.game.logger.putOn(this.item)\n\n    return Reaction.NOTHING\n  }\n}\n","import { InventorySlot, CreatureEvent, Game } from '../../engine'\nimport { Reaction, Creature } from '../models/creature'\n\nexport class TakeOffItemEvent extends CreatureEvent {\n  constructor(private slot: InventorySlot, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const groupedItem = this.slot.equipment\n\n    if (groupedItem === undefined) {\n      throw `Can not take off item from ${this.slot.name} - nothing equipped`\n    }\n\n    this.slot.takeOff(actor)\n    this.game.logger.takeOff(groupedItem.item)\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Trap } from '../models/tile'\nimport { Creature, Reaction, Player } from '../models/creature'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { LevelMap } from '../models/level_map'\n\nexport class TrapEvent extends CreatureEvent {\n  constructor(\n    private trap: Trap,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: Special messages for dying.\n    let pos = this.levelMap.creaturePos(actor)\n    if (this.game.player.stageMemory(this.levelMap).at(pos.x, pos.y).visible) {\n      this.trap.revealed = true\n      this.game.logger.creatureSteppedInTrap(actor)\n    }\n\n    return this.doDamage(actor)\n  }\n\n  public affectPlayer(actor: Player): Reaction {\n    this.game.logger.youSteppedInTrap()\n    this.trap.revealed = true\n\n    return this.doDamage(actor)\n  }\n\n  private doDamage(actor: Creature): Reaction {\n    const damage = 10\n\n    if (damage >= actor.characteristics.health.currentValue) {\n      actor.on(new DieEvent(this.game, this.levelMap, DieReason.Trap))\n      return Reaction.DIE\n    } else {\n      actor.characteristics.health.decrease(damage)\n      return Reaction.HURT\n    }\n  }\n}\n","import { LevelMap, Tile, Item } from '../../engine'\nimport { Pool } from '../lib/pool'\nimport { Creature } from '../models/creature'\nimport { Point, cycle } from '../utils/utils'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  doorTile: () => Tile,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, doorTile())\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let i = 1; i < level.width - 1; i++) {\n    for (let j = 1; j < level.height - 1; j++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        level.addCreature(new Point(i, j), creaturesPool.pick(null))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null), 1)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\nexport const addOnTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n","import { twoDimArray } from '../utils/utils'\n\nexport default function<T>(\n  drawMap: string[],\n  collection: Map<string, () => T>\n): T[][] {\n  return twoDimArray(drawMap[0].length, drawMap.length, (x, y) => {\n    const tile = collection.get(drawMap[y].charAt(x))\n    if (tile) {\n      return tile()\n    } else {\n      throw `drawn: Can not find char ${drawMap[y].charAt(x)}`\n    }\n  })\n}\n","import { Rect, Point, rand, twoDimArray, minUnsafe } from '../utils/utils'\nimport { min } from 'lodash'\n\nconst THICKNESS = 0\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room<T> extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: T[][], walls: boolean[][], newRoomSpace: () => T): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        walls[this.x + i][this.y + j] = false\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road<T> extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: T[][], walls: boolean[][], newCorridor: () => T): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (walls[hx + i][hy]) {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (walls[vx][vy + j]) {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator<T> {\n  rooms: Room<T>[]\n  roads: Road<T>[]\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room<T>[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room<T> {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room<T>[]): Room<T>[] {\n    return rooms.reduce((pickedRooms: Room<T>[], currentRoom: Room<T>) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room<T>[]): Room<T>[] {\n    if (rooms.length === 0) {\n      return rooms\n    }\n\n    const minX = minUnsafe(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room<T>) => room.x + room.w < this.maxX)\n\n    const minY = minUnsafe(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room<T>) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room<T>[]): Road<T>[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    const firstPoint = points.shift()\n\n    if (!firstPoint) {\n      throw 'Dungeon.buildRoads rooms array is empty'\n    }\n\n    let connectedPoints: Point[] = [firstPoint]\n    let roads: Road<T>[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let maybePoint = points.shift()\n      if (!maybePoint) {\n        throw 'Dungeon.buildRoads rooms array is empty'\n      }\n\n      let currentPoint: Point = maybePoint\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function<T>(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number,\n  newRoomSpace: () => T,\n  newCorridor: () => T,\n  newWall: () => T\n): T[][] {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator<T>(\n    dimX,\n    dimY,\n    minSize,\n    maxSize,\n    roomsCount\n  )\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n  let walls = twoDimArray(dimX, dimY, () => true)\n\n  for (let i = 0; i < dungeon.rooms.length; i++)\n    dungeon.rooms[i].add(stage, walls, newRoomSpace)\n  for (let i = 0; i < dungeon.roads.length; i++)\n    dungeon.roads[i].add(stage, walls, newCorridor)\n\n  return stage\n}\n","import { remove } from 'lodash'\n\nexport enum ImpactType {\n  Blind,\n  Stressed,\n  Loaded,\n  Overloaded,\n}\n\nclass Impact {\n  private constEffects: string[] = []\n  private tempEffects: number = 0\n\n  constructor() {}\n\n  public addTempEffect(turns: number): void {\n    this.tempEffects += turns\n  }\n\n  public addConstEffect(effect: string): void {\n    // TODO: Validate keys do not repeat\n    this.constEffects.push(effect)\n  }\n\n  public removeTempEffect(): void {\n    this.tempEffects = 0\n  }\n\n  public removeConstEffect(effect: string): void {\n    remove(this.constEffects, impact => impact === effect)\n  }\n\n  public active(): boolean {\n    return this.tempEffects > 0 || this.constEffects.length > 0\n  }\n\n  public turn(): void {\n    if (this.tempEffects >= 1) {\n      this.tempEffects -= 1\n    }\n  }\n}\n\nexport class ImpactBunch {\n  private impacts: Map<ImpactType, Impact> = new Map()\n\n  get activeImpacts(): ImpactType[] {\n    let types: ImpactType[] = []\n\n    this.impacts.forEach((impact, type) => {\n      if (impact.active()) {\n        types.push(type)\n      }\n    })\n\n    return types\n  }\n\n  public addImpact(type: ImpactType, turns: number): void {\n    this.impactByType(type).addTempEffect(turns)\n  }\n\n  public removeImpact(type: ImpactType): void {\n    this.impactByType(type).removeTempEffect()\n  }\n\n  public addConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).addConstEffect(effect)\n  }\n\n  public removeConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).removeConstEffect(effect)\n  }\n\n  public turn(): void {\n    this.impacts.forEach(impact => impact.turn())\n  }\n\n  protected impactByType(type: ImpactType): Impact {\n    let impact = this.impacts.get(type)\n    if (impact !== undefined) {\n      return impact\n    }\n\n    impact = new Impact()\n    this.impacts.set(type, impact)\n    return impact\n  }\n}\n","import { Creature } from './creature'\nimport { Item, Potion } from './items'\n\nimport { last } from 'lodash'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport interface LogMessage {\n  level: LogLevel\n  message: string\n  counter: number\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public reset() {\n    this.messages = []\n  }\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name} got ${damage} damage from ${actor.name}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${\n        actor.name\n      } causes them to die`\n    )\n  }\n\n  public missMessage(actor: Creature, target: Creature) {\n    this.debug(`${actor.name} misses ${target.name}!`)\n  }\n\n  public throwMissMessage(actor: Creature, target: Creature, missile: Item) {\n    this.debug(\n      `${actor.name} throws ${missile.name} in ${target.name}, but misses!`\n    )\n  }\n\n  public throwKillMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${actor.name} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public throwHurtMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.debug(\n      `${target.name} got ${damage} damage from ${actor.name} by ${\n        missile.name\n      }`\n    )\n  }\n\n  public ranIntoAnObstacle(): void {\n    this.addMessage(LogLevel.DEBUG, 'You ran into a wall')\n  }\n\n  public howToHandle(): void {\n    this.addMessage(LogLevel.DEBUG, \"Don't know how to handle it\")\n  }\n\n  public noItemsToPickUp(): void {\n    this.addMessage(LogLevel.DEBUG, \"You don't see anything to pick up\")\n  }\n\n  public takeOff(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You took off ${item.name}`)\n  }\n\n  public putOn(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You put on ${item.name}`)\n  }\n\n  public drink(item: Potion): void {\n    this.addMessage(LogLevel.INFO, `You drunk ${item.name}`)\n  }\n\n  public nothingToShotWith(): void {\n    this.addMessage(LogLevel.DEBUG, 'You have nothing to shoot with')\n  }\n\n  public needMissileWeapon(): void {\n    this.addMessage(LogLevel.DEBUG, '     ')\n  }\n\n  public youSteppedInTrap(): void {\n    this.addMessage(LogLevel.DANGER, '   ')\n  }\n\n  public creatureSteppedInTrap(creature: Creature): void {\n    this.addMessage(LogLevel.DANGER, `${creature.name}   `)\n  }\n\n  public pickedUpItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You picked up ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You picked up ${count} ${item.name}`)\n    }\n  }\n\n  public droppedItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You dropped a ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You dropped ${count} ${item.name}`)\n    }\n  }\n\n  protected debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  protected info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  protected warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  protected danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    const lastRow: LogMessage | undefined = last(this.messages)\n\n    if (lastRow && lastRow.message === message) {\n      lastRow.counter += 1\n    } else {\n      this.messages.push({ level, message, counter: 1 })\n    }\n  }\n}\n","import { Game } from './game'\n\nexport enum TalentStatus {\n  Available,\n  Completed,\n  Unavailable,\n}\n\nexport abstract class Talent {\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public readonly depth: number,\n    public rank: number,\n    public readonly maxRank: number,\n    public readonly description: string\n  ) {}\n\n  public abstract onObtain(game: Game): void\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Direction,\n  DropItemsPresenter,\n  DrinkPresenter,\n  BagPresenter,\n  AttackEvent,\n  PickUpItemsEvent,\n  PickUpPresenter,\n  TileVisitor,\n  Player,\n  Stairway,\n  LevelMap,\n} from '../../engine'\nimport { InventoryPresenter } from './inventory_presenter'\nimport { MissilePresenter } from './missile_presenter'\nimport { MoveEvent } from '../events/move_event'\n\nexport enum IdleInputKey {\n  Right,\n  Left,\n  Down,\n  Up,\n\n  UpRight,\n  UpLeft,\n  DownRight,\n  DownLeft,\n\n  Handle,\n  Missile,\n\n  Inventory,\n  Bag,\n  PickUp,\n  Drop,\n  Drink,\n}\n\nclass HandleTileVisitor extends TileVisitor {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private player: Player,\n    private done: () => void\n  ) {\n    super()\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    // TODO: Do not do this if already connected\n    // TODO: Remove duplicity!!! descender.ts\n    const adjacentMap = this.game.getMap(stairway.adjacentMapId)\n    stairway.enterPos = adjacentMap.matchStairs(\n      this.levelMap.id,\n      this.levelMap.creaturePos(this.player)\n    )\n    this.player.on(\n      new MoveEvent(this.game, this.levelMap, stairway.enterPos, adjacentMap)\n    )\n\n    this.done()\n  }\n\n  protected default(): void {\n    this.game.logger.howToHandle()\n  }\n}\n\nexport class IdlePresenter extends Presenter {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Idle, levelMap, game)\n  }\n\n  public onInput(key: IdleInputKey) {\n    switch (key) {\n      case IdleInputKey.Right:\n        return this.move(Direction.right)\n      case IdleInputKey.Left:\n        return this.move(Direction.left)\n      case IdleInputKey.Down:\n        return this.move(Direction.down)\n      case IdleInputKey.Up:\n        return this.move(Direction.up)\n\n      case IdleInputKey.UpRight:\n        return this.move(Direction.upRight)\n      case IdleInputKey.UpLeft:\n        return this.move(Direction.upLeft)\n      case IdleInputKey.DownRight:\n        return this.move(Direction.downRight)\n      case IdleInputKey.DownLeft:\n        return this.move(Direction.downLeft)\n\n      case IdleInputKey.Handle:\n        return this.handle()\n\n      case IdleInputKey.PickUp:\n        return this.pickUpDialog()\n      case IdleInputKey.Missile:\n        return this.missileDialog()\n\n      case IdleInputKey.Drop:\n        this.redirect(new DropItemsPresenter(this.levelMap, this.game))\n        return\n      case IdleInputKey.Drink:\n        this.redirect(new DrinkPresenter(this.levelMap, this.game))\n        return\n      case IdleInputKey.Inventory:\n        this.redirect(new InventoryPresenter(this.levelMap, this.game))\n        return\n      case IdleInputKey.Bag:\n        this.redirect(new BagPresenter(this.levelMap, this.game))\n        return\n    }\n  }\n\n  private move(direction: Direction): void {\n    const pos = this.levelMap.creaturePos(this.player),\n      dest = pos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (tile.passibleThrough(this.player)) {\n      this.player.on(new MoveEvent(this.game, this.levelMap, dest))\n    } else if (tile.creature) {\n      this.player.on(new AttackEvent(tile.creature, this.levelMap, this.game))\n    } else {\n      this.game.logger.ranIntoAnObstacle()\n    }\n\n    this.endTurn()\n  }\n\n  private pickUpDialog(): void {\n    const tile = this.tile,\n      items = tile.items\n\n    if (items === undefined || items.bunch.length === 0) {\n      this.game.logger.noItemsToPickUp()\n    } else if (items.bunch.length === 1) {\n      this.player.on(new PickUpItemsEvent(tile, items.bunch, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new PickUpPresenter(this.levelMap, this.game))\n    }\n  }\n\n  private missileDialog(): void {\n    const missile = this.player.inventory.missileSlot.equipment\n\n    if (missile && missile.item) {\n      if (missile.item.canThrow(this.player)) {\n        this.redirect(new MissilePresenter(this.levelMap, this.game))\n      } else {\n        this.game.logger.needMissileWeapon()\n      }\n    } else {\n      this.game.logger.nothingToShotWith()\n    }\n  }\n\n  private handle(): void {\n    this.tile.visit(\n      new HandleTileVisitor(this.game, this.levelMap, this.player, () =>\n        this.endTurn()\n      )\n    )\n  }\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number[] {\n    if (this.doneLeveling) {\n      return []\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = []\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      this.levelUp()\n      levelUps.push(this.current)\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (input: Input) => Output][] = []\n\n  constructor(items: [number, (input: Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (input: Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    const found = this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })\n\n    if (found !== undefined) {\n      return found[1](input)\n    }\n\n    throw 'Pool failed to pick anything'\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import {\n  forEach,\n  keys,\n  min,\n  remove,\n  size,\n  pullAt,\n  pickBy,\n  includes,\n} from 'lodash'\n\nexport class Timeline<T> {\n  public step: number = 0\n  public turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      if (!includes(this.turns[ts], item)) {\n        this.turns[ts].push(item)\n      }\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n\n    this.turns = pickBy(this.turns, (val: T[]) => val.length > 0)\n  }\n\n  public next(): T {\n    this.step = this.nextStep()\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element === undefined ? this.next() : element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = this.nextStep()\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n\n  private nextStep(): number {\n    let step = min(keys(this.turns).map(x => parseInt(x)))\n\n    if (step === undefined) {\n      throw 'Timeline.nextStep called when there is no ones turn'\n    }\n\n    return step\n  }\n}\n","import { Specie } from './creature'\nimport { Item } from './items'\nimport {\n  AttributeSet,\n  Attribute,\n  PositiveAttribute,\n  Modifier,\n} from '../lib/attribute'\n\nexport class Characteristics extends AttributeSet<Attribute> {\n  constructor({\n    attack,\n    defense,\n    dexterity,\n    health,\n    radius,\n    speed,\n  }: {\n    attack: number\n    defense: number\n    dexterity: number\n    health: number\n    radius: number\n    speed: number\n  }) {\n    super(\n      new PositiveAttribute(attack),\n      new PositiveAttribute(defense),\n      new PositiveAttribute(dexterity),\n      new Attribute(health),\n      new PositiveAttribute(radius),\n      new PositiveAttribute(speed)\n    )\n  }\n\n  public addModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.addModifier(mod)\n      }\n    })\n  }\n\n  public removeModifier(modifier: Modifier) {\n    this.with(modifier, (char, mod) => {\n      if (mod !== 0) {\n        char.removeModifier(mod)\n      }\n    })\n  }\n\n  public damageTo(victim: Characteristics): number {\n    return Math.round(\n      (10 * this.attack.currentValue) / victim.defense.currentValue\n    )\n  }\n\n  public misses(victim: Characteristics): boolean {\n    let dex = this.dexterity.currentValue\n\n    return (\n      Math.random() >\n      dex / (dex + Math.pow(victim.dexterity.currentValue * 0.25, 0.8))\n    )\n  }\n\n  public throwMisses(victim: Characteristics): boolean {\n    return this.misses(victim)\n  }\n\n  public throwDamageTo(victim: Characteristics, missile: Item): number {\n    // TODO\n    return 10\n  }\n\n  public regenerate(): void {\n    this.health.increase(this.regenerationValue())\n  }\n\n  protected regenerationValue(): number {\n    // TODO\n    return 1\n  }\n\n  public regenerateEvery(): number {\n    // TODO\n    return 8\n  }\n\n  public levelUp(specie: Specie) {\n    this.health.constantIncrease(3)\n\n    if (Math.random() > 0.5) {\n      this.attack.constantIncrease(1)\n    } else {\n      this.defense.constantIncrease(1)\n    }\n  }\n}\n","import { addOnTile } from '../generator/post'\nimport { StairwayDown, StairwayUp, Tile } from './tile'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { Game } from './game'\nimport { Player } from './creature'\n\nexport abstract class Dungeon {\n  protected levels: LevelMap[] = []\n\n  constructor() {}\n  public abstract enter(game: Game, player: Player): void\n  public abstract register(game: Game): void\n\n  protected addStairDown(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayDown(map, adjustMapId))\n  }\n\n  protected addStairUp(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayUp(map, adjustMapId))\n  }\n\n  private addStairs(map: LevelMap, tile: Tile): LevelMap {\n    addOnTile(\n      map,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        map.setTile(x, y, tile)\n      }\n    )\n\n    return map\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from '../utils/utils'\nimport { Timeline } from '../lib/timeline'\nimport { Tile, StairwayDown, StairwayUp } from './tile'\n\nimport { remove } from 'lodash'\n\n// TODO: Remove map id\nexport type LevelMapId = number\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public timeline: Timeline<CreatureId>\n  public name: string = 'unnamed'\n\n  constructor(public readonly id: LevelMapId, map: Tile[][]) {\n    super(map)\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public enter(): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add(creature.id, creature.speed())\n    )\n  }\n\n  public creatureTile(creature: Creature): Tile {\n    let tile: Tile | undefined\n\n    this.each(t => {\n      if (t.creature && t.creature.id === creature.id) {\n        tile = t\n      }\n    })\n\n    if (!tile) {\n      throw `Creature ${creature.id} is not found on map ${this.id}`\n    }\n\n    return tile\n  }\n\n  public creaturePos(creature: Creature): Point {\n    let pos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile.creature && tile.creature.id === creature.id) {\n        pos = new Point(x, y)\n      }\n    })\n\n    if (!pos) {\n      throw `Creature ${creature.id} is not found on map ${this.id}`\n    }\n\n    return pos\n  }\n\n  public addCreature(pos: Point, creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(pos.x, pos.y).creature = creature\n    this.timeline.add(creature.id, creature.speed())\n  }\n\n  public removeCreature(creature: Creature) {\n    let pos = this.creaturePos(creature),\n      tile = this.at(pos.x, pos.y)\n\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove(creature.id)\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public matchStairs(adjustId: LevelMapId, enterPos: Point): Point {\n    let stairPos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n        if (tile.adjacentMapId === adjustId) {\n          tile.enterPos = enterPos\n          stairPos = new Point(x, y)\n        }\n      }\n    })\n\n    if (stairPos) {\n      return stairPos\n    }\n\n    throw `LevelMap ${this.name} failed to find stairs to ${adjustId}`\n  }\n}\n","import { ProfessionPicker } from './profession'\nimport { TileEffect } from './tile_effect'\nimport { LevelMapId, LevelMap } from './level_map'\nimport { Logger } from './logger'\nimport { Player } from './creature'\nimport { PlayerAI } from '../../engine'\n\ntype MapGenerator = (id: LevelMapId, game: Game) => LevelMap\n\nexport abstract class Game {\n  public logger: Logger = new Logger()\n  public currentMap: LevelMap | undefined\n  public ai: PlayerAI | null = null\n  public running: boolean = false\n  public effect: TileEffect | null = null\n\n  protected maps: Map<LevelMapId, LevelMap | MapGenerator> = new Map()\n\n  constructor(\n    public player: Player,\n    public professionPicker: ProfessionPicker\n  ) {}\n\n  public turn() {\n    if (this.running || (this.ai && !this.effect)) {\n      return\n    }\n    this.running = true\n\n    if (!this.currentMap) {\n      throw 'levelMapTurn: Map is undefined'\n    }\n\n    if (this.effect) {\n      this.player.rebuildVision(this.currentMap)\n      this.effect.patchMemory(this.player.stageMemory(this.currentMap))\n\n      if (this.effect.done()) {\n        this.effect.onDone()\n        this.effect = null\n      }\n\n      this.running = false\n    } else {\n      while (!this.player.dead && !this.ai) {\n        this.levelMapTurn()\n      }\n\n      this.player.rebuildVision(this.currentMap)\n    }\n\n    this.running = false\n  }\n\n  public getMap(id: LevelMapId): LevelMap {\n    const levelMap = this.maps.get(id)\n\n    if (!levelMap) {\n      throw `Map with id ${id} is not found`\n    }\n\n    if (levelMap instanceof LevelMap) {\n      return levelMap\n    } else if (levelMap instanceof Function) {\n      const builtLevelMap = levelMap(id, this)\n      this.maps.set(id, builtLevelMap)\n      return builtLevelMap\n    } else {\n      throw `LevelMap with id ${id} is not found`\n    }\n  }\n\n  public addMap(id: LevelMapId, generator: MapGenerator): void {\n    // TODO: Raise if presence\n    this.maps.set(id, generator)\n  }\n\n  private levelMapTurn(): void {\n    // TODO: Remove!!!\n    if (!this.currentMap) {\n      throw 'levelMapTurn: Map is undefined'\n    }\n\n    let timeline = this.currentMap.timeline,\n      map = this.currentMap\n\n    const actorId = timeline.next()\n\n    if (actorId === undefined) {\n      throw 'Timeline event is empty!'\n    }\n\n    const actor = map.creatures.find(creature => actorId === creature.id)\n\n    if (actor) {\n      actor.act(map, this)\n\n      // If they are still on a map\n      if (map.creatures.find(creature => actorId === creature.id)) {\n        timeline.add(actorId, actor.speed())\n      }\n    }\n  }\n}\n","import { Creature } from './creature'\nimport { Usage, Item } from './items'\nimport { intersection } from 'lodash'\nimport { Inventory } from './inventory'\nimport { GroupedItem } from '../lib/bunch'\n\nexport abstract class InventorySlot {\n  public name: string = 'InventorySlot'\n\n  constructor(\n    // What kind of items can be put in slot\n    public readonly usages: Usage[],\n    // Has to put only a single item or can put a bunch of them\n    public readonly useSingleItem: boolean,\n    public equipment?: GroupedItem<Item>\n  ) {}\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    return inventory.cares().filter(itemGroup => this.match(itemGroup.item))\n  }\n\n  public removeItem(actor: Creature, count: number): void {\n    if (this.equipment) {\n      if (this.equipment.count === count) {\n        this.equipment.item.onTakeOff(actor)\n        this.equipment = undefined\n      } else {\n        this.equipment.count -= count\n      }\n    } else {\n      // TODO: fail here\n    }\n  }\n\n  public equip(actor: Creature, item: Item) {\n    let inventory = actor.inventory,\n      groupItem = inventory.findInBag(item)\n\n    if (groupItem === undefined) {\n      throw `Item ${item.name} can not be equipped - not found in inventory`\n    }\n\n    // TODO: assert that can't equip more than have in inventory\n    // TODO: assert can equip\n    if (this.equipment) {\n      this.takeOff(actor)\n    }\n    const count = this.useSingleItem ? 1 : groupItem.count\n    this.equipment = { count, item }\n    inventory.removeFromBag(item, count)\n    item.onPutOn(actor)\n  }\n\n  public takeOff(actor: Creature): void {\n    if (!this.equipment) {\n      throw `Slot ${this.name} has nothing to take off`\n    }\n\n    actor.inventory.putToBag(this.equipment.item, this.equipment.count)\n    this.equipment.item.onTakeOff(actor)\n    this.equipment = undefined\n  }\n\n  protected match(item: Item): boolean {\n    return intersection(item.usages, this.usages).length > 0\n  }\n\n  protected withPairItem(\n    baseMatch: GroupedItem<Item>[],\n    item: Item\n  ): GroupedItem<Item>[] {\n    return baseMatch.filter(groupedItem => groupedItem.item.worksWith(item))\n  }\n}\n\nexport class RightHandSlot extends InventorySlot {\n  public name: string = ' '\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class LeftHandSlot extends InventorySlot {\n  public name: string = ' '\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class BodySlot extends InventorySlot {\n  public name: string = ''\n  constructor() {\n    super([Usage.WearsOnBody], true)\n  }\n}\n\nexport class BootsSlot extends InventorySlot {\n  public name: string = ''\n  constructor() {\n    super([Usage.Boots], true)\n  }\n}\n\nexport class MissileWeaponSlot extends InventorySlot {\n  public name: string = ''\n  constructor() {\n    super([Usage.Shoot], true)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = super.matchingItems(inventory),\n      missile = inventory.missileSlot.equipment\n\n    if (missile) {\n      return this.withPairItem(baseMatch, missile.item)\n    }\n\n    return baseMatch\n  }\n}\n\nexport class MissileSlot extends InventorySlot {\n  public name: string = ''\n  constructor() {\n    super([Usage.Throw], false)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = inventory.cares(),\n      missileWeapon = inventory.missileWeaponSlot.equipment\n\n    if (missileWeapon) {\n      return this.withPairItem(baseMatch, missileWeapon.item)\n    }\n\n    return baseMatch\n  }\n}\n","import {\n  InventorySlot,\n  RightHandSlot,\n  LeftHandSlot,\n  BodySlot,\n  MissileWeaponSlot,\n  MissileSlot,\n  BootsSlot,\n} from './inventory_slot'\nimport { Item } from './items'\nimport { ItemsBunch, GroupedItem } from '../lib/bunch'\n\nexport class Inventory {\n  private bag: ItemsBunch<Item> = new ItemsBunch()\n\n  public rightHandSlot = new RightHandSlot()\n  public leftHandSlot = new LeftHandSlot()\n  public bodySlot = new BodySlot()\n  public missileWeaponSlot = new MissileWeaponSlot()\n  public missileSlot = new MissileSlot()\n  public bootsSlot = new BootsSlot()\n\n  public slots(): InventorySlot[] {\n    return [\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.bodySlot,\n      this.bootsSlot,\n      this.missileWeaponSlot,\n      this.missileSlot,\n    ]\n  }\n\n  public cares(): GroupedItem<Item>[] {\n    return this.bag.bunch\n  }\n\n  public findInBag(item: Item): GroupedItem<Item> | undefined {\n    return this.bag.find(item)\n  }\n\n  public putToBag(item: Item, count: number): void {\n    this.bag.put(item, count)\n  }\n\n  public removeFromBag(item: Item, count: number): void {\n    this.bag.remove(item, count)\n  }\n}\n","import { Tile, Wall, TileVisitor } from './tile'\nimport { Creature, twoDimArray, ItemsBunch } from '../../engine'\nimport { Mapped } from '../utils/utils'\nimport { Item } from './items'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile: Tile) {}\n\n  get items(): ItemsBunch<Item> | undefined {\n    return this.tile.items\n  }\n\n  get creature(): Creature | undefined {\n    return this.tile.creature\n  }\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    this.tile.visit(tileVisitor)\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = new Wall()\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { Player } from './creature'\n\nimport { includes, sample } from 'lodash'\nimport { Talent } from './talent'\n\nexport class Profession {\n  public talents: Talent[] = []\n  public readonly depthCost: number = 3\n\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1,\n    public points: number = 0\n  ) {}\n}\n\nexport class ProfessionPicker {\n  constructor(\n    private pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number\n  ) {}\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n    let pickedProfession: Profession | undefined\n\n    if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(player)\n    } else if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(player)\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    } else if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    return professions\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(\n      profession => profession.level < this.maxLevel\n    )\n  }\n\n  protected updatableProfession(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    return sample(\n      player.professions.filter(profession => {\n        return excludeId !== profession.id\n      })\n    )\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return (\n      player.professions.length < this.maxTaken &&\n      this.pool.length > player.professions.length\n    )\n  }\n\n  protected newFromPool(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    const excluding = player.professions.map(profession => profession.id)\n\n    if (excludeId !== undefined) {\n      excluding.push(excludeId)\n    }\n\n    return sample(\n      this.pool.filter(profession => !includes(excluding, profession.id))\n    )\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Item,\n  InventorySlot,\n  GroupedItem,\n  PutOnItemsPresenter,\n  PutOnItemEvent,\n  TakeOffItemEvent,\n  LevelMap,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\n\nexport interface InventoryPresenterPosition {\n  inventorySlot: InventorySlot\n  item: Item | undefined\n  count: number | undefined\n  availableItems: GroupedItem<Item>[]\n}\n\nexport class InventoryPresenter extends Presenter {\n  public positions: InventoryPresenterPosition[] = []\n  private takeTime: boolean = false\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Inventory, levelMap, game)\n    this.rebuildPositions()\n  }\n\n  public takeOff(position: InventoryPresenterPosition) {\n    this.player.on(new TakeOffItemEvent(position.inventorySlot, this.game))\n    this.takeTime = true\n    this.rebuildPositions()\n  }\n\n  public putOn(position: InventoryPresenterPosition) {\n    this.redirect(\n      new PutOnItemsPresenter(\n        itemGroup => {\n          this.player.on(\n            new PutOnItemEvent(\n              position.inventorySlot,\n              itemGroup.item,\n              this.game\n            )\n          )\n\n          this.takeTime = true\n          this.rebuildPositions()\n          this.redirect(this)\n        },\n        position.availableItems,\n        this.levelMap,\n        this.game\n      )\n    )\n  }\n\n  public close() {\n    if (this.takeTime) {\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.levelMap, this.game))\n    }\n  }\n\n  private rebuildPositions(): void {\n    this.positions = this.player.inventory.slots().map(inventorySlot => {\n      return {\n        inventorySlot: inventorySlot,\n        item: inventorySlot.equipment && inventorySlot.equipment.item,\n        count: inventorySlot.equipment && inventorySlot.equipment.count,\n        availableItems: inventorySlot.matchingItems(this.player.inventory),\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Point, bresenhamInclusion, Direction } from '../utils/utils'\nimport { Memory } from '../models/memory'\nimport { IdlePresenter } from './idle_presenter'\nimport { MissileAttackEvent, Game, LevelMap } from '../../engine'\n\nexport class MissilePresenter extends Presenter {\n  public targetPos: Point\n  private memory: Memory\n  private targetEnemyIndex: number | undefined = undefined\n  private enemies: Point[] = []\n  private path: Point[] = []\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Missile, levelMap, game)\n\n    this.findEnemies()\n    this.memory = this.player.stageMemory(this.levelMap)\n    this.targetPos = this.resetTargetId()\n  }\n\n  public nextTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex += 1\n\n    if (this.targetEnemyIndex >= this.enemies.length) {\n      this.targetEnemyIndex = 0\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public previousTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex -= 1\n\n    if (this.targetEnemyIndex < 0) {\n      this.targetEnemyIndex = this.enemies.length - 1\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public moveTarget(direction: Direction): void {\n    const dest = this.targetPos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (\n      tile.visibleThrough() &&\n      this.player.stageMemory(this.levelMap).at(dest.x, dest.y).visible\n    ) {\n      this.updateTarget(dest)\n      this.targetEnemyIndex = undefined\n    }\n  }\n\n  public attack(): void {\n    if (!this.targetPos.eq(this.levelMap.creaturePos(this.player))) {\n      this.player.on(\n        new MissileAttackEvent(this.path, this.game, this.levelMap, () =>\n          this.endTurn()\n        )\n      )\n    }\n  }\n\n  public close(): void {\n    this.resetPath()\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n\n  private resetTargetId(): Point {\n    let point: Point\n\n    if (this.enemies.length) {\n      this.targetEnemyIndex = 0\n      point = this.enemies[this.targetEnemyIndex]\n    } else {\n      this.targetEnemyIndex = undefined\n      point = this.levelMap.creaturePos(this.player)\n    }\n\n    this.updateTarget(point)\n    return point\n  }\n\n  private resetPath(): void {\n    this.path.forEach(({ x, y }) => (this.memory.at(x, y).effect = undefined))\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.resetPath()\n    this.targetPos = newPos.copy()\n    this.drawPath()\n  }\n\n  private drawPath(): void {\n    this.path = []\n    let stop = false\n    const stage = this.levelMap,\n      pos = this.levelMap.creaturePos(this.player)\n\n    bresenhamInclusion(pos, this.targetPos, (x, y) => {\n      if (!stage.at(x, y).passibleThrough()) {\n        stop = true\n      }\n\n      this.path.push(new Point(x, y))\n      this.memory.at(x, y).effect = stop ? 'o' : 'x'\n    })\n  }\n\n  private findEnemies(): void {\n    this.enemies = []\n\n    this.player.stageMemory(this.levelMap).each((tile, x, y) => {\n      if (\n        tile.visible &&\n        tile.creature &&\n        tile.creature.id !== this.player.id\n      ) {\n        this.enemies.push(new Point(x, y))\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Item,\n  PickUpItemsEvent,\n  DrinkPotionEvent,\n  DropItemsEvent,\n  GroupedItem,\n  LevelMap,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\nimport { ItemGroup, Potion } from '../models/items'\nimport { InventoryPresenter } from './inventory_presenter'\n\ninterface ItemsListingPosition {\n  item: Item\n  count: number\n}\n\nabstract class ItemsListingPresenter extends Presenter {\n  // TODO: Pass to constructor\n  public positions: ItemsListingPosition[] = []\n  public title: string = 'unnamed'\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.ItemsListing, levelMap, game)\n    this.initPositions()\n  }\n\n  protected abstract initPositions(): void\n\n  public close(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n\nexport class PickUpPresenter extends ItemsListingPresenter {\n  public title: string = ' ?'\n\n  protected initPositions(): void {\n    const items = this.tile.items\n\n    if (items === undefined) {\n      throw `Failed to show pick up dialog - tile has no items`\n    }\n\n    this.positions = items.bunch.map(itemGroup => {\n      return { item: itemGroup.item, count: itemGroup.count }\n    })\n  }\n\n  public pickUpItems(items: GroupedItem<Item>[]): void {\n    // TODO: Validate items are part of positions\n    this.player.on(new PickUpItemsEvent(this.tile, items, this.game))\n    this.endTurn()\n  }\n}\n\nexport class DropItemsPresenter extends ItemsListingPresenter {\n  public title: string = ' ?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: GroupedItem<Item>[]): void {\n    if (items.length) {\n      this.player.on(new DropItemsEvent(this.tile, items, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.levelMap, this.game))\n    }\n  }\n}\n\nexport class PutOnItemsPresenter extends ItemsListingPresenter {\n  public title: string = ' ?'\n  public singleItemMode: boolean = true\n\n  constructor(\n    private onWithItem: (itemGroup: ItemsListingPosition) => void,\n    public positions: ItemsListingPosition[],\n    levelMap: LevelMap,\n    game: Game\n  ) {\n    super(levelMap, game)\n  }\n\n  protected initPositions(): void {}\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Validate items are part of positions\n    // new AIDropItems(items, this.game).act()\n  }\n\n  public withItem(itemGroup: ItemsListingPosition): void {\n    this.onWithItem(itemGroup)\n  }\n\n  public close(): void {\n    this.redirect(new InventoryPresenter(this.levelMap, this.game))\n  }\n}\n\nexport class DrinkPresenter extends ItemsListingPresenter {\n  public title: string = ' ?'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory\n      .cares()\n      .filter(itemGroup => itemGroup.item.group === ItemGroup.Potion)\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.player.on(new DrinkPotionEvent(itemGroup.item, this.game))\n    this.endTurn()\n  }\n}\n\nexport class BagPresenter extends ItemsListingPresenter {\n  public title: string = ''\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.endTurn()\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Game, LevelMap, Talent, TalentStatus } from '../../engine'\nimport { Profession } from '../models/profession'\n\ninterface TalentWithStatus extends Talent {\n  status: TalentStatus\n}\n\ninterface TalentsTreePresenterProfession {\n  profession: Profession\n  talents: TalentWithStatus[]\n}\n\nexport class TalentsTreePresenter extends Presenter {\n  public readonly options: TalentsTreePresenterProfession[] = []\n\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(PresenterType.AbilitiesPicking, levelMap, game)\n\n    this.options = this.player.professions.map(profession => {\n      return {\n        profession,\n        talents: profession.talents.map(talent => {\n          return Object.assign({}, talent, {\n            status: this.status(talent, profession),\n          })\n        }),\n      }\n    })\n  }\n\n  get title(): string {\n    return 'Pick new talent'\n  }\n\n  public pickTalent(professionId: number, talentId: number): void {\n    const profession: Profession | undefined = this.player.professions.find(\n      profession => profession.id === professionId\n    )\n\n    if (profession === undefined) {\n      throw `Profession with id ${professionId} is not found`\n    }\n\n    let talent: Talent | undefined = profession.talents.find(\n      talent => talent.id === talentId\n    )\n\n    if (talent === undefined) {\n      throw `Talent with id ${talentId} for profession ${\n        profession.name\n      } is not found`\n    }\n\n    if (this.status(talent, profession) !== TalentStatus.Available) {\n      throw `Talent with id ${talentId} for profession ${\n        profession.name\n      } can not be upgraded`\n    }\n\n    talent.rank += 1\n    profession.points += 1\n\n    this.player.characteristics.levelUp(this.player.specie)\n\n    this.endTurn()\n  }\n\n  private status(talent: Talent, profession: Profession): TalentStatus {\n    if (talent.rank === talent.maxRank) {\n      return TalentStatus.Completed\n    } else if (talent.depth * profession.depthCost > profession.points) {\n      return TalentStatus.Unavailable\n    } else {\n      return TalentStatus.Available\n    }\n  }\n}\n","import { PresenterType, Presenter } from './internal'\nimport { Profession } from '../models/profession'\nimport { TalentsTreePresenter } from './talents_tree_presenter'\nimport { Game, LevelMap } from '../../engine'\n\nexport class ProfessionPickingPresenter extends Presenter {\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(PresenterType.ProfessionPicking, levelMap, game)\n  }\n\n  get title(): string {\n    return `Gained ${this.level} level`\n  }\n\n  get options(): Profession[] {\n    return this.game.professionPicker.available(this.player)\n  }\n\n  public pickProfession(pickedProfession: Profession) {\n    let playerProfession = this.player.professions.find(\n      profession => profession.id === pickedProfession.id\n    )\n\n    if (playerProfession) {\n      playerProfession.level += 1\n    } else {\n      this.player.professions.push(pickedProfession)\n    }\n\n    this.redirect(\n      new TalentsTreePresenter(this.level, this.levelMap, this.game)\n    )\n  }\n}\n","import { Point, twoDimArray, Mapped } from './utils'\n\nimport { sample } from 'lodash'\n\nconst FIRST_STEP: number = 1\n\nexport const leePath = function<Tile>(\n  map: Mapped<Tile>,\n  pos: Point,\n  tangible: (tile: Tile) => boolean,\n  destination: (point: Point, tile: Tile) => boolean,\n  randomDestination: boolean = false\n): Point[] {\n  let stageMemory: number[][] = twoDimArray(map.width, map.height, () => -1)\n  let pointsToVisit: Point[] = []\n  let pointsToCheck: Point[] = [pos]\n\n  let step = 0\n  while (pointsToCheck.length && !pointsToVisit.length) {\n    let wavePoints: Point[] = []\n\n    pointsToCheck.forEach((point: Point) => {\n      if (!map.inRange(point)) {\n        return\n      }\n\n      const tile = map.at(point.x, point.y)\n      // TODO: Compare, current value might be lower\n      if (tangible(tile) || stageMemory[point.x][point.y] !== -1) {\n        return\n      }\n\n      stageMemory[point.x][point.y] = step\n      if (destination(point, tile)) {\n        pointsToVisit.push(point)\n      } else {\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      }\n    })\n    step++\n\n    pointsToCheck = wavePoints\n  }\n\n  if (pointsToVisit.length) {\n    // TODO: Remove this check\n    let randomPointToVisit = sample(pointsToVisit)\n    if (randomDestination && randomPointToVisit) {\n      return buildRoad(randomPointToVisit, stageMemory)\n    } else {\n      return buildRoad(pointsToVisit[0], stageMemory)\n    }\n  } else {\n    return []\n  }\n}\n\nconst buildRoad = function(point: Point, stageMemory: number[][]): Point[] {\n  let lastPoint = point\n  let chain = [lastPoint]\n\n  let delta: Point | undefined\n\n  while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n    delta = Point.dxy.find(\n      (dp): boolean => {\n        return (\n          stageMemory[lastPoint.x + dp.x] &&\n          stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n            stageMemory[lastPoint.x][lastPoint.y] - 1\n        )\n      }\n    )\n\n    if (delta === undefined) {\n      return []\n    }\n\n    lastPoint = lastPoint.add(delta)\n\n    chain.unshift(lastPoint)\n  }\n\n  return chain\n}\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { takeRight } from 'lodash'\n\nimport { LogLevel, LogMessage } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: ['logger'],\n  data() {\n    return {\n      lastId: 0,\n    }\n  },\n  computed: {\n    messages() {\n      return takeRight(this.logger.messages, 5)\n    }\n  },\n  methods: {\n    counter(value: number) {\n      if (value > 1) {\n        return `x${value}`\n      }\n    },\n    rowClass(record: LogMessage) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'debug'\n        case LogLevel.INFO:\n          return 'info'\n        case LogLevel.WARNING:\n          return 'warning'\n        case LogLevel.DANGER:\n          return 'danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=e78aa69c&scoped=true&lang=pug&\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts&\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&id=e78aa69c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e78aa69c\",\n  null\n  \n)\n\ncomponent.options.__file = \"Logger.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logger\"},_vm._l((_vm.messages),function(record,i){return _c('div',{key:i,class:_vm.rowClass(record)},[_vm._v(_vm._s(record.message)+\"\\n\"+_vm._s(_vm.counter(record.counter)))])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Talent, Game } from '../engine'\n\n// TODO: Validate all Talent's ids are uniq\nexport enum OnisunTalentId {\n  AttackerTwoHandedWeapons,\n  AttackerHeavyWeapons,\n  AttackerLightWeapons,\n  AttackerTwoWeapons,\n  AttackerDoubleTwoHandedWeapons,\n  AttackerStrongGrip,\n}\n\nexport abstract class OnisunTalent extends Talent {\n  constructor(\n    id: number,\n    name: string,\n    depth: number,\n    rank: number,\n    maxRank: number,\n    description: string = ''\n  ) {\n    super(id, name, depth, rank, maxRank, description)\n  }\n}\n\nexport class AttackerTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerTwoHandedWeapons, ' ', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerLightWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerLightWeapons, ' ', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerHeavyWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerHeavyWeapons, ' ', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerTwoWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerTwoWeapons,\n      ' ',\n      1,\n      0,\n      1,\n      '     '\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerDoubleTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerDoubleTwoHandedWeapons,\n      '  ',\n      2,\n      0,\n      2\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerStrongGrip extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerStrongGrip,\n      ' ',\n      2,\n      0,\n      2,\n      '    '\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n","import { ProfessionPicker, Profession, Player } from '../engine'\nimport { AttackerTwoHandedWeapons } from './talents'\n\nenum OnisunProfessionId {\n  Attacker,\n  Defender,\n}\n\nexport class OnisunAttackerProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Attacker, '', level)\n\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunDefenderProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Defender, '', level)\n\n    // TODO: Tmp\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    player: Player,\n    public attacker = new OnisunAttackerProfession(),\n    public defender = new OnisunDefenderProfession()\n  ) {\n    super([attacker, defender], 3, 6)\n  }\n}\n","import {\n  Missile,\n  MissileWeapon,\n  Item,\n  Modifier,\n  Player,\n  OneHandWeapon,\n  BodyArmor,\n  Pool,\n  Creature,\n  Boots,\n  ImpactType,\n  DamageType,\n} from '../engine'\nimport { HealPotion } from './potions'\nimport { ProtectionType } from '../engine/models/items'\n\nclass MissileRock extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Sling\n  }\n}\n\nclass Arrow extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Bow\n  }\n\n  public canThrow(player: Player): boolean {\n    return !!player.inventory.missileWeaponSlot.equipment\n  }\n}\n\nclass Sling extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof MissileRock\n  }\n}\n\nclass Bow extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof Arrow\n  }\n}\n\nconst noMod = new Modifier({})\n\nexport const commonBow = () => new Bow(' ', 1, noMod)\n\nexport const smallRock = () => new MissileRock(' ', 0.3, noMod)\n\nexport const woodenArrow = () => new Arrow(' ', 0.2, noMod)\nexport const ironArrow = () => new Arrow(' ', 0.25, noMod)\n\nexport const weapons = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new OneHandWeapon('', 1, [\n        { type: DamageType.Melee, dice: { times: 5, max: 2 }, extra: 0 },\n      ]),\n  ],\n  [\n    7,\n    () =>\n      new OneHandWeapon('', 0.8, [\n        { type: DamageType.Melee, dice: { times: 1, max: 3 }, extra: 2 },\n      ]),\n  ],\n])\n\nexport const itemsPool = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new BodyArmor('', 5, [{ type: ProtectionType.Medium, value: 3 }]),\n  ],\n  [\n    5,\n    () => new BodyArmor('', 3, [{ type: ProtectionType.Heavy, value: 5 }]),\n  ],\n  [\n    10,\n    () =>\n      new BodyArmor('', 1, [{ type: ProtectionType.Unarmored, value: 1 }]),\n  ],\n  [100, () => new HealPotion()],\n])\n\nexport class LightSpeedBoots extends Boots {\n  constructor() {\n    super('  ', 0.1, [])\n  }\n\n  public onPutOn(creature: Creature): void {\n    creature.addImpact(ImpactType.Blind, this.name)\n  }\n\n  public onTakeOff(creature: Creature): void {\n    creature.removeImpact(ImpactType.Blind, this.name)\n  }\n}\n","import { Game, Potion } from '../engine'\n\nexport class HealPotion extends Potion {\n  constructor() {\n    super(' ')\n  }\n\n  public onDrink(game: Game) {\n    game.player.characteristics.health.increase(5)\n  }\n}\n","import {\n  Characteristics,\n  Creature,\n  Dispatcher,\n  Specie,\n  Clan,\n  Pool,\n  AICreature,\n} from '../engine'\n\nconst newCreature = (characteristics: Characteristics, name: string) => {\n  return new AICreature(\n    characteristics,\n    new Dispatcher(),\n    new Specie(name, 10, Clan.PlayerOnlyEnemy, [])\n  )\n}\n\nconst floatingEye = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 100,\n      radius: 5,\n      speed: 200,\n    }),\n    'Floating eye'\n  )\n}\n\nconst rat = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 1,\n      defense: 1,\n      dexterity: 1,\n      health: 1,\n      radius: 5,\n      speed: 90,\n    }),\n    'Rat'\n  )\n}\n\nconst orc = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 3,\n      defense: 3,\n      dexterity: 2,\n      health: 5,\n      radius: 5,\n      speed: 100,\n    }),\n    'Orc'\n  )\n}\n\nconst undead = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 2,\n      defense: 7,\n      dexterity: 1,\n      health: 10,\n      radius: 5,\n      speed: 120,\n    }),\n    'Undead'\n  )\n}\n\nconst robot = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 5,\n      defense: 5,\n      dexterity: 3,\n      health: 7,\n      radius: 7,\n      speed: 90,\n    }),\n    'Robot'\n  )\n}\n\nconst dragon = () => {\n  return newCreature(\n    new Characteristics({\n      attack: 7,\n      defense: 7,\n      dexterity: 7,\n      health: 30,\n      radius: 5,\n      speed: 100,\n    }),\n    'Dragon'\n  )\n}\n\nexport const creaturesPool1 = new Pool<null, Creature>([\n  [10, rat],\n  [1, floatingEye],\n])\nexport const creaturesPool2 = new Pool<null, Creature>([[1, rat], [2, orc]])\nexport const creaturesPool3 = new Pool<null, Creature>([\n  [1, rat],\n  [1, orc],\n  [2, undead],\n])\nexport const creaturesPool4 = new Pool<null, Creature>([\n  [2, undead],\n  [2, robot],\n])\nexport const creaturesPool5 = new Pool<null, Creature>([\n  [2, robot],\n  [1, dragon],\n])\n","import { Creature } from '../models/creature'\nimport { MetaAI } from './meta_ai'\nimport { Escaper } from './escaper'\nimport { Explorer } from './explorer'\nimport { Chaser } from './chaser'\nimport { Attacker } from './attacker'\nimport { Picker } from './picker'\nimport { Patrol } from './patrol'\nimport { Loiter } from './loiter'\nimport { Thrower } from './thrower'\nimport { Descender } from './descender'\nimport { SelfHealer } from './selfhealer'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  private step: number = 0\n\n  constructor() {\n    super()\n    this.escaper = new Escaper()\n    this.explorer = new Explorer()\n    this.chaser = new Chaser()\n    this.attacker = new Attacker()\n    this.picker = new Picker()\n    this.patrol = new Patrol()\n    this.loiter = new Loiter()\n    this.thrower = new Thrower()\n\n    this.descender = new Descender()\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.step += 1\n\n    if (this.step % actor.characteristics.regenerateEvery() === 0) {\n      actor.characteristics.regenerate()\n    }\n\n    this.runEvents()\n    let event: CreatureEvent | undefined\n\n    if (this.feelsGood(actor)) {\n      if ((event = this.attacker.act(actor, levelMap, game))) {\n      } else if ((event = this.thrower.act(actor, levelMap, game))) {\n      } else if ((event = this.chaser.act(actor, levelMap, game))) {\n      } else if ((event = this.picker.act(actor, levelMap, game))) {\n      } else {\n        event = this.explore(actor, levelMap, game)\n      }\n    } else if (\n      this.healthCritical(actor) &&\n      (event = this.escaper.act(actor, levelMap, game))\n    ) {\n    } else if ((event = this.attacker.act(actor, levelMap, game))) {\n    } else if ((event = this.thrower.act(actor, levelMap, game))) {\n    } else if ((event = this.chaser.act(actor, levelMap, game))) {\n    } else {\n      event = new SelfHealer().act(actor, levelMap, game)\n    }\n\n    this.resetEvents()\n\n    return event\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue >\n      actor.characteristics.health.maximum * 0.9\n    )\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return (\n      actor.characteristics.health.currentValue <\n      actor.characteristics.health.maximum / 4\n    )\n  }\n\n  private explore(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event: CreatureEvent | undefined\n\n    if ((event = this.explorer.act(actor, levelMap, game))) {\n      if (!actor.dead) {\n        this.patrol.trackMovement(\n          levelMap.creaturePos(actor),\n          levelMap.creatureTile(actor)\n        )\n      }\n    } else if ((event = this.descender.act(actor, levelMap, game))) {\n    } else if ((event = this.patrol.act(actor, levelMap, game))) {\n    } else {\n      event = this.loiter.act(actor, levelMap, game)\n    }\n\n    return event\n  }\n}\n","import { TrapEvent, Creature, Tile, Trap, Game, LevelMap } from '../engine'\n\nexport enum OnisunTrapType {\n  Fire,\n  Ice,\n}\n\nexport class OnisunFireTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, OnisunTrapType.Fire)\n  }\n\n  protected buildNew(): Tile {\n    return new OnisunFireTrap(this.revealed)\n  }\n\n  protected affect(game: Game, levelMap: LevelMap, creature: Creature): void {\n    creature.on(new TrapEvent(this, levelMap, game))\n  }\n}\n\nexport class OnisunIceTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, OnisunTrapType.Ice)\n  }\n\n  protected buildNew(): Tile {\n    return new OnisunIceTrap(this.revealed)\n  }\n\n  protected affect(game: Game, levelMap: LevelMap, creature: Creature): void {\n    creature.on(new TrapEvent(this, levelMap, game))\n  }\n}\n","import {\n  addCreatures,\n  addDoors,\n  addItems,\n  addOnTile,\n  centralize,\n  Corridor,\n  Door,\n  drawn,\n  Dungeon,\n  dungeon,\n  Floor,\n  LevelMap,\n  Point,\n  Room,\n  Tile,\n  TileTypes,\n  Wall,\n  Game,\n  Player,\n} from '../../engine'\nimport { creaturesPool1 } from '../creatures'\nimport { itemsPool, weapons } from '../items'\nimport { OnisunFireTrap, OnisunIceTrap } from '../tiles'\n\nconst initId: number = -1\n\nconst config = {\n  addDoors: false,\n  minSize: 3,\n  maxSize: 10,\n  roomsCount: 10,\n  simple: true,\n}\n\nconst tiles: Map<string, () => Tile> = new Map()\ntiles.set('C', () => new Corridor('C', TileTypes.Floor))\ntiles.set('W', () => new Wall())\ntiles.set('R', () => new Floor('R', TileTypes.Floor))\ntiles.set('D', () => new Door())\n\nexport class TutorialDungeon extends Dungeon {\n  public enter(game: Game, player: Player): void {\n    const levelMap = (game.currentMap = game.getMap(initId))\n\n    addOnTile(\n      levelMap,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        levelMap.addCreature(new Point(x, y), player)\n      }\n    )\n  }\n\n  public register(game: Game): void {\n    game.addMap(-1, (id, game) =>\n      addCreatures(\n        0.1,\n        this.addStairDown(this.generateMap(id), 0),\n        creaturesPool1\n      )\n    )\n\n    for (let i = 0; i < 5; i++) {\n      game.addMap(i, (id, game) => {\n        return addCreatures(\n          i * 0.01,\n          this.addStairUp(\n            this.addStairDown(this.generateMap(id), i + 1),\n            i - 1\n          ),\n          creaturesPool1\n        )\n      })\n    }\n\n    game.addMap(5, (id, game) => this.addStairUp(this.generateMap(id), 4))\n  }\n\n  private generateMap(id: number): LevelMap {\n    let map = new LevelMap(\n      id,\n      dungeon<Tile>(\n        40,\n        30,\n        config.minSize,\n        config.maxSize,\n        config.roomsCount,\n        () => new Room(),\n        () => new Corridor('C', TileTypes.Floor),\n        () => new Wall()\n      )\n    )\n\n    if (config.simple) {\n      map = new LevelMap(\n        id,\n        drawn(\n          [\n            'WWWWWWWWWWWWWWWWWWWWWW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WRRRRRRRRRRRRRRRRRRRRW',\n            'WWWWWWWWWWWWWWWWWWWWWW',\n          ],\n          tiles\n        )\n      )\n    }\n\n    if (config.addDoors) {\n      const door = tiles.get('D')\n      if (door === undefined) {\n        throw 'Door is not found'\n      }\n\n      addDoors(map, door)\n    }\n\n    centralize(map)\n    map.name = `MP ${id}`\n\n    for (let i = 0; i < 10; i++) {\n      addOnTile(\n        map,\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (x, y) => {\n          map.setTile(x, y, new OnisunFireTrap())\n        }\n      )\n\n      addOnTile(\n        map,\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (x, y) => {\n          map.setTile(x, y, new OnisunIceTrap())\n        }\n      )\n    }\n\n    addItems(0.05, map, weapons.merge(itemsPool))\n\n    return map\n  }\n}\n","import {\n  Clan,\n  Player,\n  Specie,\n  allAbilities,\n  OneHandWeapon,\n  Characteristics,\n  Game,\n  Level,\n  PlayerAI,\n} from './engine'\n\nimport { OnisunProfessionPicker } from './onisun/professions'\nimport {\n  woodenArrow,\n  ironArrow,\n  commonBow,\n  smallRock,\n  LightSpeedBoots,\n} from './onisun/items'\nimport { TutorialDungeon } from './onisun/dungeons/tutorial_dungeon'\nimport { PickUpItemsEvent } from './engine/events/pick_up_items_event'\nimport { DamageType, BodyArmor, ProtectionType } from './engine/models/items'\n\nexport * from './onisun/professions'\nexport * from './onisun/talents'\nexport * from './onisun/items'\nexport * from './onisun/tiles'\n\nexport class Application {\n  public game: Onisun\n  constructor() {\n    this.game = new Onisun(this.initPlayer())\n\n    const dungeon = new TutorialDungeon()\n    dungeon.register(this.game)\n    dungeon.enter(this.game, this.game.player)\n\n    const player = this.game.player,\n      prof = this.game.professionPicker.available(player)[1]\n\n    if (prof) {\n      player.professions.push(prof)\n    }\n\n    const dagger = new OneHandWeapon('Dagger', 0.8, [\n      { type: DamageType.Melee, dice: { times: 1, max: 3 }, extra: 2 },\n    ])\n    const katana = new OneHandWeapon('Katana', 1, [\n      { type: DamageType.Melee, dice: { times: 5, max: 2 }, extra: 0 },\n    ])\n    const plateArmor = new BodyArmor('', 1, [\n      { type: ProtectionType.Heavy, value: 5 },\n    ])\n\n    const wooden = woodenArrow()\n    const iron = ironArrow()\n    const rock = smallRock()\n\n    const bow = commonBow()\n\n    if (this.game.currentMap) {\n      const tile = this.game.currentMap.creatureTile(player)\n\n      tile.addItem(dagger, 2)\n      tile.addItem(katana, 1)\n      tile.addItem(plateArmor, 1)\n      tile.addItem(wooden, 5)\n      tile.addItem(iron, 5)\n      tile.addItem(rock, 5)\n      tile.addItem(bow, 2)\n\n      player.on(\n        new PickUpItemsEvent(\n          tile,\n          [\n            { item: dagger, count: 2 },\n            { item: katana, count: 1 },\n            { item: plateArmor, count: 1 },\n            { item: wooden, count: 5 },\n            { item: iron, count: 5 },\n            { item: rock, count: 5 },\n            { item: bow, count: 2 },\n          ],\n          this.game\n        )\n      )\n\n      player.inventory.missileWeaponSlot.equip(player, bow)\n      player.inventory.missileSlot.equip(player, wooden)\n      player.inventory.rightHandSlot.equip(player, katana)\n\n      player.inventory.bodySlot.equip(player, plateArmor)\n\n      player.inventory.putToBag(new LightSpeedBoots(), 1)\n\n      this.game.logger.reset()\n    }\n  }\n\n  protected initPlayer(): Player {\n    return new Player(\n      new Level([1, 3, 5, 10, 20]),\n      new Characteristics({\n        attack: 1,\n        defense: 4,\n        dexterity: 3,\n        health: 100,\n        radius: 10,\n        speed: 80,\n      }),\n      new PlayerAI(),\n      new Specie('Player', 80, Clan.Player, allAbilities)\n    )\n  }\n}\n\nexport class Onisun extends Game {\n  constructor(player: Player) {\n    super(player, new OnisunProfessionPicker(player))\n  }\n}\n","import { Tile as UniTile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n  TileVisitor,\n\n  Wall,\n  Floor,\n  Tile,\n  StairwayDown,\n  StairwayUp,\n  Door,\n  Trap,\n} from '../src/engine'\n\nimport {\n  OnisunTrapType,\n} from '../src/onisun'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends UniTile {\n  public lighted(degree: number): UniTile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: UniTile, degree: number): UniTile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: UniTile, degree: number): UniTile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDownD extends DisplayTile {\n  constructor() {\n    super('')\n  }\n}\n\nexport class StairwayUpD extends DisplayTile {\n  constructor() {\n    super('')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('', 200, 200, 200)\nconst CORPSE = new ItemTile('', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('', 200, 200, 200)\nconst MISSILE = new ItemTile('', 200, 200, 200)\nconst MISSILE_WEAPON = new ItemTile(']', 200, 200, 200)\nconst BOOTS = new ItemTile('[', 255, 255, 0)\n\nconst POTION = new ItemTile('', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    case ItemGroup.MissileWeapon:\n      return MISSILE_WEAPON\n    case ItemGroup.Potion:\n      return POTION\n    case ItemGroup.Boots:\n      return BOOTS\n    default:\n      console.error(`Unknown group ${item} with type ${item.group}`)\n      return CORPSE\n  }\n}\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDownD()\nconst STAIRWAY_UP = new StairwayUpD()\nconst NULL_TILE = new DisplayTile('', 0, 0, 0)\n\nconst FIRE_TRAP = new DisplayTile('^', 200, 0, 0)\nconst ICE_TRAP = new DisplayTile('^', 0, 0, 200)\n\nexport class DisplayTileVisitor extends TileVisitor {\n  public tile: DisplayTile\n\n  public onWall(wall: Wall): void {\n    this.tile = WALL\n  }\n\n  public onFloor(floor: Floor): void {\n    this.tile = FLOOR\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.tile = STAIRWAY_DOWN\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.tile = STAIRWAY_UP\n  }\n\n  public onDoor(door: Door): void {\n    this.tile = DOOR\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      this.tile = FLOOR\n      return\n    }\n\n    switch (trap.type) {\n    case OnisunTrapType.Fire:\n      this.tile = FIRE_TRAP\n      break\n    case OnisunTrapType.Ice:\n      this.tile = ICE_TRAP\n      break\n    }\n  }\n\n  protected default(tile: Tile): void {\n    this.tile = NULL_TILE\n  }\n}\n\nconst displayTileVisitor = new DisplayTileVisitor()\n\nexport const displayTile = function(tile): DisplayTile {\n  tile.visit(displayTileVisitor)\n  return displayTileVisitor.tile\n}\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  ItemTile,\n  DisplayTile,\n\n  displayItem,\n  displayTile,\n} from './scene_tiles'\nimport { Creature } from 'src/engine';\n\nconst HUMAN  = new CreatureTile('', 0, 255, 0)\nconst RAT = new CreatureTile('r', 197, 65, 38)\nconst NULL_TILE = new DisplayTile('', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n  new ItemTile('', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player', 'pos'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      interval: 100,\n      step: 0,\n    }\n  },\n  methods: {\n    getTile(x: number, y: number) {\n      const effect = this.stage.at(x, y).effect\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULL_TILE\n      }\n\n      if (effect) {\n        if (tile.creature) {\n          let dTile = this.creatureTile(tile.creature).clone()\n          dTile.setBackground(200, 0, 0)\n          return dTile\n        } else {\n          return new DisplayTile(effect, 200, 200, 0)\n        }\n      }\n\n      if (tile.creature) {\n        return this.creatureTile(tile.creature)\n      }\n\n      if (tile.items) {\n        switch (tile.items.bunch.length) {\n        case 0:\n          break;\n        case 1:\n          return displayItem(tile.items.bunch[0].item)\n        default:\n          const frame = this.step % (this.animationFps * 3 + 4)\n          if (frame < nextItemAnimation.length) {\n            return nextItemAnimation[frame]\n          } else {\n            const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n            return displayItem(tile.items.bunch[itemId % tile.items.bunch.length].item)\n          }\n        }\n      }\n\n      return displayTile(tile)\n    },\n    creatureTile(creature: Creature) {\n      if (creature.name == 'Rat') {\n        return RAT\n      }\n\n      return HUMAN\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        Math.max(this.level.width, 40),\n        Math.max(this.level.height, 40),\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x: number, y: number) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.ts = ts\n      }\n\n      this.eng.update(this.pos.x, this.pos.y);\n      // this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level)\n    },\n    animationFps(): number {\n      return 1000 / this.interval\n    },\n    tileItems() {\n      let items = this.stage.at(this.player.pos.x, this.player.pos.y).items()\n      return items && items.bunch\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=43b7050b&lang=pug&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Scene.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { sum } from 'lodash'\n\nexport default Vue.extend({\n  name: 'PrimaryAttribute',\n  props: ['name', 'slug', 'attr', 'fullName'],\n  computed: {\n    id(): string {\n      return `${this.slug}-container`\n    },\n    modifier(): number {\n      return sum(this.attr.modifiers)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PrimaryAttribute.vue?vue&type=template&id=dd16cc50&lang=pug&\"\nimport script from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\nexport * from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PrimaryAttribute.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover\",attrs:{\"id\":_vm.id}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.attr.currentValue))]),_c('b-popover',{attrs:{\"target\":_vm.id,\"triggers\":\"hover\",\"container\":_vm.id,\"placement\":\"top\"}},[[_c('big',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.fullName))]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.attr.current))])]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\":\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.modifier))])])]],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PrimaryAttribute from './PrimaryAttribute.vue'\nimport { Attribute, Level } from 'src/engine'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature', 'levelMap'],\n  components: {\n    PrimaryAttribute\n  },\n  computed: {\n    levelProgress(): string {\n      const level: Level = this.creature.level\n      return `${level.currentExperience  / level.requiredExperience * 100}%`\n    },\n    healthLevel(): string {\n      const attribute: Attribute = this.creature.characteristics.health\n      return `${attribute.currentValue / (attribute.maximum || 0) * 100}%`\n    }\n  },\n  methods: {\n    displayAttribute(attribute: Attribute) {\n      if (attribute.currentValue != attribute.maximum) {\n        return `${attribute.currentValue} / ${attribute.maximum}`\n      } else {\n        return attribute.currentValue\n      }\n    },\n  }\n})\n","import { render, staticRenderFns } from \"./Stats.vue?vue&type=template&id=b8b31b14&scoped=true&lang=pug&\"\nimport script from \"./Stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./Stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Stats.vue?vue&type=style&index=0&id=b8b31b14&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b8b31b14\",\n  null\n  \n)\n\ncomponent.options.__file = \"Stats.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel container\"},[_c('div',{staticClass:\"level cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.level.current))]),_c('div',{staticClass:\"note\"},[_vm._v(\"\"),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-bar bg-success\",style:({ width: _vm.levelProgress }),attrs:{\"role\":\"progressbar\"}})])])]),_c('div',{staticClass:\"hp cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.displayAttribute(_vm.creature.characteristics.health)))]),_c('div',{staticClass:\"bar\",style:({ height: _vm.healthLevel })})]),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"attack\",\"name\":\"\",\"full-name\":\"\",\"attr\":_vm.creature.characteristics.attack}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"defense\",\"name\":\"\",\"full-name\":\"\",\"attr\":_vm.creature.characteristics.defense}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"speed\",\"name\":\"\",\"full-name\":\"\",\"attr\":_vm.creature.characteristics.speed}}),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.levelMap.name))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { ImpactType } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Impacts',\n  props: ['impacts'],\n  methods: {\n    icon(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return 'blind'\n        case ImpactType.Stressed:\n          return 'weight'\n        case ImpactType.Loaded:\n          return 'weight'\n        case ImpactType.Overloaded:\n          return 'weight'\n      }\n    },\n    title(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return ''\n        case ImpactType.Stressed:\n          return ''\n        case ImpactType.Loaded:\n          return ''\n        case ImpactType.Overloaded:\n          return ''\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Impacts.vue?vue&type=template&id=436b0ad3&scoped=true&lang=pug&\"\nimport script from \"./Impacts.vue?vue&type=script&lang=ts&\"\nexport * from \"./Impacts.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"436b0ad3\",\n  null\n  \n)\n\ncomponent.options.__file = \"Impacts.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel\"},_vm._l((_vm.impacts),function(impact){return _c('div',{staticClass:\"impact-block\"},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/impacts/' + _vm.icon(impact) + '.svg'}}),_c('div',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title(impact))}})])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'IdleView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.close(IdleInputKey.Right)\n\n      case 'h':\n      case 'ArrowLeft':\n        return this.close(IdleInputKey.Left)\n\n      case 'k':\n      case 'ArrowUp':\n        return this.close(IdleInputKey.Up)\n\n      case 'j':\n      case 'ArrowDown':\n        return this.close(IdleInputKey.Down)\n\n      case 'y':\n        return this.close(IdleInputKey.UpLeft)\n      case 'u':\n        return this.close(IdleInputKey.UpRight)\n      case 'b':\n        return this.close(IdleInputKey.DownLeft)\n      case 'n':\n        return this.close(IdleInputKey.DownRight)\n\n      case 'H':\n        return this.close(IdleInputKey.Handle)\n\n      case 'i':\n        return this.close(IdleInputKey.Inventory)\n      case 'I':\n        return this.close(IdleInputKey.Bag)\n      case 't':\n        return this.close(IdleInputKey.Missile)\n      case ',':\n        return this.close(IdleInputKey.PickUp)\n      case 'd':\n        return this.close(IdleInputKey.Drop)\n      case 'D':\n        return this.close(IdleInputKey.Drink)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./IdleView.vue?vue&type=template&id=9a78bdc0&lang=pug&\"\nimport script from \"./IdleView.vue?vue&type=script&lang=ts&\"\nexport * from \"./IdleView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"IdleView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const option = doubleClickOption || this.picked\n      if (option) {\n        this.screen.pickProfession(option)\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case 'a':\n        this.picked = this.screen.options[0]\n        break\n      case 'b':\n        this.picked = this.screen.options[1]\n        break\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        return\n      }\n    },\n    iconPath(professionId: number) {\n      return 'assets/professions/' + [\n        'acrobatic.svg',\n        'button-finger.svg',\n        'disintegrate.svg',\n        'flying-fox.svg',\n        'amputation.svg',\n        'catch.svg',\n        'divert.svg',\n        'fruiting.svg',\n        'annexation.svg',\n        'conversation.svg',\n        'dodging.svg',\n        'grab.svg',\n        'arrest.svg',\n        'convince.svg',\n        'drinking.svg',\n        'journey.svg',\n        'back-forth.svg',\n        'coronation.svg',\n        'drop-weapon.svg',\n        'juggler.svg',\n        'backstab.svg',\n        'crafting.svg',\n        'drowning.svg',\n        'jump-across.svg',\n        'boot-stomp.svg',\n        'crush.svg',\n        'eating.svg',\n        'kindle.svg',\n        'bowman.svg',\n        'discussion.svg',\n        'expander.svg',\n        'kneeling.svg',\n      ][professionId]\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ProfessionPickingView.vue?vue&type=template&id=064b48bd&lang=pug&\"\nimport script from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ProfessionPickingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal text-center\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"content\"},_vm._l((_vm.screen.options),function(option){return _c('div',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option},\"dblclick\":function($event){_vm.close(option)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(option.id)}}),_c('div',{staticClass:\"name\"},[_vm._v(_vm._s(option.name))])])})),_c('div',{staticClass:\"bottom\"},[(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":_vm.close}},[_vm._v(\"\")]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    },\n    carryingWeight() {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return ` ${weight}  ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        if (this.screen.singleItemMode) {\n          this.screen.withItem(this.screen.positions[i])\n        } else if (this.selected.indexOf(i) >= 0) {\n          this.selected.splice(this.selected.indexOf(i), 1)\n        } else {\n          this.selected.push(i)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    itemWeight(position) {\n      return position.item.weight * position.count\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ItemsListingView.vue?vue&type=template&id=fe135db0&lang=pug&\"\nimport script from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ItemsListingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"subtitle my-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"container positions-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.positionStatus(position)},[_c('td',{staticClass:\"selected\"},[(_vm.positionSelected(index))?_c('div',{staticClass:\"sign\"},[_vm._v(\"+\")]):_vm._e()]),_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(position.item.name)+\" (\"+_vm._s(position.count)+\")\")]),_c('td',{staticClass:\"weight\"},[_vm._v(\"[\"+_vm._s(_vm.itemWeight(position))+\"kg]\")])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { OnisunTalentId } from 'src/onisun'\nimport { TalentStatus, Profession } from 'src/engine';\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null,\n      professionIndex: 0\n    }\n  },\n  computed: {\n    option() {\n      return this.screen.options[this.professionIndex]\n    },\n    profession(): Profession {\n      return this.option.profession\n    },\n    groupedTalents() {\n      let groups = new Array(5)\n      for (let i = 0; i < groups.length; i++) {\n        groups[i] = []\n      }\n\n      let availableIndex = 0\n\n      this.option.talents.forEach(talent => {\n        if (talent.status === TalentStatus.Available) {\n          Object.assign(talent, {\n            letter: String.fromCharCode(LETTER_OFFSET + availableIndex++)\n          })\n        }\n\n        groups[talent.depth].push(talent)\n      })\n\n      return groups\n    }\n  },\n  methods: {\n    close(doubleClickOption = undefined) {\n      const talent = doubleClickOption || this.picked\n\n      if (!talent || talent.status !== TalentStatus.Available) {\n        return\n      }\n\n      this.screen.pickTalent(this.profession.id, talent.id)\n      this.picked = null\n    },\n    pickTalent(talent) {\n      if (talent.status === TalentStatus.Available) {\n        this.picked = talent\n      }\n    },\n    onEvent(event: KeyboardEvent): void {\n      switch(event.key) {\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        this.groupedTalents.forEach(group => group.forEach(talent => {\n          if (talent.letter === event.key) {\n            this.picked = talent\n          }\n        }))\n\n        const index = parseInt(event.key)\n        if (index >= 1 && index <= this.screen.options.length) {\n          this.professionIndex = index - 1\n        }\n      }\n    },\n    talentTip(talent) {\n      let tip = `${talent.rank}/${talent.maxRank}`\n      if (talent.rank >= talent.maxRank) {\n        return tip\n      } else {\n        return `${talent.letter} ${tip}`\n      }\n    },\n    talentStatus(talent): string | undefined {\n      if (this.picked && this.picked.id === talent.id) {\n        return '-selected'\n      }\n      switch(talent.status) {\n      case TalentStatus.Available:\n        return '-available'\n      case TalentStatus.Unavailable:\n        return '-unavailable'\n      case TalentStatus.Completed:\n        return '-completed'\n      }\n    },\n    iconPath(talentId: OnisunTalentId): string {\n      switch(talentId) {\n        case OnisunTalentId.AttackerTwoHandedWeapons:\n          return 'AttackerTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerHeavyWeapons:\n          return 'AttackerHeavyWeapons.svg'\n        case OnisunTalentId.AttackerLightWeapons:\n          return 'AttackerLightWeapons.svg'\n        case OnisunTalentId.AttackerTwoWeapons:\n          return 'AttackerTwoWeapons.svg'\n        case OnisunTalentId.AttackerDoubleTwoHandedWeapons:\n          return 'AttackerDoubleTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerStrongGrip:\n          return 'AttackerStrongGrip.svg'\n      }\n    }\n  },\n  watch: {\n    professionIndex() {\n      this.picked =  null\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./TalentsTreeView.vue?vue&type=template&id=28a8fd04&lang=pug&\"\nimport script from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsTreeView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover screen-modal text-center\",attrs:{\"id\":\"talents-tree-container\"}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('b-tabs',{staticClass:\"tabs-list\",attrs:{\"card\":\"\"},model:{value:(_vm.professionIndex),callback:function ($$v) {_vm.professionIndex=$$v},expression:\"professionIndex\"}},_vm._l((_vm.screen.player.professions),function(profession){return _c('b-tab',{key:profession.id,attrs:{\"title\":profession.name,\"no-body\":\"\"}})})),_c('table',{staticClass:\"content\"},_vm._l((_vm.groupedTalents),function(group,i){return _c('tr',{key:i},_vm._l((group),function(talent,j){return _c('td',{key:j,staticClass:\"cell\"},[_c('div',{staticClass:\"talent-cell\",class:_vm.talentStatus(talent),attrs:{\"id\":j + 'talentTree-'+i,\"variant\":\"primary\"},on:{\"click\":function($event){_vm.pickTalent(talent)},\"dblclick\":function($event){_vm.close(talent)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/talents/' + _vm.iconPath(talent.id)}}),_c('span',{staticClass:\"level\"},[_vm._v(_vm._s(_vm.talentTip(talent)))]),_c('b-popover',{attrs:{\"target\":j + 'talentTree-'+i,\"triggers\":\"hover\",\"container\":\"talents-tree-container\"}},[[_c('p',{staticClass:\"name\"},[_vm._v(_vm._s(talent.name))]),_c('small',[_c('p',{staticClass:\"rank\"},[_vm._v(\" \"+_vm._s(talent.rank)+\"/\"+_vm._s(talent.maxRank))]),(_vm.talentStatus(talent) === '-unavailable')?_c('p',{staticClass:\"requirements\"},[_vm._v(\" \"+_vm._s(talent.depth * _vm.profession.depthCost)+\"   \"+_vm._s(_vm.profession.name))]):_vm._e(),_c('p',{staticClass:\"description\"},[_vm._v(_vm._s(talent.description))])])]],2)],1)])}))})),(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"default\"},on:{\"click\":function($event){_vm.close()}}},[_vm._v(\"\")]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  LeftHandSlot,\n  RightHandSlot,\n  BodySlot,\n  MissileSlot,\n  MissileWeaponSlot,\n  InventoryPresenterPosition,\n  Item,\n  Player,\n  Weapon,\n  Armor,\n  Damage,\n  DamageType,\n  Protection,\n  ProtectionType,\n} from '../../src/engine'\n\nimport {\n  displayItem,\n} from './../scene_tiles'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n    }\n  },\n  computed: {\n    player(): Player {\n      return this.screen.player\n    },\n    carryingWeight() {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return ` ${weight}  ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent): void {\n      switch (event.key) {\n      case ' ':\n      case 'Escape':\n        return this.screen.close()\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        const position = this.screen.positions[i]\n        if (position.item) {\n          this.screen.takeOff(position)\n        } else if (position.availableItems.length) {\n          this.screen.putOn(position)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionStatus(position: InventoryPresenterPosition) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    // TODO: Move this to module\n    positionDetails(position: InventoryPresenterPosition): string  | undefined {\n      if (!position.item || !position.item.canSeeDetails) {\n        return\n      }\n\n      if (position.item instanceof Weapon) {\n        return position.item.damages.map(this.showDamage).join(',')\n      } else if (position.item instanceof Armor) {\n        return position.item.protections.map(this.showProtection).join(',')\n      }\n\n      return\n    },\n    showDamage({ extra, dice: { times, max }, type }: Damage): string {\n      let base = `${this.showDamageType(type)} ${times}d${max}`\n\n      if (extra) {\n        base += `+${extra}`\n      }\n\n      return base\n    },\n    showDamageType(damageType: DamageType): string {\n      switch (damageType) {\n      case DamageType.Melee:\n        return 'Me'\n      case DamageType.Pierce:\n        return 'Pi'\n      case DamageType.Blunt:\n        return 'B'\n      case DamageType.Magic:\n        return 'Mg'\n      case DamageType.Pure:\n        return 'Pu'\n      default:\n        return 'unknown damage type'\n      }\n    },\n    showProtection({ type, value } : Protection): string {\n      switch (type) {\n      case ProtectionType.Light:\n        return `L${value}`\n      case ProtectionType.Medium:\n        return `M${value}`\n      case ProtectionType.Heavy:\n        return `H${value}`\n      case ProtectionType.Solid:\n        return `S${value}`\n      case ProtectionType.Unarmored:\n        return `U${value}`\n      default:\n        return 'unknown protection type'\n      }\n    },\n    displayBodyPart(bodyPart: BodySlot): string {\n      return bodyPart.name\n    },\n    displayItem(item: Item): string | undefined {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    itemName(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `${position.item.name} ${position.count > 1 ? `(${position.count})` : ''}`\n      } else {\n        return '-'\n      }\n    },\n    itemWeight(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `[${position.item.weight * position.count}kg]`\n      }\n    },\n    available(position: InventoryPresenterPosition) {\n      return position.item || position.availableItems.length\n    },\n    availableStatus(position: InventoryPresenterPosition) {\n      return this.available(position) ? '-available' : '-unavailable'\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./InventoryView.vue?vue&type=template&id=1d21223c&lang=pug&\"\nimport script from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nexport * from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./InventoryView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"InventoryView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"h4 title\"},[_vm._v(\"\")]),_c('div',{staticClass:\"subtitle my-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"content inventory-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.availableStatus(position)},[_c('td',{staticClass:\"slot\"},[_c('span',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('span',{staticClass:\"dash\"},[_vm._v(\"\")]),_c('span',{staticClass:\"part\"},[_vm._v(_vm._s(_vm.displayBodyPart(position.inventorySlot)))]),_c('span',{staticClass:\"separator\"},[_vm._v(\":\")])]),_c('td',{staticClass:\"name-slot\"},[_c('div',{staticClass:\"name\",class:_vm.positionStatus(position)},[_vm._v(_vm._s(_vm.itemName(position)))]),_c('small',{staticClass:\"details\",domProps:{\"textContent\":_vm._s(_vm.positionDetails(position))}})]),_c('td',{staticClass:\"weight\"},[_vm._v(_vm._s(_vm.itemWeight(position)))])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey, Direction } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'MissileView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case '>':\n        this.screen.nextTarget()\n        break\n      case '<':\n        this.screen.previousTarget()\n        break\n      case 't':\n        this.screen.attack()\n        break\n      case 'Escape':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MissileView.vue?vue&type=template&id=297d01f1&lang=pug&\"\nimport script from \"./MissileView.vue?vue&type=script&lang=ts&\"\nexport * from \"./MissileView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MissileView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { DieReason } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'DeathView',\n  props: ['screen'],\n  computed: {\n    message(): string {\n      switch (this.screen.dieReason) {\n      case DieReason.Attack:\n        return '     .    -  '\n      case DieReason.Missile:\n        return '    ,      '\n      case DieReason.Trap:\n        return '       '\n      case DieReason.Overloaded:\n        return '   ,    .'\n      default:\n        return ' ,      '\n      }\n    },\n    signature(): string {\n      return ` ${this.screen.playerName}  `\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./DeathView.vue?vue&type=template&id=600d877a&lang=pug&\"\nimport script from \"./DeathView.vue?vue&type=script&lang=ts&\"\nexport * from \"./DeathView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./DeathView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"DeathView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"h4 title\"},[_vm._v(\" \")]),_c('div',{staticClass:\"content mt-5\"},[_c('blockquote',{staticClass:\"blockquote text-center signature\"},[_c('p',{staticClass:\"mb-0\",domProps:{\"textContent\":_vm._s(_vm.message)}}),_c('footer',{staticClass:\"blockquote-footer\",domProps:{\"textContent\":_vm._s(_vm.signature)}})])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue,{ VueConstructor } from 'vue'\nimport * as _ from 'lodash'\n\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\nimport Stats from './Stats.vue'\nimport Impacts from './Impacts.vue'\n\nimport Idle from './views/IdleView.vue'\nimport ProfessionPickingView from './views/ProfessionPickingView.vue'\nimport ItemsListingView from './views/ItemsListingView.vue'\nimport TalentsTreeView from './views/TalentsTreeView.vue'\nimport InventoryView from './views/InventoryView.vue'\nimport MissileView from './views/MissileView.vue'\nimport DeathView from './views/DeathView.vue'\n\nimport { LevelMap, PresenterType } from '../src/engine'\n\nimport { Application } from '../src/onisun'\nimport { setInterval, clearInterval } from 'timers'\n\nexport default Vue.extend({\n  data() {\n    return {\n      game: new Application().game,\n      ts: Date.now(),\n      loopIntervalId: undefined\n    }\n  },\n  components: {\n    Impacts,\n    Logger,\n    Scene,\n    Stats,\n  },\n  computed: {\n    viewComponent(): VueConstructor | undefined {\n      switch (this.game.ai && this.game.ai.presenter && this.game.ai.presenter.type) {\n      case PresenterType.AbilitiesPicking:\n        return TalentsTreeView\n      case PresenterType.ProfessionPicking:\n        return ProfessionPickingView\n      case PresenterType.Idle:\n        return Idle\n      case PresenterType.ItemsListing:\n        return ItemsListingView\n      case PresenterType.Inventory:\n        return InventoryView\n      case PresenterType.Missile:\n        return MissileView\n      case PresenterType.Death:\n        return DeathView\n      }\n    }\n  },\n  methods: {\n    loop() {\n      this.game.turn()\n    },\n    onEvent(event: KeyboardEvent) {\n      const view = this.$refs.viewComponent\n      if (view) {\n        view.onEvent(event)\n      }\n    }\n  },\n  created() {\n    this.loopIntervalId = setInterval(this.loop, 10)\n    document.addEventListener('keydown', this.onEvent)\n  },\n  beforeDestroy() {\n    clearInterval(this.loopIntervalId)\n    document.removeEventListener('keydown', this.onEvent)\n  }\n})\n","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=209390e0&lang=pug&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{staticClass:\"container-fluid\",attrs:{\"id\":\"app\"}},[(_vm.game.player && !_vm.game.player.dead)?_c('Scene',{staticClass:\"scene\",attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player,\"pos\":_vm.game.currentMap.creaturePos(_vm.game.player)}}):_vm._e(),(_vm.game.player && !_vm.game.player.dead)?_c('Stats',{staticClass:\"player-stats\",attrs:{\"creature\":_vm.game.player,\"level-map\":_vm.game.currentMap}}):_vm._e(),_c('Logger',{staticClass:\"logger-panel\",attrs:{\"logger\":_vm.game.logger}}),_c('Impacts',{staticClass:\"effect-panel\",attrs:{\"impacts\":_vm.game.player.impacts}}),(_vm.game.player && _vm.game.player.dead)?_c('div',[_vm._v(\"You are dead\")]):_vm._e(),(_vm.game.ai)?_c(_vm.viewComponent,{ref:\"viewComponent\",tag:\"component\",attrs:{\"screen\":_vm.game.ai.presenter}}):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './App.vue'\nimport BootstrapVue from 'bootstrap-vue'\n\nVue.use(BootstrapVue)\n\nimport './application.scss'\n\nimport 'bootstrap/dist/css/bootstrap.css'\nimport 'bootstrap-vue/dist/bootstrap-vue.css'\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n"],"sourceRoot":""}