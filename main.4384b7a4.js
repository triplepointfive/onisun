!function(t){function e(e){for(var s,a,o=e[0],h=e[1],c=e[2],l=0,d=[];l<o.length;l++)a=o[l],r[a]&&d.push(r[a][0]),r[a]=0;for(s in h)Object.prototype.hasOwnProperty.call(h,s)&&(t[s]=h[s]);for(u&&u(e);d.length;)d.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],s=!0,o=1;o<i.length;o++){var h=i[o];0!==r[h]&&(s=!1)}s&&(n.splice(e--,1),t=a(a.s=i[0]))}return t}var s={},r={0:0},n=[];function a(e){if(s[e])return s[e].exports;var i=s[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/onisun/";var o=window.webpackJsonp=window.webpackJsonp||[],h=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=h;n.push([136,1]),i()}([function(t,e,i){"use strict";var s=i(86);i.d(e,"Attacker",function(){return s.a});var r=i(87);i.d(e,"Chaser",function(){return r.a});var n=i(88);i.d(e,"Descender",function(){return n.a});var a=i(89);i.d(e,"Escaper",function(){return a.a});var o=i(90);i.d(e,"Explorer",function(){return o.a});i(10);var h=i(51);i.d(e,"Loiter",function(){return h.a});var c=i(28);i.d(e,"MetaAI",function(){return c.c});var u=i(91);i.d(e,"Patrol",function(){return u.a});var l=i(97);i.d(e,"Picker",function(){return l.a});var d=i(37);i.d(e,"AINewLevelEvent",function(){return d.b}),i.d(e,"PlayerAI",function(){return d.d}),i.d(e,"PlayerBorgAI",function(){return d.e});var m=i(98);i.d(e,"SelfHealer",function(){return m.a});var p=i(99);i.d(e,"Thrower",function(){return p.a});i(100),i(38),i(39);var f=i(36);i.d(e,"AfterEvent",function(){return f.a});var g=i(101);i.d(e,"AttackEvent",function(){return g.a});var v=i(102);i.d(e,"CloseDoorEvent",function(){return v.a});var w=i(14);i.d(e,"DieEvent",function(){return w.a}),i.d(e,"DieReason",function(){return w.b});var y=i(103);i.d(e,"DrinkPotionEvent",function(){return y.a});i(53);var b=i(18);i.d(e,"HurtEvent",function(){return b.a});var T=i(1);i.d(e,"CreatureEvent",function(){return T.a}),i.d(e,"Reaction",function(){return T.c});i(54);var M=i(104);i.d(e,"MissileAttackEvent",function(){return M.a});var x=i(13);i.d(e,"MoveEvent",function(){return x.a});i(57);var P=i(105);i.d(e,"PickUpItemsEvent",function(){return P.a});var C=i(106);i.d(e,"PutOnItemEvent",function(){return C.a});var I=i(107);i.d(e,"RemoveImpactEvent",function(){return I.a});i(30),i(22);var E=i(40);i.d(e,"TakeOffItemEvent",function(){return E.a});var k=i(108);i.d(e,"TeleportationEvent",function(){return k.a});i(56);var S=i(41);i.d(e,"TrapEvent",function(){return S.a});var O=i(109);i.d(e,"UntrapEvent",function(){return O.a});i(21),i(58),i(110);var R=i(111);i.d(e,"dungeon",function(){return R.a});i(50),i(29);var D=i(8);i.d(e,"Calculator",function(){return D.a});var A=i(23);i.d(e,"DamageType",function(){return A.a});var N=i(112);i.d(e,"Gender",function(){return N.a});var B=i(34);i.d(e,"ImpactBunch",function(){return B.a}),i.d(e,"ImpactType",function(){return B.b});var W=i(113);i.d(e,"Level",function(){return W.a});var G=i(9);i.d(e,"Material",function(){return G.a});var F=i(114);i.d(e,"Pool",function(){return F.a});var _=i(31);i.d(e,"addCreatures",function(){return _.a}),i.d(e,"addDoors",function(){return _.b}),i.d(e,"centralize",function(){return _.c}),i.d(e,"safeWithMatchingTile",function(){return _.d}),i.d(e,"withEachTile",function(){return _.e}),i.d(e,"withMatchingTile",function(){return _.f});i(19),i(45);var j=i(115);i.o(j,"AICreature")&&i.d(e,"AICreature",function(){return j.AICreature}),i.o(j,"Ability")&&i.d(e,"Ability",function(){return j.Ability}),i.o(j,"Armor")&&i.d(e,"Armor",function(){return j.Armor}),i.o(j,"BagPresenter")&&i.d(e,"BagPresenter",function(){return j.BagPresenter}),i.o(j,"BaseInfoPresenter")&&i.d(e,"BaseInfoPresenter",function(){return j.BaseInfoPresenter}),i.o(j,"BodyArmor")&&i.d(e,"BodyArmor",function(){return j.BodyArmor}),i.o(j,"Boots")&&i.d(e,"Boots",function(){return j.Boots}),i.o(j,"Clan")&&i.d(e,"Clan",function(){return j.Clan}),i.o(j,"Color")&&i.d(e,"Color",function(){return j.Color}),i.o(j,"Corridor")&&i.d(e,"Corridor",function(){return j.Corridor}),i.o(j,"Door")&&i.d(e,"Door",function(){return j.Door}),i.o(j,"DrinkPresenter")&&i.d(e,"DrinkPresenter",function(){return j.DrinkPresenter}),i.o(j,"DropItemsPresenter")&&i.d(e,"DropItemsPresenter",function(){return j.DropItemsPresenter}),i.o(j,"Dungeon")&&i.d(e,"Dungeon",function(){return j.Dungeon}),i.o(j,"EquipmentPresenter")&&i.d(e,"EquipmentPresenter",function(){return j.EquipmentPresenter}),i.o(j,"Floor")&&i.d(e,"Floor",function(){return j.Floor}),i.o(j,"Game")&&i.d(e,"Game",function(){return j.Game}),i.o(j,"HistoryInfoPresenter")&&i.d(e,"HistoryInfoPresenter",function(){return j.HistoryInfoPresenter}),i.o(j,"IdlePresenter")&&i.d(e,"IdlePresenter",function(){return j.IdlePresenter}),i.o(j,"Inventory")&&i.d(e,"Inventory",function(){return j.Inventory}),i.o(j,"ItemGroup")&&i.d(e,"ItemGroup",function(){return j.ItemGroup}),i.o(j,"LevelMap")&&i.d(e,"LevelMap",function(){return j.LevelMap}),i.o(j,"LookPresenter")&&i.d(e,"LookPresenter",function(){return j.LookPresenter}),i.o(j,"Memory")&&i.d(e,"Memory",function(){return j.Memory}),i.o(j,"MenuComponent")&&i.d(e,"MenuComponent",function(){return j.MenuComponent}),i.o(j,"Missile")&&i.d(e,"Missile",function(){return j.Missile}),i.o(j,"MissileWeapon")&&i.d(e,"MissileWeapon",function(){return j.MissileWeapon}),i.o(j,"MultipleItemUseListingPresenter")&&i.d(e,"MultipleItemUseListingPresenter",function(){return j.MultipleItemUseListingPresenter}),i.o(j,"OneHandWeapon")&&i.d(e,"OneHandWeapon",function(){return j.OneHandWeapon}),i.o(j,"PickUpPresenter")&&i.d(e,"PickUpPresenter",function(){return j.PickUpPresenter}),i.o(j,"Player")&&i.d(e,"Player",function(){return j.Player}),i.o(j,"Point")&&i.d(e,"Point",function(){return j.Point}),i.o(j,"Potion")&&i.d(e,"Potion",function(){return j.Potion}),i.o(j,"Profession")&&i.d(e,"Profession",function(){return j.Profession}),i.o(j,"ProfessionPicker")&&i.d(e,"ProfessionPicker",function(){return j.ProfessionPicker}),i.o(j,"ProfessionPickingPresenter")&&i.d(e,"ProfessionPickingPresenter",function(){return j.ProfessionPickingPresenter}),i.o(j,"ProtectionType")&&i.d(e,"ProtectionType",function(){return j.ProtectionType}),i.o(j,"PutOnItemsPresenter")&&i.d(e,"PutOnItemsPresenter",function(){return j.PutOnItemsPresenter}),i.o(j,"Room")&&i.d(e,"Room",function(){return j.Room}),i.o(j,"Talent")&&i.d(e,"Talent",function(){return j.Talent}),i.o(j,"TalentStatus")&&i.d(e,"TalentStatus",function(){return j.TalentStatus}),i.o(j,"TalentsPickingPresenter")&&i.d(e,"TalentsPickingPresenter",function(){return j.TalentsPickingPresenter}),i.o(j,"TalentsPresenter")&&i.d(e,"TalentsPresenter",function(){return j.TalentsPresenter}),i.o(j,"TeleportationPresenter")&&i.d(e,"TeleportationPresenter",function(){return j.TeleportationPresenter}),i.o(j,"TileTypes")&&i.d(e,"TileTypes",function(){return j.TileTypes}),i.o(j,"TileVisitor")&&i.d(e,"TileVisitor",function(){return j.TileVisitor}),i.o(j,"TrapType")&&i.d(e,"TrapType",function(){return j.TrapType}),i.o(j,"Wall")&&i.d(e,"Wall",function(){return j.Wall}),i.o(j,"allAbilities")&&i.d(e,"allAbilities",function(){return j.allAbilities}),i.o(j,"dwarfRace")&&i.d(e,"dwarfRace",function(){return j.dwarfRace}),i.o(j,"humanRace")&&i.d(e,"humanRace",function(){return j.humanRace}),i.o(j,"leePath")&&i.d(e,"leePath",function(){return j.leePath}),i.o(j,"twoDimArray")&&i.d(e,"twoDimArray",function(){return j.twoDimArray});var H=i(16);i.d(e,"AICreature",function(){return H.a}),i.d(e,"Ability",function(){return H.b}),i.d(e,"Clan",function(){return H.c}),i.d(e,"allAbilities",function(){return H.e});var $=i(116);i.d(e,"Dungeon",function(){return $.a});var L=i(117);i.d(e,"Game",function(){return L.a});var U=i(118);i.d(e,"Inventory",function(){return U.a});i(12);var q=i(6);i.d(e,"Armor",function(){return q.a}),i.d(e,"BodyArmor",function(){return q.b}),i.d(e,"Boots",function(){return q.c}),i.d(e,"ItemGroup",function(){return q.f}),i.d(e,"Missile",function(){return q.g}),i.d(e,"MissileWeapon",function(){return q.h}),i.d(e,"OneHandWeapon",function(){return q.i}),i.d(e,"Potion",function(){return q.j}),i.d(e,"ProtectionType",function(){return q.k});var V=i(59);i.d(e,"LevelMap",function(){return V.a});i(60);var z=i(119);i.d(e,"Memory",function(){return z.a});var Y=i(120);i.d(e,"Player",function(){return Y.a});var X=i(121);i.d(e,"Profession",function(){return X.a}),i.d(e,"ProfessionPicker",function(){return X.b}),i.d(e,"Talent",function(){return X.c}),i.d(e,"TalentStatus",function(){return X.d});var J=i(32);i.d(e,"Color",function(){return J.a});var Q=i(4);i.d(e,"Corridor",function(){return Q.a}),i.d(e,"Door",function(){return Q.b}),i.d(e,"Floor",function(){return Q.c}),i.d(e,"Room",function(){return Q.d}),i.d(e,"TileTypes",function(){return Q.g}),i.d(e,"TileVisitor",function(){return Q.h}),i.d(e,"TrapType",function(){return Q.j}),i.d(e,"Wall",function(){return Q.k});i(55),i(62),i(63),i(64),i(65),i(66),i(67),i(68);var K=i(122);i.d(e,"BagPresenter",function(){return K.a});var Z=i(123);i.d(e,"BaseInfoPresenter",function(){return Z.a});i(17),i(52);var tt=i(124);i.d(e,"DrinkPresenter",function(){return tt.a});var et=i(125);i.d(e,"DropItemsPresenter",function(){return et.a});var it=i(42);i.d(e,"EquipmentPresenter",function(){return it.a});var st=i(126);i.d(e,"HistoryInfoPresenter",function(){return st.a});var rt=i(76);i.d(e,"IdlePresenter",function(){return rt.a});i(5);var nt=i(24);i.d(e,"MultipleItemUseListingPresenter",function(){return nt.a});var at=i(127);i.d(e,"LookPresenter",function(){return at.a});i(43),i(69);var ot=i(128);i.d(e,"PickUpPresenter",function(){return ot.a});var ht=i(129);i.d(e,"ProfessionPickingPresenter",function(){return ht.a});var ct=i(130);i.d(e,"PutOnItemsPresenter",function(){return ct.a});var ut=i(70);i.d(e,"TalentsPickingPresenter",function(){return ut.a});var lt=i(71);i.d(e,"TalentsPresenter",function(){return lt.a});var dt=i(131);i.d(e,"TeleportationPresenter",function(){return dt.a});i(49),i(61);var mt=i(132);i.d(e,"leePath",function(){return mt.a});var pt=i(3);i.d(e,"Point",function(){return pt.c}),i.d(e,"twoDimArray",function(){return pt.j})},function(t,e,i){"use strict";var s;i.d(e,"c",function(){return s}),i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n}),function(t){t[t.DIE=0]="DIE",t[t.HURT=1]="HURT",t[t.DODGE=2]="DODGE",t[t.NOTHING=3]="NOTHING",t[t.RESIST=4]="RESIST"}(s||(s={}));class r{}class n extends r{affectPlayer(t){return this.affectCreature(t)}}},,function(t,e,i){"use strict";i.d(e,"d",function(){return r}),i.d(e,"i",function(){return n}),i.d(e,"j",function(){return a}),i.d(e,"c",function(){return o}),i.d(e,"b",function(){return h}),i.d(e,"g",function(){return c}),i.d(e,"e",function(){return u}),i.d(e,"f",function(){return l}),i.d(e,"a",function(){return d}),i.d(e,"h",function(){return m});var s=i(2);class r{constructor(t,e,i,s){if(this.x=t,this.y=e,this.w=i,this.h=s,i<=0||s<=0)throw`Rect ${t} ${e} ${i} ${s}: size is negative or zero`}move(t,e){this.x+=t,this.y+=e}}const n=function(t){return Math.floor(Math.random()*t)},a=function(t,e,i){let s=Array(t);for(let r=0;r<t;r++){s[r]=new Array(e);for(let t=0;t<e;t++)s[r][t]=i(r,t)}return s};class o{constructor(t,e){this.x=t,this.y=e}eq(t){return this.x===t.x&&this.y===t.y}nextTo(t){return Math.abs(this.x-t.x)<=1&&Math.abs(this.y-t.y)<=1}copy(){return new o(this.x,this.y)}add(t){return new o(this.x+t.x,this.y+t.y)}wrappers(){return o.dxy.map(t=>this.add(t))}}o.dxy=[new o(-1,-1),new o(0,-1),new o(1,-1),new o(-1,0),new o(1,0),new o(-1,1),new o(0,1),new o(1,1)];class h{constructor(t){this.map=t,this.width=t.length,this.height=t[0].length}at(t,e){return this.map[t][e]}inRange(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height}each(t){this.map.forEach((e,i)=>{e.forEach((e,s)=>{t(e,i,s)})})}}const c=function(t,e){let i;if(e>0)for(let s=0;s<e;s++)i=t.pop(),t.unshift(i);else if(e<0)for(let s=e;s<0;s++)i=t.shift(),t.push(i);return t},u=function(t,e,i){let[s,r,n,a]=[t.x,e.x,t.y,e.y],h=Math.max(Math.abs(s-r),Math.abs(n-a));const c=new o((r-s)/h,(a-n)/h);for(;h>1;)s+=c.x,n+=c.y,i(Math.round(s),Math.round(n)),h-=1},l=function(t,e,i){u(t,e,i),i(e.x,e.y)};class d extends o{constructor(t,e){super(t,e)}multiple(t){return new o(this.x*t,this.y*t)}}d.up=new d(0,-1),d.down=new d(0,1),d.left=new d(-1,0),d.right=new d(1,0),d.upLeft=new d(-1,-1),d.upRight=new d(1,-1),d.downLeft=new d(-1,1),d.downRight=new d(1,1),d.all=[d.up,d.down,d.left,d.right,d.upLeft,d.upRight,d.downLeft,d.downRight];const m=function(t){const e=Object(s.min)(t);if(void 0!==e)return e;throw"minUnsafe got empty array"}},function(t,e,i){"use strict";i.d(e,"g",function(){return s}),i.d(e,"c",function(){return o}),i.d(e,"a",function(){return h}),i.d(e,"d",function(){return c}),i.d(e,"b",function(){return u}),i.d(e,"k",function(){return l}),i.d(e,"e",function(){return m}),i.d(e,"f",function(){return p}),i.d(e,"j",function(){return r}),i.d(e,"i",function(){return f}),i.d(e,"h",function(){return g});var s,r,n=i(29);!function(t){t[t.Wall=0]="Wall",t[t.Door=1]="Door",t[t.Floor=2]="Floor",t[t.StairwayDown=3]="StairwayDown",t[t.StairwayUp=4]="StairwayUp",t[t.Trap=5]="Trap",t[t.Trigger=6]="Trigger"}(s||(s={}));class a{constructor(t,e){this.key=t,this.kind=e}addItem(t,e){this.items||(this.items=new n.a),this.items.put(t,e)}free(t){return this.isFloor()&&this.passibleThrough(t)}isFloor(){return this.kind===s.Floor}visibleThrough(){return!0}passibleThrough(t){return t&&this.creature?this.kind!==s.Wall&&this.creature.id===t.id:this.kind!==s.Wall&&!this.creature}clone(t=this){let e=this.buildNew();return t.creature&&(e.creature=t.creature),e.items=t.items&&t.items.clone(),e}}class o extends a{visibleThrough(){return!0}visit(t){t.onFloor(this)}buildNew(){return new o(this.key,this.kind)}}class h extends o{}class c extends o{constructor(){super("R",s.Floor)}}class u extends a{constructor(t=Math.random()>=.5){super("D",s.Door),this.open=t}visibleThrough(){return this.open}visit(t){t.onDoor(this)}buildNew(){return new u(this.open)}}class l extends a{constructor(){super("W",s.Wall)}visibleThrough(){return!1}visit(t){t.onWall(this)}buildNew(){return new l}}class d extends a{constructor(t,e,i,s){super(t,e),this.currentMap=i,this.adjacentMapName=s}enterPos(t,e){return this._enterPos?this._enterPos:this._enterPos=e.matchStairs(t.name)}visibleThrough(){return!0}}class m extends d{constructor(t,e){super(">",s.StairwayDown,t,e)}visit(t){t.onStairwayDown(this)}buildNew(){return new m(this.currentMap,this.adjacentMapName)}}class p extends d{constructor(t,e){super("<",s.StairwayUp,t,e)}visit(t){t.onStairwayUp(this)}buildNew(){return new p(this.currentMap,this.adjacentMapName)}}!function(t){t[t.AirBlow=0]="AirBlow",t[t.BareWire=1]="BareWire",t[t.FallingRock=2]="FallingRock",t[t.Hole=3]="Hole",t[t.Light=4]="Light",t[t.Teleportation=5]="Teleportation",t[t.Water=6]="Water"}(r||(r={}));class f extends a{constructor(t,e,i=!1){super("^",s.Trap),this.type=t,this.tile=e,this.revealed=i}visit(t){t.onTrap(this)}disarmTile({x:t,y:e},i,s,r){r.logger.succeededToUntrap(i),s.setTile(t,e,this.tile.clone(this))}}class g{onWall(t){this.default(t)}onFloor(t){this.default(t)}onStairwayDown(t){this.onStairway(t)}onStairwayUp(t){this.onStairway(t)}onDoor(t){this.default(t)}onTrigger(t){this.default(t)}onTrap(t){this.default(t)}onStairway(t){this.default(t)}default(t){}}},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return n}),i.d(e,"a",function(){return a});var s,r=i(0);!function(t){t[t.TalentsPicking=0]="TalentsPicking",t[t.Death=1]="Death",t[t.Idle=2]="Idle",t[t.ItemsListing=3]="ItemsListing",t[t.Missile=4]="Missile",t[t.ProfessionPicking=5]="ProfessionPicking",t[t.Look=6]="Look",t[t.Teleportation=7]="Teleportation",t[t.PickHandleOption=8]="PickHandleOption",t[t.CharacterInfo=9]="CharacterInfo"}(s||(s={}));class n{constructor(t,e){this.levelMap=t,this.game=e,this.player=this.game.player}get tile(){return this.levelMap.creatureTile(this.player)}endTurn(){this.game.player.ai.endTurn(this.game,this.levelMap)}redirect(t){this.game.player.ai.redirect(t)}goIdle(){this.redirect(new r.IdlePresenter(this.levelMap,this.game))}}class a extends n{goToBaseInfo(){this.redirect(new r.BaseInfoPresenter(this.levelMap,this.game))}goToInventory(){this.redirect(new r.EquipmentPresenter(this.levelMap,this.game))}goToHistoryInfo(){this.redirect(new r.HistoryInfoPresenter(this.levelMap,this.game))}goToTalents(){this.redirect(new r.TalentsPresenter(this.levelMap,this.game))}}},function(t,e,i){"use strict";i.d(e,"m",function(){return s}),i.d(e,"f",function(){return r}),i.d(e,"e",function(){return a}),i.d(e,"d",function(){return u}),i.d(e,"j",function(){return l}),i.d(e,"g",function(){return m}),i.d(e,"h",function(){return p}),i.d(e,"i",function(){return f}),i.d(e,"k",function(){return o}),i.d(e,"a",function(){return g}),i.d(e,"b",function(){return v}),i.d(e,"c",function(){return w}),i.d(e,"l",function(){return y});var s,r,n,a,o,h=i(9);!function(t){t[t.WeaponOneHand=0]="WeaponOneHand",t[t.WearsOnHead=1]="WearsOnHead",t[t.WearsOnBody=2]="WearsOnBody",t[t.Ring=3]="Ring",t[t.Amulet=4]="Amulet",t[t.Throw=5]="Throw",t[t.Shoot=6]="Shoot",t[t.Boots=7]="Boots",t[t.Tool=8]="Tool",t[t.Belt=9]="Belt",t[t.Gloves=10]="Gloves",t[t.Gauntlets=11]="Gauntlets",t[t.Cloak=12]="Cloak",t[t.Scroll=13]="Scroll"}(s||(s={})),function(t){t[t.BodyArmor=0]="BodyArmor",t[t.OneHandWeapon=1]="OneHandWeapon",t[t.Consumable=2]="Consumable",t[t.Missile=3]="Missile",t[t.Potion=4]="Potion",t[t.MissileWeapon=5]="MissileWeapon",t[t.Boots=6]="Boots",t[t.Scrolls=7]="Scrolls",t[t.Hat=8]="Hat"}(r||(r={})),function(t){t[t.MissileRock=0]="MissileRock",t[t.Sling=1]="Sling",t[t.Bow=2]="Bow",t[t.Arrows=3]="Arrows"}(n||(n={})),function(t){t[t.None=0]="None",t[t.Slightly=1]="Slightly",t[t.Mostly=2]="Mostly",t[t.Fully=3]="Fully"}(a||(a={}));class c{constructor(t,e,i,s,r=[],n=c.getId()){this.group=t,this.name=e,this.weight=i,this.material=s,this.usages=r,this.id=n,this.impacts=[],this.corrosionLevel=a.None}static getId(){return this.lastId++}corrode(){switch(this.corrosionLevel){case a.None:return this.corrosionLevel=a.Slightly,!0;case a.Slightly:return this.corrosionLevel=a.Mostly,!0;case a.Mostly:return this.corrosionLevel=a.Fully,!0}return!1}get affectedWithWater(){return void 0!==this.material.affectedWithWater}get firm(){return this.material.firm}get insulator(){return this.material.insulator}get canSeeDetails(){return!0}clone(){return new c(this.group,this.name,this.weight,this.material)}groupsWith(t){return this.name===t.name}worksWith(t){return!1}canThrow(t){return!0}}c.lastId=0;class u extends c{constructor(t){super(r.Consumable,`${t.name}'s corpse`,t.weight,t.material),this.specie=t}}class l extends c{constructor(t,e=h.a.glass){super(r.Potion,t,.2,e),this.name=t}}class d extends c{constructor(t,e,i,s,r,n){super(t,e,i,s,n),this.rawDamages=r}get damages(){switch(this.corrosionLevel){case a.Slightly:return this.damageWithCorrosion(1);case a.Mostly:return this.damageWithCorrosion(2);case a.Fully:return this.damageWithCorrosion(4);default:return this.rawDamages}}damageWithCorrosion(t){return this.rawDamages.map(({dice:e,type:i,extra:s})=>({dice:e,type:i,extra:s-t}))}}class m extends d{constructor(t,e,i,s){super(r.Missile,t,e,s,i,[])}}class p extends d{constructor(t,e,i,n){super(r.MissileWeapon,t,e,n,i,[s.Shoot])}}class f extends d{constructor(t,e,i,n){super(r.OneHandWeapon,t,e,i,n,[s.WeaponOneHand])}}!function(t){t[t.Light=0]="Light",t[t.Medium=1]="Medium",t[t.Heavy=2]="Heavy",t[t.Solid=3]="Solid",t[t.Unarmored=4]="Unarmored"}(o||(o={}));class g extends c{constructor(t,e,i,s,r,n){super(t,e,i,s,[n]),this.rawProtections=r}get protections(){switch(this.corrosionLevel){case a.Slightly:return this.protectionWithCorrosion(1);case a.Mostly:return this.protectionWithCorrosion(2);case a.Fully:return this.protectionWithCorrosion(4);default:return this.rawProtections}}protectionWithCorrosion(t){return this.rawProtections.map(({type:e,value:i})=>({type:e,value:i-t}))}}class v extends g{constructor(t,e,i,n){super(r.BodyArmor,t,e,i,n,s.WearsOnBody)}}class w extends g{constructor(t,e,i,n){super(r.Boots,t,e,i,n,s.Boots)}}class y extends c{constructor(t){super(r.Scrolls,t,.1,h.a.paper,[s.Scroll])}}},function(t,e,i){"use strict";i.d(e,"Application",function(){return d});var s=i(2),r=i(0),n=(i(6),i(44)),a=i(81),o=(i(26),i(35)),h=i(25),c=i(72);i.o(r,"Gender")&&i.d(e,"Gender",function(){return r.Gender}),i.o(r,"ItemGroup")&&i.d(e,"ItemGroup",function(){return r.ItemGroup}),i.o(r,"MenuComponent")&&i.d(e,"MenuComponent",function(){return r.MenuComponent}),i.o(r,"Point")&&i.d(e,"Point",function(){return r.Point}),i.o(r,"TileVisitor")&&i.d(e,"TileVisitor",function(){return r.TileVisitor}),i.o(r,"TrapType")&&i.d(e,"TrapType",function(){return r.TrapType}),i.o(r,"dwarfRace")&&i.d(e,"dwarfRace",function(){return r.dwarfRace}),i.o(r,"humanRace")&&i.d(e,"humanRace",function(){return r.humanRace}),i.d(e,"MenuComponent",function(){return c.b}),i.d(e,"dwarfRace",function(){return h.b}),i.d(e,"humanRace",function(){return h.c});i(46);const u={chance:.05,multiplier:2};class l extends r.Game{turn(){super.turn(),this.currentMap&&this.playerTurn&&this.player.ai.endTurn(this,this.currentMap)}get done(){return this.player.dead||this.turns>150}}class d{constructor(){this.menu=new c.a(r.Gender.Male,h.c,this)}titleGame(){let t=new r.Player(new r.Level([1,3,5,10,20]),new r.PlayerBorgAI(new n.a),{name:"Player",weight:80,clan:r.Clan.Player,abilities:r.allAbilities,protections:[],damages:[{type:r.DamageType.Pure,dice:{times:3,max:3},extra:1}],maxHealthValue:10,regenerationRate:1,regenerationValue:1,resistances:[],visionRadius:10,moveSpeed:20,attackSpeed:20,bodyControl:5,leavesCorpseRatio:0,material:r.Material.flesh,throwingDamages:[],race:Object(s.sample)(h.a)||h.c,gender:r.Gender.Male,eyeColor:r.Color.Aqua,hairColor:r.Color.Fuchsia,skinColor:r.Color.Purple,height:100,critical:u},12,12,15),e=new l(t,new o.c(t)),i=new a.a;return i.register(e),i.enter(e,t),e}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(2),r=i(0),n=i(32);class a{constructor(){}static withCritical(t,{chance:e,multiplier:i}){return Math.random()>e?t:t.map(({type:t,dice:{times:e,max:s},extra:r})=>({type:t,dice:{times:e,max:s*i},extra:r*i}))}static misses(t,e){return Math.random()>t/(t+Math.pow(.25*e,.8))}static lowerWeight(t,e=1){let i=0;for(let s=e;s<t;s++)this.chance(1,3)&&(i+=1);return Math.max(1,i)}static higherWeight(t,e=1){return t+e-this.lowerWeight(t,e)}static chance(t,e){return Object(s.random)(1,e)<=t}static dodges(t,e){return Math.random()<Math.atan(t/e)/Math.PI*2}static damage(t,e,i){if(t.every(({type:t,resistances:e})=>this.resistTo(t,e,i)))return{damage:0,resist:!0};return{damage:Object(s.sumBy)(t,({extra:t,dice:s,type:r,resistances:n})=>this.resistTo(r,n,i)?0:Math.floor(Math.max(0,t+this.dropDice(s)-this.protectionValue(r,e)))),resist:!1}}static resistTo(t,e,i){if(e&&Object(s.intersection)(i,e).length)return!0;switch(t){case r.DamageType.Melee:case r.DamageType.Pierce:case r.DamageType.Blunt:return Object(s.includes)(i,n.b.Intangible);case r.DamageType.Magic:return Object(s.includes)(i,n.b.MagicDamage);case r.DamageType.Pure:return!1}}static dropDice(t){return Object(s.sum)(Object(s.times)(t.times,()=>Object(s.random)(1,t.max)))}static protectionValue(t,e){return Object(s.sum)(e.map(({type:e,value:i})=>i*this.armorToDamageRatio(t,e)))}}a.armorToDamageRatio=((t,e)=>{switch(t){case r.DamageType.Melee:switch(e){case r.ProtectionType.Medium:return 2/3;case r.ProtectionType.Solid:return 4/3;default:return 1}case r.DamageType.Pierce:switch(e){case r.ProtectionType.Light:return.5;case r.ProtectionType.Medium:return 4/3;case r.ProtectionType.Solid:return 3;case r.ProtectionType.Unarmored:return.75;default:return 1}case r.DamageType.Blunt:switch(e){case r.ProtectionType.Medium:return 2;case r.ProtectionType.Solid:case r.ProtectionType.Unarmored:return.5;default:return 1}case r.DamageType.Magic:switch(e){case r.ProtectionType.Light:return 5/4;case r.ProtectionType.Medium:return.75;case r.ProtectionType.Heavy:return.5;case r.ProtectionType.Solid:return 3;default:return 1}case r.DamageType.Pure:return 0;default:throw"Got unknown type of damage!"}})},function(t,e,i){"use strict";var s,r;i.d(e,"b",function(){return s}),i.d(e,"a",function(){return r}),function(t){t[t.Corrosion=0]="Corrosion",t[t.Destroy=1]="Destroy"}(s||(s={})),function(t){t.cloth={affectedWithWater:void 0,firm:!1,fragile:!1,insulator:!1},t.flesh={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0},t.glass={affectedWithWater:void 0,firm:!1,fragile:!0,insulator:!1},t.iron={affectedWithWater:s.Corrosion,firm:!0,fragile:!1,insulator:!0},t.leather={affectedWithWater:void 0,firm:!1,fragile:!1,insulator:!1},t.paper={affectedWithWater:s.Destroy,firm:!1,fragile:!1,insulator:!0},t.stone={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0},t.wood={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0}}(r||(r={}))},function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"b",function(){return h}),i.d(e,"c",function(){return c});var s=i(3),r=i(16),n=i(13),a=i(0);class o{moveTo(t,e,i,s){return this.move(t,i,s,t=>e.eq(t))}move(t,e,i,s){const[r]=this.buildPath(t,e,s);if(r)return new n.a(i,e,r)}buildPath(t,e,i){return Object(a.leePath)(t.stageMemory(e),e.creaturePos(t),e=>e.tangible(t),i)}withinView(t,e,i){let r=Object(s.j)(t.width,t.height,()=>!1),n=[e];for(;n.length;){let e=[];n.forEach(s=>{if(!t.inRange(s))return;const n=t.at(s.x,s.y);n.visible&&!r[s.x][s.y]&&(r[s.x][s.y]=!0,i(s,n),s.wrappers().forEach(t=>e.push(t)))}),n=e}}enemies(t,e){return t.id!==e.id&&(t.clan===r.c.FreeForAll||e.clan===r.c.FreeForAll||(t.clan===r.c.Player&&e.clan===r.c.PlayerOnlyEnemy||e.clan===r.c.Player&&t.clan===r.c.PlayerOnlyEnemy))}}class h extends o{constructor(){super(...arguments),this.destination=void 0}act(t,e,i){if(!this.foundNewTarget(t,e)||!this.destination)return this.checkCurrentTile(t,e,i);const s=this.goTo(t,e,i,this.destination);if(s)return s;this.destination=void 0,this.onCantMove(t)}goTo(t,e,i,s){return this.moveTo(t,s,e,i)}checkCurrentTile(t,e,i){if(this.destination&&e.creaturePos(t).eq(this.destination))return this.destination=void 0,this.onReach(t,e,i)}onMove(t){}onReach(t,e,i){}onCantMove(t){}}class c extends h{constructor(t){super(),this.matcher=t}checkCurrentTile(t,e,i){let s=super.checkCurrentTile(t,e,i);if(s)return s;const r=e.creaturePos(t);return this.matcher(t.stageMemory(e).at(r.x,r.y))?(this.destination=void 0,this.onReach(t,e,i)):void 0}foundNewTarget(t,e){const i=Object(a.leePath)(t.stageMemory(e),e.creaturePos(t),e=>e.tangible(t),(t,e)=>this.matcher(e),!0);return!!i.length&&(this.destination=i.pop(),!0)}}},,function(t,e,i){"use strict";i.d(e,"n",function(){return o}),i.d(e,"j",function(){return h}),i.d(e,"h",function(){return c}),i.d(e,"d",function(){return u}),i.d(e,"c",function(){return l}),i.d(e,"g",function(){return d}),i.d(e,"f",function(){return m}),i.d(e,"b",function(){return p}),i.d(e,"a",function(){return f}),i.d(e,"i",function(){return g}),i.d(e,"m",function(){return v}),i.d(e,"e",function(){return w}),i.d(e,"l",function(){return y}),i.d(e,"k",function(){return b}),i.d(e,"o",function(){return T});var s=i(6),r=i(2);class n{constructor(t,e,i){this.usages=t,this.useSingleItem=e,this.equipment=i,this.name="InventorySlot"}matchingItems(t){return t.cares().filter(t=>this.match(t.item))}get insulator(){return!(!this.equipment||!this.equipment.item.insulator)}get firm(){return!(!this.equipment||!this.equipment.item.firm)}equip(t,e){if(this.equipment)throw`Slot ${this.name} is already equipped with ${this.equipment.item}`;this.equipment={count:e,item:t}}takeOff(){if(!this.equipment)throw`Slot ${this.name} has nothing to take off`;this.equipment=void 0}match(t){return Object(r.intersection)(t.usages,this.usages).length>0}withPairItem(t,e){return t.filter(t=>t.item.worksWith(e))}}class a extends n{get affectedWithWater(){return void 0!==this.material.affectedWithWater}}class o extends a{constructor(t){super([s.m.WeaponOneHand],!0),this.material=t,this.name="Правая рука"}}class h extends a{constructor(t){super([s.m.WeaponOneHand],!0),this.material=t,this.name="Левая рука"}}class c extends a{constructor(t){super([s.m.WearsOnHead],!0),this.material=t,this.name="Голова"}}class u extends a{constructor(t){super([s.m.WearsOnBody],!0),this.material=t,this.name="Корпус"}}class l extends a{constructor(t){super([s.m.Boots],!0),this.material=t,this.name="Ботинки"}}class d extends n{constructor(){super([s.m.Gloves],!0),this.name="Перчатки"}}class m extends n{constructor(){super([s.m.Gauntlets],!0),this.name="Наручи"}}class p extends n{constructor(){super([s.m.Belt],!0),this.name="Пояс"}}class f extends n{constructor(){super([s.m.Amulet],!0),this.name="Амулет"}}class g extends n{constructor(){super([s.m.Ring],!0),this.name="Левый палец"}}class v extends n{constructor(){super([s.m.Ring],!0),this.name="Правый палец"}}class w extends n{constructor(){super([s.m.Cloak],!0),this.name="Плащ"}}class y extends n{constructor(){super([s.m.Shoot],!0),this.name="Метательное"}matchingItems(t){let e=super.matchingItems(t),i=t.missileSlot.equipment;return i?this.withPairItem(e,i.item):e}}class b extends n{constructor(){super([s.m.Throw],!1),this.name="Снаряды"}matchingItems(t){let e=t.cares(),i=t.missileWeaponSlot.equipment;return i?this.withPairItem(e,i.item):e}}class T extends n{constructor(){super([s.m.Tool],!0),this.name="Инструмент"}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(1),r=i(4),n=i(0);class a extends r.h{constructor(t,e,i,s){super(),this.pos=t,this.creature=e,this.levelMap=i,this.game=s,this.reaction=n.Reaction.NOTHING}onTrap(t){this.reaction=t.activate(this.pos,this.game,this.levelMap,this.creature)}onTrigger(t){t.activate(this.game,this.levelMap,this.creature)}}class o extends s.a{constructor(t,e,i,s=e){super(),this.game=t,this.levelMap=e,this.nextPoint=i,this.nextLevel=s}affectCreature(t){const e=this.levelMap.creaturePos(t);this.nextLevel.name!==this.levelMap.name?(this.levelMap.removeCreature(t),this.nextLevel.addCreature(this.nextPoint,t)):(this.levelMap.at(e.x,e.y).creature=void 0,this.levelMap.at(this.nextPoint.x,this.nextPoint.y).creature=t);const i=new a(this.nextPoint,t,this.levelMap,this.game);return this.nextLevel.at(this.nextPoint.x,this.nextPoint.y).visit(i),i.reaction}affectPlayer(t){return this.nextLevel&&this.levelMap.name!==this.nextLevel.name?(this.levelMap.reset(),this.nextLevel.enter(),this.affectCreature(t),this.game.currentMap=this.nextLevel):this.affectCreature(t),n.Reaction.NOTHING}}},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return o});var s,r=i(1),n=i(6),a=i(37);!function(t){t[t.Attack=0]="Attack",t[t.Missile=1]="Missile",t[t.Trap=2]="Trap",t[t.Overloaded=3]="Overloaded"}(s||(s={}));class o extends r.a{constructor(t,e,i){super(),this.game=t,this.levelMap=e,this.reason=i}affectCreature(t){let e=this.levelMap.creatureTile(t);return this.levelMap.removeCreature(t),t.dead=!0,t.specie.leavesCorpseRatio>Math.random()&&e.addItem(new n.d(t.specie),1),t.inventoryItems.forEach(t=>e.addItem(t.item,t.count)),r.c.DIE}affectPlayer(t){return t.ai.pushEvent(new a.a(this.reason,this.levelMap,this.game)),t.dead=!0,this.game.playerTurn=!0,r.c.DIE}}},,function(t,e,i){"use strict";var s=i(2),r=i(0),n=i(36),a=i(29),o=i(34),h=i(49),c=i(4);const u=function(t,e,i,s){new h.a(t.x,t.y,e,s.width,s.height,new class extends c.h{constructor(t,e){super(),this.stage=t,this.pos=e,this.visible=!1}isSolid(t,e){return this.x=t,this.y=e,this.stage.at(t,e).visit(this),!this.visible}onDoor(t){this.default(t),this.visible=this.visible||this.pos.x===this.x&&this.pos.y===this.y}default(t){this.x&&this.y&&(this.visible=this.stage.visibleThrough(this.x,this.y))}}(s,t),(t,e,r)=>{i.at(t,e).see(s.at(t,e),r)}).calc()};var l,d,m=i(19);i.d(e,"c",function(){return l}),i.d(e,"b",function(){return d}),i.d(e,"e",function(){return p}),i.d(e,"d",function(){return f}),i.d(e,"a",function(){return g}),function(t){t[t.Player=0]="Player",t[t.PlayerOnlyEnemy=1]="PlayerOnlyEnemy",t[t.FreeForAll=2]="FreeForAll"}(l||(l={})),function(t){t[t.GoStairwayDown=0]="GoStairwayDown",t[t.Inventory=1]="Inventory",t[t.PutOn=2]="PutOn",t[t.Throwing=3]="Throwing"}(d||(d={}));const p=[d.GoStairwayDown,d.Inventory,d.PutOn,d.Throwing];class f{constructor(t,e=f.getId()){this.specie=t,this.id=e,this.stageMemories=new Map,this.dead=!1,this.health=new m.d(t)}static getId(){return this.lastId++}get name(){return this.specie.name}get clan(){return this.specie.clan}get protections(){return this.specie.protections}get throwDamages(){return this.specie.throwingDamages}get damages(){return this.specie.damages}can(t){return Object(s.includes)(this.specie.abilities,t)}on(t){return t.affectCreature(this)}get speed(){return this.specie.moveSpeed}stageMemory(t){const e=this.stageMemories.get(t.name);return e||this.visionMask(t)}visionMask(t){let e=this.stageMemories.get(t.name);return e?e.resetVisible():(e=new r.Memory(t.width,t.height),this.stageMemories.set(t.name,e)),u(t.creaturePos(this),this.visionRadius,e,t),e}get impactsBunch(){return this._impactsBunch||(this._impactsBunch=new r.ImpactBunch),this._impactsBunch}hasImpact(t){return Object(s.includes)(this.impacts,t)}addConstImpact(t,e){this.impactsBunch.addConstImpact(t,e)}addImpact(t,e){this.impactsBunch.addImpact(t,e)}removeConstImpact(t,e){this.impactsBunch.removeConstImpact(t,e)}removeImpact(t){this.impactsBunch.removeImpact(t)}get visionRadius(){return this.hasImpact(o.b.Blind)?0:this.specie.visionRadius}get bodyControl(){return this.specie.bodyControl}get impacts(){return this.impactsBunch.activeImpacts}hasResistance(t){return Object(s.includes)(this.resistances,t)}get resistances(){return this.specie.resistances}get weightWithCarryings(){return this.specie.weight}statsTurn(){this.health.turn(),this._impactsBunch&&this._impactsBunch.turn()}}f.lastId=0;class g extends f{constructor(t,e,i=f.getId()){super(e,i),this.ai=t}act(t,e){this.statsTurn(),this.visionMask(t);const i=this.ai.act(this,t,e);return i&&this.on(i),this.on(new n.a(t,e)),this.speed}get missile(){if(this.specie.throwingItem)return{item:this.specie.throwingItem,count:1}}get inventoryItems(){return this.bag?this.bag.bunch:[]}addItem(t,e){this.bag||(this.bag=new a.a),this.bag.put(t,e)}removeItem(t,e){if(!this.bag)throw`Creature ${this.name} tried to remove item ${t.name} but it does not present`;this.bag.remove(t,e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n});var s,r=i(5);!function(t){t[t.Base=0]="Base",t[t.Talents=1]="Talents",t[t.Equipment=2]="Equipment",t[t.History=3]="History"}(s||(s={}));class n extends r.a{constructor(t,e){super(t,e)}get type(){return r.c.CharacterInfo}get specie(){return this.game.player.specie}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(1),r=i(14),n=i(8);class a extends s.a{constructor(t,e,i,s){super(),this.damages=t,this.dieReason=e,this.levelMap=i,this.game=s}get damage(){if(this.doneDamage)return this.doneDamage;throw"HurtEvent.damage called but there is no done damage"}affectCreature(t){const{damage:e,resist:i}=n.a.damage(this.damages,t.protections,t.resistances);return this.doneDamage=e,i?s.c.RESIST:e>=t.health.currentValue?(t.on(new r.a(this.game,this.levelMap,this.dieReason)),s.c.DIE):e<=0?s.c.NOTHING:(t.health.decrease(e),s.c.HURT)}}},function(t,e,i){"use strict";i.d(e,"e",function(){return r}),i.d(e,"a",function(){return n}),i.d(e,"d",function(){return a}),i.d(e,"f",function(){return o}),i.d(e,"b",function(){return h}),i.d(e,"c",function(){return c});var s=i(50);class r{constructor(t,e=1,i=0){this.base=t,this.rate=e,this.extra=i}get current(){return this.base*this.rate-this.extra}add(t){this.base+=t}subtract(t){this.base-=t}}class n{constructor(t,e){this.strength=t,this.constitution=e,this.strengthRatio=5,this.constitutionRatio=3,this.base=10}recalculate(t,e){this.strength=t,this.constitution=e}get stressed(){return this.base+this.strength*this.strengthRatio+this.constitution*this.constitutionRatio}get loadedStart(){return 1.5*this.stressed}get overloadedStart(){return 2*this.loadedStart}get flattenedStart(){return 3*this.overloadedStart}}class a extends s.a{constructor(t,e=0,i=t.maxHealthValue){super(t.maxHealthValue,i),this.currentTurn=e,this.regenerationRate=t.regenerationRate,this.regenerationValue=t.regenerationValue}turn(){this.currentTurn+=1,this.currentTurn>=this.regenerationRate&&(this.currentTurn=0,this.increase(this.regenerationValue))}}class o extends r{get meleeAdjustment(){return this.current<5?-2:this.current>10?Math.floor((this.current-10)/2):0}}class h extends r{get levelUpHPBonus(){return this.current<3?-2:this.current<6?-1:this.current<12?0:this.current<15?1:this.current<18?2:this.current<20?3:4}}class c extends r{get bodyControlAdjustment(){return this.current<5?-2:this.current>10?Math.floor(.9*(this.current-10)):0}get missileAdjustment(){return this.current<5?-2:this.current>10?Math.floor((this.current-10)/2):0}}},,function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e){super(),this.levelMap=t,this.game=e}playerSees(t){let{x:e,y:i}=this.levelMap.creaturePos(t);return this.game.player.stageMemory(this.levelMap).at(e,i).visible}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t){super(),this.levelMap=t}affectCreature(t){let e=t.stageMemory(this.levelMap);return this.levelMap.creaturePos(t).wrappers().forEach(({x:t,y:i})=>{e.at(t,i).see(this.levelMap.at(t,i),0)}),s.c.NOTHING}}},function(t,e,i){"use strict";var s;i.d(e,"a",function(){return s}),function(t){t[t.Melee=0]="Melee",t[t.Pierce=1]="Pierce",t[t.Blunt=2]="Blunt",t[t.Magic=3]="Magic",t[t.Pure=4]="Pure"}(s||(s={}))},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return a});var s=i(5);class r extends s.b{constructor(t,e){super(t,e),this.positions=[],this.initPositions()}get type(){return s.c.ItemsListing}close(){this.goIdle()}}class n extends r{get singleItemMode(){return!0}}class a extends r{get singleItemMode(){return!1}}},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n});const s={name:"human",primaryAttributes:{strength:8,dexterity:8,constitution:7,intelligence:7,wisdom:6,charisma:9}},r={name:"human",primaryAttributes:{strength:10,dexterity:7,constitution:9,intelligence:5,wisdom:7,charisma:7}},n=[s,r]},function(t,e,i){"use strict";var s=i(0);var r=i(9);i.d(e,"b",function(){return c}),i.d(e,"d",function(){return u}),i.d(e,"e",function(){return l}),i.d(e,"c",function(){return d}),i.d(e,"a",function(){return m});class n extends s.Missile{worksWith(t){return t instanceof o}}class a extends s.Missile{worksWith(t){return t instanceof h}canThrow(t){return!!t.inventory.missileWeaponSlot.equipment}}class o extends s.MissileWeapon{worksWith(t){return t instanceof n}}class h extends s.MissileWeapon{worksWith(t){return t instanceof a}}const c=()=>new h("Обычный лук",1,[{type:s.DamageType.Pierce,dice:{times:1,max:3},extra:3}],r.a.wood),u=()=>new n("Маленький камень",.3,[{type:s.DamageType.Blunt,dice:{times:1,max:3},extra:2}],r.a.stone),l=()=>new a("Деревянная стрела",.2,[{type:s.DamageType.Pierce,dice:{times:1,max:4},extra:3}],r.a.wood),d=()=>new a("Железная стрела",.25,[{type:s.DamageType.Pierce,dice:{times:2,max:3},extra:3}],r.a.iron);new s.Pool([[1,()=>new s.OneHandWeapon("Катана",1,r.a.iron,[{type:s.DamageType.Melee,dice:{times:5,max:2},extra:0}])],[7,()=>new s.OneHandWeapon("Кинжал",.8,r.a.iron,[{type:s.DamageType.Melee,dice:{times:1,max:3},extra:2}])]]),new s.Pool([[1,()=>new s.BodyArmor("Кольчуга",5,r.a.iron,[{type:s.ProtectionType.Medium,value:3}])],[5,()=>new s.BodyArmor("Латы",3,r.a.iron,[{type:s.ProtectionType.Heavy,value:5}])],[10,()=>new s.BodyArmor("Роба",1,r.a.iron,[{type:s.ProtectionType.Unarmored,value:1}])],[100,()=>new class extends s.Potion{constructor(){super("Зелье лечения")}onDrink(t){t.player.health.increase(5)}}]]);class m extends s.Boots{constructor(){super("Кроссовки скорости света",.1,r.a.cloth,[]),this.impacts=[s.ImpactType.Blind]}}},,function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"b",function(){return n}),i.d(e,"c",function(){return a});var s=i(10);class r{constructor(t){this.game=t,this.player=t.player,this.logger=t.logger}}class n extends r{constructor(t,e){super(e),this.items=t}run(){}}class a extends s.a{constructor(t){super(),this.aiToRun=t,this.events=[]}pushEvent(t){this.events.push(t)}resetEvents(){this.events=[]}runEvents(){let t=!1;return this.events.forEach(e=>{t=!0,e.run()}),this.resetEvents(),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(2);class r{constructor(){this.bunch=[]}find(t){return this.bunch.find(e=>e.item.groupsWith(t))}remove(t,e){const i=this.find(t);void 0!==i&&(i.count===e?Object(s.remove)(this.bunch,t=>t.item.groupsWith(i.item)):i.count-=e)}put(t,e){const i=this.bunch.find(e=>e.item.groupsWith(t));i?i.count+=e:this.bunch.push({count:e,item:t})}clone(){let t=new r;return this.bunch.forEach(e=>{t.put(e.item,e.count)}),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(1),r=i(40);class n extends s.a{constructor(t,e,i){super(),this.slot=t,this.count=e,this.game=i}affectCreature(t){return s.c.NOTHING}affectPlayer(t){if(!this.slot.equipment)throw`RemoveItemEvent: ${this.slot.name} has no equipment`;return this.slot.equipment.count===this.count?t.on(new r.a(this.slot,this.game)):(this.slot.equipment.count-=this.count,s.c.NOTHING)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return a}),i.d(e,"c",function(){return o}),i.d(e,"f",function(){return h}),i.d(e,"d",function(){return c}),i.d(e,"e",function(){return u});var s=i(3),r=i(2);const n=function(t,e,i=(()=>!0)){for(let s=1;s<t.height-1;s++)for(let r=1;r<t.width-1;r++){const n=t.at(r,s),a=t.at(r,s-1),o=t.at(r,s+1),h=t.at(r-1,s),c=t.at(r+1,s);i()&&"C"===n.key&&("D"!==h.key&&"D"!==c.key&&"D"!==a.key&&"D"!==o.key&&("R"!==h.key&&"R"!==c.key&&"R"!==a.key&&"R"!==o.key||("W"===h.key&&"W"===c.key||"W"===a.key&&"W"===o.key)&&t.setTile(r,s,e())))}return t},a=function(t,e,i){for(let r=1;r<e.width-1;r++)for(let n=1;n<e.height-1;n++)e.at(r,n).passibleThrough()&&Math.random()<t&&e.addCreature(new s.c(r,n),i.pick(null));return e},o=function(t){let e=t.width,i=t.height,r=0,n=0;for(let s=1;s<t.height-1;s++)for(let a=1;a<t.width-1;a++)t.at(a,s).passibleThrough()&&(n=Math.max(s,n),r=Math.max(a,r),i=Math.min(s,i),e=Math.min(a,e));const a=Math.floor((t.width-(r-e))/2)-e,o=Math.floor((t.height-(n-i))/2)-i;return Object(s.g)(t.map,a),t.map.forEach(t=>Object(s.g)(t,o)),t},h=function(t,e,i){let s=t.width*t.height;for(;s>0;){const n=Object(r.random)(0,t.width-1),a=Object(r.random)(0,t.height-1);if(e(t.at(n,a)))return i(n,a),t;s--}throw"post add failed to add tile"},c=function(t,e){let i=t.width*t.height;for(;i>0;){const s=Object(r.random)(0,t.width-1),n=Object(r.random)(0,t.height-1),a=t.at(s,n);if(e(a))return{tile:a,x:s,y:n};i--}},u=function(t,e,i){t.each((t,s,r)=>{e(t)&&i(t,s,r)})}},function(t,e,i){"use strict";var s,r;i.d(e,"b",function(){return s}),i.d(e,"a",function(){return r}),function(t){t[t.Intangible=0]="Intangible",t[t.MagicDamage=1]="MagicDamage",t[t.TeleportationControl=2]="TeleportationControl",t[t.Insulator=3]="Insulator"}(s||(s={})),function(t){t.Maroon="maroon",t.Red="red",t.Orange="orange",t.Yellow="yellow",t.Olive="olive",t.Green="green",t.Purple="purple",t.Fuchsia="fuchsia",t.Lime="lime",t.Teal="teal",t.Aqua="aqua",t.Blue="blue",t.Navy="navy",t.Black="black",t.Gray="gray",t.Silver="silver",t.White="white"}(r||(r={}))},,function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return a});var s,r=i(2);!function(t){t[t.Blind=0]="Blind",t[t.Stressed=1]="Stressed",t[t.Loaded=2]="Loaded",t[t.Overloaded=3]="Overloaded"}(s||(s={}));class n{constructor(){this.constEffects=[],this.tempEffects=0}addTempEffect(t){this.tempEffects+=t}addConstEffect(t){this.constEffects.push(t)}removeTempEffect(){this.tempEffects=0}removeConstEffect(t){Object(r.remove)(this.constEffects,e=>e===t)}active(){return this.tempEffects>0||this.constEffects.length>0}turn(){this.tempEffects>=1&&(this.tempEffects-=1)}}class a{constructor(){this.impacts=new Map}get activeImpacts(){let t=[];return this.impacts.forEach((e,i)=>{e.active()&&t.push(i)}),t}addImpact(t,e){this.impactByType(t).addTempEffect(e)}removeImpact(t){this.impactByType(t).removeTempEffect()}addConstImpact(t,e){this.impactByType(t).addConstEffect(e)}removeConstImpact(t,e){this.impactByType(t).removeConstEffect(e)}turn(){this.impacts.forEach(t=>t.turn())}impactByType(t){let e=this.impacts.get(t);return void 0!==e?e:(e=new n,this.impacts.set(t,e),e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"b",function(){return o}),i.d(e,"c",function(){return h});var s,r=i(0),n=i(46);!function(t){t[t.Attacker=0]="Attacker",t[t.Defender=1]="Defender"}(s||(s={}));class a extends r.Profession{constructor(t=0,e=new n.b("twoHandedWeapons",0,0,5),i=new n.a("strongGrip",1,0,5)){super(s.Attacker,"warrior",t,0,[e,i]),this.twoHandedWeapons=e,this.strongGrip=i}get depthCost(){return 5}get grid(){return[[void 0,this.twoHandedWeapons,void 0],[void 0,this.strongGrip,void 0]]}}class o extends r.Profession{constructor(t=0){super(s.Defender,"defender",t,0,[])}get depthCost(){return 5}get grid(){return[]}}class h extends r.ProfessionPicker{constructor(t,e=new a,i=new o){super([e,i],3,6),this.attacker=e,this.defender=i}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(0),r=i(1);class n extends r.a{constructor(t,e){super(),this.levelMap=t,this.game=e}affectCreature(t){return r.c.NOTHING}affectPlayer(t){return t.removeConstImpact(s.ImpactType.Overloaded,"bag"),t.removeConstImpact(s.ImpactType.Stressed,"bag"),t.removeConstImpact(s.ImpactType.Loaded,"bag"),t.stuffWeight.current>t.carryingCapacity.flattenedStart?t.on(new s.DieEvent(this.game,this.levelMap,s.DieReason.Overloaded)):(t.stuffWeight.current>t.carryingCapacity.overloadedStart?t.addConstImpact(s.ImpactType.Overloaded,"bag"):t.stuffWeight.current>t.carryingCapacity.loadedStart?t.addConstImpact(s.ImpactType.Loaded,"bag"):t.stuffWeight.current>t.carryingCapacity.stressed&&t.addConstImpact(s.ImpactType.Stressed,"bag"),r.c.NOTHING)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return o}),i.d(e,"c",function(){return h}),i.d(e,"d",function(){return c}),i.d(e,"e",function(){return u});var s=i(0),r=i(52),n=i(28);class a extends n.a{constructor(t,e,i){super(i),this.level=t,this.levelMap=e}run(){this.level%5==0?this.game.player.ai.presenter=new s.ProfessionPickingPresenter(this.level,this.levelMap,this.game):this.game.player.ai.presenter=new s.TalentsPickingPresenter(this.level,this.levelMap,this.game)}}class o extends n.a{constructor(t,e,i){super(i),this.dieReason=t,this.levelMap=e}run(){this.game.player.rebuildVision(this.levelMap),this.game.playerTurn=!0,this.game.player.ai.presenter=new r.a(this.dieReason,this.levelMap,this.game)}}class h extends n.a{constructor(t,e){super(e),this.levelMap=t}run(){this.game.player.rebuildVision(this.levelMap),this.game.playerTurn=!0,this.game.player.ai.presenter=new s.TeleportationPresenter(this.levelMap,this.game)}}class c extends n.c{constructor(){super(...arguments),this.presenter=null,this.levelUps=0}act(t,e,i){this.presenter=new s.IdlePresenter(e,i),i.playerTurn=!0}endTurn(t,e){let i=this.events.pop();if(i)i.run();else if(t&&e){t.player.on(new s.AfterEvent(e,t));let i=this.events.pop();i?i.run():(t.player.ai.runEvents(),t.playerTurn=!1,this.presenter=null)}}redirect(t){this.presenter=t}}class u extends c{constructor(t){super(),this.ai=t}act(t,e,i){let s=this.ai.act(t,e,i);return i.playerTurn=!0,s}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(1),r=i(0);class n extends s.b{constructor(t,e,i){super(),this.actor=t,this.levelMap=e,this.game=i}affectPlayer(t){return t.level.add(1).forEach(e=>{t.ai.pushEvent(new r.AINewLevelEvent(e,this.levelMap,this.game))}),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e,i,s){super(),this.impactType=t,this.source=e,this.game=i,this.duration=s}affectCreature(t){return this.duration?t.addImpact(this.impactType,this.duration):t.addConstImpact(this.impactType,this.source),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(0),r=i(2);class n extends s.CreatureEvent{constructor(t,e){super(),this.slot=t,this.game=e}affectCreature(t){return s.Reaction.NOTHING}affectPlayer(t){const e=this.slot.equipment;if(void 0===e)throw`Can not take off item from ${this.slot.name} - nothing equipped`;return this.slot.takeOff(),this.onTakeOff(t,e.item),t.inventory.putToBag(e.item,e.count),this.game.logger.takeOff(e.item),s.Reaction.NOTHING}onTakeOff(t,e){e instanceof s.Armor&&e.protections.forEach(e=>{t.itemsProtections.splice(Object(r.findIndex)(t.itemsProtections,t=>t===e),1)}),e.impacts.forEach(i=>{t.on(new s.RemoveImpactEvent(i,this.game,e.name))})}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(21),r=i(8),n=i(1);class a extends s.a{constructor(t,e,i,s,r){super(e,i),this.trap=t,this.onCreatureDodge=s,this.onCreatureActivated=r,this.dodgeRatio=t.dodgeRatio}affectCreature(t){const e=this.playerSees(t);return e&&(this.trap.revealed=!0),this.dodges(t)?(this.onCreatureDodge(e,!1),n.c.DODGE):this.onCreatureActivated(e,!1)}affectPlayer(t){return this.trap.revealed=!0,this.dodges(t)?(this.onCreatureDodge(!0,!0),n.c.DODGE):this.onCreatureActivated(!0,!0)}dodges(t){return r.a.dodges(t.bodyControl,this.dodgeRatio)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(0),r=i(76),n=i(17);class a extends n.b{constructor(t,e){super(t,e),this.positions=[],this.takeTime=!1,this.rebuildPositions()}get page(){return n.a.Equipment}takeOff(t){this.player.on(new s.TakeOffItemEvent(t.inventorySlot,this.game)),this.takeTime=!0,this.rebuildPositions()}putOn(t){this.redirect(new s.PutOnItemsPresenter(e=>{this.player.on(new s.PutOnItemEvent(t.inventorySlot,e.item,this.game)),this.takeTime=!0,this.rebuildPositions(),this.redirect(this)},t.availableItems,this.levelMap,this.game))}close(){this.takeTime?this.endTurn():this.redirect(new r.a(this.levelMap,this.game))}rebuildPositions(){this.positions=this.player.inventory.slots().map(t=>({inventorySlot:t,item:t.equipment&&t.equipment.item,count:t.equipment&&t.equipment.count,availableItems:t.matchingItems(this.player.inventory)}))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(5);class r extends s.b{constructor(t,e,i,s){super(t,e),this.effect=i,this.match=s,this.memory=this.player.stageMemory(this.levelMap),this.targetPos=t.creaturePos(this.player),this.drawTarget()}act(){this.removeEffect(),this.close()}get memoryTile(){return this.memory.at(this.targetPos.x,this.targetPos.y)}moveTarget(t){const e=this.targetPos.add(t);this.match(e)&&this.updateTarget(e)}removeEffect(){this.memory.at(this.targetPos.x,this.targetPos.y).effect=void 0}updateTarget(t){this.removeEffect(),this.targetPos=t.copy(),this.drawTarget()}drawTarget(){this.memoryTile.effect=this.effect}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(0);class r extends s.MetaAI{constructor(){super(),this.escaper=new s.Escaper,this.explorer=new s.Explorer,this.chaser=new s.Chaser,this.attacker=new s.Attacker,this.picker=new s.Picker,this.patrol=new s.Patrol,this.loiter=new s.Loiter,this.thrower=new s.Thrower,this.descender=new s.Descender}act(t,e,i){let r;return this.runEvents(),this.feelsGood(t)?(r=this.attacker.act(t,e,i))||(r=this.thrower.act(t,e,i))||(r=this.chaser.act(t,e,i))||(r=this.picker.act(t,e,i))||(r=this.explore(t,e,i)):this.healthCritical(t)&&(r=this.escaper.act(t,e,i))||(r=this.attacker.act(t,e,i))||(r=this.thrower.act(t,e,i))||(r=this.chaser.act(t,e,i))||(r=(new s.SelfHealer).act(t,e)),this.resetEvents(),r}feelsGood(t){return t.health.currentValue>.9*t.health.maximum}healthCritical(t){return t.health.currentValue<t.health.maximum/4}explore(t,e,i){let s;return(s=this.explorer.act(t,e,i))?t.dead||this.patrol.trackMovement(e.creaturePos(t),e.creatureTile(t)):(s=this.descender.act(t,e,i))||(s=this.patrol.act(t,e,i))||(s=this.loiter.act(t,e,i)),s}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(2);class r{constructor(){this.step=0,this.turns={}}add(t,e){const i=this.step+e;this.turns[i]?Object(s.includes)(this.turns[i],t)||this.turns[i].push(t):this.turns[i]=[t]}remove(t){Object(s.forEach)(this.turns,(e,i)=>{Object(s.remove)(e,e=>e===t)}),this.turns=Object(s.pickBy)(this.turns,t=>t.length>0)}next(){this.step=this.nextStep();const[t]=Object(s.pullAt)(this.turns[this.step],0);return 0===this.turns[this.step].length&&delete this.turns[this.step],void 0===t?this.next():t}actors(){if(0===Object(s.size)(this.turns))return[];this.step=this.nextStep();const t=this.turns[this.step];return delete this.turns[this.step],t}nextStep(){let t=Object(s.min)(Object(s.keys)(this.turns).map(t=>parseInt(t)));if(void 0===t)throw"Timeline.nextStep called when there is no ones turn";return t}}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return a});var s=i(0);class r extends s.Talent{constructor(t,e,i,s){super(t,e,i,s)}}class n extends r{onObtain(t){}}class a extends r{onObtain(t){}}},,function(t,e,i){},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t,e,i,s,r,n,a){this.startx=t,this.starty=e,this.radius=i,this.width=s,this.height=r,this.solidChecker=n,this.markVisible=a,this.doubleRadius=this.radius*this.radius}calc(){this.markVisible(this.startx,this.starty,1),this.solidChecker.isSolid(this.startx,this.starty)||[[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([t,e])=>{this.castLight(1,1,0,0,t,e,0),this.castLight(1,1,0,t,0,0,e)})}castLight(t,e,i,s,r,n,a){if(e<i)return;let o=0,h=!1;for(let c=t;c<=this.radius&&!h;c++){let t=-c;for(let u=-c;u<=0;u++){let l=Math.round(this.startx+u*s+t*r),d=Math.round(this.starty+u*n+t*a),m=(u-.5)/(t+.5),p=(u+.5)/(t-.5);if(l>=0&&d>=0&&l<this.width&&d<this.height&&!(e<p)){if(i>m)break;this.doubleDistance(u,t)<=this.doubleRadius&&this.markVisible(l,d,1-this.doubleDistance(u,t)/this.doubleRadius),h?this.solidChecker.isSolid(l,d)?o=p:(h=!1,e=o):this.solidChecker.isSolid(l,d)&&c<this.radius&&(h=!0,this.castLight(c+1,e,m,s,r,n,a),o=p)}}}}doubleDistance(t,e){return t*t+e*e}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(2);class r{constructor(t,e=t){this.max=t,this.current=e,this.modifiers=[]}get maximum(){return this.max}get atMax(){return this.max===this.current}decrease(t){this.current-=t}increase(t){this.current=Math.min(this.current+t,this.max)}constantIncrease(t){this.max+=t,this.increase(t)}constantDecrease(t){this.max-=t,this.decrease(t)}addModifier(t){this.modifiers.push(t)}removeModifier(t){Object(s.remove)(this.modifiers,e=>e===t)}get currentValue(){return this.current+Object(s.sum)(this.modifiers)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(10);class r extends s.a{act(t,e,i){const s=e.creaturePos(t);return this.move(t,e,i,t=>!s.eq(t))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(5);class r extends s.b{constructor(t,e,i){super(e,i),this.dieReason=t}get type(){return s.c.Death}get playerName(){return this.game.player.name}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e,i){super(),this.tile=t,this.items=e,this.game=i}affectCreature(t){return this.items.forEach(({item:e,count:i})=>{t.removeItem(e,i)}),s.c.NOTHING}affectPlayer(t){return this.items.forEach(({item:e,count:i})=>{t.removeItem(e,i),t.stuffWeight.subtract(e.weight*i),this.game.logger.droppedItem(e,i),this.tile.addItem(e,i)}),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.b{affectPlayer(t){return this.updateHealth(t),s.c.NOTHING}updateHealth(t){t.health.constantIncrease(t.constitution.levelUpHPBonus),t.health.maximum<1&&t.health.constantIncrease(1-t.health.maximum)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});class s{constructor(t){this.onDone=t}speed(){return-1}}class r extends s{constructor(t,e,i){super(i),this.item=t,this.frames=e}patchMemory(t){if(this.done())return;const[e]=this.frames.splice(0,1),i=t.at(e.x,e.y);i.visible?i.effect="-":this.patchMemory(t)}done(){return 0===this.frames.length}}},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(0),r=i(8),n=i(38),a=i(14),o=i(1);class h extends o.a{constructor(t,e,i,s){super(),this.victim=t,this.missile=e,this.levelMap=i,this.game=s}affectCreature(t){return this.process(t,!1)}affectPlayer(t){const e=this.process(t,!0);return e===o.c.DIE&&t.on(new n.a(this.victim,this.levelMap,this.game)),e}process(t,e){const[i,s]=this.throw(t);return this.game.logger.attackLogger.missile(s,t,this.victim,i,this.missile,e),i}throw(t){if(r.a.misses(t.bodyControl,this.victim.bodyControl))return[o.c.DODGE,0];const e=new s.HurtEvent(r.a.withCritical(t.throwDamages,t.specie.critical),a.b.Missile,this.levelMap,this.game);return[this.victim.on(e),e.damage]}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(1),r=i(21);class n extends r.a{constructor(t,e,i){super(e,i),this.door=t}affectCreature(t){return this.door.open?this.game.logger.doorLogger.alreadyOpen():(this.door.open=!0,this.game.logger.doorLogger.open()),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return c});var s=i(8),r=i(9),n=i(14),a=i(18),o=i(1),h=i(30);class c extends o.a{constructor(t,e,i){super(),this.damages=t,this.levelMap=e,this.game=i,this.playerReaction=o.c.NOTHING}affectCreature(t){return t.specie.material.affectedWithWater?t.on(new a.a(this.damages,n.b.Trap,this.levelMap,this.game)):o.c.RESIST}affectPlayer(t){return this.affectBodyParts(t),this.affectInventory(t),this.affectEquipment(t),this.playerReaction}affectEquipment(t){t.dead||t.inventory.slots().forEach(e=>{if(e.equipment&&e.equipment.item.affectedWithWater){const{item:i,count:n}=e.equipment;switch(i.material.affectedWithWater){case r.b.Corrosion:s.a.chance(1,3)&&i.corrode()&&this.game.logger.itemCorrode(i);break;case r.b.Destroy:if(s.a.chance(1,4)){const r=s.a.lowerWeight(n);this.game.logger.itemDestroyByWater(i,r),t.on(new h.a(e,r,this.game))}}}})}affectInventory(t){t.dead||t.inventory.cares().forEach(({count:e,item:i})=>{switch(i.material.affectedWithWater){case r.b.Corrosion:s.a.chance(1,4)&&i.corrode()&&this.game.logger.itemCorrode(i);break;case r.b.Destroy:if(s.a.chance(1,6)){const r=s.a.lowerWeight(e);this.game.logger.itemDestroyByWater(i,r),t.inventory.removeFromBag(i,r)}}})}affectBodyParts(t){t.inventory.bodyParts.forEach(e=>{if(!t.dead&&e.affectedWithWater)if(e.equipment)this.game.logger.waterBodyPartEquipmentResist(e,e.equipment.item),this.trackReaction(o.c.RESIST);else{let i=t.on(new a.a(this.damages,n.b.Trap,this.levelMap,this.game));this.game.logger.waterBodyPartDamage(e,i),this.trackReaction(i)}})}trackReaction(t){this.playerReaction===o.c.HURT&&t===o.c.DIE?this.playerReaction=o.c.DIE:this.playerReaction===o.c.HURT?this.playerReaction=o.c.HURT:this.playerReaction=t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(3),r=i(45),n=i(4),a=i(2);class o extends s.b{constructor(t,e){super(e),this.name=t,this.creatures=[],this.timeline=new r.a}reset(){this.timeline=new r.a}enter(){this.reset(),this.creatures.forEach(t=>this.timeline.add(t.id,t.speed))}creatureTile(t){let e;if(this.each(i=>{i.creature&&i.creature.id===t.id&&(e=i)}),!e)throw`Creature ${t.id} ${t.name} is not found on map ${this.name}`;return e}creaturePos(t){let e;if(this.each((i,r,n)=>{i.creature&&i.creature.id===t.id&&(e=new s.c(r,n))}),!e)throw`Creature ${t.id} ${t.name} is not found on map ${this.name}`;return e}addCreature(t,e){this.creatures.push(e),this.at(t.x,t.y).creature=e,this.timeline.add(e.id,e.speed)}removeCreature(t){let e=this.creaturePos(t);this.at(e.x,e.y).creature=void 0,Object(a.remove)(this.creatures,e=>e.id===t.id),this.timeline.remove(t.id)}visibleThrough(t,e){return this.map[t][e].visibleThrough()}passibleThrough(t,e){return this.map[t][e].passibleThrough()}setTile(t,e,i){this.map[t][e]=i}matchStairs(t){let e;if(this.each((i,r,a)=>{(i instanceof n.e||i instanceof n.f)&&i.adjacentMapName===t&&(e=new s.c(r,a))}),e)return e;throw`LevelMap ${this.name} failed to find stairs to ${t}`}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s,r=i(6),n=i(2),a=i(0);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.DANGER=3]="DANGER"}(s||(s={}));class o{constructor(t){this.messages=[],this.attackLogger=new p(this,t),this.doorLogger=new m(this,t),this.trapAirBlow=new c(this,t),this.trapBareWire=new l(this,t),this.trapFallingRock=new d(this,t),this.trapHole=new u(this,t)}reset(){this.messages=[]}killMessage(t,e,i,s){this.warning(`${s.name} got ${e} damage from ${i.name} causes them to die`)}throwKillMessage(t,e,i,s,r){this.warning(`${s.name} got ${e} damage from ${i.name} by ${r.name} causes them to die`)}ranIntoAnObstacle(){this.addMessage(s.DEBUG,"You ran into a wall")}howToHandle(){this.addMessage(s.DEBUG,"Don't know how to handle it")}noItemsToPickUp(){this.addMessage(s.DEBUG,"You don't see anything to pick up")}takeOff(t){this.addMessage(s.DEBUG,`You took off ${t.name}`)}putOn(t){this.addMessage(s.DEBUG,`You put on ${t.name}`)}drink(t){this.addMessage(s.INFO,`You drunk ${t.name}`)}nothingToShotWith(){this.addMessage(s.DEBUG,"You have nothing to shoot with")}needMissileWeapon(){this.addMessage(s.DEBUG,"Мне нужен лук или типа того")}creatureTeleported(t){this.addMessage(s.INFO,`${t.name} иcчез`)}creatureNotTeleported(t){this.addMessage(s.INFO,`${t.name} озарился светом, но ничего не произошло`)}creatureDodgesTeleportationTrap(t){this.addMessage(s.INFO,`${t.name} попал в ловушку телепортации но смог увернуться`)}playerTeleportationCaused(){this.addMessage(s.INFO,"Что-то заставило меня телепортироваться")}playerTeleported(){this.addMessage(s.INFO,"Яркая вспышка и я оказался в другом месте")}playerNotTeleported(){this.addMessage(s.INFO,"Я озарился ярким светом, но ничего не произошло")}playerTeleportedWhereTheyWere(){this.addMessage(s.INFO,"Я решил никуда не телепортироваться")}playerDodgesTeleportationTrap(){this.addMessage(s.INFO,"Я попал в ловушку телепортации но смог увернуться")}lightTrapActivated(t,e,i,r){i?this.addMessage(s.INFO,"Яркая вспышка света ослепила меня"):this.addMessage(s.INFO,`${r.name} озарился яркой вспышкой света`)}lightTrapDodge(t,e,i,r){i?this.addMessage(s.INFO,"Вспышка света чуть не ослепила меня"):this.addMessage(s.INFO,`${r.name} озарился яркой вспышкой света`)}canNotUntrap(){this.addMessage(s.INFO,"Не представляю, как это обезвредить")}failedToUntrap(t){this.addMessage(s.WARNING,"У меня не получилось обезвредить ловушку")}succeededToUntrap(t){this.addMessage(s.INFO,"Успешно обезвредил ловушку")}pickedUpItem(t,e){1===e?this.addMessage(s.INFO,`You picked up ${t.name}`):this.addMessage(s.INFO,`You picked up ${e} ${t.name}`)}droppedItem(t,e){1===e?this.addMessage(s.INFO,`You dropped a ${t.name}`):this.addMessage(s.INFO,`You dropped ${e} ${t.name}`)}waterTrapActivated(){this.info("Я попал в ловушку с водой")}waterBodyPartEquipmentResist(t,e){this.debug(`${e.name} защитил ${t.name} от воды`)}waterBodyPartDamage(t,e){switch(e){case a.Reaction.DIE:this.danger(`Вода попала мне на ${t.name}, рана не совместима с жизнью`);break;case a.Reaction.HURT:this.danger(`Вода обожгла мне ${t.name}`);break;case a.Reaction.NOTHING:case a.Reaction.RESIST:this.danger(`Вода попала мне на ${t.name}, но все обошлось`)}}waterTrapDamage(t,e,i,s,r){if(e)switch(s){case a.Reaction.DIE:this.danger(`${r.name} растворился в потоках воды`);break;case a.Reaction.DODGE:this.info(`${r.name} уклонился от потока воды`);break;case a.Reaction.HURT:this.warning(`${r.name} пострадал от воды`);break;case a.Reaction.NOTHING:case a.Reaction.RESIST:i||this.debug(`${r.name} был облит водой`)}}itemCorrode(t){switch(t.corrosionLevel){case r.e.Slightly:return this.info(`${t.name} немного заржавел`);case r.e.Mostly:return this.info(`${t.name} значительно проржавел`);case r.e.Fully:return this.warning(`${t.name} полностью проржавел`)}}itemDestroyByWater(t,e){this.warning(`${e} ${t.name} были уничтожены водой`)}debug(t){this.addMessage(s.DEBUG,t)}info(t){this.addMessage(s.INFO,t)}warning(t){this.addMessage(s.WARNING,t)}danger(t){this.addMessage(s.DANGER,t)}addMessage(t,e){const i=Object(n.last)(this.messages);i&&i.message===e?i.counter+=1:this.messages.push({level:t,message:e,counter:1})}}class h{constructor(t,e){this.logger=t,this.player=e}debug(t){this.logger.debug(t)}info(t){this.logger.info(t)}warning(t){this.logger.warning(t)}danger(t){this.logger.danger(t)}}class c extends h{dodge(t,e,i){e?this.info("Я увернулся от потока воздуха"):t&&this.info(`${i.name} увернулся от потока воздуха`)}resist(t,e,i){e?this.debug("Поток воздуха чуть не снес меня"):t&&this.debug(`${i.name} попал в поток воздуха`)}activate(t,e,i){e?this.info("Меня снесло потоком воздуха"):t&&this.info(`${i.name} снесло потоком воздуха`)}handBlow(t){this.warning(`Поток воздуха выбил ${t.name} у меня из руки`)}headBlow(t){this.warning(`Поток воздуха снял ${t.name} с моей головы`)}}class u extends h{dodge(t,e,i){e?this.warning("Я чуть не упал в яму"):t&&this.warning(`${i.name} чуть не упал в яму`)}activated(t,e,i){e?this.warning("Я упал в яму"):t&&this.warning(`${i.name} упал в яму`)}shallowActivated(t,e,i){e?this.warning("Я упал в неглубокую яму"):t&&this.warning(`${i.name} упал в неглубокую яму`)}}class l extends h{activated(t,e,i){this.info(`${i.name} наступил на оголенный провод`)}doNotWant(){this.info("Трогать оголенный провод руками так себе затея")}resist(){this.info("Я наступил на оголенный провод, но все обошлось")}}class d extends h{resist(t){return this.info("Камень упал мне на голову, но каска защитила меня")}ranOut(){return this.debug("Громкий щелчок, но ничего не произошло")}dodge(t,e,i,s){this.info(`${s.name} увернулся от ловушки`)}activate(t,e,i,s,r){this.info(`${r.name} попал в ловушку`)}}class m extends h{alreadyOpen(){this.debug("Door is already open")}alreadyClosed(){this.debug("Door is already closed")}open(){this.debug("I opened the door")}close(){this.debug("I closed the door")}}class p extends h{melee(t,e,i,s,r){switch(s){case a.Reaction.HURT:return this.debug(`${i.name} got ${t} damage from ${e.name}`);case a.Reaction.DIE:return this.warning(`${i.name} got ${t} damage from ${e.name} causes them to die`);case a.Reaction.NOTHING:return this.debug(`Удар пришелся по ${e.name} но остался незамеченным`);case a.Reaction.RESIST:return this.info(`${i.name} игнорирует урон`);case a.Reaction.DODGE:return this.debug(`${e.name} misses ${i.name}!`)}}missile(t,e,i,s,r,n){switch(s){case a.Reaction.HURT:return this.debug(`${i.name} got ${t} damage from ${e.name} by ${r.name}`);case a.Reaction.DIE:return this.warning(`${i.name} got ${t} damage from ${e.name} causes them to die`);case a.Reaction.NOTHING:return this.debug(`Удар пришелся по ${e.name} но остался незамеченным`);case a.Reaction.RESIST:return this.info(`${i.name} игнорирует урон`);case a.Reaction.DODGE:return this.debug(`${e.name} throws ${r.name} in ${i.name}, but misses!`)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(2);class r{constructor(){this.total=0,this.stat=new Map}add(t){const e=this.stat.get(t);e?this.stat.set(t,e+1):this.stat.set(t,1)}get all(){return Object(s.sortBy)(Array.from(this.stat),([t,e])=>t)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return l});var s=i(4),r=i(3),n=i(8),a=i(41),o=i(30),h=i(2),c=i(13),u=i(0);class l extends s.i{constructor(t,e=!1){super(s.j.AirBlow,t,e)}untrap(t,e,i,s){n.a.chance(4,6)?(s.logger.failedToUntrap(e),n.a.chance(3,5)&&this.activate(t,s,i,e)):this.disarmTile(t,e,i,s)}buildNew(){return new l(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?6:15}get creatureWeightBlowThreshold(){return 60}activate(t,e,i,s){return s.on(new a.a(this,i,e,(t,i)=>e.logger.trapAirBlow.dodge(t,i,s),(r,a)=>{if(s.weightWithCarryings>=this.creatureWeightBlowThreshold)e.logger.trapAirBlow.resist(r,a,s);else{let o=this.randomPos(t,i,n.a.higherWeight(3,1),t=>t.passibleThrough(s));o.eq(t)?e.logger.trapAirBlow.resist(r,a,s):(e.logger.trapAirBlow.activate(r,a,s),s.on(new c.a(e,i,o)))}if(a){const s=e.player,r=s.inventory;[[r.headSlot,3,t=>e.logger.trapAirBlow.headBlow(t)],[r.rightHandSlot,40/s.strength.current,t=>e.logger.trapAirBlow.handBlow(t)],[r.leftHandSlot,45/s.strength.current,t=>e.logger.trapAirBlow.handBlow(t)]].forEach(([r,a,h])=>{r.equipment&&a>=3&&n.a.chance(1,Math.round(a))&&(h(r.equipment.item),this.throwItem(t,i,r.equipment.item),s.on(new o.a(r,1,e)))})}return u.Reaction.NOTHING}))}throwItem(t,e,i){let s=this.randomPos(t,e,n.a.lowerWeight(5,1),t=>t.isFloor());e.at(s.x,s.y).addItem(i,1)}randomPos(t,e,i,s){let n=t,a=!1;return Object(h.shuffle)(r.a.all).forEach(o=>{if(!a){let h=!1;Object(r.f)(t,t.add(o.multiple(i)),(t,i)=>{!h&&e.inRange(new r.c(t,i))&&s(e.at(t,i))?(n=new r.c(t,i),a=!0):h=!0})}}),n}}},function(t,e,i){"use strict";i.d(e,"a",function(){return l});var s=i(4),r=i(8),n=i(18),a=i(14),o=i(23),h=i(21),c=i(1);class u extends h.a{constructor(t,e,i){super(e,i),this.trap=t}get hurtEvent(){return new n.a(this.damages,a.b.Trap,this.levelMap,this.game)}get damages(){return[{type:o.a.Pure,dice:{times:5,max:2},extra:5}]}affectCreature(t){const e=t.on(this.hurtEvent);return this.playerSees(t)&&(this.trap.revealed=!0),this.game.logger.trapBareWire.activated(this.playerSees(t),e,t),e}affectPlayer(t){if(this.trap.revealed=!0,t.inventory.bootsSlot.insulator)return this.game.logger.trapBareWire.resist(),c.c.RESIST;{const e=t.on(this.hurtEvent);return this.game.logger.trapBareWire.activated(!0,e,t),e}}}class l extends s.i{constructor(t,e=!1){super(s.j.BareWire,t,e)}untrap(t,e,i,s){e.inventory.glovesSlot.insulator?r.a.chance(1,7)?(s.logger.failedToUntrap(e),this.activate(t,s,i,e)):this.disarmTile(t,e,i,s):s.logger.trapBareWire.doNotWant()}buildNew(){return new l(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?5:10}activate(t,e,i,s){return r.a.dodges(s.bodyControl,this.dodgeRatio)?c.c.DODGE:s.on(new u(this,i,e))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(4),r=i(0),n=i(18),a=i(14),o=i(23);class h extends s.i{constructor(t,e,i=!1,r=5){super(s.j.FallingRock,e,i),this.newRock=t,this.missilesCount=r}buildNew(){return new h(this.newRock,this.tile,this.revealed,this.missilesCount)}get dodgeRatio(){return this.revealed?3:12}get damages(){return[{type:o.a.Blunt,extra:3,dice:{times:2,max:5}}]}untrap(t,e,i,s){if(r.Calculator.chance(1,4)){s.logger.failedToUntrap(e);const r=i.at(t.x,t.y).creature;r?this.activate(t,s,i,r):this.throwMissile(t,i,s.logger)}else this.disarmTile(t,e,i,s)}activate(t,e,i,s){return this.throwMissile(t,i,e.logger)?s.on(new r.TrapEvent(this,i,e,(t,i)=>e.logger.trapFallingRock.dodge(e.player,t,i,s),(t,o)=>{if(o&&e.player.inventory.headSlot.firm)return e.logger.trapFallingRock.resist(e.player),r.Reaction.RESIST;const h=s.on(new n.a(this.damages,a.b.Trap,i,e));return e.logger.trapFallingRock.activate(e.player,t,o,h,s),h})):r.Reaction.NOTHING}throwMissile(t,e,i){return this.missilesCount<=0?(i.trapFallingRock.ranOut(),!1):(this.missilesCount-=1,e.at(t.x,t.y).addItem(this.newRock(),1),!0)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i(0),r=i(13),n=i(22),a=i(4),o=i(18),h=i(23),c=i(14);class u extends a.i{constructor(t,e=!1){super(a.j.Hole,t,e)}buildNew(){return new u(this.tile,this.revealed)}untrap(t,e,i,s){s.logger.canNotUntrap()}get dodgeRatio(){return this.revealed?1:5}activate(t,e,i,r){return r.on(new s.TrapEvent(this,i,e,(t,i)=>e.logger.trapHole.dodge(t,i,r),(t,s)=>{let a=this.fallEvent(e,i);return a?(e.logger.trapHole.activated(t,s,r),r.on(a),r.on(new o.a([{type:h.a.Pure,dice:{times:3,max:2},extra:2}],c.b.Trap,i,e))):(e.logger.trapHole.shallowActivated(t,s,r),r.on(new n.a(i)))}))}fallEvent(t,e){let i=void 0;return Object(s.withEachTile)(e,()=>!0,n=>{if(n instanceof a.e){let a=t.getMap(n.adjacentMapName),o=void 0;(o=Object(s.safeWithMatchingTile)(a,t=>t.passibleThrough()))&&(i=new r.a(t,e,new s.Point(o.x,o.y),a))}}),i}}},function(t,e,i){"use strict";i.d(e,"a",function(){return c});var s=i(4),r=i(41),n=i(39),a=i(34),o=i(8),h=i(0);class c extends s.i{constructor(t,e=!1){super(s.j.Light,t,e)}untrap(t,e,i,s){o.a.chance(1,3)?(s.logger.failedToUntrap(e),this.activate(t,s,i,e)):this.disarmTile(t,e,i,s)}buildNew(){return new c(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?1:10}get duration(){return 10}activate(t,e,i,s){return s.on(new r.a(this,i,e,(t,i)=>e.logger.lightTrapDodge(e.player,t,i,s),(t,i)=>s.hasImpact(a.b.Blind)?h.Reaction.NOTHING:(e.logger.lightTrapActivated(e.player,t,i,s),s.on(new n.a(a.b.Blind,"trap",e,this.duration)))))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(0),r=i(4);class n extends r.i{constructor(t,e=!1){super(r.j.Teleportation,t,e)}untrap(t,e,i,s){s.logger.canNotUntrap()}buildNew(){return new n(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?3:10}activate(t,e,i,r){return r.on(new s.TrapEvent(this,i,e,(t,i)=>{i?e.logger.playerDodgesTeleportationTrap():t&&e.logger.creatureDodgesTeleportationTrap(r)},(t,n)=>r.on(new s.TeleportationEvent(i,e,!1))))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(4),r=i(0),n=i(23),a=i(58);class o extends s.i{constructor(t,e=!1){super(s.j.Water,t,e)}buildNew(){return new o(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?10:8}get damages(){return[{type:n.a.Pure,extra:5,dice:{times:2,max:2}}]}untrap(t,e,i,s){r.Calculator.chance(3,4)?(s.logger.failedToUntrap(e),r.Calculator.chance(1,4)&&this.activate(t,s,i,e)):this.disarmTile(t,e,i,s)}activate(t,e,i,s){return s.on(new r.TrapEvent(this,i,e,(t,i)=>e.logger.waterTrapDamage(e.player,t,i,r.Reaction.DODGE,s),(t,r)=>{r&&e.logger.waterTrapActivated();let n=s.on(new a.a(this.damages,i,e));return r||e.logger.waterTrapDamage(e.player,t,r,n,s),n}))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(5);class r extends s.b{constructor(t,e,i,s){super(e,i),this.options=t,this.withOption=s}get type(){return s.c.PickHandleOption}pick(t){this.withOption(t)}close(){this.goIdle()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(5),r=i(0),n=i(54),a=i(71);class o extends s.b{constructor(t,e,i){super(e,i),this.level=t,this.talentsPage=new a.a(e,i)}get type(){return s.c.TalentsPicking}pickTalent(t,e){if(e.status(t)!==r.TalentStatus.Available)throw`Talent ${e.name} for profession ${t.name} can not be upgraded`;e.upgrade(this.game),t.points+=1,this.player.on(new n.a),this.endTurn()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(17);class r extends s.b{get page(){return s.a.Talents}get professions(){return this.player.professions}}},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return d});var s,r=i(0),n=i(25),a=i(2);!function(t){t[t.MainMenu=0]="MainMenu",t[t.ChooseGenderMenu=1]="ChooseGenderMenu",t[t.ChooseRaceMenu=2]="ChooseRaceMenu",t[t.AttributesMenu=3]="AttributesMenu",t[t.AttributesSelectionMenu=4]="AttributesSelectionMenu"}(s||(s={}));class o{constructor(t){this.application=t}redirect(t){this.application.menu=t}}class h extends o{newGame(){this.redirect(new c(this.application))}get component(){return s.MainMenu}}class c extends o{get component(){return s.ChooseGenderMenu}withGender(t){this.redirect(new u(t,this.application))}random(){this.withGender(Object(a.sample)([r.Gender.Male,r.Gender.Female])||r.Gender.Female)}back(){this.application.menu=new h(this.application)}}class u extends o{constructor(t,e){super(e),this.gender=t}get component(){return s.ChooseRaceMenu}withRace(t){this.redirect(new l(this.gender,t,this.application))}random(){this.withRace(Object(a.sample)(n.a)||n.c)}back(){this.application.menu=new c(this.application)}}class l extends o{constructor(t,e,i){super(i),this.gender=t,this.race=e}get component(){return s.AttributesMenu}manually(){this.redirect(new d(this.gender,this.race,this.application))}back(){this.redirect(new u(this.gender,this.application))}}class d extends o{constructor(t,e,i){super(i),this.gender=t,this.race=e,this.attributeNames=Object.keys(this.race.primaryAttributes),this.racialAttributes=this.race.primaryAttributes,this.genderAttributes=this.calcGenderAttributes(t),this.baseAttributes=Object(a.mergeWith)({},this.racialAttributes,this.genderAttributes,(t,e)=>{if(t)return t+e})}get component(){return s.AttributesSelectionMenu}ready(){}back(){this.redirect(new l(this.gender,this.race,this.application))}calcGenderAttributes(t){return t===r.Gender.Male?{strength:1,dexterity:-1,constitution:0,intelligence:0,wisdom:0,charisma:0}:{strength:-1,dexterity:1,constitution:0,intelligence:0,wisdom:0,charisma:0}}}},function(t,e,i){},function(t,e,i){},function(t,e,i){},function(t,e,i){"use strict";var s=i(5),r=i(0),n=i(42),a=i(3);class o extends s.b{constructor(t,e){super(t,e),this.targetEnemyIndex=void 0,this.enemies=[],this.path=[],this.findEnemies(),this.memory=this.player.stageMemory(this.levelMap),this.targetPos=this.resetTargetId()}get type(){return s.c.Missile}nextTarget(){void 0!==this.targetEnemyIndex?(this.targetEnemyIndex+=1,this.targetEnemyIndex>=this.enemies.length&&(this.targetEnemyIndex=0),this.updateTarget(this.enemies[this.targetEnemyIndex])):this.resetTargetId()}previousTarget(){void 0!==this.targetEnemyIndex?(this.targetEnemyIndex-=1,this.targetEnemyIndex<0&&(this.targetEnemyIndex=this.enemies.length-1),this.updateTarget(this.enemies[this.targetEnemyIndex])):this.resetTargetId()}moveTarget(t){const e=this.targetPos.add(t);this.levelMap.at(e.x,e.y).visibleThrough()&&this.player.stageMemory(this.levelMap).at(e.x,e.y).visible&&(this.updateTarget(e),this.targetEnemyIndex=void 0)}attack(){this.targetPos.eq(this.levelMap.creaturePos(this.player))||this.player.on(new r.MissileAttackEvent(this.path,this.game,this.levelMap,()=>this.endTurn()))}close(){this.resetPath(),this.redirect(new f(this.levelMap,this.game))}resetTargetId(){let t;return this.enemies.length?(this.targetEnemyIndex=0,t=this.enemies[this.targetEnemyIndex]):(this.targetEnemyIndex=void 0,t=this.levelMap.creaturePos(this.player)),this.updateTarget(t),t}resetPath(){this.path.forEach(({x:t,y:e})=>this.memory.at(t,e).effect=void 0)}updateTarget(t){this.resetPath(),this.targetPos=t.copy(),this.drawPath()}drawPath(){this.path=[];let t=!1;const e=this.levelMap,i=this.levelMap.creaturePos(this.player);Object(a.f)(i,this.targetPos,(i,s)=>{e.at(i,s).passibleThrough()||(t=!0),this.path.push(new a.c(i,s)),this.memory.at(i,s).effect=t?"o":"x"})}findEnemies(){this.enemies=[],this.player.stageMemory(this.levelMap).each((t,e,i)=>{t.visible&&t.creature&&t.creature.id!==this.player.id&&this.enemies.push(new a.c(e,i))})}}var h=i(13),c=i(2),u=i(69),l=i(22),d=i(57);i.d(e,"a",function(){return f});class m extends r.TileVisitor{constructor(t,e,i){super(),this.position=t,this.game=e,this.levelMap=i,this.commands=[]}onStairway(t){const e=this.game.getMap(t.adjacentMapName);this.commands.push(["stairway",new h.a(this.game,this.levelMap,t.enterPos(this.levelMap,e),e)])}onTrap(t){t.revealed&&this.commands.push(["untrap",new r.UntrapEvent(this.position,t,this.levelMap,this.game)])}}class p extends m{onStairway(){}onDoor(t){t.open?this.commands.push(["closeDoor",new r.CloseDoorEvent(t,this.levelMap,this.game)]):this.commands.push(["openDoor",new d.a(t,this.levelMap,this.game)])}}class f extends s.a{get type(){return s.c.Idle}inventoryCommand(){this.redirect(new n.a(this.levelMap,this.game))}bagCommand(){this.redirect(new r.BagPresenter(this.levelMap,this.game))}stayCommand(){this.player.on(new l.a(this.levelMap)),this.endTurn()}dropCommand(){this.redirect(new r.DropItemsPresenter(this.levelMap,this.game))}drinkCommand(){this.redirect(new r.DrinkPresenter(this.levelMap,this.game))}lookCommand(){this.redirect(new r.LookPresenter(this.levelMap,this.game))}move(t){const e=this.levelMap.creaturePos(this.player).add(t),i=this.levelMap.at(e.x,e.y);i.passibleThrough(this.player)?this.player.on(new h.a(this.game,this.levelMap,e)):i.creature?this.player.on(new r.AttackEvent(i.creature,this.levelMap,this.game)):(this.game.logger.ranIntoAnObstacle(),this.player.stageMemory(this.levelMap).at(e.x,e.y).see(i,0)),this.endTurn()}pickUpCommand(){const t=this.tile,e=t.items;void 0===e||0===e.bunch.length?this.game.logger.noItemsToPickUp():1===e.bunch.length?(this.player.on(new r.PickUpItemsEvent(t,e.bunch,this.game)),this.endTurn()):this.redirect(new r.PickUpPresenter(this.levelMap,this.game))}missileCommand(){const t=this.player.inventory.missileSlot.equipment;t&&t.item?t.item.canThrow(this.player)?this.redirect(new o(this.levelMap,this.game)):this.game.logger.needMissileWeapon():this.game.logger.nothingToShotWith()}handleCommand(){let t=this.levelMap.creaturePos(this.player),e=new m(t,this.game,this.levelMap),i=new p(t,this.game,this.levelMap);this.tile.visit(e),t.wrappers().forEach(t=>{i.position=t,this.levelMap.at(t.x,t.y).visit(i)});const s=Object(c.concat)(e.commands,i.commands);switch(s.length){case 0:this.game.logger.howToHandle();break;case 1:this.player.on(s[0][1]),this.endTurn();break;default:this.redirect(new u.a(s,this.levelMap,this.game,([t,e])=>{this.player.on(e),this.endTurn()}))}}}},,,,,function(t,e,i){"use strict";var s=i(0),r=i(44),n=i(9);const a={chance:.05,multiplier:2},o=(t,e=[],i)=>new s.AICreature(new r.a,{name:t,weight:10,clan:s.Clan.PlayerOnlyEnemy,abilities:[],protections:e,damages:i,maxHealthValue:1,regenerationRate:5,regenerationValue:1,resistances:[],visionRadius:5,moveSpeed:20,attackSpeed:20,bodyControl:5,leavesCorpseRatio:50,material:n.a.flesh,throwingDamages:[],critical:a}),h=new s.Pool([[100,()=>o("Rat",[],[{type:s.DamageType.Melee,dice:{times:2,max:2},extra:0}])],[3,()=>o("Golem",[{type:s.ProtectionType.Solid,value:5}],[{type:s.DamageType.Blunt,dice:{times:1,max:5},extra:10}])]]);var c=i(31),u=i(62),l=i(63),d=i(64),m=i(26),p=i(65),f=i(66),g=i(67),v=i(68);i.d(e,"a",function(){return M});const w="title",y={addDoors:!1,minSize:3,maxSize:8,roomsCount:20,addTraps:!1,width:100,height:100},b=new Map;b.set("C",()=>new s.Corridor("C",s.TileTypes.Floor)),b.set("W",()=>new s.Wall),b.set("R",()=>new s.Floor("R",s.TileTypes.Floor)),b.set("D",()=>new s.Door);const T=new s.Pool([[1,t=>new u.a(t,!1)],[1,t=>new l.a(t,!1)],[1,t=>new d.a(m.d,t,!1)],[1,t=>new p.a(t,!1)],[1,t=>new f.a(t,!1)],[1,t=>new g.a(t,!1)],[1,t=>new v.a(t,!1)],[93,t=>t]]);class M extends s.Dungeon{enter(t,e){const i=t.currentMap=t.getMap(w);Object(s.withMatchingTile)(i,t=>t.isFloor()&&t.passibleThrough(),(t,r)=>{i.addCreature(new s.Point(t,r),e)})}register(t){t.addMap(w,(t,e)=>Object(s.addCreatures)(0,this.generateMap(w),h))}generateMap(t){let e=new s.LevelMap(t,Object(s.dungeon)(y.width,y.height,y.minSize,y.maxSize,y.roomsCount,()=>new s.Room,()=>new s.Corridor("C",s.TileTypes.Floor),()=>new s.Wall));return Object(s.addDoors)(e,()=>new s.Door,()=>!0),Object(c.e)(e,t=>t.isFloor(),(t,i,s)=>{e.setTile(i,s,T.pick(t))}),Object(s.centralize)(e),e}}},,,,,function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(0),r=i(10);class n extends r.a{act(t,e,i,r=!0){if(this.canAttack(t,e)){if(this.victim&&this.victimInAccess(t,e,this.victim))return new s.AttackEvent(this.victim,e,i);if(!r)throw"Attacker got called twice";return this.pickNewVictim(t,e),this.act(t,e,i,!1)}}canAttack(t,e){return!!this.findCreature(t,e,e=>this.enemies(t,e))}victimInAccess(t,e,i){if(void 0===i)return!1;return!!this.findCreature(t,e,t=>t.id===i.id)}pickNewVictim(t,e){this.victim=this.findCreature(t,e,e=>this.enemies(t,e))}findCreature(t,e,i){const s=t.stageMemory(e);return e.creaturePos(t).wrappers().map(({x:t,y:e})=>s.at(t,e).creature).find(t=>!!t&&i(t))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(3),r=i(10);class n extends r.b{foundNewTarget(t,e){return this.victimSet()&&this.buildVictimPath(t,e)||this.foundNewVictim(t,e)}onCantMove(){this.victimId=void 0}onReach(){this.victimId=void 0}victimSet(){return!!this.victimId}goTo(t,e,i){if(!this.destination)throw"Chaser.goTo: no destination";return this.followTo(t,this.destination,e,i)}buildVictimPath(t,e){return this.findCreature(t,e,t=>t.id===this.victimId)}foundNewVictim(t,e){return this.findCreature(t,e,e=>this.enemies(t,e))&&this.buildVictimPath(t,e)}findCreature(t,e,i){let r=!1;return this.withinView(t.stageMemory(e),e.creaturePos(t),({x:t,y:e},n)=>{const a=n.creature;!r&&a&&i(a)&&(this.destination=new s.c(t,e),this.victimId=a.id,r=!0)}),r}followTo(t,e,i,s){return this.move(t,i,s,t=>e.nextTo(t))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(0),r=i(4),n=i(10);class a extends r.h{constructor(){super(...arguments),this.match=!1}onStairwayDown(){this.match=!0}}class o extends r.h{constructor(t,e){super(),this.game=t,this.levelMap=e}onStairwayDown(t){const e=this.game.getMap(t.adjacentMapName);this.event=new s.MoveEvent(this.game,this.levelMap,t.enterPos(this.levelMap,e),e)}}class h extends n.c{constructor(){super(t=>{const e=new a;return t.visit(e),e.match})}act(t,e,i){if(t.can(s.Ability.GoStairwayDown))return super.act(t,e,i)}onReach(t,e,i){const s=new o(i,e);return e.creatureTile(t).visit(s),s.event}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(10),r=i(2);const n=2;class a extends s.b{constructor(){super(...arguments),this.escapesFrom=[]}foundNewTarget(t,e){return this.foundEnemies(t,e)&&this.buildEscapePath(t,e)}buildEscapePath(t,e,i=t.visionRadius/2){if(i<=1)return this.destination=void 0,!1;const s=this.buildPath(t,e,({x:t,y:e})=>{return Object(r.sumBy)(this.escapesFrom,([i,s])=>Math.max(Math.abs(t-i.x),Math.abs(e-i.y)))>=i});return s.length?(this.destination=s.pop(),!0):this.buildEscapePath(t,e,i-n)}foundEnemies(t,e){return this.escapesFrom=[],this.withinView(t.stageMemory(e),e.creaturePos(t),(e,i)=>{const s=i.creature;s&&this.enemies(t,s)&&this.escapesFrom.push([e,s])}),this.escapesFrom.length>0}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(10);class r extends s.c{constructor(){super(t=>!t.seen)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i(10),r=i(134),n=i(51),a=i(4),o=i(13);const h=10;class c extends a.h{constructor(t){super(),this.tile=t,this.status=!1}addNode(){return this.status=!1,this.tile.visit(this),this.status}onDoor(){this.status=!0}}class u extends s.a{constructor(){super(),this.step=h,this.firstCallPatrol=!0,this.i="a",this.graph=new r.Graph,this.lastNodeVisit={},this.currentNodeID="a",this.markNodeVisited(this.currentNodeID),this.path=[]}act(t,e,i,s=!0){if(!(this.graph.nodes().length<=1)){if(this.firstCallPatrol){const i=e.creaturePos(t);this.addNode(i),this.firstCallPatrol=!1}return this.step+=1,this.path.length?this.moveToTarget(t,e,i,s):(this.targetNodeID&&(this.markNodeVisited(this.targetNodeID),this.currentNodeID=this.targetNodeID),this.pickUpNewTarget(t,e),this.moveToTarget(t,e,i,s))}}reset(){this.path=[]}trackMovement(t,e){(this.step>=h||new c(e).addNode())&&this.addNode(t),this.step+=1}addNode(t){this.graph.setNode(this.i,t),this.currentNodeID&&this.currentNodeID!==this.i&&this.graph.setEdge(this.currentNodeID,this.i),this.currentNodeID=this.i,this.newNodeId(),this.step=0}buildNewPath(t,e){if(!this.targetNodeID)throw"Patrol has no next targetID";const i=this.graph.node(this.targetNodeID);this.path=this.buildPath(t,e,t=>i.eq(t))}pickUpNewTarget(t,e){let i=this.graph.nodes()[0],s=this.lastNodeVisit[i],r=this.graph.neighbors(this.currentNodeID);r&&r.forEach(t=>{s>(this.lastNodeVisit[t]||0)&&(i=t,s=this.lastNodeVisit[i])}),this.targetNodeID=i,this.buildNewPath(t,e)}moveToTarget(t,e,i,s){const r=this.path.shift();return r?t.stageMemory(e).at(r.x,r.y).tangible()?(this.buildNewPath(t,e),this.path.length?this.act(t,e,i,!1):void 0):new o.a(i,e,r):s?(this.path=[],this.act(t,e,i,!1)):(new n.a).act(t,e,i)}markNodeVisited(t){this.lastNodeVisit[t]=this.step}newNodeId(){this.i=String.fromCharCode(this.i.charCodeAt(0)+1)}}},,,,,,function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(0),r=i(16),n=i(10),a=i(28);class o extends n.c{constructor(){super(t=>!!t.items)}act(t,e,i){if(t.can(r.b.Inventory))return super.act(t,e,i)}onReach(t,e,i){const r=e.creatureTile(t);if(!r.items)throw"Picker.act : nothing to pick up";return t.ai.pushEvent(new a.b(r.items,i)),new s.PickUpItemsEvent(r,r.items.bunch,i)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(10),r=i(22);class n extends s.a{act(t,e){if(!t.health.atMax)return new r.a(e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(10),r=i(16),n=i(3),a=i(0),o=i(1);class h extends s.a{act(t,e,i){if(!t.can(r.b.Throwing)||!this.hasMissile(t)||!this.canAttack(t,e,i))return;let s=[];if(!this.victim)throw"Thrower.act called when there is no victim";return Object(n.e)(e.creaturePos(t),e.creaturePos(this.victim),(t,e)=>s.push(new n.c(t,e))),new a.MissileAttackEvent(s,i,e,t=>{t===o.c.DIE&&(this.victim=void 0,this.previousVictim=void 0)})}hasMissile(t){return this.missiles=t.missile,void 0!==this.missiles}canAttack(t,e,i){return this.previousVictim=this.victim,this.victim=void 0,!(!this.previousVictim||!this.findWithId(t,e,this.previousVictim.id))||this.findCreature(t,e,e=>this.enemies(t,e))}findWithId(t,e,i){return this.findCreature(t,e,t=>i===t.id)}findCreature(t,e,i){const s=t.stageMemory(e),r=e.creaturePos(t);return this.withinView(s,e.creaturePos(t),(n,a)=>{const o=a.creature;!this.victim&&o&&i(o)&&!this.obstacles(t,r,s,n)&&(this.victim=e.at(n.x,n.y).creature)}),!!this.victim}obstacles(t,e,i,s){let r=!1;return Object(n.e)(e,s,(e,s)=>{r=r||i.at(e,s).tangible(t)}),r}}},function(t,e,i){"use strict";i(10),i(22)},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var s=i(1),r=i(38),n=i(8),a=i(18),o=i(14);class h extends s.a{constructor(t,e,i){super(),this.victim=t,this.levelMap=e,this.game=i}affectCreature(t){return this.process(t,!1)}affectPlayer(t){const e=this.process(t,!0);return e===s.c.DIE&&t.on(new r.a(this.victim,this.levelMap,this.game)),e}process(t,e){const[i,s]=this.hit(t);return this.game.logger.attackLogger.melee(s,t,this.victim,i,e),i}hit(t){if(n.a.misses(t.bodyControl,this.victim.bodyControl))return[s.c.DODGE,0];const e=new a.a(n.a.withCritical(t.damages,t.specie.critical),o.b.Attack,this.levelMap,this.game);return[this.victim.on(e),e.damage]}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(1),r=i(21);class n extends r.a{constructor(t,e,i){super(e,i),this.door=t}affectCreature(t){return this.door.open?(this.door.open=!1,this.game.logger.doorLogger.close()):this.game.logger.doorLogger.alreadyClosed(),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e){super(),this.potion=t,this.game=e}affectCreature(t){return t.removeItem(this.potion,1),this.potion.onDrink(this.game),this.game.logger.drink(this.potion),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(1),r=i(55),n=i(56),a=i(30);class o extends s.a{constructor(t,e,i,s){super(),this.path=t,this.game=e,this.levelMap=i,this.done=s}affectCreature(t){let e=t.missile;if(!e)throw"MissileAttackEvent called when actor has no missiles";return this.withMissile(t,e.item),s.c.NOTHING}affectPlayer(t){const e=t.missile;if(!e)throw"MissileAttackEvent: slot has no items";return this.withMissile(t,e.item),t.on(new a.a(t.inventory.missileSlot,1,this.game)),t.stuffWeight.subtract(e.item.weight),s.c.NOTHING}withMissile(t,e){let i,a=[];this.path.forEach(t=>{if(!i){const e=this.levelMap.at(t.x,t.y);i=e.creature,a.push(t)}}),this.game.effect=new r.a(e,a,()=>{i?this.done(t.on(new n.a(i,e,this.levelMap,this.game))):this.done(s.c.NOTHING)})}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e,i){super(),this.tile=t,this.items=e,this.game=i}affectCreature(t){return this.items.forEach(({item:e,count:i})=>{t.addItem(e,i)}),s.c.NOTHING}affectPlayer(t){let e=this.tile.items;if(void 0===e)throw"Failed to pick up items - tile has no items";return this.withTileItems(t,e),s.c.NOTHING}withTileItems(t,e){this.items.forEach(({item:i,count:s})=>{t.addItem(i,s),t.stuffWeight.add(i.weight*s),this.game.logger.pickedUpItem(i,s),e.remove(i,s)})}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(1),r=i(40),n=i(6),a=i(39);class o extends s.b{constructor(t,e,i){super(),this.slot=t,this.item=e,this.game=i}affectPlayer(t){let e=t.inventory.findInBag(this.item);if(void 0===e)throw`Item ${this.item.name} can not be equipped - not found in inventory`;if(this.slot.equipment){const e=t.on(new r.a(this.slot,this.game));if(e!==s.c.NOTHING)return e}const i=this.slot.useSingleItem?1:e.count;return t.removeItem(this.item,i),this.slot.equip(this.item,i),this.onPutOn(t,this.item),this.game.logger.putOn(this.item),s.c.NOTHING}onPutOn(t,e){e instanceof n.a&&(t.itemsProtections=t.itemsProtections.concat(e.protections)),e.impacts.forEach(i=>{t.on(new a.a(i,e.name,this.game))})}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.a{constructor(t,e,i){super(),this.impactType=t,this.game=e,this.source=i}affectCreature(t){return this.source?t.removeConstImpact(this.impactType,this.source):t.removeImpact(this.impactType),s.c.NOTHING}}},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i(21),r=i(31),n=i(13),a=i(3),o=i(32),h=i(37),c=i(1);class u extends s.a{constructor(t,e,i){super(t,e),this.selfCast=i}affectCreature(t){return this.playerSees(t)?t.hasResistance(o.b.TeleportationControl)||!this.teleport(t)?this.game.logger.creatureNotTeleported(t):this.game.logger.creatureTeleported(t):this.teleport(t),c.c.NOTHING}affectPlayer(t){return t.hasResistance(o.b.TeleportationControl)?(this.selfCast||this.game.logger.playerTeleportationCaused(),t.ai.pushEvent(new h.c(this.levelMap,this.game)),this.game.playerTurn=!0):this.teleport(t)?this.selfCast||this.game.logger.playerTeleported():this.game.logger.playerNotTeleported(),c.c.NOTHING}teleport(t){let e=!1;try{Object(r.f)(this.levelMap,t=>t.free(),(i,s)=>{e=!0,t.on(new n.a(this.game,this.levelMap,new a.c(i,s)))})}catch(t){}return e}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(1);class r extends s.b{constructor(t,e,i,s){super(),this.trapPosition=t,this.trap=e,this.levelMap=i,this.game=s}affectPlayer(t){return this.trap.untrap(this.trapPosition,t,this.levelMap,this.game),s.c.NOTHING}}},function(t,e,i){"use strict";i(3)},function(t,e,i){"use strict";var s=i(3);const r=0,n=60,a=Math.PI/(2*n);class o extends s.d{notCross(t){return t.x-r>this.x+this.w||t.y-r>this.y+this.h||t.x+t.w<this.x-r||t.y+t.h<this.y-r}pointWithin(){return new s.c(this.x+1+Object(s.i)(this.w-1),this.y+1+Object(s.i)(this.h-1))}add(t,e,i){let s=0;for(;s<this.w;){let r=0;for(;r<this.h;)t[this.x+s][this.y+r]=i(),e[this.x+s][this.y+r]=!1,r++;s++}}}class h extends s.d{constructor(t,e,i,s){super(t,e,i,s),this.lined=t>=i&&e>=s||i>=t&&s>=e}add(t,e,i){let[s,r,n]=this.horizontalLine(),a=0;for(;a<n;)e[s+a][r]&&(t[s+a][r]=i()),a+=1;let[o,h,c]=this.verticalLine(),u=0;for(;u<c;)e[o][h+u]&&(t[o][h+u]=i()),u+=1}horizontalLine(){return this.lined?[Math.min(this.x,this.w),Math.max(this.y,this.h),Math.abs(this.w-this.x)]:[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.w-this.x)]}verticalLine(){return this.lined,[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.h-this.y)]}}e.a=function(t,e,i,r,c,u,l,d){const m=new class{constructor(t,e,i,s,r){this.maxX=t,this.maxY=e,this.minSize=i,this.maxSize=s,this.roomsCount=r;let n=new Array(this.roomsCount).fill(void 0).map(t=>this.generateRoom());this.rooms=this.normalize(this.ray(n)),this.roads=this.buildRoads(this.rooms)}generateRoom(){return new o(0,0,this.minSize+Object(s.i)(this.maxSize-this.minSize),this.minSize+Object(s.i)(this.maxSize-this.minSize))}ray(t){return t.reduce((t,e)=>{for(let i=0,r=Object(s.i)(360)/180*Math.PI;i<n;r+=a,i++){const i=Math.cos(r),s=Math.sin(r);let n=1,a=0,h=0,c=new o(e.x,e.y,e.w,e.h);for(;Math.abs(a)<this.maxX/2&&Math.abs(h)<this.maxY/2;){let e=Math.round(n*i),r=Math.round(n*s);for(;e===a&&r===h;)n+=1,e=Math.round(n*i),r=Math.round(n*s);if(c.move(e-a,r-h),a=e,h=r,t.every(t=>c.notCross(t)))return t.push(c),t}}return t},[])}normalize(t){if(0===t.length)return t;const e=Object(s.h)(t.map(t=>t.x))-1;t.forEach(t=>{t.move(-e,0)}),t=t.filter(t=>t.x+t.w<this.maxX);const i=Object(s.h)(t.map(t=>t.y))-1;return t.forEach(t=>{t.move(0,-i)}),t.filter(t=>t.y+t.h<this.maxY)}buildRoads(t){let e=t.map(t=>t.pointWithin());const i=e.shift();if(!i)throw"Dungeon.buildRoads rooms array is empty";let s=[i],r=[];const n=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)};for(;e.length;){let t=e.shift();if(!t)throw"Dungeon.buildRoads rooms array is empty";let i=t,a=s[0],o=n(i,a);s.forEach(t=>{const e=n(t,i);e<o&&(a=t,o=e)}),s.push(i),r.push(new h(i.x,i.y,a.x,a.y))}return r}}(t,e,i,r,c);let p=Object(s.j)(t,e,d),f=Object(s.j)(t,e,()=>!0);for(let t=0;t<m.rooms.length;t++)m.rooms[t].add(p,f,u);for(let t=0;t<m.roads.length;t++)m.roads[t].add(p,f,l);return p}},function(t,e,i){"use strict";var s;i.d(e,"a",function(){return s}),function(t){t.Neuter="neuter",t.Female="female",t.Male="male"}(s||(s={}))},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{constructor(t){this.requires=t,this.current=1,this.currentExperience=0,this.doneLeveling=!1,this.requiredExperience=this.requires[0]}add(t){if(this.doneLeveling)return[];this.currentExperience+=t;let e=[];for(;!this.doneLeveling&&this.currentExperience>=this.requiredExperience;)this.levelUp(),e.push(this.current);return e}levelUp(){this.current+=1;let t=this.requires[this.current-1];t?(this.currentExperience-=this.requiredExperience,this.requiredExperience=t):(this.currentExperience=this.requiredExperience,this.doneLeveling=!0)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(2);class r{constructor(t){this.totalWeight=0,this.items=[],t.forEach(([t,e])=>this.add(t,e))}add(t,e){if(t<1)throw"Item's weight is lower than 1";this.items.push([t,e]),this.totalWeight+=Math.ceil(t)}pick(t){if(0===this.items.length)throw"Tried to use empty pool";let e=Object(s.random)(this.totalWeight);const i=this.items.find(([t,i])=>(e-=t)<=0);if(void 0!==i)return i[1](t);throw"Pool failed to pick anything"}merge(t){let e=new r([]);return this.items.forEach(([t,i])=>e.add(t,i)),t.items.forEach(([t,i])=>e.add(t,i)),e}}},function(t,e){},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(31),r=i(4);class n{constructor(){this.levels=[]}addStairDown(t,e){return this.addStairs(t,new r.e(t,e))}addStairUp(t,e){return this.addStairs(t,new r.f(t,e))}addStairs(t,e){return Object(s.f)(t,t=>t.free(),(i,s)=>{t.setTile(i,s,e)}),t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(59),r=i(60);class n{constructor(t,e){this.player=t,this.professionPicker=e,this.playerTurn=!1,this.running=!1,this.effect=null,this.turns=0,this.maps=new Map,this.logger=new r.a(t)}turn(){this.running||this.player.ai.presenter&&!this.effect||(this.running=!0,this.mutexTurn(),this.running=!1)}mutexTurn(){if(!this.player.ai.runEvents()){if(!this.currentMap)throw"mutexTurn: Map is undefined";if(this.effect)this.player.rebuildVision(this.currentMap),this.effect.patchMemory(this.player.stageMemory(this.currentMap)),this.effect.done()&&(this.effect.onDone(),this.effect=null);else{for(;!this.player.dead&&!this.playerTurn;)this.levelMapTurn(this.currentMap);this.player.rebuildVision(this.currentMap)}}}getMap(t){const e=this.maps.get(t);if(!e)throw`Map ${t} is not found`;if(e instanceof s.a)return e;if(e instanceof Function){const i=e(t,this);return this.maps.set(t,i),i}throw`LevelMap with id ${t} is not found`}addMap(t,e){if(this.maps.has(t))throw`Game.addMap: map ${t} already presence`;this.maps.set(t,e)}levelMapTurn(t){let e=t.timeline;const i=e.next();if(void 0===i)throw"Timeline event is empty!";const s=t.creatures.find(t=>i===t.id);if(s){const r=s.act(t,this);this.turns+=1,r&&t.creatures.find(t=>i===t.id)&&e.add(i,r)}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(12),r=i(29),n=i(2),a=i(9);class o{constructor(){this.bag=new r.a,this.headSlot=new s.h(a.a.flesh),this.amuletSlot=new s.a,this.cloakSlot=new s.e,this.chestSlot=new s.d(a.a.flesh),this.rightHandSlot=new s.n(a.a.flesh),this.leftHandSlot=new s.j(a.a.flesh),this.leftFingerSlot=new s.i,this.rightFingerSlot=new s.m,this.glovesSlot=new s.g,this.gauntletsSlot=new s.f,this.beltSlot=new s.b,this.bootsSlot=new s.c(a.a.flesh),this.missileWeaponSlot=new s.l,this.missileSlot=new s.k,this.toolsSlot=new s.o}get bodyParts(){return[this.headSlot,this.rightHandSlot,this.leftHandSlot,this.chestSlot,this.bootsSlot]}slots(){return[this.headSlot,this.amuletSlot,this.cloakSlot,this.chestSlot,this.rightHandSlot,this.leftHandSlot,this.leftFingerSlot,this.rightFingerSlot,this.glovesSlot,this.gauntletsSlot,this.beltSlot,this.bootsSlot,this.missileWeaponSlot,this.missileSlot,this.toolsSlot]}get allItems(){return Object(n.concat)(this.cares(),Object(n.compact)(this.slots().map(t=>t.equipment)))}get unarmoredSlotsCount(){return[this.headSlot,this.chestSlot,this.glovesSlot,this.gauntletsSlot,this.beltSlot,this.bootsSlot].filter(t=>!t.equipment).length}cares(){return this.bag.bunch}findInBag(t){return this.bag.find(t)}putToBag(t,e){this.bag.put(t,e)}removeFromBag(t,e){this.bag.remove(t,e)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(4),r=i(0),n=i(3);class a{constructor(t){this.tile=t,this.visible=!1,this.degree=0,this.seen=!1}get items(){return this.tile.items}get creature(){return this.tile.creature}see(t,e){this.visible=!0,this.degree=e,this.seen=!0,this.tile=t.clone()}tangible(t){return this.seen&&!this.tile.passibleThrough(t)}reset(){this.visible=!1,this.effect=void 0,this.tile.creature=void 0}visit(t){this.tile.visit(t)}}class o extends n.b{constructor(t,e){const i=new s.k;super(Object(r.twoDimArray)(t,e,()=>new a(i)))}resetVisible(){this.each(t=>t.reset())}}},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i(2),r=i(0),n=i(36),a=i(19),o=i(6),h=i(16),c=i(61);class u extends h.d{constructor(t,e,i,s,n,o){super(i),this.level=t,this.ai=e,this.professions=[],this.inventory=new r.Inventory,this.itemsProtections=[],this.itemsResistances=[],this.killStat=new c.a,this.strength=new a.f(s),this.dexterity=new a.c(n),this.constitution=new a.b(o),this.intelligence=new a.e(10),this.wisdom=new a.e(2),this.charisma=new a.e(2),this.stuffWeight=new a.e(0),this.carryingCapacity=new a.a(this.strength.current,this.constitution.current)}act(t,e){this.statsTurn(),this.visionMask(t);const i=this.ai.act(this,t,e);return i&&this.on(i),this.on(new n.a(t,e)),this.speed}rebuildVision(t){this.visionMask(t)}on(t){return t.affectPlayer(this)}get missile(){return this.inventory.missileSlot.equipment}get inventoryItems(){return this.inventory.allItems}addItem(t,e){this.inventory.putToBag(t,e)}removeItem(t,e){this.inventory.removeFromBag(t,e)}get weightWithCarryings(){return this.specie.weight+Object(s.sumBy)(this.inventory.allItems,({item:t,count:e})=>t.weight*e)}get bodyControl(){return this.specie.bodyControl+this.dexterity.bodyControlAdjustment}get throwDamages(){const t=this.dexterity.missileAdjustment;return Object(s.concat)(this.specie.throwingDamages,this.missileItemsDamages()).map(e=>{let i=Object(s.cloneDeep)(e);return i.extra+=t,i})}get damages(){const t=this.strength.meleeAdjustment;return Object(s.concat)(this.specie.damages,this.meleeItemsDamages()).map(e=>{let i=Object(s.cloneDeep)(e);return i.extra+=t,i})}get protections(){return Object(s.concat)(this.specie.protections,this.itemsProtections,[{type:o.k.Unarmored,value:1*this.inventory.unarmoredSlotsCount}])}get resistances(){return Object(s.concat)(this.specie.resistances,this.itemsResistances)}meleeItemsDamages(){const t=this.inventory.rightHandSlot.equipment,e=this.inventory.leftHandSlot.equipment;return Object(s.concat)(t?t.item.damages:[],e?e.item.damages:[])}missileItemsDamages(){const t=this.inventory.missileSlot.equipment,e=this.inventory.missileWeaponSlot.equipment;return Object(s.concat)(t&&t.item.damages||[],e?e.item.damages:[])}}},function(t,e,i){"use strict";i.d(e,"d",function(){return s}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return a}),i.d(e,"b",function(){return o});var s,r=i(2);!function(t){t[t.Available=0]="Available",t[t.Completed=1]="Completed",t[t.Unavailable=2]="Unavailable"}(s||(s={}));class n{constructor(t,e,i,s){this.name=t,this.depth=e,this.rank=i,this.maxRank=s}upgrade(t){this.rank+=1,this.onObtain(t)}status(t){return this.rank===this.maxRank?s.Completed:this.depth*t.depthCost>t.points?s.Unavailable:s.Available}}class a{constructor(t,e,i=1,s=0,r){this.id=t,this.name=e,this.level=i,this.points=s,this.talents=r}}class o{constructor(t,e,i){this.pool=t,this.maxLevel=e,this.maxTaken=i}available(t){let e,i=[];return this.canUpdate(t)?e=this.updatableProfession(t):this.canTakeNewProfession(t)&&(e=this.newFromPool(t)),void 0!==e&&i.push(e),this.canTakeNewProfession(t)?e=this.newFromPool(t,e&&e.id):this.canUpdate(t)&&(e=this.updatableProfession(t,e&&e.id)),void 0!==e&&i.push(e),i}canUpdate(t){return t.professions.some(t=>t.level<this.maxLevel)}updatableProfession(t,e){return Object(r.sample)(t.professions.filter(t=>e!==t.id))}canTakeNewProfession(t){return t.professions.length<this.maxTaken&&this.pool.length>t.professions.length}newFromPool(t,e){const i=t.professions.map(t=>t.id);return void 0!==e&&i.push(e),Object(r.sample)(this.pool.filter(t=>!Object(r.includes)(i,t.id)))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(24);class r extends s.b{constructor(){super(...arguments),this.title="Сумка"}initPositions(){this.positions=this.player.inventory.cares()}withItem(){this.endTurn()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(17);class r extends s.b{get page(){return s.a.Base}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(0),r=i(6),n=i(24);class a extends n.b{constructor(){super(...arguments),this.title="Что выпить?"}initPositions(){this.positions=this.player.inventory.cares().filter(t=>t.item.group===r.f.Potion)}withItem({item:t}){this.player.on(new s.DrinkPotionEvent(t,this.game)),this.endTurn()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(24),r=i(53);class n extends s.a{constructor(){super(...arguments),this.title="Что положить?"}initPositions(){this.positions=this.player.inventory.cares()}withItems(t){t.length?(this.player.on(new r.a(this.tile,t,this.game)),this.endTurn()):this.goIdle()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(17);class r extends s.b{get page(){return s.a.History}get name(){return this.player.name}get weight(){return this.specie.weight}get height(){return this.specie.height}get gender(){return this.specie.gender}get eyeColor(){return this.specie.eyeColor}get hairColor(){return this.specie.hairColor}get skinColor(){return this.specie.skinColor}get turns(){return this.game.turns}}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s,r=i(5),n=i(0),a=i(43);!function(t){t[t.See=0]="See",t[t.Recall=1]="Recall",t[t.Hidden=2]="Hidden"}(s||(s={}));class o extends a.a{constructor(t,e){super(t,e,"_",t=>this.memory.inRange(t))}get type(){return r.c.Look}get title(){return this.memoryTile.visible?s.See:this.memoryTile.seen?s.Recall:s.Hidden}get body(){let t=[];if(this.memoryTile.creature&&(this.memoryTile.creature.id===this.player.id?t.push("Это я"):t.push(`Это ${this.memoryTile.creature.name}`)),this.memoryTile.items)switch(this.memoryTile.items.bunch.length){case 0:break;case 1:t.push(`Лежит ${this.memoryTile.items.bunch[0].item.name}`);break;default:t.push("Лежит несколько предметов")}return t}close(){this.redirect(new n.IdlePresenter(this.levelMap,this.game))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var s=i(0);class r extends s.MultipleItemUseListingPresenter{constructor(){super(...arguments),this.title="Что поднять?"}initPositions(){const t=this.tile.items;if(void 0===t)throw"Failed to show pick up dialog - tile has no items";this.positions=t.bunch.map(t=>({item:t.item,count:t.count}))}withItems(t){this.player.on(new s.PickUpItemsEvent(this.tile,t,this.game)),this.endTurn()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(5),r=i(70);class n extends s.b{constructor(t,e,i){super(e,i),this.level=t,this.options=this.game.professionPicker.available(this.player)}get type(){return s.c.ProfessionPicking}pickProfession(t){this.player.professions.find(e=>e.id===t.id)||this.player.professions.push(t),t.level+=1,this.redirect(new r.a(this.level,this.levelMap,this.game))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(24),r=i(42);class n extends s.b{constructor(t,e,i,s){super(i,s),this.onWithItem=t,this.positions=e,this.title="Что надеть?"}initPositions(){}withItem(t){this.onWithItem(t)}close(){this.redirect(new r.a(this.levelMap,this.game))}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(5),r=i(43),n=i(13);class a extends r.a{constructor(t,e){super(t,e,"x",({x:e,y:i})=>t.at(e,i).passibleThrough(this.player)&&this.memory.at(e,i).seen)}get type(){return s.c.Teleportation}get title(){return"Выберите зону телепортации"}get body(){return[]}close(){this.targetPos.eq(this.levelMap.creaturePos(this.player))?this.game.logger.playerTeleportedWhereTheyWere():this.player.on(new n.a(this.game,this.levelMap,this.targetPos)),this.endTurn()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var s=i(3),r=i(2);const n=function(t,e,i,n,o=!1){let h=Object(s.j)(t.width,t.height,()=>-1),c=[],u=[e],l=0;for(;u.length&&!c.length;){let e=[];u.forEach(s=>{if(!t.inRange(s))return;const r=t.at(s.x,s.y);i(r)||-1!==h[s.x][s.y]||(h[s.x][s.y]=l,n(s,r)?c.push(s):s.wrappers().forEach(t=>e.push(t)))}),l++,u=e}if(c.length){let t=Object(r.sample)(c);return a(o&&t?t:c[0],h)}return[]},a=function(t,e){let i,r=t,n=[r];for(;1!==e[r.x][r.y];){if(void 0===(i=s.c.dxy.find(t=>e[r.x+t.x]&&e[r.x+t.x][r.y+t.y]===e[r.x][r.y]-1)))return[];r=r.add(i),n.unshift(r)}return n}},,,,function(t,e,i){t.exports=i(191)},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){},,,,,,function(t,e,i){"use strict";var s=i(48);i.n(s).a},,,,,,,,,,,,,,,function(t,e,i){"use strict";var s=i(73);i.n(s).a},,function(t,e,i){"use strict";var s=i(74);i.n(s).a},,function(t,e,i){"use strict";var s=i(75);i.n(s).a},,function(t,e,i){"use strict";i.r(e);var s=i(11),r=i(135),n=i(133),a=i.n(n),o=(i(164),i(166),i(168),s.a.extend({name:"MenuOption",props:["char","name","separator"]})),h=(i(170),i(15)),c=Object(h.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"menu-option",class:{"-separator":this.separator}},[this._v("["),e("span",{staticClass:"char",domProps:{textContent:this._s(this.char)}}),this._v("]\n"+this._s(this.name))])},[],!1,null,"5bcbc7d6",null);c.options.__file="MenuOption.vue";var u=c.exports,l=i(7),d=s.a.extend({name:"ChooseRaceMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"H":return this.menu.withRace(l.humanRace);case"D":return this.menu.withRace(l.dwarfRace);case"*":return this.menu.random();case"=":return this.menu.back()}}}}),m=Object(h.a)(d,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("You are "+this._s(this.menu.gender)+". Choose a race:")]),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"H",name:"Human"}}),e("MenuOption",{attrs:{char:"D",name:"Dwarf"}}),e("MenuOption",{attrs:{char:"*",name:"Random",separator:!0}}),e("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,null,null);m.options.__file="ChooseRaceMenu.vue";var p=m.exports,f=s.a.extend({name:"ChooseGenderMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"M":return this.menu.withGender(l.Gender.Male);case"F":return this.menu.withGender(l.Gender.Female);case"*":return this.menu.random();case"=":return this.menu.back()}}}}),g=Object(h.a)(f,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("Choose a gender:")]),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"M",name:"Male"}}),e("MenuOption",{attrs:{char:"F",name:"Female"}}),e("MenuOption",{attrs:{char:"*",name:"Random",separator:!0}}),e("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,null,null);g.options.__file="ChooseGenderMenu.vue";var v=g.exports,w=s.a.extend({name:"MainMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"N":return this.menu.newGame()}}}}),y=Object(h.a)(w,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"N",name:"New game"}})],1)])},[],!1,null,null,null);y.options.__file="MainMenu.vue";var b=y.exports,T=s.a.extend({name:"AttributesMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"M":return this.menu.manually();case"=":return this.menu.back()}}}}),M=Object(h.a)(T,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("You are "+this._s(this.menu.gender)+" "+this._s(this.menu.race.name)+". Choose your attributes:")]),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"*",name:"Random"}}),e("MenuOption",{attrs:{char:"M",name:"Manually"}}),e("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,null,null);M.options.__file="AttributesMenu.vue";var x=M.exports,P=s.a.extend({name:"AttributesSelectionMenu",props:["menu"],data(){return{points:200,selectedAttributes:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},attributeNames:this.menu.attributeNames}},components:{MenuOption:u},methods:{onEvent(t){switch(t.key){case"a":return this.decrease(this.attributeNames[0]);case"A":return this.increase(this.attributeNames[0]);case"b":return this.decrease(this.attributeNames[1]);case"B":return this.increase(this.attributeNames[1]);case"c":return this.decrease(this.attributeNames[2]);case"C":return this.increase(this.attributeNames[2]);case"d":return this.decrease(this.attributeNames[3]);case"D":return this.increase(this.attributeNames[3]);case"e":return this.decrease(this.attributeNames[4]);case"E":return this.increase(this.attributeNames[4]);case"f":return this.decrease(this.attributeNames[5]);case"F":return this.increase(this.attributeNames[5]);case"R":case"r":return this.menu.ready();case"=":return this.menu.back()}},attributeModifier:t=>0===t?"–":t>0?`+${t}`:t.toString(),keys:t=>["aA","bB","cC","dD","eE","fF"][t],totalAttribute(t){return this.menu.baseAttributes[t]+this.selectedAttributes[t]},canDecrease(t){return this.selectedAttributes[t]>0},canIncrease(t){return this.points>=this.totalAttribute(t)},increase(t){this.canIncrease(t)&&(this.points-=this.totalAttribute(t),this.selectedAttributes[t]+=1)},decrease(t){this.canDecrease(t)&&(this.selectedAttributes[t]-=1,this.points+=this.totalAttribute(t))}}}),C=(i(185),Object(h.a)(P,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("div",{staticClass:"subtitle"},[t._v("Choose attributes")]),i("table",[i("thead",[i("tr",{staticClass:"attribute-row -head"},[i("th"),i("th",{staticClass:"name"},[t._v(t._s(t._f("t")("name","presenters.primaryAttributeSelection")))]),i("th",{staticClass:"racial"},[t._v(t._s(t._f("t")("racial","presenters.primaryAttributeSelection")))]),i("th",{staticClass:"gender"},[t._v(t._s(t._f("t")("gender","presenters.primaryAttributeSelection")))]),i("th",{staticClass:"base"},[t._v(t._s(t._f("t")("base","presenters.primaryAttributeSelection")))]),i("th",{staticClass:"selected"},[t._v(t._s(t._f("t")("selected","presenters.primaryAttributeSelection")))]),i("th",{staticClass:"total"},[t._v(t._s(t._f("t")("total","presenters.primaryAttributeSelection")))])])]),i("tbody",t._l(t.attributeNames,function(e,s){return i("tr",{staticClass:"attribute-row"},[i("th",{staticClass:"key"},[t._v("["),i("div",{staticClass:"key"},[t._v(t._s(t.keys(s)))]),t._v("]")]),i("td",{staticClass:"name"},[t._v(t._s(t._f("t")(e,"primaryAttributes")))]),i("td",{staticClass:"racial"},[t._v(t._s(t.menu.racialAttributes[e]))]),i("td",{staticClass:"gender"},[t._v(t._s(t.attributeModifier(t.menu.genderAttributes[e])))]),i("td",{staticClass:"base"},[t._v(t._s(t.menu.baseAttributes[e]))]),i("td",{staticClass:"selected"},[i("a",{staticClass:"select-button float-left",class:{invisible:!t.canDecrease(e)},on:{click:function(i){t.decrease(e)}}},[t._v("-")]),t._v(t._s(t.attributeModifier(t.selectedAttributes[e]))),i("a",{staticClass:"select-button float-right",class:{invisible:!t.canIncrease(e)},on:{click:function(i){t.increase(e)}}},[t._v("+")])]),i("td",{staticClass:"total"},[t._v(t._s(t.totalAttribute(e)))])])}))]),i("div",{staticClass:"points mt-3"},[t._v(t._s(t._f("t")("points","presenters.primaryAttributeSelection","",{points:t.points})))]),i("div",{staticClass:"menu-options"},[i("MenuOption",{attrs:{char:"R",name:"Ready"}}),i("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,"08bdb93c",null));C.options.__file="AttributesSelectionMenu.vue";var I=C.exports;class E{constructor(t,e,i,s,r,n,a){this.ch=t,this.r=e,this.g=i,this.b=s,this.br=r,this.bg=n,this.bb=a}getChar(){return this.ch}setChar(t){this.ch=t}setColor(t,e,i){this.r=t,this.g=e,this.b=i}setGrey(t){this.r=t,this.g=t,this.b=t}setBackground(t,e,i){this.br=t,this.bg=e,this.bb=i}backgroundToColor(){this.r=this.br,this.g=this.bg,this.b=this.bb}swapColors(){this.r=[this.br,this.br=this.r][0],this.g=[this.bg,this.bg=this.g][0],this.b=[this.bb,this.bb=this.b][0]}resetColor(){this.r=this.g=this.b=void 0}resetBackground(){this.br=this.bg=this.bb=void 0}getColorHex(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""}getBackgroundHex(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""}getColorRGB(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?`rgb(${this.r},${this.g},${this.b})`:""}getBackgroundRGB(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?`rgb(${this.br},${this.bg},${this.bb})`:""}getColorJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}}getBackgroundJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}}copy(t){this.ch=t.ch,this.r=t.r,this.g=t.g,this.b=t.b,this.br=t.br,this.bg=t.bg,this.bb=t.bb}clone(){return new E(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)}}const k="unicodetiles",S=new E(" ");const O="\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n",R="\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n";const D=function(t){return new class{constructor(t){if(this.view=t,this.view=t,this.canvas=document.createElement("canvas"),!this.canvas.getContext)throw"Canvas not supported";if(this.gl=this.canvas.getContext("experimental-webgl"),!this.gl)throw"WebGL not supported";if(t.elem.appendChild(this.canvas),this.charMap={},this.charArray=[],this.defaultColors={r:1,g:1,b:1,br:0,bg:0,bb:0},this.attribs={position:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},texCoord:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},color:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},bgColor:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},charIndex:{buffer:null,data:null,itemSize:1,location:null,hint:this.gl.DYNAMIC_DRAW}},this.offscreen||(this.offscreen=document.createElement("canvas")),this.offscreen.style.position="absolute",this.offscreen.style.top="0px",this.offscreen.style.left="0px",this.ctx=this.offscreen.getContext("2d"),!this.ctx)throw"Failed to acquire offscreen canvas drawing context";this.updateStyle(),this.canvas.width=(t.squarify?this.th:this.tw)*t.w,this.canvas.height=this.th*t.h,this.offscreen.width=0,this.offscreen.height=0,this.updateStyle(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height);let e=this.compileShader(this.gl.VERTEX_SHADER,O),i=this.compileShader(this.gl.FRAGMENT_SHADER,R),s=this.gl.createProgram();if(this.gl.attachShader(s,e),this.gl.attachShader(s,i),this.gl.linkProgram(s),this.gl.deleteShader(e),this.gl.deleteShader(i),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS)){const t=`Error linking program: ${this.gl.getProgramInfoLog(s)}`;throw this.gl.deleteProgram(s),t}this.gl.useProgram(s),this.attribs.position.location=this.gl.getAttribLocation(s,"position"),this.attribs.texCoord.location=this.gl.getAttribLocation(s,"texCoord"),this.attribs.color.location=this.gl.getAttribLocation(s,"color"),this.attribs.bgColor.location=this.gl.getAttribLocation(s,"bgColor"),this.attribs.charIndex.location=this.gl.getAttribLocation(s,"charIndex"),this.initBuffers();let r=this.gl.getUniformLocation(s,"uResolution");this.gl.uniform2f(r,this.canvas.width,this.canvas.height),this.tileCountsLocation=this.gl.getUniformLocation(s,"uTileCounts"),this.gl.uniform2f(this.tileCountsLocation,this.view.w,this.view.h),this.paddingLocation=this.gl.getUniformLocation(s,"uPadding"),this.gl.uniform2f(this.paddingLocation,0,0);let n=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.cacheChars(" !\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.activeTexture(this.gl.TEXTURE0),setTimeout(()=>{this.updateStyle(),this.buildTexture(),this.render()},100)}getRendererString(){return"webgl"}buildTexture(){let t=this.offscreen.width/(this.tw+this.pad),e=this.offscreen.height/(this.th+this.pad);const i=this.charArray.length;i>Math.floor(t)*Math.floor(e)&&(e=(t=Math.ceil(Math.sqrt(i)))+2,this.offscreen.width=t*(this.tw+this.pad),this.offscreen.height=e*(this.th+this.pad),this.updateStyle(),this.gl.uniform2f(this.tileCountsLocation,t,e)),this.gl.uniform2f(this.paddingLocation,this.pad/this.offscreen.width,this.pad/this.offscreen.height);let s,r=0;this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.offscreen.width,this.offscreen.height),this.ctx.fillStyle="#ffffff";const n=.5*this.gap,a=this.tw+this.pad,o=this.th+this.pad;let h=.5*o;for(let i=0;i<e;++i){let e=.5*this.pad;for(let i=0;i<t&&void 0!==(s=this.charArray[r]);++i,++r)this.ctx.fillText(s,e+n,h),e+=a;if(!s)break;h+=o}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.offscreen)}cacheChars(t,e=!0){if(!this.gl)return;let i=!1;for(let e=0;e<t.length;++e)this.charMap[t[e]]||(i=!0,this.charArray.push(t[e]),this.charMap[t[e]]=this.charArray.length-1);i&&e&&this.buildTexture()}updateStyle(t){t=t||window.getComputedStyle(this.view.elem,null),this.ctx.font=t.fontSize+"/"+t.lineHeight+" "+t.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.tw=this.ctx.measureText("幅").width,this.th=parseInt(t.fontSize,10),this.gap=this.view.squarify?this.th-this.tw:0,this.view.squarify&&(this.tw=this.th),this.pad=2*Math.ceil(.2*this.th);const e=t.color.match(/\d+/g),i=t.backgroundColor.match(/\d+/g);this.defaultColors.r=parseInt(e[0],10)/255,this.defaultColors.g=parseInt(e[1],10)/255,this.defaultColors.b=parseInt(e[2],10)/255,this.defaultColors.br=parseInt(i[0],10)/255,this.defaultColors.bg=parseInt(i[1],10)/255,this.defaultColors.bb=parseInt(i[2],10)/255}clear(){}render(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);const t=this.view.w,e=this.view.h;let i=this.view.buffer,s=(this.view.defaultColor,this.view.defaultBackground,!1);for(let r=0;r<e;++r)for(let e=0;e<t;++e){const n=i[r][e];let a=this.charMap[n.ch];void 0===a&&(this.cacheChars(n.ch,!1),s=!0,a=this.charMap[n.ch]);const o=6*this.attribs.color.itemSize*(r*t+e),h=6*this.attribs.charIndex.itemSize*(r*t+e),c=void 0===n.r?this.defaultColors.r:n.r/255,u=void 0===n.g?this.defaultColors.g:n.g/255,l=void 0===n.b?this.defaultColors.b:n.b/255,d=void 0===n.br?this.defaultColors.br:n.br/255,m=void 0===n.bg?this.defaultColors.bg:n.bg/255,p=void 0===n.bb?this.defaultColors.bb:n.bb/255;for(let t=0;t<6;++t){const e=o+t*this.attribs.color.itemSize;this.attribs.color.data[e+0]=c,this.attribs.color.data[e+1]=u,this.attribs.color.data[e+2]=l,this.attribs.bgColor.data[e+0]=d,this.attribs.bgColor.data[e+1]=m,this.attribs.bgColor.data[e+2]=p,this.attribs.charIndex.data[h+t]=a}}s&&this.buildTexture(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.color.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.color.data,this.attribs.color.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.bgColor.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.bgColor.data,this.attribs.bgColor.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.charIndex.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.charIndex.data,this.attribs.charIndex.hint);const r=this.attribs.position;this.gl.drawArrays(this.gl.TRIANGLES,0,r.data.length/r.itemSize)}compileShader(t,e){const i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const t="Error compiling shader: "+this.gl.getShaderInfoLog(i);throw this.gl.deleteShader(i),t}return i}initBuffers(){let t,e,i=this.attribs;const s=this.view.w,r=this.view.h;for(t in this.attribs)(e=i[t]).data=new Float32Array(6*e.itemSize*s*r);for(let t=0;t<r;++t)for(let e=0;e<s;++e){const r=6*i.position.itemSize*(t*s+e);this.insertQuad(i.position.data,r,e*this.tw,t*this.th,this.tw,this.th),this.insertQuad(i.texCoord.data,r,0,0,1,1)}for(t in this.attribs)(e=i[t]).buffer&&this.gl.deleteBuffer(e.buffer),e.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.data,e.hint),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.itemSize,this.gl.FLOAT,!1,0,0)}insertQuad(t,e,i,s,r,n){const a=i,o=s,h=i+r,c=s+n;t[e]=a,t[++e]=o,t[++e]=h,t[++e]=o,t[++e]=a,t[++e]=c,t[++e]=a,t[++e]=c,t[++e]=h,t[++e]=o,t[++e]=h,t[++e]=c}}(t)},A=120,N=180,B={r:255,g:165,b:0};class W extends E{lighted(t){return this}constructor(t,e=A,i=A,s=A){super(t,e,i,s)}litBackground(t,e){return t.setBackground(B.r*e,B.g*e,B.b*e),t}litColor(t,e){return t.setColor(B.r*e,B.g*e,B.b*e),t}}class G extends W{constructor(t){super(t,N,N,N)}}class F extends G{constructor(t,e,i,s){super(t),this.vr=e,this.vg=i,this.vb=s}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}class _ extends W{constructor(){super("＋")}lighted(t){let e=this.clone();return this.litColor(e,t),e.swapColors(),e}}class j extends W{constructor(t,e,i,s){super(t),this.vr=e,this.vg=i,this.vb=s}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}const H=new j("刀",200,200,200),$=new j("体",200,200,200),L=new j("胸",200,200,200),U=new j("石",200,200,200),q=new j("]",200,200,200),V=new j("[",255,255,0),z=new j("?",255,255,255),Y=new j("！",200,200,200),X=function(t){switch(t.group){case l.ItemGroup.OneHandWeapon:return H;case l.ItemGroup.Consumable:return $;case l.ItemGroup.BodyArmor:return L;case l.ItemGroup.Missile:return U;case l.ItemGroup.MissileWeapon:return q;case l.ItemGroup.Potion:return Y;case l.ItemGroup.Boots:return V;case l.ItemGroup.Scrolls:return z;default:return $}},J=new _,Q=new class extends _{lighted(t){let e=this.clone();return this.litColor(e,t),e}},K=new class extends W{constructor(){super("＃")}lighted(t){let e=this.clone();return this.litBackground(e,t),e.backgroundToColor(),e}},Z=new class extends W{constructor(){super("・")}lighted(t){return this.litColor(this.clone(),t)}},tt=new class extends W{constructor(){super("＞")}},et=new class extends W{constructor(){super("＜")}},it=new W("　",0,0,0),st=new W("^",255,255,255),rt=new W("^",0,191,255),nt=new W("^",255,255,0),at=new W("^",139,69,19),ot=new W("^",255,165,0),ht=new W("^",200,200,200),ct=new W("^",0,0,205);const ut=new class extends l.TileVisitor{onWall(t){this.tile=K}onFloor(t){this.tile=Z}onStairwayDown(t){this.tile=tt}onStairwayUp(t){this.tile=et}onDoor(t){t.open?this.tile=Q:this.tile=J}onTrap(t){if(t.revealed)switch(t.type){case l.TrapType.AirBlow:this.tile=st;break;case l.TrapType.Teleportation:this.tile=rt;break;case l.TrapType.Light:this.tile=nt;break;case l.TrapType.Hole:this.tile=at;break;case l.TrapType.BareWire:this.tile=ot;break;case l.TrapType.FallingRock:this.tile=ht;break;case l.TrapType.Water:this.tile=ct}else t.tile.visit(this)}onTrigger(t){t.tile.visit(this)}default(t){this.tile=it}},lt=new F("＠",0,255,0),dt=new F("r",197,65,38),mt=new F("G",120,120,120),pt=new W("　",0,0,0),ft=[new j("｜",200,200,200),new j("／",200,200,200),new j("ー",200,200,200),new j("＼",200,200,200)];var gt=s.a.extend({props:["level","player","pos"],data:()=>({wholeMap:!1,term:null,eng:null,drawInterval:null,ts:Date.now(),interval:100,step:0}),methods:{getTile(t,e){const i=this.stage.at(t,e).effect,s=this.wholeMap?this.stage.at(t,e):this.stage.at(t,e).tile;if(!s)return pt;if(i){if(s.creature){let t=this.creatureTile(s.creature).clone();return t.setBackground(200,0,0),t}return new W(i,200,200,0)}if(s.creature)return this.creatureTile(s.creature);if(s.items)switch(s.items.bunch.length){case 0:break;case 1:return X(s.items.bunch[0].item);default:const t=this.step%(3*this.animationFps+4);if(t<ft.length)return ft[t];{const t=Math.floor(this.step/(3*this.animationFps+4));return X(s.items.bunch[t%s.items.bunch.length].item)}}return function(t){return t.visit(ut),ut.tile}(s)},creatureTile:t=>"Rat"==t.name?dt:"Golem"==t.name?mt:lt,initViewport(){this.term=new class{constructor(t,e,i,s,r=!1){this.elem=t,this.w=e,this.h=i,this.squarify=r,this.cx=Math.floor(e/2),this.cy=Math.floor(i/2),this.elem.innerHTML="",-1===t.className.indexOf(k)&&(0===t.className.length?t.className=k:t.className+=" "+k),this.buffer=new Array(i);for(let t=0;t<i;++t){this.buffer[t]=new Array(e);for(let i=0;i<e;++i)this.buffer[t][i]=S}this.renderer=s(this)}updateStyle(t){const e=window.getComputedStyle(this.elem,null);this.defaultColor=e.color||void 0,this.defaultBackground=e.backgroundColor||void 0,t&&this.renderer.updateStyle(e)}getRendererString(){return this.renderer.getRendererString()}put(t,e,i){e<0||i<0||e>=this.w||i>=this.h||(this.buffer[i][e]=t)}unsafePut(t,e,i){this.buffer[i][e]=t}putString(t,e,i,s,r,n,a,o,h){const c=t.length;if(!(e<0||i<0))for(let u=0;u<c;++u){if(e>=this.w&&(e=0,++i),i>=this.h)return;const c=new E(t[u],s,r,n,a,o,h);this.unsafePut(c,e,i),++e}}get(t,e){return t<0||e<0||t>=this.w||e>=this.h?S:this.buffer[e][t]}clear(){for(let t=0;t<this.h;++t)for(let e=0;e<this.w;++e)this.buffer[t][e]=S;this.renderer.clear()}render(){this.renderer.render()}}(this.$refs.scene,Math.max(this.level.width,40),Math.max(this.level.height,40),D,!0),this.eng=new class{constructor(t,e,i,s){this.viewport=t,this.tileFunc=e,this.w=i,this.h=s,this.refreshCache=!0,this.cacheEnabled=!1,this.transitionDuration=0,this.cachex=0,this.cachey=0,this.tileCache=new Array(t.h),this.tileCache2=new Array(t.h);for(let e=0;e<t.h;++e)this.tileCache[e]=new Array(t.w),this.tileCache2[e]=new Array(t.w)}setTileFunc(t,e,i){e&&(this.transition=void 0,"string"==typeof e&&("boxin"===e?this.transition=function(t,e,i,s,r,n,a){const o=.5*i,h=.5*s;return t-=o,e-=h,Math.abs(t)<o*a&&Math.abs(e)<h*a?r:n}:"boxout"===e?this.transition=function(t,e,i,s,r,n,a){const o=.5*i,h=.5*s;return t-=o,e-=h,a=1-a,Math.abs(t)<o*a&&Math.abs(e)<h*a?n:r}:"circlein"===e?this.transition=function(t,e,i,s,r,n,a){const o=.5*i,h=.5*s;return(t-=o)*t+(e-=h)*e<(o*o+h*h)*a?r:n}:"circleout"===e?this.transition=function(t,e,i,s,r,n,a){const o=.5*i,h=.5*s;return(t-=o)*t+(e-=h)*e>(o*o+h*h)*(a=1-a)?r:n}:"random"===e&&(this.transition=function(t,e,i,s,r,n,a){return Math.random()>a?n:r})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=i||500)),this.tileFunc=t}setMaskFunc(t){this.maskFunc=t}setShaderFunc(t){this.shaderFunc=t}setWorldSize(t,e){this.w=t,this.h=e}setCacheEnabled(t){this.cacheEnabled=t,this.refreshCache=!0}update(t,e){t=t||0,e=e||0;const i=t-this.viewport.cx,s=e-this.viewport.cy,r=(new Date).getTime();let n,a;this.transition&&this.transitionTimer&&(n=(r-this.transitionTimer)/this.transitionDuration),n&&n>=1&&(this.transition=void 0);for(let t=0;t<this.viewport.h;++t)for(let e=0;e<this.viewport.w;++e){const o=e+i,h=t+s;if(this.w&&(o<0||o>=this.w))a=S;else if(this.h&&(h<0||h>=this.h))a=S;else if(this.maskFunc&&!this.maskFunc(o,h))a=S;else if(this.transition&&!this.refreshCache)a=this.transition(e,t,this.viewport.w,this.viewport.h,this.tileFunc(o,h),this.tileCache[t][e],n||0);else if(this.cacheEnabled&&!this.refreshCache){const t=o-this.cachex,e=h-this.cachey;t>=0&&t<this.viewport.w&&e>=0&&e<this.viewport.h?(a=this.tileCache[e][t])===S&&(a=this.tileFunc(o,h)):a=this.tileFunc(o,h)}else a=this.tileFunc(o,h);this.tileCache2[t][e]=a,this.shaderFunc&&a!==S&&(a=this.shaderFunc(a,o,h,r)),this.viewport.unsafePut(a,e,t)}this.cachex=i,this.cachey=s;const o=this.tileCache;this.tileCache=this.tileCache2,this.tileCache2=o,this.refreshCache=!1}}(this.term,(t,e)=>this.getTile(t,e),this.level.width,this.level.height),this.eng.setMaskFunc((t,e)=>this.wholeMap||this.stage.at(t,e).seen),this.eng.setShaderFunc((t,e,i,s)=>this.lighting(t,e,i,s)),clearInterval(this.drawInterval),this.drawInterval=setInterval(()=>{this.drawScene()},this.interval)},drawScene(){const t=Date.now();this.ts+1e3<t&&(this.ts=t),this.eng.update(this.pos.x,this.pos.y),this.term.render(),this.step+=1},lighting(t,e,i,s){if(this.wholeMap)return t.lighted(1);const r=this.stage.at(e,i);return r.visible&&t.lighted?t.lighted(r.degree):t}},computed:{stage(){return this.wholeMap?this.level:this.player.stageMemory(this.level)},animationFps(){return 1e3/this.interval}},mounted(){this.initViewport()},beforeDestroy(){clearInterval(this.drawInterval)},watch:{interval(){this.initViewport()},level(){clearInterval(this.drawInterval),this.initViewport()}}}),vt=(i(187),Object(h.a)(gt,function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"scene",staticClass:"unicodetiles"})},[],!1,null,null,null));vt.options.__file="Scene.vue";var wt=vt.exports;var yt=s.a.extend({name:"Title",data(){const t=new l.Application;return{app:t,game:t.titleGame(),loopIntervalId:void 0}},computed:{menuPage(){switch(this.app.menu.component){case l.MenuComponent.MainMenu:return b;case l.MenuComponent.ChooseGenderMenu:return v;case l.MenuComponent.ChooseRaceMenu:return p;case l.MenuComponent.AttributesMenu:return x;case l.MenuComponent.AttributesSelectionMenu:return I}},pos(){if(this.game.currentMap)return new l.Point(Math.round(.5*this.game.currentMap.width),Math.round(.4*this.game.currentMap.height))},race:()=>l.humanRace},components:{Scene:wt},methods:{loop(){this.game&&(this.game.turn(),this.game.done&&(this.game=this.app.titleGame()))},onEvent(t){this.$refs.menuComponent.onEvent(t)}},created(){this.loopIntervalId=window.setInterval(this.loop,100),document.addEventListener("keydown",this.onEvent)},beforeDestroy(){clearInterval(this.loopIntervalId),document.removeEventListener("keydown",this.onEvent)}}),bt=(i(189),Object(h.a)(yt,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[t.game?i("Scene",{attrs:{level:t.game.currentMap,player:t.game.player,pos:t.pos}}):t._e(),i("div",{staticClass:"title-view screen-modal"},[i("pre",{staticClass:"title"},[t._v(" ██████╗ ███╗   ██╗██╗███████╗██╗   ██╗███╗   ██╗\n██╔═══██╗████╗  ██║██║██╔════╝██║   ██║████╗  ██║\n██║   ██║██╔██╗ ██║██║███████╗██║   ██║██╔██╗ ██║\n██║   ██║██║╚██╗██║██║╚════██║██║   ██║██║╚██╗██║\n╚██████╔╝██║ ╚████║██║███████║╚██████╔╝██║ ╚████║\n ╚═════╝ ╚═╝  ╚═══╝╚═╝╚══════╝ ╚═════╝ ╚═╝  ╚═══╝")]),i(t.menuPage,{ref:"menuComponent",tag:"component",attrs:{menu:t.app.menu}})],1)],1)},[],!1,null,null,null));bt.options.__file="Title.vue";var Tt=bt.exports;s.a.use(r.a),fetch("locales/en.json",{cache:"no-store"}).then(t=>t.json()).then(t=>{const e=new a.a({phrases:t,locale:"en"});s.a.filter("t",(t,i,s,r)=>e.t(s?`${i}.${t}.${s}`:`${i}.${t}`,r)),new s.a({el:"#app",render:t=>t(Tt)})})}]);
//# sourceMappingURL=main.4384b7a4.js.map