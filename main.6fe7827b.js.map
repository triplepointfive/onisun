{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/Logger.vue?b5cd","webpack:///./components/Scene.vue?bf04","webpack:///./components/Stats.vue?4878","webpack:///./components/Impacts.vue?9a34","webpack:///./components/views/ProfessionPickingView.vue?aab7","webpack:///./components/views/ItemsListingView.vue?a6a8","webpack:///./components/views/TalentsTreeView.vue?d891","webpack:///./components/views/InventoryView.vue?5002","webpack:///./components/views/LookView.vue?a1ec","webpack:///./components/views/DeathView.vue?7f85","webpack:///./components/views/PickSingleOptionView.vue?1f3a","webpack:///./components/App.vue?6fed","webpack:///./src/engine/utils/utils.ts","webpack:///./src/engine/events/internal.ts","webpack:///./src/engine/events/player_event.ts","webpack:///./src/engine/events/after_event.ts","webpack:///./src/engine/lib/bunch.ts","webpack:///./src/engine/lib/impact.ts","webpack:///./src/engine/models/tile.ts","webpack:///./src/engine/lib/map_fov.ts","webpack:///./src/engine/utils/fov.ts","webpack:///./src/engine/lib/attribute.ts","webpack:///./src/engine/lib/stat.ts","webpack:///./src/engine/models/creature.ts","webpack:///./src/engine/events/move_event.ts","webpack:///./src/engine/ai/internal.ts","webpack:///./src/engine/ai/attacker.ts","webpack:///./src/engine/ai/chaser.ts","webpack:///./src/engine/ai/meta_ai.ts","webpack:///./src/engine/ai/escaper.ts","webpack:///./src/engine/ai/explorer.ts","webpack:///./src/engine/ai/picker.ts","webpack:///./src/engine/ai/loiter.ts","webpack:///./src/engine/ai/patrol.ts","webpack:///./src/engine/ai/thrower.ts","webpack:///./src/engine/ai/descender.ts","webpack:///./src/engine/events/stay_event.ts","webpack:///./src/engine/ai/selfhealer.ts","webpack:///./src/engine/presenters/internal.ts","webpack:///./src/engine/models/specie.ts","webpack:///./src/engine/models/items.ts","webpack:///./src/engine/events/die_event.ts","webpack:///./src/engine/presenters/death_presenter.ts","webpack:///./src/engine/ai/player_ai.ts","webpack:///./src/engine/events/add_experience_event.ts","webpack:///./src/engine/events/add_impact_event.ts","webpack:///./src/engine/lib/calculator.ts","webpack:///./src/engine/events/hurt_event.ts","webpack:///./src/engine/events/attack_event.ts","webpack:///./src/engine/events/drink_potion_event.ts","webpack:///./src/engine/events/drop_items_event.ts","webpack:///./src/engine/events/level_up_event.ts","webpack:///./src/engine/models/tile_effect.ts","webpack:///./src/engine/events/throw_event.ts","webpack:///./src/engine/events/take_off_item_event.ts","webpack:///./src/engine/events/remove_item_event.ts","webpack:///./src/engine/events/missile_attack_event.ts","webpack:///./src/engine/events/pick_up_items_event.ts","webpack:///./src/engine/events/put_on_item_event.ts","webpack:///./src/engine/events/remove_impact_event.ts","webpack:///./src/engine/events/visible_creature_event.ts","webpack:///./src/engine/generator/post.ts","webpack:///./src/engine/events/teleportation_event.ts","webpack:///./src/engine/events/trap_event.ts","webpack:///./src/engine/events/untrap_event.ts","webpack:///./src/engine/generator/drawn.ts","webpack:///./src/engine/generator/dungeon.ts","webpack:///./src/engine/lib/damage.ts","webpack:///./src/engine/models/logger.ts","webpack:///./src/engine/models/talent.ts","webpack:///./src/engine/presenters/look_presenter.ts","webpack:///./src/engine/lib/level.ts","webpack:///./src/engine/lib/pool.ts","webpack:///./src/engine/lib/timeline.ts","webpack:///./src/engine/models/dungeon.ts","webpack:///./src/engine/models/level_map.ts","webpack:///./src/engine/models/game.ts","webpack:///./src/engine/models/inventory_slot.ts","webpack:///./src/engine/models/inventory.ts","webpack:///./src/engine/models/memory.ts","webpack:///./src/engine/models/player.ts","webpack:///./src/engine/models/profession.ts","webpack:///./src/engine/models/traps/light_trap.ts","webpack:///./src/engine/models/traps/teleportation_trap.ts","webpack:///./src/engine/presenters/inventory_presenter.ts","webpack:///./src/engine/presenters/missile_presenter.ts","webpack:///./src/engine/presenters/pick_single_option_presenter.ts","webpack:///./src/engine/presenters/idle_presenter.ts","webpack:///./src/engine/presenters/items_listing_presenter.ts","webpack:///./src/engine/presenters/drink_presenter.ts","webpack:///./src/engine/presenters/pick_point_presenter.ts","webpack:///./src/engine/presenters/talents_tree_presenter.ts","webpack:///./src/engine/presenters/teleportation_presenter.ts","webpack:///./src/engine/presenters/pick_up_presenter.ts","webpack:///./src/engine/presenters/profession_picking_presenter.ts","webpack:///./src/engine/utils/lee_path.ts","webpack:///./components/Logger.vue?93db","webpack:///./components/Logger.vue?dfa9","webpack:///./components/Logger.vue","webpack:///./components/Logger.vue?f046","webpack:///./vendor/unicodetiles.ts/src/unicodetiles.ts","webpack:///./vendor/unicodetiles.ts/src/CanvasRenderer.ts","webpack:///./vendor/unicodetiles.ts/src/WebGLRenderer.ts","webpack:///./src/onisun/talents.ts","webpack:///./src/onisun/professions.ts","webpack:///./src/onisun/items.ts","webpack:///./src/onisun/potions.ts","webpack:///./src/onisun/creatures.ts","webpack:///./src/engine/ai/dispatcher.ts","webpack:///./src/onisun/dungeons/tutorial_dungeon.ts","webpack:///./src/onisun.ts","webpack:///./components/scene_tiles.ts","webpack:///./components/Scene.vue?a309","webpack:///./components/Scene.vue?972d","webpack:///./components/Scene.vue","webpack:///./components/Scene.vue?8f4c","webpack:///./components/PrimaryAttribute.vue?99e7","webpack:///./components/PrimaryAttribute.vue?fa93","webpack:///./components/PrimaryAttribute.vue","webpack:///./components/PrimaryAttribute.vue?8818","webpack:///./components/shows.ts","webpack:///./components/Stats.vue?772b","webpack:///./components/Stats.vue?2674","webpack:///./components/Stats.vue","webpack:///./components/Stats.vue?53d8","webpack:///./components/Impacts.vue?11e4","webpack:///./components/Impacts.vue?fd8b","webpack:///./components/Impacts.vue","webpack:///./components/Impacts.vue?27df","webpack:///./components/views/IdleView.vue?bc3e","webpack:///./components/views/IdleView.vue?d3da","webpack:///./components/views/IdleView.vue","webpack:///./components/views/IdleView.vue?7799","webpack:///./components/views/ProfessionPickingView.vue?69ea","webpack:///./components/views/ProfessionPickingView.vue?b4ad","webpack:///./components/views/ProfessionPickingView.vue","webpack:///./components/views/ProfessionPickingView.vue?de9c","webpack:///./components/views/ItemsListingView.vue?4aeb","webpack:///./components/views/ItemsListingView.vue?a2d9","webpack:///./components/views/ItemsListingView.vue","webpack:///./components/views/ItemsListingView.vue?2d36","webpack:///./components/views/TalentsTreeView.vue?3b29","webpack:///./components/views/TalentsTreeView.vue?639b","webpack:///./components/views/TalentsTreeView.vue","webpack:///./components/views/TalentsTreeView.vue?5c94","webpack:///./components/views/InventoryView.vue?c09a","webpack:///./components/views/InventoryView.vue?0d4b","webpack:///./components/views/InventoryView.vue","webpack:///./components/views/InventoryView.vue?b84f","webpack:///./components/views/LookView.vue?9818","webpack:///./components/views/LookView.vue?bdc0","webpack:///./components/views/LookView.vue","webpack:///./components/views/LookView.vue?975e","webpack:///./components/views/MissileView.vue?1488","webpack:///./components/views/MissileView.vue?2e63","webpack:///./components/views/MissileView.vue","webpack:///./components/views/MissileView.vue?ebb5","webpack:///./components/views/DeathView.vue?a86c","webpack:///./components/views/DeathView.vue?9ad1","webpack:///./components/views/DeathView.vue","webpack:///./components/views/DeathView.vue?0102","webpack:///./components/views/PickSingleOptionView.vue?a8e8","webpack:///./components/views/PickSingleOptionView.vue?f2a3","webpack:///./components/views/PickSingleOptionView.vue","webpack:///./components/views/PickSingleOptionView.vue?53c3","webpack:///./components/App.vue?a6a8","webpack:///./components/App.vue?c0b2","webpack:///./components/App.vue","webpack:///./components/App.vue?9530","webpack:///./components/index.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","succ","String","fromCharCode","charCodeAt","twoDimArray","width","height","field","Array","Point","[object Object]","x","y","this","point","Math","abs","dxy","map","add","Mapped","on","forEach","column","tile","bresenham","p0","p1","x0","x1","y0","y1","steps","max","delta","round","bresenhamInclusion","Direction","super","up","down","left","right","upLeft","upRight","downLeft","downRight","CreatureEvent","subject","affectCreature","player_event_PlayerEvent","creature","Reaction","NOTHING","after_event_AfterEvent","levelMap","game","player","removeImpact","ImpactType","Overloaded","Stressed","Loaded","stuffWeight","current","carryingCapacity","flattenedStart","die_event_DieEvent","DieReason","overloadedStart","addImpact","loadedStart","stressed","bunch_ItemsBunch","bunch","item","find","invItem","groupsWith","count","undefined","lodash","inventoryItem","inv","groupedItem","put","TileTypes","TrapType","impact_Impact","constEffects","tempEffects","turns","effect","impact","ImpactBunch","impacts","Map","activeImpacts","types","type","active","impactByType","addTempEffect","removeTempEffect","addConstEffect","removeConstEffect","turn","set","tile_Tile","kind","items","Floor","actor","Wall","id","buildNew","clone","tileVisitor","onFloor","tile_Room","Door","onDoor","onWall","Stairway","currentMap","adjacentMapId","StairwayDown","onStairwayDown","StairwayUp","onStairwayUp","Trap","revealed","onTrap","affect","TriggerTile","singleUse","Trigger","onTrigger","creaturePos","setTile","LogMessageTrigger","message","logger","info","TileVisitor","wall","default","floor","stairway","onStairway","door","trigger","trap","buildFov","pos","radius","memory","startx","starty","solidChecker","markVisible","doubleRadius","isSolid","dx","dy","castLight","row","start","end","xx","xy","yx","yy","newStart","blocked","distance","deltaY","deltaX","currentX","currentY","leftSlope","rightSlope","doubleDistance","stage","visible","at","visit","visibleThrough","degree","see","calc","attribute_Attribute","modifiers","maximum","atMax","modifier","min","increase","decrease","val","currentValue","AttributeSet","attack","defense","dexterity","pairSet","Modifier","weight","Stat","base","rate","extra","CapacityLimitStat","strength","constitution","strengthRatio","constitutionRatio","stat_HealthStat","specie","currentTurn","maxHealthValue","regenerationRate","regenerationValue","StrengthStat","meleeAdjustment","Clan","Ability","allAbilities","GoStairwayDown","Inventory","PutOn","Throwing","creature_Creature","getId","stageMemories","dead","health","lastId","clan","protections","damages","ability","abilities","event","speed","moveSpeed","visionMask","resetVisible","memory_Memory","visionRadius","impactsBunch","_impactsBunch","addConstImpact","removeConstImpact","hasImpact","Blind","bodyControl","resistance","resistances","move_event_SteppingTileVisitor","activate","move_event_MoveEvent","nextPoint","nextLevel","removeCreature","addCreature","reset","enter","internal_AI","destination","move","eq","dest","buildPath","leePath","stageMemory","tangible","tileVisited","pointsToCheck","wavePoints","inRange","wrappers","dist","enemy","FreeForAll","Player","PlayerOnlyEnemy","FollowTargetAI","foundNewTarget","checkCurrentTile","goTo","onCantMove","moveTo","onReach","internal_GoToTileAI","matcher","path","pop","attacker_Attacker","firstTurn","canAttack","victim","victimInAccess","attack_event_AttackEvent","pickNewVictim","act","findCreature","enemies","condition","chaser_Chaser","victimSet","buildVictimPath","foundNewVictim","victimId","followTo","withinView","nextTo","AIEvent","AIItemPickedEvent","meta_ai_MetaAI","aiToRun","events","run","resetEvents","STEP_DISTANCE","escaper_Escaper","escapesFrom","foundEnemies","buildEscapePath","minDistance","explorer_Explorer","seen","picker_Picker","can","creatureTile","ai","pushEvent","pick_up_items_event_PickUpItemsEvent","loiter_Loiter","NEW_POINT_EVERY","patrol_PatrolTileVisitor","status","patrol_Patrol","step","firstCallPatrol","graph","graphlib","lastNodeVisit","currentNodeID","markNodeVisited","nodes","addNode","moveToTarget","targetNodeID","pickUpNewTarget","setNode","setEdge","node","seenLastID","seenLastStep","neighbors","nodeID","buildNewPath","thrower_Thrower","hasMissile","missile_attack_event_MissileAttackEvent","reaction","DIE","previousVictim","missiles","missile","findWithId","obstacles","target","descender_StairwayDownFinderVisitor","match","descender_StairwayDownTileMoverVisitor","adjacentMap","getMap","enterPos","matchStairs","descender_Descender","visitor","stay_event_StayEvent","selfhealer_SelfHealer","PresenterType","Resistance","Usage","ItemGroup","ItemSubgroup","ProtectionType","internal_Presenter","endTurn","presenter","redirect","idle_presenter_IdlePresenter","death_presenter_DeathPresenter","dieReason","Death","playerName","player_ai_AINewLevelEvent","level","profession_picking_presenter_ProfessionPickingPresenter","talents_tree_presenter_TalentsTreePresenter","player_ai_AITeleportationEvent","rebuildVision","teleportation_presenter_TeleportationPresenter","player_ai_PlayerAI","levelUps","runEvents","add_experience_event_AddExperienceEvent","add_impact_event_AddImpactEvent","impactType","source","duration","applyImpact","calculator_Calculator","attackerBC","victimBC","random","pow","actorBC","ratio","atan","PI","protectionTypes","victimResistances","every","resistTo","damage","resist","dice","dropDice","protectionValue","damageType","DamageType","Melee","Pierce","Blunt","Intangible","Magic","MagicDamage","Pure","times","armorToDamageRatio","armorType","Medium","Solid","Light","Unarmored","Heavy","items_Item","group","usages","canSeeDetails","Corpse","Consumable","Potion","Missile","MissileWeapon","Shoot","Weapon","usage","OneHandWeapon","WeaponOneHand","Armor","BodyArmor","WearsOnBody","Boots","reason","addItem","inventoryItems","hurt_event_HurtEvent","doneDamage","RESIST","Attack","HURT","process","noDamageToPlayer","playerIgnoresDamage","noDamageToTarget","targetIgnoresDamage","misses","missMessage","DODGE","hurtEvent","killMessage","hurtMessage","drink_potion_event_DrinkPotionEvent","potion","removeItem","onDrink","drink","drop_items_event_DropItemsEvent","subtract","droppedItem","level_up_event_LevelUpEvent","updateHealth","constantDecrease","constantIncrease","TileEffect","onDone","ItemFlightTileEffect","frames","done","patchMemory","throw_event_ThrowEvent","throwMissMessage","THROW_DODGE","throwDamageTo","throwKillMessage","throwHurtMessage","take_off_item_event_TakeOffItemEvent","slot","equipment","takeOff","onTakeOff","inventory","putToBag","itemProtection","itemsProtections","protection","itemDamage","itemsDamages","remove_impact_event_RemoveImpactEvent","remove_item_event_RemoveItemEvent","withMissile","missileSlot","flightPath","tileItems","withTileItems","pickedUpItem","remove","put_on_item_event_PutOnItemEvent","groupItem","findInBag","useSingleItem","equip","onPutOn","putOn","concat","visible_creature_event_VisibleCreatureEvent","withMatchingTile","onValid","iters","teleportation_event_TeleportationEvent","selfCast","playerSees","hasResistance","TeleportationControl","teleport","creatureNotTeleported","creatureTeleported","playerTeleportationCaused","playerTeleported","playerNotTeleported","teleported","isFloor","passibleThrough","_a","trap_event_TrapEvent","dodgeRatio","onCreatureDodge","onCreatureActivated","sees","dodges","untrap_event_UntrapEvent","trapPosition","untrap","drawn","drawMap","collection","charAt","RAY_TURNS","LogLevel","TalentStatus","LookPresenterVisibility","Level","requires","currentExperience","doneLeveling","requiredExperience","exp","levelUp","pool_Pool","totalWeight","ceil","input","pick","found","pool","totalPool","timeline_Timeline","ts","element","nextStep","next","actors","parseInt","dungeon_Dungeon","levels","adjustMapId","addStairs","level_map_LevelMap","creatures","timeline","each","adjustId","stairPos","logger_Logger","messages","debug","warning","addMessage","DEBUG","INFO","DANGER","WARNING","lastRow","counter","game_Game","professionPicker","running","maps","levelMapTurn","Function","builtLevelMap","generator","actorId","inventory_slot_InventorySlot","cares","filter","itemGroup","baseMatch","worksWith","inventory_slot_RightHandSlot","inventory_slot_LeftHandSlot","inventory_slot_HeadSlot","WearsOnHead","inventory_slot_ChestSlot","inventory_slot_GlovesSlot","Gloves","inventory_slot_GauntletsSlot","Gauntlets","inventory_slot_BeltSlot","Belt","inventory_slot_BootsSlot","inventory_slot_AmuletSlot","Amulet","inventory_slot_LeftFingerSlot","Ring","inventory_slot_RightFingerSlot","inventory_slot_CloakSlot","Cloak","inventory_slot_MissileWeaponSlot","matchingItems","withPairItem","inventory_slot_MissileSlot","Throw","missileWeapon","missileWeaponSlot","inventory_slot_ToolsSlot","Tool","inventory_Inventory","bag","headSlot","amuletSlot","cloakSlot","chestSlot","rightHandSlot","leftHandSlot","leftFingerSlot","rightFingerSlot","glovesSlot","gauntletsSlot","beltSlot","bootsSlot","toolsSlot","allItems","slots","unarmoredSlotsCount","MemoryTile","baseTile","player_Player","strengthValue","constitutionValue","professions","itemsResistances","intelligence","wisdom","charisma","statsTurn","command","affectPlayer","removeFromBag","strengthAdjustment","dmg","Profession","points","talents","depthCost","profession_ProfessionPicker","maxLevel","maxTaken","pickedProfession","canUpdate","updatableProfession","canTakeNewProfession","newFromPool","some","profession","excludeId","excluding","Talent","depth","rank","maxRank","description","light_trap_LightTrap","canNotUntrap","isPlayer","playerDodgesTeleportationTrap","creatureDodgesTeleportationTrap","teleportation_trap_TeleportationTrap","Teleportation","inventory_presenter_InventoryPresenter","positions","takeTime","rebuildPositions","position","inventorySlot","items_listing_presenter_PutOnItemsPresenter","availableItems","missile_presenter_MissilePresenter","targetEnemyIndex","findEnemies","targetPos","resetTargetId","updateTarget","direction","resetPath","newPos","copy","drawPath","stop","pick_single_option_presenter_PickSingleOptionPresenter","options","withOption","PickHandleOption","option","goIdle","idle_presenter_HandleTileVisitor","commands","AdjustHandleTileVisitor","Idle","BagPresenter","items_listing_presenter_DropItemsPresenter","drink_presenter_DrinkPresenter","look_presenter_LookPresenter","ranIntoAnObstacle","noItemsToPickUp","pick_up_presenter_PickUpPresenter","canThrow","needMissileWeapon","nothingToShotWith","adjustVisitor","howToHandle","items_listing_presenter_ItemsListingPresenter","ItemsListing","title","initPositions","onWithItem","singleItemMode","pick_point_presenter_PickPointPresenter","removeEffect","close","memoryTile","drawTarget","Look","See","Recall","Hidden","body","AbilitiesPicking","talent","assign","professionId","talentId","Available","onObtain","Completed","Unavailable","playerTeleportedWhereTheyWere","ProfessionPicking","available","playerProfession","randomDestination","pointsToVisit","randomPointToVisit","buildRoad","lastPoint","chain","dp","unshift","components_Loggervue_type_script_lang_ts_","vue_runtime_esm","extend","props","required","computed","currentMessagesCount","methods","record","component","componentNormalizer","_vm","_h","$createElement","_c","_self","staticClass","_l","class","rowClass","_v","_s","__file","components_Logger","unicodetiles_Tile","ch","g","b","br","bg","bb","grey","toString","other","CSSCLASS","NULLTILE","VERTEX_SHADER","FRAGMENT_SHADER","webGLRenderer","viewport","view","canvas","document","createElement","getContext","gl","elem","appendChild","charMap","charArray","defaultColors","attribs","buffer","itemSize","location","hint","STATIC_DRAW","texCoord","color","DYNAMIC_DRAW","bgColor","charIndex","offscreen","style","top","ctx","updateStyle","squarify","th","tw","w","h","vertexShader","compileShader","fragmentShader","program","createProgram","attachShader","linkProgram","deleteShader","getProgramParameter","LINK_STATUS","msg","getProgramInfoLog","deleteProgram","useProgram","getAttribLocation","initBuffers","resolutionLocation","getUniformLocation","uniform2f","tileCountsLocation","paddingLocation","texture","createTexture","bindTexture","TEXTURE_2D","cacheChars","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","activeTexture","TEXTURE0","setTimeout","buildTexture","render","pad","charCount","sqrt","fillStyle","fillRect","halfGap","gap","fillText","texImage2D","RGBA","UNSIGNED_BYTE","chars","build","changed","getComputedStyle","font","fontSize","lineHeight","fontFamily","textBaseline","measureText","backgroundColor","clear","COLOR_BUFFER_BIT","tiles","newChars","defaultColor","defaultBackground","k","kk","bindBuffer","ARRAY_BUFFER","bufferData","attrib","drawArrays","TRIANGLES","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","a","Float32Array","insertQuad","deleteBuffer","createBuffer","enableVertexAttribArray","vertexAttribPointer","FLOAT","arr","x2","y2","OnisunTalentId","OnisunProfessionId","talents_OnisunTalent","AttackerTwoHandedWeapons","professions_OnisunAttackerProfession","Attacker","professions_OnisunDefenderProfession","Defender","professions_OnisunProfessionPicker","attacker","defender","items_MissileRock","items_Sling","items_Arrow","items_Bow","noMod","commonBow","smallRock","woodenArrow","ironArrow","items_LightSpeedBoots","newCreature","throwingItem","escaper","explorer","chaser","picker","patrol","loiter","thrower","descender","feelsGood","explore","healthCritical","trackMovement","attackSpeed","rat","initId","ratId","tutorial_dungeon_TutorialDungeon","addMap","generateMap","scheme","onisun_Onisun","DEFAULT_GREY","IMPORTANT_GREY","DEFAULT_LIT","scene_tiles_DisplayTile","char","setBackground","setColor","ImportantTile","CreatureTile","vr","vg","vb","ItemTile","WEAPON","CORPSE","BODY_ARMOR","MISSILE","MISSILE_WEAPON","BOOTS","POTION","displayItem","DOOR","litColor","swapColors","WALL","litBackground","backgroundToColor","FLOOR","STAIRWAY_DOWN","STAIRWAY_UP","NULL_TILE","TELEPORTATION_TRAP","LIGHT_TRAP","displayTileVisitor","HUMAN","RAT","GOLEM","Scenevue_type_script_lang_ts_NULL_TILE","nextItemAnimation","components_Scenevue_type_script_lang_ts_","wholeMap","term","eng","drawInterval","Date","now","interval","dTile","frame","animationFps","itemId","displayTile","renderer","cx","cy","innerHTML","className","indexOf","updateRenderer","getRendererString","str","len","unsafePut","$refs","scene","tileFunc","refreshCache","cacheEnabled","transitionDuration","cachex","cachey","tileCache","tileCache2","func","transition","new_t","old_t","factor","halfw","halfh","transitionTimer","getTime","maskFunc","shaderFunc","timeNow","transTime","ixx","jyy","lookupx","lookupy","tempCache","getTile","setMaskFunc","setShaderFunc","time","lighting","clearInterval","setInterval","drawScene","update","lighted","fovTile","initViewport","watch","Scene_component","ref","Scene","components_PrimaryAttributevue_type_script_lang_ts_","slug","attr","PrimaryAttribute_component","attrs","triggers","container","placement","fullName","PrimaryAttribute","showDamage","showDamageType","showProtection","components_Statsvue_type_script_lang_ts_","components","attribute","join","displayAttribute","Stats_component","levelProgress","role","healthLevel","full-name","Stats","components_Impactsvue_type_script_lang_ts_","Impacts_component","src","icon","domProps","textContent","Impacts","views_IdleViewvue_type_script_lang_ts_","screen","handleCommand","lookCommand","stayCommand","inventoryCommand","bagCommand","missileCommand","pickUpCommand","dropCommand","drinkCommand","console","log","IdleView_component","IdleView","views_ProfessionPickingViewvue_type_script_lang_ts_","picked","doubleClickOption","pickProfession","iconPath","ProfessionPickingView_component","click","$event","dblclick","variant","_e","ProfessionPickingView","views_ItemsListingViewvue_type_script_lang_ts_","page","perPage","selected","pickUpItems","index","selectAt","withItem","indexLetter","positionStatus","itemWeight","ItemsListingView_component","carryingWeight","positionSelected","ItemsListingView","views_TalentsTreeViewvue_type_script_lang_ts_","professionIndex","groups","availableIndex","letter","pickTalent","groupedTalents","tip","AttackerHeavyWeapons","AttackerLightWeapons","AttackerTwoWeapons","AttackerDoubleTwoHandedWeapons","AttackerStrongGrip","TalentsTreeView_component","card","model","callback","$$v","expression","no-body","talentStatus","talentTip","TalentsTreeView","views_InventoryViewvue_type_script_lang_ts_","showItemDetails","displayBodyPart","bodyPart","getChar","itemName","InventoryView_component","availableStatus","positionDetails","InventoryView","views_LookViewvue_type_script_lang_ts_","inputKey","onInput","moveTarget","LookView_component","LookView","views_MissileViewvue_type_script_lang_ts_","nextTarget","previousTarget","MissileView_component","MissileView","views_DeathViewvue_type_script_lang_ts_","DeathView_component","signature","DeathView","views_PickSingleOptionViewvue_type_script_lang_ts_","PickSingleOptionView_component","optionName","PickSingleOptionView","components_Appvue_type_script_lang_ts_","initPlayer","dungeon","register","prof","dagger","katana","plateArmor","wooden","iron","rock","bow","loopIntervalId","Logger","viewComponent","onEvent","main","loop","addEventListener","removeEventListener","App_component","level-map","tag","App","use","es","el"],"mappings":"aACA,SAAAA,EAAAC,GAQA,IAPA,IAMAC,EAAAC,EANAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAIAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAKA,IAFAe,KAAAhB,GAEAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,GAAA,EACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,GAAA,GAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,GAAA,EACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,GAAA,EAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GAA0CI,YAAA,EAAAC,IAAAJ,KAK1CX,EAAAgB,EAAA,SAAAZ,GACA,oBAAAa,eAAAC,aACAlC,OAAA6B,eAAAT,EAAAa,OAAAC,aAAwDC,MAAA,WAExDnC,OAAA6B,eAAAT,EAAA,cAAiDe,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAvC,OAAAwC,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAvC,OAAA6B,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAS,EAAAc,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAtB,GACA,IAAAM,EAAAN,KAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAgB,EAAAC,GAAsD,OAAA7C,OAAAC,UAAAC,eAAAC,KAAAyC,EAAAC,IAGtD7B,EAAA8B,EAAA,WAEA,IAAAC,EAAAC,OAAA,aAAAA,OAAA,iBACAC,EAAAF,EAAAhD,KAAA2C,KAAAK,GACAA,EAAAhD,KAAAX,EACA2D,IAAAG,QACA,QAAAvD,EAAA,EAAgBA,EAAAoD,EAAAlD,OAAuBF,IAAAP,EAAA2D,EAAApD,IACvC,IAAAU,EAAA4C,EAIA1C,EAAAR,MAAA,OAEAU,8UCtJ0X,mDCAzB,mDCAwB,oDCAE,oDCAK,oDCAL,oDCAD,oDCAF,oDCAmB,oDCAvB,oDCAmC,oDCAxD,yFCkBxV,MAAM0C,EAAO,SAAS3B,GAC3B,OAAO4B,OAAOC,aAAa7B,EAAE8B,WAAW,GAAK,IAOlCC,EAAc,SACzBC,EACAC,EACAtB,GAEA,IAAIuB,EAAQC,MAAMH,GAElB,IAAK,IAAI7D,EAAI,EAAGA,EAAI6D,EAAO7D,IAAK,CAC9B+D,EAAM/D,GAAK,IAAIgE,MAAMF,GACrB,IAAK,IAAI5C,EAAI,EAAGA,EAAI4C,EAAQ5C,IAC1B6C,EAAM/D,GAAGkB,GAAKsB,EAAMxC,EAAGkB,GAI3B,OAAO6C,SAGIE,EACXC,YAAmBC,EAAkBC,GAAlBC,KAAAF,IAAkBE,KAAAD,IAa9BF,GAAGI,GACR,OAAOD,KAAKF,IAAMG,EAAMH,GAAKE,KAAKD,IAAME,EAAMF,EAGzCF,OAAOI,GACZ,OAAOC,KAAKC,IAAIH,KAAKF,EAAIG,EAAMH,IAAM,GAAKI,KAAKC,IAAIH,KAAKD,EAAIE,EAAMF,IAAM,EAGnEF,OACL,OAAO,IAAID,EAAMI,KAAKF,EAAGE,KAAKD,GAGzBF,IAAII,GACT,OAAO,IAAIL,EAAMI,KAAKF,EAAIG,EAAMH,EAAGE,KAAKD,EAAIE,EAAMF,GAG7CF,WACL,OAAOD,EAAMQ,IAAIC,IAAIJ,GAASD,KAAKM,IAAIL,KA5BlBL,EAAAQ,KACrB,IAAIR,GAAO,GAAI,GACf,IAAIA,EAAM,GAAI,GACd,IAAIA,EAAM,GAAI,GACd,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,GAAO,EAAG,GACd,IAAIA,EAAM,EAAG,GACb,IAAIA,EAAM,EAAG,UAwBKW,EAIpBV,YAAmBQ,GAAAL,KAAAK,MACjBL,KAAKR,MAAQa,EAAIxE,OACjBmE,KAAKP,OAASY,EAAI,GAAGxE,OAGhBgE,GAAGC,EAAWC,GACnB,OAAOC,KAAKK,IAAIP,GAAGC,GAGdF,QAAQI,GACb,OACEA,EAAMH,GAAK,GACXG,EAAMF,GAAK,GACXE,EAAMH,EAAIE,KAAKR,OACfS,EAAMF,EAAIC,KAAKP,OAIZI,KAAKW,GACVR,KAAKK,IAAII,QAAQ,CAACC,EAAQZ,KACxBY,EAAOD,QAAQ,CAACE,EAAMZ,KACpBS,EAAGG,EAAMb,EAAGC,QAMb,MAiBMa,EAAY,SACvBC,EACAC,EACAN,GAEA,IAAKO,EAAIC,EAAIC,EAAIC,IAAOL,EAAGf,EAAGgB,EAAGhB,EAAGe,EAAGd,EAAGe,EAAGf,GACzCoB,EAAQjB,KAAKkB,IAAIlB,KAAKC,IAAIY,EAAKC,GAAKd,KAAKC,IAAIc,EAAKC,IACtD,MAAMG,EAAQ,IAAIzB,GAAOoB,EAAKD,GAAMI,GAAQD,EAAKD,GAAME,GAEvD,KAAOA,EAAQ,GACbJ,GAAMM,EAAMvB,EACZmB,GAAMI,EAAMtB,EAEZS,EAAGN,KAAKoB,MAAMP,GAAKb,KAAKoB,MAAML,IAE9BE,GAAS,GAIAI,EAAqB,SAChCV,EACAC,EACAN,GAEAI,EAAUC,EAAIC,EAAIN,GAClBA,EAAGM,EAAGhB,EAAGgB,EAAGf,UAGDyB,UAAkB5B,EAC7BC,YAAoBC,EAAWC,GAC7B0B,MAAM3B,EAAGC,IAGKyB,EAAAE,GAAK,IAAIF,EAAU,GAAI,GACvBA,EAAAG,KAAO,IAAIH,EAAU,EAAG,GACxBA,EAAAI,KAAO,IAAIJ,GAAW,EAAG,GACzBA,EAAAK,MAAQ,IAAIL,EAAU,EAAG,GAEzBA,EAAAM,OAAS,IAAIN,GAAW,GAAI,GAC5BA,EAAAO,QAAU,IAAIP,EAAU,GAAI,GAC5BA,EAAAQ,SAAW,IAAIR,GAAW,EAAG,GAC7BA,EAAAS,UAAY,IAAIT,EAAU,EAAG,SCpKzBU,EAEbrC,aAAasC,GAClB,OAAOnC,KAAKoC,eAAeD,UCHlBE,UAAoBH,EACxBrC,eAAeyC,GACpB,OAAOC,EAASC,eCAPC,UAAmBJ,EAC9BxC,YAAoB6C,EAA4BC,GAC9ClB,QADkBzB,KAAA0C,WAA4B1C,KAAA2C,OAIzC9C,aAAa+C,GAKlB,OAJAA,EAAOC,aAAaC,EAAWC,WAAY,OAC3CH,EAAOC,aAAaC,EAAWE,SAAU,OACzCJ,EAAOC,aAAaC,EAAWG,OAAQ,OAEnCL,EAAOM,YAAYC,QAAUP,EAAOQ,iBAAiBC,eAChDT,EAAOpC,GACZ,IAAI8C,GAAStD,KAAK2C,KAAM3C,KAAK0C,SAAUa,GAAUR,cAIjDH,EAAOM,YAAYC,QAAUP,EAAOQ,iBAAiBI,gBACvDZ,EAAOa,UAAUX,EAAWC,WAAY,OAExCH,EAAOM,YAAYC,QAAUP,EAAOQ,iBAAiBM,YAErDd,EAAOa,UAAUX,EAAWG,OAAQ,OAC3BL,EAAOM,YAAYC,QAAUP,EAAOQ,iBAAiBO,UAC9Df,EAAOa,UAAUX,EAAWE,SAAU,OAGjCT,EAASC,gBCpBPoB,EAAb/D,cACSG,KAAA6D,SAEAhE,KAAKiE,GACV,OAAO9D,KAAK6D,MAAME,KAAKC,GAAWA,EAAQF,KAAKG,WAAWH,IAGrDjE,OAAOiE,EAAYI,GACxB,MAAMF,EAAUhE,KAAK+D,KAAKD,QAEVK,IAAZH,IAGOA,EAAQE,QAAUA,EAC3BlI,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK6D,MAAOQ,GACjBA,EAAcP,KAAKG,WAAWD,EAAQF,OAGxCE,EAAQE,OAASA,GAIdrE,IAAIiE,EAAYI,GACrB,MAAMF,EAAUhE,KAAK6D,MAAME,KAAKO,GAAOA,EAAIR,KAAKG,WAAWH,IAEvDE,EACFA,EAAQE,OAASA,EAEjBlE,KAAK6D,MAAM9H,MAAOmI,MAAOA,EAAOJ,KAAMA,IAInCjE,QACL,IAAIgE,EAAQ,IAAID,EAMhB,OAJA5D,KAAK6D,MAAMpD,QAAQ8D,IACjBV,EAAMW,IAAID,EAAYT,KAAMS,EAAYL,SAGnCL,GChDX,IAAYf,ECKA2B,EA8JAC,GDnKZ,SAAY5B,GACVA,IAAA,iBACAA,IAAA,uBACAA,IAAA,mBACAA,IAAA,2BAJF,CAAYA,iBAON6B,EAIJ9E,cAHQG,KAAA4E,gBACA5E,KAAA6E,YAAsB,EAIvBhF,cAAciF,GACnB9E,KAAK6E,aAAeC,EAGfjF,eAAekF,GAEpB/E,KAAK4E,aAAa7I,KAAKgJ,GAGlBlF,mBACLG,KAAK6E,YAAc,EAGdhF,kBAAkBkF,GACvB/I,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK4E,aAAcI,GAAUA,IAAWD,GAG1ClF,SACL,OAAOG,KAAK6E,YAAc,GAAK7E,KAAK4E,aAAa/I,OAAS,EAGrDgE,OACDG,KAAK6E,aAAe,IACtB7E,KAAK6E,aAAe,UAKbI,EAAbpF,cACUG,KAAAkF,QAAmC,IAAIC,IAE/CC,oBACE,IAAIC,KAQJ,OANArF,KAAKkF,QAAQzE,QAAQ,CAACuE,EAAQM,KACxBN,EAAOO,UACTF,EAAMtJ,KAAKuJ,KAIRD,EAGFxF,UAAUyF,EAAkBR,GACjC9E,KAAKwF,aAAaF,GAAMG,cAAcX,GAGjCjF,aAAayF,GAClBtF,KAAKwF,aAAaF,GAAMI,mBAGnB7F,eAAeyF,EAAkBP,GACtC/E,KAAKwF,aAAaF,GAAMK,eAAeZ,GAGlClF,kBAAkByF,EAAkBP,GACzC/E,KAAKwF,aAAaF,GAAMM,kBAAkBb,GAGrClF,OACLG,KAAKkF,QAAQzE,QAAQuE,GAAUA,EAAOa,QAG9BhG,aAAayF,GACrB,IAAIN,EAAShF,KAAKkF,QAAQnH,IAAIuH,GAC9B,YAAenB,IAAXa,EACKA,GAGTA,EAAS,IAAIL,EACb3E,KAAKkF,QAAQY,IAAIR,EAAMN,GAChBA,KC/EX,SAAYP,GACVA,IAAA,eACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,+BACAA,IAAA,2BACAA,IAAA,eACAA,IAAA,qBAPF,CAAYA,iBAUUsB,EAIpBlG,YAAmBpB,EAAoBuH,GAApBhG,KAAAvB,MAAoBuB,KAAAgG,OAEhCnG,QAAQiE,EAAYI,GACpBlE,KAAKiG,QACRjG,KAAKiG,MAAQ,IAAIrC,GAGnB5D,KAAKiG,MAAMzB,IAAIV,EAAMI,GAGhBrE,UACL,OAAOG,KAAKgG,OAASvB,EAAUyB,MAG1BrG,iBACL,OAAO,EAGFA,gBAAgBsG,GACrB,OAAIA,GAASnG,KAAKsC,SACTtC,KAAKgG,OAASvB,EAAU2B,MAAQpG,KAAKsC,SAAS+D,KAAOF,EAAME,GAG7DrG,KAAKgG,OAASvB,EAAU2B,OAASpG,KAAKsC,SAKxCzC,QACL,IAAIc,EAAOX,KAAKsG,WAMhB,OAJItG,KAAKsC,WACP3B,EAAK2B,SAAWtC,KAAKsC,UAEvB3B,EAAKsF,MAAQjG,KAAKiG,OAASjG,KAAKiG,MAAMM,QAC/B5F,SAMEuF,UAAcH,EAClBlG,iBACL,OAAO,EAGFA,MAAM2G,GACXA,EAAYC,QAAQzG,MAGZH,WACR,OAAO,IAAIqG,EAAMlG,KAAKvB,IAAKuB,KAAKgG,aAMvBU,UAAaR,EACxBrG,cACE4B,MAAM,IAAKgD,EAAUyB,cAIZS,UAAaZ,EACxBlG,cACE4B,MAAM,IAAKgD,EAAUkC,MAGhB9G,iBACL,OAAO,EAGFA,MAAM2G,GACXA,EAAYI,OAAO5G,MAGXH,WACR,OAAO,IAAI8G,SAIFP,UAAaL,EACxBlG,cACE4B,MAAM,IAAKgD,EAAU2B,MAGhBvG,iBACL,OAAO,EAGFA,MAAM2G,GACXA,EAAYK,OAAO7G,MAGXH,WACR,OAAO,IAAIuG,SAIOU,UAAiBf,EAGrClG,YACEpB,EACA6G,EACOyB,EACAC,GAEPvF,MAAMhD,EAAK6G,GAHJtF,KAAA+G,aACA/G,KAAAgH,gBAKFnH,iBACL,OAAO,SAIEoH,UAAqBH,EAChCjH,YAAYkH,EAAsBC,GAChCvF,MAAM,IAAKgD,EAAUwC,aAAcF,EAAYC,GAG1CnH,MAAM2G,GACXA,EAAYU,eAAelH,MAGnBH,WACR,OAAO,IAAIoH,EAAajH,KAAK+G,WAAY/G,KAAKgH,sBAIrCG,UAAmBL,EAC9BjH,YAAYkH,EAAsBC,GAChCvF,MAAM,IAAKgD,EAAU0C,WAAYJ,EAAYC,GAGxCnH,MAAM2G,GACXA,EAAYY,aAAapH,MAGjBH,WACR,OAAO,IAAIsH,EAAWnH,KAAK+G,WAAY/G,KAAKgH,iBAIhD,SAAYtC,GACVA,IAAA,iCACAA,IAAA,iBAFF,CAAYA,iBAKU2C,UAAatB,EACjClG,YAAmByH,GAAoB,EAAuBhC,GAC5D7D,MAAM,IAAKgD,EAAU4C,MADJrH,KAAAsH,WAA2CtH,KAAAsF,OAIvDzF,MAAM2G,GACXA,EAAYe,OAAOvH,MAGdH,SAAS8C,EAAYD,EAAoByD,GAC9CnG,KAAKwH,OAAO7E,EAAMD,EAAUyD,UAYVsB,UAAoB1B,EACxClG,YAAmB6H,GAAqB,EAAa/G,GACnDc,MAAM,IAAKgD,EAAUkD,SADJ3H,KAAA0H,YAAkC1H,KAAAW,OAI9Cd,MAAM2G,GACXA,EAAYoB,UAAU5H,MAGjBH,SAAS8C,EAAYD,EAAoByD,GAC9C,GAAInG,KAAK0H,UAAW,CAClB,MAAM5H,EAAEA,EAACC,EAAEA,GAAM2C,EAASmF,YAAY1B,GAChCxF,EAAOX,KAAKuG,QAClB5F,EAAK2B,SAAW6D,EAChBzD,EAASoF,QAAQhI,EAAGC,EAAGY,GAGzBX,KAAK4H,UAAUjF,EAAMD,EAAUyD,GAG1BtG,WACL,OAAOG,KAAKW,KAAK4F,eAURwB,UAA0BN,EACrC5H,YAAoBmI,EAAiBN,GAAqB,EAAM/G,GAC9Dc,MAAMiG,EAAW/G,GADCX,KAAAgI,UAIVnI,UAAU8C,GAClBA,EAAKsF,OAAOC,KAAKlI,KAAKgI,gBAKJG,EACbtI,OAAOuI,GACZpI,KAAKqI,QAAQD,GAGRvI,QAAQyI,GACbtI,KAAKqI,QAAQC,GAGRzI,eAAe0I,GACpBvI,KAAKwI,WAAWD,GAGX1I,aAAa0I,GAClBvI,KAAKwI,WAAWD,GAGX1I,OAAO4I,GACZzI,KAAKqI,QAAQI,GAGR5I,UAAU6I,GACf1I,KAAKqI,QAAQK,GAGR7I,OAAO8I,GACZ3I,KAAKqI,QAAQM,GAGL9I,WAAW0I,GACnBvI,KAAKqI,QAAQE,GAGL1I,QAAQc,KC1Ob,MAAMiI,EAAW,SACtBC,EACAC,EACAC,EACArG,GAMA,UCpCA7C,YACUmJ,EACAC,EACAH,EACAtJ,EACAC,EACAyJ,EACAC,GANAnJ,KAAAgJ,SACAhJ,KAAAiJ,SACAjJ,KAAA8I,SACA9I,KAAAR,QACAQ,KAAAP,SACAO,KAAAkJ,eACAlJ,KAAAmJ,cAERnJ,KAAKoJ,aAAepJ,KAAK8I,OAAS9I,KAAK8I,OAGlCjJ,OACLG,KAAKmJ,YAAYnJ,KAAKgJ,OAAQhJ,KAAKiJ,OAAQ,GAEtCjJ,KAAKkJ,aAAaG,QAAQrJ,KAAKgJ,OAAQhJ,KAAKiJ,WAC5C,EAAG,IAAK,GAAI,KAAM,EAAG,KAAM,GAAI,IAAIxI,QAAQ,EAAE6I,EAAIC,MAClDvJ,KAAKwJ,UAAU,EAAG,EAAK,EAAK,EAAGF,EAAIC,EAAI,GACvCvJ,KAAKwJ,UAAU,EAAG,EAAK,EAAKF,EAAI,EAAG,EAAGC,KAKpC1J,UACN4J,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEA,GAAIL,EAAQC,EACV,OAGF,IAAIK,EAAW,EACXC,GAAU,EAEd,IAAK,IAAIC,EAAWT,EAAKS,GAAYlK,KAAK8I,SAAWmB,EAASC,IAAY,CACxE,IAAIC,GAAUD,EAEd,IAAK,IAAIE,GAAkBF,EAAUE,GAAU,EAAGA,IAAU,CAC1D,IAAIC,EAAWnK,KAAKoB,MAAMtB,KAAKgJ,OAASoB,EAASR,EAAKO,EAASN,GAC3DS,EAAWpK,KAAKoB,MAAMtB,KAAKiJ,OAASmB,EAASN,EAAKK,EAASJ,GAC3DQ,GAAaH,EAAS,KAAQD,EAAS,IACvCK,GAAcJ,EAAS,KAAQD,EAAS,IAE5C,GAEIE,GAAY,GACZC,GAAY,GACZD,EAAWrK,KAAKR,OAChB8K,EAAWtK,KAAKP,UAElBiK,EAAQc,GAPV,CAUO,GAAIb,EAAMY,EACf,MAIEvK,KAAKyK,eAAeL,EAAQD,IAAWnK,KAAKoJ,cAC9CpJ,KAAKmJ,YACHkB,EACAC,EACA,EAAItK,KAAKyK,eAAeL,EAAQD,GAAUnK,KAAKoJ,cAI/Ca,EAEEjK,KAAKkJ,aAAaG,QAAQgB,EAAUC,GAEtCN,EAAWQ,GAEXP,GAAU,EACVP,EAAQM,GAIRhK,KAAKkJ,aAAaG,QAAQgB,EAAUC,IACpCJ,EAAWlK,KAAK8I,SAGhBmB,GAAU,EACVjK,KAAKwJ,UAAUU,EAAW,EAAGR,EAAOa,EAAWX,EAAIC,EAAIC,EAAIC,GAC3DC,EAAWQ,MAOb3K,eAAeC,EAAWC,GAChC,OAAOD,EAAIA,EAAIC,EAAIA,ID3DnB8I,EAAI/I,EACJ+I,EAAI9I,EACJ+I,EACApG,EAASlD,MACTkD,EAASjD,OACT,kBA3CgC0I,EAKlCtI,YAAoB6K,EAAyB7B,GAC3CpH,QADkBzB,KAAA0K,QAAyB1K,KAAA6I,MAJtC7I,KAAA2K,SAAmB,EAQnB9K,QAAQC,EAAWC,GAIxB,OAHAC,KAAKF,EAAIA,EACTE,KAAKD,EAAIA,EACTC,KAAK0K,MAAME,GAAG9K,EAAGC,GAAG8K,MAAM7K,OAClBA,KAAK2K,QAGR9K,OAAO4I,GACZzI,KAAK2K,QAAU3K,KAAK6I,IAAI/I,IAAME,KAAKF,GAAKE,KAAK6I,IAAI9I,IAAMC,KAAKD,EAGpDF,QAAQc,GACZX,KAAKF,GAAKE,KAAKD,IACjBC,KAAK2K,QAAU3K,KAAK0K,MAAMI,eAAe9K,KAAKF,EAAGE,KAAKD,MAqB9B2C,EAAUmG,GAV1B,CAAC/I,EAAWC,EAAWgL,KACjChC,EAAO6B,GAAG9K,EAAGC,GAAGiL,IAAItI,EAASkI,GAAG9K,EAAGC,GAAIgL,KAWvCE,cEjDSC,EAGXrL,YAAsBuB,EAAoB+B,EAAkB/B,GAAtCpB,KAAAoB,MAAoBpB,KAAAmD,UAFnCnD,KAAAmL,aAIPC,cACE,OAAOpL,KAAKoB,IAGdiK,YACE,OAAOrL,KAAKoB,MAAQpB,KAAKmD,QAGpBtD,SAASyL,GACdtL,KAAKmD,SAAWmI,EAGXzL,SAASyL,GACdtL,KAAKmD,QAAUjD,KAAKqL,IAAIvL,KAAKmD,QAAUmI,EAAUtL,KAAKoB,KAGjDvB,iBAAiByL,GACtBtL,KAAKoB,KAAOkK,EACZtL,KAAKwL,SAASF,GAGTzL,iBAAiByL,GACtBtL,KAAKoB,KAAOkK,EACZtL,KAAKyL,SAASH,GAGTzL,YAAYyL,GACjBtL,KAAKmL,UAAUpP,KAAKuP,GAGfzL,eAAeyL,GACpBtP,OAAAoI,EAAA,OAAApI,CAAOgE,KAAKmL,UAAWO,GAAOA,IAAQJ,GAGxCK,mBACE,OAAO3L,KAAKmD,QAAUnH,OAAAoI,EAAA,IAAApI,CAAIgE,KAAKmL,kBAoBtBS,EACX/L,YAAmBgM,EAAkBC,EAAmBC,GAArC/L,KAAA6L,SAAkB7L,KAAA8L,UAAmB9L,KAAA+L,YAEjDlM,KAAKmM,EAA4BxL,GACtCA,EAAGR,KAAK6L,OAAQG,EAAQH,QACxBrL,EAAGR,KAAK8L,QAASE,EAAQF,gBAIhBG,UAAiBL,EAC5B/L,aAAYgM,OAAEA,EAAS,EAACC,QAAEA,EAAU,EAACC,UAAEA,EAAY,IACjDtK,MAAMoK,EAAQC,EAASC,GAGlBlM,WACLmM,EACAE,EACA1L,GAEAA,EAAGR,KAAK6L,OAAQG,EAAQH,OAAQK,EAAOL,QACvCrL,EAAGR,KAAK8L,QAASE,EAAQF,QAASI,EAAOJ,gBC/EhCK,EACXtM,YACSuM,EACAC,EAAe,EACfC,EAAgB,GAFhBtM,KAAAoM,OACApM,KAAAqM,OACArM,KAAAsM,QAGTnJ,cACE,OAAOnD,KAAKoM,KAAOpM,KAAKqM,KAAOrM,KAAKsM,MAG/BzM,IAAI6L,GACT1L,KAAKoM,MAAQV,EAGR7L,SAAS6L,GACd1L,KAAKoM,MAAQV,SAIJa,EAKX1M,YAAoB2M,EAA0BC,GAA1BzM,KAAAwM,WAA0BxM,KAAAyM,eAJtCzM,KAAA0M,cAAwB,EACxB1M,KAAA2M,kBAA4B,EAC5B3M,KAAAoM,KAAe,GAIhBvM,YAAY2M,EAAkBC,GACnCzM,KAAKwM,SAAWA,EAChBxM,KAAKyM,aAAeA,EAGtB9I,eACE,OACE3D,KAAKoM,KACLpM,KAAKwM,SAAWxM,KAAK0M,cACrB1M,KAAKyM,aAAezM,KAAK2M,kBAI7BjJ,kBACE,OAAuB,IAAhB1D,KAAK2D,SAGdH,sBACE,OAA0B,EAAnBxD,KAAK0D,YAGdL,qBACE,OAA8B,EAAvBrD,KAAKwD,uBAIHoJ,UAAmB1B,EAI9BrL,YACEgN,EACQC,EAAc,EACtBnB,EAAekB,EAAOE,gBAEtBtL,MAAMoL,EAAOE,eAAgBpB,GAHrB3L,KAAA8M,cAKR9M,KAAKgN,iBAAmBH,EAAOG,iBAC/BhN,KAAKiN,kBAAoBJ,EAAOI,kBAG3BpN,OACLG,KAAK8M,aAAe,EAEhB9M,KAAK8M,aAAe9M,KAAKgN,mBAC3BhN,KAAK8M,YAAc,EACnB9M,KAAKwL,SAASxL,KAAKiN,2BAKZC,UAAqBf,EAChCgB,sBACE,OAAInN,KAAKmD,QAAU,GACT,EACCnD,KAAKmD,QAAU,GACjBjD,KAAKoI,OAAOtI,KAAKmD,QAAU,IAAM,GAEjC,GC1Eb,IAAYiK,EAMAC,GANZ,SAAYD,GACVA,IAAA,mBACAA,IAAA,qCACAA,IAAA,2BAHF,CAAYA,WAMZ,SAAYC,GACVA,IAAA,mCACAA,IAAA,yBACAA,IAAA,iBACAA,IAAA,uBAJF,CAAYA,WAOL,MAAMC,GACXD,EAAQE,eACRF,EAAQG,UACRH,EAAQI,MACRJ,EAAQK,UAKV,IAAYnL,GAAZ,SAAYA,GACVA,IAAA,aACAA,IAAA,eACAA,IAAA,iBACAA,IAAA,6BACAA,IAAA,qBACAA,IAAA,mBANF,CAAYA,iBASUoL,EAYpB9N,YAAmBgN,EAAuBxG,EAAiBsH,EAASC,SAAjD5N,KAAA6M,SAAuB7M,KAAAqG,KANhCrG,KAAA6N,cAAyC,IAAI1I,IAEhDnF,KAAA8N,MAAgB,EAKrB9N,KAAK+N,OAAS,IAAInB,EAAWC,GAXxBhN,eACL,OAAOG,KAAKgO,SAadtQ,WACE,OAAOsC,KAAK6M,OAAOnP,KAGrBuQ,WACE,OAAOjO,KAAK6M,OAAOoB,KAGrBC,kBACE,OAAOlO,KAAK6M,OAAOqB,YAGrBC,cACE,OAAOnO,KAAK6M,OAAOsB,QAGdtO,IAAIuO,GACT,OAAOpS,OAAAoI,EAAA,SAAApI,CAASgE,KAAK6M,OAAOwB,UAAWD,GAGlCvO,GAAGyO,GACR,OAAOA,EAAMlM,eAAepC,MAG9BuO,YACE,OAAOvO,KAAK6M,OAAO2B,UAGd3O,YAAY6C,GACjB,MAAMqG,EAAS/I,KAAK6N,cAAc9P,IAAI2E,EAAS2D,IAE/C,OAAI0C,GAIG/I,KAAKyO,WAAW/L,GAGlB7C,WAAW6C,GAChB,IAAIqG,EAAS/I,KAAK6N,cAAc9P,IAAI2E,EAAS2D,IAY7C,OAVI0C,EACFA,EAAO2F,gBAEP3F,EAAS,IAAI4F,GAAOjM,EAASlD,MAAOkD,EAASjD,QAE7CO,KAAK6N,cAAc/H,IAAIpD,EAAS2D,GAAI0C,IAGtCH,EAASlG,EAASmF,YAAY7H,MAAOA,KAAK4O,aAAc7F,EAAQrG,GAEzDqG,EAOT8F,mBAKE,OAJK7O,KAAK8O,gBACR9O,KAAK8O,cAAgB,IAAI7J,GAGpBjF,KAAK8O,cAGPjP,UAAUyF,GACf,OAAOtJ,OAAAoI,EAAA,SAAApI,CAASgE,KAAKkF,QAASI,GAGzBzF,UAAUyF,EAAkBP,GACjC/E,KAAK6O,aAAaE,eAAezJ,EAAMP,GAGlClF,aAAayF,EAAkBP,GACpC/E,KAAK6O,aAAaG,kBAAkB1J,EAAMP,GAG5C6J,mBACE,OAAI5O,KAAKiP,UAAUnM,EAAWoM,OACrB,EAGFlP,KAAK6M,OAAO+B,aAGrBO,kBACE,OAAOnP,KAAK6M,OAAOsC,YAGrBjK,cACE,OAAOlF,KAAK6O,aAAazJ,cAGpBvF,cAAcuP,GACnB,OAAOpT,OAAAoI,EAAA,SAAApI,CAASgE,KAAKqP,YAAaD,GAGpCC,kBACE,OAAOrP,KAAK6M,OAAOwC,YASdxP,YACLG,KAAK+N,OAAOlI,OAER7F,KAAK8O,eAEP9O,KAAK8O,cAAcjJ,QAhIR8H,EAAAK,OAAqB,QCxChCsB,UAA4BnH,EAChCtI,YACUyC,EACAI,EACAC,GAERlB,QAJQzB,KAAAsC,WACAtC,KAAA0C,WACA1C,KAAA2C,OAKH9C,OAAO8I,GACZA,EAAK4G,SAASvP,KAAK2C,KAAM3C,KAAK0C,SAAU1C,KAAKsC,UAGxCzC,UAAU6I,GACfA,EAAQ6G,SAASvP,KAAK2C,KAAM3C,KAAK0C,SAAU1C,KAAKsC,iBAIvCkN,UAAkBtN,EAC7BrC,YACU8C,EACAD,EACA+M,EACAC,GAERjO,QALQzB,KAAA2C,OACA3C,KAAA0C,WACA1C,KAAAyP,YACAzP,KAAA0P,YAKH7P,eAAesG,GACpB,MAAM0C,EAAM7I,KAAK0C,SAASmF,YAAY1B,GActC,OAZInG,KAAK0P,WAAa1P,KAAK0P,UAAUrJ,KAAOrG,KAAK0C,SAAS2D,IACxDrG,KAAK0C,SAASiN,eAAexJ,GAC7BnG,KAAK0P,UAAUE,YAAY5P,KAAKyP,UAAWtJ,KAE3CnG,KAAK0C,SAASkI,GAAG/B,EAAI/I,EAAG+I,EAAI9I,GAAGuC,cAAW6B,EAC1CnE,KAAK0C,SAASkI,GAAG5K,KAAKyP,UAAU3P,EAAGE,KAAKyP,UAAU1P,GAAGuC,SAAW6D,IAGhEnG,KAAK0P,WAAa1P,KAAK0C,UACtBkI,GAAG5K,KAAKyP,UAAU3P,EAAGE,KAAKyP,UAAU1P,GACpC8K,MAAM,IAAIyE,EAAoBnJ,EAAOnG,KAAK0C,SAAU1C,KAAK2C,OAErDJ,EAASC,QAGX3C,aAAa+C,GAYlB,OAXI5C,KAAK0P,WAAa1P,KAAK0C,SAAS2D,KAAOrG,KAAK0P,UAAUrJ,IACxDrG,KAAK0C,SAASmN,QACd7P,KAAK0P,UAAUI,QAEf9P,KAAKoC,eAAeQ,GAEpB5C,KAAK2C,KAAKoE,WAAa/G,KAAK0P,WAE5B1P,KAAKoC,eAAeQ,GAGfL,EAASC,eCxDEuN,EAOVlQ,OACRsG,EACA6J,EACAtN,EACAC,GAEA,OAAO3C,KAAKiQ,KAAK9J,EAAOzD,EAAUC,EAAM1C,GAAS+P,EAAYE,GAAGjQ,IAGxDJ,KACRsG,EACAzD,EACAC,EACAwN,GAEA,MAAOlQ,GAASD,KAAKoQ,UAAUjK,EAAOzD,EAAUyN,GAEhD,GAAIlQ,EACF,OAAO,IAAIuP,EAAU7M,EAAMD,EAAUzC,GAI/BJ,UACRsG,EACAzD,EACAyN,GAEA,OAAOE,GACLlK,EAAMmK,YAAY5N,GAClBA,EAASmF,YAAY1B,GACrBxF,GAAQA,EAAK4P,SAASpK,GACtBgK,GAIMtQ,WACRQ,EACAwI,EACAgC,GAEA,IAAI2F,EAA2BjR,EAC7Bc,EAAIb,MACJa,EAAIZ,OACJ,KAAM,GAEJgR,GAA0B5H,GAE9B,KAAO4H,EAAc5U,QAAQ,CAC3B,IAAI6U,KAEJD,EAAchQ,QAASR,IACrB,IAAKI,EAAIsQ,QAAQ1Q,GACf,OAGF,MAAMU,EAAON,EAAIuK,GAAG3K,EAAMH,EAAGG,EAAMF,GAC9BY,EAAKgK,UAAW6F,EAAYvQ,EAAMH,GAAGG,EAAMF,KAIhDyQ,EAAYvQ,EAAMH,GAAGG,EAAMF,IAAK,EAEhC8K,EAAM5K,EAAOU,GAEbV,EAAM2Q,WAAWnQ,QAAQoQ,GAAQH,EAAW3U,KAAK8U,OAGnDJ,EAAgBC,GAIb7Q,QAAQsG,EAAiB2K,GAC9B,OAAI3K,EAAME,KAAOyK,EAAMzK,KAInBF,EAAM8H,OAASb,EAAK2D,YAAcD,EAAM7C,OAASb,EAAK2D,aAItD5K,EAAM8H,OAASb,EAAK4D,QAAUF,EAAM7C,OAASb,EAAK6D,iBAIlDH,EAAM7C,OAASb,EAAK4D,QAAU7K,EAAM8H,OAASb,EAAK6D,yBAQpCC,UAAuBnB,EAA7ClQ,kCACSG,KAAAgQ,iBAAsB7L,EAEtBtE,IACLsG,EACAzD,EACAC,GAEA,IAAK3C,KAAKmR,eAAehL,EAAOzD,KAAc1C,KAAKgQ,YACjD,OAAOhQ,KAAKoR,iBAAiBjL,EAAOzD,EAAUC,GAGhD,MAAM2L,EAAQtO,KAAKqR,KAAKlL,EAAOzD,EAAUC,EAAM3C,KAAKgQ,aACpD,GAAI1B,EACF,OAAOA,EAGTtO,KAAKgQ,iBAAc7L,EACnBnE,KAAKsR,WAAWnL,GAKRtG,KACRsG,EACAzD,EACAC,EACA1C,GAEA,OAAOD,KAAKuR,OAAOpL,EAAOlG,EAAOyC,EAAUC,GAGnC9C,iBACRsG,EACAzD,EACAC,GAEA,GAAI3C,KAAKgQ,aAAetN,EAASmF,YAAY1B,GAAO+J,GAAGlQ,KAAKgQ,aAE1D,OADAhQ,KAAKgQ,iBAAc7L,EACZnE,KAAKwR,QAAQrL,EAAOzD,EAAUC,GAQ/B9C,OAAOsG,IACPtG,QACRsG,EACAzD,EACAC,IAIQ9C,WAAWsG,WAGDsL,UAAmBP,EACvCrR,YAAsB6R,GACpBjQ,QADoBzB,KAAA0R,UAIZ7R,iBACRsG,EACAzD,EACAC,GAEA,IAAI2L,EAAQ7M,MAAM2P,iBAAiBjL,EAAOzD,EAAUC,GAEpD,GAAI2L,EACF,OAAOA,EAGT,MAAMzF,EAAMnG,EAASmF,YAAY1B,GACjC,OAAInG,KAAK0R,QAAQvL,EAAMmK,YAAY5N,GAAUkI,GAAG/B,EAAI/I,EAAG+I,EAAI9I,KACzDC,KAAKgQ,iBAAc7L,EACZnE,KAAKwR,QAAQrL,EAAOzD,EAAUC,SAFvC,EAMQ9C,eAAesG,EAAiBzD,GACxC,MAAMiP,EAAOtB,GACXlK,EAAMmK,YAAY5N,GAClBA,EAASmF,YAAY1B,GACrBxF,GAAQA,EAAK4P,SAASpK,GACtB,CAAClG,EAAOU,IAASX,KAAK0R,QAAQ/Q,IAC9B,GAGF,QAAIgR,EAAK9V,SACPmE,KAAKgQ,YAAc2B,EAAKC,OACjB,UCjMAC,UAAiB9B,EAGrBlQ,IACLsG,EACAzD,EACAC,EACAmP,GAAqB,GAErB,GAAK9R,KAAK+R,UAAU5L,EAAOzD,GAA3B,CAIA,GAAI1C,KAAKgS,QAAUhS,KAAKiS,eAAe9L,EAAOzD,EAAU1C,KAAKgS,QAC3D,OAAO,IAAIE,GAAYlS,KAAKgS,OAAQtP,EAAUC,GAE9C,IAAKmP,EACH,KAAM,4BAIR,OADA9R,KAAKmS,cAAchM,EAAOzD,GACnB1C,KAAKoS,IAAIjM,EAAOzD,EAAUC,GAAM,IAInC9C,UAAUsG,EAAiBzD,GAIjC,QAHiB1C,KAAKqS,aAAalM,EAAOzD,EAAUJ,GAClDtC,KAAKsS,QAAQnM,EAAO7D,IAKhBzC,eACNsG,EACAzD,EACAsP,GAEA,QAAe7N,IAAX6N,EACF,OAAO,EAQT,QALiBhS,KAAKqS,aACpBlM,EACAzD,EACCJ,GAAuBA,EAAS+D,KAAO2L,EAAO3L,IAK3CxG,cAAcsG,EAAiBzD,GACrC1C,KAAKgS,OAAShS,KAAKqS,aAAalM,EAAOzD,EAAUJ,GAC/CtC,KAAKsS,QAAQnM,EAAO7D,IAIhBzC,aACNsG,EACAzD,EACA6P,GAEA,MAAMxJ,EAAS5C,EAAMmK,YAAY5N,GAEjC,OAAOA,EACJmF,YAAY1B,GACZyK,WACAvQ,IAAI,EAAGP,IAAGC,OAAQgJ,EAAO6B,GAAG9K,EAAGC,GAAGuC,UAClCyB,KACEzB,KACCA,GAAWiQ,EAAUjQ,WCnElBkQ,UAAetB,EAGhBrR,eAAesG,EAAiBzD,GAExC,OACG1C,KAAKyS,aAAezS,KAAK0S,gBAAgBvM,EAAOzD,IACjD1C,KAAK2S,eAAexM,EAAOzD,GAIrB7C,aACRG,KAAK4S,cAAWzO,EAGRtE,UACRG,KAAK4S,cAAWzO,EAIVtE,YACN,QAASG,KAAK4S,SAGN/S,KACRsG,EACAzD,EACAC,GAEA,IAAK3C,KAAKgQ,YACR,KAAM,8BAER,OAAOhQ,KAAK6S,SAAS1M,EAAOnG,KAAKgQ,YAAatN,EAAUC,GAGlD9C,gBAAgBsG,EAAiBzD,GACvC,OAAO1C,KAAKqS,aACVlM,EACAzD,EACAJ,GAAYA,EAAS+D,KAAOrG,KAAK4S,UAI7B/S,eAAesG,EAAiBzD,GAEtC,OACE1C,KAAKqS,aAAalM,EAAOzD,EAAUJ,GACjCtC,KAAKsS,QAAQnM,EAAO7D,KACjBtC,KAAK0S,gBAAgBvM,EAAOzD,GAI7B7C,aACNsG,EACAzD,EACA6P,GAEA,IAAI7V,GAAkB,EAgBtB,OAdAsD,KAAK8S,WACH3M,EAAMmK,YAAY5N,GAClBA,EAASmF,YAAY1B,GACrB,EAAGrG,IAAGC,KAAKY,KACT,MAAM2B,EAAW3B,EAAK2B,UAEjB5F,GAAU4F,GAAYiQ,EAAUjQ,KACnCtC,KAAKgQ,YAAc,IAAIpQ,EAAME,EAAGC,GAChCC,KAAK4S,SAAWtQ,EAAS+D,GACzB3J,GAAS,KAKRA,EAGCmD,SACRsG,EACA6J,EACAtN,EACAC,GAEA,OAAO3C,KAAKiQ,KAAK9J,EAAOzD,EAAUC,EAAM1C,GAAS+P,EAAY+C,OAAO9S,WCpFlD+S,EAIpBnT,YAAsB8C,GAAA3C,KAAA2C,OACpB3C,KAAK4C,OAASD,EAAKC,OACnB5C,KAAKiI,OAAStF,EAAKsF,cAOVgL,WAA0BD,EACrCnT,YAAmBoG,EAAyBtD,GAC1ClB,MAAMkB,GADW3C,KAAAiG,QAIZpG,OAEAA,YACL,OAAO,SAIWqT,WAAenD,EACnClQ,YAAmBsT,GACjB1R,QADiBzB,KAAAmT,UAGTnT,KAAAoT,UAEHvT,UAAUyO,GACftO,KAAKoT,OAAOrX,KAAKuS,GAGTzO,cACRG,KAAKoT,UAGAvT,YACLG,KAAKoT,OAAO3S,QAAQ6N,IAClBA,EAAM+E,QAGRrT,KAAKsT,eC3CT,MAAMC,GAAgB,QAETC,WAAgBtC,EAA7BrR,kCACUG,KAAAyT,eAEE5T,eAAesG,EAAiBzD,GACxC,OACE1C,KAAK0T,aAAavN,EAAOzD,IACzB1C,KAAK2T,gBAAgBxN,EAAOzD,GAIxB7C,gBACNsG,EACAzD,EACAkR,EAAsBzN,EAAMyI,aAAe,GAE3C,GAAIgF,GAAe,EAEjB,OADA5T,KAAKgQ,iBAAc7L,GACZ,EAGT,MAAMwN,EAAO3R,KAAKoQ,UAAUjK,EAAOzD,EAAU,EAAG5C,IAAGC,QAQjD,OAPc/D,OAAAoI,EAAA,MAAApI,CAAMgE,KAAKyT,YAAa,EAAE5K,EAAKiI,KAIpC5Q,KAAKkB,IAAIlB,KAAKC,IAAIL,EAAI+I,EAAI/I,GAAII,KAAKC,IAAIJ,EAAI8I,EAAI9I,MAGxC6T,IAGlB,OAAIjC,EAAK9V,QACPmE,KAAKgQ,YAAc2B,EAAKC,OACjB,GAEA5R,KAAK2T,gBAAgBxN,EAAOzD,EAAUkR,EAAcL,IAIvD1T,aAAasG,EAAiBzD,GAepC,OAdA1C,KAAKyT,eAELzT,KAAK8S,WACH3M,EAAMmK,YAAY5N,GAClBA,EAASmF,YAAY1B,GACrB,CAAClG,EAAOU,KACN,MAAM2B,EAAW3B,EAAK2B,SAElBA,GAAYtC,KAAKsS,QAAQnM,EAAO7D,IAClCtC,KAAKyT,YAAY1X,MAAMkE,EAAOqC,MAK7BtC,KAAKyT,YAAY5X,OAAS,SC5DxBgY,WAAiBpC,EAC5B5R,cACE4B,MAAMd,IAASA,EAAKmT,aCIXC,WAAetC,EAC1B5R,cACE4B,MAAOd,KAAuBA,EAAKsF,OAG9BpG,IACLsG,EACAzD,EACAC,GAEA,GAAIwD,EAAM6N,IAAI3G,EAAQG,WACpB,OAAO/L,MAAM2Q,IAAIjM,EAAOzD,EAAUC,GAI5B9C,QACRsG,EACAzD,EACAC,GAEA,MAAMhC,EAAO+B,EAASuR,aAAa9N,GAEnC,IAAKxF,EAAKsF,MACR,KAAM,kCAKR,OAFAE,EAAM+N,GAAGC,UAAU,IAAIlB,GAAkBtS,EAAKsF,MAAOtD,IAE9C,IAAIyR,GAAiBzT,EAAMA,EAAKsF,MAAMpC,MAAOlB,uBC9B3C0R,WAAetE,EACnBlQ,IACLsG,EACAzD,EACAC,GAEA,MAAMkG,EAAMnG,EAASmF,YAAY1B,GAEjC,OAAOnG,KAAKiQ,KAAK9J,EAAOzD,EAAUC,EAAO1C,IAAkB4I,EAAIqH,GAAGjQ,KCCtE,MAAMqU,GAA0B,SAE1BC,WAA0BpM,EAG9BtI,YAAoBc,GAClBc,QADkBzB,KAAAW,OAFbX,KAAAwU,QAAkB,EAMlB3U,UAGL,OAFAG,KAAKwU,QAAS,EACdxU,KAAKW,KAAKkK,MAAM7K,MACTA,KAAKwU,OAGP3U,SACLG,KAAKwU,QAAS,SAILC,WAAe1E,EAU1BlQ,cACE4B,QAJMzB,KAAA0U,KAAeJ,GACftU,KAAA2U,iBAA2B,EAIjC3U,KAAKrE,EAAI,IAETqE,KAAK4U,MAAQ,IAAIC,GAAA,MAEjB7U,KAAK8U,iBAEL9U,KAAK+U,cAAgB,IACrB/U,KAAKgV,gBAAgBhV,KAAK+U,eAC1B/U,KAAK2R,QAGA9R,IACLsG,EACAzD,EACAC,EACAmP,GAAqB,GAErB,KAAI9R,KAAK4U,MAAMK,QAAQpZ,QAAU,GAAjC,CAIA,GAAImE,KAAK2U,gBAAiB,CACxB,MAAM9L,EAAMnG,EAASmF,YAAY1B,GACjCnG,KAAKkV,QAAQrM,GACb7I,KAAK2U,iBAAkB,EAKzB,OAFA3U,KAAK0U,MAAQ,EAET1U,KAAK2R,KAAK9V,OACLmE,KAAKmV,aAAahP,EAAOzD,EAAUC,EAAMmP,IAE5C9R,KAAKoV,eACPpV,KAAKgV,gBAAgBhV,KAAKoV,cAC1BpV,KAAK+U,cAAgB/U,KAAKoV,cAG5BpV,KAAKqV,gBAAgBlP,EAAOzD,GACrB1C,KAAKmV,aAAahP,EAAOzD,EAAUC,EAAMmP,KAI7CjS,QACLG,KAAK2R,QAGA9R,cAAcgJ,EAAYlI,IAC3BX,KAAK0U,MAAQJ,IAAmB,IAAIC,GAAkB5T,GAAMuU,YAC9DlV,KAAKkV,QAAQrM,GAEf7I,KAAK0U,MAAQ,EAIR7U,QAAQI,GACbD,KAAK4U,MAAMU,QAAQtV,KAAKrE,EAAGsE,GACvBD,KAAK+U,eAAiB/U,KAAK+U,gBAAkB/U,KAAKrE,GACpDqE,KAAK4U,MAAMW,QAAQvV,KAAK+U,cAAe/U,KAAKrE,GAE9CqE,KAAK+U,cAAgB/U,KAAKrE,EAC1BqE,KAAKrE,EAAIwD,EAAKa,KAAKrE,GACnBqE,KAAK0U,KAAO,EAGN7U,aAAasG,EAAiBzD,GAEpC,IAAK1C,KAAKoV,aACR,KAAM,8BAER,MAAMvM,EAAa7I,KAAK4U,MAAMY,KAAKxV,KAAKoV,cAExCpV,KAAK2R,KAAO3R,KAAKoQ,UAAUjK,EAAOzD,EAAUzC,GAAS4I,EAAIqH,GAAGjQ,IAGtDJ,gBAAgBsG,EAAiBzD,GACvC,IAAI+S,EAAqBzV,KAAK4U,MAAMK,QAAQ,GAC1CS,EAAuB1V,KAAK8U,cAAcW,GAC1CR,EAAQjV,KAAK4U,MAAMe,UAAU3V,KAAK+U,eAEhCE,GACFA,EAAMxU,QAASmV,IACTF,GAAgB1V,KAAK8U,cAAcc,IAAW,KAChDH,EAAaG,EACbF,EAAe1V,KAAK8U,cAAcW,MAKxCzV,KAAKoV,aAAeK,EACpBzV,KAAK6V,aAAa1P,EAAOzD,GAGnB7C,aACNsG,EACAzD,EACAC,EACAmP,GAEA,MAAMrC,EAA+BzP,KAAK2R,KAAKrV,QAE/C,OAAKmT,EAQHtJ,EACGmK,YAAY5N,GACZkI,GAAG6E,EAAU3P,EAAG2P,EAAU1P,GAC1BwQ,YAEHvQ,KAAK6V,aAAa1P,EAAOzD,GAErB1C,KAAK2R,KAAK9V,OACLmE,KAAKoS,IAAIjM,EAAOzD,EAAUC,GAAM,QADzC,GAIO,IAAI6M,EAAU7M,EAAMD,EAAU+M,GAlBjCqC,GACF9R,KAAK2R,QACE3R,KAAKoS,IAAIjM,EAAOzD,EAAUC,GAAM,KAEhC,IAAI0R,IAASjC,IAAIjM,EAAOzD,EAAUC,GAkBvC9C,gBAAgB+V,GACtB5V,KAAK8U,cAAcc,GAAU5V,KAAK0U,YCjKzBoB,WAAgB/F,EAKpBlQ,IACLsG,EACAzD,EACAC,GAEA,IACGwD,EAAM6N,IAAI3G,EAAQK,YAClB1N,KAAK+V,WAAW5P,KAChBnG,KAAK+R,UAAU5L,EAAOzD,EAAUC,GAEjC,OAGF,IAAIgP,KAEJ,IAAK3R,KAAKgS,OACR,KAAM,6CASR,OANApR,EACE8B,EAASmF,YAAY1B,GACrBzD,EAASmF,YAAY7H,KAAKgS,QAC1B,CAAClS,EAAGC,IAAM4R,EAAK5V,KAAK,IAAI6D,EAAME,EAAGC,KAG5B,IAAIiW,GACTrE,EACAhP,EACAD,EACCuT,IACKA,IAAa1T,EAAS2T,MACxBlW,KAAKgS,YAAS7N,EACdnE,KAAKmW,oBAAiBhS,KAMtBtE,WAAWsG,GAEjB,OADAnG,KAAKoW,SAAWjQ,EAAMkQ,aACGlS,IAAlBnE,KAAKoW,SAGNvW,UAAUsG,EAAiBzD,EAAoBC,GAIrD,OAHA3C,KAAKmW,eAAiBnW,KAAKgS,OAC3BhS,KAAKgS,YAAS7N,KAEVnE,KAAKmW,iBACHnW,KAAKsW,WAAWnQ,EAAOzD,EAAU1C,KAAKmW,eAAe9P,MAKpDrG,KAAKqS,aAAalM,EAAOzD,EAAUJ,GACxCtC,KAAKsS,QAAQnM,EAAO7D,IAIhBzC,WACNsG,EACAzD,EACAkQ,GAEA,OAAO5S,KAAKqS,aACVlM,EACAzD,EACAJ,GAAYsQ,IAAatQ,EAAS+D,IAI9BxG,aACNsG,EACAzD,EACA6P,GAEA,MAAMxJ,EAAS5C,EAAMmK,YAAY5N,GAC/BmG,EAAMnG,EAASmF,YAAY1B,GAe7B,OAbAnG,KAAK8S,WAAW/J,EAAQrG,EAASmF,YAAY1B,GAAQ,CAAClG,EAAOU,KAC3D,MAAM2B,EAAW3B,EAAK2B,UAGnBtC,KAAKgS,QACN1P,GACAiQ,EAAUjQ,KACTtC,KAAKuW,UAAUpQ,EAAO0C,EAAKE,EAAQ9I,KAEpCD,KAAKgS,OAAStP,EAASkI,GAAG3K,EAAMH,EAAGG,EAAMF,GAAGuC,cAIvCtC,KAAKgS,OAGRnS,UACNsG,EACA0C,EACAE,EACAyN,GAEA,IAAID,GAAY,EAMhB,OAJA3V,EAAUiI,EAAK2N,EAAQ,CAAC1W,EAAGC,KACzBwW,EAAYA,GAAaxN,EAAO6B,GAAG9K,EAAGC,GAAGwQ,SAASpK,KAG7CoQ,SC7GLE,WAAkCtO,EAAxCtI,kCACSG,KAAA0W,OAAQ,EAER7W,iBACLG,KAAK0W,OAAQ,SAIXC,WAAqCxO,EAGzCtI,YACUsG,EACAxD,EACAD,GAERjB,QAJQzB,KAAAmG,QACAnG,KAAA2C,OACA3C,KAAA0C,WAKH7C,eAAe0I,GAEpB,MAAMqO,EAAc5W,KAAK2C,KAAKkU,OAAOtO,EAASvB,eAC9CuB,EAASuO,SAAWF,EAAYG,YAC9B/W,KAAK0C,SAAS2D,GACdrG,KAAK0C,SAASmF,YAAY7H,KAAKmG,QAGjCnG,KAAKsO,MAAQ,IAAIkB,EACfxP,KAAK2C,KACL3C,KAAK0C,SACL6F,EAASuO,SACTF,UAKOI,WAAkBvF,EAC7B5R,cACE4B,MAAMd,IACJ,MAAMsW,EAAU,IAAIR,GAEpB,OADA9V,EAAKkK,MAAMoM,GACJA,EAAQP,QAIZ7W,IACLsG,EACAzD,EACAC,GAEA,GAAIwD,EAAM6N,IAAI3G,EAAQE,gBACpB,OAAO9L,MAAM2Q,IAAIjM,EAAOzD,EAAUC,GAI5B9C,QACRsG,EACAzD,EACAC,GAGA,MAAMsU,EAAU,IAAIN,GAA6BxQ,EAAOxD,EAAMD,GAI9D,OAHSA,EAASuR,aAAa9N,GAE1B0E,MAAMoM,GACJA,EAAQ3I,aCzEN4I,WAAkBhV,EAC7BrC,YAAoB6C,GAClBjB,QADkBzB,KAAA0C,WAIb7C,eAAeyC,GACpB,IAAIyG,EAASzG,EAASgO,YAAYtQ,KAAK0C,UASvC,OAPA1C,KAAK0C,SACFmF,YAAYvF,GACZsO,WACAnQ,QAAQ,EAAGX,IAAGC,QACbgJ,EAAO6B,GAAG9K,EAAGC,GAAGiL,IAAIhL,KAAK0C,SAASkI,GAAG9K,EAAGC,GAAI,KAGzCwC,EAASC,eCbP2U,WAAmBpH,EACvBlQ,IAAIsG,EAAiBzD,GAC1B,IAAIyD,EAAM4H,OAAO1C,MAIjB,OAAO,IAAI6L,GAAUxU,ICPzB,IAAY0U,GCDAC,GCIAC,GAgBAC,GAUAC,GA4FAC,GCtHAlU,IHHZ,SAAY6T,GACVA,IAAA,uCACAA,IAAA,iBACAA,IAAA,eACAA,IAAA,yBACAA,IAAA,+BACAA,IAAA,qBACAA,IAAA,yCACAA,IAAA,eACAA,IAAA,iCACAA,IAAA,uCAVF,CAAYA,mBAaUM,GAGpB7X,YACkByF,EACN5C,EACAC,GAFM3C,KAAAsF,OACNtF,KAAA0C,WACA1C,KAAA2C,OAEV3C,KAAK4C,OAAS5C,KAAK2C,KAAKC,OAG1BjC,WACE,OAAOX,KAAK0C,SAASuR,aAAajU,KAAK4C,QAG/B/C,UACRG,KAAK2C,KAAKC,OAAOsR,GAAGyD,UAGZ9X,SAAS+X,GACjB5X,KAAK2C,KAAKC,OAAOsR,GAAG2D,SAASD,GAGrB/X,SACRG,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,cIrC3CoV,WAAuBL,GAClC7X,YAAmBmY,EAAsBtV,EAAoBC,GAC3DlB,MAAM2V,GAAca,MAAOvV,EAAUC,GADpB3C,KAAAgY,YAInBE,iBACE,OAAOlY,KAAK2C,KAAKC,OAAOlF,YCKfya,WAAwBnF,EACnCnT,YAAmBuY,EAAuB1V,EAAoBC,GAC5DlB,MAAMkB,GADW3C,KAAAoY,QAAuBpY,KAAA0C,WAInC7C,MACL,IAAKG,KAAK2C,KAAKuR,GACb,KAAM,4CAGJlU,KAAKoY,MAAQ,GAAM,EACrBpY,KAAK2C,KAAKuR,GAAG0D,UAAY,IAAIS,GAC3BrY,KAAKoY,MACLpY,KAAK0C,SACL1C,KAAK2C,MAGP3C,KAAK2C,KAAKuR,GAAG0D,UAAY,IAAIU,GAC3BtY,KAAKoY,MACLpY,KAAK0C,SACL1C,KAAK2C,MAKJ9C,YACL,OAAO,SA8BE0Y,WAA6BvF,EACxCnT,YAAoB6C,EAAoBC,GACtClB,MAAMkB,GADY3C,KAAA0C,WAIb7C,MACL,IAAKG,KAAK2C,KAAKuR,GACb,KAAM,4CAIRlU,KAAK2C,KAAKC,OAAO4V,cAAcxY,KAAK0C,UACpC1C,KAAK2C,KAAKuR,GAAG0D,UAAY,IAAIa,GAC3BzY,KAAK0C,SACL1C,KAAK2C,MAIF9C,YACL,OAAO,SAIE6Y,WAAiBxF,GAA9BrT,kCACSG,KAAA4X,UAA8B,KAG9B5X,KAAA2Y,SAAmB,EAEnB9Y,IACL+C,EACAF,EACAC,GAEA3C,KAAK2C,KAAOA,EACZ3C,KAAK0C,SAAWA,EAEhB1C,KAAK4X,UAAY,IAAIE,GAAcpV,EAAU1C,KAAK2C,MAClD3C,KAAK2C,KAAKuR,GAAKlU,KAKVH,UACL,IAAIyO,EAAQtO,KAAKoT,OAAOxB,MACxB,GAAItD,EACFA,EAAM+E,WACD,GAAIrT,KAAK2C,MAAQ3C,KAAK0C,SAAU,CACrC1C,KAAK2C,KAAKC,OAAOpC,GAAG,IAAIiC,EAAWzC,KAAK0C,SAAU1C,KAAK2C,OAEvD,IAAI2L,EAAQtO,KAAKoT,OAAOxB,MACpBtD,EACFA,EAAM+E,OAENrT,KAAK2C,KAAKC,OAAOsR,GAAG0E,YACpB5Y,KAAK2C,KAAKuR,GAAK,KACflU,KAAK4X,UAAY,OAKhB/X,SAAS+X,GACd5X,KAAK4X,UAAYA,SCjIRiB,WAA2B3W,EACtCrC,YACSsG,EACCzD,EACAC,GAERlB,QAJOzB,KAAAmG,QACCnG,KAAA0C,WACA1C,KAAA2C,OAKH9C,eAAesC,GACpB,OAAOI,EAASC,QAGX3C,aAAasC,GAKlB,OAJAA,EAAQiW,MAAM9X,IAAI,GAAGG,QAAQ2X,IAC3BjW,EAAQ+R,GAAGC,UAAU,IAAIgE,GAAgBC,EAAOpY,KAAK0C,SAAU1C,KAAK2C,SAG/DJ,EAASC,eClBPsW,WAAuB5W,EAClCrC,YACUkZ,EACAC,EACArW,EACAsW,GAERxX,QALQzB,KAAA+Y,aACA/Y,KAAAgZ,SACAhZ,KAAA2C,OACA3C,KAAAiZ,WAKHpZ,eAAeyC,GAapB,OAVIA,EAAS2M,UAAUjP,KAAK+Y,aAC1B/Y,KAAKkZ,cAGHlZ,KAAKiZ,SACP3W,EAASuM,aAAapL,UAAUzD,KAAK+Y,WAAY/Y,KAAKiZ,UAEtD3W,EAASmB,UAAUzD,KAAK+Y,WAAY/Y,KAAKgZ,QAGpCzW,EAASC,QAGR3C,iBN3BZ,SAAYwX,GACVA,IAAA,2BACAA,IAAA,6BACAA,IAAA,+CAHF,CAAYA,mBOIC8B,GACXtZ,eAEOA,cAAcuZ,EAAoBC,GACvC,OACEnZ,KAAKoZ,SAAWF,GAAcA,EAAalZ,KAAKqZ,IAAe,IAAXF,EAAiB,KAOlExZ,cAAc2Z,EAAiBC,GACpC,OAAOvZ,KAAKoZ,SAAYpZ,KAAKwZ,KAAKF,EAAUC,GAASvZ,KAAKyZ,GAAM,EAG3D9Z,qBAAqBC,EAAWC,GACrC,OAAO,GAGFF,cACLsO,EACAyL,EACAC,GAEA,GACE1L,EAAQ2L,MAAM,EAAGxU,OAAM+J,iBACrBrP,KAAK+Z,SAASzU,EAAM+J,EAAawK,IAGnC,OAASG,OAAQ,EAAGC,QAAQ,GAqB9B,OAASD,OAlBMhe,OAAAoI,EAAA,MAAApI,CACbmS,EACA,EAAG7B,QAAO4N,OAAM5U,OAAM+J,iBAChBrP,KAAK+Z,SAASzU,EAAM+J,EAAawK,GAC5B,EAGF3Z,KAAKoI,MACVpI,KAAKkB,IACH,EACAkL,EACEtM,KAAKma,SAASD,GACdla,KAAKoa,gBAAgB9U,EAAMsU,MAMpBK,QAAQ,GAGjBpa,gBACRwa,EACAhL,EACAwK,GAEA,GAAIxK,GAAerT,OAAAoI,EAAA,aAAApI,CAAa6d,EAAmBxK,GAAaxT,OAC9D,OAAO,EAGT,OAAQwe,GACN,KAAKC,GAAWC,MAChB,KAAKD,GAAWE,OAChB,KAAKF,GAAWG,MACd,OAAOze,OAAAoI,EAAA,SAAApI,CAAS6d,EAAmBxC,GAAWqD,YAChD,KAAKJ,GAAWK,MACd,OAAO3e,OAAAoI,EAAA,SAAApI,CAAS6d,EAAmBxC,GAAWuD,aAChD,KAAKN,GAAWO,KACd,OAAO,GAIHhb,gBAAgBqa,GACxB,OAAOle,OAAAoI,EAAA,IAAApI,CAAIA,OAAAoI,EAAA,MAAApI,CAAMke,EAAKY,MAAO,IAAM9e,OAAAoI,EAAA,OAAApI,CAAO,EAAGke,EAAK9Y,OAG1CvB,uBACRwa,EACAnM,GAEA,OAAOlS,OAAAoI,EAAA,IAAApI,CACLkS,EAAY7N,IACV,EAAGiF,OAAMnH,WACPA,EAAQ6B,KAAK+a,mBAAmBV,EAAY/U,MAKnC6T,GAAA4B,mBAAqB,EACpCV,EACAW,KAEA,OAAQX,GACN,KAAKC,GAAWC,MACd,OAAQS,GACN,KAAKvD,GAAewD,OAClB,OAAO,EAAI,EACb,KAAKxD,GAAeyD,MAClB,OAAO,EAAI,EACb,QACE,OAAO,EAEb,KAAKZ,GAAWE,OACd,OAAQQ,GACN,KAAKvD,GAAe0D,MAClB,MAAO,GACT,KAAK1D,GAAewD,OAClB,OAAO,EAAI,EACb,KAAKxD,GAAeyD,MAClB,OAAO,EACT,KAAKzD,GAAe2D,UAClB,MAAO,IACT,QACE,OAAO,EAEb,KAAKd,GAAWG,MACd,OAAQO,GACN,KAAKvD,GAAewD,OAClB,OAAO,EACT,KAAKxD,GAAeyD,MAEpB,KAAKzD,GAAe2D,UAClB,MAAO,GACT,QACE,OAAO,EAEb,KAAKd,GAAWK,MACd,OAAQK,GACN,KAAKvD,GAAe0D,MAClB,OAAO,EAAI,EACb,KAAK1D,GAAewD,OAClB,MAAO,IACT,KAAKxD,GAAe4D,MAClB,MAAO,GACT,KAAK5D,GAAeyD,MAClB,OAAO,EACT,QACE,OAAO,EAEb,KAAKZ,GAAWO,KACd,OAAO,EACT,QACE,KAAM,iCNjJd,SAAYvD,GACVA,IAAA,iCACAA,IAAA,6BACAA,IAAA,6BACAA,IAAA,eACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,eACAA,IAAA,eACAA,IAAA,oBACAA,IAAA,0BACAA,IAAA,kBAbF,CAAYA,aAgBZ,SAAYC,GACVA,IAAA,yBACAA,IAAA,iCACAA,IAAA,2BACAA,IAAA,qBACAA,IAAA,mBACAA,IAAA,iCACAA,IAAA,iBAPF,CAAYA,aAUZ,SAAYC,GACVA,IAAA,6BACAA,IAAA,iBAEAA,IAAA,aACAA,IAAA,mBALF,CAAYA,mBAUC8D,GAQXzb,YACS0b,EACA7d,EACAwO,EACSsP,KACAlQ,EAAqB,IAAIW,MAClC5F,EAAaiV,GAAK1N,SALlB5N,KAAAub,QACAvb,KAAAtC,OACAsC,KAAAkM,SACSlM,KAAAwb,SACAxb,KAAAsL,WACTtL,KAAAqG,KARFrG,KAAAkF,WAJArF,eACL,OAAOG,KAAKgO,SAcdyN,oBACE,OAAO,EAGF5b,QACL,OAAO,IAAIyb,GAAKtb,KAAKub,MAAOvb,KAAKtC,KAAMsC,KAAKkM,QAGvCrM,WAAWiE,GAChB,OAAO9D,KAAKtC,OAASoG,EAAKpG,KAGrBmC,UAAUiE,GACf,OAAO,EAGFjE,SAAS+C,GACd,OAAO,GAjCM0Y,GAAAtN,OAAiB,QAqCrB0N,WAAeJ,GAC1Bzb,YAA4BgN,GAC1BpL,MAAM8V,GAAUoE,cAAe9O,EAAOnP,gBAAiBmP,EAAOX,QADpClM,KAAA6M,gBAKR+O,WAAeN,GACnCzb,YAAmBnC,GACjB+D,MAAM8V,GAAUqE,OAAQle,EAAM,IADbsC,KAAAtC,cAOCme,WAAgBP,GACpCzb,YAAYnC,EAAcwO,EAAgBZ,GACxC7J,MAAM8V,GAAUsE,QAASne,EAAMwO,KAAYZ,UAIzBwQ,WAAsBR,GAC1Czb,YAAYnC,EAAcwO,EAAgBZ,GACxC7J,MAAM8V,GAAUuE,cAAepe,EAAMwO,GAASoL,GAAMyE,OAAQzQ,UAI1C0Q,WAAeV,GACnCzb,YACE0b,EACA7d,EACAwO,EACgBiC,EAChB8N,GAEAxa,MAAM8Z,EAAO7d,EAAMwO,GAAS+P,IAHZjc,KAAAmO,iBAOP+N,WAAsBF,GACjCnc,YAAYnC,EAAcwO,EAAgBiC,GACxC1M,MAAM8V,GAAU2E,cAAexe,EAAMwO,EAAQiC,EAASmJ,GAAM6E,iBAIhE,SAAY1E,GACVA,IAAA,iBACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,yBALF,CAAYA,mBAaU2E,WAAcd,GAClCzb,YACE0b,EACA7d,EACAwO,EACgBgC,EAChB+N,GAEAxa,MAAM8Z,EAAO7d,EAAMwO,GAAS+P,IAHZjc,KAAAkO,qBAOPmO,WAAkBD,GAC7Bvc,YAAYnC,EAAcwO,EAAgBgC,GACxCzM,MAAM8V,GAAU8E,UAAW3e,EAAMwO,EAAQgC,EAAaoJ,GAAMgF,oBAInDC,WAAcH,GACzBvc,YAAYnC,EAAcwO,EAAgBgC,GACxCzM,MAAM8V,GAAUgF,MAAO7e,EAAMwO,EAAQgC,EAAaoJ,GAAMiF,SCvJ5D,SAAYhZ,GACVA,IAAA,mBACAA,IAAA,qBACAA,IAAA,eACAA,IAAA,2BAJF,CAAYA,mBAOCD,WAAiBpB,EAC5BrC,YACU8C,EACAD,EACA8Z,GAER/a,QAJQzB,KAAA2C,OACA3C,KAAA0C,WACA1C,KAAAwc,SAKH3c,eAAeyC,GACpB,IAAI3B,EAAOX,KAAK0C,SAASuR,aAAa3R,GAWtC,OATAtC,KAAK0C,SAASiN,eAAerN,GAC7BA,EAASwL,MAAO,EAEhBnN,EAAK8b,QAAQ,IAAIf,GAAOpZ,EAASuK,QAAS,GAE1CvK,EAASoa,eAAejc,QAAQuD,GAC9BrD,EAAK8b,QAAQzY,EAAQF,KAAME,EAAQE,QAG9B3B,EAAS2T,IAGXrW,aAAa+C,GAUlB,OARAA,EAAOsR,GAAG0D,UAAY,IAAIG,GACxB/X,KAAKwc,OACLxc,KAAK0C,SACL1C,KAAK2C,MAEPC,EAAOkL,MAAO,EACd9N,KAAK2C,KAAKuR,GAAKtR,EAAOsR,GAEf3R,EAAS2T,WMzCPyG,WAAkBza,EAG7BrC,YACUsO,EACAzL,EACAC,GAERlB,QAJQzB,KAAAmO,UACAnO,KAAA0C,WACA1C,KAAA2C,OAKVqX,aACE,GAAIha,KAAK4c,WACP,OAAO5c,KAAK4c,WAEZ,KAAM,sDAIH/c,eAAesC,GACpB,MAAM6X,OAAEA,EAAMC,OAAEA,GAAWd,GAAWa,OACpCha,KAAKmO,QACLhM,EAAQ+L,YACR/L,EAAQkN,aAKV,OAFArP,KAAK4c,WAAa5C,EAEdC,EACK1X,EAASsa,OAGd7C,GAAU7X,EAAQ4L,OAAOpC,cAC3BxJ,EAAQ3B,GAAG,IAAI8C,GAAStD,KAAK2C,KAAM3C,KAAK0C,SAAUa,GAAUuZ,SACrDva,EAAS2T,KACP8D,GAAU,EACZzX,EAASC,SAEhBL,EAAQ4L,OAAOtC,SAASuO,GACjBzX,EAASwa,aCvCT7K,WAAoBhQ,EAC/BrC,YACUmS,EACAtP,EACAC,GAERlB,QAJQzB,KAAAgS,SACAhS,KAAA0C,WACA1C,KAAA2C,OAKH9C,eAAesG,GACpB,MAAM8P,EAAWjW,KAAKgd,QAAQ7W,GAE9B,OAAQ8P,GACN,KAAK1T,EAASC,QAEZxC,KAAK2C,KAAKsF,OAAOgV,iBAAiB9W,GAClC,MACF,KAAK5D,EAASsa,OAEZ7c,KAAK2C,KAAKsF,OAAOiV,oBAAoB/W,GAIzC,OAAO8P,EAGFpW,aAAasG,GAClB,MAAM8P,EAAWjW,KAAKgd,QAAQ7W,GAE9B,OAAQ8P,GACN,KAAK1T,EAASC,QACZxC,KAAK2C,KAAKsF,OAAOkV,iBAAiBhX,GAClC,MACF,KAAK5D,EAASsa,OACZ7c,KAAK2C,KAAKsF,OAAOmV,oBAAoBpd,KAAKgS,QAI9C,OAAOiE,EAGCpW,QAAQsG,GAChB,GAAIgT,GAAWkE,OAAOlX,EAAMgJ,YAAanP,KAAKgS,OAAO7C,aAEnD,OADAnP,KAAK2C,KAAKsF,OAAOqV,YAAYnX,EAAOnG,KAAKgS,QAClCzP,EAASgb,MAGlB,MAAMC,EAAY,IAAIb,GAAUxW,EAAMgI,QAASnO,KAAK0C,SAAU1C,KAAK2C,MACjEsT,EAAWjW,KAAKgS,OAAOxR,GAAGgd,GAE5B,OAAQvH,GACN,KAAK1T,EAAS2T,IACZ/P,EAAM3F,GAAG,IAAIqY,GAAmB7Y,KAAKgS,OAAQhS,KAAK0C,SAAU1C,KAAK2C,OACjE3C,KAAK2C,KAAKsF,OAAOwV,YAAYD,EAAUxD,OAAQ7T,EAAOnG,KAAKgS,QAC3D,MACF,KAAKzP,EAASwa,KACZ/c,KAAK2C,KAAKsF,OAAOyV,YAAYF,EAAUxD,OAAQ7T,EAAOnG,KAAKgS,QAI/D,OAAOiE,SChEE0H,WAAyBzb,EACpCrC,YAAoB+d,EAAwBjb,GAC1ClB,QADkBzB,KAAA4d,SAAwB5d,KAAA2C,OAIrC9C,eAAesG,GAKpB,OAJAA,EAAM0X,WAAW7d,KAAK4d,OAAQ,GAC9B5d,KAAK4d,OAAOE,QAAQ9d,KAAK2C,MAEzB3C,KAAK2C,KAAKsF,OAAO8V,MAAM/d,KAAK4d,QACrBrb,EAASC,eCPPwb,WAAuB3b,EAClCxC,YACUc,EACAsF,EACAtD,GAERlB,QAJQzB,KAAAW,OACAX,KAAAiG,QACAjG,KAAA2C,OAKH9C,aAAa+C,GAUlB,OARA5C,KAAKiG,MAAMxF,QAAQ,EAAGqD,OAAMI,YAC1BtB,EAAOib,WAAW/Z,EAAMI,GACxBtB,EAAOM,YAAY+a,SAASna,EAAKoI,OAAShI,GAE1ClE,KAAK2C,KAAKsF,OAAOiW,YAAYpa,EAAMI,GACnClE,KAAKW,KAAK8b,QAAQ3Y,EAAMI,KAGnB3B,EAASC,eCtBP2b,WAAqB9b,EACzBxC,aAAa+C,GAGlB,OAFA5C,KAAKoe,aAAaxb,GAEXL,EAASC,QAGR3C,aAAa+C,GACrB,MAAM6J,EAAe7J,EAAO6J,aAAatJ,QAErCsJ,EAAe,EACjB7J,EAAOmL,OAAOsQ,iBAAiB,GACtB5R,EAAe,EACxB7J,EAAOmL,OAAOsQ,iBAAiB,GACtB5R,EAAe,KAEfA,EAAe,GACxB7J,EAAOmL,OAAOuQ,iBAAiB,GACtB7R,EAAe,GACxB7J,EAAOmL,OAAOuQ,iBAAiB,GACtB7R,EAAe,GACxB7J,EAAOmL,OAAOuQ,iBAAiB,GAE/B1b,EAAOmL,OAAOuQ,iBAAiB,IAG7B1b,EAAOmL,OAAO3C,QAAU,GAC1BxI,EAAOmL,OAAOuQ,iBAAiB,EAAI1b,EAAOmL,OAAO3C,gBC3BjCmT,GACpB1e,YAAmB2e,GAAAxe,KAAAwe,SAIZ3e,QACL,OAAQ,SAIC4e,WAA6BF,GACxC1e,YACkBiE,EACR4a,EACRF,GAEA/c,MAAM+c,GAJUxe,KAAA8D,OACR9D,KAAA0e,SAMH7e,YAAYkJ,GACjB,GAAI/I,KAAK2e,OACP,OAGF,MAAO1e,GAASD,KAAK0e,OAAO3hB,OAAO,EAAG,GAChC4D,EAAOoI,EAAO6B,GAAG3K,EAAMH,EAAGG,EAAMF,GAElCY,EAAKgK,QACPhK,EAAKoE,OAAS,IAGd/E,KAAK4e,YAAY7V,GAIdlJ,OACL,OAA8B,IAAvBG,KAAK0e,OAAO7iB,cC/BVgjB,WAAmB3c,EAC9BrC,YACSmS,EACAqE,EACC3T,EACAC,GAERlB,QALOzB,KAAAgS,SACAhS,KAAAqW,UACCrW,KAAA0C,WACA1C,KAAA2C,OAKH9C,eAAesG,GACpB,GAAIgT,GAAWkE,OAAOlX,EAAMgJ,YAAanP,KAAKgS,OAAO7C,aAEnD,OADAnP,KAAK2C,KAAKsF,OAAO6W,iBAAiB3Y,EAAOnG,KAAKgS,OAAQhS,KAAKqW,SACpD9T,EAASwc,YAIlB,MAAM/E,EAASb,GAAW6F,cAAc,GAAI,IAE5C,OAAIhF,GAAUha,KAAKgS,OAAOjE,OAAOpC,cAC/BxF,EAAM3F,GAAG,IAAIqY,GAAmB7Y,KAAKgS,OAAQhS,KAAK0C,SAAU1C,KAAK2C,OACjE3C,KAAK2C,KAAKsF,OAAOgX,iBACfjF,EACA7T,EACAnG,KAAKgS,OACLhS,KAAKqW,SAEArW,KAAKgS,OAAOxR,GACjB,IAAI8C,GAAStD,KAAK2C,KAAM3C,KAAK0C,SAAUa,GAAUsY,YAGnD7b,KAAKgS,OAAOjE,OAAOtC,SAASuO,GAC5Bha,KAAK2C,KAAKsF,OAAOiX,iBACflF,EACA7T,EACAnG,KAAKgS,OACLhS,KAAKqW,SAEA9T,EAASwa,aCjCToC,WAAyBjd,EACpCrC,YAAoBuf,EAA6Bzc,GAC/ClB,QADkBzB,KAAAof,OAA6Bpf,KAAA2C,OAI1C9C,eAAesG,GACpB,OAAO5D,EAASC,QAGX3C,aAAa+C,GAClB,MAAMyc,EAAYrf,KAAKof,KAAKC,UAE5B,QAAkBlb,IAAdkb,EACF,mCAAoCrf,KAAKof,KAAK1hB,0BAQhD,OALAsC,KAAKof,KAAKE,UACVtf,KAAKuf,UAAU3c,EAAQyc,EAAUvb,MACjClB,EAAO4c,UAAUC,SAASJ,EAAUvb,KAAMub,EAAUnb,OACpDlE,KAAK2C,KAAKsF,OAAOqX,QAAQD,EAAUvb,MAE5BvB,EAASC,QAGV3C,UAAU+C,EAAgBkB,GAG5BA,aAAgBsY,IAClBtY,EAAKoK,YAAYzN,QAASif,IACxB9c,EAAO+c,iBAAiB5iB,OACtBf,OAAAoI,EAAA,UAAApI,CACE4G,EAAO+c,iBACPC,GAAcA,IAAeF,GAE/B,KAKF5b,aAAgBkY,IAClBlY,EAAKqK,QAAQ1N,QAASof,IACpBjd,EAAOkd,aAAa/iB,OAClBf,OAAAoI,EAAA,UAAApI,CAAU4G,EAAOkd,aAAc9F,GAAUA,IAAW6F,GACpD,KAKN/b,EAAKoB,QAAQzE,QAAQuE,IACnBpC,EAAOpC,GAAG,IAAIuf,GAAkB/a,EAAQlB,EAAKpG,KAAMsC,KAAK2C,gBCxDjDqd,WAAwB9d,EACnCrC,YACUuf,EACAlb,EACAvB,GAERlB,QAJQzB,KAAAof,OACApf,KAAAkE,QACAlE,KAAA2C,OAKH9C,eAAeyC,GACpB,OAAOC,EAASC,QAGX3C,aAAa+C,GAClB,IAAK5C,KAAKof,KAAKC,UACb,yBAA0Brf,KAAKof,KAAK1hB,wBAGtC,OAAIsC,KAAKof,KAAKC,UAAUnb,QAAUlE,KAAKkE,MAC9BtB,EAAOpC,GAAG,IAAI2e,GAAiBnf,KAAKof,KAAMpf,KAAK2C,QAEtD3C,KAAKof,KAAKC,UAAUnb,OAASlE,KAAKkE,MAG7B3B,EAASC,gBCpBPwT,WAA2B9T,EACtCrC,YACU8R,EACAhP,EACAD,EACAic,GAERld,QALQzB,KAAA2R,OACA3R,KAAA2C,OACA3C,KAAA0C,WACA1C,KAAA2e,OAKH9e,eAAesG,GACpB,IAAIkQ,EAAUlQ,EAAMkQ,QAEpB,IAAKA,EACH,KAAM,uDAKR,OAFArW,KAAKigB,YAAY9Z,EAAOkQ,EAAQvS,MAEzBvB,EAASC,QAGX3C,aAAa+C,GAClB,MAAMyT,EAAUzT,EAAOyT,QAEvB,IAAKA,EACH,KAAM,wCAQR,OALArW,KAAKigB,YAAYrd,EAAQyT,EAAQvS,MAEjClB,EAAOpC,GAAG,IAAIwf,GAAgBpd,EAAO4c,UAAUU,YAAa,EAAGlgB,KAAK2C,OACpEC,EAAOM,YAAY+a,SAAS5H,EAAQvS,KAAKoI,QAElC3J,EAASC,QAGV3C,YAAYsG,EAAiBkQ,GACnC,IACErE,EADEmO,KAGJngB,KAAK2R,KAAKlR,QAAQR,IAChB,IAAK+R,EAAQ,CACX,MAAMrR,EAAOX,KAAK0C,SAASkI,GAAG3K,EAAMH,EAAGG,EAAMF,GAC7CiS,EAASrR,EAAK2B,SACd6d,EAAWpkB,KAAKkE,MAIpBD,KAAK2C,KAAKoC,OAAS,IAAI0Z,GAAqBpI,EAAS8J,EAAY,KAC3DnO,EACFhS,KAAK2e,KACHxY,EAAM3F,GAAG,IAAIqe,GAAW7M,EAAQqE,EAASrW,KAAK0C,SAAU1C,KAAK2C,QAG/D3C,KAAK2e,KAAKpc,EAASC,kBC5Dd4R,WAAyB/R,EACpCxC,YACUc,EACAsF,EACAtD,GAERlB,QAJQzB,KAAAW,OACAX,KAAAiG,QACAjG,KAAA2C,OAKH9C,aAAa+C,GAClB,IAAIwd,EAA0CpgB,KAAKW,KAAKsF,MAExD,QAAkB9B,IAAdic,EACF,KAAM,8CAKR,OAHEpgB,KAAKqgB,cAAczd,EAAQwd,GAGtB7d,EAASC,QAGR3C,cAAcsC,EAAiBie,GACvCpgB,KAAKiG,MAAMxF,QAAQ,EAAGqD,OAAMI,YAC1B/B,EAAQsa,QAAQ3Y,EAAMI,GACtB/B,EAAQe,YAAY5C,IAAIwD,EAAKoI,OAAShI,GAEtClE,KAAK2C,KAAKsF,OAAOqY,aAAaxc,EAAMI,GACpCkc,EAAUG,OAAOzc,EAAMI,YCzBhBsc,WAAuBte,EAClCrC,YACUuf,EACAtb,EACAnB,GAERlB,QAJQzB,KAAAof,OACApf,KAAA8D,OACA9D,KAAA2C,OAKH9C,eAAeyC,GACpB,OAAOC,EAASC,QAGX3C,aAAa+C,GAClB,IACE6d,EADc7d,EAAO4c,UACCkB,UAAU1gB,KAAK8D,MAEvC,QAAkBK,IAAdsc,EACF,aACEzgB,KAAK8D,KAAKpG,oDAMd,GAAIsC,KAAKof,KAAKC,UAAW,CACvB,MAAMpJ,EAAWrT,EAAOpC,GAAG,IAAI2e,GAAiBnf,KAAKof,KAAMpf,KAAK2C,OAChE,GAAIsT,IAAa1T,EAASC,QACxB,OAAOyT,EAIX,MAAM/R,EAAQlE,KAAKof,KAAKuB,cAAgB,EAAIF,EAAUvc,MAQtD,OANAtB,EAAOib,WAAW7d,KAAK8D,KAAMI,GAC7BlE,KAAKof,KAAKwB,MAAM5gB,KAAK8D,KAAMI,GAC3BlE,KAAK6gB,QAAQje,EAAQ5C,KAAK8D,MAE1B9D,KAAK2C,KAAKsF,OAAO6Y,MAAM9gB,KAAK8D,MAErBvB,EAASC,QAGV3C,QAAQ+C,EAAgBkB,GAC1BA,aAAgBsY,KAClBxZ,EAAO+c,iBAAmB/c,EAAO+c,iBAAiBoB,OAAOjd,EAAKoK,cAG5DpK,aAAgBkY,KAClBpZ,EAAOkd,aAAeld,EAAOkd,aAAaiB,OAAOjd,EAAKqK,UAGxDrK,EAAKoB,QAAQzE,QAAQuE,IACnBpC,EAAOpC,GAAG,IAAIsY,GAAe9T,EAAQlB,EAAKpG,KAAMsC,KAAK2C,gBCzD9Cod,WAA0B7d,EACrCrC,YACUkZ,EACAC,EACArW,GAERlB,QAJQzB,KAAA+Y,aACA/Y,KAAAgZ,SACAhZ,KAAA2C,OAKH9C,eAAeyC,GACpB,OAAOC,EAASC,eCVEwe,WAA6B9e,EACjDrC,YAAsB6C,EAA8BC,GAClDlB,QADoBzB,KAAA0C,WAA8B1C,KAAA2C,OAI1C9C,WAAWsG,GACnB,IAAIrG,EAAEA,EAACC,EAAEA,GAAMC,KAAK0C,SAASmF,YAAY1B,GACzC,OAAOnG,KAAK2C,KAAKC,OAAO0N,YAAYtQ,KAAK0C,UAAUkI,GAAG9K,EAAGC,GAAG4K,SCJzD,MA6GMsW,GAAmB,SAC9B7I,EACA1B,EACAwK,GAEA,IAAIC,EAAQ/I,EAAM5Y,MAAQ4Y,EAAM3Y,OAEhC,KAAO0hB,EAAQ,GAAG,CAChB,MAAMrhB,EAAI9D,OAAAoI,EAAA,OAAApI,CAAO,EAAGoc,EAAM5Y,MAAQ,GAChCO,EAAI/D,OAAAoI,EAAA,OAAApI,CAAO,EAAGoc,EAAM3Y,OAAS,GAE/B,GAAIiX,EAAM0B,EAAMxN,GAAG9K,EAAGC,IAEpB,OADAmhB,EAAQphB,EAAGC,GACJqY,EAGT+I,IAGF,KAAM,qCC3HKC,WAA2BJ,GACtCnhB,YAAY6C,EAAoBC,EAAoB0e,GAClD5f,MAAMiB,EAAUC,GADkC3C,KAAAqhB,WAI7CxhB,eAAesG,GAgBpB,OAfInG,KAAKshB,WAAWnb,GAEhBA,EAAMob,cAAclK,GAAWmK,wBAC9BxhB,KAAKyhB,SAAStb,GAEfnG,KAAK2C,KAAKsF,OAAOyZ,sBAAsBvb,GAEvCnG,KAAK2C,KAAKsF,OAAO0Z,mBAAmBxb,GAGtCnG,KAAKyhB,SAAStb,GAKT5D,EAASC,QAGX3C,aAAa+C,GAgBlB,OAfIA,EAAO2e,cAAclK,GAAWmK,uBAC7BxhB,KAAKqhB,UACRrhB,KAAK2C,KAAKsF,OAAO2Z,4BAGnBhf,EAAOsR,GAAGC,UAAU,IAAIoE,GAAqBvY,KAAK0C,SAAU1C,KAAK2C,OACjE3C,KAAK2C,KAAKuR,GAAKtR,EAAOsR,IACblU,KAAKyhB,SAAS7e,GAClB5C,KAAKqhB,UACRrhB,KAAK2C,KAAKsF,OAAO4Z,mBAGnB7hB,KAAK2C,KAAKsF,OAAO6Z,sBAGZvf,EAASC,QAGR3C,SAASsG,GACjB,IAAI4b,GAAa,EAEjB,IACEd,GACEjhB,KAAK0C,SAEL/B,GAAQA,EAAKqhB,WAAarhB,EAAKshB,kBAC/B,CAACniB,EAAGC,KACFgiB,GAAa,EACb5b,EAAM3F,GAAG,IAAIgP,EAAUxP,KAAK2C,KAAM3C,KAAK0C,SAAU,IAAI9C,EAAME,EAAGC,OAGlE,MAAAmiB,IAEF,OAAOH,SC9DEI,WAAkBnB,GAC7BnhB,YACU8I,EACAyZ,EACR1f,EACAC,EACQ0f,EACAC,GAER7gB,MAAMiB,EAAUC,GAPR3C,KAAA2I,OACA3I,KAAAoiB,aAGApiB,KAAAqiB,kBACAriB,KAAAsiB,sBAKHziB,eAAesG,GAEpB,MAAMoc,EAAOviB,KAAKshB,WAAWnb,GAK7B,OAJIoc,IACFviB,KAAK2I,KAAKrB,UAAW,GAGnBtH,KAAKwiB,OAAOrc,IACdnG,KAAKqiB,gBAAgBE,GAAM,GACpBhgB,EAASgb,OAETvd,KAAKsiB,oBAAoBC,GAAM,GAInC1iB,aAAasG,GAGlB,OAFAnG,KAAK2I,KAAKrB,UAAW,EAEjBtH,KAAKwiB,OAAOrc,IACdnG,KAAKqiB,iBAAgB,GAAM,GACpB9f,EAASgb,OAETvd,KAAKsiB,qBAAoB,GAAM,GAIhCziB,OAAOsG,GACf,OAAOgT,GAAWqJ,OAAOrc,EAAMgJ,YAAanP,KAAKoiB,mBCvCxCK,WAAoBvgB,EAC/BrC,YACU6iB,EACA/Z,EACAjG,EACAC,GAERlB,QALQzB,KAAA0iB,eACA1iB,KAAA2I,OACA3I,KAAA0C,WACA1C,KAAA2C,OAKH9C,iBACL,OAAO0C,EAASC,QAGX3C,aAAa+C,GAElB,OADA5C,KAAK2I,KAAKga,OAAO3iB,KAAK0iB,aAAc1iB,KAAK0C,SAAU1C,KAAK2C,MACjDJ,EAASC,SCtBpB,IAAAogB,GAAA,SACEC,EACAC,GAEA,OAAOvjB,EAAYsjB,EAAQ,GAAGhnB,OAAQgnB,EAAQhnB,OAAQ,CAACiE,EAAGC,KACxD,MAAMY,EAAOmiB,EAAW/kB,IAAI8kB,EAAQ9iB,GAAGgjB,OAAOjjB,IAC9C,GAAIa,EACF,OAAOA,IAEP,iCAAkCkiB,EAAQ9iB,GAAGgjB,OAAOjjB,QCR1D,MACMkjB,GAAY,GACE9iB,KAAKyZ,GA8PzB,ICjQYW,GCGA2I,GCHAC,GCGAC,IHHZ,SAAY7I,GACVA,IAAA,iBACAA,IAAA,mBACAA,IAAA,iBACAA,IAAA,iBACAA,IAAA,eALF,CAAYA,mBIFC8I,GAOXvjB,YAAoBwjB,GAAArjB,KAAAqjB,WANbrjB,KAAAmD,QAAkB,EAClBnD,KAAAsjB,kBAA4B,EAG3BtjB,KAAAujB,cAAwB,EAG9BvjB,KAAKwjB,mBAAqBxjB,KAAKqjB,SAAS,GAGnCxjB,IAAI4jB,GACT,GAAIzjB,KAAKujB,aACP,SAGFvjB,KAAKsjB,mBAAqBG,EAE1B,IAAI9K,KAEJ,MACG3Y,KAAKujB,cACNvjB,KAAKsjB,mBAAqBtjB,KAAKwjB,oBAE/BxjB,KAAK0jB,UACL/K,EAAS5c,KAAKiE,KAAKmD,SAGrB,OAAOwV,EAGC9Y,UACRG,KAAKmD,SAAW,EAEhB,IAAIiV,EAAQpY,KAAKqjB,SAASrjB,KAAKmD,QAAU,GAErCiV,GACFpY,KAAKsjB,mBAAqBtjB,KAAKwjB,mBAC/BxjB,KAAKwjB,mBAAqBpL,IAE1BpY,KAAKsjB,kBAAoBtjB,KAAKwjB,mBAC9BxjB,KAAKujB,cAAe,UCvCbI,GAIX9jB,YAAYoG,GAHJjG,KAAA4jB,YAAsB,EACtB5jB,KAAAiG,SAGNA,EAAMxF,QAAQ,EAAEyL,EAAQpI,KAAU9D,KAAKM,IAAI4L,EAAQpI,IAG9CjE,IAAIqM,EAAgBpI,GACzB,GAAIoI,EAAS,EACX,KAAM,gCAGRlM,KAAKiG,MAAMlK,MAAMmQ,EAAQpI,IACzB9D,KAAK4jB,aAAe1jB,KAAK2jB,KAAK3X,GAGzBrM,KAAKikB,GACV,GAA0B,IAAtB9jB,KAAKiG,MAAMpK,OACb,KAAM,0BAGR,IAAIkoB,EAAO/nB,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK4jB,aAEvB,MAAMI,EAAQhkB,KAAKiG,MAAMlC,KAAK,EAAEmI,EAAQpI,MACtCigB,GAAQ7X,IAEO,GAGjB,QAAc/H,IAAV6f,EACF,OAAOA,EAAM,GAAGF,GAGlB,KAAM,+BAGDjkB,MAAMokB,GACX,IAAIC,EAAY,IAAIP,OAKpB,OAHA3jB,KAAKiG,MAAMxF,QAAQ,EAAEyL,EAAQpI,KAAUogB,EAAU5jB,IAAI4L,EAAQpI,IAC7DmgB,EAAKhe,MAAMxF,QAAQ,EAAEyL,EAAQpI,KAAUogB,EAAU5jB,IAAI4L,EAAQpI,IAEtDogB,SClCEC,GAAbtkB,cACSG,KAAA0U,KAAe,EACf1U,KAAA8E,SAEAjF,IAAIiE,EAASzC,GAClB,MAAM+iB,EAAKpkB,KAAK0U,KAAOrT,EAEnBrB,KAAK8E,MAAMsf,GACRpoB,OAAAoI,EAAA,SAAApI,CAASgE,KAAK8E,MAAMsf,GAAKtgB,IAC5B9D,KAAK8E,MAAMsf,GAAIroB,KAAK+H,GAGtB9D,KAAK8E,MAAMsf,IAAOtgB,GAIfjE,OAAOiE,GACZ9H,OAAAoI,EAAA,QAAApI,CAAQgE,KAAK8E,MAAO,CAAC3G,EAAOM,KAC1BzC,OAAAoI,EAAA,OAAApI,CAAOmC,EAAOkmB,GAAWA,IAAYvgB,KAGvC9D,KAAK8E,MAAQ9I,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK8E,MAAQ4G,GAAaA,EAAI7P,OAAS,GAGtDgE,OACLG,KAAK0U,KAAO1U,KAAKskB,WAEjB,MAAOD,GAAWroB,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK8E,MAAM9E,KAAK0U,MAAO,GAMhD,OAJqC,IAAjC1U,KAAK8E,MAAM9E,KAAK0U,MAAM7Y,eACjBmE,KAAK8E,MAAM9E,KAAK0U,WAGNvQ,IAAZkgB,EAAwBrkB,KAAKukB,OAASF,EAGxCxkB,SACL,GAAyB,IAArB7D,OAAAoI,EAAA,KAAApI,CAAKgE,KAAK8E,OACZ,SAGF9E,KAAK0U,KAAO1U,KAAKskB,WACjB,MAAME,EAASxkB,KAAK8E,MAAM9E,KAAK0U,MAI/B,cAFO1U,KAAK8E,MAAM9E,KAAK0U,MAEhB8P,EAGD3kB,WACN,IAAI6U,EAAO1Y,OAAAoI,EAAA,IAAApI,CAAIA,OAAAoI,EAAA,KAAApI,CAAKgE,KAAK8E,OAAOzE,IAAIP,GAAK2kB,SAAS3kB,KAElD,QAAaqE,IAATuQ,EACF,KAAM,sDAGR,OAAOA,SC7DWgQ,GAGpB7kB,cAFUG,KAAA2kB,UAMA9kB,aAAaQ,EAAeukB,GACpC,OAAO5kB,KAAK6kB,UAAUxkB,EAAK,IAAI4G,EAAa5G,EAAKukB,IAGzC/kB,WAAWQ,EAAeukB,GAClC,OAAO5kB,KAAK6kB,UAAUxkB,EAAK,IAAI8G,EAAW9G,EAAKukB,IAGzC/kB,UAAUQ,EAAeM,GAS/B,OARAsgB,GACE5gB,EACAM,GAAQA,EAAKqhB,WAAarhB,EAAKshB,kBAC/B,CAACniB,EAAGC,KACFM,EAAIyH,QAAQhI,EAAGC,EAAGY,KAIfN,SCpBEykB,WAAiBvkB,EAK5BV,YAA4BwG,EAAgBhG,GAC1CoB,MAAMpB,GADoBL,KAAAqG,KAJrBrG,KAAA+kB,aAEA/kB,KAAAtC,KAAe,UAIpBsC,KAAKglB,SAAW,IAAIb,GAGftkB,QACLG,KAAKglB,SAAW,IAAIb,GAGftkB,QACLG,KAAK6P,QACL7P,KAAK+kB,UAAUtkB,QAAQ6B,GACrBtC,KAAKglB,SAAS1kB,IAAIgC,EAAS+D,GAAI/D,EAASiM,QAIrC1O,aAAayC,GAClB,IAAI3B,EAQJ,GANAX,KAAKilB,KAAK7mB,IACJA,EAAEkE,UAAYlE,EAAEkE,SAAS+D,KAAO/D,EAAS+D,KAC3C1F,EAAOvC,MAINuC,EACH,iBAAkB2B,EAAS+D,0BAA0BrG,KAAKqG,KAG5D,OAAO1F,EAGFd,YAAYyC,GACjB,IAAIuG,EAQJ,GANA7I,KAAKilB,KAAK,CAACtkB,EAAMb,EAAGC,KACdY,EAAK2B,UAAY3B,EAAK2B,SAAS+D,KAAO/D,EAAS+D,KACjDwC,EAAM,IAAIjJ,EAAME,EAAGC,OAIlB8I,EACH,iBAAkBvG,EAAS+D,0BAA0BrG,KAAKqG,KAG5D,OAAOwC,EAGFhJ,YAAYgJ,EAAYvG,GAC7BtC,KAAK+kB,UAAUhpB,KAAKuG,GAEpBtC,KAAK4K,GAAG/B,EAAI/I,EAAG+I,EAAI9I,GAAGuC,SAAWA,EACjCtC,KAAKglB,SAAS1kB,IAAIgC,EAAS+D,GAAI/D,EAASiM,OAGnC1O,eAAeyC,GACpB,IAAIuG,EAAM7I,KAAK6H,YAAYvF,GAClBtC,KAAK4K,GAAG/B,EAAI/I,EAAG+I,EAAI9I,GAEvBuC,cAAW6B,EAChBnI,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK+kB,UAAWvnB,GAAKA,EAAE6I,KAAO/D,EAAS+D,IAC9CrG,KAAKglB,SAASzE,OAAOje,EAAS+D,IAGzBxG,eAAeC,EAAWC,GAC/B,OAAOC,KAAKK,IAAIP,GAAGC,GAAG+K,iBAGjBjL,gBAAgBC,EAAWC,GAChC,OAAOC,KAAKK,IAAIP,GAAGC,GAAGkiB,kBAGjBpiB,QAAQC,EAAWC,EAAWY,GACnCX,KAAKK,IAAIP,GAAGC,GAAKY,EAGZd,YAAYqlB,EAAsBpO,GACvC,IAAIqO,EAWJ,GATAnlB,KAAKilB,KAAK,CAACtkB,EAAMb,EAAGC,MACdY,aAAgBsG,GAAgBtG,aAAgBwG,IAC9CxG,EAAKqG,gBAAkBke,IACzBvkB,EAAKmW,SAAWA,EAChBqO,EAAW,IAAIvlB,EAAME,EAAGC,MAK1BolB,EACF,OAAOA,EAGT,iBAAkBnlB,KAAKtC,iCAAiCwnB,MPtG5D,SAAYjC,GACVA,IAAA,iBACAA,IAAA,eACAA,IAAA,qBACAA,IAAA,mBAJF,CAAYA,mBAaCmC,GAAbvlB,cACSG,KAAAqlB,YAEAxlB,QACLG,KAAKqlB,YAGAxlB,YAAYma,EAAgB7T,EAAiBqQ,GAClDxW,KAAKslB,SAAS9O,EAAO9Y,YAAYsc,iBAAsB7T,EAAMzI,QAGxDmC,YAAYma,EAAgB7T,EAAiBqQ,GAClDxW,KAAKulB,WACA/O,EAAO9Y,YAAYsc,iBACpB7T,EAAMzI,2BAKLmC,YAAYsG,EAAiBqQ,GAClCxW,KAAKslB,SAASnf,EAAMzI,eAAe8Y,EAAO9Y,SAGrCmC,iBAAiBsG,EAAiBqQ,EAAkBH,GACzDrW,KAAKslB,SACAnf,EAAMzI,eAAe2Y,EAAQ3Y,WAAW8Y,EAAO9Y,qBAI/CmC,iBACLma,EACA7T,EACAqQ,EACAH,GAEArW,KAAKulB,WACA/O,EAAO9Y,YAAYsc,iBAAsB7T,EAAMzI,WAChD2Y,EAAQ3Y,2BAKPmC,iBACLma,EACA7T,EACAqQ,EACAH,GAEArW,KAAKslB,SACA9O,EAAO9Y,YAAYsc,iBAAsB7T,EAAMzI,WAChD2Y,EAAQ3Y,QAKPmC,oBACLG,KAAKwlB,WAAWvC,GAASwC,MAAO,uBAG3B5lB,cACLG,KAAKwlB,WAAWvC,GAASwC,MAAO,+BAG3B5lB,kBACLG,KAAKwlB,WAAWvC,GAASwC,MAAO,qCAG3B5lB,QAAQiE,GACb9D,KAAKwlB,WAAWvC,GAASwC,sBAAuB3hB,EAAKpG,QAGhDmC,MAAMiE,GACX9D,KAAKwlB,WAAWvC,GAASwC,oBAAqB3hB,EAAKpG,QAG9CmC,MAAMiE,GACX9D,KAAKwlB,WAAWvC,GAASyC,kBAAmB5hB,EAAKpG,QAG5CmC,oBACLG,KAAKwlB,WAAWvC,GAASwC,MAAO,kCAG3B5lB,oBACLG,KAAKwlB,WAAWvC,GAASwC,MAAO,+BAG3B5lB,mBACLG,KAAKwlB,WAAWvC,GAAS0C,OAAQ,wBAG5B9lB,sBAAsByC,GAC3BtC,KAAKwlB,WAAWvC,GAAS0C,UAAWrjB,EAAS5E,2BAGxCmC,iBAAiBsG,GACtBnG,KAAKwlB,WACHvC,GAASwC,SACNtf,EAAMzI,iDAINmC,iBAAiBsG,GACtBnG,KAAKwlB,WACHvC,GAASwC,0BACWtf,EAAMzI,gCAIvBmC,oBAAoB2W,GACzBxW,KAAKwlB,WAAWvC,GAASwC,0BAA2BjP,EAAO9Y,QAGtDmC,oBAAoB2W,GACzBxW,KAAKwlB,WAAWvC,GAASyC,QAASlP,EAAO9Y,wBAGpCmC,mBAAmBsG,GACxBnG,KAAKwlB,WAAWvC,GAASyC,QAASvf,EAAMzI,cAGnCmC,sBAAsBsG,GAC3BnG,KAAKwlB,WACHvC,GAASyC,QACNvf,EAAMzI,gDAINmC,gCAAgCsG,GACrCnG,KAAKwlB,WACHvC,GAASyC,QACNvf,EAAMzI,wDAINmC,4BACLG,KAAKwlB,WAAWvC,GAASyC,KAAM,2CAG1B7lB,mBACLG,KAAKwlB,WAAWvC,GAASyC,KAAM,6CAG1B7lB,sBACLG,KAAKwlB,WACHvC,GAASyC,KACT,mDAIG7lB,gCACLG,KAAKwlB,WAAWvC,GAASyC,KAAM,uCAG1B7lB,gCACLG,KAAKwlB,WACHvC,GAASyC,KACT,qDAIG7lB,eACLG,KAAKwlB,WAAWvC,GAASyC,KAAM,uCAG1B7lB,aAAaiE,EAAYI,GAChB,IAAVA,EACFlE,KAAKwlB,WAAWvC,GAASyC,sBAAuB5hB,EAAKpG,QAErDsC,KAAKwlB,WAAWvC,GAASyC,sBAAuBxhB,KAASJ,EAAKpG,QAI3DmC,YAAYiE,EAAYI,GACf,IAAVA,EACFlE,KAAKwlB,WAAWvC,GAASyC,sBAAuB5hB,EAAKpG,QAErDsC,KAAKwlB,WAAWvC,GAASyC,oBAAqBxhB,KAASJ,EAAKpG,QAIzDmC,MAAMmI,GACXhI,KAAKwlB,WAAWvC,GAASwC,MAAOzd,GAG3BnI,KAAKmI,GACVhI,KAAKwlB,WAAWvC,GAASyC,KAAM1d,GAG1BnI,QAAQmI,GACbhI,KAAKwlB,WAAWvC,GAAS2C,QAAS5d,GAG7BnI,OAAOmI,GACZhI,KAAKwlB,WAAWvC,GAAS0C,OAAQ3d,GAGzBnI,WAAWuY,EAAiBpQ,GACpC,MAAM6d,EAAkC7pB,OAAAoI,EAAA,KAAApI,CAAKgE,KAAKqlB,UAE9CQ,GAAWA,EAAQ7d,UAAYA,EACjC6d,EAAQC,SAAW,EAEnB9lB,KAAKqlB,SAAStpB,MAAOqc,QAAOpQ,UAAS8d,QAAS,WQpN9BC,GASpBlmB,YACS+C,EACAojB,GADAhmB,KAAA4C,SACA5C,KAAAgmB,mBAVFhmB,KAAAiI,OAAiB,IAAImd,GAErBplB,KAAAkU,GAAsB,KACtBlU,KAAAimB,SAAmB,EACnBjmB,KAAA+E,OAA4B,KAEzB/E,KAAAkmB,KAAiD,IAAI/gB,IAOxDtF,OACL,KAAIG,KAAKimB,SAAYjmB,KAAKkU,KAAOlU,KAAK+E,QAAtC,CAKA,GAFA/E,KAAKimB,SAAU,GAEVjmB,KAAK+G,WACR,KAAM,iCAGR,GAAI/G,KAAK+E,OACP/E,KAAK4C,OAAO4V,cAAcxY,KAAK+G,YAC/B/G,KAAK+E,OAAO6Z,YAAY5e,KAAK4C,OAAO0N,YAAYtQ,KAAK+G,aAEjD/G,KAAK+E,OAAO4Z,SACd3e,KAAK+E,OAAOyZ,SACZxe,KAAK+E,OAAS,MAGhB/E,KAAKimB,SAAU,MACV,CACL,MAAQjmB,KAAK4C,OAAOkL,OAAS9N,KAAKkU,IAChClU,KAAKmmB,eAGPnmB,KAAK4C,OAAO4V,cAAcxY,KAAK+G,YAGjC/G,KAAKimB,SAAU,GAGVpmB,OAAOwG,GACZ,MAAM3D,EAAW1C,KAAKkmB,KAAKnoB,IAAIsI,GAE/B,IAAK3D,EACH,oBAAqB2D,iBAGvB,GAAI3D,aAAoBoiB,GACtB,OAAOpiB,EACF,GAAIA,aAAoB0jB,SAAU,CACvC,MAAMC,EAAgB3jB,EAAS2D,EAAIrG,MAEnC,OADAA,KAAKkmB,KAAKpgB,IAAIO,EAAIggB,GACXA,EAEP,yBAA0BhgB,iBAIvBxG,OAAOwG,EAAgBigB,GAE5BtmB,KAAKkmB,KAAKpgB,IAAIO,EAAIigB,GAGZzmB,eAEN,IAAKG,KAAK+G,WACR,KAAM,iCAGR,IAAIie,EAAWhlB,KAAK+G,WAAWie,SAC7B3kB,EAAML,KAAK+G,WAEb,MAAMwf,EAAUvB,EAAST,OAEzB,QAAgBpgB,IAAZoiB,EACF,KAAM,2BAGR,MAAMpgB,EAAQ9F,EAAI0kB,UAAUhhB,KAAKzB,GAAYikB,IAAYjkB,EAAS+D,IAElE,GAAIF,EAAO,CACT,MAAMoI,EAAQpI,EAAMiM,IAAI/R,EAAKL,MAGzBuO,GAASlO,EAAI0kB,UAAUhhB,KAAKzB,GAAYikB,IAAYjkB,EAAS+D,KAC/D2e,EAAS1kB,IAAIimB,EAAShY,WC9FRiY,GAGpB3mB,YAEkB2b,EAEAmF,EACTtB,GAHSrf,KAAAwb,SAEAxb,KAAA2gB,gBACT3gB,KAAAqf,YAPFrf,KAAAtC,KAAe,gBAUfmC,cAAc2f,GACnB,OAAOA,EAAUiH,QAAQC,OAAOC,GAAa3mB,KAAK0W,MAAMiQ,EAAU7iB,OAG7DjE,MAAMiE,EAAYI,GACvB,GAAIlE,KAAKqf,UACP,aAAcrf,KAAKtC,iCAAiCsC,KAAKqf,UAAUvb,OAGrE9D,KAAKqf,WAAcnb,QAAOJ,QAGrBjE,UACL,IAAKG,KAAKqf,UACR,aAAcrf,KAAKtC,+BAGrBsC,KAAKqf,eAAYlb,EAGTtE,MAAMiE,GACd,OAAO9H,OAAAoI,EAAA,aAAApI,CAAa8H,EAAK0X,OAAQxb,KAAKwb,QAAQ3f,OAAS,EAG/CgE,aACR+mB,EACA9iB,GAEA,OAAO8iB,EAAUF,OAAOniB,GAAeA,EAAYT,KAAK+iB,UAAU/iB,WAIzDgjB,WAAsBN,GAEjC3mB,cACE4B,OAAO6V,GAAM6E,gBAAgB,GAFxBnc,KAAAtC,KAAe,qBAMXqpB,WAAqBP,GAEhC3mB,cACE4B,OAAO6V,GAAM6E,gBAAgB,GAFxBnc,KAAAtC,KAAe,oBAMXspB,WAAiBR,GAE5B3mB,cACE4B,OAAO6V,GAAM2P,cAAc,GAFtBjnB,KAAAtC,KAAe,gBAMXwpB,WAAkBV,GAE7B3mB,cACE4B,OAAO6V,GAAMgF,cAAc,GAFtBtc,KAAAtC,KAAe,gBAMXypB,WAAmBX,GAE9B3mB,cACE4B,OAAO6V,GAAM8P,SAAS,GAFjBpnB,KAAAtC,KAAe,kBAMX2pB,WAAsBb,GAEjC3mB,cACE4B,OAAO6V,GAAMgQ,YAAY,GAFpBtnB,KAAAtC,KAAe,gBAMX6pB,WAAiBf,GAE5B3mB,cACE4B,OAAO6V,GAAMkQ,OAAO,GAFfxnB,KAAAtC,KAAe,cAMX+pB,WAAkBjB,GAE7B3mB,cACE4B,OAAO6V,GAAMiF,QAAQ,GAFhBvc,KAAAtC,KAAe,iBAMXgqB,WAAmBlB,GAE9B3mB,cACE4B,OAAO6V,GAAMqQ,SAAS,GAFjB3nB,KAAAtC,KAAe,gBAMXkqB,WAAuBpB,GAElC3mB,cACE4B,OAAO6V,GAAMuQ,OAAO,GAFf7nB,KAAAtC,KAAe,qBAMXoqB,WAAwBtB,GAEnC3mB,cACE4B,OAAO6V,GAAMuQ,OAAO,GAFf7nB,KAAAtC,KAAe,sBAMXqqB,WAAkBvB,GAE7B3mB,cACE4B,OAAO6V,GAAM0Q,QAAQ,GAFhBhoB,KAAAtC,KAAe,cAMXuqB,WAA0BzB,GAErC3mB,cACE4B,OAAO6V,GAAMyE,QAAQ,GAFhB/b,KAAAtC,KAAe,cAKfmC,cAAc2f,GACnB,IAAIoH,EAAYnlB,MAAMymB,cAAc1I,GAClCnJ,EAAUmJ,EAAUU,YAAYb,UAElC,OAAIhJ,EACKrW,KAAKmoB,aAAavB,EAAWvQ,EAAQvS,MAGvC8iB,SAIEwB,WAAoB5B,GAE/B3mB,cACE4B,OAAO6V,GAAM+Q,QAAQ,GAFhBroB,KAAAtC,KAAe,UAKfmC,cAAc2f,GACnB,IAAIoH,EAAYpH,EAAUiH,QACxB6B,EAAgB9I,EAAU+I,kBAAkBlJ,UAE9C,OAAIiJ,EACKtoB,KAAKmoB,aAAavB,EAAW0B,EAAcxkB,MAG7C8iB,SAIE4B,WAAkBhC,GAE7B3mB,cACE4B,OAAO6V,GAAMmR,OAAO,GAFfzoB,KAAAtC,KAAe,oBCnJXgrB,GAAb7oB,cACUG,KAAA2oB,IAAwB,IAAI/kB,EAE7B5D,KAAA4oB,SAAW,IAAI5B,GACfhnB,KAAA6oB,WAAa,IAAInB,GACjB1nB,KAAA8oB,UAAY,IAAIf,GAChB/nB,KAAA+oB,UAAY,IAAI7B,GAChBlnB,KAAAgpB,cAAgB,IAAIlC,GACpB9mB,KAAAipB,aAAe,IAAIlC,GACnB/mB,KAAAkpB,eAAiB,IAAItB,GACrB5nB,KAAAmpB,gBAAkB,IAAIrB,GACtB9nB,KAAAopB,WAAa,IAAIjC,GACjBnnB,KAAAqpB,cAAgB,IAAIhC,GACpBrnB,KAAAspB,SAAW,IAAI/B,GACfvnB,KAAAupB,UAAY,IAAI9B,GAChBznB,KAAAuoB,kBAAoB,IAAIN,GACxBjoB,KAAAkgB,YAAc,IAAIkI,GAClBpoB,KAAAwpB,UAAY,IAAIhB,GAEhB3oB,QACL,OACEG,KAAK4oB,SACL5oB,KAAK6oB,WACL7oB,KAAK8oB,UACL9oB,KAAK+oB,UACL/oB,KAAKgpB,cACLhpB,KAAKipB,aACLjpB,KAAKkpB,eACLlpB,KAAKmpB,gBACLnpB,KAAKopB,WACLppB,KAAKqpB,cACLrpB,KAAKspB,SACLtpB,KAAKupB,UACLvpB,KAAKuoB,kBACLvoB,KAAKkgB,YACLlgB,KAAKwpB,WAITC,eACE,OAAOztB,OAAAoI,EAAA,OAAApI,CACLgE,KAAKymB,QACLzqB,OAAAoI,EAAA,QAAApI,CAAQgE,KAAK0pB,QAAQrpB,IAAI+e,GAAQA,EAAKC,aAI1CsK,0BACE,OACE3pB,KAAK4oB,SACL5oB,KAAK+oB,UACL/oB,KAAKopB,WACLppB,KAAKqpB,cACLrpB,KAAKspB,SACLtpB,KAAKupB,WACL7C,OAAQtH,IAAyBA,EAAKC,WAAWxjB,OAG9CgE,QACL,OAAOG,KAAK2oB,IAAI9kB,MAGXhE,UAAUiE,GACf,OAAO9D,KAAK2oB,IAAI5kB,KAAKD,GAGhBjE,SAASiE,EAAYI,GAC1BlE,KAAK2oB,IAAInkB,IAAIV,EAAMI,GAGdrE,cAAciE,EAAYI,GAC/BlE,KAAK2oB,IAAIpI,OAAOzc,EAAMI,UCvFb0lB,GAMX/pB,YAAmBc,GAAAX,KAAAW,OALZX,KAAA2K,SAAmB,EACnB3K,KAAA+K,OAAiB,EACjB/K,KAAA8T,MAAgB,EAKvB7N,YACE,OAAOjG,KAAKW,KAAKsF,MAGnB3D,eACE,OAAOtC,KAAKW,KAAK2B,SAGZzC,IAAIc,EAAYoK,GACrB/K,KAAK2K,SAAU,EACf3K,KAAK+K,OAASA,EACd/K,KAAK8T,MAAO,EACZ9T,KAAKW,KAAOA,EAAK4F,QAGZ1G,SAASsG,GACd,OAAOnG,KAAK8T,OAAS9T,KAAKW,KAAKshB,gBAAgB9b,GAG1CtG,QACLG,KAAK2K,SAAU,EACf3K,KAAK+E,YAASZ,EACdnE,KAAKW,KAAK2B,cAAW6B,EAGhBtE,MAAM2G,GACXxG,KAAKW,KAAKkK,MAAMrE,UAIPmI,WAAepO,EAC1BV,YAAYL,EAAeC,GACzB,MAAMoqB,EAAW,IAAIzjB,EACrB3E,MAAMlC,EAAYC,EAAOC,EAAQ,IAAM,IAAImqB,GAAWC,KAGjDhqB,eACLG,KAAKilB,KAAKtkB,GAAQA,EAAKkP,gBCtCdia,WAAenc,EAmB1B9N,YACSuY,EACAlE,EACPrH,EACAkd,EACAC,GAEAvoB,MAAMoL,GANC7M,KAAAoY,QACApY,KAAAkU,KApBFlU,KAAAiqB,eACAjqB,KAAAwf,UAAuB,IAAIkJ,GAE3B1oB,KAAA2f,oBACA3f,KAAA8f,gBACA9f,KAAAkqB,oBAsBLlqB,KAAKwM,SAAW,IAAIU,EAAa6c,GACjC/pB,KAAK+L,UAAY,IAAII,EAAK,GAC1BnM,KAAKyM,aAAe,IAAIN,EAAK6d,GAC7BhqB,KAAKmqB,aAAe,IAAIhe,EAAK,GAC7BnM,KAAKoqB,OAAS,IAAIje,EAAK,GACvBnM,KAAKqqB,SAAW,IAAIle,EAAK,GAEzBnM,KAAKkD,YAAc,IAAIiJ,EAAK,GAC5BnM,KAAKoD,iBAAmB,IAAImJ,EAC1BvM,KAAKwM,SAASrJ,QACdnD,KAAKyM,aAAatJ,SAIftD,IAAI6C,EAAoBC,GAC7B3C,KAAKsqB,YACLtqB,KAAKyO,WAAW/L,GAEhB,MAAM6nB,EAAUvqB,KAAKkU,GAAG9B,IAAIpS,KAAM0C,EAAUC,GAM5C,OALI4nB,GACFvqB,KAAKQ,GAAG+pB,GAEVvqB,KAAKQ,GAAG,IAAIiC,EAAWC,EAAUC,IAE1B3C,KAAKuO,MAGP1O,cAAc6C,GACnB1C,KAAKyO,WAAW/L,GAGX7C,GAAGyO,GACR,OAAOA,EAAMkc,aAAaxqB,MAG5BqW,cACE,OAAOrW,KAAKwf,UAAUU,YAAYb,UAGpC3C,qBACE,OAAO1c,KAAKwf,UAAUiK,SAGjB5pB,QAAQiE,EAAYI,GACzBlE,KAAKwf,UAAUC,SAAS3b,EAAMI,GAGzBrE,WAAWiE,EAAYI,GAC5BlE,KAAKwf,UAAUiL,cAAc3mB,EAAMI,GAGrCiK,cACE,MAAMuc,EAAqB1qB,KAAKwM,SAASW,gBAEzC,OAAOnR,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK6M,OAAOsB,QAASnO,KAAK8f,cAAczf,IACnD2Z,IACC,IAAI2Q,EAAM3uB,OAAAoI,EAAA,UAAApI,CAAUge,GAEpB,OADA2Q,EAAIre,OAASoe,EACNC,IAKbzc,kBAEE,OAAOlS,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK6M,OAAOqB,YAAalO,KAAK2f,mBAExCra,KAAMmS,GAAe2D,UACrBjd,MAJsB,EAIK6B,KAAKwf,UAAUmK,uBAKhDta,kBACE,OAAOrT,OAAAoI,EAAA,OAAApI,CAAOgE,KAAK6M,OAAOwC,YAAarP,KAAKkqB,yBC7GnCU,GAIX/qB,YACkBwG,EACA3I,EACT0a,EAAgB,EAChByS,EAAiB,GAHR7qB,KAAAqG,KACArG,KAAAtC,OACTsC,KAAAoY,QACApY,KAAA6qB,SAPF7qB,KAAA8qB,WACS9qB,KAAA+qB,UAAoB,SAUzBC,GACXnrB,YACUokB,EACAgH,EACAC,GAFAlrB,KAAAikB,OACAjkB,KAAAirB,WACAjrB,KAAAkrB,WAGHrrB,UAAU+C,GACf,IACIuoB,EADAlB,KA6BJ,OA1BIjqB,KAAKorB,UAAUxoB,GACjBuoB,EAAmBnrB,KAAKqrB,oBAAoBzoB,GACnC5C,KAAKsrB,qBAAqB1oB,KACnCuoB,EAAmBnrB,KAAKurB,YAAY3oB,SAGbuB,IAArBgnB,GACFlB,EAAYluB,KAAKovB,GAGfnrB,KAAKsrB,qBAAqB1oB,GAC5BuoB,EAAmBnrB,KAAKurB,YACtB3oB,EACAuoB,GAAoBA,EAAiB9kB,IAE9BrG,KAAKorB,UAAUxoB,KACxBuoB,EAAmBnrB,KAAKqrB,oBACtBzoB,EACAuoB,GAAoBA,EAAiB9kB,UAIhBlC,IAArBgnB,GACFlB,EAAYluB,KAAKovB,GAGZlB,EAGCpqB,UAAU+C,GAClB,OAAOA,EAAOqnB,YAAYuB,KACxBC,GAAcA,EAAWrT,MAAQpY,KAAKirB,UAIhCprB,oBACR+C,EACA8oB,GAEA,OAAO1vB,OAAAoI,EAAA,OAAApI,CACL4G,EAAOqnB,YAAYvD,OAAO+E,GACjBC,IAAcD,EAAWplB,KAK5BxG,qBAAqB+C,GAC7B,OACEA,EAAOqnB,YAAYpuB,OAASmE,KAAKkrB,UACjClrB,KAAKikB,KAAKpoB,OAAS+G,EAAOqnB,YAAYpuB,OAIhCgE,YACR+C,EACA8oB,GAEA,MAAMC,EAAY/oB,EAAOqnB,YAAY5pB,IAAIorB,GAAcA,EAAWplB,IAMlE,YAJkBlC,IAAdunB,GACFC,EAAU5vB,KAAK2vB,GAGV1vB,OAAAoI,EAAA,OAAApI,CACLgE,KAAKikB,KAAKyC,OAAO+E,IAAezvB,OAAAoI,EAAA,SAAApI,CAAS2vB,EAAWF,EAAWplB,QZ1FrE,SAAY6c,GACVA,IAAA,yBACAA,IAAA,yBACAA,IAAA,6BAHF,CAAYA,mBAMU0I,GACpB/rB,YACkBwG,EACA3I,EACAmuB,EACTC,EACSC,EACAC,GALAhsB,KAAAqG,KACArG,KAAAtC,OACAsC,KAAA6rB,QACT7rB,KAAA8rB,OACS9rB,KAAA+rB,UACA/rB,KAAAgsB,qBaNPC,WAAkB5kB,EAC7BxH,YAAYyH,GAAoB,GAC9B7F,MAAM6F,EAAU5C,EAASyW,OAGpBtb,OAAOgJ,EAAYnG,EAAoBC,GAC5CA,EAAKsF,OAAOikB,eAGJrsB,WACR,OAAO,IAAIosB,GAAUjsB,KAAKsH,UAGlBzH,OAAO8C,EAAYD,EAAoBJ,GAC/CA,EAAS9B,GACP,IAAI2hB,GACFniB,KACAA,KAAKsH,SAAW,EAAI,GACpB5E,EACAC,EACA,CAAC4f,EAAM4J,KAEDA,EACFxpB,EAAKsF,OAAOmkB,gCACH7J,GACT5f,EAAKsF,OAAOokB,gCAAgC/pB,IAGhD,CAACigB,EAAM4J,IACE7pB,EAAS9B,GACd,IAAIsY,GAAehW,EAAWoM,MAAO,OAAQvM,EAAM,cChClD2pB,WAA0BjlB,EACrCxH,YAAYyH,GAAoB,GAC9B7F,MAAM6F,EAAU5C,EAAS6nB,eAGpB1sB,OAAOgJ,EAAYnG,EAAoBC,GAC5CA,EAAKsF,OAAOikB,eAGJrsB,WACR,OAAO,IAAIysB,GAAkBtsB,KAAKsH,UAG1BzH,OAAO8C,EAAYD,EAAoBJ,GAC/CA,EAAS9B,GACP,IAAI2hB,GACFniB,KACAA,KAAKsH,SAAW,EAAI,GACpB5E,EACAC,EACA,CAAC4f,EAAM4J,KACDA,EACFxpB,EAAKsF,OAAOmkB,gCACH7J,GACT5f,EAAKsF,OAAOokB,gCAAgC/pB,IAGhD,CAACigB,EAAM4J,IACE7pB,EAAS9B,GAAG,IAAI4gB,GAAmB1e,EAAUC,GAAM,aCfvD6pB,WAA2B9U,GAItC7X,YAAY6C,EAAoBC,GAC9BlB,MAAM2V,GAAc5J,UAAW9K,EAAUC,GAJpC3C,KAAAysB,aACCzsB,KAAA0sB,UAAoB,EAI1B1sB,KAAK2sB,mBAGA9sB,QAAQ+sB,GACb5sB,KAAK4C,OAAOpC,GAAG,IAAI2e,GAAiByN,EAASC,cAAe7sB,KAAK2C,OACjE3C,KAAK0sB,UAAW,EAChB1sB,KAAK2sB,mBAGA9sB,MAAM+sB,GACX5sB,KAAK6X,SACH,IAAIiV,GACFnG,IACE3mB,KAAK4C,OAAOpC,GACV,IAAIggB,GACFoM,EAASC,cACTlG,EAAU7iB,KACV9D,KAAK2C,OAIT3C,KAAK0sB,UAAW,EAChB1sB,KAAK2sB,mBACL3sB,KAAK6X,SAAS7X,OAEhB4sB,EAASG,eACT/sB,KAAK0C,SACL1C,KAAK2C,OAKJ9C,QACDG,KAAK0sB,SACP1sB,KAAK2X,UAEL3X,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,OAIhD9C,mBACNG,KAAKysB,UAAYzsB,KAAK4C,OAAO4c,UAAUkK,QAAQrpB,IAAIwsB,KAE/CA,cAAeA,EACf/oB,KAAM+oB,EAAcxN,WAAawN,EAAcxN,UAAUvb,KACzDI,MAAO2oB,EAAcxN,WAAawN,EAAcxN,UAAUnb,MAC1D6oB,eAAgBF,EAAc3E,cAAcloB,KAAK4C,OAAO4c,qBClEnDwN,WAAyBtV,GAOpC7X,YAAY6C,EAAoBC,GAC9BlB,MAAM2V,GAAcyE,QAASnZ,EAAUC,GALjC3C,KAAAitB,sBAAuC9oB,EACvCnE,KAAAsS,WACAtS,KAAA2R,QAKN3R,KAAKktB,cACLltB,KAAK+I,OAAS/I,KAAK4C,OAAO0N,YAAYtQ,KAAK0C,UAC3C1C,KAAKmtB,UAAYntB,KAAKotB,gBAGjBvtB,kBACyBsE,IAA1BnE,KAAKitB,kBAKTjtB,KAAKitB,kBAAoB,EAErBjtB,KAAKitB,kBAAoBjtB,KAAKsS,QAAQzW,SACxCmE,KAAKitB,iBAAmB,GAG1BjtB,KAAKqtB,aAAartB,KAAKsS,QAAQtS,KAAKitB,oBAVlCjtB,KAAKotB,gBAaFvtB,sBACyBsE,IAA1BnE,KAAKitB,kBAKTjtB,KAAKitB,kBAAoB,EAErBjtB,KAAKitB,iBAAmB,IAC1BjtB,KAAKitB,iBAAmBjtB,KAAKsS,QAAQzW,OAAS,GAGhDmE,KAAKqtB,aAAartB,KAAKsS,QAAQtS,KAAKitB,oBAVlCjtB,KAAKotB,gBAaFvtB,WAAWytB,GAChB,MAAMnd,EAAOnQ,KAAKmtB,UAAU7sB,IAAIgtB,GACvBttB,KAAK0C,SAASkI,GAAGuF,EAAKrQ,EAAGqQ,EAAKpQ,GAGhC+K,kBACL9K,KAAK4C,OAAO0N,YAAYtQ,KAAK0C,UAAUkI,GAAGuF,EAAKrQ,EAAGqQ,EAAKpQ,GAAG4K,UAE1D3K,KAAKqtB,aAAald,GAClBnQ,KAAKitB,sBAAmB9oB,GAIrBtE,SACAG,KAAKmtB,UAAUjd,GAAGlQ,KAAK0C,SAASmF,YAAY7H,KAAK4C,UACpD5C,KAAK4C,OAAOpC,GACV,IAAIwV,GAAmBhW,KAAK2R,KAAM3R,KAAK2C,KAAM3C,KAAK0C,SAAU,IAC1D1C,KAAK2X,YAMN9X,QACLG,KAAKutB,YACLvtB,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,OAG9C9C,gBACN,IAAII,EAWJ,OATID,KAAKsS,QAAQzW,QACfmE,KAAKitB,iBAAmB,EACxBhtB,EAAQD,KAAKsS,QAAQtS,KAAKitB,oBAE1BjtB,KAAKitB,sBAAmB9oB,EACxBlE,EAAQD,KAAK0C,SAASmF,YAAY7H,KAAK4C,SAGzC5C,KAAKqtB,aAAaptB,GACXA,EAGDJ,YACNG,KAAK2R,KAAKlR,QAAQ,EAAGX,IAAGC,OAASC,KAAK+I,OAAO6B,GAAG9K,EAAGC,GAAGgF,YAASZ,GAGzDtE,aAAa2tB,GACnBxtB,KAAKutB,YACLvtB,KAAKmtB,UAAYK,EAAOC,OACxBztB,KAAK0tB,WAGC7tB,WACNG,KAAK2R,QACL,IAAIgc,GAAO,EACX,MAAMjjB,EAAQ1K,KAAK0C,SACjBmG,EAAM7I,KAAK0C,SAASmF,YAAY7H,KAAK4C,QAEvCrB,EAAmBsH,EAAK7I,KAAKmtB,UAAW,CAACrtB,EAAGC,KACrC2K,EAAME,GAAG9K,EAAGC,GAAGkiB,oBAClB0L,GAAO,GAGT3tB,KAAK2R,KAAK5V,KAAK,IAAI6D,EAAME,EAAGC,IAC5BC,KAAK+I,OAAO6B,GAAG9K,EAAGC,GAAGgF,OAAS4oB,EAAO,IAAM,MAIvC9tB,cACNG,KAAKsS,WAELtS,KAAK4C,OAAO0N,YAAYtQ,KAAK0C,UAAUuiB,KAAK,CAACtkB,EAAMb,EAAGC,KAElDY,EAAKgK,SACLhK,EAAK2B,UACL3B,EAAK2B,SAAS+D,KAAOrG,KAAK4C,OAAOyD,IAEjCrG,KAAKsS,QAAQvW,KAAK,IAAI6D,EAAME,EAAGC,aC7H1B6tB,WAA0ClW,GACrD7X,YACSguB,EACPnrB,EACAC,EACQmrB,GAERrsB,MAAM2V,GAAc2W,iBAAkBrrB,EAAUC,GALzC3C,KAAA6tB,UAGC7tB,KAAA8tB,aAKHjuB,KAAKmuB,GACVhuB,KAAK8tB,WAAWE,GAGXnuB,QACLG,KAAKiuB,gBCQHC,WAA0B/lB,EAI9BtI,YACS+sB,EACCjqB,EACAD,EACAE,GAERnB,QALOzB,KAAA4sB,WACC5sB,KAAA2C,OACA3C,KAAA0C,WACA1C,KAAA4C,SANH5C,KAAAmuB,YAWGtuB,WAAW0I,GAGnB,MAAMqO,EAAc5W,KAAK2C,KAAKkU,OAAOtO,EAASvB,eAC9CuB,EAASuO,SAAWF,EAAYG,YAC9B/W,KAAK0C,SAAS2D,GACdrG,KAAK0C,SAASmF,YAAY7H,KAAK4C,SAGjC5C,KAAKmuB,SAASpyB,MACZ,WACA,IAAIyT,EAAUxP,KAAK2C,KAAM3C,KAAK0C,SAAU6F,EAASuO,SAAUF,KAIxD/W,OAAO8I,GACPA,EAAKrB,UAIVtH,KAAKmuB,SAASpyB,MACZ,SACA,IAAI0mB,GAAYziB,KAAK4sB,SAAUjkB,EAAM3I,KAAK0C,SAAU1C,KAAK2C,eAKzDyrB,WAAgCF,GAC1BruB,qBAGCiY,WAAsBJ,GACjC7X,YAAY6C,EAAoBC,GAC9BlB,MAAM2V,GAAciX,KAAM3rB,EAAUC,GAG/B9C,mBACLG,KAAK6X,SAAS,IAAI2U,GAAmBxsB,KAAK0C,SAAU1C,KAAK2C,OAGpD9C,aACLG,KAAK6X,SAAS,IAAIyW,GAAatuB,KAAK0C,SAAU1C,KAAK2C,OAG9C9C,cACLG,KAAK4C,OAAOpC,GAAG,IAAI0W,GAAUlX,KAAK0C,WAClC1C,KAAK2X,UAGA9X,cACLG,KAAK6X,SAAS,IAAI0W,GAAmBvuB,KAAK0C,SAAU1C,KAAK2C,OAGpD9C,eACLG,KAAK6X,SAAS,IAAI2W,GAAexuB,KAAK0C,SAAU1C,KAAK2C,OAGhD9C,cACLG,KAAK6X,SAAS,IAAI4W,GAAczuB,KAAK0C,SAAU1C,KAAK2C,OAG/C9C,KAAKytB,GACV,MACEnd,EADUnQ,KAAK0C,SAASmF,YAAY7H,KAAK4C,QAC9BtC,IAAIgtB,GACf3sB,EAAOX,KAAK0C,SAASkI,GAAGuF,EAAKrQ,EAAGqQ,EAAKpQ,GAEnCY,EAAKshB,gBAAgBjiB,KAAK4C,QAC5B5C,KAAK4C,OAAOpC,GAAG,IAAIgP,EAAUxP,KAAK2C,KAAM3C,KAAK0C,SAAUyN,IAC9CxP,EAAK2B,SACdtC,KAAK4C,OAAOpC,GAAG,IAAI0R,GAAYvR,EAAK2B,SAAUtC,KAAK0C,SAAU1C,KAAK2C,QAElE3C,KAAK2C,KAAKsF,OAAOymB,oBACjB1uB,KAAK4C,OACF0N,YAAYtQ,KAAK0C,UACjBkI,GAAGuF,EAAKrQ,EAAGqQ,EAAKpQ,GAChBiL,IAAIrK,EAAM,IAGfX,KAAK2X,UAGA9X,gBACL,MAAMc,EAAOX,KAAKW,KAChBsF,EAAQtF,EAAKsF,WAED9B,IAAV8B,GAA8C,IAAvBA,EAAMpC,MAAMhI,OACrCmE,KAAK2C,KAAKsF,OAAO0mB,kBACe,IAAvB1oB,EAAMpC,MAAMhI,QACrBmE,KAAK4C,OAAOpC,GAAG,IAAI4T,GAAiBzT,EAAMsF,EAAMpC,MAAO7D,KAAK2C,OAC5D3C,KAAK2X,WAEL3X,KAAK6X,SAAS,IAAI+W,GAAgB5uB,KAAK0C,SAAU1C,KAAK2C,OAInD9C,iBACL,MAAMwW,EAAUrW,KAAK4C,OAAO4c,UAAUU,YAAYb,UAE9ChJ,GAAWA,EAAQvS,KACjBuS,EAAQvS,KAAK+qB,SAAS7uB,KAAK4C,QAC7B5C,KAAK6X,SAAS,IAAImV,GAAiBhtB,KAAK0C,SAAU1C,KAAK2C,OAEvD3C,KAAK2C,KAAKsF,OAAO6mB,oBAGnB9uB,KAAK2C,KAAKsF,OAAO8mB,oBAIdlvB,gBACL,IAAIgJ,EAAM7I,KAAK0C,SAASmF,YAAY7H,KAAK4C,QACvCqU,EAAU,IAAIiX,GACZrlB,EACA7I,KAAK2C,KACL3C,KAAK0C,SACL1C,KAAK4C,QAEPosB,EAAgB,IAAIZ,GAClBvlB,EACA7I,KAAK2C,KACL3C,KAAK0C,SACL1C,KAAK4C,QAGT5C,KAAKW,KAAKkK,MAAMoM,GAEhBpO,EAAI+H,WAAWnQ,QAASR,IACtB+uB,EAAcpC,SAAW3sB,EACzBD,KAAK0C,SAASkI,GAAG3K,EAAMH,EAAGG,EAAMF,GAAG8K,MAAMmkB,KAG3C,MAAMb,EAAWnyB,OAAAoI,EAAA,OAAApI,CAAOib,EAAQkX,SAAUa,EAAcb,UAExD,OAAQA,EAAStyB,QACf,KAAK,EACHmE,KAAK2C,KAAKsF,OAAOgnB,cACjB,MACF,KAAK,EACHjvB,KAAK4C,OAAOpC,GAAG2tB,EAAS,GAAG,IAC3BnuB,KAAK2X,UACL,MACF,QACE3X,KAAK6X,SACH,IAAI+V,GACFO,EACAnuB,KAAK0C,SACL1C,KAAK2C,KACL,EAAEjF,EAAM6sB,MACNvqB,KAAK4C,OAAOpC,GAAG+pB,GACfvqB,KAAK2X,qBClLGuX,WAA8BxX,GAKlD7X,YAAY6C,EAAoBC,GAC9BlB,MAAM2V,GAAc+X,aAAczsB,EAAUC,GAJvC3C,KAAAysB,aACAzsB,KAAAovB,MAAgB,UAIrBpvB,KAAKqvB,gBAKAxvB,QACLG,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,cAI3C4rB,WAA2BW,GAAxCrvB,kCACSG,KAAAovB,MAAgB,gBAEbvvB,gBACRG,KAAKysB,UAAYzsB,KAAK4C,OAAO4c,UAAUiH,QAGlC5mB,YAAYoG,GACbA,EAAMpK,QACRmE,KAAK4C,OAAOpC,GAAG,IAAIwd,GAAehe,KAAKW,KAAMsF,EAAOjG,KAAK2C,OACzD3C,KAAK2X,WAEL3X,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,cAK7CmqB,WAA4BoC,GAIvCrvB,YACUyvB,EACD7C,EACP/pB,EACAC,GAEAlB,MAAMiB,EAAUC,GALR3C,KAAAsvB,aACDtvB,KAAAysB,YALFzsB,KAAAovB,MAAgB,cAChBpvB,KAAAuvB,gBAA0B,EAWvB1vB,iBAEHA,YAAYoG,IAKZpG,SAAS8mB,GACd3mB,KAAKsvB,WAAW3I,GAGX9mB,QACLG,KAAK6X,SAAS,IAAI2U,GAAmBxsB,KAAK0C,SAAU1C,KAAK2C,cAIhD2rB,WAAqBY,GAAlCrvB,kCACSG,KAAAovB,MAAgB,QAChBpvB,KAAAuvB,gBAA0B,EAEvB1vB,gBACRG,KAAKysB,UAAYzsB,KAAK4C,OAAO4c,UAAUiH,QAGlC5mB,YAAYoG,IAIZpG,SAAS8mB,GACd3mB,KAAK2X,iBChFI6W,WAAuBU,GAApCrvB,kCACSG,KAAAovB,MAAgB,cAChBpvB,KAAAuvB,gBAA0B,EAEvB1vB,gBACRG,KAAKysB,UAAYzsB,KAAK4C,OAAO4c,UAC1BiH,QACAC,OAAOC,GAAaA,EAAU7iB,KAAKyX,QAAUhE,GAAUqE,QAGrD/b,YAAYoG,IAIZpG,SAAS8mB,GACd3mB,KAAK4C,OAAOpC,GAAG,IAAImd,GAAiBgJ,EAAU7iB,KAAM9D,KAAK2C,OACzD3C,KAAK2X,iBCjBa6X,WAAwC9X,GAI5D7X,YACEyF,EACA5C,EACAC,EACQoC,EACA2R,GAERjV,MAAM6D,EAAM5C,EAAUC,GAHd3C,KAAA+E,SACA/E,KAAA0W,QAIR1W,KAAK+I,OAAS/I,KAAK4C,OAAO0N,YAAYtQ,KAAK0C,UAC3C1C,KAAKmtB,UAAYzqB,EAASmF,YAAY7H,KAAK4C,QAStC/C,MACLG,KAAKyvB,eACLzvB,KAAK0vB,QAGPC,iBACE,OAAO3vB,KAAK+I,OAAO6B,GAAG5K,KAAKmtB,UAAUrtB,EAAGE,KAAKmtB,UAAUptB,GAGlDF,WAAWytB,GAChB,MAAMnd,EAAOnQ,KAAKmtB,UAAU7sB,IAAIgtB,GAE5BttB,KAAK0W,MAAMvG,IACbnQ,KAAKqtB,aAAald,GAIdtQ,eACNG,KAAK+I,OAAO6B,GAAG5K,KAAKmtB,UAAUrtB,EAAGE,KAAKmtB,UAAUptB,GAAGgF,YAASZ,EAGtDtE,aAAa2tB,GACnBxtB,KAAKyvB,eACLzvB,KAAKmtB,UAAYK,EAAOC,OACxBztB,KAAK4vB,aAGC/vB,aACNG,KAAK2vB,WAAW5qB,OAAS/E,KAAK+E,SpBpDlC,SAAYoe,GACVA,IAAA,aACAA,IAAA,mBACAA,IAAA,mBAHF,CAAYA,mBAMCsL,WAAsBe,GAIjC3vB,YAAY6C,EAAoBC,GAC9BlB,MAAM2V,GAAcyY,KAAMntB,EAAUC,EAAM,IAAK6T,GAC7CxW,KAAK+I,OAAO4H,QAAQ6F,IAIxB4Y,YACE,OAAIpvB,KAAK2vB,WAAWhlB,QACXwY,GAAwB2M,IACtB9vB,KAAK2vB,WAAW7b,KAClBqP,GAAwB4M,OAExB5M,GAAwB6M,OAInCC,WACE,IAAI5K,KAUJ,GARIrlB,KAAK2vB,WAAWrtB,WACdtC,KAAK2vB,WAAWrtB,SAAS+D,KAAOrG,KAAK4C,OAAOyD,GAC9Cgf,EAAStpB,KAAK,SAEdspB,EAAStpB,YAAYiE,KAAK2vB,WAAWrtB,SAAS5E,SAI9CsC,KAAK2vB,WAAW1pB,MAClB,OAAQjG,KAAK2vB,WAAW1pB,MAAMpC,MAAMhI,QAClC,KAAK,EACH,MACF,KAAK,EACHwpB,EAAStpB,cAAciE,KAAK2vB,WAAW1pB,MAAMpC,MAAM,GAAGC,KAAKpG,QAC3D,MACF,QACE2nB,EAAStpB,KAAK,6BAIpB,OAAOspB,EAGCxlB,QACRG,KAAK6X,SAAS,IAAIC,GAAc9X,KAAK0C,SAAU1C,KAAK2C,cqB5C3C2V,WAA6BZ,GAGxC7X,YAA4BuY,EAAe1V,EAAoBC,GAC7DlB,MAAM2V,GAAc8Y,iBAAkBxtB,EAAUC,GADtB3C,KAAAoY,QAFZpY,KAAA6tB,WAKd7tB,KAAK6tB,QAAU7tB,KAAK4C,OAAOqnB,YAAY5pB,IAAIorB,KAEvCA,aACAX,QAASW,EAAWX,QAAQzqB,IAAI8vB,GACvBn0B,OAAOo0B,UAAWD,GACvB3b,OAAQxU,KAAKwU,OAAO2b,EAAQ1E,SAOtC2D,YACE,MAAO,kBAGFvvB,WAAWwwB,EAAsBC,GACtC,MAAM7E,EAAqCzrB,KAAK4C,OAAOqnB,YAAYlmB,KACjE0nB,GAAcA,EAAWplB,KAAOgqB,GAGlC,QAAmBlsB,IAAfsnB,EACF,2BAA4B4E,iBAG9B,IAAIF,EAA6B1E,EAAWX,QAAQ/mB,KAClDosB,GAAUA,EAAO9pB,KAAOiqB,GAG1B,QAAensB,IAAXgsB,EACF,uBAAwBG,oBACtB7E,EAAW/tB,oBAIf,GAAIsC,KAAKwU,OAAO2b,EAAQ1E,KAAgBvI,GAAaqN,UACnD,uBAAwBD,oBACtB7E,EAAW/tB,2BAIfyyB,EAAOrE,MAAQ,EACK,IAAhBqE,EAAOrE,MACTqE,EAAOK,SAASxwB,KAAK2C,MAGvB8oB,EAAWZ,QAAU,EAErB7qB,KAAK4C,OAAOpC,GAAG,IAAI2d,IAEnBne,KAAK2X,UAGC9X,OAAOswB,EAAgB1E,GAC7B,OAAI0E,EAAOrE,OAASqE,EAAOpE,QAClB7I,GAAauN,UACXN,EAAOtE,MAAQJ,EAAWV,UAAYU,EAAWZ,OACnD3H,GAAawN,YAEbxN,GAAaqN,iBCzEb9X,WAA+B+W,GAI1C3vB,YAAY6C,EAAoBC,GAC9BlB,MACE2V,GAAcmV,cACd7pB,EACAC,EACA,IACA,EAAG7C,IAAGC,OACJ2C,EAASkI,GAAG9K,EAAGC,GAAGkiB,gBAAgBjiB,KAAK4C,SACvC5C,KAAK+I,OAAO6B,GAAG9K,EAAGC,GAAG+T,MAI3Bsb,YACE,MAAO,6BAGTa,WACE,SAGQpwB,QACJG,KAAKmtB,UAAUjd,GAAGlQ,KAAK0C,SAASmF,YAAY7H,KAAK4C,SACnD5C,KAAK2C,KAAKsF,OAAO0oB,gCAEjB3wB,KAAK4C,OAAOpC,GAAG,IAAIgP,EAAUxP,KAAK2C,KAAM3C,KAAK0C,SAAU1C,KAAKmtB,YAG9DntB,KAAK2X,iBClCIiX,WAAwBM,GAArCrvB,kCACSG,KAAAovB,MAAgB,eAEbvvB,gBACR,MAAMoG,EAAQjG,KAAKW,KAAKsF,MAExB,QAAc9B,IAAV8B,EACF,KAAM,oDAGRjG,KAAKysB,UAAYxmB,EAAMpC,MAAMxD,IAAIsmB,KACtB7iB,KAAM6iB,EAAU7iB,KAAMI,MAAOyiB,EAAUziB,SAI7CrE,YAAYoG,GAEjBjG,KAAK4C,OAAOpC,GAAG,IAAI4T,GAAiBpU,KAAKW,KAAMsF,EAAOjG,KAAK2C,OAC3D3C,KAAK2X,iBChBIU,WAAmCX,GAC9C7X,YAA4BuY,EAAe1V,EAAoBC,GAC7DlB,MAAM2V,GAAcwZ,kBAAmBluB,EAAUC,GADvB3C,KAAAoY,QAI5BgX,YACE,gBAAiBpvB,KAAKoY,cAGxByV,cACE,OAAO7tB,KAAK2C,KAAKqjB,iBAAiB6K,UAAU7wB,KAAK4C,QAG5C/C,eAAesrB,GACpB,IAAI2F,EAAmB9wB,KAAK4C,OAAOqnB,YAAYlmB,KAC7C0nB,GAAcA,EAAWplB,KAAO8kB,EAAiB9kB,IAG/CyqB,EACFA,EAAiB1Y,OAAS,EAE1BpY,KAAK4C,OAAOqnB,YAAYluB,KAAKovB,GAG/BnrB,KAAK6X,SACH,IAAIS,GAAqBtY,KAAKoY,MAAOpY,KAAK0C,SAAU1C,KAAK2C,QC1B/D,MAEa0N,GAAU,SACrBhQ,EACAwI,EACA0H,EACAP,EACA+gB,GAA6B,GAE7B,IAAIzgB,EAA0B/Q,EAAYc,EAAIb,MAAOa,EAAIZ,OAAQ,KAAO,GACpEuxB,KACAvgB,GAA0B5H,GAE1B6L,EAAO,EACX,KAAOjE,EAAc5U,SAAWm1B,EAAcn1B,QAAQ,CACpD,IAAI6U,KAEJD,EAAchQ,QAASR,IACrB,IAAKI,EAAIsQ,QAAQ1Q,GACf,OAGF,MAAMU,EAAON,EAAIuK,GAAG3K,EAAMH,EAAGG,EAAMF,GAE/BwQ,EAAS5P,KAA4C,IAAnC2P,EAAYrQ,EAAMH,GAAGG,EAAMF,KAIjDuQ,EAAYrQ,EAAMH,GAAGG,EAAMF,GAAK2U,EAC5B1E,EAAY/P,EAAOU,GACrBqwB,EAAcj1B,KAAKkE,GAEnBA,EAAM2Q,WAAWnQ,QAAQoQ,GAAQH,EAAW3U,KAAK8U,OAGrD6D,IAEAjE,EAAgBC,EAGlB,GAAIsgB,EAAcn1B,OAAQ,CAExB,IAAIo1B,EAAqBj1B,OAAAoI,EAAA,OAAApI,CAAOg1B,GAChC,OACSE,GADLH,GAAqBE,EACNA,EAEAD,EAAc,GAFM1gB,GAKvC,UAIE4gB,GAAY,SAASjxB,EAAcqQ,GACvC,IAGIjP,EAHA8vB,EAAYlxB,EACZmxB,GAASD,GAIb,KA3DyB,IA2DlB7gB,EAAY6gB,EAAUrxB,GAAGqxB,EAAUpxB,IAAmB,CAW3D,QAAcoE,KAVd9C,EAAQzB,EAAMQ,IAAI2D,KACfstB,GAEG/gB,EAAY6gB,EAAUrxB,EAAIuxB,EAAGvxB,IAC7BwQ,EAAY6gB,EAAUrxB,EAAIuxB,EAAGvxB,GAAGqxB,EAAUpxB,EAAIsxB,EAAGtxB,KAC/CuQ,EAAY6gB,EAAUrxB,GAAGqxB,EAAUpxB,GAAK,IAM9C,SAGFoxB,EAAYA,EAAU7wB,IAAIe,GAE1B+vB,EAAME,QAAQH,GAGhB,OAAOC,OCnF2JG,GCcrJC,EAAA,EAAIC,QACjB/zB,KAAM,SACNg0B,OACEzpB,QACE3C,KAAM8f,GACNuM,UAAU,IAGdt2B,KAAI,MAEA2S,OAAQ,IAGZ4jB,UACE/xB,WACE,MAAMgyB,EAA+B7xB,KAAKiI,OAAOod,SAASxpB,OACxDwpB,EAAWrpB,OAAAoI,EAAA,UAAApI,CAAUgE,KAAKiI,OAAOod,SAAUnlB,KAAKkB,IAAIywB,EAAuB7xB,KAAKgO,OAAQ,IAE1F,OADAhO,KAAKgO,OAAS6jB,EACPxM,IAGXyM,SACEjyB,QAAQ1B,GACN,GAAIA,EAAQ,EACV,UAAWA,KAGf0B,SAASkyB,GACP,OAAQA,EAAO3Z,OACb,KAAK6K,GAASwC,MACZ,MAAO,QACT,KAAKxC,GAASyC,KACZ,MAAO,OACT,KAAKzC,GAAS2C,QACZ,MAAO,UACT,KAAK3C,GAAS0C,OACZ,MAAO,8BC1CjBqM,GAAAh2B,OAAAi2B,GAAA,EAAAj2B,CACAu1B,GCTA,WAA0B,IAAAW,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,UAAqBL,EAAAM,GAAAN,EAAA,kBAAAH,EAAAp2B,GAA0C,OAAA02B,EAAA,OAAiB5zB,IAAA9C,EAAA82B,MAAAP,EAAAQ,SAAAX,KAAiCG,EAAAS,GAAAT,EAAAU,GAAAb,EAAA/pB,SAAA,KAAAkqB,EAAAU,GAAAV,EAAApM,QAAAiM,EAAAjM,qBDY3N,EACA,KACA,WACA,MAIAkM,GAAAnE,QAAAgF,OAAA,aACA,IAAAC,GAAAd,iBEdae,GAYXlzB,YACSmzB,EACAh1B,EACAi1B,EACAC,EACAC,EACAC,EACAC,GANArzB,KAAAgzB,KACAhzB,KAAAhC,IACAgC,KAAAizB,IACAjzB,KAAAkzB,IACAlzB,KAAAmzB,KACAnzB,KAAAozB,KACApzB,KAAAqzB,KAKFxzB,UAAY,OAAOG,KAAKgzB,GAIxBnzB,QAAQmzB,GAAchzB,KAAKgzB,GAAKA,EAIhCnzB,SAAS7B,EAAWi1B,EAAWC,GACpClzB,KAAKhC,EAAIA,EACTgC,KAAKizB,EAAIA,EACTjzB,KAAKkzB,EAAIA,EAKJrzB,QAAQyzB,GACbtzB,KAAKhC,EAAIs1B,EACTtzB,KAAKizB,EAAIK,EACTtzB,KAAKkzB,EAAII,EAKJzzB,cAAc7B,EAAWi1B,EAAWC,GACzClzB,KAAKmzB,GAAKn1B,EACVgC,KAAKozB,GAAKH,EACVjzB,KAAKqzB,GAAKH,EAGLrzB,oBACLG,KAAKhC,EAAIgC,KAAKmzB,GACdnzB,KAAKizB,EAAIjzB,KAAKozB,GACdpzB,KAAKkzB,EAAIlzB,KAAKqzB,GAGTxzB,aACLG,KAAKhC,GAAKgC,KAAKmzB,GAAInzB,KAAKmzB,GAAKnzB,KAAKhC,GAAG,GACrCgC,KAAKizB,GAAKjzB,KAAKozB,GAAIpzB,KAAKozB,GAAKpzB,KAAKizB,GAAG,GACrCjzB,KAAKkzB,GAAKlzB,KAAKqzB,GAAIrzB,KAAKqzB,GAAKrzB,KAAKkzB,GAAG,GAKhCrzB,aAAeG,KAAKhC,EAAIgC,KAAKizB,EAAIjzB,KAAKkzB,OAAI/uB,EAI1CtE,kBAAoBG,KAAKmzB,GAAKnzB,KAAKozB,GAAKpzB,KAAKqzB,QAAKlvB,EAIlDtE,cACL,YAAesE,IAAXnE,KAAKhC,QAA8BmG,IAAXnE,KAAKizB,QAA8B9uB,IAAXnE,KAAKkzB,EAChD,IAAMlzB,KAAKhC,EAAEu1B,SAAS,IAAMvzB,KAAKizB,EAAEM,SAAS,IAAMvzB,KAAKkzB,EAAEK,SAAS,IAC/D,GAKP1zB,mBACL,YAAgBsE,IAAZnE,KAAKmzB,SAAgChvB,IAAZnE,KAAKozB,SAAgCjvB,IAAZnE,KAAKqzB,GAClD,IAAMrzB,KAAKmzB,GAAGI,SAAS,IAAMvzB,KAAKozB,GAAGG,SAAS,IAAMvzB,KAAKqzB,GAAGE,SAAS,IAClE,GAKP1zB,cACL,YAAesE,IAAXnE,KAAKhC,QAA8BmG,IAAXnE,KAAKizB,QAA8B9uB,IAAXnE,KAAKkzB,SACzClzB,KAAKhC,KAAKgC,KAAKizB,KAAKjzB,KAAKkzB,KAC7B,GAKPrzB,mBACL,YAAgBsE,IAAZnE,KAAKmzB,SAAgChvB,IAAZnE,KAAKozB,SAAgCjvB,IAAZnE,KAAKqzB,UAC3CrzB,KAAKmzB,MAAMnzB,KAAKozB,MAAMpzB,KAAKqzB,MAC/B,GAKPxzB,eACL,YAAesE,IAAXnE,KAAKhC,QAA8BmG,IAAXnE,KAAKizB,QAA8B9uB,IAAXnE,KAAKkzB,GAC9Cl1B,EAAKgC,KAAKhC,EAAGi1B,EAAKjzB,KAAKizB,EAAGC,EAAKlzB,KAAKkzB,MAM1CrzB,oBACL,YAAesE,IAAXnE,KAAKhC,QAA8BmG,IAAXnE,KAAKizB,QAA8B9uB,IAAXnE,KAAKkzB,GAC9Cl1B,EAAKgC,KAAKmzB,GAAIF,EAAKjzB,KAAKozB,GAAIF,EAAKlzB,KAAKqzB,OAM5CxzB,KAAK2zB,GACVxzB,KAAKgzB,GAAKQ,EAAMR,GAChBhzB,KAAKhC,EAAIw1B,EAAMx1B,EACfgC,KAAKizB,EAAIO,EAAMP,EACfjzB,KAAKkzB,EAAIM,EAAMN,EACflzB,KAAKmzB,GAAKK,EAAML,GAChBnzB,KAAKozB,GAAKI,EAAMJ,GAChBpzB,KAAKqzB,GAAKG,EAAMH,GAKXxzB,QACL,OAAO,IAAIkzB,GAAK/yB,KAAKgzB,GAAIhzB,KAAKhC,EAAGgC,KAAKizB,EAAGjzB,KAAKkzB,EAAGlzB,KAAKmzB,GAAInzB,KAAKozB,GAAIpzB,KAAKqzB,KASrE,MAEMI,GAAW,eACXC,GAAW,IAAIX,GAFJ,KClEjB,MCrFDY,GAAgB,ynBAwBhBC,GAAkB,2QAwUjB,MAAMC,GAAgB,SAASC,GACpC,OAAO,UAlSPj0B,YAAoBk0B,GAIlB,GAJkB/zB,KAAA+zB,OAClB/zB,KAAK+zB,KAAOA,EACZ/zB,KAAKg0B,OAASC,SAASC,cAAc,WAEhCl0B,KAAKg0B,OAAOG,WAAY,KAAK,uBAElC,GADAn0B,KAAKo0B,GAAKp0B,KAAKg0B,OAAOG,WAAW,uBAC5Bn0B,KAAKo0B,GAAI,KAAK,sBAuBnB,GAtBAL,EAAKM,KAAKC,YAAYt0B,KAAKg0B,QAE3Bh0B,KAAKu0B,WACLv0B,KAAKw0B,aACLx0B,KAAKy0B,eAAkBz2B,EAAG,EAAKi1B,EAAG,EAAKC,EAAG,EAAKC,GAAI,EAAKC,GAAI,EAAKC,GAAI,GAErErzB,KAAK00B,SACH9H,UAAa+H,OAAQ,KAAMt5B,KAAM,KAAMu5B,SAAU,EAAGC,SAAU,KAAMC,KAAM90B,KAAKo0B,GAAGW,aAClFC,UAAaL,OAAQ,KAAMt5B,KAAM,KAAMu5B,SAAU,EAAGC,SAAU,KAAMC,KAAM90B,KAAKo0B,GAAGW,aAClFE,OAAaN,OAAQ,KAAMt5B,KAAM,KAAMu5B,SAAU,EAAGC,SAAU,KAAMC,KAAM90B,KAAKo0B,GAAGc,cAClFC,SAAaR,OAAQ,KAAMt5B,KAAM,KAAMu5B,SAAU,EAAGC,SAAU,KAAMC,KAAM90B,KAAKo0B,GAAGc,cAClFE,WAAaT,OAAQ,KAAMt5B,KAAM,KAAMu5B,SAAU,EAAGC,SAAU,KAAMC,KAAM90B,KAAKo0B,GAAGc,eAK/El1B,KAAKq1B,YACRr1B,KAAKq1B,UAAYpB,SAASC,cAAc,WAC1Cl0B,KAAKq1B,UAAUC,MAAM1I,SAAW,WAChC5sB,KAAKq1B,UAAUC,MAAMC,IAAM,MAC3Bv1B,KAAKq1B,UAAUC,MAAM1zB,KAAO,MAC5B5B,KAAKw1B,IAAMx1B,KAAKq1B,UAAUlB,WAAW,OAChCn0B,KAAKw1B,IAAK,KAAM,qDAErBx1B,KAAKy1B,cACLz1B,KAAKg0B,OAAOx0B,OAASu0B,EAAK2B,SAAW11B,KAAK21B,GAAK31B,KAAK41B,IAAM7B,EAAK8B,EAC/D71B,KAAKg0B,OAAOv0B,OAASO,KAAK21B,GAAK5B,EAAK+B,EACpC91B,KAAKq1B,UAAU71B,MAAQ,EACvBQ,KAAKq1B,UAAU51B,OAAS,EAExBO,KAAKy1B,cAELz1B,KAAKo0B,GAAGN,SAAS,EAAG,EAAG9zB,KAAKg0B,OAAOx0B,MAAOQ,KAAKg0B,OAAOv0B,QAEtD,IAAIs2B,EAAe/1B,KAAKg2B,cAAch2B,KAAKo0B,GAAGT,cAAeA,IACzDsC,EAAiBj2B,KAAKg2B,cAAch2B,KAAKo0B,GAAGR,gBAAiBA,IAC7DsC,EAAUl2B,KAAKo0B,GAAG+B,gBAOtB,GANAn2B,KAAKo0B,GAAGgC,aAAaF,EAASH,GAC9B/1B,KAAKo0B,GAAGgC,aAAaF,EAASD,GAC9Bj2B,KAAKo0B,GAAGiC,YAAYH,GACpBl2B,KAAKo0B,GAAGkC,aAAaP,GACrB/1B,KAAKo0B,GAAGkC,aAAaL,IACVj2B,KAAKo0B,GAAGmC,oBAAoBL,EAASl2B,KAAKo0B,GAAGoC,aAC/C,CACP,MAAMC,4BAAgCz2B,KAAKo0B,GAAGsC,kBAAkBR,KAEhE,MADAl2B,KAAKo0B,GAAGuC,cAAcT,GAChBO,EAERz2B,KAAKo0B,GAAGwC,WAAWV,GAGnBl2B,KAAK00B,QAAQ9H,SAASiI,SAAY70B,KAAKo0B,GAAGyC,kBAAkBX,EAAS,YACrEl2B,KAAK00B,QAAQM,SAASH,SAAY70B,KAAKo0B,GAAGyC,kBAAkBX,EAAS,YACrEl2B,KAAK00B,QAAQO,MAAMJ,SAAe70B,KAAKo0B,GAAGyC,kBAAkBX,EAAS,SACrEl2B,KAAK00B,QAAQS,QAAQN,SAAa70B,KAAKo0B,GAAGyC,kBAAkBX,EAAS,WACrEl2B,KAAK00B,QAAQU,UAAUP,SAAW70B,KAAKo0B,GAAGyC,kBAAkBX,EAAS,aAGrEl2B,KAAK82B,cACL,IAAIC,EAAqB/2B,KAAKo0B,GAAG4C,mBAAmBd,EAAS,eAC7Dl2B,KAAKo0B,GAAG6C,UAAUF,EAAoB/2B,KAAKg0B,OAAOx0B,MAAOQ,KAAKg0B,OAAOv0B,QACrEO,KAAKk3B,mBAAqBl3B,KAAKo0B,GAAG4C,mBAAmBd,EAAS,eAC9Dl2B,KAAKo0B,GAAG6C,UAAUj3B,KAAKk3B,mBAAoBl3B,KAAK+zB,KAAK8B,EAAG71B,KAAK+zB,KAAK+B,GAClE91B,KAAKm3B,gBAAkBn3B,KAAKo0B,GAAG4C,mBAAmBd,EAAS,YAC3Dl2B,KAAKo0B,GAAG6C,UAAUj3B,KAAKm3B,gBAAiB,EAAK,GAI7C,IAAIC,EAAUp3B,KAAKo0B,GAAGiD,gBACtBr3B,KAAKo0B,GAAGkD,YAAYt3B,KAAKo0B,GAAGmD,WAAYH,GACxCp3B,KAAKw3B,WAAW,oGAChBx3B,KAAKo0B,GAAGqD,cAAcz3B,KAAKo0B,GAAGmD,WAAYv3B,KAAKo0B,GAAGsD,mBAAoB13B,KAAKo0B,GAAGuD,SAC9E33B,KAAKo0B,GAAGqD,cAAcz3B,KAAKo0B,GAAGmD,WAAYv3B,KAAKo0B,GAAGwD,mBAAoB53B,KAAKo0B,GAAGuD,SAC9E33B,KAAKo0B,GAAGqD,cAAcz3B,KAAKo0B,GAAGmD,WAAYv3B,KAAKo0B,GAAGyD,eAAgB73B,KAAKo0B,GAAG0D,eAC1E93B,KAAKo0B,GAAGqD,cAAcz3B,KAAKo0B,GAAGmD,WAAYv3B,KAAKo0B,GAAG2D,eAAgB/3B,KAAKo0B,GAAG0D,eAC1E93B,KAAKo0B,GAAG4D,cAAch4B,KAAKo0B,GAAG6D,UAE9BC,WAAW,KACTl4B,KAAKy1B,cACLz1B,KAAKm4B,eACLn4B,KAAKo4B,UACJ,KAGEv4B,oBAA8B,MAAO,QAEpCA,eACN,IAAIg2B,EAAI71B,KAAKq1B,UAAU71B,OAASQ,KAAK41B,GAAK51B,KAAKq4B,KACzCvC,EAAI91B,KAAKq1B,UAAU51B,QAAUO,KAAK21B,GAAK31B,KAAKq4B,KAElD,MAAMC,EAAYt4B,KAAKw0B,UAAU34B,OAC7By8B,EAAYp4B,KAAKoI,MAAMutB,GAAK31B,KAAKoI,MAAMwtB,KAEzCA,GADAD,EAAI31B,KAAK2jB,KAAK3jB,KAAKq4B,KAAKD,KAChB,EACRt4B,KAAKq1B,UAAU71B,MAAQq2B,GAAK71B,KAAK41B,GAAK51B,KAAKq4B,KAC3Cr4B,KAAKq1B,UAAU51B,OAASq2B,GAAK91B,KAAK21B,GAAK31B,KAAKq4B,KAC5Cr4B,KAAKy1B,cACLz1B,KAAKo0B,GAAG6C,UAAUj3B,KAAKk3B,mBAAoBrB,EAAGC,IAEhD91B,KAAKo0B,GAAG6C,UAAUj3B,KAAKm3B,gBAAiBn3B,KAAKq4B,IAAMr4B,KAAKq1B,UAAU71B,MAAOQ,KAAKq4B,IAAMr4B,KAAKq1B,UAAU51B,QAEnG,IAAWuzB,EAAPx1B,EAAI,EACRwC,KAAKw1B,IAAIgD,UAAY,UACrBx4B,KAAKw1B,IAAIiD,SAAS,EAAG,EAAGz4B,KAAKq1B,UAAU71B,MAAOQ,KAAKq1B,UAAU51B,QAC7DO,KAAKw1B,IAAIgD,UAAY,UAErB,MAAME,EAAU,GAAM14B,KAAK24B,IACrB/C,EAAK51B,KAAK41B,GAAK51B,KAAKq4B,IACpB1C,EAAK31B,KAAK21B,GAAK31B,KAAKq4B,IAC1B,IAAIt4B,EAAI,GAAM41B,EACd,IAAK,IAAI94B,EAAI,EAAGA,EAAIi5B,IAAKj5B,EAAG,CAC1B,IAAIiD,EAAe,GAAXE,KAAKq4B,IACb,IAAK,IAAI18B,EAAI,EAAGA,EAAIk6B,QAEP1xB,KADX6uB,EAAKhzB,KAAKw0B,UAAUh3B,MADG7B,IAAK6B,EAG5BwC,KAAKw1B,IAAIoD,SAAS5F,EAAIlzB,EAAI44B,EAAS34B,GACnCD,GAAK81B,EAEP,IAAK5C,EAAI,MACTjzB,GAAK41B,EAEP31B,KAAKo0B,GAAGyE,WAAW74B,KAAKo0B,GAAGmD,WAAY,EAAGv3B,KAAKo0B,GAAG0E,KAAM94B,KAAKo0B,GAAG0E,KAAM94B,KAAKo0B,GAAG2E,cAAe/4B,KAAKq1B,WAG5Fx1B,WAAWm5B,EAAeC,GAAiB,GACjD,IAAKj5B,KAAKo0B,GAAI,OACd,IAAI8E,GAAU,EACd,IAAK,IAAIv9B,EAAI,EAAGA,EAAIq9B,EAAMn9B,SAAUF,EAC7BqE,KAAKu0B,QAAQyE,EAAMr9B,MACtBu9B,GAAU,EACVl5B,KAAKw0B,UAAUz4B,KAAKi9B,EAAMr9B,IAC1BqE,KAAKu0B,QAAQyE,EAAMr9B,IAAMqE,KAAKw0B,UAAU34B,OAAS,GAIjDq9B,GAAWD,GAAOj5B,KAAKm4B,eAGtBt4B,YAAY5C,GACjBA,EAAIA,GAAK+B,OAAOm6B,iBAAiBn5B,KAAK+zB,KAAKM,KAAM,MACjDr0B,KAAKw1B,IAAI4D,KAAOn8B,EAAEo8B,SAAW,IAAMp8B,EAAEq8B,WAAa,IAAMr8B,EAAEs8B,WAC1Dv5B,KAAKw1B,IAAIgE,aAAe,SACxBx5B,KAAKw1B,IAAIgD,UAAY,UACrBx4B,KAAK41B,GAAK51B,KAAKw1B,IAAIiE,YAAY,KAAKj6B,MACpCQ,KAAK21B,GAAKlR,SAASxnB,EAAEo8B,SAAU,IAC/Br5B,KAAK24B,IAAM34B,KAAK+zB,KAAK2B,SAAY11B,KAAK21B,GAAK31B,KAAK41B,GAAM,EAClD51B,KAAK+zB,KAAK2B,WAAU11B,KAAK41B,GAAK51B,KAAK21B,IACvC31B,KAAKq4B,IAAiC,EAA3Bn4B,KAAK2jB,KAAe,GAAV7jB,KAAK21B,IAE1B,MAAMV,EAAQh4B,EAAEg4B,MAAMve,MAAM,QACtBye,EAAUl4B,EAAEy8B,gBAAgBhjB,MAAM,QACxC1W,KAAKy0B,cAAcz2B,EAAIymB,SAASwQ,EAAM,GAAI,IAAM,IAChDj1B,KAAKy0B,cAAcxB,EAAIxO,SAASwQ,EAAM,GAAI,IAAM,IAChDj1B,KAAKy0B,cAAcvB,EAAIzO,SAASwQ,EAAM,GAAI,IAAM,IAChDj1B,KAAKy0B,cAActB,GAAK1O,SAAS0Q,EAAQ,GAAI,IAAM,IACnDn1B,KAAKy0B,cAAcrB,GAAK3O,SAAS0Q,EAAQ,GAAI,IAAM,IACnDn1B,KAAKy0B,cAAcpB,GAAK5O,SAAS0Q,EAAQ,GAAI,IAAM,IAG9Ct1B,SAEAA,SACLG,KAAKo0B,GAAGuF,MAAM35B,KAAKo0B,GAAGwF,kBACtB,MAAM/D,EAAI71B,KAAK+zB,KAAK8B,EAClBC,EAAI91B,KAAK+zB,KAAK+B,EAGhB,IAAI+D,EAAQ75B,KAAK+zB,KAAKY,OAGlBmF,GAFe95B,KAAK+zB,KAAKgG,aACR/5B,KAAK+zB,KAAKiG,mBAChB,GAEf,IAAK,IAAIn9B,EAAI,EAAGA,EAAIi5B,IAAKj5B,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAIk6B,IAAKl6B,EAAG,CAC1B,MAAMgF,EAAOk5B,EAAMh9B,GAAGlB,GACtB,IAAIq3B,EAAKhzB,KAAKu0B,QAAQ5zB,EAAKqyB,SAChB7uB,IAAP6uB,IACFhzB,KAAKw3B,WAAW72B,EAAKqyB,IAAI,GACzB8G,GAAW,EACX9G,EAAKhzB,KAAKu0B,QAAQ5zB,EAAKqyB,KAEzB,MAAMiH,EAAkC,EAA9Bj6B,KAAK00B,QAAQO,MAAML,UAAgB/3B,EAAIg5B,EAAIl6B,GAC/Cu+B,EAAuC,EAAlCl6B,KAAK00B,QAAQU,UAAUR,UAAgB/3B,EAAIg5B,EAAIl6B,GACpDqC,OAAemG,IAAXxD,EAAK3C,EAAkBgC,KAAKy0B,cAAcz2B,EAAI2C,EAAK3C,EAAI,IAC3Di1B,OAAe9uB,IAAXxD,EAAKsyB,EAAkBjzB,KAAKy0B,cAAcxB,EAAItyB,EAAKsyB,EAAI,IAC3DC,OAAe/uB,IAAXxD,EAAKuyB,EAAkBlzB,KAAKy0B,cAAcvB,EAAIvyB,EAAKuyB,EAAI,IAC3DC,OAAiBhvB,IAAZxD,EAAKwyB,GAAmBnzB,KAAKy0B,cAActB,GAAKxyB,EAAKwyB,GAAK,IAC/DC,OAAiBjvB,IAAZxD,EAAKyyB,GAAmBpzB,KAAKy0B,cAAcrB,GAAKzyB,EAAKyyB,GAAK,IAC/DC,OAAiBlvB,IAAZxD,EAAK0yB,GAAmBrzB,KAAKy0B,cAAcpB,GAAK1yB,EAAK0yB,GAAK,IACrE,IAAK,IAAI91B,EAAI,EAAGA,EAAI,IAAKA,EAAG,CAC1B,MAAMoB,EAAIs7B,EAAI18B,EAAIyC,KAAK00B,QAAQO,MAAML,SACrC50B,KAAK00B,QAAQO,MAAM55B,KAAKsD,EAAI,GAAKX,EACjCgC,KAAK00B,QAAQO,MAAM55B,KAAKsD,EAAI,GAAKs0B,EACjCjzB,KAAK00B,QAAQO,MAAM55B,KAAKsD,EAAI,GAAKu0B,EACjClzB,KAAK00B,QAAQS,QAAQ95B,KAAKsD,EAAI,GAAKw0B,EACnCnzB,KAAK00B,QAAQS,QAAQ95B,KAAKsD,EAAI,GAAKy0B,EACnCpzB,KAAK00B,QAAQS,QAAQ95B,KAAKsD,EAAI,GAAK00B,EACnCrzB,KAAK00B,QAAQU,UAAU/5B,KAAK6+B,EAAK38B,GAAKy1B,GAMxC8G,GAAU95B,KAAKm4B,eACnBn4B,KAAKo0B,GAAG+F,WAAWn6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQO,MAAMN,QAC5D30B,KAAKo0B,GAAGiG,WAAWr6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQO,MAAM55B,KAAM2E,KAAK00B,QAAQO,MAAMH,MACrF90B,KAAKo0B,GAAG+F,WAAWn6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQS,QAAQR,QAC9D30B,KAAKo0B,GAAGiG,WAAWr6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQS,QAAQ95B,KAAM2E,KAAK00B,QAAQS,QAAQL,MACzF90B,KAAKo0B,GAAG+F,WAAWn6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQU,UAAUT,QAChE30B,KAAKo0B,GAAGiG,WAAWr6B,KAAKo0B,GAAGgG,aAAcp6B,KAAK00B,QAAQU,UAAU/5B,KAAM2E,KAAK00B,QAAQU,UAAUN,MAE7F,MAAMwF,EAASt6B,KAAK00B,QAAQ9H,SAC5B5sB,KAAKo0B,GAAGmG,WAAWv6B,KAAKo0B,GAAGoG,UAAW,EAAGF,EAAOj/B,KAAKQ,OAASy+B,EAAO1F,UAI/D/0B,cAAcyF,EAAc0T,GAClC,MAAMyhB,EAASz6B,KAAKo0B,GAAGsG,aAAap1B,GAIpC,GAHAtF,KAAKo0B,GAAGuG,aAAaF,EAAQzhB,GAC7BhZ,KAAKo0B,GAAG4B,cAAcyE,IACXz6B,KAAKo0B,GAAGwG,mBAAmBH,EAAQz6B,KAAKo0B,GAAGyG,gBAC7C,CACP,MAAMpE,EAAM,2BAA6Bz2B,KAAKo0B,GAAG0G,iBAAiBL,GAElE,MADAz6B,KAAKo0B,GAAGkC,aAAamE,GACfhE,EAER,OAAOgE,EAGD56B,cACN,IAAIk7B,EAAGT,EAAQ5F,EAAU10B,KAAK00B,QAE9B,MAAMmB,EAAI71B,KAAK+zB,KAAK8B,EACdC,EAAI91B,KAAK+zB,KAAK+B,EAGpB,IAAKiF,KAAK/6B,KAAK00B,SACb4F,EAAS5F,EAAQqG,IACV1/B,KAAO,IAAI2/B,aAA+B,EAAlBV,EAAO1F,SAAeiB,EAAIC,GAG3D,IAAK,IAAIj5B,EAAI,EAAGA,EAAIi5B,IAAKj5B,EACvB,IAAK,IAAIlB,EAAI,EAAGA,EAAIk6B,IAAKl6B,EAAG,CAE1B,MAAMs+B,EAAgC,EAA5BvF,EAAQ9H,SAASgI,UAAgB/3B,EAAIg5B,EAAIl6B,GACnDqE,KAAKi7B,WAAWvG,EAAQ9H,SAASvxB,KAAM4+B,EAAGt+B,EAAIqE,KAAK41B,GAAI/4B,EAAImD,KAAK21B,GAAI31B,KAAK41B,GAAI51B,KAAK21B,IAClF31B,KAAKi7B,WAAWvG,EAAQM,SAAS35B,KAAM4+B,EAAG,EAAK,EAAK,EAAK,GAI7D,IAAKc,KAAK/6B,KAAK00B,SACb4F,EAAS5F,EAAQqG,IACNpG,QAAQ30B,KAAKo0B,GAAG8G,aAAaZ,EAAO3F,QAC/C2F,EAAO3F,OAAS30B,KAAKo0B,GAAG+G,eACxBn7B,KAAKo0B,GAAG+F,WAAWn6B,KAAKo0B,GAAGgG,aAAcE,EAAO3F,QAChD30B,KAAKo0B,GAAGiG,WAAWr6B,KAAKo0B,GAAGgG,aAAcE,EAAOj/B,KAAMi/B,EAAOxF,MAC7D90B,KAAKo0B,GAAGgH,wBAAwBd,EAAOzF,UACvC70B,KAAKo0B,GAAGiH,oBAAoBf,EAAOzF,SAAUyF,EAAO1F,SAAU50B,KAAKo0B,GAAGkH,OAAO,EAAO,EAAG,GAInFz7B,WAAW07B,EAAe5/B,EAAWmE,EAAWC,EAAW81B,EAAWC,GAC5E,MAAM90B,EAAKlB,EACLoB,EAAKnB,EACLy7B,EAAK17B,EAAI+1B,EACT4F,EAAK17B,EAAI+1B,EAEfyF,EAAM5/B,GAAKqF,EACXu6B,IAAM5/B,GAAKuF,EACXq6B,IAAM5/B,GAAK6/B,EACXD,IAAM5/B,GAAKuF,EACXq6B,IAAM5/B,GAAKqF,EACXu6B,IAAM5/B,GAAK8/B,EACXF,IAAM5/B,GAAKqF,EACXu6B,IAAM5/B,GAAK8/B,EACXF,IAAM5/B,GAAK6/B,EACXD,IAAM5/B,GAAKuF,EACXq6B,IAAM5/B,GAAK6/B,EACXD,IAAM5/B,GAAK8/B,IAKY3H,IChW3B,IAAY4H,GCAPC,IDAL,SAAYD,GACVA,IAAA,uDACAA,IAAA,+CACAA,IAAA,+CACAA,IAAA,2CACAA,IAAA,mEACAA,IAAA,2CANF,CAAYA,mBASUE,WAAqBhQ,GACzC/rB,YACEwG,EACA3I,EACAmuB,EACAC,EACAC,EACAC,EAAsB,IAEtBvqB,MAAM4E,EAAI3I,EAAMmuB,EAAOC,EAAMC,EAASC,UAI7B6P,WAAiCD,GAC5C/7B,cACE4B,MAAMi6B,GAAeG,yBAA0B,mBAAoB,EAAG,EAAG,GAGpEh8B,SAAS8C,MC3BlB,SAAKg5B,GACHA,IAAA,uBACAA,IAAA,uBAFF,CAAKA,mBAKQG,WAAiClR,GAC5C/qB,YAAYuY,EAAgB,GAC1B3W,MAAMk6B,GAAmBI,SAAU,YAAa3jB,GAEhDpY,KAAK8qB,QAAQ/uB,KAAK,IAAI8/B,WAIbG,WAAiCpR,GAC5C/qB,YAAYuY,EAAgB,GAC1B3W,MAAMk6B,GAAmBM,SAAU,WAAY7jB,GAG/CpY,KAAK8qB,QAAQ/uB,KAAK,IAAI8/B,WAIbK,WAA+BlR,GAC1CnrB,YACE+C,EACOu5B,EAAW,IAAIL,GACfM,EAAW,IAAIJ,IAEtBv6B,OAAO06B,EAAUC,GAAW,EAAG,GAHxBp8B,KAAAm8B,WACAn8B,KAAAo8B,kBCXLC,WAAoBxgB,GACjBhc,UAAUiE,GACf,OAAOA,aAAgBw4B,UAIrBC,WAAc1gB,GACXhc,UAAUiE,GACf,OAAOA,aAAgB04B,GAGlB38B,SAAS+C,GACd,QAASA,EAAO4c,UAAU+I,kBAAkBlJ,iBAI1Cid,WAAcxgB,GACXjc,UAAUiE,GACf,OAAOA,aAAgBu4B,UAIrBG,WAAY1gB,GACTjc,UAAUiE,GACf,OAAOA,aAAgBy4B,IAI3B,MAAME,GAAQ,IAAIxwB,MAELywB,GAAY,IAAM,IAAIF,GAAI,cAAe,EAAGC,IAE5CE,GAAY,IAAM,IAAIN,GAAY,mBAAoB,GAAKI,IAE3DG,GAAc,IAAM,IAAIL,GAAM,oBAAqB,GAAKE,IACxDI,GAAY,IAAM,IAAIN,GAAM,kBAAmB,IAAME,IAE3C,IAAI9Y,KAEvB,EACA,IACE,IAAIzH,GAAc,SAAU,IACxB5W,KAAMgV,GAAWC,MAAOL,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,OAIjE,EACA,IACE,IAAI4P,GAAc,SAAU,KACxB5W,KAAMgV,GAAWC,MAAOL,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,QAK5C,IAAIqX,KAEzB,EACA,IACE,IAAItH,GAAU,WAAY,IAAM/W,KAAMmS,GAAewD,OAAQ9c,MAAO,OAGtE,EACA,IAAM,IAAIke,GAAU,OAAQ,IAAM/W,KAAMmS,GAAe4D,MAAOld,MAAO,OAGrE,GACA,IACE,IAAIke,GAAU,OAAQ,IAAM/W,KAAMmS,GAAe2D,UAAWjd,MAAO,OAEtE,IAAK,IAAM,kBCrFkByd,GAC9B/b,cACE4B,MAAM,iBAGD5B,QAAQ8C,GACbA,EAAKC,OAAOmL,OAAOvC,SAAS,cDkFnBsxB,WAAwBvgB,GAGnC1c,cACE4B,MAAM,2BAA4B,OAH7BzB,KAAAkF,SAAyBpC,EAAWoM,QE9E7C,MAAM6tB,GAAc,CAClBr/B,EACAwQ,KACAC,IAEO,kBpFiKuBR,EAG9B9N,YACSqU,EACPrH,EACAxG,EAAiBsH,EAASC,SAE1BnM,MAAMoL,EAAQxG,GAJPrG,KAAAkU,KAOFrU,IAAI6C,EAAoBC,GAC7B3C,KAAKsqB,YACLtqB,KAAKyO,WAAW/L,GAEhB,MAAM6nB,EAAUvqB,KAAKkU,GAAG9B,IAAIpS,KAAM0C,EAAUC,GAO5C,OANI4nB,GACFvqB,KAAKQ,GAAG+pB,GAGVvqB,KAAKQ,GAAG,IAAIiC,EAAWC,EAAUC,IAE1B3C,KAAKuO,MAGd8H,cAEE,GAAIrW,KAAK6M,OAAOmwB,aACd,OAASl5B,KAAM9D,KAAK6M,OAAOmwB,aAAc94B,MAAO,GAIpDwY,qBACE,OAAO1c,KAAK2oB,IAAM3oB,KAAK2oB,IAAI9kB,SAGtBhE,QAAQiE,EAAYI,GACpBlE,KAAK2oB,MACR3oB,KAAK2oB,IAAM,IAAI/kB,GAGjB5D,KAAK2oB,IAAInkB,IAAIV,EAAMI,GAGdrE,WAAWiE,EAAYI,GAC5B,IAAKlE,KAAK2oB,IACR,iBAAkB3oB,KAAKtC,6BACrBoG,EAAKpG,+BAITsC,KAAK2oB,IAAIpI,OAAOzc,EAAMI,KoFpNF,kBCFQgP,GAY9BrT,cACE4B,QACAzB,KAAKi9B,QAAU,IAAIzpB,GACnBxT,KAAKk9B,SAAW,IAAIrpB,GACpB7T,KAAKm9B,OAAS,IAAI3qB,EAClBxS,KAAKm8B,SAAW,IAAItqB,EACpB7R,KAAKo9B,OAAS,IAAIrpB,GAClB/T,KAAKq9B,OAAS,IAAI5oB,GAClBzU,KAAKs9B,OAAS,IAAIjpB,GAClBrU,KAAKu9B,QAAU,IAAIznB,GAEnB9V,KAAKw9B,UAAY,IAAIxmB,GAGhBnX,IACLsG,EACAzD,EACAC,GAGA,IAAI2L,EAuBJ,OAxBAtO,KAAK4Y,YAGD5Y,KAAKy9B,UAAUt3B,IACZmI,EAAQtO,KAAKm8B,SAAS/pB,IAAIjM,EAAOzD,EAAUC,MACpC2L,EAAQtO,KAAKu9B,QAAQnrB,IAAIjM,EAAOzD,EAAUC,MAC1C2L,EAAQtO,KAAKm9B,OAAO/qB,IAAIjM,EAAOzD,EAAUC,MACzC2L,EAAQtO,KAAKo9B,OAAOhrB,IAAIjM,EAAOzD,EAAUC,MAEnD2L,EAAQtO,KAAK09B,QAAQv3B,EAAOzD,EAAUC,IAGxC3C,KAAK29B,eAAex3B,KACnBmI,EAAQtO,KAAKi9B,QAAQ7qB,IAAIjM,EAAOzD,EAAUC,MAEjC2L,EAAQtO,KAAKm8B,SAAS/pB,IAAIjM,EAAOzD,EAAUC,MAC3C2L,EAAQtO,KAAKu9B,QAAQnrB,IAAIjM,EAAOzD,EAAUC,MAC1C2L,EAAQtO,KAAKm9B,OAAO/qB,IAAIjM,EAAOzD,EAAUC,MAEnD2L,GAAQ,IAAI6I,IAAa/E,IAAIjM,EAAOzD,IAGtC1C,KAAKsT,cAEEhF,EAGDzO,UAAUsG,GAChB,OAAOA,EAAM4H,OAAOpC,aAAsC,GAAvBxF,EAAM4H,OAAO3C,QAG1CvL,eAAesG,GACrB,OAAOA,EAAM4H,OAAOpC,aAAexF,EAAM4H,OAAO3C,QAAU,EAGpDvL,QACNsG,EACAzD,EACAC,GAEA,IAAI2L,EAeJ,OAbKA,EAAQtO,KAAKk9B,SAAS9qB,IAAIjM,EAAOzD,EAAUC,IACzCwD,EAAM2H,MACT9N,KAAKq9B,OAAOO,cACVl7B,EAASmF,YAAY1B,GACrBzD,EAASuR,aAAa9N,KAGhBmI,EAAQtO,KAAKw9B,UAAUprB,IAAIjM,EAAOzD,EAAUC,MAC5C2L,EAAQtO,KAAKq9B,OAAOjrB,IAAIjM,EAAOzD,EAAUC,MAEnD2L,EAAQtO,KAAKs9B,OAAOlrB,IAAIjM,EAAOzD,EAAUC,IAGpC2L,KDnFP5Q,KAAMA,EACNwO,OAAQ,GACR+B,KAAMb,EAAK6D,gBACX5C,aACAH,YAAaA,EACbC,QAASA,EAETpB,eAAgB,EAChBC,iBAAkB,EAClBC,kBAAmB,EAEnBoC,eACAT,aAAc,EAEdJ,UAAW,GACXqvB,YAAa,GACb1uB,YAAa,IAIJ2uB,GAAM,IACVf,GACL,WAEGz3B,KAAMgV,GAAWC,MAAOL,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,KErB5DutB,IFiCwB,IAAIlW,KAAuB,IAAKma,KAAO,EARhD,IACZf,GACL,UACGz3B,KAAMmS,GAAeyD,MAAO/c,MAAO,MACnCmH,KAAMgV,GAAWG,MAAOP,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,SE7B3B,IAAInH,KAC3C00B,GAAM/zB,IAAI,IAAK,IAAM,kB3FqDSI,I2FrDI,IAAKzB,EAAUyB,QACjD2zB,GAAM/zB,IAAI,IAAK,IAAM,IAAIM,GACzByzB,GAAM/zB,IAAI,IAAK,IAAM,IAAII,EAAM,IAAKzB,EAAUyB,QAC9C2zB,GAAM/zB,IAAI,IAAK,IAAM,IAAIa,GAEzB,MAAMo3B,GAAiB,EACrBC,GAAQD,GAAS,QAENE,WAAwBvZ,GAC5B7kB,MAAM8C,EAAYC,IACLD,EAAKoE,WAAapE,EAAKkU,OAAOknB,KAEvCnuB,YAAY,IAAIhQ,EAAM,EAAG,GAAIgD,GAGjC/C,SAAS8C,GACdA,EAAKu7B,OAAOH,GAAQ,CAAC13B,EAAI1D,KACvB,IAAItC,EAAML,KAAKm+B,YAAY93B,GACzB,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,gBAcF,OAZAhG,EAAI3C,KAAO,QAEX2C,EAAIyH,QACF,EACA,EACA,IAAIC,EAAkB,sBAAsB,EAAO,IAAIrB,IAEzDrG,EAAIyH,QAAQ,EAAG,EAAG,IAAIwkB,IAEtBjsB,EAAIyH,QAAQ,EAAG,EAAG,IAAIC,EAAkB,cAAc,EAAO,IAAIrB,IACjErG,EAAIyH,QAAQ,EAAG,EAAG,IAAImkB,IAEf5rB,IAGTsC,EAAKu7B,OAAOF,GAAO,CAAC33B,EAAI1D,KACtB,IAAItC,EAAML,KAAKm+B,YAAY93B,GACzB,QACA,QACA,QACA,QACA,UAOF,OALAhG,EAAI3C,KAAO,MACX2C,EAAIyH,QAAQ,EAAG,EAAG,IAAIwkB,IACtBjsB,EAAIuP,YAAY,IAAIhQ,EAAM,EAAG,GAAIk+B,MAG1Bz9B,IAIHR,YAAYwG,EAAY+3B,GAG9B,OAFU,IAAItZ,GAASze,EAAIuc,GAAMwb,EAAQvE,YC8BhCwE,WAAetY,GAC1BlmB,YAAY+C,GACVnB,MAAMmB,EAAQ,IAAIs5B,GAAuBt5B,KCtH7C,MAAM07B,GAAuB,IACvBC,GAAyB,IACzBC,IAAgBxgC,EAAG,IAAKi1B,EAAG,IAAKC,EAAG,SAE5BuL,WAAoB1L,GACxBlzB,QAAQkL,GACb,OAAO/K,KAGTH,YAAY6+B,EAAc1gC,EAAIsgC,GAAcrL,EAAIqL,GAAcpL,EAAIoL,IAChE78B,MAAMi9B,EAAM1gC,EAAGi1B,EAAGC,GAGVrzB,cAAcc,EAAeoK,GAMrC,OALApK,EAAKg+B,cACHH,GAAYxgC,EAAI+M,EAChByzB,GAAYvL,EAAIloB,EAChByzB,GAAYtL,EAAInoB,GAEXpK,EAGCd,SAASc,EAAeoK,GAMhC,OALApK,EAAKi+B,SACHJ,GAAYxgC,EAAI+M,EAChByzB,GAAYvL,EAAIloB,EAChByzB,GAAYtL,EAAInoB,GAEXpK,SAIIk+B,WAAsBJ,GACnC5+B,YAAY6+B,GACVj9B,MAAMi9B,EAAMH,GAAgBA,GAAgBA,WAInCO,WAAqBD,GAChCh/B,YACE6+B,EACOK,EACAC,EACAC,GAEPx9B,MAAMi9B,GAJC1+B,KAAA++B,KACA/+B,KAAAg/B,KACAh/B,KAAAi/B,KAKFp/B,QAAQkL,GACb,IAAIpK,EAAOX,KAAKuG,QAGhB,OAFA5F,EAAKi+B,SAAS5+B,KAAK++B,GAAI/+B,KAAKg/B,GAAIh/B,KAAKi/B,IAE9Bt+B,SAsDEu+B,WAAiBT,GAC5B5+B,YACE6+B,EACOK,EACAC,EACAC,GAEPx9B,MAAMi9B,GAJC1+B,KAAA++B,KACA/+B,KAAAg/B,KACAh/B,KAAAi/B,KAKFp/B,QAAQkL,GACb,IAAIpK,EAAOX,KAAKuG,QAGhB,OAFA5F,EAAKi+B,SAAS5+B,KAAK++B,GAAI/+B,KAAKg/B,GAAIh/B,KAAKi/B,IAE9Bt+B,GAIX,MAAMw+B,GAAS,IAAID,GAAS,IAAK,IAAK,IAAK,KACrCE,GAAS,IAAIF,GAAS,IAAK,IAAK,IAAK,KACrCG,GAAa,IAAIH,GAAS,IAAK,IAAK,IAAK,KACzCI,GAAU,IAAIJ,GAAS,IAAK,IAAK,IAAK,KACtCK,GAAiB,IAAIL,GAAS,IAAK,IAAK,IAAK,KAC7CM,GAAQ,IAAIN,GAAS,IAAK,IAAK,IAAK,GAEpCO,GAAS,IAAIP,GAAS,IAAK,IAAK,IAAK,KAE9BQ,GAAc,SAAS57B,GAClC,OAAQA,EAAKyX,OACX,KAAKhE,GAAU2E,cACb,OAAOijB,GACT,KAAK5nB,GAAUoE,WACb,OAAOyjB,GACT,KAAK7nB,GAAU8E,UACb,OAAOgjB,GACT,KAAK9nB,GAAUsE,QACb,OAAOyjB,GACT,KAAK/nB,GAAUuE,cACb,OAAOyjB,GACT,KAAKhoB,GAAUqE,OACb,OAAO6jB,GACT,KAAKloB,GAAUgF,MACb,OAAOijB,GACT,QACE,OAAOJ,KAIPO,GAAO,kBAlGiBlB,GAC5B5+B,cACE4B,MAAM,KAGD5B,QAAQkL,GACb,IAAIpK,EAAOX,KAAKuG,QAIhB,OAHAvG,KAAK4/B,SAASj/B,EAAMoK,GACpBpK,EAAKk/B,aAEEl/B,IAyFLm/B,GAAO,kBA3EiBrB,GAC5B5+B,cACE4B,MAAM,KAGD5B,QAAQkL,GACb,IAAIpK,EAAOX,KAAKuG,QAIhB,OAHAvG,KAAK+/B,cAAcp/B,EAAMoK,GACzBpK,EAAKq/B,oBAEEr/B,IAkELs/B,GAAQ,kBAtFiBxB,GAC7B5+B,cACE4B,MAAM,KAGD5B,QAAQkL,GACb,OAAO/K,KAAK4/B,SAAS5/B,KAAKuG,QAASwE,KAiFjCm1B,GAAgB,kBA/DazB,GACjC5+B,cACE4B,MAAM,OA8DJ0+B,GAAc,kBA1Da1B,GAC/B5+B,cACE4B,MAAM,OAyDJ2+B,GAAY,IAAI3B,GAAY,IAAK,EAAG,EAAG,GAEvC4B,GAAqB,IAAI5B,GAAY,IAAK,EAAG,IAAK,KAClD6B,GAAa,IAAI7B,GAAY,IAAK,IAAK,IAAK,GAkDlD,MAAM8B,GAAqB,kBAhDap4B,EAG/BtI,OAAOuI,GACZpI,KAAKW,KAAOm/B,GAGPjgC,QAAQyI,GACbtI,KAAKW,KAAOs/B,GAGPpgC,eAAe0I,GACpBvI,KAAKW,KAAOu/B,GAGPrgC,aAAa0I,GAClBvI,KAAKW,KAAOw/B,GAGPtgC,OAAO4I,GACZzI,KAAKW,KAAOg/B,GAGP9/B,OAAO8I,GACZ,GAAKA,EAAKrB,SAKV,OAAQqB,EAAKrD,MACb,KAAKZ,EAAS6nB,cACZvsB,KAAKW,KAAO0/B,GACZ,MACF,KAAK37B,EAASyW,MACZnb,KAAKW,KAAO2/B,QATZtgC,KAAKW,KAAOs/B,GAcTpgC,UAAU6I,GACfA,EAAQ/H,KAAKkK,MAAM7K,MAGXH,QAAQc,GAChBX,KAAKW,KAAOy/B,KCxMVI,GAAS,IAAI1B,GAAa,IAAK,EAAG,IAAK,GACvC2B,GAAM,IAAI3B,GAAa,IAAK,IAAK,GAAI,IACrC4B,GAAQ,IAAI5B,GAAa,IAAK,IAAK,IAAK,KACxC6B,GAAY,IAAIlC,GAAY,IAAK,EAAG,EAAG,GAEvCmC,IACJ,IAAI1B,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,KAC5B,IAAIA,GAAS,IAAK,IAAK,IAAK,MAG9B,ICtCmK2B,GDsCpJrP,EAAA,EAAIC,QACjBC,OAAQ,QAAS,SAAU,OAC3Br2B,KAAI,MAEAylC,UAAU,EACVC,KAAM,KACNC,IAAK,KACLC,aAAc,KACd7c,GAAI8c,KAAKC,MACTC,SAAU,IACV1sB,KAAM,IAGVod,SACEjyB,QAAQC,EAAWC,GACjB,MAAMgF,EAAS/E,KAAK0K,MAAME,GAAG9K,EAAGC,GAAGgF,OAC7BpE,EAAOX,KAAK8gC,SAAW9gC,KAAK0K,MAAME,GAAG9K,EAAGC,GAAKC,KAAK0K,MAAME,GAAG9K,EAAGC,GAAGY,KAEvE,IAAKA,EACH,OAAOggC,GAGT,GAAI57B,EAAQ,CACV,GAAIpE,EAAK2B,SAAU,CACjB,IAAI++B,EAAQrhC,KAAKiU,aAAatT,EAAK2B,UAAUiE,QAE7C,OADA86B,EAAM1C,cAAc,IAAK,EAAG,GACrB0C,EAEP,OAAO,IAAI5C,GAAY15B,EAAQ,IAAK,IAAK,GAI7C,GAAIpE,EAAK2B,SACP,OAAOtC,KAAKiU,aAAatT,EAAK2B,UAGhC,GAAI3B,EAAKsF,MACP,OAAQtF,EAAKsF,MAAMpC,MAAMhI,QACzB,KAAK,EACH,MACF,KAAK,EACH,OAAO6jC,GAAY/+B,EAAKsF,MAAMpC,MAAM,GAAGC,MACzC,QACE,MAAMw9B,EAAQthC,KAAK0U,MAA4B,EAApB1U,KAAKuhC,aAAmB,GACnD,GAAID,EAAQV,GAAkB/kC,OAC5B,OAAO+kC,GAAkBU,GACpB,CACL,MAAME,EAASthC,KAAKoI,MAAMtI,KAAK0U,MAA4B,EAApB1U,KAAKuhC,aAAmB,IAE/D,OAAO7B,GAAY/+B,EAAKsF,MAAMpC,MAAM29B,EAAS7gC,EAAKsF,MAAMpC,MAAMhI,QAAQiI,OAK5E,OD4IqB,SAASnD,GAElC,OADAA,EAAKkK,MAAM01B,IACJA,GAAmB5/B,KC9If8gC,CAAY9gC,IAErBsT,aAAa3R,GACU,OAAjBA,EAAS5E,KACJ+iC,GAGY,SAAjBn+B,EAAS5E,KACJgjC,GAGFF,GAET3gC,eACEG,KAAK+gC,KAAO,UZsFhBlhC,YACSw0B,EACAwB,EACAC,EACP4L,EACOhM,GAAoB,GAJpB11B,KAAAq0B,OACAr0B,KAAA61B,IACA71B,KAAA81B,IAEA91B,KAAA01B,WAEP11B,KAAK2hC,GAAKzhC,KAAKoI,MAAMutB,EAAI,GACzB71B,KAAK4hC,GAAK1hC,KAAKoI,MAAMwtB,EAAI,GAEzB91B,KAAKq0B,KAAKwN,UAAY,IAGoB,IAAtCxN,EAAKyN,UAAUC,QAAQtO,MACK,IAA1BY,EAAKyN,UAAUjmC,OACjBw4B,EAAKyN,UAAYrO,GAEdY,EAAKyN,WAAa,IAAMrO,IAI/BzzB,KAAK20B,OAAS,IAAIh1B,MAAMm2B,GACxB,IAAK,IAAIj5B,EAAI,EAAGA,EAAIi5B,IAAKj5B,EAAG,CAC1BmD,KAAK20B,OAAO93B,GAAK,IAAI8C,MAAMk2B,GAC3B,IAAK,IAAIl6B,EAAI,EAAGA,EAAIk6B,IAAKl6B,EACvBqE,KAAK20B,OAAO93B,GAAGlB,GAAK+3B,GAIxB1zB,KAAK0hC,SAAWA,EAAS1hC,MAKnBH,YAAYmiC,GAClB,MAAM/kC,EAAI+B,OAAOm6B,iBAAiBn5B,KAAKq0B,KAAM,MAE7Cr0B,KAAK+5B,aAAe98B,EAAEg4B,YAAS9wB,EAC/BnE,KAAKg6B,kBAAoB/8B,EAAEy8B,sBAAmBv1B,EAC1C69B,GACFhiC,KAAK0hC,SAASjM,YAAYx4B,GASvB4C,oBACL,OAAOG,KAAK0hC,SAASO,oBAWhBpiC,IAAIc,EAAYb,EAAWC,GAC5BD,EAAI,GAAKC,EAAI,GAAKD,GAAKE,KAAK61B,GAAK91B,GAAKC,KAAK81B,IAC/C91B,KAAK20B,OAAO50B,GAAGD,GAAKa,GAWfd,UAAUc,EAAYb,EAAWC,GACtCC,KAAK20B,OAAO50B,GAAGD,GAAKa,EAiBfd,UACLqiC,EACApiC,EACAC,EACA/B,EACAi1B,EACAC,EACAC,EACAC,EACAC,GAEA,MAAM8O,EAAMD,EAAIrmC,OAChB,KAAIiE,EAAI,GAAKC,EAAI,GAEjB,IAAK,IAAIpE,EAAI,EAAGA,EAAIwmC,IAAOxmC,EAAG,CAK5B,GAJImE,GAAKE,KAAK61B,IACZ/1B,EAAI,IACFC,GAEAA,GAAKC,KAAK81B,EAAG,OAEjB,MAAMn1B,EAAO,IAAIoyB,GAAKmP,EAAIvmC,GAAIqC,EAAGi1B,EAAGC,EAAGC,EAAIC,EAAIC,GAC/CrzB,KAAKoiC,UAAUzhC,EAAMb,EAAGC,KACtBD,GAcCD,IAAIC,EAAWC,GACpB,OAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKE,KAAK61B,GAAK91B,GAAKC,KAAK81B,EAAUpC,GAClD1zB,KAAK20B,OAAO50B,GAAGD,GAKjBD,QACL,IAAK,IAAIhD,EAAI,EAAGA,EAAImD,KAAK81B,IAAKj5B,EAC5B,IAAK,IAAIlB,EAAI,EAAGA,EAAIqE,KAAK61B,IAAKl6B,EAC5BqE,KAAK20B,OAAO93B,GAAGlB,GAAK+3B,GAGxB1zB,KAAK0hC,SAAS/H,QAKT95B,SACLG,KAAK0hC,SAAStJ,WYzOVp4B,KAAKqiC,MAAMC,MACXpiC,KAAKkB,IAAIpB,KAAKoY,MAAM5Y,MAAO,IAC3BU,KAAKkB,IAAIpB,KAAKoY,MAAM3Y,OAAQ,IAC5Bo0B,IACA,GAGF7zB,KAAKghC,IAAM,UZkQfnhC,YACSi0B,EACAyO,EACA1M,EACAC,GAHA91B,KAAA8zB,WACA9zB,KAAAuiC,WACAviC,KAAA61B,IACA71B,KAAA81B,IA7BD91B,KAAAwiC,cAAwB,EACxBxiC,KAAAyiC,cAAwB,EAGxBziC,KAAA0iC,mBAA6B,EAI7B1iC,KAAA2iC,OAAiB,EACjB3iC,KAAA4iC,OAAiB,EAuBvB5iC,KAAK6iC,UAAY,IAAIljC,MAAMm0B,EAASgC,GACpC91B,KAAK8iC,WAAa,IAAInjC,MAAMm0B,EAASgC,GAErC,IAAK,IAAIj5B,EAAI,EAAGA,EAAIi3B,EAASgC,IAAKj5B,EAChCmD,KAAK6iC,UAAUhmC,GAAK,IAAI8C,MAAMm0B,EAAS+B,GACvC71B,KAAK8iC,WAAWjmC,GAAK,IAAI8C,MAAMm0B,EAAS+B,GAarCh2B,YAAYkjC,EAAsCh+B,EAAiBkU,GACpElU,IACF/E,KAAKgjC,gBAAa7+B,EACI,iBAAXY,IACM,UAAXA,EAAoB/E,KAAKgjC,WAAa,SAASljC,EAAGC,EAAG81B,EAAGC,EAAGmN,EAAOC,EAAOC,GAC3E,MAAMC,EAAY,GAAJvN,EAASwN,EAAY,GAAJvN,EAG/B,OAFAh2B,GAAKsjC,EACLrjC,GAAKsjC,EACDnjC,KAAKC,IAAIL,GAAKsjC,EAAQD,GAAUjjC,KAAKC,IAAIJ,GAAKsjC,EAAQF,EAAeF,EAC7DC,GAEM,WAAXn+B,EAAqB/E,KAAKgjC,WAAa,SAASljC,EAAGC,EAAG81B,EAAGC,EAAGmN,EAAOC,EAAOC,GACjF,MAAMC,EAAY,GAAJvN,EAASwN,EAAY,GAAJvN,EAI/B,OAHAh2B,GAAKsjC,EACLrjC,GAAKsjC,EACLF,EAAS,EAAMA,EACXjjC,KAAKC,IAAIL,GAAKsjC,EAAQD,GAAUjjC,KAAKC,IAAIJ,GAAKsjC,EAAQF,EAAeD,EAC7DD,GAEM,aAAXl+B,EAAuB/E,KAAKgjC,WAAa,SAASljC,EAAGC,EAAG81B,EAAGC,EAAGmN,EAAOC,EAAOC,GACnF,MAAMC,EAAY,GAAJvN,EAASwN,EAAY,GAAJvN,EAG/B,OAFAh2B,GAAKsjC,GAEGtjC,GADRC,GAAKsjC,GACWtjC,GAAKqjC,EAAQA,EAAQC,EAAQA,GAASF,EAAeF,EACzDC,GAEM,cAAXn+B,EAAwB/E,KAAKgjC,WAAa,SAASljC,EAAGC,EAAG81B,EAAGC,EAAGmN,EAAOC,EAAOC,GACpF,MAAMC,EAAY,GAAJvN,EAASwN,EAAY,GAAJvN,EAI/B,OAHAh2B,GAAKsjC,GAGGtjC,GAFRC,GAAKsjC,GAEWtjC,GAAKqjC,EAAQA,EAAQC,EAAQA,IAD7CF,EAAS,EAAMA,GACsDF,EACzDC,GAEM,WAAXn+B,IAAqB/E,KAAKgjC,WAAa,SAASljC,EAAGC,EAAG81B,EAAGC,EAAGmN,EAAOC,EAAOC,GACjF,OAAIjjC,KAAKoZ,SAAW6pB,EAAeD,EACvBD,KAGZjjC,KAAKgjC,aACPhjC,KAAKsjC,iBAAkB,IAAKpC,MAAQqC,UACpCvjC,KAAK0iC,mBAAqBzpB,GAAY,MAG1CjZ,KAAKuiC,SAAWQ,EASXljC,YAAYkjC,GAA2C/iC,KAAKwjC,SAAWT,EAQvEljC,cAAckjC,GAAoD/iC,KAAKyjC,WAAaV,EASpFljC,aAAaL,EAAeC,GACjCO,KAAK61B,EAAIr2B,EACTQ,KAAK81B,EAAIr2B,EAaJI,gBAAgBxB,GACrB2B,KAAKyiC,aAAepkC,EACpB2B,KAAKwiC,cAAe,EAkBf3iC,OAAOC,EAAYC,GACxBD,EAAIA,GAAK,EACTC,EAAIA,GAAK,EAGT,MAAM6J,EAAK9J,EAAIE,KAAK8zB,SAAS6N,GACvB53B,EAAKhK,EAAIC,KAAK8zB,SAAS8N,GACvB8B,GAAU,IAAKxC,MAAQqC,UAC7B,IAAII,EAIAhjC,EAHAX,KAAKgjC,YAAchjC,KAAKsjC,kBAAiBK,GAAaD,EAAU1jC,KAAKsjC,iBAAmBtjC,KAAK0iC,oBAC7FiB,GAAaA,GAAa,IAAK3jC,KAAKgjC,gBAAa7+B,GAKrD,IAAK,IAAItH,EAAI,EAAGA,EAAImD,KAAK8zB,SAASgC,IAAKj5B,EACrC,IAAK,IAAIlB,EAAI,EAAGA,EAAIqE,KAAK8zB,SAAS+B,IAAKl6B,EAAG,CACxC,MAAMioC,EAAMjoC,EAAIiO,EAAIi6B,EAAMhnC,EAAIkN,EAE9B,GAAI/J,KAAK61B,IAAM+N,EAAM,GAAKA,GAAO5jC,KAAK61B,GACpCl1B,EAAO+yB,QAEF,GAAI1zB,KAAK81B,IAAM+N,EAAM,GAAKA,GAAO7jC,KAAK81B,GAC3Cn1B,EAAO+yB,QAEF,GAAI1zB,KAAKwjC,WAAaxjC,KAAKwjC,SAASI,EAAKC,GAC9CljC,EAAO+yB,QAEF,GAAI1zB,KAAKgjC,aAAehjC,KAAKwiC,aAClC7hC,EAAOX,KAAKgjC,WACVrnC,EACAkB,EACAmD,KAAK8zB,SAAS+B,EACd71B,KAAK8zB,SAASgC,EACd91B,KAAKuiC,SAASqB,EAAKC,GACnB7jC,KAAK6iC,UAAUhmC,GAAGlB,GAClBgoC,GAAa,QAGV,GAAI3jC,KAAKyiC,eAAiBziC,KAAKwiC,aAAc,CAClD,MAAMsB,EAAUF,EAAM5jC,KAAK2iC,OACrBoB,EAAUF,EAAM7jC,KAAK4iC,OACvBkB,GAAW,GAAKA,EAAU9jC,KAAK8zB,SAAS+B,GAAKkO,GAAW,GAAKA,EAAU/jC,KAAK8zB,SAASgC,GACvFn1B,EAAOX,KAAK6iC,UAAUkB,GAASD,MAClBpQ,KAAU/yB,EAAOX,KAAKuiC,SAASqB,EAAKC,IAEjDljC,EAAOX,KAAKuiC,SAASqB,EAAKC,QAEvBljC,EAAOX,KAAKuiC,SAASqB,EAAKC,GAEjC7jC,KAAK8iC,WAAWjmC,GAAGlB,GAAKgF,EAEpBX,KAAKyjC,YAAc9iC,IAAS+yB,KAC9B/yB,EAAOX,KAAKyjC,WAAW9iC,EAAMijC,EAAKC,EAAKH,IAEzC1jC,KAAK8zB,SAASsO,UAAUzhC,EAAMhF,EAAGkB,GAKrCmD,KAAK2iC,OAAS/4B,EACd5J,KAAK4iC,OAAS74B,EAGd,MAAMi6B,EAAYhkC,KAAK6iC,UACvB7iC,KAAK6iC,UAAY7iC,KAAK8iC,WACtB9iC,KAAK8iC,WAAakB,EAClBhkC,KAAKwiC,cAAe,IYtchBxiC,KAAK+gC,KACL,CAACjhC,EAAWC,IAAcC,KAAKikC,QAAQnkC,EAAGC,GAC1CC,KAAKoY,MAAM5Y,MACXQ,KAAKoY,MAAM3Y,QAGbO,KAAKghC,IAAIkD,YAAY,CAACpkC,EAAGC,IAChBC,KAAK8gC,UAAY9gC,KAAK0K,MAAME,GAAG9K,EAAGC,GAAG+T,MAG9C9T,KAAKghC,IAAImD,cAAc,CAACxjC,EAAMb,EAAGC,EAAGqkC,IAC3BpkC,KAAKqkC,SAAS1jC,EAAMb,EAAGC,EAAGqkC,IAGnCE,cAActkC,KAAKihC,cACnBjhC,KAAKihC,aAAesD,YAAY,KAAQvkC,KAAKwkC,aAAexkC,KAAKohC,WAEnEvhC,YACE,MAAMukB,EAAK8c,KAAKC,MACZnhC,KAAKokB,GAAK,IAAOA,IACnBpkB,KAAKokB,GAAKA,GAGZpkB,KAAKghC,IAAIyD,OAAOzkC,KAAK6I,IAAI/I,EAAGE,KAAK6I,IAAI9I,GAErCC,KAAK+gC,KAAK3I,SAEVp4B,KAAK0U,MAAQ,GAEf7U,SAASc,EAAMb,EAAGC,EAAGqkC,GACnB,GAAIpkC,KAAK8gC,SACP,OAAOngC,EAAK+jC,QAAQ,GAEtB,MAAMC,EAAU3kC,KAAK0K,MAAME,GAAG9K,EAAGC,GAEjC,OAAI4kC,EAAQh6B,SAAWhK,EAAK+jC,QACnB/jC,EAAK+jC,QAAQC,EAAQ55B,QAGvBpK,IAGXixB,UACE/xB,QACE,OAAOG,KAAK8gC,SAAW9gC,KAAKoY,MAAQpY,KAAK4C,OAAO0N,YAAYtQ,KAAKoY,QAEnEvY,eACE,OAAO,IAAOG,KAAKohC,UAErBvhC,YACE,IAAIoG,EAAQjG,KAAK0K,MAAME,GAAG5K,KAAK4C,OAAOiG,IAAI/I,EAAGE,KAAK4C,OAAOiG,IAAI9I,GAAGkG,QAChE,OAAOA,GAASA,EAAMpC,QAG1BhE,UACEG,KAAK4kC,gBAEP/kC,gBACEykC,cAActkC,KAAKihC,eAErB4D,OACEhlC,WACEG,KAAK4kC,mBEzKXE,UAAA9oC,OAAAi2B,GAAA,EAAAj2B,CACA6kC,GCTA,WAA0B,IAAa1O,EAAbnyB,KAAaoyB,eAAkD,OAA/DpyB,KAAuCsyB,MAAAD,IAAAF,GAAwB,OAAiB4S,IAAA,QAAAxS,YAAA,sBDY1G,EACA,KACA,KACA,OAIAuS,GAAAjX,QAAAgF,OAAA,YACA,IAAAmS,GAAAF,WEpB8KG,GC6B/JzT,EAAA,EAAIC,QACjB/zB,KAAM,mBACNg0B,OAAQ,OAAQ,OAAQ,OAAQ,YAChCE,UACE/xB,KACE,SAAUG,KAAKklC,kBAEjBrlC,WACE,OAAO7D,OAAAoI,EAAA,IAAApI,CAAIgE,KAAKmlC,KAAKh6B,eC9B3Bi6B,GAAAppC,OAAAi2B,GAAA,EAAAj2B,CACAipC,GCRA,WAA0B,IAAA/S,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAAA8S,OAAoCh/B,GAAA6rB,EAAA7rB,MAAagsB,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAx0B,SAAA20B,EAAA,OAAuCE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiT,KAAAhiC,YAAAkvB,EAAA,aAAqDgT,OAAO7uB,OAAA0b,EAAA7rB,GAAAi/B,SAAA,QAAAC,UAAArT,EAAA7rB,GAAAm/B,UAAA,UAAyEnT,EAAA,OAAaE,YAAA,SAAmBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAuT,aAAApT,EAAA,KAAAA,EAAA,QAAoDE,YAAA,SAAmBL,EAAAS,GAAA,cAAAT,EAAAS,GAAA,KAAAN,EAAA,QAA8CE,YAAA,gBAA0BL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiT,KAAAhiC,cAAAkvB,EAAA,KAAAA,EAAA,QAA0DE,YAAA,SAAmBL,EAAAS,GAAA,kBAAAT,EAAAS,GAAA,KAAAN,EAAA,QAAkDE,YAAA,gBAA0BL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA5mB,iBAAA,YDWnsB,EACA,KACA,KACA,MAIA85B,GAAAvX,QAAAgF,OAAA,uBACA,IAAA6S,GAAAN,WEjBO,MAQMO,GAAa,UAASr5B,MAAEA,EAAO4N,MAAMY,MAAEA,EAAK1Z,IAAEA,GAAKkE,KAAEA,IAChE,IAAI8G,KAAUw5B,GAAetgC,MAASwV,KAAS1Z,IAM/C,OAJIkL,IACFF,OAAYE,KAGPF,GAGIw5B,GAAiB,SAASvrB,GACrC,OAAQA,GACR,KAAKC,GAAWC,MACd,MAAO,KACT,KAAKD,GAAWE,OACd,MAAO,KACT,KAAKF,GAAWG,MACd,MAAO,IACT,KAAKH,GAAWK,MACd,MAAO,KACT,KAAKL,GAAWO,KACd,MAAO,KACT,QACE,MAAO,wBAIEgrB,GAAiB,UAASvgC,KAAEA,EAAInH,MAAEA,IAC7C,OAAQmH,GACR,KAAKmS,GAAe0D,MAClB,UAAWhd,IACb,KAAKsZ,GAAewD,OAClB,UAAW9c,IACb,KAAKsZ,GAAe4D,MAClB,UAAWld,IACb,KAAKsZ,GAAeyD,MAClB,UAAW/c,IACb,KAAKsZ,GAAe2D,UAClB,UAAWjd,IACb,QACE,MAAO,4BC4BX,IC9EmK2nC,GD8EpJtU,EAAA,EAAIC,QACjB/zB,KAAM,QACNg0B,OAAQ,WAAY,YACpBqU,YACEL,qBAEF9T,UACE/xB,gBACE,MAAMuY,EAAepY,KAAKsC,SAAS8V,MACnC,SAAUA,EAAMkL,kBAAqBlL,EAAMoL,mBAAqB,QAElE3jB,cACE,MAAMmmC,EAAuBhmC,KAAKsC,SAASyL,OAC3C,SAAUi4B,EAAUr6B,cAAgBq6B,EAAU56B,SAAW,GAAK,QAEhEvL,cACE,OAAOG,KAAKsC,SAAS4L,YAAY7N,IAAIwlC,IAAgBI,KAAK,OAE5DpmC,UACE,OAAOG,KAAKsC,SAAS6L,QAAQ9N,IAAIslC,IAAYM,KAAK,QAGtDnU,SACEoU,iBAAiBF,GACXA,EAAUr6B,cAAgBq6B,EAAU56B,WAC5B46B,EAAUr6B,kBAAkBq6B,EAAU56B,UAEzC46B,EAAUr6B,gBEjGzBw6B,UAAAnqC,OAAAi2B,GAAA,EAAAj2B,CACA8pC,GCTA,WAA0B,IAAA5T,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,oBAA8BF,EAAA,OAAYE,YAAA,eAAyBF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA5vB,SAAA8V,MAAAjV,YAAAkvB,EAAA,OAAyDE,YAAA,SAAmBL,EAAAS,GAAA,WAAAN,EAAA,OAA8BE,YAAA,aAAuBF,EAAA,OAAYE,YAAA,0BAAA+C,OAA8C91B,MAAA0yB,EAAAkU,eAA2Bf,OAASgB,KAAA,uBAAsBhU,EAAA,OAAkBE,YAAA,YAAsBF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAgU,iBAAAhU,EAAA5vB,SAAAyL,YAAAskB,EAAA,OAAwEE,YAAA,MAAA+C,OAA0B71B,OAAAyyB,EAAAoU,iBAA4BjU,EAAA,oBAA2BE,YAAA,YAAA8S,OAA+BH,KAAA,WAAAxnC,KAAA,KAAA6oC,YAAA,OAAApB,KAAAjT,EAAA5vB,SAAAkK,YAA+E6lB,EAAA,oBAAyBE,YAAA,YAAA8S,OAA+BH,KAAA,YAAAxnC,KAAA,KAAA6oC,YAAA,WAAApB,KAAAjT,EAAA5vB,SAAAyJ,aAAqFsmB,EAAA,oBAAyBE,YAAA,YAAA8S,OAA+BH,KAAA,eAAAxnC,KAAA,KAAA6oC,YAAA,eAAApB,KAAAjT,EAAA5vB,SAAAmK,gBAA+F4lB,EAAA,oBAAyBE,YAAA,YAAA8S,OAA+BH,KAAA,eAAAxnC,KAAA,KAAA6oC,YAAA,YAAApB,KAAAjT,EAAA5vB,SAAA6nB,gBAA4FkI,EAAA,oBAAyBE,YAAA,YAAA8S,OAA+BH,KAAA,SAAAxnC,KAAA,KAAA6oC,YAAA,WAAApB,KAAAjT,EAAA5vB,SAAA8nB,UAA+EiI,EAAA,oBAAyBE,YAAA,YAAA8S,OAA+BH,KAAA,WAAAxnC,KAAA,KAAA6oC,YAAA,UAAApB,KAAAjT,EAAA5vB,SAAA+nB,YAAkFgI,EAAA,OAAYE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAxvB,SAAAhF,WAAA20B,EAAA,OAAkDE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAhkB,kBAAAmkB,EAAA,OAAgDE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA/jB,eAAA,QDYjuD,EACA,KACA,WACA,OAIAg4B,GAAAtY,QAAAgF,OAAA,YACA,IAAA2T,GAAAL,WEpBqKM,GCYtJjV,EAAA,EAAIC,QACjB/zB,KAAM,UACNg0B,OAAQ,WACRI,SACEjyB,KAAKyF,GACH,OAAOA,GACL,KAAKxC,EAAWoM,MACd,MAAO,QACT,KAAKpM,EAAWE,SAEhB,KAAKF,EAAWG,OAEhB,KAAKH,EAAWC,WACd,MAAO,WAGblD,MAAMyF,GACJ,OAAOA,GACL,KAAKxC,EAAWoM,MACd,MAAO,UACT,KAAKpM,EAAWE,SACd,MAAO,WACT,KAAKF,EAAWG,OACd,MAAO,WACT,KAAKH,EAAWC,WACd,MAAO,oBC7BjB2jC,UAAA1qC,OAAAi2B,GAAA,EAAAj2B,CACAyqC,GCTA,WAA0B,IAAAvU,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,SAAoBL,EAAAM,GAAAN,EAAA,iBAAAltB,GAAuC,OAAAqtB,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,OAAA8S,OAA0BsB,IAAA,kBAAAzU,EAAA0U,KAAA5hC,GAAA,UAAqDqtB,EAAA,OAAYE,YAAA,QAAAsU,UAA8BC,YAAA5U,EAAAU,GAAAV,EAAA9C,MAAApqB,iBDYtV,EACA,KACA,WACA,OAIA0hC,GAAA7Y,QAAAgF,OAAA,cACA,IAAAkU,GAAAL,WEpB4KM,GCQ7JxV,EAAA,EAAIC,QACjB/zB,KAAM,WACNg0B,OAAQ,UACRI,SACEjyB,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,IACL,IAAK,aACH,OAAOuB,KAAKinC,OAAOh3B,KAAKzO,EAAUK,OACpC,IAAK,IACL,IAAK,YACH,OAAO7B,KAAKinC,OAAOh3B,KAAKzO,EAAUI,MACpC,IAAK,IACL,IAAK,UACH,OAAO5B,KAAKinC,OAAOh3B,KAAKzO,EAAUE,IACpC,IAAK,IACL,IAAK,YACH,OAAO1B,KAAKinC,OAAOh3B,KAAKzO,EAAUG,MACpC,IAAK,IACH,OAAO3B,KAAKinC,OAAOh3B,KAAKzO,EAAUM,QACpC,IAAK,IACH,OAAO9B,KAAKinC,OAAOh3B,KAAKzO,EAAUO,SACpC,IAAK,IACH,OAAO/B,KAAKinC,OAAOh3B,KAAKzO,EAAUQ,UACpC,IAAK,IACH,OAAOhC,KAAKinC,OAAOh3B,KAAKzO,EAAUS,WAEpC,IAAK,IACH,OAAOjC,KAAKinC,OAAOC,gBACrB,IAAK,IACH,OAAOlnC,KAAKinC,OAAOE,cAErB,IAAK,IACL,IAAK,IACH,OAAOnnC,KAAKinC,OAAOG,cAErB,IAAK,IACH,OAAOpnC,KAAKinC,OAAOI,mBACrB,IAAK,IACH,OAAOrnC,KAAKinC,OAAOK,aACrB,IAAK,IACH,OAAOtnC,KAAKinC,OAAOM,iBACrB,IAAK,IACH,OAAOvnC,KAAKinC,OAAOO,gBACrB,IAAK,IACH,OAAOxnC,KAAKinC,OAAOQ,cACrB,IAAK,IACH,OAAOznC,KAAKinC,OAAOS,eAErB,QACEC,QAAQC,IAAI,QAASt5B,EAAM7P,UCnDnCopC,GAAA7rC,OAAAi2B,GAAA,EAAAj2B,CACAgrC,GCRA,WAA0B,IAAa7U,EAAbnyB,KAAaoyB,eAAkD,OAA/DpyB,KAAuCsyB,MAAAD,IAAAF,GAAwB,YDWzF,EACA,KACA,KACA,MAIA0V,GAAAha,QAAAgF,OAAA,eACA,IAAAiV,GAAAD,WEnByLE,GCoB1KvW,EAAA,EAAIC,QACjBC,OAAQ,UACRr2B,KAAI,MAEA2sC,OAAQ,OAGZlW,SACEjyB,MAAMooC,GACJ,MAAMja,EAASia,GAAqBjoC,KAAKgoC,OACrCha,GACFhuB,KAAKinC,OAAOiB,eAAela,IAG/BnuB,QAAQyO,GACN,OAAOA,EAAM7P,KACb,IAAK,IACHuB,KAAKgoC,OAAShoC,KAAKinC,OAAOpZ,QAAQ,GAClC,MACF,IAAK,IACH7tB,KAAKgoC,OAAShoC,KAAKinC,OAAOpZ,QAAQ,GAClC,MACF,IAAK,IACL,IAAK,QACH7tB,KAAK0vB,QACP,QACE,SAGJyY,SAAS9X,GACA,uBACL,gBACA,oBACA,mBACA,iBACA,iBACA,YACA,aACA,eACA,iBACA,mBACA,cACA,WACA,aACA,eACA,eACA,cACA,iBACA,iBACA,kBACA,cACA,eACA,eACA,eACA,kBACA,iBACA,YACA,aACA,aACA,aACA,iBACA,eACA,gBACAA,MC3ER+X,UAAApsC,OAAAi2B,GAAA,EAAAj2B,CACA+rC,GCTA,WAA0B,IAAA7V,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,6BAAuCF,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA+U,OAAA7X,UAAAiD,EAAA,OAA+CE,YAAA,WAAsBL,EAAAM,GAAAN,EAAA+U,OAAA,iBAAAjZ,GAA8C,OAAAqE,EAAA,OAAiB5zB,IAAAuvB,EAAA3nB,GAAAksB,YAAA,iBAAAE,OAAkDuV,OAAA9V,EAAA8V,QAAA9V,EAAA8V,OAAA3hC,KAAA2nB,EAAA3nB,IAAsD7F,IAAK6nC,MAAA,SAAAC,GAAyBpW,EAAA8V,OAAAha,GAAoBua,SAAA,SAAAD,GAA6BpW,EAAAxC,MAAA1B,OAAoBqE,EAAA,OAAYE,YAAA,OAAA8S,OAA0BsB,IAAAzU,EAAAiW,SAAAna,EAAA3nB,OAA+BgsB,EAAA,OAAYE,YAAA,SAAmBL,EAAAS,GAAAT,EAAAU,GAAA5E,EAAAtwB,cAAkC20B,EAAA,OAAaE,YAAA,WAAqB,OAAAL,EAAA8V,OAAA3V,EAAA,SAAoCgT,OAAOmD,QAAA,WAAoBhoC,IAAK6nC,MAAAnW,EAAAxC,SAAmBwC,EAAAS,GAAA,iBAAAT,EAAAuW,MAAA,UDY/vB,EACA,KACA,KACA,OAIAL,GAAAva,QAAAgF,OAAA,4BACA,IAAA6V,GAAAN,WEAA,ICpBoLO,GDoBrKnX,EAAA,EAAIC,QACjB/zB,KAAM,YACNg0B,OAAQ,UACRr2B,KAAI,MAEAutC,KAAM,EACNC,QAAS,GACTC,cAGJlX,UACE/xB,SACE,OAAOG,KAAKinC,OAAOrkC,QAErB/C,iBAEE,kBADaK,KAAKoB,MAAwC,IAAlCtB,KAAK4C,OAAOM,YAAYC,SAAiB,UACjCnD,KAAK4C,OAAOQ,iBAAiBO,aAGjEmuB,SACEjyB,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,SACH,OAAOuB,KAAKinC,OAAOvX,QACrB,IAAK,QACL,IAAK,IACH,OAAO1vB,KAAKinC,OAAO8B,YAAY/oC,KAAK8oC,SAASzoC,IAAI2oC,GAAShpC,KAAKinC,OAAOxa,UAAUuc,KAClF,QACE,OAAOhpC,KAAKipC,SAAS36B,EAAM7P,IAAIa,WAAW,GA9B5B,MAiClBO,SAASlE,GACHA,GAAK,GAAKA,EAAIuE,KAAKqL,IAAIvL,KAAK6oC,QAAS7oC,KAAKinC,OAAOxa,UAAU5wB,UACzDmE,KAAKinC,OAAO1X,eACdvvB,KAAKinC,OAAOiC,SAASlpC,KAAKinC,OAAOxa,UAAU9wB,IAClCqE,KAAK8oC,SAAS/G,QAAQpmC,IAAM,EACrCqE,KAAK8oC,SAAS/rC,OAAOiD,KAAK8oC,SAAS/G,QAAQpmC,GAAI,GAE/CqE,KAAK8oC,SAAS/sC,KAAKJ,KAIzBwtC,YAAYxtC,GACHyD,OAAOC,aA7CE,GA6C2B1D,GAE7CkE,iBAAiBmpC,GACf,OAAOhpC,KAAK8oC,SAAS/G,QAAQiH,IAAU,GAEzCI,eAAexc,GACRA,EAAS9oB,KAGL,eAFA,GAKXulC,WAAWzc,GACFA,EAAS9oB,KAAKoI,OAAS0gB,EAAS1oB,SEpE7ColC,UAAAttC,OAAAi2B,GAAA,EAAAj2B,CACA2sC,GCTA,WAA0B,IAAAzW,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,QAAaE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA+U,OAAA7X,UAAAiD,EAAA,OAA+CE,YAAA,gBAAAsU,UAAsCC,YAAA5U,EAAAU,GAAAV,EAAAqX,mBAA0ClX,EAAA,SAAcE,YAAA,4BAAuCL,EAAAM,GAAAN,EAAA+U,OAAA,mBAAAra,EAAAoc,GAAwD,OAAA3W,EAAA,MAAgB5zB,IAAAuqC,EAAAvW,MAAAP,EAAAkX,eAAAxc,KAA6CyF,EAAA,MAAWE,YAAA,aAAuBL,EAAAsX,iBAAAR,GAAA3W,EAAA,OAA0CE,YAAA,SAAmBL,EAAAS,GAAA,OAAAT,EAAAuW,OAAApW,EAAA,MAAoCE,YAAA,WAAqBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiX,YAAAH,OAAA3W,EAAA,MAAoDE,YAAA,cAAwBL,EAAAS,GAAA,OAAAN,EAAA,MAAyBE,YAAA,SAAmBL,EAAAS,GAAAT,EAAAU,GAAAhG,EAAA9oB,KAAApG,MAAA,KAAAw0B,EAAAU,GAAAhG,EAAA1oB,OAAA,OAAAmuB,EAAA,MAAgFE,YAAA,WAAqBL,EAAAS,GAAA,IAAAT,EAAAU,GAAAV,EAAAmX,WAAAzc,IAAA,qBDYp0B,EACA,KACA,KACA,OAIA0c,GAAAzb,QAAAgF,OAAA,uBACA,IAAA4W,GAAAH,WEwBA,IC5CmLI,GD4CpKlY,EAAA,EAAIC,QACjBC,OAAQ,UACRr2B,KAAI,MAEA2sC,OAAQ,KACR2B,gBAAiB,IAGrB/X,UACE/xB,SACE,OAAOG,KAAKinC,OAAOpZ,QAAQ7tB,KAAK2pC,kBAElC9pC,aACE,OAAOG,KAAKguB,OAAOvC,YAErB5rB,iBACE,IAAI+pC,EAAS,IAAIjqC,MAAM,GACvB,IAAK,IAAIhE,EAAI,EAAGA,EAAIiuC,EAAO/tC,OAAQF,IACjCiuC,EAAOjuC,MAGT,IAAIkuC,EAAiB,EAYrB,OAVA7pC,KAAKguB,OAAOlD,QAAQrqB,QAAQ0vB,IACtBA,EAAO3b,SAAW0O,GAAaqN,WACjCv0B,OAAOo0B,OAAOD,GACZ2Z,OAAQ1qC,OAAOC,aA5BL,GA4BkCwqC,OAIhDD,EAAOzZ,EAAOtE,OAAO9vB,KAAKo0B,KAGrByZ,IAGX9X,SACEjyB,MAAMooC,GACJ,MAAM9X,EAAS8X,GAAqBjoC,KAAKgoC,OAEpC7X,GAAUA,EAAO3b,SAAW0O,GAAaqN,YAI9CvwB,KAAKinC,OAAO8C,WAAW/pC,KAAKyrB,WAAWplB,GAAI8pB,EAAO9pB,IAClDrG,KAAKgoC,OAAS,OAEhBnoC,WAAWswB,GACLA,EAAO3b,SAAW0O,GAAaqN,YACjCvwB,KAAKgoC,OAAS7X,IAGlBtwB,QAAQyO,GACN,OAAOA,EAAM7P,KACb,IAAK,IACL,IAAK,QACHuB,KAAK0vB,QACP,QACE1vB,KAAKgqC,eAAevpC,QAAQ8a,GAASA,EAAM9a,QAAQ0vB,IAC7CA,EAAO2Z,SAAWx7B,EAAM7P,MAC1BuB,KAAKgoC,OAAS7X,MAIlB,MAAM6Y,EAAQvkB,SAASnW,EAAM7P,KACzBuqC,GAAS,GAAKA,GAAShpC,KAAKinC,OAAOpZ,QAAQhyB,SAC7CmE,KAAK2pC,gBAAkBX,EAAQ,KAIrCnpC,UAAUswB,GACR,IAAI8Z,KAAS9Z,EAAOrE,QAAQqE,EAAOpE,UACnC,OAAIoE,EAAOrE,MAAQqE,EAAOpE,QACjBke,KAEG9Z,EAAO2Z,UAAUG,KAG/BpqC,aAAaswB,GACX,GAAInwB,KAAKgoC,QAAUhoC,KAAKgoC,OAAO3hC,KAAO8pB,EAAO9pB,GAC3C,MAAO,YAET,OAAO8pB,EAAO3b,QACd,KAAK0O,GAAaqN,UAChB,MAAO,aACT,KAAKrN,GAAawN,YAChB,MAAO,eACT,KAAKxN,GAAauN,UAChB,MAAO,eAGX5wB,SAASywB,GACP,OAAOA,GACL,KAAKoL,GAAeG,yBAClB,MAAO,+BACT,KAAKH,GAAewO,qBAClB,MAAO,2BACT,KAAKxO,GAAeyO,qBAClB,MAAO,2BACT,KAAKzO,GAAe0O,mBAClB,MAAO,yBACT,KAAK1O,GAAe2O,+BAClB,MAAO,qCACT,KAAK3O,GAAe4O,mBAClB,MAAO,4BAIfzF,OACEhlC,kBACEG,KAAKgoC,OAAU,SElJrBuC,UAAAvuC,OAAAi2B,GAAA,EAAAj2B,CACA0tC,GCTA,WAA0B,IAAAxX,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,0CAAA8S,OAA6Dh/B,GAAA,4BAA+BgsB,EAAA,OAAYE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA+U,OAAA7X,UAAAiD,EAAA,UAAkDE,YAAA,YAAA8S,OAA+BmF,KAAA,IAAUC,OAAQtsC,MAAA+zB,EAAA,gBAAAwY,SAAA,SAAAC,GAAqDzY,EAAAyX,gBAAAgB,GAAwBC,WAAA,oBAA+B1Y,EAAAM,GAAAN,EAAA+U,OAAArkC,OAAA,qBAAA6oB,GAA6D,OAAA4G,EAAA,SAAmB5zB,IAAAgtB,EAAAplB,GAAAg/B,OAAyBjW,MAAA3D,EAAA/tB,KAAAmtC,UAAA,SAAwCxY,EAAA,SAAeE,YAAA,WAAsBL,EAAAM,GAAAN,EAAA,wBAAA3W,EAAA5f,GAA+C,OAAA02B,EAAA,MAAgB5zB,IAAA9C,GAAMu2B,EAAAM,GAAA,WAAArC,EAAAtzB,GAAmC,OAAAw1B,EAAA,MAAgB5zB,IAAA5B,EAAA01B,YAAA,SAAyBF,EAAA,OAAYE,YAAA,cAAAE,MAAAP,EAAA4Y,aAAA3a,GAAAkV,OAAgEh/B,GAAAxJ,EAAA,cAAAlB,EAAA6sC,QAAA,WAA6ChoC,IAAK6nC,MAAA,SAAAC,GAAyBpW,EAAA6X,WAAA5Z,IAAuBoY,SAAA,SAAAD,GAA6BpW,EAAAxC,MAAAS,OAAoBkC,EAAA,OAAYE,YAAA,OAAA8S,OAA0BsB,IAAA,kBAAAzU,EAAAiW,SAAAhY,EAAA9pB,OAAmDgsB,EAAA,QAAaE,YAAA,UAAoBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAA6Y,UAAA5a,OAAAkC,EAAA,aAA0DgT,OAAO7uB,OAAA3Z,EAAA,cAAAlB,EAAA2pC,SAAA,QAAAC,UAAA,6BAAsFlT,EAAA,KAAWE,YAAA,SAAmBL,EAAAS,GAAAT,EAAAU,GAAAzC,EAAAzyB,SAAA20B,EAAA,SAAAA,EAAA,KAAoDE,YAAA,SAAmBL,EAAAS,GAAA,WAAAT,EAAAU,GAAAzC,EAAArE,MAAA,IAAAoG,EAAAU,GAAAzC,EAAApE,YAAA,iBAAAmG,EAAA4Y,aAAA3a,GAAAkC,EAAA,KAA4HE,YAAA,iBAA2BL,EAAAS,GAAA,aAAAT,EAAAU,GAAAzC,EAAAtE,MAAAqG,EAAAzG,WAAAV,WAAA,YAAAmH,EAAAU,GAAAV,EAAAzG,WAAA/tB,SAAAw0B,EAAAuW,KAAApW,EAAA,KAAkIE,YAAA,gBAA0BL,EAAAS,GAAAT,EAAAU,GAAAzC,EAAAnE,oBAAA,eAAuD,OAAAkG,EAAA8V,OAAA3V,EAAA,SAAqCgT,OAAOmD,QAAA,WAAoBhoC,IAAK6nC,MAAA,SAAAC,GAAyBpW,EAAAxC,YAAcwC,EAAAS,GAAA,iBAAAT,EAAAuW,MAAA,QDYvyD,EACA,KACA,KACA,OAIA8B,GAAA1c,QAAAgF,OAAA,sBACA,IAAAmY,GAAAT,WE2BA,IC/CiLU,GD+ClKzZ,EAAA,EAAIC,QACjB/zB,KAAM,YACNg0B,OAAQ,UACRr2B,KAAI,MAEAutC,KAAM,EACNC,QAAS,KAGbjX,UACE/xB,SACE,OAAOG,KAAKinC,OAAOrkC,QAErB/C,iBAEE,kBADaK,KAAKoB,MAAwC,IAAlCtB,KAAK4C,OAAOM,YAAYC,SAAiB,UACjCnD,KAAK4C,OAAOQ,iBAAiBO,aAGjEmuB,SACEjyB,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,IACL,IAAK,SACH,OAAOuB,KAAKinC,OAAOvX,QACrB,QACE,OAAO1vB,KAAKipC,SAAS36B,EAAM7P,IAAIa,WAAW,GA3B5B,MA8BlBO,SAASlE,GACP,GAAIA,GAAK,GAAKA,EAAIuE,KAAKqL,IAAIvL,KAAK6oC,QAAS7oC,KAAKinC,OAAOxa,UAAU5wB,QAAS,CACtE,MAAM+wB,EAAW5sB,KAAKinC,OAAOxa,UAAU9wB,GACnCixB,EAAS9oB,KACX9D,KAAKinC,OAAO3nB,QAAQsN,GACXA,EAASG,eAAelxB,QACjCmE,KAAKinC,OAAOnmB,MAAM8L,KAIxB/sB,gBAAgB+sB,GACd,GAAIA,EAAS9oB,MAAQ8oB,EAAS9oB,KAAK2X,cACjC,OzBrFuB,SAAS3X,GACtC,OAAIA,aAAgBkY,GACXlY,EAAKqK,QAAQ9N,IAAIslC,IAAYM,KAAK,KAChCniC,aAAgBsY,GAClBtY,EAAKoK,YAAY7N,IAAIwlC,IAAgBI,KAAK,UAD5C,EyBkFMiF,CAAgBte,EAAS9oB,OAGpCqlC,YAAYxtC,GACHyD,OAAOC,aA9CE,GA8C2B1D,GAE7CytC,eAAexc,GACRA,EAAS9oB,KAGL,eAFA,GAKXqnC,gBAAgBC,GACPA,EAAS1tC,KAElBmC,YAAYiE,GACV,GAAIA,EACF,SAAU47B,GAAY57B,GAAMunC,aAAavnC,EAAKpG,QAGlD4tC,SAAS1e,GACHA,EAAS9oB,MAAQ8oB,EAAS1oB,SAClB0oB,EAAS9oB,KAAKpG,QAAQkvB,EAAS1oB,MAAQ,MAAQ0oB,EAAS1oB,SAAW,KAEtE,IAGXrE,WAAW+sB,GACT,GAAIA,EAAS9oB,MAAQ8oB,EAAS1oB,MAC5B,UAAW0oB,EAAS9oB,KAAKoI,OAAS0gB,EAAS1oB,YAG/C2sB,UAAUjE,GACDA,EAAS9oB,MAAQ8oB,EAASG,eAAelxB,OAElDgE,gBAAgB+sB,GACd,OAAO5sB,KAAK6wB,UAAUjE,GAAY,aAAe,mBEpHvD2e,UAAAvvC,OAAAi2B,GAAA,EAAAj2B,CACAivC,GCTA,WAA0B,IAAA/Y,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,aAAuBL,EAAAS,GAAA,eAAAN,EAAA,OAAkCE,YAAA,gBAAAsU,UAAsCC,YAAA5U,EAAAU,GAAAV,EAAAqX,mBAA0ClX,EAAA,SAAcE,YAAA,0BAAqCL,EAAAM,GAAAN,EAAA+U,OAAA,mBAAAra,EAAAoc,GAAwD,OAAA3W,EAAA,MAAgB5zB,IAAAuqC,EAAAvW,MAAAP,EAAAsZ,gBAAA5e,KAA8CyF,EAAA,MAAWE,YAAA,SAAmBF,EAAA,QAAaE,YAAA,WAAqBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiX,YAAAH,OAAA3W,EAAA,QAAsDE,YAAA,SAAmBL,EAAAS,GAAA,OAAAN,EAAA,QAA2BE,YAAA,SAAmBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiZ,gBAAAve,EAAAC,mBAAAwF,EAAA,QAA2EE,YAAA,cAAwBL,EAAAS,GAAA,SAAAN,EAAA,MAA2BE,YAAA,cAAwBF,EAAA,QAAaE,YAAA,OAAAE,MAAAP,EAAAkX,eAAAxc,KAAsDsF,EAAAS,GAAAT,EAAAU,GAAAV,EAAAoZ,SAAA1e,OAAAyF,EAAA,SAAuDE,YAAA,UAAAsU,UAAgCC,YAAA5U,EAAAU,GAAAV,EAAAuZ,gBAAA7e,SAAqDyF,EAAA,MAAaE,YAAA,WAAqBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAmX,WAAAzc,mBDYjgC,EACA,KACA,KACA,OAIA2e,GAAA1d,QAAAgF,OAAA,oBACA,IAAA6Y,GAAAH,WEpB4KI,GCU7Jna,EAAA,EAAIC,QACjB/zB,KAAM,WACNg0B,OAAQ,UACRE,UACE/xB,QACE,OAAQG,KAAKinC,OAAO7X,OACpB,KAAKjM,GAAwB2M,IAC3B,MAAO,WACT,KAAK3M,GAAwB4M,OAC3B,MAAO,gBACT,KAAK5M,GAAwB6M,OAC3B,MAAO,kBACT,QACE,OAAOhwB,KAAKinC,OAAO7X,SAIzB0C,SACEjyB,MAAM+rC,GACJ5rC,KAAKinC,OAAO4E,QAAQD,IAEtB/rC,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,IACL,IAAK,aACH,OAAOuB,KAAKinC,OAAO6E,WAAWtqC,EAAUK,OAC1C,IAAK,IACL,IAAK,YACH,OAAO7B,KAAKinC,OAAO6E,WAAWtqC,EAAUI,MAC1C,IAAK,IACL,IAAK,UACH,OAAO5B,KAAKinC,OAAO6E,WAAWtqC,EAAUE,IAC1C,IAAK,IACL,IAAK,YACH,OAAO1B,KAAKinC,OAAO6E,WAAWtqC,EAAUG,MAC1C,IAAK,IACH,OAAO3B,KAAKinC,OAAO6E,WAAWtqC,EAAUM,QAC1C,IAAK,IACH,OAAO9B,KAAKinC,OAAO6E,WAAWtqC,EAAUO,SAC1C,IAAK,IACH,OAAO/B,KAAKinC,OAAO6E,WAAWtqC,EAAUQ,UAC1C,IAAK,IACH,OAAOhC,KAAKinC,OAAO6E,WAAWtqC,EAAUS,WAE1C,IAAK,SACL,IAAK,IACHjC,KAAKinC,OAAOvX,aChDpBqc,UAAA/vC,OAAAi2B,GAAA,EAAAj2B,CACA2vC,GCTA,WAA0B,IAAAzZ,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,eAAyBF,EAAA,OAAYE,YAAA,QAAAsU,UAA8BC,YAAA5U,EAAAU,GAAAV,EAAA9C,UAAiC8C,EAAAM,GAAAN,EAAA+U,OAAA,cAAAxQ,GAAyC,OAAApE,EAAA,OAAiBwU,UAAUC,YAAA5U,EAAAU,GAAA6D,SAA6B,QDY/S,EACA,KACA,WACA,OAIAsV,GAAAle,QAAAgF,OAAA,eACA,IAAAmZ,GAAAD,WEpB+KE,GCQhKza,EAAA,EAAIC,QACjB/zB,KAAM,cACNg0B,OAAQ,UACRI,SACEjyB,MAAM+rC,GACJ5rC,KAAKinC,OAAO4E,QAAQD,IAEtB/rC,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,IACL,IAAK,aACH,OAAOuB,KAAKinC,OAAO6E,WAAWtqC,EAAUK,OAC1C,IAAK,IACL,IAAK,YACH,OAAO7B,KAAKinC,OAAO6E,WAAWtqC,EAAUI,MAC1C,IAAK,IACL,IAAK,UACH,OAAO5B,KAAKinC,OAAO6E,WAAWtqC,EAAUE,IAC1C,IAAK,IACL,IAAK,YACH,OAAO1B,KAAKinC,OAAO6E,WAAWtqC,EAAUG,MAC1C,IAAK,IACH,OAAO3B,KAAKinC,OAAO6E,WAAWtqC,EAAUM,QAC1C,IAAK,IACH,OAAO9B,KAAKinC,OAAO6E,WAAWtqC,EAAUO,SAC1C,IAAK,IACH,OAAO/B,KAAKinC,OAAO6E,WAAWtqC,EAAUQ,UAC1C,IAAK,IACH,OAAOhC,KAAKinC,OAAO6E,WAAWtqC,EAAUS,WAE1C,IAAK,IACHjC,KAAKinC,OAAOiF,aACZ,MACF,IAAK,IACHlsC,KAAKinC,OAAOkF,iBACZ,MACF,IAAK,IACHnsC,KAAKinC,OAAOp7B,SACZ,MACF,IAAK,SACH7L,KAAKinC,OAAOvX,aCzCpB0c,GAAApwC,OAAAi2B,GAAA,EAAAj2B,CACAiwC,GCRA,WAA0B,IAAa9Z,EAAbnyB,KAAaoyB,eAAkD,OAA/DpyB,KAAuCsyB,MAAAD,IAAAF,GAAwB,YDWzF,EACA,KACA,KACA,MAIAia,GAAAve,QAAAgF,OAAA,kBACA,IAAAwZ,GAAAD,WEnB6KE,GCc9J9a,EAAA,EAAIC,QACjB/zB,KAAM,YACNg0B,OAAQ,UACRE,UACE/xB,UACE,OAAQG,KAAKinC,OAAOjvB,WACpB,KAAKzU,GAAUuZ,OACb,MAAO,sEACT,KAAKvZ,GAAUsY,QACb,MAAO,0EACT,KAAKtY,GAAU8D,KACb,MAAO,wCACT,KAAK9D,GAAUR,WACb,MAAO,uDACT,QACE,MAAO,mEAGXlD,YACE,mBAAoBG,KAAKinC,OAAO/uB,6BAGpC4Z,SACEjyB,QAAQyO,QC7BZi+B,UAAAvwC,OAAAi2B,GAAA,EAAAj2B,CACAswC,GCTA,WAA0B,IAAana,EAAbnyB,KAAaoyB,eAA0BC,EAAvCryB,KAAuCsyB,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,OAAYE,YAAA,aAAvHvyB,KAA8I2yB,GAAA,aAAAN,EAAA,OAAgCE,YAAA,iBAA2BF,EAAA,cAAmBE,YAAA,qCAA+CF,EAAA,KAAUE,YAAA,OAAAsU,UAA6BC,YAAlT9mC,KAAkT4yB,GAAlT5yB,KAAkTgI,YAAmCqqB,EAAA,UAAeE,YAAA,oBAAAsU,UAA0CC,YAA9Y9mC,KAA8Y4yB,GAA9Y5yB,KAA8YwsC,yBDYxa,EACA,KACA,KACA,OAIAD,GAAA1e,QAAAgF,OAAA,gBACA,IAAA4Z,GAAAF,WEFA,IClBwLG,GDkBzKlb,EAAA,EAAIC,QACjB/zB,KAAM,uBACNg0B,OAAQ,UACRr2B,KAAI,MAEAutC,KAAM,EACNC,QAAS,GACTC,cAGJlX,UACE/xB,QACE,OAAQG,KAAKinC,OAAO3hC,MACpB,KAAK8R,GAAc2W,iBACjB,MAAO,8BAIb+D,SACEjyB,WAAWmuB,GACT,OAAQhuB,KAAKinC,OAAO3hC,MACpB,KAAK8R,GAAc2W,iBACjB,OAAOC,EAAO,KAGlBnuB,QAAQyO,GACN,OAAQA,EAAM7P,KACd,IAAK,SACH,OAAOuB,KAAKinC,OAAOvX,QACrB,IAAK,QACL,IAAK,IACH,OAAO1vB,KAAKinC,OAAO8B,YAAY/oC,KAAK8oC,SAASzoC,IAAI2oC,GAAShpC,KAAKinC,OAAOxa,UAAUuc,KAClF,QACE,OAAOhpC,KAAKipC,SAAS36B,EAAM7P,IAAIa,WAAW,GAnC5B,MAsClBO,SAASlE,GACHA,GAAK,GAAKA,EAAIuE,KAAKqL,IAAIvL,KAAK6oC,QAAS7oC,KAAKinC,OAAOpZ,QAAQhyB,SAC3DmE,KAAKinC,OAAOljB,KAAK/jB,KAAKinC,OAAOpZ,QAAQlyB,KAGzCwtC,YAAYxtC,GACHyD,OAAOC,aA5CE,GA4C2B1D,MEpDjDgxC,UAAA3wC,OAAAi2B,GAAA,EAAAj2B,CACA0wC,GCTA,WAA0B,IAAAxa,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,iBAA2BF,EAAA,QAAaE,YAAA,QAAAsU,UAA8BC,YAAA5U,EAAAU,GAAAV,EAAA9C,UAAiCiD,EAAA,SAAcE,YAAA,0BAAqCL,EAAAM,GAAAN,EAAA+U,OAAA,iBAAAjZ,EAAAgb,GAAoD,OAAA3W,EAAA,MAAgB5zB,IAAAuqC,IAAU3W,EAAA,MAAWE,YAAA,WAAqBL,EAAAS,GAAAT,EAAAU,GAAAV,EAAAiX,YAAAH,OAAA3W,EAAA,MAAoDE,YAAA,cAAwBL,EAAAS,GAAA,OAAAN,EAAA,MAAyBE,YAAA,OAAAsU,UAA6BC,YAAA5U,EAAAU,GAAAV,EAAA0a,WAAA5e,mBDYpf,EACA,KACA,WACA,OAIA2e,GAAA9e,QAAAgF,OAAA,2BACA,IAAAga,GAAAF,oBEpBiKG,GCsDlJtb,EAAA,EAAIC,QACjBp2B,KAAI,MAEAsH,MAAM,UxDzBV9C,cACEG,KAAK2C,KAAO,IAAI07B,GAAOr+B,KAAK+sC,cAE5B,MAAMC,EAAU,IAAI/O,GACpB+O,EAAQC,SAASjtC,KAAK2C,MACtBqqC,EAAQl9B,MAAM9P,KAAK2C,KAAM3C,KAAK2C,KAAKC,QAEnC,MAAMA,EAAS5C,KAAK2C,KAAKC,OACvBsqC,EAAOltC,KAAK2C,KAAKqjB,iBAAiB6K,UAAUjuB,GAAQ,GAElDsqC,GACFtqC,EAAOqnB,YAAYluB,KAAKmxC,GAG1B,MAAMC,EAAS,IAAIjxB,GAAc,SAAU,KACvC5W,KAAMgV,GAAWC,MAAOL,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,KAEzD8gC,EAAS,IAAIlxB,GAAc,SAAU,IACvC5W,KAAMgV,GAAWC,MAAOL,MAAQY,MAAO,EAAG1Z,IAAK,GAAKkL,MAAO,KAEzD+gC,EAAa,IAAIhxB,GAAU,OAAQ,IACrC/W,KAAMmS,GAAe4D,MAAOld,MAAO,KAGjCmvC,EAAS1Q,KACT2Q,EAAO1Q,KACP2Q,EAAO7Q,KAEP8Q,EAAM/Q,KAEZ,GAAI18B,KAAK2C,KAAKoE,WAAY,CACxB,MAAMpG,EAAOX,KAAK2C,KAAKoE,WAAWkN,aAAarR,GAE/CjC,EAAK8b,QAAQ0wB,EAAQ,GACrBxsC,EAAK8b,QAAQ2wB,EAAQ,GACrBzsC,EAAK8b,QAAQ4wB,EAAY,GACzB1sC,EAAK8b,QAAQ6wB,EAAQ,GACrB3sC,EAAK8b,QAAQ8wB,EAAM,GACnB5sC,EAAK8b,QAAQ+wB,EAAM,GACnB7sC,EAAK8b,QAAQgxB,EAAK,GAElB7qC,EAAOpC,GACL,IAAI4T,GACFzT,IAEImD,KAAMqpC,EAAQjpC,MAAO,IACrBJ,KAAMspC,EAAQlpC,MAAO,IACrBJ,KAAMupC,EAAYnpC,MAAO,IACzBJ,KAAMwpC,EAAQppC,MAAO,IACrBJ,KAAMypC,EAAMrpC,MAAO,IACnBJ,KAAM0pC,EAAMtpC,MAAO,IACnBJ,KAAM2pC,EAAKvpC,MAAO,IAEtBlE,KAAK2C,OAITC,EAAOpC,GACL,IAAIggB,GAAe5d,EAAO4c,UAAU+I,kBAAmBklB,EAAKztC,KAAK2C,OAEnEC,EAAOpC,GACL,IAAIggB,GAAe5d,EAAO4c,UAAUU,YAAaotB,EAAQttC,KAAK2C,OAEhEC,EAAOpC,GACL,IAAIggB,GAAe5d,EAAO4c,UAAUwJ,cAAeokB,EAAQptC,KAAK2C,OAElEC,EAAOpC,GACL,IAAIggB,GAAe5d,EAAO4c,UAAUuJ,UAAWskB,EAAYrtC,KAAK2C,OAGlEC,EAAO6Z,QAAQ,IAAIqgB,GAAmB,GAEtC98B,KAAK2C,KAAKsF,OAAO4H,SAIXhQ,aACR,OAAO,IAAIiqB,GACT,IAAI1G,IAAO,EAAG,EAAG,EAAG,GAAI,KACxB,IAAI1K,IAEFhb,KAAM,SACNwO,OAAQ,GACR+B,KAAMb,EAAK4D,OACX3C,UAAWf,EACXY,eACAC,WACApB,eAAgB,GAChBC,iBAAkB,GAClBC,kBAAmB,EACnBoC,eACAT,aAAc,GACdJ,UAAW,GACXqvB,YAAa,GACb1uB,YAAa,GAEf,GACA,OwDxEwBxM,KACxByhB,GAAI8c,KAAKC,MACTuM,oBAAgBvpC,IAGpB4hC,YACEgB,WACA4G,OAAA7a,GACAkS,SACAwB,UAEF5U,UACE/xB,gBACE,OAAQG,KAAK2C,KAAKuR,IAAMlU,KAAK2C,KAAKuR,GAAG0D,WAAa5X,KAAK2C,KAAKuR,GAAG0D,UAAUtS,MACzE,KAAK8R,GAAc8Y,iBACjB,OAAO8a,GACT,KAAK5zB,GAAcwZ,kBACjB,OAAO8X,GACT,KAAKtxB,GAAciX,KACjB,OAAOyZ,GACT,KAAK1wB,GAAc+X,aACjB,OAAOsa,GACT,KAAKryB,GAAc5J,UACjB,OAAOk+B,GACT,KAAKt0B,GAAcyE,QACjB,OAAOwwB,GACT,KAAKj1B,GAAcmV,cACnB,KAAKnV,GAAcyY,KAEjB,OAAOmc,GACT,KAAK50B,GAAca,MACjB,OAAOw0B,GACT,KAAKr1B,GAAc2W,iBACjB,OAAO8e,GACT,QACE,+BAAgC7sC,KAAK2C,KAAKuR,GAAG0D,eAInDka,SACEjyB,OACEG,KAAK2C,KAAKkD,QAEZhG,QAAQyO,GACN,MAAMylB,EAAO/zB,KAAKqiC,MAAMuL,cACpB7Z,GACFA,EAAK8Z,QAAQv/B,KAInBzO,UACEG,KAAK0tC,eAAiB1xC,OAAA8xC,GAAA,YAAA9xC,CAAYgE,KAAK+tC,KAAM,IAC7C9Z,SAAS+Z,iBAAiB,UAAWhuC,KAAK6tC,UAE5ChuC,gBACE7D,OAAA8xC,GAAA,cAAA9xC,CAAcgE,KAAK0tC,gBACnBzZ,SAASga,oBAAoB,UAAWjuC,KAAK6tC,YCzGjDK,UAAAlyC,OAAAi2B,GAAA,EAAAj2B,CACA8wC,GCTA,WAA0B,IAAA5a,EAAAlyB,KAAamyB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAD,EAAA,KAAAG,EAAA,OAA4BE,YAAA,kBAAA8S,OAAqCh/B,GAAA,SAAY6rB,EAAAvvB,KAAA,OAAA0vB,EAAA,SAAgCE,YAAA,QAAA8S,OAA2BjtB,MAAA8Z,EAAAvvB,KAAAoE,WAAAnE,OAAAsvB,EAAAvvB,KAAAC,OAAAiG,IAAAqpB,EAAAvvB,KAAAoE,WAAAc,YAAAqqB,EAAAvvB,KAAAC,WAA6GsvB,EAAAuW,KAAAvW,EAAAvvB,KAAA,OAAA0vB,EAAA,SAAyCE,YAAA,eAAA8S,OAAkC/iC,SAAA4vB,EAAAvvB,KAAAC,OAAAurC,YAAAjc,EAAAvvB,KAAAoE,cAA4DmrB,EAAAuW,KAAApW,EAAA,UAAwBE,YAAA,eAAA8S,OAAkCp9B,OAAAiqB,EAAAvvB,KAAAsF,UAA0BoqB,EAAA,WAAgBE,YAAA,eAAA8S,OAAkCngC,QAAAgtB,EAAAvvB,KAAAC,OAAAsC,WAAmCgtB,EAAAvvB,KAAA,GAAA0vB,EAAAH,EAAA0b,eAAsC7I,IAAA,gBAAAqJ,IAAA,YAAA/I,OAA2C4B,OAAA/U,EAAAvvB,KAAAuR,GAAA0D,aAAgCsa,EAAAuW,MAAA,GAAAvW,EAAAuW,UDY/uB,EACA,KACA,KACA,OAIAyF,GAAArgB,QAAAgF,OAAA,UACA,IAAAwb,GAAAH,sCEhBA1c,EAAA,EAAI8c,IAAIC,GAAA,GAOR,IAAI/c,EAAA,GACFgd,GAAI,OACJpW,OAAQtC,GAAKA,EAAEuY","file":"main.6fe7827b.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/onisun/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([29,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LookView.vue?vue&type=style&index=0&id=500ea8d4&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LookView.vue?vue&type=style&index=0&id=500ea8d4&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js!../node_modules/css-loader/index.js??ref--1-oneOf-2-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/sass-loader/lib/loader.js??ref--1-oneOf-2-2!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","import { min } from 'lodash'\n\nexport class Rect {\n  // TODO: Validate?\n  constructor(\n    public x: number,\n    public y: number,\n    public w: number,\n    public h: number\n  ) {}\n\n  move(x: number, y: number): void {\n    this.x += x\n    this.y += y\n  }\n}\n\n// TODO: Remove this\nexport const succ = function(c: string): string {\n  return String.fromCharCode(c.charCodeAt(0) + 1)\n}\n\nexport const rand = function(max: number): number {\n  return Math.floor(Math.random() * max)\n}\n\nexport const twoDimArray = function<T>(\n  width: number,\n  height: number,\n  value: (x: number, y: number) => T\n): T[][] {\n  let field = Array(width)\n\n  for (let i = 0; i < width; i++) {\n    field[i] = new Array(height)\n    for (let j = 0; j < height; j++) {\n      field[i][j] = value(i, j)\n    }\n  }\n\n  return field\n}\n\nexport class Point {\n  constructor(public x: number, public y: number) {}\n\n  public static readonly dxy = [\n    new Point(-1, -1),\n    new Point(0, -1),\n    new Point(1, -1),\n    new Point(-1, 0),\n    new Point(1, 0),\n    new Point(-1, 1),\n    new Point(0, 1),\n    new Point(1, 1),\n  ]\n\n  public eq(point: Point): boolean {\n    return this.x === point.x && this.y === point.y\n  }\n\n  public nextTo(point: Point): boolean {\n    return Math.abs(this.x - point.x) <= 1 && Math.abs(this.y - point.y) <= 1\n  }\n\n  public copy(): Point {\n    return new Point(this.x, this.y)\n  }\n\n  public add(point: Point): Point {\n    return new Point(this.x + point.x, this.y + point.y)\n  }\n\n  public wrappers(): Point[] {\n    return Point.dxy.map(point => this.add(point))\n  }\n}\n\nexport abstract class Mapped<T> {\n  public readonly width: number\n  public readonly height: number\n\n  constructor(public map: T[][]) {\n    this.width = map.length\n    this.height = map[0].length\n  }\n\n  public at(x: number, y: number): T {\n    return this.map[x][y]\n  }\n\n  public inRange(point: Point): boolean {\n    return (\n      point.x >= 0 &&\n      point.y >= 0 &&\n      point.x < this.width &&\n      point.y < this.height\n    )\n  }\n\n  public each(on: (tile: T, x: number, y: number) => any): void {\n    this.map.forEach((column, x) => {\n      column.forEach((tile, y) => {\n        on(tile, x, y)\n      })\n    })\n  }\n}\n\nexport const cycle = function(list: any[], dx: number): any[] {\n  let x\n  if (dx > 0) {\n    for (let i = 0; i < dx; i++) {\n      x = list.pop()\n      list.unshift(x)\n    }\n  } else if (dx < 0) {\n    for (let i = dx; i < 0; i++) {\n      x = list.shift()\n      list.push(x)\n    }\n  }\n\n  return list\n}\n\nexport const bresenham = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  let [x0, x1, y0, y1] = [p0.x, p1.x, p0.y, p1.y]\n  let steps = Math.max(Math.abs(x0 - x1), Math.abs(y0 - y1))\n  const delta = new Point((x1 - x0) / steps, (y1 - y0) / steps)\n\n  while (steps > 1) {\n    x0 += delta.x\n    y0 += delta.y\n\n    on(Math.round(x0), Math.round(y0))\n\n    steps -= 1\n  }\n}\n\nexport const bresenhamInclusion = function(\n  p0: Point,\n  p1: Point,\n  on: (x: number, y: number) => void\n): void {\n  bresenham(p0, p1, on)\n  on(p1.x, p1.y)\n}\n\nexport class Direction extends Point {\n  private constructor(x: number, y: number) {\n    super(x, y)\n  }\n\n  static readonly up = new Direction(0, -1)\n  static readonly down = new Direction(0, 1)\n  static readonly left = new Direction(-1, 0)\n  static readonly right = new Direction(1, 0)\n\n  static readonly upLeft = new Direction(-1, -1)\n  static readonly upRight = new Direction(1, -1)\n  static readonly downLeft = new Direction(-1, 1)\n  static readonly downRight = new Direction(1, 1)\n}\n\nexport const minUnsafe = function<T>(list: T[]): T {\n  const elem = min(list)\n  if (elem !== undefined) {\n    return elem\n  }\n\n  throw 'minUnsafe got empty array'\n}\n","import { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\n\nexport abstract class CreatureEvent {\n  public abstract affectCreature(subject: Creature): Reaction\n  public affectPlayer(subject: Player): Reaction {\n    return this.affectCreature(subject)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\n\nexport class PlayerEvent extends CreatureEvent {\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n}\n","import { DieEvent, DieReason, Game, ImpactType, LevelMap } from '../../engine'\nimport { Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { PlayerEvent } from './player_event'\n\nexport class AfterEvent extends PlayerEvent {\n  constructor(private levelMap: LevelMap, private game: Game) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    player.removeImpact(ImpactType.Overloaded, 'bag')\n    player.removeImpact(ImpactType.Stressed, 'bag')\n    player.removeImpact(ImpactType.Loaded, 'bag')\n\n    if (player.stuffWeight.current > player.carryingCapacity.flattenedStart) {\n      return player.on(\n        new DieEvent(this.game, this.levelMap, DieReason.Overloaded)\n      )\n    }\n\n    if (player.stuffWeight.current > player.carryingCapacity.overloadedStart) {\n      player.addImpact(ImpactType.Overloaded, 'bag')\n    } else if (\n      player.stuffWeight.current > player.carryingCapacity.loadedStart\n    ) {\n      player.addImpact(ImpactType.Loaded, 'bag')\n    } else if (player.stuffWeight.current > player.carryingCapacity.stressed) {\n      player.addImpact(ImpactType.Stressed, 'bag')\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { remove } from 'lodash'\n\ninterface Grouping {\n  groupsWith(item: Grouping): boolean\n}\n\nexport interface GroupedItem<Item> {\n  count: number\n  item: Item\n}\n\nexport class ItemsBunch<Item extends Grouping> {\n  public bunch: GroupedItem<Item>[] = []\n\n  public find(item: Item): GroupedItem<Item> | undefined {\n    return this.bunch.find(invItem => invItem.item.groupsWith(item))\n  }\n\n  public remove(item: Item, count: number): void {\n    const invItem = this.find(item)\n\n    if (invItem === undefined) {\n      // TODO: Fail if removes item that's not in bunch yet?\n      return\n    } else if (invItem.count === count) {\n      remove(this.bunch, inventoryItem =>\n        inventoryItem.item.groupsWith(invItem.item)\n      )\n    } else {\n      invItem.count -= count\n    }\n  }\n\n  public put(item: Item, count: number): void {\n    const invItem = this.bunch.find(inv => inv.item.groupsWith(item))\n\n    if (invItem) {\n      invItem.count += count\n    } else {\n      this.bunch.push({ count: count, item: item })\n    }\n  }\n\n  public clone(): ItemsBunch<Item> {\n    let bunch = new ItemsBunch<Item>()\n\n    this.bunch.forEach(groupedItem => {\n      bunch.put(groupedItem.item, groupedItem.count)\n    })\n\n    return bunch\n  }\n}\n","import { remove } from 'lodash'\n\nexport enum ImpactType {\n  Blind, // TODO: Do not display messages while being blind\n  Stressed,\n  Loaded,\n  Overloaded,\n}\n\nclass Impact {\n  private constEffects: string[] = []\n  private tempEffects: number = 0\n\n  constructor() {}\n\n  public addTempEffect(turns: number): void {\n    this.tempEffects += turns\n  }\n\n  public addConstEffect(effect: string): void {\n    // TODO: Validate keys do not repeat\n    this.constEffects.push(effect)\n  }\n\n  public removeTempEffect(): void {\n    this.tempEffects = 0\n  }\n\n  public removeConstEffect(effect: string): void {\n    remove(this.constEffects, impact => impact === effect)\n  }\n\n  public active(): boolean {\n    return this.tempEffects > 0 || this.constEffects.length > 0\n  }\n\n  public turn(): void {\n    if (this.tempEffects >= 1) {\n      this.tempEffects -= 1\n    }\n  }\n}\n\nexport class ImpactBunch {\n  private impacts: Map<ImpactType, Impact> = new Map()\n\n  get activeImpacts(): ImpactType[] {\n    let types: ImpactType[] = []\n\n    this.impacts.forEach((impact, type) => {\n      if (impact.active()) {\n        types.push(type)\n      }\n    })\n\n    return types\n  }\n\n  public addImpact(type: ImpactType, turns: number): void {\n    this.impactByType(type).addTempEffect(turns)\n  }\n\n  public removeImpact(type: ImpactType): void {\n    this.impactByType(type).removeTempEffect()\n  }\n\n  public addConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).addConstEffect(effect)\n  }\n\n  public removeConstImpact(type: ImpactType, effect: string): void {\n    this.impactByType(type).removeConstEffect(effect)\n  }\n\n  public turn(): void {\n    this.impacts.forEach(impact => impact.turn())\n  }\n\n  protected impactByType(type: ImpactType): Impact {\n    let impact = this.impacts.get(type)\n    if (impact !== undefined) {\n      return impact\n    }\n\n    impact = new Impact()\n    this.impacts.set(type, impact)\n    return impact\n  }\n}\n","import { Creature } from './creature'\nimport { Point } from '../utils/utils'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { Item } from './items'\nimport { Game } from './game'\nimport { ItemsBunch } from '../lib/bunch'\n\nexport enum TileTypes {\n  Wall,\n  Door,\n  Floor,\n  StairwayDown,\n  StairwayUp,\n  Trap,\n  Trigger,\n}\n\nexport abstract class Tile {\n  public creature?: Creature\n  public items: ItemsBunch<Item> | undefined\n\n  constructor(public key: string, public kind: TileTypes) {}\n\n  public addItem(item: Item, count: number): void {\n    if (!this.items) {\n      this.items = new ItemsBunch()\n    }\n\n    this.items.put(item, count)\n  }\n\n  public isFloor(): boolean {\n    return this.kind === TileTypes.Floor\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public passibleThrough(actor?: Creature): boolean {\n    if (actor && this.creature) {\n      return this.kind !== TileTypes.Wall && this.creature.id === actor.id\n    }\n\n    return this.kind !== TileTypes.Wall && !this.creature\n  }\n\n  public abstract visit(tileVisitor: TileVisitor): void\n\n  public clone(): Tile {\n    let tile = this.buildNew()\n\n    if (this.creature) {\n      tile.creature = this.creature\n    }\n    tile.items = this.items && this.items.clone()\n    return tile\n  }\n\n  protected abstract buildNew(): Tile\n}\n\nexport class Floor extends Tile {\n  public visibleThrough(): boolean {\n    return true\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onFloor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Floor(this.key, this.kind)\n  }\n}\n\nexport class Corridor extends Floor {}\n\nexport class Room extends Floor {\n  constructor() {\n    super('R', TileTypes.Floor)\n  }\n}\n\nexport class Door extends Tile {\n  constructor() {\n    super('D', TileTypes.Door)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onDoor(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Door()\n  }\n}\n\nexport class Wall extends Tile {\n  constructor() {\n    super('W', TileTypes.Wall)\n  }\n\n  public visibleThrough(): boolean {\n    return false\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onWall(this)\n  }\n\n  protected buildNew(): Tile {\n    return new Wall()\n  }\n}\n\nexport abstract class Stairway extends Tile {\n  public enterPos: Point | undefined\n\n  constructor(\n    key: string,\n    type: TileTypes,\n    public currentMap: LevelMap,\n    public adjacentMapId: LevelMapId\n  ) {\n    super(key, type)\n  }\n\n  public visibleThrough(): boolean {\n    return true\n  }\n}\n\nexport class StairwayDown extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapId: LevelMapId) {\n    super('>', TileTypes.StairwayDown, currentMap, adjacentMapId)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayDown(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayDown(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport class StairwayUp extends Stairway {\n  constructor(currentMap: LevelMap, adjacentMapId: LevelMapId) {\n    super('<', TileTypes.StairwayUp, currentMap, adjacentMapId)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onStairwayUp(this)\n  }\n\n  protected buildNew(): Tile {\n    return new StairwayUp(this.currentMap, this.adjacentMapId)\n  }\n}\n\nexport enum TrapType {\n  Teleportation,\n  Light,\n}\n\nexport abstract class Trap extends Tile {\n  constructor(public revealed: boolean = false, public readonly type: number) {\n    super('^', TileTypes.Trap)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrap(this)\n  }\n\n  public activate(game: Game, levelMap: LevelMap, actor: Creature): void {\n    this.affect(game, levelMap, actor)\n  }\n\n  public abstract untrap(pos: Point, levelMap: LevelMap, game: Game): void\n\n  protected abstract affect(\n    game: Game,\n    levelMap: LevelMap,\n    actor: Creature\n  ): void\n}\n\nexport abstract class TriggerTile extends Tile {\n  constructor(public singleUse: boolean = true, public tile: Tile) {\n    super('T', TileTypes.Trigger)\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    tileVisitor.onTrigger(this)\n  }\n\n  public activate(game: Game, levelMap: LevelMap, actor: Creature): void {\n    if (this.singleUse) {\n      const { x, y } = levelMap.creaturePos(actor)\n      const tile = this.clone()\n      tile.creature = actor\n      levelMap.setTile(x, y, tile)\n    }\n\n    this.onTrigger(game, levelMap, actor)\n  }\n\n  public buildNew(): Tile {\n    return this.tile.clone()\n  }\n\n  protected abstract onTrigger(\n    game: Game,\n    levelMap: LevelMap,\n    actor: Creature\n  ): void\n}\n\nexport class LogMessageTrigger extends TriggerTile {\n  constructor(private message: string, singleUse: boolean = true, tile: Tile) {\n    super(singleUse, tile)\n  }\n\n  protected onTrigger(game: Game): void {\n    game.logger.info(this.message)\n  }\n}\n\n// TODO: Add return type?\nexport abstract class TileVisitor {\n  public onWall(wall: Wall): void {\n    this.default(wall)\n  }\n\n  public onFloor(floor: Floor): void {\n    this.default(floor)\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.onStairway(stairway)\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.onStairway(stairway)\n  }\n\n  public onDoor(door: Door): void {\n    this.default(door)\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    this.default(trigger)\n  }\n\n  public onTrap(trap: Trap): void {\n    this.default(trap)\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    this.default(stairway)\n  }\n\n  protected default(tile: Tile): void {}\n}\n","import { Fov } from '../utils/fov'\nimport { TileVisitor, Door, Tile } from '../models/tile'\nimport { LevelMap } from '../models/level_map'\nimport { Point } from '../utils/utils'\nimport { Memory } from '../models/memory'\n\nclass VisibilityTileVisitor extends TileVisitor {\n  public visible: boolean = false\n  private x: number | undefined\n  private y: number | undefined\n\n  constructor(private stage: LevelMap, private pos: Point) {\n    super()\n  }\n\n  public isSolid(x: number, y: number): boolean {\n    this.x = x\n    this.y = y\n    this.stage.at(x, y).visit(this)\n    return !this.visible\n  }\n\n  public onDoor(door: Door) {\n    this.visible = this.pos.x === this.x && this.pos.y === this.y\n  }\n\n  protected default(tile: Tile) {\n    if (this.x && this.y) {\n      this.visible = this.stage.visibleThrough(this.x, this.y)\n    }\n  }\n}\n\nexport const buildFov = function(\n  pos: Point,\n  radius: number,\n  memory: Memory,\n  levelMap: LevelMap\n): void {\n  const see = (x: number, y: number, degree: number): void => {\n    memory.at(x, y).see(levelMap.at(x, y), degree)\n  }\n\n  new Fov(\n    pos.x,\n    pos.y,\n    radius,\n    levelMap.width,\n    levelMap.height,\n    new VisibilityTileVisitor(levelMap, pos),\n    see\n  ).calc()\n}\n","interface SolidChecker {\n  isSolid(x: number, y: number): boolean\n}\n\nexport class Fov {\n  private doubleRadius: number\n\n  constructor(\n    private startx: number,\n    private starty: number,\n    private radius: number,\n    private width: number,\n    private height: number,\n    private solidChecker: SolidChecker,\n    private markVisible: (x: number, y: number, degree: number) => void\n  ) {\n    this.doubleRadius = this.radius * this.radius\n  }\n\n  public calc(): void {\n    this.markVisible(this.startx, this.starty, 1)\n\n    if (!this.solidChecker.isSolid(this.startx, this.starty)) {\n      ;[[1, 1], [1, -1], [-1, 1], [-1, -1]].forEach(([dx, dy]) => {\n        this.castLight(1, 1.0, 0.0, 0, dx, dy, 0)\n        this.castLight(1, 1.0, 0.0, dx, 0, 0, dy)\n      })\n    }\n  }\n\n  private castLight(\n    row: number,\n    start: number,\n    end: number,\n    xx: number,\n    xy: number,\n    yx: number,\n    yy: number\n  ) {\n    if (start < end) {\n      return\n    }\n\n    let newStart = 0.0\n    let blocked = false\n\n    for (let distance = row; distance <= this.radius && !blocked; distance++) {\n      let deltaY = -distance\n\n      for (let deltaX: number = -distance; deltaX <= 0; deltaX++) {\n        let currentX = Math.round(this.startx + deltaX * xx + deltaY * xy)\n        let currentY = Math.round(this.starty + deltaX * yx + deltaY * yy)\n        let leftSlope = (deltaX - 0.5) / (deltaY + 0.5)\n        let rightSlope = (deltaX + 0.5) / (deltaY - 0.5)\n\n        if (\n          !(\n            currentX >= 0 &&\n            currentY >= 0 &&\n            currentX < this.width &&\n            currentY < this.height\n          ) ||\n          start < rightSlope\n        ) {\n          continue\n        } else if (end > leftSlope) {\n          break\n        }\n\n        // check if it's within the lightable area and light if needed\n        if (this.doubleDistance(deltaX, deltaY) <= this.doubleRadius) {\n          this.markVisible(\n            currentX,\n            currentY,\n            1 - this.doubleDistance(deltaX, deltaY) / this.doubleRadius\n          )\n        }\n\n        if (blocked) {\n          // previous cell was a blocking one\n          if (this.solidChecker.isSolid(currentX, currentY)) {\n            // hit a wall\n            newStart = rightSlope\n          } else {\n            blocked = false\n            start = newStart\n          }\n        } else {\n          if (\n            this.solidChecker.isSolid(currentX, currentY) &&\n            distance < this.radius\n          ) {\n            // hit a wall within sight line\n            blocked = true\n            this.castLight(distance + 1, start, leftSlope, xx, xy, yx, yy)\n            newStart = rightSlope\n          }\n        }\n      }\n    }\n  }\n\n  private doubleDistance(x: number, y: number): number {\n    return x * x + y * y\n  }\n}\n","import { remove, sum } from 'lodash'\n\nexport class Attribute {\n  public modifiers: number[] = []\n\n  constructor(protected max: number, public current: number = max) {}\n\n  get maximum(): number {\n    return this.max\n  }\n\n  get atMax(): boolean {\n    return this.max === this.current\n  }\n\n  public decrease(modifier: number) {\n    this.current -= modifier\n  }\n\n  public increase(modifier: number) {\n    this.current = Math.min(this.current + modifier, this.max)\n  }\n\n  public constantIncrease(modifier: number) {\n    this.max += modifier\n    this.increase(modifier)\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max -= modifier\n    this.decrease(modifier)\n  }\n\n  public addModifier(modifier: number) {\n    this.modifiers.push(modifier)\n  }\n\n  public removeModifier(modifier: number) {\n    remove(this.modifiers, val => val === modifier)\n  }\n\n  get currentValue(): number {\n    return this.current + sum(this.modifiers)\n  }\n}\n\nexport class PositiveAttribute extends Attribute {\n  get currentValue(): number {\n    const value = super.currentValue\n    return value >= 1 ? value : 1\n  }\n\n  public constantDecrease(modifier: number) {\n    this.max = Math.max(1, this.max - modifier)\n    this.decrease(modifier)\n  }\n\n  public decrease(modifier: number) {\n    this.current = Math.max(1, this.current - modifier)\n  }\n}\n\nexport class AttributeSet<T> {\n  constructor(public attack: T, public defense: T, public dexterity: T) {}\n\n  public with(pairSet: AttributeSet<any>, on: (first: T, second: any) => void) {\n    on(this.attack, pairSet.attack)\n    on(this.defense, pairSet.defense)\n  }\n}\n\nexport class Modifier extends AttributeSet<number> {\n  constructor({ attack = 0, defense = 0, dexterity = 0 }) {\n    super(attack, defense, dexterity)\n  }\n\n  public withWeight(\n    pairSet: Modifier,\n    weight: Modifier,\n    on: (first: number, second: number, weight: number) => void\n  ) {\n    on(this.attack, pairSet.attack, weight.attack)\n    on(this.defense, pairSet.defense, weight.defense)\n  }\n}\n","import { Specie } from '../models/specie'\nimport { Attribute } from './attribute'\n\nexport class Stat {\n  constructor(\n    public base: number,\n    public rate: number = 1,\n    public extra: number = 0\n  ) {}\n\n  get current(): number {\n    return this.base * this.rate - this.extra\n  }\n\n  public add(val: number): void {\n    this.base += val\n  }\n\n  public subtract(val: number): void {\n    this.base -= val\n  }\n}\n\nexport class CapacityLimitStat {\n  private strengthRatio: number = 5\n  private constitutionRatio: number = 3\n  private base: number = 10\n\n  constructor(private strength: number, private constitution: number) {}\n\n  public recalculate(strength: number, constitution: number) {\n    this.strength = strength\n    this.constitution = constitution\n  }\n\n  get stressed(): number {\n    return (\n      this.base +\n      this.strength * this.strengthRatio +\n      this.constitution * this.constitutionRatio\n    )\n  }\n\n  get loadedStart(): number {\n    return this.stressed * 1.5\n  }\n\n  get overloadedStart(): number {\n    return this.loadedStart * 2\n  }\n\n  get flattenedStart(): number {\n    return this.overloadedStart * 3\n  }\n}\n\nexport class HealthStat extends Attribute {\n  private regenerationRate: number\n  private regenerationValue: number\n\n  constructor(\n    specie: Specie,\n    private currentTurn = 0,\n    currentValue = specie.maxHealthValue\n  ) {\n    super(specie.maxHealthValue, currentValue)\n\n    this.regenerationRate = specie.regenerationRate\n    this.regenerationValue = specie.regenerationValue\n  }\n\n  public turn(): void {\n    this.currentTurn += 1\n\n    if (this.currentTurn >= this.regenerationRate) {\n      this.currentTurn = 0\n      this.increase(this.regenerationValue)\n    }\n  }\n}\n\nexport class StrengthStat extends Stat {\n  get meleeAdjustment(): number {\n    if (this.current < 5) {\n      return -2\n    } else if (this.current > 10) {\n      return Math.floor((this.current - 10) / 2)\n    } else {\n      return 0\n    }\n  }\n}\n","import { includes } from 'lodash'\nimport { Game, GroupedItem, ImpactBunch, LevelMap, Memory } from '../../engine'\nimport { MetaAI } from '../ai/meta_ai'\nimport { AfterEvent } from '../events/after_event'\nimport { CreatureEvent } from '../events/internal'\nimport { ItemsBunch } from '../lib/bunch'\nimport { ImpactType } from '../lib/impact'\nimport { buildFov } from '../lib/map_fov'\nimport { HealthStat } from '../lib/stat'\nimport { Item, Missile, Protection } from './items'\nimport { Damage } from '../lib/damage'\nimport { Specie, Resistance } from './specie'\nimport { LevelMapId } from './level_map'\n\nexport enum Clan {\n  Player,\n  PlayerOnlyEnemy,\n  FreeForAll,\n}\n\nexport enum Ability {\n  GoStairwayDown,\n  Inventory,\n  PutOn,\n  Throwing,\n}\n\nexport const allAbilities = [\n  Ability.GoStairwayDown,\n  Ability.Inventory,\n  Ability.PutOn,\n  Ability.Throwing,\n]\n\nexport type CreatureId = number\n\nexport enum Reaction {\n  DIE,\n  HURT,\n  DODGE,\n  THROW_DODGE,\n  NOTHING,\n  RESIST,\n}\n\nexport abstract class Creature {\n  private static lastId: CreatureId = 0\n  public static getId(): CreatureId {\n    return this.lastId++\n  }\n\n  protected stageMemories: Map<LevelMapId, Memory> = new Map()\n\n  public dead: boolean = false\n\n  public health: HealthStat\n\n  constructor(public specie: Specie, public id: CreatureId = Creature.getId()) {\n    this.health = new HealthStat(specie)\n  }\n\n  get name(): string {\n    return this.specie.name\n  }\n\n  get clan(): Clan {\n    return this.specie.clan\n  }\n\n  get protections(): Protection[] {\n    return this.specie.protections\n  }\n\n  get damages(): Damage[] {\n    return this.specie.damages\n  }\n\n  public can(ability: Ability) {\n    return includes(this.specie.abilities, ability)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectCreature(this)\n  }\n\n  get speed(): number {\n    return this.specie.moveSpeed\n  }\n\n  public stageMemory(levelMap: LevelMap): Memory {\n    const memory = this.stageMemories.get(levelMap.id)\n\n    if (memory) {\n      return memory\n    }\n\n    return this.visionMask(levelMap)\n  }\n\n  public visionMask(levelMap: LevelMap): Memory {\n    let memory = this.stageMemories.get(levelMap.id)\n\n    if (memory) {\n      memory.resetVisible()\n    } else {\n      memory = new Memory(levelMap.width, levelMap.height)\n\n      this.stageMemories.set(levelMap.id, memory)\n    }\n\n    buildFov(levelMap.creaturePos(this), this.visionRadius, memory, levelMap)\n\n    return memory\n  }\n\n  public abstract act(levelMap: LevelMap, game: Game): number\n\n  private _impactsBunch: ImpactBunch | undefined\n\n  get impactsBunch(): ImpactBunch {\n    if (!this._impactsBunch) {\n      this._impactsBunch = new ImpactBunch()\n    }\n\n    return this._impactsBunch\n  }\n\n  public hasImpact(type: ImpactType): boolean {\n    return includes(this.impacts, type)\n  }\n\n  public addImpact(type: ImpactType, effect: string): void {\n    this.impactsBunch.addConstImpact(type, effect)\n  }\n\n  public removeImpact(type: ImpactType, effect: string): void {\n    this.impactsBunch.removeConstImpact(type, effect)\n  }\n\n  get visionRadius(): number {\n    if (this.hasImpact(ImpactType.Blind)) {\n      return 0\n    }\n\n    return this.specie.visionRadius\n  }\n\n  get bodyControl(): number {\n    return this.specie.bodyControl\n  }\n\n  get impacts(): ImpactType[] {\n    return this.impactsBunch.activeImpacts\n  }\n\n  public hasResistance(resistance: Resistance): boolean {\n    return includes(this.resistances, resistance)\n  }\n\n  get resistances(): Resistance[] {\n    return this.specie.resistances\n  }\n\n  abstract get missile(): GroupedItem<Missile> | undefined\n  abstract get inventoryItems(): GroupedItem<Item>[]\n\n  public abstract addItem(item: Item, count: number): void\n  public abstract removeItem(item: Item, count: number): void\n\n  public statsTurn(): void {\n    this.health.turn()\n\n    if (this._impactsBunch) {\n      // TODO: When ran out - disappear\n      this._impactsBunch.turn()\n    }\n  }\n}\n\nexport class AICreature extends Creature {\n  private bag?: ItemsBunch<Item>\n\n  constructor(\n    public ai: MetaAI,\n    specie: Specie,\n    id: CreatureId = Creature.getId()\n  ) {\n    super(specie, id)\n  }\n\n  public act(levelMap: LevelMap, game: Game): number {\n    this.statsTurn()\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n\n    this.on(new AfterEvent(levelMap, game))\n\n    return this.speed\n  }\n\n  get missile(): GroupedItem<Missile> | undefined {\n    // TODO: Remove perpetuum items?\n    if (this.specie.throwingItem) {\n      return { item: this.specie.throwingItem, count: 1 }\n    }\n  }\n\n  get inventoryItems(): GroupedItem<Item>[] {\n    return this.bag ? this.bag.bunch : []\n  }\n\n  public addItem(item: Item, count: number): void {\n    if (!this.bag) {\n      this.bag = new ItemsBunch()\n    }\n\n    this.bag.put(item, count)\n  }\n\n  public removeItem(item: Item, count: number): void {\n    if (!this.bag) {\n      throw `Creature ${this.name} tried to remove item ${\n        item.name\n      } but it does not present`\n    }\n\n    this.bag.remove(item, count)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { TileVisitor, TriggerTile } from '../models/tile'\nimport { Creature, Game, Trap, Point, Reaction } from '../../engine'\nimport { Player } from '../models/player'\n\nclass SteppingTileVisitor extends TileVisitor {\n  constructor(\n    private creature: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public onTrap(trap: Trap): void {\n    trap.activate(this.game, this.levelMap, this.creature)\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    trigger.activate(this.game, this.levelMap, this.creature)\n  }\n}\n\nexport class MoveEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private nextPoint: Point,\n    private nextLevel: LevelMap | undefined = undefined\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const pos = this.levelMap.creaturePos(actor)\n\n    if (this.nextLevel && this.nextLevel.id !== this.levelMap.id) {\n      this.levelMap.removeCreature(actor)\n      this.nextLevel.addCreature(this.nextPoint, actor)\n    } else {\n      this.levelMap.at(pos.x, pos.y).creature = undefined\n      this.levelMap.at(this.nextPoint.x, this.nextPoint.y).creature = actor\n    }\n\n    ;(this.nextLevel || this.levelMap)\n      .at(this.nextPoint.x, this.nextPoint.y)\n      .visit(new SteppingTileVisitor(actor, this.levelMap, this.game))\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (this.nextLevel && this.levelMap.id !== this.nextLevel.id) {\n      this.levelMap.reset()\n      this.nextLevel.enter()\n\n      this.affectCreature(player)\n\n      this.game.currentMap = this.nextLevel\n    } else {\n      this.affectCreature(player)\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { Point, twoDimArray } from '../utils/utils'\nimport { Creature, Clan } from '../models/creature'\n\nimport { MemoryTile, Memory } from '../models/memory'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { LevelMap, CreatureEvent, leePath } from '../../engine'\n\nexport abstract class AI {\n  public abstract act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined\n\n  protected moveTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.eq(point))\n  }\n\n  protected move(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): CreatureEvent | undefined {\n    const [point] = this.buildPath(actor, levelMap, dest)\n\n    if (point) {\n      return new MoveEvent(game, levelMap, point)\n    }\n  }\n\n  protected buildPath(\n    actor: Creature,\n    levelMap: LevelMap,\n    dest: (point: Point, tile: MemoryTile) => boolean\n  ): Point[] {\n    return leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      dest\n    )\n  }\n\n  protected withinView(\n    map: Memory,\n    pos: Point,\n    visit: (point: Point, tile: MemoryTile) => void\n  ): void {\n    let tileVisited: boolean[][] = twoDimArray(\n      map.width,\n      map.height,\n      () => false\n    )\n    let pointsToCheck: Point[] = [pos]\n\n    while (pointsToCheck.length) {\n      let wavePoints: Point[] = []\n\n      pointsToCheck.forEach((point: Point) => {\n        if (!map.inRange(point)) {\n          return\n        }\n\n        const tile = map.at(point.x, point.y)\n        if (!tile.visible || tileVisited[point.x][point.y]) {\n          return\n        }\n\n        tileVisited[point.x][point.y] = true\n\n        visit(point, tile)\n\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      })\n\n      pointsToCheck = wavePoints\n    }\n  }\n\n  public enemies(actor: Creature, enemy: Creature): boolean {\n    if (actor.id === enemy.id) {\n      return false\n    }\n\n    if (actor.clan === Clan.FreeForAll || enemy.clan === Clan.FreeForAll) {\n      return true\n    }\n\n    if (actor.clan === Clan.Player && enemy.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    if (enemy.clan === Clan.Player && actor.clan === Clan.PlayerOnlyEnemy) {\n      return true\n    }\n\n    return false\n  }\n}\n\nexport abstract class FollowTargetAI extends AI {\n  public destination?: Point = undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.foundNewTarget(actor, levelMap) || !this.destination) {\n      return this.checkCurrentTile(actor, levelMap, game)\n    }\n\n    const event = this.goTo(actor, levelMap, game, this.destination)\n    if (event) {\n      return event\n    }\n\n    this.destination = undefined\n    this.onCantMove(actor)\n\n    return\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    point: Point\n  ): CreatureEvent | undefined {\n    return this.moveTo(actor, point, levelMap, game)\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (this.destination && levelMap.creaturePos(actor).eq(this.destination)) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected abstract foundNewTarget(\n    actor: Creature,\n    levelMap: LevelMap\n  ): boolean\n  protected onMove(actor: Creature): void {}\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return\n  }\n  protected onCantMove(actor: Creature): void {}\n}\n\nexport abstract class GoToTileAI extends FollowTargetAI {\n  constructor(protected matcher: (tile: MemoryTile) => boolean) {\n    super()\n  }\n\n  protected checkCurrentTile(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event = super.checkCurrentTile(actor, levelMap, game)\n\n    if (event) {\n      return event\n    }\n\n    const pos = levelMap.creaturePos(actor)\n    if (this.matcher(actor.stageMemory(levelMap).at(pos.x, pos.y))) {\n      this.destination = undefined\n      return this.onReach(actor, levelMap, game)\n    }\n  }\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    const path = leePath(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      tile => tile.tangible(actor),\n      (point, tile) => this.matcher(tile),\n      true\n    )\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return false\n    }\n  }\n}\n","import { AttackEvent, Game } from '../../engine'\nimport { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Attacker extends AI {\n  public victim?: Creature\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (!this.canAttack(actor, levelMap)) {\n      return\n    }\n\n    if (this.victim && this.victimInAccess(actor, levelMap, this.victim)) {\n      return new AttackEvent(this.victim, levelMap, game)\n    } else {\n      if (!firstTurn) {\n        throw 'Attacker got called twice'\n      }\n\n      this.pickNewVictim(actor, levelMap)\n      return this.act(actor, levelMap, game, false)\n    }\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap): boolean {\n    const creature = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n    return !!creature\n  }\n\n  private victimInAccess(\n    actor: Creature,\n    levelMap: LevelMap,\n    victim: Creature | undefined\n  ): boolean {\n    if (victim === undefined) {\n      return false\n    }\n\n    const creature = this.findCreature(\n      actor,\n      levelMap,\n      (creature: Creature) => creature.id === victim.id\n    )\n    return !!creature\n  }\n\n  private pickNewVictim(actor: Creature, levelMap: LevelMap) {\n    this.victim = this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): Creature | undefined {\n    const memory = actor.stageMemory(levelMap)\n\n    return levelMap\n      .creaturePos(actor)\n      .wrappers()\n      .map(({ x, y }) => memory.at(x, y).creature)\n      .find(\n        (creature: Creature | undefined) =>\n          creature ? condition(creature) : false\n      )\n  }\n}\n","import { Creature, CreatureId } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point } from '../utils/utils'\nimport { FollowTargetAI } from './internal'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class Chaser extends FollowTargetAI {\n  private victimId?: CreatureId\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    // Is there a victim and a path to it?\n    return (\n      (this.victimSet() && this.buildVictimPath(actor, levelMap)) ||\n      this.foundNewVictim(actor, levelMap)\n    )\n  }\n\n  protected onCantMove(): void {\n    this.victimId = undefined\n  }\n\n  protected onReach(): CreatureEvent | undefined {\n    this.victimId = undefined\n    return\n  }\n\n  private victimSet(): boolean {\n    return !!this.victimId\n  }\n\n  protected goTo(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (!this.destination) {\n      throw 'Chaser.goTo: no destination'\n    }\n    return this.followTo(actor, this.destination, levelMap, game)\n  }\n\n  private buildVictimPath(actor: Creature, levelMap: LevelMap): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => creature.id === this.victimId\n    )\n  }\n\n  private foundNewVictim(actor: Creature, levelMap: LevelMap): boolean {\n    // Found new victim and built path to it\n    return (\n      this.findCreature(actor, levelMap, creature =>\n        this.enemies(actor, creature)\n      ) && this.buildVictimPath(actor, levelMap)\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    let result: boolean = false\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      ({ x, y }, tile) => {\n        const creature = tile.creature\n\n        if (!result && creature && condition(creature)) {\n          this.destination = new Point(x, y)\n          this.victimId = creature.id\n          result = true\n        }\n      }\n    )\n\n    return result\n  }\n\n  protected followTo(\n    actor: Creature,\n    destination: Point,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    return this.move(actor, levelMap, game, point => destination.nextTo(point))\n  }\n}\n","import { AI } from './internal'\nimport { Player } from '../models/player'\nimport { Logger } from '../models/logger'\nimport { Game, ItemsBunch, Item } from '../../engine'\n\nexport abstract class AIEvent {\n  protected logger: Logger\n  protected player: Player\n\n  constructor(protected game: Game) {\n    this.player = game.player\n    this.logger = game.logger\n  }\n\n  public abstract run(): void\n  public abstract immediate(): boolean\n}\n\nexport class AIItemPickedEvent extends AIEvent {\n  constructor(public items: ItemsBunch<Item>, game: Game) {\n    super(game)\n  }\n\n  public run(): void {}\n\n  public immediate(): boolean {\n    return false\n  }\n}\n\nexport abstract class MetaAI extends AI {\n  constructor(public aiToRun: AI | undefined = undefined) {\n    super()\n  }\n  protected events: AIEvent[] = []\n\n  public pushEvent(event: AIEvent) {\n    this.events.push(event)\n  }\n\n  protected resetEvents(): void {\n    this.events = []\n  }\n\n  public runEvents(): void {\n    this.events.forEach(event => {\n      event.run()\n    })\n\n    this.resetEvents()\n  }\n}\n","import { FollowTargetAI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Point, LevelMap } from '../../engine'\n\nimport { sumBy } from 'lodash'\n\nconst STEP_DISTANCE = 2\n\nexport class Escaper extends FollowTargetAI {\n  private escapesFrom: [Point, Creature][] = []\n\n  protected foundNewTarget(actor: Creature, levelMap: LevelMap): boolean {\n    return (\n      this.foundEnemies(actor, levelMap) &&\n      this.buildEscapePath(actor, levelMap)\n    )\n  }\n\n  private buildEscapePath(\n    actor: Creature,\n    levelMap: LevelMap,\n    minDistance: number = actor.visionRadius / 2\n  ): boolean {\n    if (minDistance <= 1) {\n      this.destination = undefined\n      return false\n    }\n\n    const path = this.buildPath(actor, levelMap, ({ x, y }) => {\n      const score = sumBy(this.escapesFrom, ([pos, enemy]) => {\n        // I don't use pathfinding since it should try\n        // to run away from those who are visible, so the path\n        // to them should be straightforward.\n        return Math.max(Math.abs(x - pos.x), Math.abs(y - pos.y))\n      })\n\n      return score >= minDistance\n    })\n\n    if (path.length) {\n      this.destination = path.pop()\n      return true\n    } else {\n      return this.buildEscapePath(actor, levelMap, minDistance - STEP_DISTANCE)\n    }\n  }\n\n  private foundEnemies(actor: Creature, levelMap: LevelMap): boolean {\n    this.escapesFrom = []\n\n    this.withinView(\n      actor.stageMemory(levelMap),\n      levelMap.creaturePos(actor),\n      (point, tile) => {\n        const creature = tile.creature\n\n        if (creature && this.enemies(actor, creature)) {\n          this.escapesFrom.push([point, creature])\n        }\n      }\n    )\n\n    return this.escapesFrom.length > 0\n  }\n}\n","import { GoToTileAI } from './internal'\n\nexport class Explorer extends GoToTileAI {\n  constructor() {\n    super(tile => !tile.seen)\n  }\n}\n","import { PickUpItemsEvent, LevelMap } from '../../engine'\nimport { Ability, Creature, AICreature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { GoToTileAI } from './internal'\nimport { AIItemPickedEvent } from './meta_ai'\nimport { CreatureEvent } from '../events/internal'\nimport { MemoryTile } from '../models/memory'\n\nexport class Picker extends GoToTileAI {\n  constructor() {\n    super((tile: MemoryTile) => !!tile.items)\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.Inventory)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: AICreature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const tile = levelMap.creatureTile(actor)\n\n    if (!tile.items) {\n      throw 'Picker.act : nothing to pick up'\n    }\n\n    actor.ai.pushEvent(new AIItemPickedEvent(tile.items, game))\n\n    return new PickUpItemsEvent(tile, tile.items.bunch, game)\n  }\n}\n","import { AI } from './internal'\nimport { Creature } from '../models/creature'\nimport { Game } from '../models/game'\nimport { Point, LevelMap } from '../../engine'\nimport { CreatureEvent } from '../events/internal'\n\nexport class Loiter extends AI {\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    const pos = levelMap.creaturePos(actor)\n\n    return this.move(actor, levelMap, game, (point: Point) => !pos.eq(point))\n  }\n}\n","import { AI } from './internal'\n\nimport { Point, succ } from '../utils/utils'\nimport { Creature } from '../models/creature'\n\nimport * as graphlib from 'graphlib'\nimport { Loiter } from './loiter'\nimport { TileVisitor, Tile } from '../models/tile'\nimport { MoveEvent } from '../events/move_event'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\ntype NodeID = string\n\nconst NEW_POINT_EVERY: number = 10\n\nclass PatrolTileVisitor extends TileVisitor {\n  public status: boolean = false\n\n  constructor(private tile: Tile) {\n    super()\n  }\n\n  public addNode(): boolean {\n    this.status = false\n    this.tile.visit(this)\n    return this.status\n  }\n\n  public onDoor() {\n    this.status = true\n  }\n}\n\nexport class Patrol extends AI {\n  private i: NodeID\n  private graph: graphlib.Graph\n  private lastNodeVisit: { [key: string]: number }\n  private currentNodeID: NodeID\n  private targetNodeID: NodeID | undefined\n  private path: Point[]\n  private step: number = NEW_POINT_EVERY\n  private firstCallPatrol: boolean = true\n\n  constructor() {\n    super()\n    this.i = 'a'\n\n    this.graph = new graphlib.Graph()\n\n    this.lastNodeVisit = {}\n\n    this.currentNodeID = 'a' // TODO: Check it, was undefined\n    this.markNodeVisited(this.currentNodeID)\n    this.path = []\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean = true\n  ): CreatureEvent | undefined {\n    if (this.graph.nodes().length <= 1) {\n      return\n    }\n\n    if (this.firstCallPatrol) {\n      const pos = levelMap.creaturePos(actor)\n      this.addNode(pos)\n      this.firstCallPatrol = false\n    }\n\n    this.step += 1\n\n    if (this.path.length) {\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    } else {\n      if (this.targetNodeID) {\n        this.markNodeVisited(this.targetNodeID)\n        this.currentNodeID = this.targetNodeID\n      }\n\n      this.pickUpNewTarget(actor, levelMap)\n      return this.moveToTarget(actor, levelMap, game, firstTurn)\n    }\n  }\n\n  public reset(): void {\n    this.path = []\n  }\n\n  public trackMovement(pos: Point, tile: Tile): void {\n    if (this.step >= NEW_POINT_EVERY || new PatrolTileVisitor(tile).addNode()) {\n      this.addNode(pos)\n    }\n    this.step += 1\n  }\n\n  // TODO: If close enough to another node, use it instead.\n  public addNode(point: Point): void {\n    this.graph.setNode(this.i, point)\n    if (this.currentNodeID && this.currentNodeID !== this.i) {\n      this.graph.setEdge(this.currentNodeID, this.i)\n    }\n    this.currentNodeID = this.i\n    this.i = succ(this.i)\n    this.step = 0\n  }\n\n  private buildNewPath(actor: Creature, levelMap: LevelMap): void {\n    // TODO: Remove this\n    if (!this.targetNodeID) {\n      throw 'Patrol has no next targetID'\n    }\n    const pos: Point = this.graph.node(this.targetNodeID)\n\n    this.path = this.buildPath(actor, levelMap, point => pos.eq(point))\n  }\n\n  private pickUpNewTarget(actor: Creature, levelMap: LevelMap): void {\n    let seenLastID: NodeID = this.graph.nodes()[0],\n      seenLastStep: number = this.lastNodeVisit[seenLastID],\n      nodes = this.graph.neighbors(this.currentNodeID)\n\n    if (nodes) {\n      nodes.forEach((nodeID: NodeID) => {\n        if (seenLastStep > (this.lastNodeVisit[nodeID] || 0)) {\n          seenLastID = nodeID\n          seenLastStep = this.lastNodeVisit[seenLastID]\n        }\n      })\n    }\n\n    this.targetNodeID = seenLastID\n    this.buildNewPath(actor, levelMap)\n  }\n\n  private moveToTarget(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game,\n    firstTurn: boolean\n  ): CreatureEvent | undefined {\n    const nextPoint: Point | undefined = this.path.shift()\n\n    if (!nextPoint) {\n      if (firstTurn) {\n        this.path = []\n        return this.act(actor, levelMap, game, false)\n      } else {\n        return new Loiter().act(actor, levelMap, game)\n      }\n    } else if (\n      actor\n        .stageMemory(levelMap)\n        .at(nextPoint.x, nextPoint.y)\n        .tangible()\n    ) {\n      this.buildNewPath(actor, levelMap)\n\n      if (this.path.length) {\n        return this.act(actor, levelMap, game, false)\n      }\n    } else {\n      return new MoveEvent(game, levelMap, nextPoint)\n    }\n  }\n\n  private markNodeVisited(nodeID: NodeID): void {\n    this.lastNodeVisit[nodeID] = this.step\n  }\n}\n","import { AI } from './internal'\nimport { Creature, Ability, Reaction, CreatureId } from '../models/creature'\nimport { Point, bresenham } from '../utils/utils'\nimport { MissileAttackEvent, GroupedItem } from '../../engine'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Memory } from '../models/memory'\nimport { CreatureEvent } from '../events/internal'\nimport { Item } from '../models/items'\n\nexport class Thrower extends AI {\n  public victim: Creature | undefined\n  public previousVictim: Creature | undefined\n  public missiles: GroupedItem<Item> | undefined\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (\n      !actor.can(Ability.Throwing) ||\n      !this.hasMissile(actor) ||\n      !this.canAttack(actor, levelMap, game)\n    ) {\n      return\n    }\n\n    let path: Point[] = []\n\n    if (!this.victim) {\n      throw 'Thrower.act called when there is no victim'\n    }\n\n    bresenham(\n      levelMap.creaturePos(actor),\n      levelMap.creaturePos(this.victim),\n      (x, y) => path.push(new Point(x, y))\n    )\n\n    return new MissileAttackEvent(\n      path,\n      game,\n      levelMap,\n      (reaction: Reaction) => {\n        if (reaction === Reaction.DIE) {\n          this.victim = undefined\n          this.previousVictim = undefined\n        }\n      }\n    )\n  }\n\n  private hasMissile(actor: Creature): boolean {\n    this.missiles = actor.missile\n    return this.missiles !== undefined\n  }\n\n  private canAttack(actor: Creature, levelMap: LevelMap, game: Game): boolean {\n    this.previousVictim = this.victim\n    this.victim = undefined\n\n    if (this.previousVictim) {\n      if (this.findWithId(actor, levelMap, this.previousVictim.id)) {\n        return true\n      }\n    }\n\n    return this.findCreature(actor, levelMap, creature =>\n      this.enemies(actor, creature)\n    )\n  }\n\n  private findWithId(\n    actor: Creature,\n    levelMap: LevelMap,\n    victimId: CreatureId\n  ): boolean {\n    return this.findCreature(\n      actor,\n      levelMap,\n      creature => victimId === creature.id\n    )\n  }\n\n  private findCreature(\n    actor: Creature,\n    levelMap: LevelMap,\n    condition: (creature: Creature) => boolean\n  ): boolean {\n    const memory = actor.stageMemory(levelMap),\n      pos = levelMap.creaturePos(actor)\n\n    this.withinView(memory, levelMap.creaturePos(actor), (point, tile) => {\n      const creature = tile.creature\n\n      if (\n        !this.victim &&\n        creature &&\n        condition(creature) &&\n        !this.obstacles(actor, pos, memory, point)\n      ) {\n        this.victim = levelMap.at(point.x, point.y).creature\n      }\n    })\n\n    return !!this.victim\n  }\n\n  private obstacles(\n    actor: Creature,\n    pos: Point,\n    memory: Memory,\n    target: Point\n  ): boolean {\n    let obstacles = false\n\n    bresenham(pos, target, (x, y) => {\n      obstacles = obstacles || memory.at(x, y).tangible(actor)\n    })\n\n    return obstacles\n  }\n}\n","import {\n  Ability,\n  Creature,\n  Game,\n  StairwayDown,\n  MoveEvent,\n  LevelMap,\n} from '../../engine'\nimport { CreatureEvent } from '../events/internal'\nimport { TileVisitor } from '../models/tile'\nimport { GoToTileAI } from './internal'\n\nclass StairwayDownFinderVisitor extends TileVisitor {\n  public match = false\n\n  public onStairwayDown(): void {\n    this.match = true\n  }\n}\n\nclass StairwayDownTileMoverVisitor extends TileVisitor {\n  public event: CreatureEvent | undefined\n\n  constructor(\n    private actor: Creature,\n    private game: Game,\n    private levelMap: LevelMap\n  ) {\n    super()\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    // TODO: Do not do this if already connected\n    const adjacentMap = this.game.getMap(stairway.adjacentMapId)\n    stairway.enterPos = adjacentMap.matchStairs(\n      this.levelMap.id,\n      this.levelMap.creaturePos(this.actor)\n    )\n\n    this.event = new MoveEvent(\n      this.game,\n      this.levelMap,\n      stairway.enterPos,\n      adjacentMap\n    )\n  }\n}\n\nexport class Descender extends GoToTileAI {\n  constructor() {\n    super(tile => {\n      const visitor = new StairwayDownFinderVisitor()\n      tile.visit(visitor)\n      return visitor.match\n    })\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    if (actor.can(Ability.GoStairwayDown)) {\n      return super.act(actor, levelMap, game)\n    }\n  }\n\n  protected onReach(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    // Should stay here at least for a turn\n    const visitor = new StairwayDownTileMoverVisitor(actor, game, levelMap),\n      tile = levelMap.creatureTile(actor)\n\n    tile.visit(visitor)\n    return visitor.event\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Reaction, Creature } from '../models/creature'\nimport { LevelMap } from '../models/level_map'\n\nexport class StayEvent extends CreatureEvent {\n  constructor(private levelMap: LevelMap) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    let memory = creature.stageMemory(this.levelMap)\n\n    this.levelMap\n      .creaturePos(creature)\n      .wrappers()\n      .forEach(({ x, y }) => {\n        memory.at(x, y).see(this.levelMap.at(x, y), 0)\n      })\n\n    return Reaction.NOTHING\n  }\n}\n","import { Creature } from '../models/creature'\nimport { AI } from './internal'\nimport { StayEvent } from '../events/stay_event'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class SelfHealer extends AI {\n  public act(actor: Creature, levelMap: LevelMap): CreatureEvent | undefined {\n    if (actor.health.atMax) {\n      return\n    }\n\n    return new StayEvent(levelMap)\n  }\n}\n","import { Player } from '../models/player'\nimport { LevelMap } from '../models/level_map'\nimport { Tile } from '../models/tile'\nimport { Game, IdlePresenter } from '../../engine'\n\nexport enum PresenterType {\n  AbilitiesPicking,\n  Death,\n  Idle,\n  Inventory,\n  ItemsListing,\n  Missile,\n  ProfessionPicking,\n  Look,\n  Teleportation,\n  PickHandleOption,\n}\n\nexport abstract class Presenter {\n  public player: Player\n\n  constructor(\n    public readonly type: PresenterType,\n    protected levelMap: LevelMap,\n    protected game: Game\n  ) {\n    this.player = this.game.player\n  }\n\n  get tile(): Tile {\n    return this.levelMap.creatureTile(this.player)\n  }\n\n  protected endTurn(): void {\n    this.game.player.ai.endTurn()\n  }\n\n  protected redirect(presenter: Presenter): void {\n    this.game.player.ai.redirect(presenter)\n  }\n\n  protected goIdle(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n","import { Missile, Protection } from './items'\nimport { Damage } from '../lib/damage'\nimport { Clan, Ability } from './creature'\n\nexport enum Resistance {\n  Intangible,\n  MagicDamage,\n  TeleportationControl,\n}\n\nexport interface Specie {\n  name: string\n  weight: number\n  clan: Clan\n  abilities: Ability[]\n\n  protections: Protection[]\n  damages: Damage[]\n  bodyControl: number\n\n  throwingItem?: Missile\n\n  maxHealthValue: number\n  regenerationRate: number\n  regenerationValue: number\n\n  resistances: Resistance[]\n\n  visionRadius: number\n  moveSpeed: number\n  attackSpeed: number\n}\n","import { Player } from './player'\nimport { Specie } from './specie'\n\nimport { Game } from './game'\nimport { Modifier } from '../lib/attribute'\nimport { Damage } from '../lib/damage'\nimport { ImpactType } from '../lib/impact'\n\nexport enum Usage {\n  WeaponOneHand,\n  WearsOnHead,\n  WearsOnBody,\n  Ring,\n  Amulet,\n  Throw,\n  Shoot,\n  Boots,\n  Tool,\n  Belt,\n  Gloves,\n  Gauntlets,\n  Cloak,\n}\n\nexport enum ItemGroup {\n  BodyArmor,\n  OneHandWeapon,\n  Consumable,\n  Missile,\n  Potion,\n  MissileWeapon,\n  Boots,\n}\n\nexport enum ItemSubgroup {\n  MissileRock,\n  Sling,\n\n  Bow,\n  Arrows,\n}\n\nexport type ItemId = number\n\nexport class Item {\n  private static lastId: ItemId = 0\n  public static getId(): ItemId {\n    return this.lastId++\n  }\n\n  public impacts: ImpactType[] = []\n\n  constructor(\n    public group: ItemGroup,\n    public name: string,\n    public weight: number,\n    public readonly usages: Usage[] = [],\n    public readonly modifier: Modifier = new Modifier({}),\n    public id: ItemId = Item.getId()\n  ) {}\n\n  get canSeeDetails(): boolean {\n    return true\n  }\n\n  public clone(): Item {\n    return new Item(this.group, this.name, this.weight)\n  }\n\n  public groupsWith(item: Item): boolean {\n    return this.name === item.name\n  }\n\n  public worksWith(item: Item): boolean {\n    return false\n  }\n\n  public canThrow(player: Player): boolean {\n    return true\n  }\n}\n\nexport class Corpse extends Item {\n  constructor(public readonly specie: Specie) {\n    super(ItemGroup.Consumable, `${specie.name}'s corpse`, specie.weight)\n  }\n}\n\nexport abstract class Potion extends Item {\n  constructor(public name: string) {\n    super(ItemGroup.Potion, name, 0.2)\n  }\n\n  abstract onDrink(game: Game): void\n}\n\nexport abstract class Missile extends Item {\n  constructor(name: string, weight: number, modifier: Modifier) {\n    super(ItemGroup.Missile, name, weight, [], modifier)\n  }\n}\n\nexport abstract class MissileWeapon extends Item {\n  constructor(name: string, weight: number, modifier: Modifier) {\n    super(ItemGroup.MissileWeapon, name, weight, [Usage.Shoot], modifier)\n  }\n}\n\nexport abstract class Weapon extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    public readonly damages: Damage[],\n    usage: Usage\n  ) {\n    super(group, name, weight, [usage])\n  }\n}\n\nexport class OneHandWeapon extends Weapon {\n  constructor(name: string, weight: number, damages: Damage[]) {\n    super(ItemGroup.OneHandWeapon, name, weight, damages, Usage.WeaponOneHand)\n  }\n}\n\nexport enum ProtectionType {\n  Light,\n  Medium,\n  Heavy,\n  Solid,\n  Unarmored,\n}\n\nexport type Protection = {\n  type: ProtectionType\n  value: number\n}\n\nexport abstract class Armor extends Item {\n  constructor(\n    group: ItemGroup,\n    name: string,\n    weight: number,\n    public readonly protections: Protection[],\n    usage: Usage\n  ) {\n    super(group, name, weight, [usage])\n  }\n}\n\nexport class BodyArmor extends Armor {\n  constructor(name: string, weight: number, protections: Protection[]) {\n    super(ItemGroup.BodyArmor, name, weight, protections, Usage.WearsOnBody)\n  }\n}\n\nexport class Boots extends Armor {\n  constructor(name: string, weight: number, protections: Protection[]) {\n    super(ItemGroup.Boots, name, weight, protections, Usage.Boots)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Corpse } from '../models/items'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { DeathPresenter } from '../presenters/death_presenter'\n\nexport enum DieReason {\n  Attack,\n  Missile,\n  Trap,\n  Overloaded,\n}\n\nexport class DieEvent extends CreatureEvent {\n  constructor(\n    private game: Game,\n    private levelMap: LevelMap,\n    private reason: DieReason\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    let tile = this.levelMap.creatureTile(creature)\n\n    this.levelMap.removeCreature(creature)\n    creature.dead = true\n\n    tile.addItem(new Corpse(creature.specie), 1)\n\n    creature.inventoryItems.forEach(invItem =>\n      tile.addItem(invItem.item, invItem.count)\n    )\n\n    return Reaction.DIE\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    // TODO: On dying update vision\n    player.ai.presenter = new DeathPresenter(\n      this.reason,\n      this.levelMap,\n      this.game\n    )\n    player.dead = true\n    this.game.ai = player.ai\n\n    return Reaction.DIE\n  }\n}\n","import { DieReason } from '../events/die_event'\nimport { Game } from '../models/game'\nimport { Presenter, PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class DeathPresenter extends Presenter {\n  constructor(public dieReason: DieReason, levelMap: LevelMap, game: Game) {\n    super(PresenterType.Death, levelMap, game)\n  }\n\n  get playerName(): string {\n    return this.game.player.name\n  }\n}\n","import { MetaAI, AIEvent } from './meta_ai'\nimport { Player } from '../models/player'\nimport {\n  IdlePresenter,\n  Game,\n  TalentsTreePresenter,\n  ProfessionPickingPresenter,\n  LevelMap,\n  AfterEvent,\n  TeleportationPresenter,\n} from '../../engine'\nimport { Presenter } from '../presenters/internal'\nimport { DieReason } from '../events/die_event'\nimport { DeathPresenter } from '../presenters/death_presenter'\nimport { CreatureEvent } from '../events/internal'\n\nexport class AINewLevelEvent extends AIEvent {\n  constructor(public level: number, private levelMap: LevelMap, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    if (!this.game.ai) {\n      throw 'AINewLevelEvent.run: game.ai is undefined'\n    }\n\n    if (this.level % 3 === 0) {\n      this.game.ai.presenter = new ProfessionPickingPresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    } else {\n      this.game.ai.presenter = new TalentsTreePresenter(\n        this.level,\n        this.levelMap,\n        this.game\n      )\n    }\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class AIDieEvent extends AIEvent {\n  constructor(\n    private dieReason: DieReason,\n    private levelMap: LevelMap,\n    game: Game\n  ) {\n    super(game)\n  }\n\n  public run(): void {\n    if (!this.game.ai) {\n      throw 'AINewLevelEvent.run: game.ai is undefined'\n    }\n\n    this.game.ai.presenter = new DeathPresenter(\n      this.dieReason,\n      this.levelMap,\n      this.game\n    )\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class AITeleportationEvent extends AIEvent {\n  constructor(private levelMap: LevelMap, game: Game) {\n    super(game)\n  }\n\n  public run(): void {\n    if (!this.game.ai) {\n      throw 'AINewLevelEvent.run: game.ai is undefined'\n    }\n\n    // TODO: Rethink whether should be here\n    this.game.player.rebuildVision(this.levelMap)\n    this.game.ai.presenter = new TeleportationPresenter(\n      this.levelMap,\n      this.game\n    )\n  }\n\n  public immediate(): boolean {\n    return true\n  }\n}\n\nexport class PlayerAI extends MetaAI {\n  public presenter: Presenter | null = null\n  private game: Game | undefined\n  private levelMap: LevelMap | undefined\n  public levelUps: number = 0\n\n  public act(\n    player: Player,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.game = game\n    this.levelMap = levelMap\n\n    this.presenter = new IdlePresenter(levelMap, this.game)\n    this.game.ai = this\n\n    return\n  }\n\n  public endTurn(): void {\n    let event = this.events.pop()\n    if (event) {\n      event.run()\n    } else if (this.game && this.levelMap) {\n      this.game.player.on(new AfterEvent(this.levelMap, this.game))\n\n      let event = this.events.pop()\n      if (event) {\n        event.run()\n      } else {\n        this.game.player.ai.runEvents()\n        this.game.ai = null\n        this.presenter = null\n      }\n    }\n  }\n\n  public redirect(presenter: Presenter): void {\n    this.presenter = presenter\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Game, AINewLevelEvent, LevelMap } from '../../engine'\n\nexport class AddExperienceEvent extends CreatureEvent {\n  constructor(\n    public actor: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(subject: Player): Reaction {\n    subject.level.add(1).forEach(level => {\n      subject.ai.pushEvent(new AINewLevelEvent(level, this.levelMap, this.game))\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { ImpactType } from '../lib/impact'\nimport { Creature, Reaction } from '../models/creature'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from './internal'\n\nexport class AddImpactEvent extends CreatureEvent {\n  constructor(\n    private impactType: ImpactType,\n    private source: string,\n    private game: Game,\n    private duration?: number\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    // Different messages for player\n\n    if (creature.hasImpact(this.impactType)) {\n      this.applyImpact()\n    }\n\n    if (this.duration) {\n      creature.impactsBunch.addImpact(this.impactType, this.duration)\n    } else {\n      creature.addImpact(this.impactType, this.source)\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected applyImpact(): void {}\n}\n","import { includes, intersection, random, sum, sumBy, times } from 'lodash'\nimport { DamageType, ProtectionType } from '../../engine'\nimport { Protection } from '../models/items'\nimport { Resistance } from '../models/specie'\nimport { Damage, Dice } from './damage'\n\nexport type DamageOrResist = { damage: number; resist: boolean }\n\nexport class Calculator {\n  private constructor() {}\n\n  public static misses(attackerBC: number, victimBC: number): boolean {\n    return (\n      Math.random() > attackerBC / (attackerBC + Math.pow(victimBC * 0.25, 0.8))\n    )\n  }\n\n  // Function result varies from 0 to 1. Ratio defines the speed of growing.\n  // E.g. dodges(10, 1) = 0.93\n  //      dodges(10, 5) = 0.7\n  public static dodges(actorBC: number, ratio: number): boolean {\n    return Math.random() < (Math.atan(actorBC / ratio) / Math.PI) * 2\n  }\n\n  public static throwDamageTo(x: number, y: number): number {\n    return 10\n  }\n\n  public static damage(\n    damages: Damage[],\n    protectionTypes: Protection[],\n    victimResistances: Resistance[]\n  ): DamageOrResist {\n    if (\n      damages.every(({ type, resistances }) =>\n        this.resistTo(type, resistances, victimResistances)\n      )\n    ) {\n      return { damage: 0, resist: true }\n    }\n\n    const damage = sumBy(\n      damages,\n      ({ extra, dice, type, resistances }): number => {\n        if (this.resistTo(type, resistances, victimResistances)) {\n          return 0\n        }\n\n        return Math.floor(\n          Math.max(\n            0,\n            extra +\n              this.dropDice(dice) -\n              this.protectionValue(type, protectionTypes)\n          )\n        )\n      }\n    )\n\n    return { damage, resist: false }\n  }\n\n  protected static resistTo(\n    damageType: DamageType,\n    resistances: Resistance[] | undefined,\n    victimResistances: Resistance[]\n  ): boolean {\n    if (resistances && intersection(victimResistances, resistances).length) {\n      return true\n    }\n\n    switch (damageType) {\n      case DamageType.Melee:\n      case DamageType.Pierce:\n      case DamageType.Blunt:\n        return includes(victimResistances, Resistance.Intangible)\n      case DamageType.Magic:\n        return includes(victimResistances, Resistance.MagicDamage)\n      case DamageType.Pure:\n        return false\n    }\n  }\n\n  protected static dropDice(dice: Dice): number {\n    return sum(times(dice.times, () => random(1, dice.max)))\n  }\n\n  protected static protectionValue(\n    damageType: DamageType,\n    protections: Protection[]\n  ): number {\n    return sum(\n      protections.map(\n        ({ type, value }: Protection): number =>\n          value * this.armorToDamageRatio(damageType, type)\n      )\n    )\n  }\n\n  protected static armorToDamageRatio = (\n    damageType: DamageType,\n    armorType: ProtectionType\n  ): number => {\n    switch (damageType) {\n      case DamageType.Melee:\n        switch (armorType) {\n          case ProtectionType.Medium:\n            return 2 / 3\n          case ProtectionType.Solid:\n            return 4 / 3\n          default:\n            return 1\n        }\n      case DamageType.Pierce:\n        switch (armorType) {\n          case ProtectionType.Light:\n            return 1 / 2\n          case ProtectionType.Medium:\n            return 4 / 3\n          case ProtectionType.Solid:\n            return 3\n          case ProtectionType.Unarmored:\n            return 3 / 4\n          default:\n            return 1\n        }\n      case DamageType.Blunt:\n        switch (armorType) {\n          case ProtectionType.Medium:\n            return 2\n          case ProtectionType.Solid:\n            return 1 / 2\n          case ProtectionType.Unarmored:\n            return 1 / 2\n          default:\n            return 1\n        }\n      case DamageType.Magic:\n        switch (armorType) {\n          case ProtectionType.Light:\n            return 5 / 4\n          case ProtectionType.Medium:\n            return 3 / 4\n          case ProtectionType.Heavy:\n            return 1 / 2\n          case ProtectionType.Solid:\n            return 3\n          default:\n            return 1\n        }\n      case DamageType.Pure:\n        return 0\n      default:\n        throw 'Got unknown type of damage!'\n    }\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Creature, Reaction } from '../models/creature'\nimport { Damage } from '../lib/damage'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { Calculator } from '../lib/calculator'\n\nexport class HurtEvent extends CreatureEvent {\n  private doneDamage: number | undefined\n\n  constructor(\n    private damages: Damage[],\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  get damage(): number {\n    if (this.doneDamage) {\n      return this.doneDamage\n    } else {\n      throw `HurtEvent.damage called but there is no done damage`\n    }\n  }\n\n  public affectCreature(subject: Creature): Reaction {\n    const { damage, resist } = Calculator.damage(\n      this.damages,\n      subject.protections,\n      subject.resistances\n    )\n\n    this.doneDamage = damage\n\n    if (resist) {\n      return Reaction.RESIST\n    }\n\n    if (damage >= subject.health.currentValue) {\n      subject.on(new DieEvent(this.game, this.levelMap, DieReason.Attack))\n      return Reaction.DIE\n    } else if (damage <= 0) {\n      return Reaction.NOTHING\n    } else {\n      subject.health.decrease(damage)\n      return Reaction.HURT\n    }\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Calculator } from '../lib/calculator'\nimport { HurtEvent } from './hurt_event'\n\nexport class AttackEvent extends CreatureEvent {\n  constructor(\n    private victim: Creature,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    const reaction = this.process(actor)\n\n    switch (reaction) {\n      case Reaction.NOTHING:\n        // TODO: victim is not always a player, should be another message as well\n        this.game.logger.noDamageToPlayer(actor)\n        break\n      case Reaction.RESIST:\n        // TODO: victim is not always a player, should be another message as well\n        this.game.logger.playerIgnoresDamage(actor)\n        break\n    }\n\n    return reaction\n  }\n\n  public affectPlayer(actor: Creature): Reaction {\n    const reaction = this.process(actor)\n\n    switch (reaction) {\n      case Reaction.NOTHING:\n        this.game.logger.noDamageToTarget(actor)\n        break\n      case Reaction.RESIST:\n        this.game.logger.targetIgnoresDamage(this.victim)\n        break\n    }\n\n    return reaction\n  }\n\n  protected process(actor: Creature): Reaction {\n    if (Calculator.misses(actor.bodyControl, this.victim.bodyControl)) {\n      this.game.logger.missMessage(actor, this.victim)\n      return Reaction.DODGE\n    }\n\n    const hurtEvent = new HurtEvent(actor.damages, this.levelMap, this.game),\n      reaction = this.victim.on(hurtEvent)\n\n    switch (reaction) {\n      case Reaction.DIE:\n        actor.on(new AddExperienceEvent(this.victim, this.levelMap, this.game))\n        this.game.logger.killMessage(hurtEvent.damage, actor, this.victim)\n        break\n      case Reaction.HURT:\n        this.game.logger.hurtMessage(hurtEvent.damage, actor, this.victim)\n        break\n    }\n\n    return reaction\n  }\n}\n","import { Creature, Reaction } from '../models/creature'\nimport { CreatureEvent } from './internal'\nimport { Potion, Game } from '../../engine'\n\nexport class DrinkPotionEvent extends CreatureEvent {\n  constructor(private potion: Potion, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    actor.removeItem(this.potion, 1)\n    this.potion.onDrink(this.game)\n    // TODO: Different messages for player and creatures\n    this.game.logger.drink(this.potion)\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Tile, GroupedItem, Game } from '../../engine'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Item } from '../models/items'\nimport { PlayerEvent } from './player_event'\n\nexport class DropItemsEvent extends PlayerEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    // TODO: Validate items are part of positions\n    this.items.forEach(({ item, count }) => {\n      player.removeItem(item, count)\n      player.stuffWeight.subtract(item.weight * count)\n\n      this.game.logger.droppedItem(item, count)\n      this.tile.addItem(item, count)\n    })\n\n    return Reaction.NOTHING\n  }\n}\n","import { PlayerEvent } from './player_event'\nimport { Reaction } from '../models/creature'\nimport { Player } from '../models/player'\n\nexport class LevelUpEvent extends PlayerEvent {\n  public affectPlayer(player: Player): Reaction {\n    this.updateHealth(player)\n\n    return Reaction.NOTHING\n  }\n\n  protected updateHealth(player: Player): void {\n    const constitution = player.constitution.current\n\n    if (constitution < 3) {\n      player.health.constantDecrease(2)\n    } else if (constitution < 6) {\n      player.health.constantDecrease(1)\n    } else if (constitution < 12) {\n      // No change\n    } else if (constitution < 15) {\n      player.health.constantIncrease(1)\n    } else if (constitution < 18) {\n      player.health.constantIncrease(2)\n    } else if (constitution < 20) {\n      player.health.constantIncrease(3)\n    } else {\n      player.health.constantIncrease(4)\n    }\n\n    if (player.health.maximum < 1) {\n      player.health.constantIncrease(1 - player.health.maximum)\n    }\n\n    // TODO: Add per race / class hp increase\n  }\n}\n","import { Item } from './items'\nimport { Point } from '../utils/utils'\nimport { Memory } from './memory'\n\nexport abstract class TileEffect {\n  constructor(public onDone: () => void) {}\n\n  public abstract done(): boolean\n  public abstract patchMemory(memory: Memory): void\n  public speed(): number {\n    return -1\n  }\n}\n\nexport class ItemFlightTileEffect extends TileEffect {\n  constructor(\n    public readonly item: Item,\n    private frames: Point[],\n    onDone: () => void\n  ) {\n    super(onDone)\n  }\n\n  public patchMemory(memory: Memory): void {\n    if (this.done()) {\n      return\n    }\n\n    const [point] = this.frames.splice(0, 1)\n    const tile = memory.at(point.x, point.y)\n\n    if (tile.visible) {\n      tile.effect = '-'\n    } else {\n      // Skipping effect if it's not visible\n      this.patchMemory(memory)\n    }\n  }\n\n  public done(): boolean {\n    return this.frames.length === 0\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { AddExperienceEvent } from './add_experience_event'\nimport { Item } from '../models/items'\nimport { Game } from '../models/game'\nimport { DieEvent, DieReason } from './die_event'\nimport { LevelMap } from '../../engine'\nimport { Calculator } from '../lib/calculator'\n\nexport class ThrowEvent extends CreatureEvent {\n  constructor(\n    public victim: Creature,\n    public missile: Item,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (Calculator.misses(actor.bodyControl, this.victim.bodyControl)) {\n      this.game.logger.throwMissMessage(actor, this.victim, this.missile)\n      return Reaction.THROW_DODGE\n    }\n\n    // TODO: Calculate normally\n    const damage = Calculator.throwDamageTo(10, 10)\n\n    if (damage >= this.victim.health.currentValue) {\n      actor.on(new AddExperienceEvent(this.victim, this.levelMap, this.game))\n      this.game.logger.throwKillMessage(\n        damage,\n        actor,\n        this.victim,\n        this.missile\n      )\n      return this.victim.on(\n        new DieEvent(this.game, this.levelMap, DieReason.Missile)\n      )\n    } else {\n      this.victim.health.decrease(damage)\n      this.game.logger.throwHurtMessage(\n        damage,\n        actor,\n        this.victim,\n        this.missile\n      )\n      return Reaction.HURT\n    }\n  }\n}\n","import {\n  InventorySlot,\n  CreatureEvent,\n  Game,\n  Item,\n  Armor,\n  RemoveImpactEvent,\n} from '../../engine'\nimport { Reaction, Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { findIndex } from 'lodash'\nimport { Protection, Weapon } from '../models/items'\nimport { Damage } from '../lib/damage'\n\nexport class TakeOffItemEvent extends CreatureEvent {\n  constructor(private slot: InventorySlot, private game: Game) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const equipment = this.slot.equipment\n\n    if (equipment === undefined) {\n      throw `Can not take off item from ${this.slot.name} - nothing equipped`\n    }\n\n    this.slot.takeOff()\n    this.onTakeOff(player, equipment.item)\n    player.inventory.putToBag(equipment.item, equipment.count)\n    this.game.logger.takeOff(equipment.item)\n\n    return Reaction.NOTHING\n  }\n\n  private onTakeOff(player: Player, item: Item): void {\n    // player.characteristics.removeModifier(item.modifier)\n\n    if (item instanceof Armor) {\n      item.protections.forEach((itemProtection: Protection) => {\n        player.itemsProtections.splice(\n          findIndex(\n            player.itemsProtections,\n            protection => protection === itemProtection\n          ),\n          1\n        )\n      })\n    }\n\n    if (item instanceof Weapon) {\n      item.damages.forEach((itemDamage: Damage) => {\n        player.itemsDamages.splice(\n          findIndex(player.itemsDamages, damage => damage === itemDamage),\n          1\n        )\n      })\n    }\n\n    item.impacts.forEach(impact => {\n      player.on(new RemoveImpactEvent(impact, item.name, this.game))\n    })\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Reaction, Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { InventorySlot } from '../models/inventory_slot'\nimport { TakeOffItemEvent } from './take_off_item_event'\nimport { Game } from '../models/game'\n\nexport class RemoveItemEvent extends CreatureEvent {\n  constructor(\n    private slot: InventorySlot,\n    private count: number,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (!this.slot.equipment) {\n      throw `RemoveItemEvent: ${this.slot.name} has no equipment`\n    }\n\n    if (this.slot.equipment.count === this.count) {\n      return player.on(new TakeOffItemEvent(this.slot, this.game))\n    } else {\n      this.slot.equipment.count -= this.count\n    }\n\n    return Reaction.NOTHING\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Point } from '../utils/utils'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { ItemFlightTileEffect } from '../models/tile_effect'\nimport { ThrowEvent } from './throw_event'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Missile } from '../models/items'\nimport { RemoveItemEvent } from './remove_item_event'\n\nexport class MissileAttackEvent extends CreatureEvent {\n  constructor(\n    private path: Point[],\n    private game: Game,\n    private levelMap: LevelMap,\n    private done: (reaction: Reaction) => void\n  ) {\n    super()\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    let missile = actor.missile\n\n    if (!missile) {\n      throw 'MissileAttackEvent called when actor has no missiles'\n    }\n\n    this.withMissile(actor, missile.item)\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    const missile = player.missile\n\n    if (!missile) {\n      throw 'MissileAttackEvent: slot has no items'\n    }\n\n    this.withMissile(player, missile.item)\n\n    player.on(new RemoveItemEvent(player.inventory.missileSlot, 1, this.game))\n    player.stuffWeight.subtract(missile.item.weight)\n\n    return Reaction.NOTHING\n  }\n\n  private withMissile(actor: Creature, missile: Missile): void {\n    let flightPath: Point[] = [],\n      victim: Creature | undefined\n\n    this.path.forEach(point => {\n      if (!victim) {\n        const tile = this.levelMap.at(point.x, point.y)\n        victim = tile.creature\n        flightPath.push(point)\n      }\n    })\n\n    this.game.effect = new ItemFlightTileEffect(missile, flightPath, () => {\n      if (victim) {\n        this.done(\n          actor.on(new ThrowEvent(victim, missile, this.levelMap, this.game))\n        )\n      } else {\n        this.done(Reaction.NOTHING)\n      }\n    })\n  }\n}\n","import { Game, GroupedItem, ItemsBunch, Tile } from '../../engine'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Item } from '../models/items'\nimport { PlayerEvent } from './player_event'\n\nexport class PickUpItemsEvent extends PlayerEvent {\n  constructor(\n    private tile: Tile,\n    private items: GroupedItem<Item>[],\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    let tileItems: ItemsBunch<Item> | undefined = this.tile.items\n\n    if (tileItems === undefined) {\n      throw 'Failed to pick up items - tile has no items'\n    } else {\n      this.withTileItems(player, tileItems)\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected withTileItems(subject: Player, tileItems: ItemsBunch<Item>) {\n    this.items.forEach(({ item, count }) => {\n      subject.addItem(item, count)\n      subject.stuffWeight.add(item.weight * count)\n\n      this.game.logger.pickedUpItem(item, count)\n      tileItems.remove(item, count)\n    })\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { InventorySlot, Item, Game } from '../../engine'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { TakeOffItemEvent } from './take_off_item_event'\nimport { Armor, Weapon } from '../models/items'\nimport { AddImpactEvent } from './add_impact_event'\n\nexport class PutOnItemEvent extends CreatureEvent {\n  constructor(\n    private slot: InventorySlot,\n    private item: Item,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    let inventory = player.inventory,\n      groupItem = inventory.findInBag(this.item)\n\n    if (groupItem === undefined) {\n      throw `Item ${\n        this.item.name\n      } can not be equipped - not found in inventory`\n    }\n\n    // TODO: assert that can't equip more than have in inventory\n    // TODO: assert can equip\n    if (this.slot.equipment) {\n      const reaction = player.on(new TakeOffItemEvent(this.slot, this.game))\n      if (reaction !== Reaction.NOTHING) {\n        return reaction\n      }\n    }\n\n    const count = this.slot.useSingleItem ? 1 : groupItem.count\n\n    player.removeItem(this.item, count)\n    this.slot.equip(this.item, count)\n    this.onPutOn(player, this.item)\n\n    this.game.logger.putOn(this.item)\n\n    return Reaction.NOTHING\n  }\n\n  private onPutOn(player: Player, item: Item): void {\n    if (item instanceof Armor) {\n      player.itemsProtections = player.itemsProtections.concat(item.protections)\n    }\n\n    if (item instanceof Weapon) {\n      player.itemsDamages = player.itemsDamages.concat(item.damages)\n    }\n\n    item.impacts.forEach(impact => {\n      player.on(new AddImpactEvent(impact, item.name, this.game))\n    })\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Creature, Reaction } from '../models/creature'\nimport { ImpactType, Game } from '../../engine'\n\nexport class RemoveImpactEvent extends CreatureEvent {\n  constructor(\n    private impactType: ImpactType,\n    private source: string,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(creature: Creature): Reaction {\n    return Reaction.NOTHING\n  }\n}\n","import { Creature, Reaction } from '../models/creature'\nimport { LevelMap, Game } from '../../engine'\nimport { CreatureEvent } from './internal'\n\nexport abstract class VisibleCreatureEvent extends CreatureEvent {\n  constructor(protected levelMap: LevelMap, protected game: Game) {\n    super()\n  }\n\n  protected playerSees(actor: Creature): boolean {\n    let { x, y } = this.levelMap.creaturePos(actor)\n    return this.game.player.stageMemory(this.levelMap).at(x, y).visible\n  }\n}\n\nexport class MessageCreatureEvent extends VisibleCreatureEvent {\n  constructor(\n    levelMap: LevelMap,\n    game: Game,\n    private onCreature: () => void,\n    private onPlayer: () => void\n  ) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (this.playerSees(actor)) {\n      this.onCreature()\n    }\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(): Reaction {\n    this.onPlayer()\n\n    return Reaction.NOTHING\n  }\n}\n","import { LevelMap, Tile, Item } from '../../engine'\nimport { Pool } from '../lib/pool'\nimport { Creature } from '../models/creature'\nimport { Point, cycle } from '../utils/utils'\n\nimport { random } from 'lodash'\n\nexport const addDoors = function(\n  level: LevelMap,\n  doorTile: () => Tile,\n  addDoor: () => boolean = () => true\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width; i++) {\n      const tile = level.at(i, j),\n        up = level.at(i, j - 1),\n        down = level.at(i, j + 1),\n        left = level.at(i - 1, j),\n        right = level.at(i + 1, j)\n\n      if (!addDoor() || tile.key !== 'C') {\n        continue\n      }\n\n      if (\n        left.key === 'D' ||\n        right.key === 'D' ||\n        up.key === 'D' ||\n        down.key === 'D'\n      ) {\n        continue\n      }\n\n      if (\n        left.key !== 'R' &&\n        right.key !== 'R' &&\n        up.key !== 'R' &&\n        down.key !== 'R'\n      ) {\n        continue\n      }\n\n      if (\n        (left.key === 'W' && right.key === 'W') ||\n        (up.key === 'W' && down.key === 'W')\n      ) {\n        level.setTile(i, j, doorTile())\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addCreatures = function(\n  chance: number,\n  level: LevelMap,\n  creaturesPool: Pool<null, Creature>\n): LevelMap {\n  for (let i = 1; i < level.width - 1; i++) {\n    for (let j = 1; j < level.height - 1; j++) {\n      if (level.at(i, j).passibleThrough() && Math.random() < chance) {\n        level.addCreature(new Point(i, j), creaturesPool.pick(null))\n      }\n    }\n  }\n\n  return level\n}\n\nexport const addItems = function(\n  chance: number,\n  level: LevelMap,\n  itemsPool: Pool<null, Item>\n): LevelMap {\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      const tile = level.at(i, j)\n      if (tile.passibleThrough() && Math.random() < chance) {\n        tile.addItem(itemsPool.pick(null), 1)\n      }\n    }\n  }\n\n  return level\n}\n\nexport const centralize = function(level: LevelMap): LevelMap {\n  let minX = level.width,\n    minY = level.height,\n    maxX = 0,\n    maxY = 0\n\n  for (let j = 1; j < level.height - 1; j++) {\n    for (let i = 1; i < level.width - 1; i++) {\n      if (!level.at(i, j).passibleThrough()) {\n        continue\n      }\n\n      maxY = Math.max(j, maxY)\n      maxX = Math.max(i, maxX)\n      minY = Math.min(j, minY)\n      minX = Math.min(i, minX)\n    }\n  }\n\n  const dx = Math.floor((level.width - (maxX - minX)) / 2) - minX,\n    dy = Math.floor((level.height - (maxY - minY)) / 2) - minY\n\n  cycle(level.map, dx)\n  level.map.forEach(row => cycle(row, dy))\n\n  return level\n}\n\n// TODO: Move away from generators\nexport const withMatchingTile = function(\n  level: LevelMap,\n  match: (tile: Tile) => boolean,\n  onValid: (x: number, y: number) => void\n): LevelMap {\n  let iters = level.width * level.height\n\n  while (iters > 0) {\n    const x = random(0, level.width - 1),\n      y = random(0, level.height - 1)\n\n    if (match(level.at(x, y))) {\n      onValid(x, y)\n      return level\n    }\n\n    iters--\n  }\n\n  throw 'post add failed to add tile'\n}\n","import { VisibleCreatureEvent } from './visible_creature_event'\nimport { Reaction, Creature } from '../models/creature'\nimport { Player } from '../models/player'\nimport { withMatchingTile } from '../generator/post'\nimport { MoveEvent } from './move_event'\nimport { Point } from '../utils/utils'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Resistance } from '../models/specie'\nimport { AITeleportationEvent } from '../ai/player_ai'\n\n// TODO: Creature that teleports itself away\nexport class TeleportationEvent extends VisibleCreatureEvent {\n  constructor(levelMap: LevelMap, game: Game, private selfCast: boolean) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    if (this.playerSees(actor)) {\n      if (\n        actor.hasResistance(Resistance.TeleportationControl) ||\n        !this.teleport(actor)\n      ) {\n        this.game.logger.creatureNotTeleported(actor)\n      } else {\n        this.game.logger.creatureTeleported(actor)\n      }\n    } else {\n      this.teleport(actor)\n    }\n\n    // TODO: Add a message if player sees new position\n\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    if (player.hasResistance(Resistance.TeleportationControl)) {\n      if (!this.selfCast) {\n        this.game.logger.playerTeleportationCaused()\n      }\n\n      player.ai.pushEvent(new AITeleportationEvent(this.levelMap, this.game))\n      this.game.ai = player.ai\n    } else if (this.teleport(player)) {\n      if (!this.selfCast) {\n        this.game.logger.playerTeleported()\n      }\n    } else {\n      this.game.logger.playerNotTeleported()\n    }\n\n    return Reaction.NOTHING\n  }\n\n  protected teleport(actor: Creature): boolean {\n    let teleported = false\n\n    try {\n      withMatchingTile(\n        this.levelMap,\n        // TODO: Extract to a method or post-function\n        tile => tile.isFloor() && tile.passibleThrough(),\n        (x, y) => {\n          teleported = true\n          actor.on(new MoveEvent(this.game, this.levelMap, new Point(x, y)))\n        }\n      )\n    } catch {}\n\n    return teleported\n  }\n}\n","import { VisibleCreatureEvent } from './visible_creature_event'\nimport { Trap } from '../models/tile'\nimport { Creature, Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\nimport { Calculator } from '../lib/calculator'\n\nexport class TrapEvent extends VisibleCreatureEvent {\n  constructor(\n    private trap: Trap,\n    private dodgeRatio: number,\n    levelMap: LevelMap,\n    game: Game,\n    private onCreatureDodge: (sees: boolean, isPlayer: boolean) => void,\n    private onCreatureActivated: (sees: boolean, isPlayer: boolean) => Reaction\n  ) {\n    super(levelMap, game)\n  }\n\n  public affectCreature(actor: Creature): Reaction {\n    // TODO: Special messages for dying.\n    const sees = this.playerSees(actor)\n    if (sees) {\n      this.trap.revealed = true\n    }\n\n    if (this.dodges(actor)) {\n      this.onCreatureDodge(sees, false)\n      return Reaction.DODGE\n    } else {\n      return this.onCreatureActivated(sees, false)\n    }\n  }\n\n  public affectPlayer(actor: Player): Reaction {\n    this.trap.revealed = true\n\n    if (this.dodges(actor)) {\n      this.onCreatureDodge(true, true)\n      return Reaction.DODGE\n    } else {\n      return this.onCreatureActivated(true, true)\n    }\n  }\n\n  protected dodges(actor: Creature): boolean {\n    return Calculator.dodges(actor.bodyControl, this.dodgeRatio)\n  }\n}\n","import { CreatureEvent } from './internal'\nimport { Reaction } from '../models/creature'\nimport { Player } from '../models/player'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { Trap } from '../models/tile'\nimport { Point } from '../utils/utils'\n\nexport class UntrapEvent extends CreatureEvent {\n  constructor(\n    private trapPosition: Point,\n    private trap: Trap,\n    private levelMap: LevelMap,\n    private game: Game\n  ) {\n    super()\n  }\n\n  public affectCreature(): Reaction {\n    return Reaction.NOTHING\n  }\n\n  public affectPlayer(player: Player): Reaction {\n    this.trap.untrap(this.trapPosition, this.levelMap, this.game)\n    return Reaction.NOTHING\n  }\n}\n","import { twoDimArray } from '../utils/utils'\n\nexport default function<T>(\n  drawMap: string[],\n  collection: Map<string, () => T>\n): T[][] {\n  return twoDimArray(drawMap[0].length, drawMap.length, (x, y) => {\n    const tile = collection.get(drawMap[y].charAt(x))\n    if (tile) {\n      return tile()\n    } else {\n      throw `drawn: Can not find char ${drawMap[y].charAt(x)}`\n    }\n  })\n}\n","import { Rect, Point, rand, twoDimArray, minUnsafe } from '../utils/utils'\nimport { min } from 'lodash'\n\nconst THICKNESS = 0\nconst RAY_TURNS = 60\nconst DELTA_ANGLE = Math.PI / (RAY_TURNS * 2)\n\nclass Room<T> extends Rect {\n  notCross(rect: Rect): boolean {\n    return (\n      rect.x - THICKNESS > this.x + this.w ||\n      rect.y - THICKNESS > this.y + this.h ||\n      rect.x + rect.w < this.x - THICKNESS ||\n      rect.y + rect.h < this.y - THICKNESS\n    )\n  }\n\n  pointWithin(): Point {\n    return new Point(\n      this.x + 1 + rand(this.w - 1),\n      this.y + 1 + rand(this.h - 1)\n    )\n  }\n\n  add(stage: T[][], walls: boolean[][], newRoomSpace: () => T): void {\n    let i: number = 0\n    while (i < this.w) {\n      let j: number = 0\n      while (j < this.h) {\n        stage[this.x + i][this.y + j] = newRoomSpace()\n        walls[this.x + i][this.y + j] = false\n        j++\n      }\n\n      i++\n    }\n  }\n}\n\nclass Road<T> extends Rect {\n  lined: boolean\n\n  constructor(x: number, y: number, w: number, h: number) {\n    super(x, y, w, h)\n    this.lined = (x >= w && y >= h) || (w >= x && h >= y)\n  }\n\n  add(stage: T[][], walls: boolean[][], newCorridor: () => T): void {\n    let [hx, hy, w] = this.horizontalLine()\n\n    let i = 0\n    while (i < w) {\n      if (walls[hx + i][hy]) {\n        stage[hx + i][hy] = newCorridor()\n      }\n      i += 1\n    }\n\n    let [vx, vy, h] = this.verticalLine()\n    let j = 0\n    while (j < h) {\n      if (walls[vx][vy + j]) {\n        stage[vx][vy + j] = newCorridor()\n      }\n      j += 1\n    }\n  }\n\n  horizontalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.max(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.w - this.x),\n      ]\n  }\n\n  verticalLine(): [number, number, number] {\n    // x\n    // |\\\n    // .-x\n    if (this.lined)\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n    // .-x\n    // |/\n    // x\n    else\n      return [\n        Math.min(this.x, this.w),\n        Math.min(this.y, this.h),\n        Math.abs(this.h - this.y),\n      ]\n  }\n}\n\nclass DungeonGenerator<T> {\n  rooms: Room<T>[]\n  roads: Road<T>[]\n\n  constructor(\n    protected maxX: number,\n    protected maxY: number,\n    private minSize: number,\n    private maxSize: number,\n    private roomsCount: number\n  ) {\n    let rooms: Room<T>[] = new Array(this.roomsCount)\n      .fill(undefined)\n      .map(_ => this.generateRoom())\n\n    this.rooms = this.normalize(this.ray(rooms))\n    this.roads = this.buildRoads(this.rooms)\n  }\n\n  private generateRoom(): Room<T> {\n    return new Room(\n      0,\n      0,\n      this.minSize + rand(this.maxSize - this.minSize),\n      this.minSize + rand(this.maxSize - this.minSize)\n    )\n  }\n\n  // Takes a room and tries to put it on a ray coming from (0, 0)\n  // until the room finds empty place for it.\n  private ray(rooms: Room<T>[]): Room<T>[] {\n    return rooms.reduce((pickedRooms: Room<T>[], currentRoom: Room<T>) => {\n      for (\n        let i = 0, angle = (rand(360) / 180) * Math.PI;\n        i < RAY_TURNS;\n        angle += DELTA_ANGLE, i++\n      ) {\n        // TODO: Build table with these values.\n        const cos: number = Math.cos(angle)\n        const sin: number = Math.sin(angle)\n        let l: number = 1\n        let dx: number = 0\n        let dy: number = 0\n\n        let roomToMove = new Room(\n          currentRoom.x,\n          currentRoom.y,\n          currentRoom.w,\n          currentRoom.h\n        )\n\n        while (Math.abs(dx) < this.maxX / 2 && Math.abs(dy) < this.maxY / 2) {\n          let ndx = Math.round(l * cos)\n          let ndy = Math.round(l * sin)\n\n          while (ndx === dx && ndy === dy) {\n            l += 1\n            ndx = Math.round(l * cos)\n            ndy = Math.round(l * sin)\n          }\n\n          roomToMove.move(ndx - dx, ndy - dy)\n          dx = ndx\n          dy = ndy\n\n          if (pickedRooms.every(room => roomToMove.notCross(room))) {\n            pickedRooms.push(roomToMove)\n            return pickedRooms\n          }\n        }\n      }\n\n      return pickedRooms\n    }, [])\n  }\n\n  private normalize(rooms: Room<T>[]): Room<T>[] {\n    if (rooms.length === 0) {\n      return rooms\n    }\n\n    const minX = minUnsafe(rooms.map(room => room.x)) - 1\n    rooms.forEach(room => {\n      room.move(-minX, 0)\n    })\n    rooms = rooms.filter((room: Room<T>) => room.x + room.w < this.maxX)\n\n    const minY = minUnsafe(rooms.map(room => room.y)) - 1\n    rooms.forEach(room => {\n      room.move(0, -minY)\n    })\n    return rooms.filter((room: Room<T>) => room.y + room.h < this.maxY)\n  }\n\n  private buildRoads(rooms: Room<T>[]): Road<T>[] {\n    let points: Point[] = rooms.map(room => {\n      return room.pointWithin()\n    })\n\n    const firstPoint = points.shift()\n\n    if (!firstPoint) {\n      throw 'Dungeon.buildRoads rooms array is empty'\n    }\n\n    let connectedPoints: Point[] = [firstPoint]\n    let roads: Road<T>[] = []\n\n    const distance = function(point1: Point, point2: Point): number {\n      // No need to calc square root since it's being used for comparison only.\n      return (point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2\n    }\n\n    while (points.length) {\n      let maybePoint = points.shift()\n      if (!maybePoint) {\n        throw 'Dungeon.buildRoads rooms array is empty'\n      }\n\n      let currentPoint: Point = maybePoint\n\n      let pointToConnect = connectedPoints[0]\n      let minDistance = distance(currentPoint, pointToConnect)\n\n      connectedPoints.forEach(point => {\n        const currentDistance = distance(point, currentPoint)\n        if (currentDistance < minDistance) {\n          pointToConnect = point\n          minDistance = currentDistance\n        }\n      })\n\n      connectedPoints.push(currentPoint)\n\n      roads.push(\n        new Road(\n          currentPoint.x,\n          currentPoint.y,\n          pointToConnect.x,\n          pointToConnect.y\n        )\n      )\n    }\n\n    return roads\n  }\n}\n\nexport default function<T>(\n  dimX: number,\n  dimY: number,\n  minSize: number,\n  maxSize: number,\n  roomsCount: number,\n  newRoomSpace: () => T,\n  newCorridor: () => T,\n  newWall: () => T\n): T[][] {\n  // TODO: Validate min or max size is lower than map's sizes\n  const dungeon = new DungeonGenerator<T>(\n    dimX,\n    dimY,\n    minSize,\n    maxSize,\n    roomsCount\n  )\n\n  let stage = twoDimArray(dimX, dimY, newWall)\n  let walls = twoDimArray(dimX, dimY, () => true)\n\n  for (let i = 0; i < dungeon.rooms.length; i++)\n    dungeon.rooms[i].add(stage, walls, newRoomSpace)\n  for (let i = 0; i < dungeon.roads.length; i++)\n    dungeon.roads[i].add(stage, walls, newCorridor)\n\n  return stage\n}\n","import { Resistance } from '../models/specie'\n\nexport enum DamageType {\n  Melee,\n  Pierce,\n  Blunt,\n  Magic,\n  Pure,\n}\n\nexport type Dice = {\n  times: number\n  max: number\n}\n\nexport type Damage = {\n  extra: number\n  dice: Dice\n  type: DamageType\n  resistances?: Resistance[]\n}\n","import { Creature } from './creature'\nimport { Item, Potion } from './items'\n\nimport { last } from 'lodash'\n\nexport enum LogLevel {\n  DEBUG,\n  INFO,\n  WARNING,\n  DANGER,\n}\n\nexport interface LogMessage {\n  level: LogLevel\n  message: string\n  counter: number\n}\n\nexport class Logger {\n  public messages: LogMessage[] = []\n\n  public reset() {\n    this.messages = []\n  }\n\n  public hurtMessage(damage: number, actor: Creature, target: Creature) {\n    this.debug(`${target.name} got ${damage} damage from ${actor.name}`)\n  }\n\n  public killMessage(damage: number, actor: Creature, target: Creature) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${\n        actor.name\n      } causes them to die`\n    )\n  }\n\n  public missMessage(actor: Creature, target: Creature) {\n    this.debug(`${actor.name} misses ${target.name}!`)\n  }\n\n  public throwMissMessage(actor: Creature, target: Creature, missile: Item) {\n    this.debug(\n      `${actor.name} throws ${missile.name} in ${target.name}, but misses!`\n    )\n  }\n\n  public throwKillMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.warning(\n      `${target.name} got ${damage} damage from ${actor.name} by ${\n        missile.name\n      } causes them to die`\n    )\n  }\n\n  public throwHurtMessage(\n    damage: number,\n    actor: Creature,\n    target: Creature,\n    missile: Item\n  ) {\n    this.debug(\n      `${target.name} got ${damage} damage from ${actor.name} by ${\n        missile.name\n      }`\n    )\n  }\n\n  public ranIntoAnObstacle(): void {\n    this.addMessage(LogLevel.DEBUG, 'You ran into a wall')\n  }\n\n  public howToHandle(): void {\n    this.addMessage(LogLevel.DEBUG, \"Don't know how to handle it\")\n  }\n\n  public noItemsToPickUp(): void {\n    this.addMessage(LogLevel.DEBUG, \"You don't see anything to pick up\")\n  }\n\n  public takeOff(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You took off ${item.name}`)\n  }\n\n  public putOn(item: Item): void {\n    this.addMessage(LogLevel.DEBUG, `You put on ${item.name}`)\n  }\n\n  public drink(item: Potion): void {\n    this.addMessage(LogLevel.INFO, `You drunk ${item.name}`)\n  }\n\n  public nothingToShotWith(): void {\n    this.addMessage(LogLevel.DEBUG, 'You have nothing to shoot with')\n  }\n\n  public needMissileWeapon(): void {\n    this.addMessage(LogLevel.DEBUG, 'Мне нужен лук или типа того')\n  }\n\n  public youSteppedInTrap(): void {\n    this.addMessage(LogLevel.DANGER, 'Я наступил в ловушку')\n  }\n\n  public creatureSteppedInTrap(creature: Creature): void {\n    this.addMessage(LogLevel.DANGER, `${creature.name} наступил в ловушку`)\n  }\n\n  public noDamageToPlayer(actor: Creature): void {\n    this.addMessage(\n      LogLevel.DEBUG,\n      `${actor.name} ударил по мне, но я не почувствовал боли`\n    )\n  }\n\n  public noDamageToTarget(actor: Creature): void {\n    this.addMessage(\n      LogLevel.DEBUG,\n      `Удар пришелся по ${actor.name} но остался незамеченным`\n    )\n  }\n\n  public playerIgnoresDamage(target: Creature): void {\n    this.addMessage(LogLevel.DEBUG, `Я игнорирую урон ${target.name}`)\n  }\n\n  public targetIgnoresDamage(target: Creature): void {\n    this.addMessage(LogLevel.INFO, `${target.name} игнорирует урон`)\n  }\n\n  public creatureTeleported(actor: Creature): void {\n    this.addMessage(LogLevel.INFO, `${actor.name} иcчез`)\n  }\n\n  public creatureNotTeleported(actor: Creature): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `${actor.name} озарился светом, но ничего не произошло`\n    )\n  }\n\n  public creatureDodgesTeleportationTrap(actor: Creature): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `${actor.name} попал в ловушку телепортации но смог увернуться`\n    )\n  }\n\n  public playerTeleportationCaused(): void {\n    this.addMessage(LogLevel.INFO, `Что-то заставило меня телепортироваться`)\n  }\n\n  public playerTeleported(): void {\n    this.addMessage(LogLevel.INFO, `Яркая вспышка и я оказался в другом месте`)\n  }\n\n  public playerNotTeleported(): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `Я озарился ярким светом, но ничего не произошло`\n    )\n  }\n\n  public playerTeleportedWhereTheyWere(): void {\n    this.addMessage(LogLevel.INFO, `Я решил никуда не телепортироваться`)\n  }\n\n  public playerDodgesTeleportationTrap(): void {\n    this.addMessage(\n      LogLevel.INFO,\n      `Я попал в ловушку телепортации но смог увернуться`\n    )\n  }\n\n  public canNotUntrap(): void {\n    this.addMessage(LogLevel.INFO, `Не представляю, как это обезвредить`)\n  }\n\n  public pickedUpItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You picked up ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You picked up ${count} ${item.name}`)\n    }\n  }\n\n  public droppedItem(item: Item, count: number): void {\n    if (count === 1) {\n      this.addMessage(LogLevel.INFO, `You dropped a ${item.name}`)\n    } else {\n      this.addMessage(LogLevel.INFO, `You dropped ${count} ${item.name}`)\n    }\n  }\n\n  public debug(message: string): void {\n    this.addMessage(LogLevel.DEBUG, message)\n  }\n\n  public info(message: string): void {\n    this.addMessage(LogLevel.INFO, message)\n  }\n\n  public warning(message: string): void {\n    this.addMessage(LogLevel.WARNING, message)\n  }\n\n  public danger(message: string): void {\n    this.addMessage(LogLevel.DANGER, message)\n  }\n\n  protected addMessage(level: LogLevel, message: string): void {\n    const lastRow: LogMessage | undefined = last(this.messages)\n\n    if (lastRow && lastRow.message === message) {\n      lastRow.counter += 1\n    } else {\n      this.messages.push({ level, message, counter: 1 })\n    }\n  }\n}\n","import { Game } from './game'\n\nexport enum TalentStatus {\n  Available,\n  Completed,\n  Unavailable,\n}\n\nexport abstract class Talent {\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public readonly depth: number,\n    public rank: number,\n    public readonly maxRank: number,\n    public readonly description: string\n  ) {}\n\n  public abstract onObtain(game: Game): void\n}\n","import { PresenterType } from './internal'\n\nimport { LevelMap, Game, IdlePresenter } from '../../engine'\nimport { PickPointPresenter } from './pick_point_presenter'\n\nexport enum LookPresenterVisibility {\n  See,\n  Recall,\n  Hidden,\n}\n\nexport class LookPresenter extends PickPointPresenter<\n  LookPresenterVisibility,\n  string\n> {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Look, levelMap, game, '_', target =>\n      this.memory.inRange(target)\n    )\n  }\n\n  get title(): LookPresenterVisibility {\n    if (this.memoryTile.visible) {\n      return LookPresenterVisibility.See\n    } else if (this.memoryTile.seen) {\n      return LookPresenterVisibility.Recall\n    } else {\n      return LookPresenterVisibility.Hidden\n    }\n  }\n\n  get body(): string[] {\n    let messages = []\n\n    if (this.memoryTile.creature) {\n      if (this.memoryTile.creature.id === this.player.id) {\n        messages.push('Это я')\n      } else {\n        messages.push(`Это ${this.memoryTile.creature.name}`)\n      }\n    }\n\n    if (this.memoryTile.items) {\n      switch (this.memoryTile.items.bunch.length) {\n        case 0:\n          break\n        case 1:\n          messages.push(`Лежит ${this.memoryTile.items.bunch[0].item.name}`)\n          break\n        default:\n          messages.push('Лежит несколько предметов')\n      }\n    }\n\n    return messages\n  }\n\n  protected close(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n","export class Level {\n  public current: number = 1\n  public currentExperience: number = 0\n  public requiredExperience: number\n\n  private doneLeveling: boolean = false\n\n  constructor(private requires: number[]) {\n    this.requiredExperience = this.requires[0]\n  }\n\n  public add(exp: number): number[] {\n    if (this.doneLeveling) {\n      return []\n    }\n\n    this.currentExperience += exp\n\n    let levelUps = []\n\n    while (\n      !this.doneLeveling &&\n      this.currentExperience >= this.requiredExperience\n    ) {\n      this.levelUp()\n      levelUps.push(this.current)\n    }\n\n    return levelUps\n  }\n\n  protected levelUp(): void {\n    this.current += 1\n\n    let level = this.requires[this.current - 1]\n\n    if (level) {\n      this.currentExperience -= this.requiredExperience\n      this.requiredExperience = level\n    } else {\n      this.currentExperience = this.requiredExperience\n      this.doneLeveling = true\n    }\n  }\n}\n","import { random } from 'lodash'\n\nexport class Pool<Input, Output> {\n  private totalWeight: number = 0\n  private items: [number, (input: Input) => Output][] = []\n\n  constructor(items: [number, (input: Input) => Output][]) {\n    items.forEach(([weight, item]) => this.add(weight, item))\n  }\n\n  public add(weight: number, item: (input: Input) => Output): void {\n    if (weight < 1) {\n      throw `Item's weight is lower than 1`\n    }\n\n    this.items.push([weight, item])\n    this.totalWeight += Math.ceil(weight)\n  }\n\n  public pick(input: Input): Output {\n    if (this.items.length === 0) {\n      throw 'Tried to use empty pool'\n    }\n\n    let pick = random(this.totalWeight)\n\n    const found = this.items.find(([weight, item]) => {\n      pick -= weight\n\n      return pick <= 0\n    })\n\n    if (found !== undefined) {\n      return found[1](input)\n    }\n\n    throw 'Pool failed to pick anything'\n  }\n\n  public merge(pool: Pool<Input, Output>): Pool<Input, Output> {\n    let totalPool = new Pool<Input, Output>([])\n\n    this.items.forEach(([weight, item]) => totalPool.add(weight, item))\n    pool.items.forEach(([weight, item]) => totalPool.add(weight, item))\n\n    return totalPool\n  }\n}\n","import {\n  forEach,\n  keys,\n  min,\n  remove,\n  size,\n  pullAt,\n  pickBy,\n  includes,\n} from 'lodash'\n\nexport class Timeline<T> {\n  public step: number = 0\n  public turns: { [key: number]: T[] } = {}\n\n  public add(item: T, delta: number): void {\n    const ts = this.step + delta\n\n    if (this.turns[ts]) {\n      if (!includes(this.turns[ts], item)) {\n        this.turns[ts].push(item)\n      }\n    } else {\n      this.turns[ts] = [item]\n    }\n  }\n\n  public remove(item: T): void {\n    forEach(this.turns, (value, key) => {\n      remove(value, element => element === item)\n    })\n\n    this.turns = pickBy(this.turns, (val: T[]) => val.length > 0)\n  }\n\n  public next(): T {\n    this.step = this.nextStep()\n\n    const [element] = pullAt(this.turns[this.step], 0)\n\n    if (this.turns[this.step].length === 0) {\n      delete this.turns[this.step]\n    }\n\n    return element === undefined ? this.next() : element\n  }\n\n  public actors(): T[] {\n    if (size(this.turns) === 0) {\n      return []\n    }\n\n    this.step = this.nextStep()\n    const actors = this.turns[this.step]\n\n    delete this.turns[this.step]\n\n    return actors\n  }\n\n  private nextStep(): number {\n    let step = min(keys(this.turns).map(x => parseInt(x)))\n\n    if (step === undefined) {\n      throw 'Timeline.nextStep called when there is no ones turn'\n    }\n\n    return step\n  }\n}\n","import { withMatchingTile } from '../generator/post'\nimport { StairwayDown, StairwayUp, Tile } from './tile'\nimport { LevelMap, LevelMapId } from './level_map'\nimport { Game } from './game'\nimport { Player } from './player'\n\nexport abstract class Dungeon {\n  protected levels: LevelMap[] = []\n\n  constructor() {}\n  public abstract enter(game: Game, player: Player): void\n  public abstract register(game: Game): void\n\n  protected addStairDown(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayDown(map, adjustMapId))\n  }\n\n  protected addStairUp(map: LevelMap, adjustMapId: LevelMapId): LevelMap {\n    return this.addStairs(map, new StairwayUp(map, adjustMapId))\n  }\n\n  private addStairs(map: LevelMap, tile: Tile): LevelMap {\n    withMatchingTile(\n      map,\n      tile => tile.isFloor() && tile.passibleThrough(),\n      (x, y) => {\n        map.setTile(x, y, tile)\n      }\n    )\n\n    return map\n  }\n}\n","import { Creature, CreatureId } from './creature'\nimport { Mapped, Point } from '../utils/utils'\nimport { Timeline } from '../lib/timeline'\nimport { Tile, StairwayDown, StairwayUp } from './tile'\n\nimport { remove } from 'lodash'\n\n// TODO: Remove map id\nexport type LevelMapId = number\n\nexport class LevelMap extends Mapped<Tile> {\n  public creatures: Creature[] = []\n  public timeline: Timeline<CreatureId>\n  public name: string = 'unnamed'\n\n  constructor(public readonly id: LevelMapId, map: Tile[][]) {\n    super(map)\n    this.timeline = new Timeline()\n  }\n\n  public reset(): void {\n    this.timeline = new Timeline()\n  }\n\n  public enter(): void {\n    this.reset()\n    this.creatures.forEach(creature =>\n      this.timeline.add(creature.id, creature.speed)\n    )\n  }\n\n  public creatureTile(creature: Creature): Tile {\n    let tile: Tile | undefined\n\n    this.each(t => {\n      if (t.creature && t.creature.id === creature.id) {\n        tile = t\n      }\n    })\n\n    if (!tile) {\n      throw `Creature ${creature.id} is not found on map ${this.id}`\n    }\n\n    return tile\n  }\n\n  public creaturePos(creature: Creature): Point {\n    let pos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile.creature && tile.creature.id === creature.id) {\n        pos = new Point(x, y)\n      }\n    })\n\n    if (!pos) {\n      throw `Creature ${creature.id} is not found on map ${this.id}`\n    }\n\n    return pos\n  }\n\n  public addCreature(pos: Point, creature: Creature) {\n    this.creatures.push(creature)\n    // TODO fail if taken\n    this.at(pos.x, pos.y).creature = creature\n    this.timeline.add(creature.id, creature.speed)\n  }\n\n  public removeCreature(creature: Creature) {\n    let pos = this.creaturePos(creature),\n      tile = this.at(pos.x, pos.y)\n\n    tile.creature = undefined\n    remove(this.creatures, c => c.id === creature.id)\n    this.timeline.remove(creature.id)\n  }\n\n  public visibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].visibleThrough()\n  }\n\n  public passibleThrough(x: number, y: number): boolean {\n    return this.map[x][y].passibleThrough()\n  }\n\n  public setTile(x: number, y: number, tile: Tile): void {\n    this.map[x][y] = tile\n  }\n\n  public matchStairs(adjustId: LevelMapId, enterPos: Point): Point {\n    let stairPos: Point | undefined\n\n    this.each((tile, x, y) => {\n      if (tile instanceof StairwayDown || tile instanceof StairwayUp) {\n        if (tile.adjacentMapId === adjustId) {\n          tile.enterPos = enterPos\n          stairPos = new Point(x, y)\n        }\n      }\n    })\n\n    if (stairPos) {\n      return stairPos\n    }\n\n    throw `LevelMap ${this.name} failed to find stairs to ${adjustId}`\n  }\n}\n","import { ProfessionPicker } from './profession'\nimport { TileEffect } from './tile_effect'\nimport { LevelMapId, LevelMap } from './level_map'\nimport { Logger } from './logger'\nimport { Player } from './player'\nimport { PlayerAI } from '../../engine'\n\ntype MapGenerator = (id: LevelMapId, game: Game) => LevelMap\n\nexport abstract class Game {\n  public logger: Logger = new Logger()\n  public currentMap: LevelMap | undefined\n  public ai: PlayerAI | null = null\n  public running: boolean = false\n  public effect: TileEffect | null = null\n\n  protected maps: Map<LevelMapId, LevelMap | MapGenerator> = new Map()\n\n  constructor(\n    public player: Player,\n    public professionPicker: ProfessionPicker\n  ) {}\n\n  public turn() {\n    if (this.running || (this.ai && !this.effect)) {\n      return\n    }\n    this.running = true\n\n    if (!this.currentMap) {\n      throw 'levelMapTurn: Map is undefined'\n    }\n\n    if (this.effect) {\n      this.player.rebuildVision(this.currentMap)\n      this.effect.patchMemory(this.player.stageMemory(this.currentMap))\n\n      if (this.effect.done()) {\n        this.effect.onDone()\n        this.effect = null\n      }\n\n      this.running = false\n    } else {\n      while (!this.player.dead && !this.ai) {\n        this.levelMapTurn()\n      }\n\n      this.player.rebuildVision(this.currentMap)\n    }\n\n    this.running = false\n  }\n\n  public getMap(id: LevelMapId): LevelMap {\n    const levelMap = this.maps.get(id)\n\n    if (!levelMap) {\n      throw `Map with id ${id} is not found`\n    }\n\n    if (levelMap instanceof LevelMap) {\n      return levelMap\n    } else if (levelMap instanceof Function) {\n      const builtLevelMap = levelMap(id, this)\n      this.maps.set(id, builtLevelMap)\n      return builtLevelMap\n    } else {\n      throw `LevelMap with id ${id} is not found`\n    }\n  }\n\n  public addMap(id: LevelMapId, generator: MapGenerator): void {\n    // TODO: Raise if presence\n    this.maps.set(id, generator)\n  }\n\n  private levelMapTurn(): void {\n    // TODO: Remove!!!\n    if (!this.currentMap) {\n      throw 'levelMapTurn: Map is undefined'\n    }\n\n    let timeline = this.currentMap.timeline,\n      map = this.currentMap\n\n    const actorId = timeline.next()\n\n    if (actorId === undefined) {\n      throw 'Timeline event is empty!'\n    }\n\n    const actor = map.creatures.find(creature => actorId === creature.id)\n\n    if (actor) {\n      const speed = actor.act(map, this)\n\n      // If they are still on a map\n      if (speed && map.creatures.find(creature => actorId === creature.id)) {\n        timeline.add(actorId, speed)\n      }\n    }\n  }\n}\n","import { Usage, Item } from './items'\nimport { intersection } from 'lodash'\nimport { Inventory } from './inventory'\nimport { GroupedItem } from '../lib/bunch'\n\nexport abstract class InventorySlot {\n  public name: string = 'InventorySlot'\n\n  constructor(\n    // What kind of items can be put in slot\n    public readonly usages: Usage[],\n    // Has to put only a single item or can put a bunch of them\n    public readonly useSingleItem: boolean,\n    public equipment?: GroupedItem<Item>\n  ) {}\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    return inventory.cares().filter(itemGroup => this.match(itemGroup.item))\n  }\n\n  public equip(item: Item, count: number) {\n    if (this.equipment) {\n      throw `Slot ${this.name} is already equipped with ${this.equipment.item}`\n    }\n\n    this.equipment = { count, item }\n  }\n\n  public takeOff(): void {\n    if (!this.equipment) {\n      throw `Slot ${this.name} has nothing to take off`\n    }\n\n    this.equipment = undefined\n  }\n\n  protected match(item: Item): boolean {\n    return intersection(item.usages, this.usages).length > 0\n  }\n\n  protected withPairItem(\n    baseMatch: GroupedItem<Item>[],\n    item: Item\n  ): GroupedItem<Item>[] {\n    return baseMatch.filter(groupedItem => groupedItem.item.worksWith(item))\n  }\n}\n\nexport class RightHandSlot extends InventorySlot {\n  public name: string = 'Правая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class LeftHandSlot extends InventorySlot {\n  public name: string = 'Левая рука'\n  constructor() {\n    super([Usage.WeaponOneHand], true)\n  }\n}\n\nexport class HeadSlot extends InventorySlot {\n  public name: string = 'Голова'\n  constructor() {\n    super([Usage.WearsOnHead], true)\n  }\n}\n\nexport class ChestSlot extends InventorySlot {\n  public name: string = 'Корпус'\n  constructor() {\n    super([Usage.WearsOnBody], true)\n  }\n}\n\nexport class GlovesSlot extends InventorySlot {\n  public name: string = 'Перчатки'\n  constructor() {\n    super([Usage.Gloves], true)\n  }\n}\n\nexport class GauntletsSlot extends InventorySlot {\n  public name: string = 'Наручи'\n  constructor() {\n    super([Usage.Gauntlets], true)\n  }\n}\n\nexport class BeltSlot extends InventorySlot {\n  public name: string = 'Пояс'\n  constructor() {\n    super([Usage.Belt], true)\n  }\n}\n\nexport class BootsSlot extends InventorySlot {\n  public name: string = 'Ботинки'\n  constructor() {\n    super([Usage.Boots], true)\n  }\n}\n\nexport class AmuletSlot extends InventorySlot {\n  public name: string = 'Амулет'\n  constructor() {\n    super([Usage.Amulet], true)\n  }\n}\n\nexport class LeftFingerSlot extends InventorySlot {\n  public name: string = 'Левый палец'\n  constructor() {\n    super([Usage.Ring], true)\n  }\n}\n\nexport class RightFingerSlot extends InventorySlot {\n  public name: string = 'Правый палец'\n  constructor() {\n    super([Usage.Ring], true)\n  }\n}\n\nexport class CloakSlot extends InventorySlot {\n  public name: string = 'Плащ'\n  constructor() {\n    super([Usage.Cloak], true)\n  }\n}\n\nexport class MissileWeaponSlot extends InventorySlot {\n  public name: string = 'Метательное'\n  constructor() {\n    super([Usage.Shoot], true)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = super.matchingItems(inventory),\n      missile = inventory.missileSlot.equipment\n\n    if (missile) {\n      return this.withPairItem(baseMatch, missile.item)\n    }\n\n    return baseMatch\n  }\n}\n\nexport class MissileSlot extends InventorySlot {\n  public name: string = 'Снаряды'\n  constructor() {\n    super([Usage.Throw], false)\n  }\n\n  public matchingItems(inventory: Inventory): GroupedItem<Item>[] {\n    let baseMatch = inventory.cares(),\n      missileWeapon = inventory.missileWeaponSlot.equipment\n\n    if (missileWeapon) {\n      return this.withPairItem(baseMatch, missileWeapon.item)\n    }\n\n    return baseMatch\n  }\n}\n\nexport class ToolsSlot extends InventorySlot {\n  public name: string = 'Инструмент'\n  constructor() {\n    super([Usage.Tool], true)\n  }\n}\n","import {\n  InventorySlot,\n  RightHandSlot,\n  LeftHandSlot,\n  ChestSlot,\n  MissileWeaponSlot,\n  MissileSlot,\n  BootsSlot,\n  HeadSlot,\n  AmuletSlot,\n  LeftFingerSlot,\n  RightFingerSlot,\n  GlovesSlot,\n  GauntletsSlot,\n  BeltSlot,\n  ToolsSlot,\n  CloakSlot,\n} from './inventory_slot'\nimport { Item } from './items'\nimport { ItemsBunch, GroupedItem } from '../lib/bunch'\nimport { concat, compact } from 'lodash'\n\nexport class Inventory {\n  private bag: ItemsBunch<Item> = new ItemsBunch()\n\n  public headSlot = new HeadSlot()\n  public amuletSlot = new AmuletSlot()\n  public cloakSlot = new CloakSlot()\n  public chestSlot = new ChestSlot()\n  public rightHandSlot = new RightHandSlot()\n  public leftHandSlot = new LeftHandSlot()\n  public leftFingerSlot = new LeftFingerSlot()\n  public rightFingerSlot = new RightFingerSlot()\n  public glovesSlot = new GlovesSlot()\n  public gauntletsSlot = new GauntletsSlot()\n  public beltSlot = new BeltSlot()\n  public bootsSlot = new BootsSlot()\n  public missileWeaponSlot = new MissileWeaponSlot()\n  public missileSlot = new MissileSlot()\n  public toolsSlot = new ToolsSlot()\n\n  public slots(): InventorySlot[] {\n    return [\n      this.headSlot,\n      this.amuletSlot,\n      this.cloakSlot,\n      this.chestSlot,\n      this.rightHandSlot,\n      this.leftHandSlot,\n      this.leftFingerSlot,\n      this.rightFingerSlot,\n      this.glovesSlot,\n      this.gauntletsSlot,\n      this.beltSlot,\n      this.bootsSlot,\n      this.missileWeaponSlot,\n      this.missileSlot,\n      this.toolsSlot,\n    ]\n  }\n\n  get allItems(): GroupedItem<Item>[] {\n    return concat(\n      this.cares(),\n      compact(this.slots().map(slot => slot.equipment))\n    )\n  }\n\n  get unarmoredSlotsCount(): number {\n    return [\n      this.headSlot,\n      this.chestSlot,\n      this.glovesSlot,\n      this.gauntletsSlot,\n      this.beltSlot,\n      this.bootsSlot,\n    ].filter((slot: InventorySlot) => !slot.equipment).length\n  }\n\n  public cares(): GroupedItem<Item>[] {\n    return this.bag.bunch\n  }\n\n  public findInBag(item: Item): GroupedItem<Item> | undefined {\n    return this.bag.find(item)\n  }\n\n  public putToBag(item: Item, count: number): void {\n    this.bag.put(item, count)\n  }\n\n  public removeFromBag(item: Item, count: number): void {\n    this.bag.remove(item, count)\n  }\n}\n","import { Tile, Wall, TileVisitor } from './tile'\nimport { Creature, twoDimArray, ItemsBunch } from '../../engine'\nimport { Mapped } from '../utils/utils'\nimport { Item } from './items'\n\nexport class MemoryTile {\n  public visible: boolean = false\n  public degree: number = 0\n  public seen: boolean = false\n  public effect?: string\n\n  constructor(public tile: Tile) {}\n\n  get items(): ItemsBunch<Item> | undefined {\n    return this.tile.items\n  }\n\n  get creature(): Creature | undefined {\n    return this.tile.creature\n  }\n\n  public see(tile: Tile, degree: number) {\n    this.visible = true\n    this.degree = degree\n    this.seen = true\n    this.tile = tile.clone()\n  }\n\n  public tangible(actor?: Creature): boolean {\n    return this.seen && !this.tile.passibleThrough(actor)\n  }\n\n  public reset(): void {\n    this.visible = false\n    this.effect = undefined\n    this.tile.creature = undefined\n  }\n\n  public visit(tileVisitor: TileVisitor): void {\n    this.tile.visit(tileVisitor)\n  }\n}\n\nexport class Memory extends Mapped<MemoryTile> {\n  constructor(width: number, height: number) {\n    const baseTile = new Wall()\n    super(twoDimArray(width, height, () => new MemoryTile(baseTile)))\n  }\n\n  public resetVisible(): void {\n    this.each(tile => tile.reset())\n  }\n}\n","import { concat, cloneDeep } from 'lodash'\nimport { Game, GroupedItem, Inventory, LevelMap, PlayerAI } from '../../engine'\nimport { AfterEvent } from '../events/after_event'\nimport { CreatureEvent } from '../events/internal'\nimport { Level } from '../lib/level'\nimport { CapacityLimitStat, Stat, StrengthStat } from '../lib/stat'\nimport { Item, Missile, Protection, ProtectionType } from './items'\nimport { Damage } from '../lib/damage'\nimport { Profession } from './profession'\nimport { Specie, Resistance } from './specie'\nimport { Creature, Reaction } from './creature'\n\nexport class Player extends Creature {\n  public professions: Profession[] = []\n  public inventory: Inventory = new Inventory()\n\n  public itemsProtections: Protection[] = []\n  public itemsDamages: Damage[] = []\n  public itemsResistances: Resistance[] = []\n\n  public stuffWeight: Stat\n  public carryingCapacity: CapacityLimitStat\n\n  // Main attributes\n  public strength: StrengthStat\n  public dexterity: Stat\n  public constitution: Stat\n  public intelligence: Stat\n  public wisdom: Stat\n  public charisma: Stat\n\n  constructor(\n    public level: Level,\n    public ai: PlayerAI,\n    specie: Specie,\n    strengthValue: number,\n    constitutionValue: number\n  ) {\n    super(specie)\n\n    this.strength = new StrengthStat(strengthValue)\n    this.dexterity = new Stat(2)\n    this.constitution = new Stat(constitutionValue)\n    this.intelligence = new Stat(2)\n    this.wisdom = new Stat(2)\n    this.charisma = new Stat(2)\n\n    this.stuffWeight = new Stat(0)\n    this.carryingCapacity = new CapacityLimitStat(\n      this.strength.current,\n      this.constitution.current\n    )\n  }\n\n  public act(levelMap: LevelMap, game: Game): number {\n    this.statsTurn()\n    this.visionMask(levelMap)\n\n    const command = this.ai.act(this, levelMap, game)\n    if (command) {\n      this.on(command)\n    }\n    this.on(new AfterEvent(levelMap, game))\n\n    return this.speed\n  }\n\n  public rebuildVision(levelMap: LevelMap): void {\n    this.visionMask(levelMap)\n  }\n\n  public on(event: CreatureEvent): Reaction {\n    return event.affectPlayer(this)\n  }\n\n  get missile(): GroupedItem<Missile> | undefined {\n    return this.inventory.missileSlot.equipment\n  }\n\n  get inventoryItems(): GroupedItem<Item>[] {\n    return this.inventory.allItems\n  }\n\n  public addItem(item: Item, count: number): void {\n    this.inventory.putToBag(item, count)\n  }\n\n  public removeItem(item: Item, count: number): void {\n    this.inventory.removeFromBag(item, count)\n  }\n\n  get damages(): Damage[] {\n    const strengthAdjustment = this.strength.meleeAdjustment\n\n    return concat(this.specie.damages, this.itemsDamages).map(\n      (damage: Damage) => {\n        let dmg = cloneDeep(damage)\n        dmg.extra += strengthAdjustment\n        return dmg\n      }\n    )\n  }\n\n  get protections(): Protection[] {\n    const perEmptySlotArmor = 1\n    return concat(this.specie.protections, this.itemsProtections, [\n      {\n        type: ProtectionType.Unarmored,\n        value: perEmptySlotArmor * this.inventory.unarmoredSlotsCount,\n      },\n    ])\n  }\n\n  get resistances(): Resistance[] {\n    return concat(this.specie.resistances, this.itemsResistances)\n  }\n}\n","import { Player } from './player'\n\nimport { includes, sample } from 'lodash'\nimport { Talent } from './talent'\n\nexport class Profession {\n  public talents: Talent[] = []\n  public readonly depthCost: number = 3\n\n  constructor(\n    public readonly id: number,\n    public readonly name: string,\n    public level: number = 1,\n    public points: number = 0\n  ) {}\n}\n\nexport class ProfessionPicker {\n  constructor(\n    private pool: Profession[],\n    private maxLevel: number,\n    private maxTaken: number\n  ) {}\n\n  public available(player: Player): Profession[] {\n    let professions: Profession[] = []\n    let pickedProfession: Profession | undefined\n\n    if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(player)\n    } else if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(player)\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    if (this.canTakeNewProfession(player)) {\n      pickedProfession = this.newFromPool(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    } else if (this.canUpdate(player)) {\n      pickedProfession = this.updatableProfession(\n        player,\n        pickedProfession && pickedProfession.id\n      )\n    }\n\n    if (pickedProfession !== undefined) {\n      professions.push(pickedProfession)\n    }\n\n    return professions\n  }\n\n  protected canUpdate(player: Player): boolean {\n    return player.professions.some(\n      profession => profession.level < this.maxLevel\n    )\n  }\n\n  protected updatableProfession(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    return sample(\n      player.professions.filter(profession => {\n        return excludeId !== profession.id\n      })\n    )\n  }\n\n  protected canTakeNewProfession(player: Player): boolean {\n    return (\n      player.professions.length < this.maxTaken &&\n      this.pool.length > player.professions.length\n    )\n  }\n\n  protected newFromPool(\n    player: Player,\n    excludeId: number | undefined = undefined\n  ): Profession | undefined {\n    const excluding = player.professions.map(profession => profession.id)\n\n    if (excludeId !== undefined) {\n      excluding.push(excludeId)\n    }\n\n    return sample(\n      this.pool.filter(profession => !includes(excluding, profession.id))\n    )\n  }\n}\n","import { Trap, TrapType, Tile } from '../tile'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Creature } from '../creature'\nimport { TrapEvent } from '../../events/trap_event'\nimport { Point } from '../../utils/utils'\nimport { AddImpactEvent } from '../../events/add_impact_event'\nimport { ImpactType } from '../../lib/impact'\n\nexport class LightTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, TrapType.Light)\n  }\n\n  public untrap(pos: Point, levelMap: LevelMap, game: Game): void {\n    game.logger.canNotUntrap()\n  }\n\n  protected buildNew(): Tile {\n    return new LightTrap(this.revealed)\n  }\n\n  protected affect(game: Game, levelMap: LevelMap, creature: Creature): void {\n    creature.on(\n      new TrapEvent(\n        this,\n        this.revealed ? 0 : 10,\n        levelMap,\n        game,\n        (sees, isPlayer) => {\n          // TODO: Light trap messages\n          if (isPlayer) {\n            game.logger.playerDodgesTeleportationTrap()\n          } else if (sees) {\n            game.logger.creatureDodgesTeleportationTrap(creature)\n          }\n        },\n        (sees, isPlayer) => {\n          return creature.on(\n            new AddImpactEvent(ImpactType.Blind, 'trap', game, 10)\n          )\n        }\n      )\n    )\n  }\n}\n","import { Trap, Tile, TrapType } from '../tile'\nimport { Game } from '../game'\nimport { LevelMap } from '../level_map'\nimport { Creature } from '../creature'\n\nimport { TrapEvent, TeleportationEvent, Point } from '../../../engine'\n\nexport class TeleportationTrap extends Trap {\n  constructor(revealed: boolean = false) {\n    super(revealed, TrapType.Teleportation)\n  }\n\n  public untrap(pos: Point, levelMap: LevelMap, game: Game): void {\n    game.logger.canNotUntrap()\n  }\n\n  protected buildNew(): Tile {\n    return new TeleportationTrap(this.revealed)\n  }\n\n  protected affect(game: Game, levelMap: LevelMap, creature: Creature): void {\n    creature.on(\n      new TrapEvent(\n        this,\n        this.revealed ? 3 : 10,\n        levelMap,\n        game,\n        (sees, isPlayer) => {\n          if (isPlayer) {\n            game.logger.playerDodgesTeleportationTrap()\n          } else if (sees) {\n            game.logger.creatureDodgesTeleportationTrap(creature)\n          }\n        },\n        (sees, isPlayer) => {\n          return creature.on(new TeleportationEvent(levelMap, game, false))\n        }\n      )\n    )\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Item,\n  InventorySlot,\n  GroupedItem,\n  PutOnItemsPresenter,\n  PutOnItemEvent,\n  TakeOffItemEvent,\n  LevelMap,\n} from '../../engine'\nimport { IdlePresenter } from './idle_presenter'\n\nexport interface InventoryPresenterPosition {\n  inventorySlot: InventorySlot\n  item: Item | undefined\n  count: number | undefined\n  availableItems: GroupedItem<Item>[]\n}\n\nexport class InventoryPresenter extends Presenter {\n  public positions: InventoryPresenterPosition[] = []\n  private takeTime: boolean = false\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Inventory, levelMap, game)\n    this.rebuildPositions()\n  }\n\n  public takeOff(position: InventoryPresenterPosition) {\n    this.player.on(new TakeOffItemEvent(position.inventorySlot, this.game))\n    this.takeTime = true\n    this.rebuildPositions()\n  }\n\n  public putOn(position: InventoryPresenterPosition) {\n    this.redirect(\n      new PutOnItemsPresenter(\n        itemGroup => {\n          this.player.on(\n            new PutOnItemEvent(\n              position.inventorySlot,\n              itemGroup.item,\n              this.game\n            )\n          )\n\n          this.takeTime = true\n          this.rebuildPositions()\n          this.redirect(this)\n        },\n        position.availableItems,\n        this.levelMap,\n        this.game\n      )\n    )\n  }\n\n  public close() {\n    if (this.takeTime) {\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.levelMap, this.game))\n    }\n  }\n\n  private rebuildPositions(): void {\n    this.positions = this.player.inventory.slots().map(inventorySlot => {\n      return {\n        inventorySlot: inventorySlot,\n        item: inventorySlot.equipment && inventorySlot.equipment.item,\n        count: inventorySlot.equipment && inventorySlot.equipment.count,\n        availableItems: inventorySlot.matchingItems(this.player.inventory),\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Point, bresenhamInclusion, Direction } from '../utils/utils'\nimport { Memory } from '../models/memory'\nimport { IdlePresenter } from './idle_presenter'\nimport { MissileAttackEvent, Game, LevelMap } from '../../engine'\n\nexport class MissilePresenter extends Presenter {\n  public targetPos: Point\n  private memory: Memory\n  private targetEnemyIndex: number | undefined = undefined\n  private enemies: Point[] = []\n  private path: Point[] = []\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Missile, levelMap, game)\n\n    this.findEnemies()\n    this.memory = this.player.stageMemory(this.levelMap)\n    this.targetPos = this.resetTargetId()\n  }\n\n  public nextTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex += 1\n\n    if (this.targetEnemyIndex >= this.enemies.length) {\n      this.targetEnemyIndex = 0\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public previousTarget(): void {\n    if (this.targetEnemyIndex === undefined) {\n      this.resetTargetId()\n      return\n    }\n\n    this.targetEnemyIndex -= 1\n\n    if (this.targetEnemyIndex < 0) {\n      this.targetEnemyIndex = this.enemies.length - 1\n    }\n\n    this.updateTarget(this.enemies[this.targetEnemyIndex])\n  }\n\n  public moveTarget(direction: Direction): void {\n    const dest = this.targetPos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (\n      tile.visibleThrough() &&\n      this.player.stageMemory(this.levelMap).at(dest.x, dest.y).visible\n    ) {\n      this.updateTarget(dest)\n      this.targetEnemyIndex = undefined\n    }\n  }\n\n  public attack(): void {\n    if (!this.targetPos.eq(this.levelMap.creaturePos(this.player))) {\n      this.player.on(\n        new MissileAttackEvent(this.path, this.game, this.levelMap, () =>\n          this.endTurn()\n        )\n      )\n    }\n  }\n\n  public close(): void {\n    this.resetPath()\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n\n  private resetTargetId(): Point {\n    let point: Point\n\n    if (this.enemies.length) {\n      this.targetEnemyIndex = 0\n      point = this.enemies[this.targetEnemyIndex]\n    } else {\n      this.targetEnemyIndex = undefined\n      point = this.levelMap.creaturePos(this.player)\n    }\n\n    this.updateTarget(point)\n    return point\n  }\n\n  private resetPath(): void {\n    this.path.forEach(({ x, y }) => (this.memory.at(x, y).effect = undefined))\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.resetPath()\n    this.targetPos = newPos.copy()\n    this.drawPath()\n  }\n\n  private drawPath(): void {\n    this.path = []\n    let stop = false\n    const stage = this.levelMap,\n      pos = this.levelMap.creaturePos(this.player)\n\n    bresenhamInclusion(pos, this.targetPos, (x, y) => {\n      if (!stage.at(x, y).passibleThrough()) {\n        stop = true\n      }\n\n      this.path.push(new Point(x, y))\n      this.memory.at(x, y).effect = stop ? 'o' : 'x'\n    })\n  }\n\n  private findEnemies(): void {\n    this.enemies = []\n\n    this.player.stageMemory(this.levelMap).each((tile, x, y) => {\n      if (\n        tile.visible &&\n        tile.creature &&\n        tile.creature.id !== this.player.id\n      ) {\n        this.enemies.push(new Point(x, y))\n      }\n    })\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\n\nexport class PickSingleOptionPresenter<Option> extends Presenter {\n  constructor(\n    public options: Option[],\n    levelMap: LevelMap,\n    game: Game,\n    private withOption: (option: Option) => void\n  ) {\n    super(PresenterType.PickHandleOption, levelMap, game)\n  }\n\n  public pick(option: Option): void {\n    this.withOption(option)\n  }\n\n  public close(): void {\n    this.goIdle()\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport {\n  Game,\n  Direction,\n  DropItemsPresenter,\n  DrinkPresenter,\n  BagPresenter,\n  AttackEvent,\n  PickUpItemsEvent,\n  PickUpPresenter,\n  TileVisitor,\n  Player,\n  Stairway,\n  LevelMap,\n  LookPresenter,\n  UntrapEvent,\n  Point,\n} from '../../engine'\nimport { InventoryPresenter } from './inventory_presenter'\nimport { MissilePresenter } from './missile_presenter'\nimport { MoveEvent } from '../events/move_event'\nimport { CreatureEvent } from '../events/internal'\nimport { concat } from 'lodash'\nimport { Trap } from '../models/tile'\nimport { PickSingleOptionPresenter } from './pick_single_option_presenter'\nimport { StayEvent } from '../events/stay_event'\n\nclass HandleTileVisitor extends TileVisitor {\n  // TODO: Add direction since commands might duplicate\n  public commands: [string, CreatureEvent][] = []\n\n  constructor(\n    public position: Point,\n    private game: Game,\n    private levelMap: LevelMap,\n    private player: Player\n  ) {\n    super()\n  }\n\n  protected onStairway(stairway: Stairway): void {\n    // TODO: Do not do this if already connected\n    // TODO: Remove duplicity!!! descender.ts\n    const adjacentMap = this.game.getMap(stairway.adjacentMapId)\n    stairway.enterPos = adjacentMap.matchStairs(\n      this.levelMap.id,\n      this.levelMap.creaturePos(this.player)\n    )\n\n    this.commands.push([\n      'stairway',\n      new MoveEvent(this.game, this.levelMap, stairway.enterPos, adjacentMap),\n    ])\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      return\n    }\n\n    this.commands.push([\n      'untrap',\n      new UntrapEvent(this.position, trap, this.levelMap, this.game),\n    ])\n  }\n}\n\nclass AdjustHandleTileVisitor extends HandleTileVisitor {\n  protected onStairway(): void {}\n}\n\nexport class IdlePresenter extends Presenter {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.Idle, levelMap, game)\n  }\n\n  public inventoryCommand(): void {\n    this.redirect(new InventoryPresenter(this.levelMap, this.game))\n  }\n\n  public bagCommand(): void {\n    this.redirect(new BagPresenter(this.levelMap, this.game))\n  }\n\n  public stayCommand(): void {\n    this.player.on(new StayEvent(this.levelMap))\n    this.endTurn()\n  }\n\n  public dropCommand(): void {\n    this.redirect(new DropItemsPresenter(this.levelMap, this.game))\n  }\n\n  public drinkCommand(): void {\n    this.redirect(new DrinkPresenter(this.levelMap, this.game))\n  }\n\n  public lookCommand(): void {\n    this.redirect(new LookPresenter(this.levelMap, this.game))\n  }\n\n  public move(direction: Direction): void {\n    const pos = this.levelMap.creaturePos(this.player),\n      dest = pos.add(direction),\n      tile = this.levelMap.at(dest.x, dest.y)\n\n    if (tile.passibleThrough(this.player)) {\n      this.player.on(new MoveEvent(this.game, this.levelMap, dest))\n    } else if (tile.creature) {\n      this.player.on(new AttackEvent(tile.creature, this.levelMap, this.game))\n    } else {\n      this.game.logger.ranIntoAnObstacle()\n      this.player\n        .stageMemory(this.levelMap)\n        .at(dest.x, dest.y)\n        .see(tile, 0)\n    }\n\n    this.endTurn()\n  }\n\n  public pickUpCommand(): void {\n    const tile = this.tile,\n      items = tile.items\n\n    if (items === undefined || items.bunch.length === 0) {\n      this.game.logger.noItemsToPickUp()\n    } else if (items.bunch.length === 1) {\n      this.player.on(new PickUpItemsEvent(tile, items.bunch, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new PickUpPresenter(this.levelMap, this.game))\n    }\n  }\n\n  public missileCommand(): void {\n    const missile = this.player.inventory.missileSlot.equipment\n\n    if (missile && missile.item) {\n      if (missile.item.canThrow(this.player)) {\n        this.redirect(new MissilePresenter(this.levelMap, this.game))\n      } else {\n        this.game.logger.needMissileWeapon()\n      }\n    } else {\n      this.game.logger.nothingToShotWith()\n    }\n  }\n\n  public handleCommand(): void {\n    let pos = this.levelMap.creaturePos(this.player),\n      visitor = new HandleTileVisitor(\n        pos,\n        this.game,\n        this.levelMap,\n        this.player\n      ),\n      adjustVisitor = new AdjustHandleTileVisitor(\n        pos,\n        this.game,\n        this.levelMap,\n        this.player\n      )\n\n    this.tile.visit(visitor)\n\n    pos.wrappers().forEach((point: Point) => {\n      adjustVisitor.position = point\n      this.levelMap.at(point.x, point.y).visit(adjustVisitor)\n    })\n\n    const commands = concat(visitor.commands, adjustVisitor.commands)\n\n    switch (commands.length) {\n      case 0:\n        this.game.logger.howToHandle()\n        break\n      case 1:\n        this.player.on(commands[0][1])\n        this.endTurn()\n        break\n      default:\n        this.redirect(\n          new PickSingleOptionPresenter(\n            commands,\n            this.levelMap,\n            this.game,\n            ([name, command]) => {\n              this.player.on(command)\n              this.endTurn()\n            }\n          )\n        )\n    }\n  }\n}\n","import { DropItemsEvent, Game, GroupedItem, Item, LevelMap } from '../../engine'\nimport { Potion } from '../models/items'\nimport { IdlePresenter } from './idle_presenter'\nimport { Presenter, PresenterType } from './internal'\nimport { InventoryPresenter } from './inventory_presenter'\n\nexport interface ItemsListingPosition {\n  item: Item\n  count: number\n}\n\nexport abstract class ItemsListingPresenter extends Presenter {\n  // TODO: Pass to constructor\n  public positions: ItemsListingPosition[] = []\n  public title: string = 'unnamed'\n\n  constructor(levelMap: LevelMap, game: Game) {\n    super(PresenterType.ItemsListing, levelMap, game)\n    this.initPositions()\n  }\n\n  protected abstract initPositions(): void\n\n  public close(): void {\n    this.redirect(new IdlePresenter(this.levelMap, this.game))\n  }\n}\n\nexport class DropItemsPresenter extends ItemsListingPresenter {\n  public title: string = 'Что положить?'\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: GroupedItem<Item>[]): void {\n    if (items.length) {\n      this.player.on(new DropItemsEvent(this.tile, items, this.game))\n      this.endTurn()\n    } else {\n      this.redirect(new IdlePresenter(this.levelMap, this.game))\n    }\n  }\n}\n\nexport class PutOnItemsPresenter extends ItemsListingPresenter {\n  public title: string = 'Что надеть?'\n  public singleItemMode: boolean = true\n\n  constructor(\n    private onWithItem: (itemGroup: ItemsListingPosition) => void,\n    public positions: ItemsListingPosition[],\n    levelMap: LevelMap,\n    game: Game\n  ) {\n    super(levelMap, game)\n  }\n\n  protected initPositions(): void {}\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Validate items are part of positions\n    // new AIDropItems(items, this.game).act()\n  }\n\n  public withItem(itemGroup: ItemsListingPosition): void {\n    this.onWithItem(itemGroup)\n  }\n\n  public close(): void {\n    this.redirect(new InventoryPresenter(this.levelMap, this.game))\n  }\n}\n\nexport class BagPresenter extends ItemsListingPresenter {\n  public title: string = 'Сумка'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory.cares()\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.endTurn()\n  }\n}\n","import {\n  ItemsListingPresenter,\n  ItemsListingPosition,\n} from './items_listing_presenter'\nimport { ItemGroup, Potion } from '../models/items'\nimport { DrinkPotionEvent } from '../../engine'\n\nexport class DrinkPresenter extends ItemsListingPresenter {\n  public title: string = 'Что выпить?'\n  public singleItemMode: boolean = true\n\n  protected initPositions(): void {\n    this.positions = this.player.inventory\n      .cares()\n      .filter(itemGroup => itemGroup.item.group === ItemGroup.Potion)\n  }\n\n  public pickUpItems(items: ItemsListingPosition[]): void {\n    // TODO: Remove this method or ensure it's not being called\n  }\n\n  public withItem(itemGroup: { item: Potion }): void {\n    this.player.on(new DrinkPotionEvent(itemGroup.item, this.game))\n    this.endTurn()\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Memory, MemoryTile } from '../models/memory'\nimport { Point, Direction } from '../utils/utils'\nimport { Game } from '../models/game'\nimport { LevelMap } from '../models/level_map'\n\nexport abstract class PickPointPresenter<Title, Body> extends Presenter {\n  public targetPos: Point\n  protected memory: Memory\n\n  constructor(\n    type: PresenterType,\n    levelMap: LevelMap,\n    game: Game,\n    private effect: string,\n    private match: (point: Point) => boolean\n  ) {\n    super(type, levelMap, game)\n\n    this.memory = this.player.stageMemory(this.levelMap)\n    this.targetPos = levelMap.creaturePos(this.player)\n  }\n\n  abstract get title(): Title\n\n  abstract get body(): Body[]\n\n  protected abstract close(): void\n\n  public act(): void {\n    this.removeEffect()\n    this.close()\n  }\n\n  get memoryTile(): MemoryTile {\n    return this.memory.at(this.targetPos.x, this.targetPos.y)\n  }\n\n  public moveTarget(direction: Direction): void {\n    const dest = this.targetPos.add(direction)\n\n    if (this.match(dest)) {\n      this.updateTarget(dest)\n    }\n  }\n\n  private removeEffect(): void {\n    this.memory.at(this.targetPos.x, this.targetPos.y).effect = undefined\n  }\n\n  private updateTarget(newPos: Point): void {\n    this.removeEffect()\n    this.targetPos = newPos.copy()\n    this.drawTarget()\n  }\n\n  private drawTarget(): void {\n    this.memoryTile.effect = this.effect\n  }\n}\n","import { Presenter, PresenterType } from './internal'\nimport { Game, LevelMap, Talent, TalentStatus } from '../../engine'\nimport { Profession } from '../models/profession'\nimport { LevelUpEvent } from '../events/level_up_event'\n\ninterface TalentWithStatus extends Talent {\n  status: TalentStatus\n}\n\ninterface TalentsTreePresenterProfession {\n  profession: Profession\n  talents: TalentWithStatus[]\n}\n\nexport class TalentsTreePresenter extends Presenter {\n  public readonly options: TalentsTreePresenterProfession[] = []\n\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(PresenterType.AbilitiesPicking, levelMap, game)\n\n    this.options = this.player.professions.map(profession => {\n      return {\n        profession,\n        talents: profession.talents.map(talent => {\n          return Object.assign({}, talent, {\n            status: this.status(talent, profession),\n          })\n        }),\n      }\n    })\n  }\n\n  get title(): string {\n    return 'Pick new talent'\n  }\n\n  public pickTalent(professionId: number, talentId: number): void {\n    const profession: Profession | undefined = this.player.professions.find(\n      profession => profession.id === professionId\n    )\n\n    if (profession === undefined) {\n      throw `Profession with id ${professionId} is not found`\n    }\n\n    let talent: Talent | undefined = profession.talents.find(\n      talent => talent.id === talentId\n    )\n\n    if (talent === undefined) {\n      throw `Talent with id ${talentId} for profession ${\n        profession.name\n      } is not found`\n    }\n\n    if (this.status(talent, profession) !== TalentStatus.Available) {\n      throw `Talent with id ${talentId} for profession ${\n        profession.name\n      } can not be upgraded`\n    }\n\n    talent.rank += 1\n    if (talent.rank === 1) {\n      talent.onObtain(this.game)\n    }\n\n    profession.points += 1\n\n    this.player.on(new LevelUpEvent())\n\n    this.endTurn()\n  }\n\n  private status(talent: Talent, profession: Profession): TalentStatus {\n    if (talent.rank === talent.maxRank) {\n      return TalentStatus.Completed\n    } else if (talent.depth * profession.depthCost > profession.points) {\n      return TalentStatus.Unavailable\n    } else {\n      return TalentStatus.Available\n    }\n  }\n}\n","import { PresenterType } from './internal'\nimport { LevelMap } from '../models/level_map'\nimport { Game } from '../models/game'\nimport { PickPointPresenter } from './pick_point_presenter'\nimport { MoveEvent } from '../events/move_event'\n\nexport class TeleportationPresenter extends PickPointPresenter<\n  string,\n  undefined\n> {\n  constructor(levelMap: LevelMap, game: Game) {\n    super(\n      PresenterType.Teleportation,\n      levelMap,\n      game,\n      'x',\n      ({ x, y }) =>\n        levelMap.at(x, y).passibleThrough(this.player) &&\n        this.memory.at(x, y).seen\n    )\n  }\n\n  get title(): string {\n    return 'Выберите зону телепортации'\n  }\n\n  get body(): undefined[] {\n    return []\n  }\n\n  protected close(): void {\n    if (this.targetPos.eq(this.levelMap.creaturePos(this.player))) {\n      this.game.logger.playerTeleportedWhereTheyWere()\n    } else {\n      this.player.on(new MoveEvent(this.game, this.levelMap, this.targetPos))\n    }\n\n    this.endTurn()\n  }\n}\n","import { ItemsListingPresenter, Item, PickUpItemsEvent } from '../../engine'\nimport { GroupedItem } from '../lib/bunch'\n\nexport class PickUpPresenter extends ItemsListingPresenter {\n  public title: string = 'Что поднять?'\n\n  protected initPositions(): void {\n    const items = this.tile.items\n\n    if (items === undefined) {\n      throw `Failed to show pick up dialog - tile has no items`\n    }\n\n    this.positions = items.bunch.map(itemGroup => {\n      return { item: itemGroup.item, count: itemGroup.count }\n    })\n  }\n\n  public pickUpItems(items: GroupedItem<Item>[]): void {\n    // TODO: Validate items are part of positions\n    this.player.on(new PickUpItemsEvent(this.tile, items, this.game))\n    this.endTurn()\n  }\n}\n","import { PresenterType, Presenter } from './internal'\nimport { Profession } from '../models/profession'\nimport { TalentsTreePresenter } from './talents_tree_presenter'\nimport { Game, LevelMap } from '../../engine'\n\nexport class ProfessionPickingPresenter extends Presenter {\n  constructor(public readonly level: number, levelMap: LevelMap, game: Game) {\n    super(PresenterType.ProfessionPicking, levelMap, game)\n  }\n\n  get title(): string {\n    return `Gained ${this.level} level`\n  }\n\n  get options(): Profession[] {\n    return this.game.professionPicker.available(this.player)\n  }\n\n  public pickProfession(pickedProfession: Profession) {\n    let playerProfession = this.player.professions.find(\n      profession => profession.id === pickedProfession.id\n    )\n\n    if (playerProfession) {\n      playerProfession.level += 1\n    } else {\n      this.player.professions.push(pickedProfession)\n    }\n\n    this.redirect(\n      new TalentsTreePresenter(this.level, this.levelMap, this.game)\n    )\n  }\n}\n","import { Point, twoDimArray, Mapped } from './utils'\n\nimport { sample } from 'lodash'\n\nconst FIRST_STEP: number = 1\n\nexport const leePath = function<Tile>(\n  map: Mapped<Tile>,\n  pos: Point,\n  tangible: (tile: Tile) => boolean,\n  destination: (point: Point, tile: Tile) => boolean,\n  randomDestination: boolean = false\n): Point[] {\n  let stageMemory: number[][] = twoDimArray(map.width, map.height, () => -1)\n  let pointsToVisit: Point[] = []\n  let pointsToCheck: Point[] = [pos]\n\n  let step = 0\n  while (pointsToCheck.length && !pointsToVisit.length) {\n    let wavePoints: Point[] = []\n\n    pointsToCheck.forEach((point: Point) => {\n      if (!map.inRange(point)) {\n        return\n      }\n\n      const tile = map.at(point.x, point.y)\n      // TODO: Compare, current value might be lower\n      if (tangible(tile) || stageMemory[point.x][point.y] !== -1) {\n        return\n      }\n\n      stageMemory[point.x][point.y] = step\n      if (destination(point, tile)) {\n        pointsToVisit.push(point)\n      } else {\n        point.wrappers().forEach(dist => wavePoints.push(dist))\n      }\n    })\n    step++\n\n    pointsToCheck = wavePoints\n  }\n\n  if (pointsToVisit.length) {\n    // TODO: Remove this check\n    let randomPointToVisit = sample(pointsToVisit)\n    if (randomDestination && randomPointToVisit) {\n      return buildRoad(randomPointToVisit, stageMemory)\n    } else {\n      return buildRoad(pointsToVisit[0], stageMemory)\n    }\n  } else {\n    return []\n  }\n}\n\nconst buildRoad = function(point: Point, stageMemory: number[][]): Point[] {\n  let lastPoint = point\n  let chain = [lastPoint]\n\n  let delta: Point | undefined\n\n  while (stageMemory[lastPoint.x][lastPoint.y] !== FIRST_STEP) {\n    delta = Point.dxy.find(\n      (dp): boolean => {\n        return (\n          stageMemory[lastPoint.x + dp.x] &&\n          stageMemory[lastPoint.x + dp.x][lastPoint.y + dp.y] ===\n            stageMemory[lastPoint.x][lastPoint.y] - 1\n        )\n      }\n    )\n\n    if (delta === undefined) {\n      return []\n    }\n\n    lastPoint = lastPoint.add(delta)\n\n    chain.unshift(lastPoint)\n  }\n\n  return chain\n}\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Logger.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { takeRight } from 'lodash'\n\nimport { LogLevel, LogMessage, Logger } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Logger',\n  props: {\n    logger: {\n      type: Logger,\n      required: true\n    }\n  },\n  data() {\n    return {\n      lastId: 0,\n    }\n  },\n  computed: {\n    messages() {\n      const currentMessagesCount: number = this.logger.messages.length,\n        messages = takeRight(this.logger.messages, Math.max(currentMessagesCount - this.lastId, 5))\n      this.lastId = currentMessagesCount\n      return messages\n    }\n  },\n  methods: {\n    counter(value: number) {\n      if (value > 1) {\n        return `x${value}`\n      }\n    },\n    rowClass(record: LogMessage) {\n      switch (record.level) {\n        case LogLevel.DEBUG:\n          return 'debug'\n        case LogLevel.INFO:\n          return 'info'\n        case LogLevel.WARNING:\n          return 'warning'\n        case LogLevel.DANGER:\n          return 'danger'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Logger.vue?vue&type=template&id=4926948c&scoped=true&lang=pug&\"\nimport script from \"./Logger.vue?vue&type=script&lang=ts&\"\nexport * from \"./Logger.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Logger.vue?vue&type=style&index=0&id=4926948c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4926948c\",\n  null\n  \n)\n\ncomponent.options.__file = \"Logger.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"logger\"},_vm._l((_vm.messages),function(record,i){return _c('div',{key:i,class:_vm.rowClass(record)},[_vm._v(_vm._s(record.message)+\"\\n\"+_vm._s(_vm.counter(record.counter)))])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/// This file contains the main tile engine namespace.\n/// All coordinates are assumed to be integers - behaviour is undefined\n/// if you feed in floats (or anything other) as x and y (or similar) parameters.\n\n/// Class: Tile\n/// Represents a unicode character tile with various attributes.\nexport class Tile {\n  /// Constructor: Tile\n  /// Constructs a new Tile object.\n  ///\n  /// Parameters:\n  ///   ch - a character to display for this tile\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  constructor(\n    public ch: string,\n    public r?: number,\n    public g?: number,\n    public b?: number,\n    public br?: number,\n    public bg?: number,\n    public bb?: number,\n  ) {}\n\n  /// Function: getChar\n  /// Returns the character of this tile.\n  public getChar() { return this.ch }\n\n  /// Function: setChar\n  /// Sets the character of this tile.\n  public setChar(ch: string) { this.ch = ch }\n\n  /// Function: setColor\n  /// Sets the foreground color of this tile.\n  public setColor(r: number, g: number, b: number) {\n    this.r = r\n    this.g = g\n    this.b = b\n  }\n\n  /// Function: setGrey\n  /// Sets the foreground color to the given shade (0-255) of grey.\n  public setGrey(grey: number) {\n    this.r = grey\n    this.g = grey\n    this.b = grey\n  }\n\n  /// Function: setBackground\n  /// Sets the background color of this tile.\n  public setBackground(r: number, g: number, b: number) {\n    this.br = r\n    this.bg = g\n    this.bb = b\n  }\n\n  public backgroundToColor() {\n    this.r = this.br\n    this.g = this.bg\n    this.b = this.bb\n  }\n\n  public swapColors() {\n    this.r = [this.br, this.br = this.r][0]\n    this.g = [this.bg, this.bg = this.g][0]\n    this.b = [this.bb, this.bb = this.b][0]\n  }\n\n  /// Function: resetColor\n  /// Clears the color of this tile / assigns default color.\n  public resetColor() { this.r = this.g = this.b = undefined }\n\n  /// Function: resetBackground\n  /// Clears the background color of this tile.\n  public resetBackground() { this.br = this.bg = this.bb = undefined }\n\n  /// Function: getColorHex\n  /// Returns the hexadecimal representation of the color\n  public getColorHex() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return '#' + this.r.toString(16) + this.g.toString(16) + this.b.toString(16)\n    else return ''\n  }\n\n  /// Function: getBackgroundHex\n  /// Returns the hexadecimal representation of the background color\n  public getBackgroundHex() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return '#' + this.br.toString(16) + this.bg.toString(16) + this.bb.toString(16)\n    else return ''\n  }\n\n  /// Function: getColorRGB\n  /// Returns the CSS rgb(r,g,b) representation of the color\n  public getColorRGB() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return `rgb(${this.r},${this.g},${this.b})`\n    else return ''\n  }\n\n  /// Function: getBackgroundRGB\n  /// Returns the CSS rgb(r,g,b) representation of the background color\n  public getBackgroundRGB() {\n    if (this.br !== undefined && this.bg !== undefined && this.bb !== undefined)\n      return `rgb(${this.br},${this.bg},${this.bb})`\n    else return ''\n  }\n\n  /// Function: getColorJSON\n  /// Returns the JSON representation of the color, i.e. object { r, g, b }\n  public getColorJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.r, 'g': this.g, 'b': this.b }\n    else return {}\n  }\n\n  /// Function: getBackgroundJSON\n  /// Returns the JSON representation of the background color, i.e. object { r, g, b }\n  public getBackgroundJSON() {\n    if (this.r !== undefined && this.g !== undefined && this.b !== undefined)\n      return { 'r': this.br, 'g': this.bg, 'b': this.bb }\n    else return {}\n  }\n\n  /// Function: copy\n  /// Makes this tile identical to the one supplied. Custom properties are not copied.\n  public copy(other: Tile) {\n    this.ch = other.ch\n    this.r = other.r\n    this.g = other.g\n    this.b = other.b\n    this.br = other.br\n    this.bg = other.bg\n    this.bb = other.bb\n  }\n\n  /// Function: clone\n  /// Returns a new copy of this tile. Custom properties are not cloned.\n  public clone() {\n    return new Tile(this.ch, this.r, this.g, this.b, this.br, this.bg, this.bb)\n  }\n}\n\n/// Constants: Semi-internal constants for ut namespace\n/// VERSION  - Version of the library as string.\n/// NULLCHAR - Character used when none is specified otherwise.\n/// CSSCLASS - The CSS class name used for the tile engine element.\n/// NULLTILE - The tile used as placeholder for empty tile.\nexport const VERSION = '2.1'\nexport const NULLCHAR = ' '\nexport const CSSCLASS = 'unicodetiles'\nexport const NULLTILE = new Tile(NULLCHAR)\n\nexport interface Renderer {\n  updateStyle(s?: any): void\n\n    // if (this.renderer instanceof ut.WebGLRenderer) return ''\n    // if (this.renderer instanceof ut.CanvasRenderer) return 'canvas'\n    // if (this.renderer instanceof ut.DOMRenderer) return 'dom'\n  getRendererString(): string\n\n  clear(): void\n  render(): void\n}\n\n/// Class: Viewport\n/// The tile engine viewport / window. Takes care of initializing a proper renderer.\n\n/// Constructor: Viewport\n/// Constructs a new Viewport object.\n/// If you wish to display a player character at the center, you should use odd sizes.\n///\n/// Parameters:\n///   elem - the DOM element which shall be transformed into the tile engine\n///   w - (integer) width in tiles\n///   h - (integer) height in tiles\n///   renderer - (optional) choose rendering engine, see <Viewport.setRenderer>, defaults to 'auto'.\n///   squarify - (optional) set to true to force the tiles square; may break some box drawing\nexport class Viewport {\n  public cx: number\n  public cy: number\n\n  public buffer: Tile[][]\n  public renderer: Renderer\n\n  public defaultColor?: string\n  public defaultBackground?: string\n\n  constructor(\n    public elem: HTMLElement,\n    public w: number,\n    public h: number,\n    renderer: (viewport: Viewport) => Renderer,\n    public squarify: boolean = false,\n    ) {\n    this.cx = Math.floor(w / 2)\n    this.cy = Math.floor(h / 2)\n\n    this.elem.innerHTML = ''\n\n    // Add CSS class if not added already\n    if (elem.className.indexOf(CSSCLASS) === -1) {\n      if (elem.className.length === 0) {\n        elem.className = CSSCLASS\n      }\n      else elem.className += ' ' + CSSCLASS\n    }\n\n    // Create two 2-dimensional array to hold the viewport tiles\n    this.buffer = new Array(h)\n    for (let j = 0; j < h; ++j) {\n      this.buffer[j] = new Array(w)\n      for (let i = 0; i < w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n\n    this.renderer = renderer(this)\n  }\n\n  /// Function: updateStyle\n  /// If the style of the parent element is modified, this needs to be called.\n  private updateStyle(updateRenderer: boolean) {\n    const s = window.getComputedStyle(this.elem, null)\n\n    this.defaultColor = s.color || undefined // OMG\n    this.defaultBackground = s.backgroundColor || undefined\n    if (updateRenderer) {\n      this.renderer.updateStyle(s)\n    }\n  };\n\n  /// Function: getRendererString\n  /// Gets the currently used renderer.\n  ///\n  /// Returns:\n  ///   One of 'webgl', 'canvas', 'dom', ''.\n  public getRendererString(): string {\n    return this.renderer.getRendererString()\n  }\n\n  /// Function: put\n  /// Puts a tile to the given coordinates.\n  /// Checks bounds and does nothing if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public put(tile: Tile, x: number, y: number): void {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: unsafePut\n  /// Puts a tile to the given coordinates.\n  /// Does *not* check bounds throws exception if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   tile - the tile to put\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  public unsafePut(tile: Tile, x: number, y: number) {\n    this.buffer[y][x] = tile\n  }\n\n  /// Function: putString\n  /// Creates a row of tiles with the chars of the given string.\n  /// Wraps to next line if it can't fit the chars on one line.\n  ///\n  /// Parameters:\n  ///   str - (string) the string to put\n  ///   x - (integer) x coordinate (column)\n  ///   y - (integer) y coordinate (row)\n  ///   r - (optional) red foregorund color component 0-255\n  ///   g - (optional) green foreground color component 0-255\n  ///   b - (optional) blue foreground color component 0-255\n  ///   br - (optional) red background color component 0-255\n  ///   bg - (optional) green background color component 0-255\n  ///   bb - (optional) blue background color component 0-255\n  public putString(\n    str: string,\n    x: number,\n    y: number,\n    r?: number,\n    g?: number,\n    b?: number,\n    br?: number,\n    bg?: number,\n    bb?: number,\n  ) {\n    const len = str.length\n    if (x < 0 || y < 0) return\n\n    for (let i = 0; i < len; ++i) {\n      if (x >= this.w) {\n        x = 0\n        ++y\n      }\n      if (y >= this.h) return\n\n      const tile = new Tile(str[i], r, g, b, br, bg, bb)\n      this.unsafePut(tile, x, y)\n      ++x\n    }\n  }\n\n  /// Function: get\n  /// Returns the tile in the given coordinates.\n  /// Checks bounds and returns empty tile if invalid coordinates are given.\n  ///\n  /// Parameters:\n  ///   x - (integer) x coordinate\n  ///   y - (integer) y coordinate\n  ///\n  /// Returns:\n  ///   The tile.\n  public get(x: number, y: number): Tile {\n    if (x < 0 || y < 0 || x >= this.w || y >= this.h) return NULLTILE\n    return this.buffer[y][x]\n  }\n\n  /// Function: clear\n  /// Clears the viewport buffer by assigning empty tiles.\n  public clear() {\n    for (let j = 0; j < this.h; ++j) {\n      for (let i = 0; i < this.w; ++i) {\n        this.buffer[j][i] = NULLTILE\n      }\n    }\n    this.renderer.clear()\n  }\n\n  /// Function: render\n  /// Renders the buffer as html to the element specified at construction.\n  public render() {\n    this.renderer.render()\n  }\n}\n\n/// Class: Engine\n/// The tile engine itself.\nexport class Engine {\n  private refreshCache: boolean = true\n  private cacheEnabled: boolean = false\n  private transitionTimer?: number\n\n  private transitionDuration: number = 0\n  private transition?: (x: number, y: number, w: number, h: number, new_t: Tile, old_t: Tile, factor: number) => Tile\n  private maskFunc?: (x: number, y: number) => boolean\n  private shaderFunc?: (tile: Tile, x: number, y: number, timeNow: number) => Tile\n  private cachex: number = 0\n  private cachey: number = 0\n\n  private tileCache: Tile[][]\n  private tileCache2: Tile[][]\n\n  /// Constructor: Engine\n  /// Constructs a new Engine object. If width or height is given,\n  /// it will not attempt to fetch tiles outside the boundaries.\n  /// In that case 0,0 is assumed as the upper-left corner of the world,\n  /// but if no width/height is given also negative coords are valid.\n  ///\n  /// Parameters:\n  ///   vp - the <Viewport> instance to use as the viewport\n  ///   func - the function used for fetching tiles\n  ///   w - (integer) (optional) world width in tiles\n  ///   h - (integer) (optional) world height in tiles\n  constructor(\n    public viewport: Viewport,\n    public tileFunc: (x: number, y: number) => Tile,\n    public w: number,\n    public h: number,\n  ) {\n\n    this.tileCache = new Array(viewport.h)\n    this.tileCache2 = new Array(viewport.h)\n\n    for (let j = 0; j < viewport.h; ++j) {\n      this.tileCache[j] = new Array(viewport.w)\n      this.tileCache2[j] = new Array(viewport.w)\n    }\n  }\n\n  /// Function: setTileFunc\n  /// Sets the function to be called with coordinates to fetch each tile.\n  /// Optionally can apply a transition effect. Effects are:\n  /// 'boxin', 'boxout', 'circlein', 'circleout', 'random'\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning an ut.Tile\n  ///   effect - (string) (optional) name of effect to use (see above for legal values)\n  ///   duration - (integer) (optional) how many milliseconds the transition effect should last\n  public setTileFunc(func: (x: number, y: number) => Tile, effect?: string, duration?: number) {\n    if (effect) {\n      this.transition = undefined\n      if (typeof effect === 'string') {\n        if (effect === 'boxin') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'boxout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (Math.abs(x) < halfw * factor && Math.abs(y) < halfh * factor) return old_t\n          else return new_t\n        }\n        else if (effect === 'circlein') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          if (x * x + y * y < (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'circleout') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          const halfw = w * 0.5, halfh = h * 0.5\n          x -= halfw\n          y -= halfh\n          factor = 1.0 - factor\n          if (x * x + y * y > (halfw * halfw + halfh * halfh) * factor) return new_t\n          else return old_t\n        }\n        else if (effect === 'random') this.transition = function(x, y, w, h, new_t, old_t, factor) {\n          if (Math.random() > factor) return old_t\n          else return new_t\n        }\n      }\n      if (this.transition) {\n        this.transitionTimer = (new Date()).getTime()\n        this.transitionDuration = duration || 500\n      }\n    }\n    this.tileFunc = func\n  }\n\n  /// Function: setMaskFunc\n  /// Sets the function to be called to fetch mask information according to coordinates.\n  /// If mask function returns false to some coordinates, then that tile is not rendered.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (x, y) and returning a true if the tile is visible\n  public setMaskFunc(func: (x: number, y: number) => boolean) { this.maskFunc = func }\n\n  /// Function: setShaderFunc\n  /// Sets the function to be called to post-process / shade each visible tile.\n  /// Shader function is called even if caching is enabled, see <Engine.setCacheEnabled>.\n  ///\n  /// Parameters:\n  ///   func - function taking parameters (tile, x, y) and returning an ut.Tile\n  public setShaderFunc(func: (tile: Tile, x: number, y: number) => Tile) { this.shaderFunc = func }\n\n  /// Function: setWorldSize\n  /// Tiles outside of the range x = [0,width[ y = [0,height[ are not fetched.\n  /// Set to undefined in order to make the world infinite.\n  ///\n  /// Parameters:\n  ///   width - (integer) new world width\n  ///   height - (integer) new world height\n  public setWorldSize(width: number, height: number) {\n    this.w = width\n    this.h = height\n  }\n\n  /// Function: setCacheEnabled\n  /// Enables or disables the usage of tile cache. This means that\n  /// extra measures are taken to not call the tile function unnecessarily.\n  /// This means that all animating must be done in a shader function,\n  /// see <Engine.setShaderFunc>.\n  /// Cache is off by default, but should be enabled if the tile function\n  /// does more computation than a simple array look-up.\n  ///\n  /// Parameters:\n  ///   mode - true to enable, false to disable\n  public setCacheEnabled(mode: boolean) {\n    this.cacheEnabled = mode\n    this.refreshCache = true\n  }\n\n  /// Function: update\n  /// Updates the viewport according to the given player coordinates.\n  /// The algorithm goes as follows:\n  ///   * Record the current time\n  ///   * For each viewport tile:\n  ///   * Check if the tile is visible by testing the mask\n  ///   * If not visible, continue to the next tile in the viewport\n  ///   * Otherwise, if cache is enabled try to fetch the tile from there\n  ///   * Otherwise, call the tile function and check for shader function presence\n  ///   * If there is shader function, apply it to the tile, passing the recorded time\n  ///   * Put the tile to viewport\n  ///\n  /// Parameters:\n  ///   x - (integer) viewport center x coordinate in the tile world\n  ///   y - (integer) viewport center y coordinate in the tile world\n  public update(x?: number, y?: number) {\n    x = x || 0\n    y = y || 0\n\n    // World coords of upper left corner of the viewport\n    const xx = x - this.viewport.cx\n    const yy = y - this.viewport.cy\n    const timeNow = (new Date()).getTime() // For passing to shaderFunc\n    let transTime\n    if (this.transition && this.transitionTimer) transTime = (timeNow - this.transitionTimer) / this.transitionDuration\n    if (transTime && transTime >= 1.0) this.transition = undefined\n\n    let tile: Tile\n\n    // For each tile in viewport...\n    for (let j = 0; j < this.viewport.h; ++j) {\n      for (let i = 0; i < this.viewport.w; ++i) {\n        const ixx = i + xx, jyy = j + yy\n        // Check horizontal bounds if requested\n        if (this.w && (ixx < 0 || ixx >= this.w)) {\n          tile = NULLTILE\n        // Check vertical bounds if requested\n        } else if (this.h && (jyy < 0 || jyy >= this.h)) {\n          tile = NULLTILE\n        // Check mask\n        } else if (this.maskFunc && !this.maskFunc(ixx, jyy)) {\n          tile = NULLTILE\n        // Check transition effect\n        } else if (this.transition && !this.refreshCache) {\n          tile = this.transition(\n            i,\n            j,\n            this.viewport.w,\n            this.viewport.h,\n            this.tileFunc(ixx, jyy),\n            this.tileCache[j][i],\n            transTime || 0\n          )\n        // Check cache\n        } else if (this.cacheEnabled && !this.refreshCache) {\n          const lookupx = ixx - this.cachex\n          const lookupy = jyy - this.cachey\n          if (lookupx >= 0 && lookupx < this.viewport.w && lookupy >= 0 && lookupy < this.viewport.h) {\n            tile = this.tileCache[lookupy][lookupx]\n            if (tile === NULLTILE) tile = this.tileFunc(ixx, jyy)\n          } else // Cache miss\n            tile = this.tileFunc(ixx, jyy)\n        // If all else fails, call tileFunc\n        } else tile = this.tileFunc(ixx, jyy)\n        // Save the tile to cache (always due to transition effects)\n        this.tileCache2[j][i] = tile\n        // Apply shader function\n        if (this.shaderFunc && tile !== NULLTILE)\n          tile = this.shaderFunc(tile, ixx, jyy, timeNow)\n        // Put shaded tile to viewport\n        this.viewport.unsafePut(tile, i, j)\n      }\n    }\n    // Cache stuff is enabled always, because it is also required by transitions\n    // Save the new cache origin\n    this.cachex = xx\n    this.cachey = yy\n\n    // Swap cache buffers\n    const tempCache = this.tileCache\n    this.tileCache = this.tileCache2\n    this.tileCache2 = tempCache\n    this.refreshCache = false\n  }\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\n/// Class: CanvasRenderer\n/// Renders the <Viewport> into an HTML5 <canvas> element.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass CanvasRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private offscreen: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private ctx2: CanvasRenderingContext2D\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n\n  constructor(private view: Viewport) {\n    this.canvas = document.createElement('canvas')\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.ctx2 = this.canvas.getContext('2d')\n    if (!this.ctx2 || !this.ctx2.fillText) throw('Canvas not supported')\n    view.elem.appendChild(this.canvas)\n\n    // Create an offscreen canvas for rendering\n    this.offscreen = document.createElement('canvas')\n    this.ctx = this.offscreen.getContext('2d')\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = this.canvas.width\n    this.offscreen.height = this.canvas.height\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n  }\n\n  public getRendererString(): string { return 'canvas' }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = `${s.fontSize}/${s.lineHeight} ${s.fontFamily}`\n    this.ctx.textBaseline = 'middle'\n    this.tw = this.ctx.measureText('M').width\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    let tile, ch, fg, bg, x, y\n    const view = this.view,\n          buffer = this.view.buffer,\n          w = view.w, h = view.h,\n          hth = 0.5 * this.th,\n          hgap = 0.5 * this.gap // Squarification\n\n    // Clearing with one big rect is much faster than with individual char rects\n    this.ctx.fillStyle = view.defaultBackground\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n    y = hth // half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      x = 0\n      for (let i = 0; i < w; ++i) {\n        tile = buffer[j][i]\n        ch = tile.ch\n        fg = tile.getColorRGB()\n        bg = tile.getBackgroundRGB()\n        // Only render background if the color is non-default\n        if (bg.length && bg !== view.defaultBackground) {\n          this.ctx.fillStyle = bg\n          this.ctx.fillRect(x, y - hth, this.tw, this.th)\n        }\n        // Do not attempt to render empty char\n        if (ch.length) {\n          if (!fg.length) fg = view.defaultColor\n          this.ctx.fillStyle = fg\n          this.ctx.fillText(ch, x + hgap, y)\n        }\n        x += this.tw\n      }\n      y += this.th\n    }\n    this.ctx2.drawImage(this.offscreen, 0, 0)\n  }\n}\n\nexport const canvasRenderer = function(viewport: Viewport): Renderer {\n  return new CanvasRenderer(viewport)\n}\n","import { Renderer, Viewport } from './unicodetiles'\n\nconst VERTEX_SHADER = `\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n`\n\nconst FRAGMENT_SHADER = `\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n`\n\n/// Class: WebGLRenderer\n/// Renders the <Viewport> with WebGL.\n/// Given decent GPU drivers and browser support, this is the fastest renderer.\n///\n/// *Note:* This is an internal class used by <Viewport>\nclass WebGLRenderer implements Renderer {\n  private canvas: HTMLCanvasElement\n  private ctx: CanvasRenderingContext2D\n  private offscreen: HTMLCanvasElement\n\n  public gl: WebGLRenderingContext\n\n  private charMap: any\n  private charArray: any\n  private defaultColors: any\n  private attribs: any\n\n  private th?: number\n  private tw?: number\n  private gap?: number\n  private pad?: number\n\n  private tileCountsLocation: WebGLUniformLocation\n  private paddingLocation: WebGLUniformLocation\n\n  constructor(private view: Viewport) {\n    this.view = view\n    this.canvas = document.createElement('canvas')\n    // Try to fetch the context\n    if (!this.canvas.getContext) throw('Canvas not supported')\n    this.gl = this.canvas.getContext('experimental-webgl')\n    if (!this.gl) throw('WebGL not supported')\n    view.elem.appendChild(this.canvas)\n\n    this.charMap = {}\n    this.charArray = []\n    this.defaultColors = { r: 1.0, g: 1.0, b: 1.0, br: 0.0, bg: 0.0, bb: 0.0 }\n\n    this.attribs = {\n      position:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      texCoord:  { buffer: null, data: null, itemSize: 2, location: null, hint: this.gl.STATIC_DRAW },\n      color:     { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      bgColor:   { buffer: null, data: null, itemSize: 3, location: null, hint: this.gl.DYNAMIC_DRAW },\n      charIndex: { buffer: null, data: null, itemSize: 1, location: null, hint: this.gl.DYNAMIC_DRAW }\n    }\n\n\n    // Create an offscreen canvas for rendering text to texture\n    if (!this.offscreen)\n      this.offscreen = document.createElement('canvas')\n    this.offscreen.style.position = 'absolute'\n    this.offscreen.style.top = '0px'\n    this.offscreen.style.left = '0px'\n    this.ctx = this.offscreen.getContext('2d')\n    if (!this.ctx) throw 'Failed to acquire offscreen canvas drawing context'\n    // WebGL drawing canvas\n    this.updateStyle()\n    this.canvas.width = (view.squarify ? this.th : this.tw) * view.w\n    this.canvas.height = this.th * view.h\n    this.offscreen.width = 0\n    this.offscreen.height = 0\n    // Doing this again since setting canvas w/h resets the state\n    this.updateStyle()\n\n    this.gl.viewport(0, 0, this.canvas.width, this.canvas.height)\n\n    let vertexShader = this.compileShader(this.gl.VERTEX_SHADER, VERTEX_SHADER)\n    let fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, FRAGMENT_SHADER)\n    let program = this.gl.createProgram()\n    this.gl.attachShader(program, vertexShader)\n    this.gl.attachShader(program, fragmentShader)\n    this.gl.linkProgram(program)\n    this.gl.deleteShader(vertexShader)\n    this.gl.deleteShader(fragmentShader)\n    const ok = this.gl.getProgramParameter(program, this.gl.LINK_STATUS)\n    if (!ok) {\n      const msg = `Error linking program: ${this.gl.getProgramInfoLog(program)}`\n      this.gl.deleteProgram(program)\n      throw msg\n    }\n    this.gl.useProgram(program)\n\n    // Get attribute locations\n    this.attribs.position.location  = this.gl.getAttribLocation(program, 'position')\n    this.attribs.texCoord.location  = this.gl.getAttribLocation(program, 'texCoord')\n    this.attribs.color.location     = this.gl.getAttribLocation(program, 'color')\n    this.attribs.bgColor.location   = this.gl.getAttribLocation(program, 'bgColor')\n    this.attribs.charIndex.location = this.gl.getAttribLocation(program, 'charIndex')\n\n    // Setup buffers and uniforms\n    this.initBuffers()\n    let resolutionLocation = this.gl.getUniformLocation(program, 'uResolution')\n    this.gl.uniform2f(resolutionLocation, this.canvas.width, this.canvas.height)\n    this.tileCountsLocation = this.gl.getUniformLocation(program, 'uTileCounts')\n    this.gl.uniform2f(this.tileCountsLocation, this.view.w, this.view.h)\n    this.paddingLocation = this.gl.getUniformLocation(program, 'uPadding')\n    this.gl.uniform2f(this.paddingLocation, 0.0, 0.0)\n\n    // Setup texture\n    // view.elem.appendChild(this.offscreen) // Debug offscreen\n    let texture = this.gl.createTexture()\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture)\n    this.cacheChars(` !\\\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~`)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE)\n    this.gl.activeTexture(this.gl.TEXTURE0)\n\n    setTimeout(() => {\n      this.updateStyle()\n      this.buildTexture()\n      this.render()\n    }, 100)\n  }\n\n  public getRendererString(): string { return 'webgl' }\n\n  private buildTexture() {\n    let w = this.offscreen.width / (this.tw + this.pad),\n          h = this.offscreen.height / (this.th + this.pad)\n    // Check if need to resize the canvas\n    const charCount = this.charArray.length\n    if (charCount > Math.floor(w) * Math.floor(h)) {\n      w = Math.ceil(Math.sqrt(charCount))\n      h = w + 2 // Allocate some extra space too\n      this.offscreen.width = w * (this.tw + this.pad)\n      this.offscreen.height = h * (this.th + this.pad)\n      this.updateStyle()\n      this.gl.uniform2f(this.tileCountsLocation, w, h)\n    }\n    this.gl.uniform2f(this.paddingLocation, this.pad / this.offscreen.width, this.pad / this.offscreen.height)\n\n    let c = 0, ch: string\n    this.ctx.fillStyle = '#000000'\n    this.ctx.fillRect(0, 0, this.offscreen.width, this.offscreen.height)\n    this.ctx.fillStyle = '#ffffff'\n\n    const halfGap = 0.5 * this.gap // Squarification\n    const tw = this.tw + this.pad,\n          th = this.th + this.pad\n    let y = 0.5 * th // Half because textBaseline is middle\n    for (let j = 0; j < h; ++j) {\n      let x = this.pad * 0.5\n      for (let i = 0; i < w; ++i, ++c) {\n        ch = this.charArray[c]\n        if (ch === undefined) break\n        this.ctx.fillText(ch, x + halfGap, y)\n        x += tw\n      }\n      if (!ch) break\n      y += th\n    }\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.offscreen)\n  }\n\n  private cacheChars(chars: string, build: boolean = true) {\n    if (!this.gl) return // Nothing to do if not using WebGL renderer\n    let changed = false\n    for (let i = 0; i < chars.length; ++i) {\n      if (!this.charMap[chars[i]]) {\n        changed = true\n        this.charArray.push(chars[i])\n        this.charMap[chars[i]] = this.charArray.length - 1\n      }\n    }\n\n    if (changed && build) this.buildTexture()\n  }\n\n  public updateStyle(s?: any) {\n    s = s || window.getComputedStyle(this.view.elem, null)\n    this.ctx.font = s.fontSize + '/' + s.lineHeight + ' ' + s.fontFamily\n    this.ctx.textBaseline = 'middle'\n    this.ctx.fillStyle = '#ffffff'\n    this.tw = this.ctx.measureText('幅').width // TODO: Make a parameter\n    this.th = parseInt(s.fontSize, 10)\n    this.gap = this.view.squarify ? (this.th - this.tw) : 0\n    if (this.view.squarify) this.tw = this.th\n    this.pad = Math.ceil(this.th * 0.2) * 2.0 // Must be even number\n\n    const color = s.color.match(/\\d+/g)\n    const bgColor = s.backgroundColor.match(/\\d+/g)\n    this.defaultColors.r = parseInt(color[0], 10) / 255\n    this.defaultColors.g = parseInt(color[1], 10) / 255\n    this.defaultColors.b = parseInt(color[2], 10) / 255\n    this.defaultColors.br = parseInt(bgColor[0], 10) / 255\n    this.defaultColors.bg = parseInt(bgColor[1], 10) / 255\n    this.defaultColors.bb = parseInt(bgColor[2], 10) / 255\n  }\n\n  public clear() { /* No op */ }\n\n  public render() {\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT)\n    const w = this.view.w,\n      h = this.view.h\n\n    // Create new tile data\n    let tiles = this.view.buffer\n    let defaultColor = this.view.defaultColor\n    let defaultBgColor = this.view.defaultBackground\n    let newChars = false\n\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        const tile = tiles[j][i]\n        let ch = this.charMap[tile.ch]\n        if (ch === undefined) { // Auto-cache new characters\n          this.cacheChars(tile.ch, false)\n          newChars = true\n          ch = this.charMap[tile.ch]\n        }\n        const k = this.attribs.color.itemSize * 6 * (j * w + i)\n        const kk = this.attribs.charIndex.itemSize * 6 * (j * w + i)\n        const r = tile.r === undefined ? this.defaultColors.r : tile.r / 255\n        const g = tile.g === undefined ? this.defaultColors.g : tile.g / 255\n        const b = tile.b === undefined ? this.defaultColors.b : tile.b / 255\n        const br = tile.br === undefined ? this.defaultColors.br : tile.br / 255\n        const bg = tile.bg === undefined ? this.defaultColors.bg : tile.bg / 255\n        const bb = tile.bb === undefined ? this.defaultColors.bb : tile.bb / 255\n        for (let m = 0; m < 6; ++m) {\n          const n = k + m * this.attribs.color.itemSize\n          this.attribs.color.data[n + 0] = r\n          this.attribs.color.data[n + 1] = g\n          this.attribs.color.data[n + 2] = b\n          this.attribs.bgColor.data[n + 0] = br\n          this.attribs.bgColor.data[n + 1] = bg\n          this.attribs.bgColor.data[n + 2] = bb\n          this.attribs.charIndex.data[kk + m] = ch\n        }\n      }\n    }\n\n    // Upload\n    if (newChars) this.buildTexture()\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.color.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.color.data, this.attribs.color.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.bgColor.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.bgColor.data, this.attribs.bgColor.hint)\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.attribs.charIndex.buffer)\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, this.attribs.charIndex.data, this.attribs.charIndex.hint)\n\n    const attrib = this.attribs.position\n    this.gl.drawArrays(this.gl.TRIANGLES, 0, attrib.data.length / attrib.itemSize)\n  }\n\n  // Setup GLSL\n  private compileShader(type: number, source: string) {\n    const shader = this.gl.createShader(type)\n    this.gl.shaderSource(shader, source)\n    this.gl.compileShader(shader)\n    const ok = this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)\n    if (!ok) {\n      const msg = 'Error compiling shader: ' + this.gl.getShaderInfoLog(shader)\n      this.gl.deleteShader(shader)\n      throw msg\n    }\n    return shader\n  }\n\n  private initBuffers() {\n    let a, attrib, attribs = this.attribs\n\n    const w = this.view.w,\n          h = this.view.h\n\n    // Allocate data arrays\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      attrib.data = new Float32Array(attrib.itemSize * 6 * w * h)\n    }\n    // Generate static data\n    for (let j = 0; j < h; ++j) {\n      for (let i = 0; i < w; ++i) {\n        // Position & texCoords\n        const k = attribs.position.itemSize * 6 * (j * w + i)\n        this.insertQuad(attribs.position.data, k, i * this.tw, j * this.th, this.tw, this.th)\n        this.insertQuad(attribs.texCoord.data, k, 0.0, 0.0, 1.0, 1.0)\n      }\n    }\n    // Upload\n    for (a in this.attribs) {\n      attrib = attribs[a]\n      if (attrib.buffer) this.gl.deleteBuffer(attrib.buffer)\n      attrib.buffer = this.gl.createBuffer()\n      this.gl.bindBuffer(this.gl.ARRAY_BUFFER, attrib.buffer)\n      this.gl.bufferData(this.gl.ARRAY_BUFFER, attrib.data, attrib.hint)\n      this.gl.enableVertexAttribArray(attrib.location)\n      this.gl.vertexAttribPointer(attrib.location, attrib.itemSize, this.gl.FLOAT, false, 0, 0)\n    }\n  }\n\n  private insertQuad(arr: number[], i: number, x: number, y: number, w: number, h: number) {\n    const x1 = x,\n          y1 = y,\n          x2 = x + w,\n          y2 = y + h\n\n    arr[  i] = x1\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x1\n    arr[++i] = y2\n    arr[++i] = x2\n    arr[++i] = y1\n    arr[++i] = x2\n    arr[++i] = y2\n  }\n}\n\nexport const webGLRenderer = function(viewport: Viewport): Renderer {\n  return new WebGLRenderer(viewport)\n}\n","import { Talent, Game } from '../engine'\n\n// TODO: Validate all Talent's ids are uniq\nexport enum OnisunTalentId {\n  AttackerTwoHandedWeapons,\n  AttackerHeavyWeapons,\n  AttackerLightWeapons,\n  AttackerTwoWeapons,\n  AttackerDoubleTwoHandedWeapons,\n  AttackerStrongGrip,\n}\n\nexport abstract class OnisunTalent extends Talent {\n  constructor(\n    id: number,\n    name: string,\n    depth: number,\n    rank: number,\n    maxRank: number,\n    description: string = ''\n  ) {\n    super(id, name, depth, rank, maxRank, description)\n  }\n}\n\nexport class AttackerTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerTwoHandedWeapons, 'Двуручные оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerLightWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerLightWeapons, 'Легкие оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerHeavyWeapons extends OnisunTalent {\n  constructor() {\n    super(OnisunTalentId.AttackerHeavyWeapons, 'Тяжелые оружия', 0, 0, 3)\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerTwoWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerTwoWeapons,\n      'Два оружия',\n      1,\n      0,\n      1,\n      'Позволяет брать оружие в каждую руку'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerDoubleTwoHandedWeapons extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerDoubleTwoHandedWeapons,\n      'Два двуручных оружия',\n      2,\n      0,\n      2\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n\nexport class AttackerStrongGrip extends OnisunTalent {\n  constructor() {\n    super(\n      OnisunTalentId.AttackerStrongGrip,\n      'Крепкий хват',\n      2,\n      0,\n      2,\n      'Оружие не выбивается из рук'\n    )\n  }\n\n  public onObtain(game: Game): void {}\n}\n","import { ProfessionPicker, Profession, Player } from '../engine'\nimport { AttackerTwoHandedWeapons } from './talents'\n\nenum OnisunProfessionId {\n  Attacker,\n  Defender,\n}\n\nexport class OnisunAttackerProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Attacker, 'Оружейник', level)\n\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunDefenderProfession extends Profession {\n  constructor(level: number = 1) {\n    super(OnisunProfessionId.Defender, 'Защитник', level)\n\n    // TODO: Tmp\n    this.talents.push(new AttackerTwoHandedWeapons())\n  }\n}\n\nexport class OnisunProfessionPicker extends ProfessionPicker {\n  constructor(\n    player: Player,\n    public attacker = new OnisunAttackerProfession(),\n    public defender = new OnisunDefenderProfession()\n  ) {\n    super([attacker, defender], 3, 6)\n  }\n}\n","import {\n  Missile,\n  MissileWeapon,\n  Item,\n  Modifier,\n  Player,\n  OneHandWeapon,\n  BodyArmor,\n  Pool,\n  Creature,\n  Boots,\n  ImpactType,\n  DamageType,\n  AddImpactEvent,\n} from '../engine'\nimport { HealPotion } from './potions'\nimport { ProtectionType } from '../engine/models/items'\n\nclass MissileRock extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Sling\n  }\n}\n\nclass Arrow extends Missile {\n  public worksWith(item: Item): boolean {\n    return item instanceof Bow\n  }\n\n  public canThrow(player: Player): boolean {\n    return !!player.inventory.missileWeaponSlot.equipment\n  }\n}\n\nclass Sling extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof MissileRock\n  }\n}\n\nclass Bow extends MissileWeapon {\n  public worksWith(item: Item): boolean {\n    return item instanceof Arrow\n  }\n}\n\nconst noMod = new Modifier({})\n\nexport const commonBow = () => new Bow('Обычный лук', 1, noMod)\n\nexport const smallRock = () => new MissileRock('Маленький камень', 0.3, noMod)\n\nexport const woodenArrow = () => new Arrow('Деревянная стрела', 0.2, noMod)\nexport const ironArrow = () => new Arrow('Железная стрела', 0.25, noMod)\n\nexport const weapons = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new OneHandWeapon('Катана', 1, [\n        { type: DamageType.Melee, dice: { times: 5, max: 2 }, extra: 0 },\n      ]),\n  ],\n  [\n    7,\n    () =>\n      new OneHandWeapon('Кинжал', 0.8, [\n        { type: DamageType.Melee, dice: { times: 1, max: 3 }, extra: 2 },\n      ]),\n  ],\n])\n\nexport const itemsPool = new Pool<null, Item>([\n  [\n    1,\n    () =>\n      new BodyArmor('Кольчуга', 5, [{ type: ProtectionType.Medium, value: 3 }]),\n  ],\n  [\n    5,\n    () => new BodyArmor('Латы', 3, [{ type: ProtectionType.Heavy, value: 5 }]),\n  ],\n  [\n    10,\n    () =>\n      new BodyArmor('Роба', 1, [{ type: ProtectionType.Unarmored, value: 1 }]),\n  ],\n  [100, () => new HealPotion()],\n])\n\nexport class LightSpeedBoots extends Boots {\n  public impacts: ImpactType[] = [ImpactType.Blind]\n\n  constructor() {\n    super('Кроссовки скорости света', 0.1, [])\n  }\n}\n","import { Game, Potion } from '../engine'\n\nexport class HealPotion extends Potion {\n  constructor() {\n    super('Зелье лечения')\n  }\n\n  public onDrink(game: Game) {\n    game.player.health.increase(5)\n  }\n}\n","import {\n  Creature,\n  Dispatcher,\n  Clan,\n  Pool,\n  AICreature,\n  DamageType,\n  Protection,\n  ProtectionType,\n  Damage,\n  Resistance,\n} from '../engine'\n\nconst newCreature = (\n  name: string,\n  protections: Protection[] = [],\n  damages: Damage[]\n) => {\n  return new AICreature(new Dispatcher(), {\n    name: name,\n    weight: 10,\n    clan: Clan.PlayerOnlyEnemy,\n    abilities: [],\n    protections: protections,\n    damages: damages,\n\n    maxHealthValue: 1,\n    regenerationRate: 5,\n    regenerationValue: 1,\n\n    resistances: [],\n    visionRadius: 5,\n\n    moveSpeed: 20,\n    attackSpeed: 20,\n    bodyControl: 5,\n  })\n}\n\nexport const rat = () => {\n  return newCreature(\n    'Rat',\n    [],\n    [{ type: DamageType.Melee, dice: { times: 2, max: 2 }, extra: 0 }]\n  )\n}\n\nexport const golem = () => {\n  return newCreature(\n    'Golem',\n    [{ type: ProtectionType.Solid, value: 5 }],\n    [{ type: DamageType.Blunt, dice: { times: 1, max: 5 }, extra: 10 }]\n  )\n}\n\nexport const creaturesPool1 = new Pool<null, Creature>([[100, rat], [3, golem]])\n","import { Creature } from '../models/creature'\nimport { MetaAI } from './meta_ai'\nimport { Escaper } from './escaper'\nimport { Explorer } from './explorer'\nimport { Chaser } from './chaser'\nimport { Attacker } from './attacker'\nimport { Picker } from './picker'\nimport { Patrol } from './patrol'\nimport { Loiter } from './loiter'\nimport { Thrower } from './thrower'\nimport { Descender } from './descender'\nimport { SelfHealer } from './selfhealer'\nimport { Game } from '../models/game'\nimport { CreatureEvent } from '../events/internal'\nimport { LevelMap } from '../models/level_map'\n\nexport class Dispatcher extends MetaAI {\n  private escaper: Escaper\n  private explorer: Explorer\n  private chaser: Chaser\n  private attacker: Attacker\n  private picker: Picker\n  private patrol: Patrol\n  private loiter: Loiter\n  private thrower: Thrower\n\n  private descender: Descender\n\n  constructor() {\n    super()\n    this.escaper = new Escaper()\n    this.explorer = new Explorer()\n    this.chaser = new Chaser()\n    this.attacker = new Attacker()\n    this.picker = new Picker()\n    this.patrol = new Patrol()\n    this.loiter = new Loiter()\n    this.thrower = new Thrower()\n\n    this.descender = new Descender()\n  }\n\n  public act(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    this.runEvents()\n    let event: CreatureEvent | undefined\n\n    if (this.feelsGood(actor)) {\n      if ((event = this.attacker.act(actor, levelMap, game))) {\n      } else if ((event = this.thrower.act(actor, levelMap, game))) {\n      } else if ((event = this.chaser.act(actor, levelMap, game))) {\n      } else if ((event = this.picker.act(actor, levelMap, game))) {\n      } else {\n        event = this.explore(actor, levelMap, game)\n      }\n    } else if (\n      this.healthCritical(actor) &&\n      (event = this.escaper.act(actor, levelMap, game))\n    ) {\n    } else if ((event = this.attacker.act(actor, levelMap, game))) {\n    } else if ((event = this.thrower.act(actor, levelMap, game))) {\n    } else if ((event = this.chaser.act(actor, levelMap, game))) {\n    } else {\n      event = new SelfHealer().act(actor, levelMap)\n    }\n\n    this.resetEvents()\n\n    return event\n  }\n\n  private feelsGood(actor: Creature): boolean {\n    return actor.health.currentValue > actor.health.maximum * 0.9\n  }\n\n  private healthCritical(actor: Creature): boolean {\n    return actor.health.currentValue < actor.health.maximum / 4\n  }\n\n  private explore(\n    actor: Creature,\n    levelMap: LevelMap,\n    game: Game\n  ): CreatureEvent | undefined {\n    let event: CreatureEvent | undefined\n\n    if ((event = this.explorer.act(actor, levelMap, game))) {\n      if (!actor.dead) {\n        this.patrol.trackMovement(\n          levelMap.creaturePos(actor),\n          levelMap.creatureTile(actor)\n        )\n      }\n    } else if ((event = this.descender.act(actor, levelMap, game))) {\n    } else if ((event = this.patrol.act(actor, levelMap, game))) {\n    } else {\n      event = this.loiter.act(actor, levelMap, game)\n    }\n\n    return event\n  }\n}\n","import {\n  Corridor,\n  Door,\n  drawn,\n  Dungeon,\n  Floor,\n  LevelMap,\n  Point,\n  Tile,\n  TileTypes,\n  Wall,\n  Game,\n  Player,\n  StairwayDown,\n  StairwayUp,\n  LogMessageTrigger,\n  TeleportationTrap,\n  Room,\n  LightTrap,\n} from '../../engine'\nimport { rat } from '../creatures'\n\nconst tiles: Map<string, () => Tile> = new Map()\ntiles.set('C', () => new Corridor('C', TileTypes.Floor))\ntiles.set('W', () => new Wall())\ntiles.set('R', () => new Floor('R', TileTypes.Floor))\ntiles.set('D', () => new Door())\n\nconst initId: number = 1,\n  ratId = initId + 1\n\nexport class TutorialDungeon extends Dungeon {\n  public enter(game: Game, player: Player): void {\n    const levelMap = (game.currentMap = game.getMap(initId))\n\n    levelMap.addCreature(new Point(5, 2), player)\n  }\n\n  public register(game: Game): void {\n    game.addMap(initId, (id, game) => {\n      let map = this.generateMap(id, [\n        'WWWWWWWWWWW',\n        'WWWWRRRWWWW',\n        'WWWWRRRWWWW',\n        'WWWWRRRWWWW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWCWWWWW',\n        'WRRRWCWRRRW',\n        'WRRRCCCRRRW',\n        'WRRRWCWRRRW',\n        'WWWWWWWWWWW',\n      ])\n      map.name = 'Traps'\n\n      map.setTile(\n        4,\n        6,\n        new LogMessageTrigger('Teleportation trap', false, new Room())\n      )\n      map.setTile(2, 6, new TeleportationTrap())\n\n      map.setTile(6, 6, new LogMessageTrigger('Light trap', false, new Room()))\n      map.setTile(8, 6, new LightTrap())\n\n      return map\n    })\n\n    game.addMap(ratId, (id, game) => {\n      let map = this.generateMap(id, [\n        'WWWWW',\n        'WRRRW',\n        'WRRRW',\n        'WRRRW',\n        'WWWWW',\n      ])\n      map.name = '2nd'\n      map.setTile(2, 2, new TeleportationTrap())\n      map.addCreature(new Point(2, 4), rat())\n      // map.setTile(3, 1, new StairwayDown(map, downId))\n      // map.setTile(1, 1, new StairwayUp(map, upId))\n      return map\n    })\n  }\n\n  private generateMap(id: number, scheme: string[]): LevelMap {\n    let map = new LevelMap(id, drawn(scheme, tiles))\n\n    return map\n  }\n}\n","import {\n  Clan,\n  Player,\n  allAbilities,\n  OneHandWeapon,\n  Game,\n  Level,\n  PlayerAI,\n  PickUpItemsEvent,\n  DamageType,\n  BodyArmor,\n  ProtectionType,\n  PutOnItemEvent,\n} from './engine'\n\nimport { OnisunProfessionPicker } from './onisun/professions'\nimport {\n  woodenArrow,\n  ironArrow,\n  commonBow,\n  smallRock,\n  LightSpeedBoots,\n} from './onisun/items'\nimport { TutorialDungeon } from './onisun/dungeons/tutorial_dungeon'\n\nexport * from './engine'\nexport * from './onisun/professions'\nexport * from './onisun/talents'\nexport * from './onisun/items'\n\nexport class Application {\n  public game: Onisun\n  constructor() {\n    this.game = new Onisun(this.initPlayer())\n\n    const dungeon = new TutorialDungeon()\n    dungeon.register(this.game)\n    dungeon.enter(this.game, this.game.player)\n\n    const player = this.game.player,\n      prof = this.game.professionPicker.available(player)[1]\n\n    if (prof) {\n      player.professions.push(prof)\n    }\n\n    const dagger = new OneHandWeapon('Кинжал', 0.8, [\n      { type: DamageType.Melee, dice: { times: 1, max: 3 }, extra: 2 },\n    ])\n    const katana = new OneHandWeapon('Катана', 1, [\n      { type: DamageType.Melee, dice: { times: 5, max: 2 }, extra: 0 },\n    ])\n    const plateArmor = new BodyArmor('Латы', 1, [\n      { type: ProtectionType.Heavy, value: 5 },\n    ])\n\n    const wooden = woodenArrow()\n    const iron = ironArrow()\n    const rock = smallRock()\n\n    const bow = commonBow()\n\n    if (this.game.currentMap) {\n      const tile = this.game.currentMap.creatureTile(player)\n\n      tile.addItem(dagger, 2)\n      tile.addItem(katana, 1)\n      tile.addItem(plateArmor, 1)\n      tile.addItem(wooden, 5)\n      tile.addItem(iron, 5)\n      tile.addItem(rock, 5)\n      tile.addItem(bow, 2)\n\n      player.on(\n        new PickUpItemsEvent(\n          tile,\n          [\n            { item: dagger, count: 2 },\n            { item: katana, count: 1 },\n            { item: plateArmor, count: 1 },\n            { item: wooden, count: 5 },\n            { item: iron, count: 5 },\n            { item: rock, count: 5 },\n            { item: bow, count: 2 },\n          ],\n          this.game\n        )\n      )\n\n      player.on(\n        new PutOnItemEvent(player.inventory.missileWeaponSlot, bow, this.game)\n      )\n      player.on(\n        new PutOnItemEvent(player.inventory.missileSlot, wooden, this.game)\n      )\n      player.on(\n        new PutOnItemEvent(player.inventory.rightHandSlot, katana, this.game)\n      )\n      player.on(\n        new PutOnItemEvent(player.inventory.chestSlot, plateArmor, this.game)\n      )\n\n      player.addItem(new LightSpeedBoots(), 1)\n\n      this.game.logger.reset()\n    }\n  }\n\n  protected initPlayer(): Player {\n    return new Player(\n      new Level([1, 3, 5, 10, 20]),\n      new PlayerAI(),\n      {\n        name: 'Player',\n        weight: 80,\n        clan: Clan.Player,\n        abilities: allAbilities,\n        protections: [],\n        damages: [],\n        maxHealthValue: 10,\n        regenerationRate: 30,\n        regenerationValue: 1,\n        resistances: [],\n        visionRadius: 10,\n        moveSpeed: 20,\n        attackSpeed: 20,\n        bodyControl: 5,\n      },\n      12,\n      15\n    )\n  }\n}\n\nexport class Onisun extends Game {\n  constructor(player: Player) {\n    super(player, new OnisunProfessionPicker(player))\n  }\n}\n","import { Tile as UniTile } from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  Item,\n  ItemGroup,\n  TileVisitor,\n\n  Wall,\n  Floor,\n  Tile,\n  StairwayDown,\n  StairwayUp,\n  Door,\n  Trap,\n  TriggerTile,\n  TrapType,\n} from '../src/onisun'\n\nconst DEFAULT_GREY: number = 120\nconst IMPORTANT_GREY: number = 180\nconst DEFAULT_LIT = { r: 255, g: 165, b: 0 }\n\nexport class DisplayTile extends UniTile {\n  public lighted(degree: number): UniTile {\n    return this\n  }\n\n  constructor(char: string, r = DEFAULT_GREY, g = DEFAULT_GREY, b = DEFAULT_GREY) {\n    super(char, r, g, b)\n  }\n\n  protected litBackground(tile: UniTile, degree: number): UniTile {\n    tile.setBackground(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n\n  protected litColor(tile: UniTile, degree: number): UniTile {\n    tile.setColor(\n      DEFAULT_LIT.r * degree,\n      DEFAULT_LIT.g * degree,\n      DEFAULT_LIT.b * degree,\n    )\n    return tile\n  }\n}\n\nabstract class ImportantTile extends DisplayTile {\n  constructor(char: string) {\n    super(char, IMPORTANT_GREY, IMPORTANT_GREY, IMPORTANT_GREY)\n  }\n}\n\nexport class CreatureTile extends ImportantTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nexport class DoorTile extends DisplayTile {\n  constructor() {\n    super('戸')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litColor(tile, degree)\n    tile.swapColors()\n\n    return tile\n  }\n}\n\nexport class FloorTile extends DisplayTile {\n  constructor() {\n    super('・')\n  }\n\n  public lighted(degree: number) {\n    return this.litColor(this.clone(), degree)\n  }\n}\n\nexport class WallTile extends DisplayTile {\n  constructor() {\n    super('＃')\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    this.litBackground(tile, degree)\n    tile.backgroundToColor()\n\n    return tile\n  }\n}\n\nexport class StairwayDownD extends DisplayTile {\n  constructor() {\n    super('＞')\n  }\n}\n\nexport class StairwayUpD extends DisplayTile {\n  constructor() {\n    super('＜')\n  }\n}\n\nexport class ItemTile extends DisplayTile {\n  constructor(\n    char: string,\n    public vr: number,\n    public vg: number,\n    public vb: number,\n  ) {\n    super(char)\n  }\n\n  public lighted(degree: number) {\n    let tile = this.clone()\n    tile.setColor(this.vr, this.vg, this.vb)\n\n    return tile\n  }\n}\n\nconst WEAPON = new ItemTile('刀', 200, 200, 200)\nconst CORPSE = new ItemTile('体', 200, 200, 200)\nconst BODY_ARMOR = new ItemTile('胸', 200, 200, 200)\nconst MISSILE = new ItemTile('石', 200, 200, 200)\nconst MISSILE_WEAPON = new ItemTile(']', 200, 200, 200)\nconst BOOTS = new ItemTile('[', 255, 255, 0)\n\nconst POTION = new ItemTile('！', 200, 200, 200)\n\nexport const displayItem = function(item: Item): ItemTile {\n  switch (item.group) {\n    case ItemGroup.OneHandWeapon:\n      return WEAPON\n    case ItemGroup.Consumable:\n      return CORPSE\n    case ItemGroup.BodyArmor:\n      return BODY_ARMOR\n    case ItemGroup.Missile:\n      return MISSILE\n    case ItemGroup.MissileWeapon:\n      return MISSILE_WEAPON\n    case ItemGroup.Potion:\n      return POTION\n    case ItemGroup.Boots:\n      return BOOTS\n    default:\n      return CORPSE\n  }\n}\n\nconst DOOR = new DoorTile()\nconst WALL = new WallTile()\nconst FLOOR = new FloorTile()\nconst STAIRWAY_DOWN = new StairwayDownD()\nconst STAIRWAY_UP = new StairwayUpD()\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst TELEPORTATION_TRAP = new DisplayTile('^', 0, 191, 255)\nconst LIGHT_TRAP = new DisplayTile('^', 255, 255, 0)\n\nexport class DisplayTileVisitor extends TileVisitor {\n  public tile: DisplayTile\n\n  public onWall(wall: Wall): void {\n    this.tile = WALL\n  }\n\n  public onFloor(floor: Floor): void {\n    this.tile = FLOOR\n  }\n\n  public onStairwayDown(stairway: StairwayDown): void {\n    this.tile = STAIRWAY_DOWN\n  }\n\n  public onStairwayUp(stairway: StairwayUp): void {\n    this.tile = STAIRWAY_UP\n  }\n\n  public onDoor(door: Door): void {\n    this.tile = DOOR\n  }\n\n  public onTrap(trap: Trap): void {\n    if (!trap.revealed) {\n      this.tile = FLOOR\n      return\n    }\n\n    switch (trap.type) {\n    case TrapType.Teleportation:\n      this.tile = TELEPORTATION_TRAP\n      break\n    case TrapType.Light:\n      this.tile = LIGHT_TRAP\n      break\n    }\n  }\n\n  public onTrigger(trigger: TriggerTile): void {\n    trigger.tile.visit(this)\n  }\n\n  protected default(tile: Tile): void {\n    this.tile = NULL_TILE\n  }\n}\n\nconst displayTileVisitor = new DisplayTileVisitor()\n\nexport const displayTile = function(tile): DisplayTile {\n  tile.visit(displayTileVisitor)\n  return displayTileVisitor.tile\n}\n","\n\n\n\n\nimport Vue from 'vue'\n\nimport {\n  domRenderer,\n  canvasRenderer,\n  webGLRenderer,\n  Engine,\n  Viewport,\n  Tile,\n} from '../vendor/unicodetiles.ts/src/index'\n\nimport {\n  CreatureTile,\n  ItemTile,\n  DisplayTile,\n\n  displayItem,\n  displayTile,\n} from './scene_tiles'\nimport { Creature } from 'src/engine';\n\nconst HUMAN  = new CreatureTile('＠', 0, 255, 0)\nconst RAT = new CreatureTile('r', 197, 65, 38)\nconst GOLEM = new CreatureTile('G', 120, 120, 120)\nconst NULL_TILE = new DisplayTile('　', 0, 0, 0)\n\nconst nextItemAnimation = [\n  new ItemTile('｜', 200, 200, 200),\n  new ItemTile('／', 200, 200, 200),\n  new ItemTile('ー', 200, 200, 200),\n  new ItemTile('＼', 200, 200, 200),\n]\n\nexport default Vue.extend({\n  props: ['level', 'player', 'pos'],\n  data() {\n    return {\n      wholeMap: false,\n      term: null,\n      eng: null,\n      drawInterval: null,\n      ts: Date.now(),\n      interval: 100,\n      step: 0,\n    }\n  },\n  methods: {\n    getTile(x: number, y: number) {\n      const effect = this.stage.at(x, y).effect\n      const tile = this.wholeMap ? this.stage.at(x, y) : this.stage.at(x, y).tile\n\n      if (!tile) {\n        return NULL_TILE\n      }\n\n      if (effect) {\n        if (tile.creature) {\n          let dTile = this.creatureTile(tile.creature).clone()\n          dTile.setBackground(200, 0, 0)\n          return dTile\n        } else {\n          return new DisplayTile(effect, 200, 200, 0)\n        }\n      }\n\n      if (tile.creature) {\n        return this.creatureTile(tile.creature)\n      }\n\n      if (tile.items) {\n        switch (tile.items.bunch.length) {\n        case 0:\n          break;\n        case 1:\n          return displayItem(tile.items.bunch[0].item)\n        default:\n          const frame = this.step % (this.animationFps * 3 + 4)\n          if (frame < nextItemAnimation.length) {\n            return nextItemAnimation[frame]\n          } else {\n            const itemId = Math.floor(this.step / (this.animationFps * 3 + 4))\n\n            return displayItem(tile.items.bunch[itemId % tile.items.bunch.length].item)\n          }\n        }\n      }\n\n      return displayTile(tile)\n    },\n    creatureTile(creature: Creature) {\n      if (creature.name == 'Rat') {\n        return RAT\n      }\n\n      if (creature.name == 'Golem') {\n        return GOLEM\n      }\n\n      return HUMAN\n    },\n    initViewport() {\n      this.term = new Viewport(\n        this.$refs.scene,\n        Math.max(this.level.width, 40),\n        Math.max(this.level.height, 40),\n        webGLRenderer,\n        true,\n      )\n\n      this.eng = new Engine(\n        this.term,\n        (x: number, y: number) => this.getTile(x, y),\n        this.level.width,\n        this.level.height,\n      )\n\n      this.eng.setMaskFunc((x, y) => {\n        return this.wholeMap || this.stage.at(x, y).seen\n      });\n\n      this.eng.setShaderFunc((tile, x, y, time) => {\n        return this.lighting(tile, x, y, time)\n      })\n\n      clearInterval(this.drawInterval)\n      this.drawInterval = setInterval(() => { this.drawScene() }, this.interval)\n    },\n    drawScene() {\n      const ts = Date.now()\n      if (this.ts + 1000 < ts) {\n        this.ts = ts\n      }\n\n      this.eng.update(this.pos.x, this.pos.y);\n      // this.eng.update(this.term.cx, this.term.cy);\n      this.term.render();\n\n      this.step += 1\n    },\n    lighting(tile, x, y, time) {\n      if (this.wholeMap) {\n        return tile.lighted(1)\n      }\n      const fovTile = this.stage.at(x, y)\n\n      if (fovTile.visible && tile.lighted) {\n        return tile.lighted(fovTile.degree)\n      }\n\n      return tile\n    },\n  },\n  computed: {\n    stage() {\n      return this.wholeMap ? this.level : this.player.stageMemory(this.level)\n    },\n    animationFps(): number {\n      return 1000 / this.interval\n    },\n    tileItems() {\n      let items = this.stage.at(this.player.pos.x, this.player.pos.y).items()\n      return items && items.bunch\n    }\n  },\n  mounted() {\n    this.initViewport()\n  },\n  beforeDestroy() {\n    clearInterval(this.drawInterval)\n  },\n  watch: {\n    interval() {\n      this.initViewport()\n    }\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=71f826b9&lang=pug&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scene.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Scene.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"scene\",staticClass:\"unicodetiles\"})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrimaryAttribute.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { sum } from 'lodash'\n\nexport default Vue.extend({\n  name: 'PrimaryAttribute',\n  props: ['name', 'slug', 'attr', 'fullName'],\n  computed: {\n    id(): string {\n      return `${this.slug}-container`\n    },\n    modifier(): number {\n      return sum(this.attr.modifiers)\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./PrimaryAttribute.vue?vue&type=template&id=f39b08e2&lang=pug&\"\nimport script from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\nexport * from \"./PrimaryAttribute.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"PrimaryAttribute.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover\",attrs:{\"id\":_vm.id}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.name))]),_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.attr.current))]),_c('b-popover',{attrs:{\"target\":_vm.id,\"triggers\":\"hover\",\"container\":_vm.id,\"placement\":\"top\"}},[[_c('big',{staticClass:\"name\"},[_vm._v(_vm._s(_vm.fullName))]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Базовый:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.attr.current))])]),_c('p',[_c('span',{staticClass:\"name\"},[_vm._v(\"Модификатор:\")]),_vm._v(\" \"),_c('span',{staticClass:\"description\"},[_vm._v(_vm._s(_vm.modifier))])])]],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { Item, Weapon, Armor, DamageType, ProtectionType, Damage, Protection } from '../src/onisun'\n\nexport const showItemDetails = function(item: Item): string | undefined {\n  if (item instanceof Weapon) {\n    return item.damages.map(showDamage).join(',')\n  } else if (item instanceof Armor) {\n    return item.protections.map(showProtection).join(',')\n  }\n}\n\nexport const showDamage = function({ extra, dice: { times, max }, type }: Damage): string {\n  let base = `${showDamageType(type)} ${times}d${max}`\n\n  if (extra) {\n    base += `+${extra}`\n  }\n\n  return base\n}\n\nexport const showDamageType = function(damageType: DamageType): string {\n  switch (damageType) {\n  case DamageType.Melee:\n    return 'Me'\n  case DamageType.Pierce:\n    return 'Pi'\n  case DamageType.Blunt:\n    return 'B'\n  case DamageType.Magic:\n    return 'Mg'\n  case DamageType.Pure:\n    return 'Pu'\n  default:\n    return 'unknown damage type'\n  }\n}\n\nexport const showProtection = function({ type, value } : Protection): string {\n  switch (type) {\n  case ProtectionType.Light:\n    return `L${value}`\n  case ProtectionType.Medium:\n    return `M${value}`\n  case ProtectionType.Heavy:\n    return `H${value}`\n  case ProtectionType.Solid:\n    return `S${value}`\n  case ProtectionType.Unarmored:\n    return `U${value}`\n  default:\n    return 'unknown protection type'\n  }\n}\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport PrimaryAttribute from './PrimaryAttribute.vue'\nimport { Attribute, Level } from 'src/engine'\n\nimport {\n  showProtection, showDamage\n} from './shows'\n\nexport default Vue.extend({\n  name: 'Stats',\n  props: ['creature', 'levelMap'],\n  components: {\n    PrimaryAttribute\n  },\n  computed: {\n    levelProgress(): string {\n      const level: Level = this.creature.level\n      return `${level.currentExperience  / level.requiredExperience * 100}%`\n    },\n    healthLevel(): string {\n      const attribute: Attribute = this.creature.health\n      return `${attribute.currentValue / (attribute.maximum || 0) * 100}%`\n    },\n    protections(): string {\n      return this.creature.protections.map(showProtection).join(', ')\n    },\n    damages(): string {\n      return this.creature.damages.map(showDamage).join(', ')\n    }\n  },\n  methods: {\n    displayAttribute(attribute: Attribute) {\n      if (attribute.currentValue != attribute.maximum) {\n        return `${attribute.currentValue} / ${attribute.maximum}`\n      } else {\n        return attribute.currentValue\n      }\n    },\n  }\n})\n","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Stats.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Stats.vue?vue&type=template&id=20a5072e&scoped=true&lang=pug&\"\nimport script from \"./Stats.vue?vue&type=script&lang=ts&\"\nexport * from \"./Stats.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Stats.vue?vue&type=style&index=0&id=20a5072e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"20a5072e\",\n  null\n  \n)\n\ncomponent.options.__file = \"Stats.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel container\"},[_c('div',{staticClass:\"level cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.creature.level.current))]),_c('div',{staticClass:\"note\"},[_vm._v(\"Уровень\"),_c('div',{staticClass:\"progress\"},[_c('div',{staticClass:\"progress-bar bg-success\",style:({ width: _vm.levelProgress }),attrs:{\"role\":\"progressbar\"}})])])]),_c('div',{staticClass:\"hp cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.displayAttribute(_vm.creature.health)))]),_c('div',{staticClass:\"bar\",style:({ height: _vm.healthLevel })})]),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"strength\",\"name\":\"St\",\"full-name\":\"Сила\",\"attr\":_vm.creature.strength}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"dexterity\",\"name\":\"Dx\",\"full-name\":\"Ловкость\",\"attr\":_vm.creature.dexterity}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"constitution\",\"name\":\"Co\",\"full-name\":\"Телосложение\",\"attr\":_vm.creature.constitution}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"intelligence\",\"name\":\"In\",\"full-name\":\"Интеллект\",\"attr\":_vm.creature.intelligence}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"wisdom\",\"name\":\"Ws\",\"full-name\":\"Мудрость\",\"attr\":_vm.creature.wisdom}}),_c('PrimaryAttribute',{staticClass:\"attribute\",attrs:{\"slug\":\"charisma\",\"name\":\"Ch\",\"full-name\":\"Харизма\",\"attr\":_vm.creature.charisma}}),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.levelMap.name))])]),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.protections))])]),_c('div',{staticClass:\"cell\"},[_c('div',{staticClass:\"value\"},[_vm._v(_vm._s(_vm.damages))])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./Impacts.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { ImpactType } from '../src/engine'\n\nexport default Vue.extend({\n  name: 'Impacts',\n  props: ['impacts'],\n  methods: {\n    icon(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return 'blind'\n        case ImpactType.Stressed:\n          return 'weight'\n        case ImpactType.Loaded:\n          return 'weight'\n        case ImpactType.Overloaded:\n          return 'weight'\n      }\n    },\n    title(type: ImpactType) {\n      switch(type) {\n        case ImpactType.Blind:\n          return 'Слепота'\n        case ImpactType.Stressed:\n          return 'Нагружен'\n        case ImpactType.Loaded:\n          return 'Груженый'\n        case ImpactType.Overloaded:\n          return 'Перегруженый'\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./Impacts.vue?vue&type=template&id=436b0ad3&scoped=true&lang=pug&\"\nimport script from \"./Impacts.vue?vue&type=script&lang=ts&\"\nexport * from \"./Impacts.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Impacts.vue?vue&type=style&index=0&id=436b0ad3&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"436b0ad3\",\n  null\n  \n)\n\ncomponent.options.__file = \"Impacts.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"panel\"},_vm._l((_vm.impacts),function(impact){return _c('div',{staticClass:\"impact-block\"},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/impacts/' + _vm.icon(impact) + '.svg'}}),_c('div',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title(impact))}})])}))}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./IdleView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { IdleInputKey, Direction } from '../../src/onisun'\n\nexport default Vue.extend({\n  name: 'IdleView',\n  props: ['screen'],\n  methods: {\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.move(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.move(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.move(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.move(Direction.down)\n      case 'y':\n        return this.screen.move(Direction.upLeft)\n      case 'u':\n        return this.screen.move(Direction.upRight)\n      case 'b':\n        return this.screen.move(Direction.downLeft)\n      case 'n':\n        return this.screen.move(Direction.downRight)\n\n      case 'H':\n        return this.screen.handleCommand()\n      case 'L':\n        return this.screen.lookCommand()\n\n      case 's':\n      case '.':\n        return this.screen.stayCommand()\n\n      case 'i':\n        return this.screen.inventoryCommand()\n      case 'I':\n        return this.screen.bagCommand()\n      case 't':\n        return this.screen.missileCommand()\n      case ',':\n        return this.screen.pickUpCommand()\n      case 'd':\n        return this.screen.dropCommand()\n      case 'D':\n        return this.screen.drinkCommand()\n\n      default:\n        console.log('Key: ', event.key)\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./IdleView.vue?vue&type=template&id=ccf81e4a&lang=pug&\"\nimport script from \"./IdleView.vue?vue&type=script&lang=ts&\"\nexport * from \"./IdleView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"IdleView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProfessionPickingView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null\n    }\n  },\n  methods: {\n    close(doubleClickOption) {\n      const option = doubleClickOption || this.picked\n      if (option) {\n        this.screen.pickProfession(option)\n      }\n    },\n    onEvent(event) {\n      switch(event.key) {\n      case 'a':\n        this.picked = this.screen.options[0]\n        break\n      case 'b':\n        this.picked = this.screen.options[1]\n        break\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        return\n      }\n    },\n    iconPath(professionId: number) {\n      return 'assets/professions/' + [\n        'acrobatic.svg',\n        'button-finger.svg',\n        'disintegrate.svg',\n        'flying-fox.svg',\n        'amputation.svg',\n        'catch.svg',\n        'divert.svg',\n        'fruiting.svg',\n        'annexation.svg',\n        'conversation.svg',\n        'dodging.svg',\n        'grab.svg',\n        'arrest.svg',\n        'convince.svg',\n        'drinking.svg',\n        'journey.svg',\n        'back-forth.svg',\n        'coronation.svg',\n        'drop-weapon.svg',\n        'juggler.svg',\n        'backstab.svg',\n        'crafting.svg',\n        'drowning.svg',\n        'jump-across.svg',\n        'boot-stomp.svg',\n        'crush.svg',\n        'eating.svg',\n        'kindle.svg',\n        'bowman.svg',\n        'discussion.svg',\n        'expander.svg',\n        'kneeling.svg',\n      ][professionId]\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./ProfessionPickingView.vue?vue&type=template&id=064b48bd&lang=pug&\"\nimport script from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ProfessionPickingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ProfessionPickingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ProfessionPickingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal text-center\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"content\"},_vm._l((_vm.screen.options),function(option){return _c('div',{key:option.id,staticClass:\"option p-2 m-3\",class:{ 'picked': _vm.picked && _vm.picked.id === option.id },on:{\"click\":function($event){_vm.picked = option},\"dblclick\":function($event){_vm.close(option)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":_vm.iconPath(option.id)}}),_c('div',{staticClass:\"name\"},[_vm._v(_vm._s(option.name))])])})),_c('div',{staticClass:\"bottom\"},[(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"success\"},on:{\"click\":_vm.close}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    player() {\n      return this.screen.player\n    },\n    carryingWeight() {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return `Нагрузка ${weight} из ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        if (this.screen.singleItemMode) {\n          this.screen.withItem(this.screen.positions[i])\n        } else if (this.selected.indexOf(i) >= 0) {\n          this.selected.splice(this.selected.indexOf(i), 1)\n        } else {\n          this.selected.push(i)\n        }\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionSelected(index) {\n      return this.selected.indexOf(index) >= 0\n    },\n    positionStatus(position) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    itemWeight(position) {\n      return position.item.weight * position.count\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ItemsListingView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./ItemsListingView.vue?vue&type=template&id=fe135db0&lang=pug&\"\nimport script from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nexport * from \"./ItemsListingView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./ItemsListingView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"ItemsListingView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('div',{staticClass:\"subtitle my-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"container positions-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.positionStatus(position)},[_c('td',{staticClass:\"selected\"},[(_vm.positionSelected(index))?_c('div',{staticClass:\"sign\"},[_vm._v(\"+\")]):_vm._e()]),_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\"},[_vm._v(_vm._s(position.item.name)+\" (\"+_vm._s(position.count)+\")\")]),_c('td',{staticClass:\"weight\"},[_vm._v(\"[\"+_vm._s(_vm.itemWeight(position))+\"kg]\")])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { OnisunTalentId } from 'src/onisun'\nimport { TalentStatus, Profession } from 'src/engine';\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  props: ['screen'],\n  data() {\n    return {\n      picked: null,\n      professionIndex: 0\n    }\n  },\n  computed: {\n    option() {\n      return this.screen.options[this.professionIndex]\n    },\n    profession(): Profession {\n      return this.option.profession\n    },\n    groupedTalents() {\n      let groups = new Array(5)\n      for (let i = 0; i < groups.length; i++) {\n        groups[i] = []\n      }\n\n      let availableIndex = 0\n\n      this.option.talents.forEach(talent => {\n        if (talent.status === TalentStatus.Available) {\n          Object.assign(talent, {\n            letter: String.fromCharCode(LETTER_OFFSET + availableIndex++)\n          })\n        }\n\n        groups[talent.depth].push(talent)\n      })\n\n      return groups\n    }\n  },\n  methods: {\n    close(doubleClickOption = undefined) {\n      const talent = doubleClickOption || this.picked\n\n      if (!talent || talent.status !== TalentStatus.Available) {\n        return\n      }\n\n      this.screen.pickTalent(this.profession.id, talent.id)\n      this.picked = null\n    },\n    pickTalent(talent) {\n      if (talent.status === TalentStatus.Available) {\n        this.picked = talent\n      }\n    },\n    onEvent(event: KeyboardEvent): void {\n      switch(event.key) {\n      case ' ':\n      case 'Enter':\n        this.close()\n      default:\n        this.groupedTalents.forEach(group => group.forEach(talent => {\n          if (talent.letter === event.key) {\n            this.picked = talent\n          }\n        }))\n\n        const index = parseInt(event.key)\n        if (index >= 1 && index <= this.screen.options.length) {\n          this.professionIndex = index - 1\n        }\n      }\n    },\n    talentTip(talent) {\n      let tip = `${talent.rank}/${talent.maxRank}`\n      if (talent.rank >= talent.maxRank) {\n        return tip\n      } else {\n        return `${talent.letter} ${tip}`\n      }\n    },\n    talentStatus(talent): string | undefined {\n      if (this.picked && this.picked.id === talent.id) {\n        return '-selected'\n      }\n      switch(talent.status) {\n      case TalentStatus.Available:\n        return '-available'\n      case TalentStatus.Unavailable:\n        return '-unavailable'\n      case TalentStatus.Completed:\n        return '-completed'\n      }\n    },\n    iconPath(talentId: OnisunTalentId): string {\n      switch(talentId) {\n        case OnisunTalentId.AttackerTwoHandedWeapons:\n          return 'AttackerTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerHeavyWeapons:\n          return 'AttackerHeavyWeapons.svg'\n        case OnisunTalentId.AttackerLightWeapons:\n          return 'AttackerLightWeapons.svg'\n        case OnisunTalentId.AttackerTwoWeapons:\n          return 'AttackerTwoWeapons.svg'\n        case OnisunTalentId.AttackerDoubleTwoHandedWeapons:\n          return 'AttackerDoubleTwoHandedWeapons.svg'\n        case OnisunTalentId.AttackerStrongGrip:\n          return 'AttackerStrongGrip.svg'\n      }\n    }\n  },\n  watch: {\n    professionIndex() {\n      this.picked =  null\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TalentsTreeView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./TalentsTreeView.vue?vue&type=template&id=28a8fd04&lang=pug&\"\nimport script from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nexport * from \"./TalentsTreeView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./TalentsTreeView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"TalentsTreeView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"simple-popover screen-modal text-center\",attrs:{\"id\":\"talents-tree-container\"}},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.screen.title))]),_c('b-tabs',{staticClass:\"tabs-list\",attrs:{\"card\":\"\"},model:{value:(_vm.professionIndex),callback:function ($$v) {_vm.professionIndex=$$v},expression:\"professionIndex\"}},_vm._l((_vm.screen.player.professions),function(profession){return _c('b-tab',{key:profession.id,attrs:{\"title\":profession.name,\"no-body\":\"\"}})})),_c('table',{staticClass:\"content\"},_vm._l((_vm.groupedTalents),function(group,i){return _c('tr',{key:i},_vm._l((group),function(talent,j){return _c('td',{key:j,staticClass:\"cell\"},[_c('div',{staticClass:\"talent-cell\",class:_vm.talentStatus(talent),attrs:{\"id\":j + 'talentTree-'+i,\"variant\":\"primary\"},on:{\"click\":function($event){_vm.pickTalent(talent)},\"dblclick\":function($event){_vm.close(talent)}}},[_c('img',{staticClass:\"icon\",attrs:{\"src\":'assets/talents/' + _vm.iconPath(talent.id)}}),_c('span',{staticClass:\"level\"},[_vm._v(_vm._s(_vm.talentTip(talent)))]),_c('b-popover',{attrs:{\"target\":j + 'talentTree-'+i,\"triggers\":\"hover\",\"container\":\"talents-tree-container\"}},[[_c('p',{staticClass:\"name\"},[_vm._v(_vm._s(talent.name))]),_c('small',[_c('p',{staticClass:\"rank\"},[_vm._v(\"Уровень \"+_vm._s(talent.rank)+\"/\"+_vm._s(talent.maxRank))]),(_vm.talentStatus(talent) === '-unavailable')?_c('p',{staticClass:\"requirements\"},[_vm._v(\"Требуется \"+_vm._s(talent.depth * _vm.profession.depthCost)+\" очков в \"+_vm._s(_vm.profession.name))]):_vm._e(),_c('p',{staticClass:\"description\"},[_vm._v(_vm._s(talent.description))])])]],2)],1)])}))})),(_vm.picked !== null)?_c('b-btn',{attrs:{\"variant\":\"default\"},on:{\"click\":function($event){_vm.close()}}},[_vm._v(\"Подтвердить\")]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport {\n  LeftHandSlot,\n  RightHandSlot,\n  ChestSlot,\n  MissileSlot,\n  MissileWeaponSlot,\n  InventoryPresenterPosition,\n  Item,\n  Player,\n  Weapon,\n  Armor,\n  Damage,\n  DamageType,\n  Protection,\n  ProtectionType,\n} from '../../src/engine'\n\nimport {\n  displayItem,\n} from './../scene_tiles'\n\nimport {\n  showItemDetails\n} from '../shows'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'Inventory',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n    }\n  },\n  computed: {\n    player(): Player {\n      return this.screen.player\n    },\n    carryingWeight() {\n      let weight = Math.round(this.player.stuffWeight.current * 100) / 100\n      return `Нагрузка ${weight} из ${this.player.carryingCapacity.stressed}`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent): void {\n      switch (event.key) {\n      case ' ':\n      case 'Escape':\n        return this.screen.close()\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.positions.length)) {\n        const position = this.screen.positions[i]\n        if (position.item) {\n          this.screen.takeOff(position)\n        } else if (position.availableItems.length) {\n          this.screen.putOn(position)\n        }\n      }\n    },\n    positionDetails(position: InventoryPresenterPosition): string  | undefined {\n      if (position.item && position.item.canSeeDetails) {\n        return showItemDetails(position.item)\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    },\n    positionStatus(position: InventoryPresenterPosition) {\n      if (!position.item) {\n        return ''\n      } else {\n        return 'text-success'\n      }\n    },\n    displayBodyPart(bodyPart: ChestSlot): string {\n      return bodyPart.name\n    },\n    displayItem(item: Item): string | undefined {\n      if (item) {\n        return `${displayItem(item).getChar()} ${item.name}`\n      }\n    },\n    itemName(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `${position.item.name} ${position.count > 1 ? `(${position.count})` : ''}`\n      } else {\n        return '-'\n      }\n    },\n    itemWeight(position: InventoryPresenterPosition) {\n      if (position.item && position.count) {\n        return `[${position.item.weight * position.count}kg]`\n      }\n    },\n    available(position: InventoryPresenterPosition) {\n      return position.item || position.availableItems.length\n    },\n    availableStatus(position: InventoryPresenterPosition) {\n      return this.available(position) ? '-available' : '-unavailable'\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./InventoryView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./InventoryView.vue?vue&type=template&id=9b7a8cca&lang=pug&\"\nimport script from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nexport * from \"./InventoryView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./InventoryView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"InventoryView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"h4 title\"},[_vm._v(\"Инвентарь\")]),_c('div',{staticClass:\"subtitle my-3\",domProps:{\"textContent\":_vm._s(_vm.carryingWeight)}}),_c('table',{staticClass:\"content inventory-list\"},_vm._l((_vm.screen.positions),function(position,index){return _c('tr',{key:index,class:_vm.availableStatus(position)},[_c('td',{staticClass:\"slot\"},[_c('span',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('span',{staticClass:\"dash\"},[_vm._v(\"—\")]),_c('span',{staticClass:\"part\"},[_vm._v(_vm._s(_vm.displayBodyPart(position.inventorySlot)))]),_c('span',{staticClass:\"separator\"},[_vm._v(\":\")])]),_c('td',{staticClass:\"name-slot\"},[_c('span',{staticClass:\"name\",class:_vm.positionStatus(position)},[_vm._v(_vm._s(_vm.itemName(position)))]),_c('small',{staticClass:\"details\",domProps:{\"textContent\":_vm._s(_vm.positionDetails(position))}})]),_c('td',{staticClass:\"weight\"},[_vm._v(_vm._s(_vm.itemWeight(position)))])])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LookView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LookView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { Direction, LookPresenterVisibility } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'LookView',\n  props: ['screen'],\n  computed: {\n    title() {\n      switch (this.screen.title) {\n      case LookPresenterVisibility.See:\n        return 'Вижу ...'\n      case LookPresenterVisibility.Recall:\n        return 'Вспоминаю ...'\n      case LookPresenterVisibility.Hidden:\n        return 'Без понятия ...'\n      default:\n        return this.screen.title\n      }\n    }\n  },\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case 'Escape':\n      case ' ':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./LookView.vue?vue&type=template&id=500ea8d4&scoped=true&lang=pug&\"\nimport script from \"./LookView.vue?vue&type=script&lang=ts&\"\nexport * from \"./LookView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./LookView.vue?vue&type=style&index=0&id=500ea8d4&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"500ea8d4\",\n  null\n  \n)\n\ncomponent.options.__file = \"LookView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"look-modal\"},[_c('div',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title)}}),_vm._l((_vm.screen.body),function(msg){return _c('div',{domProps:{\"textContent\":_vm._s(msg)}})})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MissileView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from 'vue'\nimport { Direction } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'MissileView',\n  props: ['screen'],\n  methods: {\n    close(inputKey) {\n      this.screen.onInput(inputKey)\n    },\n    onEvent(event) {\n      switch (event.key) {\n      case 'l':\n      case 'ArrowRight':\n        return this.screen.moveTarget(Direction.right)\n      case 'h':\n      case 'ArrowLeft':\n        return this.screen.moveTarget(Direction.left)\n      case 'k':\n      case 'ArrowUp':\n        return this.screen.moveTarget(Direction.up)\n      case 'j':\n      case 'ArrowDown':\n        return this.screen.moveTarget(Direction.down)\n      case 'y':\n        return this.screen.moveTarget(Direction.upLeft)\n      case 'u':\n        return this.screen.moveTarget(Direction.upRight)\n      case 'b':\n        return this.screen.moveTarget(Direction.downLeft)\n      case 'n':\n        return this.screen.moveTarget(Direction.downRight)\n\n      case '>':\n        this.screen.nextTarget()\n        break\n      case '<':\n        this.screen.previousTarget()\n        break\n      case 't':\n        this.screen.attack()\n        break\n      case 'Escape':\n        this.screen.close()\n        break\n      }\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./MissileView.vue?vue&type=template&id=7bd4158e&lang=pug&\"\nimport script from \"./MissileView.vue?vue&type=script&lang=ts&\"\nexport * from \"./MissileView.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"MissileView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DeathView.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\nimport { DieReason } from '../../src/engine'\n\nexport default Vue.extend({\n  name: 'DeathView',\n  props: ['screen'],\n  computed: {\n    message(): string {\n      switch (this.screen.dieReason) {\n      case DieReason.Attack:\n        return 'Смерть в бою честь для героя. Но жить мне все-таки нравилось больше'\n      case DieReason.Missile:\n        return 'Раньше меня вела дорога приключений, но теперь и мне прострелили колено'\n      case DieReason.Trap:\n        return 'Я так и не научился смотреть под ноги'\n      case DieReason.Overloaded:\n        return 'Тяжко уйти от бремени, которое сам себе навязываешь.'\n      default:\n        return 'Скучная смерть, которая даже не заслужила отдельного сообщения'\n      }\n    },\n    signature(): string {\n      return `Признался ${this.screen.playerName} перед смертью`\n    }\n  },\n  methods: {\n    onEvent(event: KeyboardEvent) {\n    }\n  }\n})\n","import { render, staticRenderFns } from \"./DeathView.vue?vue&type=template&id=600d877a&lang=pug&\"\nimport script from \"./DeathView.vue?vue&type=script&lang=ts&\"\nexport * from \"./DeathView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./DeathView.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"DeathView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('div',{staticClass:\"h4 title\"},[_vm._v(\"Ты умер\")]),_c('div',{staticClass:\"content mt-5\"},[_c('blockquote',{staticClass:\"blockquote text-center signature\"},[_c('p',{staticClass:\"mb-0\",domProps:{\"textContent\":_vm._s(_vm.message)}}),_c('footer',{staticClass:\"blockquote-footer\",domProps:{\"textContent\":_vm._s(_vm.signature)}})])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from 'vue'\n\nimport { PresenterType } from '../../src/onisun'\n\nconst LETTER_OFFSET = 97\n\nexport default Vue.extend({\n  name: 'PickSingleOptionView',\n  props: ['screen'],\n  data() {\n    return {\n      page: 0,\n      perPage: 20,\n      selected: [],\n    }\n  },\n  computed: {\n    title(): string {\n      switch (this.screen.type) {\n      case PresenterType.PickHandleOption:\n        return 'С чем взаимодействовать?'\n      }\n    }\n  },\n  methods: {\n    optionName(option): string {\n      switch (this.screen.type) {\n      case PresenterType.PickHandleOption:\n        return option[0]\n      }\n    },\n    onEvent(event: KeyboardEvent) {\n      switch (event.key) {\n      case 'Escape':\n        return this.screen.close()\n      case 'Enter':\n      case ' ':\n        return this.screen.pickUpItems(this.selected.map(index => this.screen.positions[index]))\n      default:\n        return this.selectAt(event.key.charCodeAt(0) - LETTER_OFFSET)\n      }\n    },\n    selectAt(i: number) {\n      if (i >= 0 && i < Math.min(this.perPage, this.screen.options.length)) {\n        this.screen.pick(this.screen.options[i])\n      }\n    },\n    indexLetter(i: number): string {\n      return String.fromCharCode(LETTER_OFFSET + i)\n    }\n  }\n})\n","import mod from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/ts-loader/index.js??ref--14-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PickSingleOptionView.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./PickSingleOptionView.vue?vue&type=template&id=08d3fe9c&scoped=true&lang=pug&\"\nimport script from \"./PickSingleOptionView.vue?vue&type=script&lang=ts&\"\nexport * from \"./PickSingleOptionView.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./PickSingleOptionView.vue?vue&type=style&index=0&id=08d3fe9c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"08d3fe9c\",\n  null\n  \n)\n\ncomponent.options.__file = \"PickSingleOptionView.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"screen-modal\"},[_c('span',{staticClass:\"title\",domProps:{\"textContent\":_vm._s(_vm.title)}}),_c('table',{staticClass:\"container options-list\"},_vm._l((_vm.screen.options),function(option,index){return _c('tr',{key:index},[_c('td',{staticClass:\"letter\"},[_vm._v(_vm._s(_vm.indexLetter(index)))]),_c('td',{staticClass:\"separator\"},[_vm._v(\"—\")]),_c('td',{staticClass:\"name\",domProps:{\"textContent\":_vm._s(_vm.optionName(option))}})])}))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/ts-loader/index.js??ref--14-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue,{ VueConstructor } from 'vue'\nimport * as _ from 'lodash'\n\nimport Logger from './Logger.vue'\nimport Scene from './Scene.vue'\nimport Stats from './Stats.vue'\nimport Impacts from './Impacts.vue'\n\nimport Idle from './views/IdleView.vue'\nimport ProfessionPickingView from './views/ProfessionPickingView.vue'\nimport ItemsListingView from './views/ItemsListingView.vue'\nimport TalentsTreeView from './views/TalentsTreeView.vue'\nimport InventoryView from './views/InventoryView.vue'\nimport LookView from './views/LookView.vue'\nimport MissileView from './views/MissileView.vue'\nimport DeathView from './views/DeathView.vue'\nimport PickSingleOptionView from './views/PickSingleOptionView.vue'\n\nimport { LevelMap, PresenterType, Presenter } from '../src/engine'\n\nimport { Application } from '../src/onisun'\nimport { setInterval, clearInterval } from 'timers'\n\nexport default Vue.extend({\n  data() {\n    return {\n      game: new Application().game,\n      ts: Date.now(),\n      loopIntervalId: undefined\n    }\n  },\n  components: {\n    Impacts,\n    Logger,\n    Scene,\n    Stats,\n  },\n  computed: {\n    viewComponent(): VueConstructor | undefined {\n      switch (this.game.ai && this.game.ai.presenter && this.game.ai.presenter.type) {\n      case PresenterType.AbilitiesPicking:\n        return TalentsTreeView\n      case PresenterType.ProfessionPicking:\n        return ProfessionPickingView\n      case PresenterType.Idle:\n        return Idle\n      case PresenterType.ItemsListing:\n        return ItemsListingView\n      case PresenterType.Inventory:\n        return InventoryView\n      case PresenterType.Missile:\n        return MissileView\n      case PresenterType.Teleportation:\n      case PresenterType.Look:\n        // TODO: It's not only look anymore, name accordingly\n        return LookView\n      case PresenterType.Death:\n        return DeathView\n      case PresenterType.PickHandleOption:\n        return PickSingleOptionView\n      default:\n        throw `App: unknown presenter ${this.game.ai.presenter}`\n      }\n    }\n  },\n  methods: {\n    loop() {\n      this.game.turn()\n    },\n    onEvent(event: KeyboardEvent) {\n      const view = this.$refs.viewComponent\n      if (view) {\n        view.onEvent(event)\n      }\n    }\n  },\n  created() {\n    this.loopIntervalId = setInterval(this.loop, 10)\n    document.addEventListener('keydown', this.onEvent)\n  },\n  beforeDestroy() {\n    clearInterval(this.loopIntervalId)\n    document.removeEventListener('keydown', this.onEvent)\n  }\n})\n","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=bda42e60&lang=pug&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.game)?_c('div',{staticClass:\"container-fluid\",attrs:{\"id\":\"app\"}},[(_vm.game.player)?_c('Scene',{staticClass:\"scene\",attrs:{\"level\":_vm.game.currentMap,\"player\":_vm.game.player,\"pos\":_vm.game.currentMap.creaturePos(_vm.game.player)}}):_vm._e(),(_vm.game.player)?_c('Stats',{staticClass:\"player-stats\",attrs:{\"creature\":_vm.game.player,\"level-map\":_vm.game.currentMap}}):_vm._e(),_c('Logger',{staticClass:\"logger-panel\",attrs:{\"logger\":_vm.game.logger}}),_c('Impacts',{staticClass:\"effect-panel\",attrs:{\"impacts\":_vm.game.player.impacts}}),(_vm.game.ai)?_c(_vm.viewComponent,{ref:\"viewComponent\",tag:\"component\",attrs:{\"screen\":_vm.game.ai.presenter}}):_vm._e()],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue'\nimport App from './App.vue'\nimport BootstrapVue from 'bootstrap-vue'\n\nVue.use(BootstrapVue)\n\nimport './application.scss'\n\nimport 'bootstrap/dist/css/bootstrap.css'\nimport 'bootstrap-vue/dist/bootstrap-vue.css'\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n"],"sourceRoot":""}