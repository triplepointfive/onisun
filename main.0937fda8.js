!function(t){function e(e){for(var i,a,o=e[0],c=e[1],h=e[2],l=0,d=[];l<o.length;l++)a=o[l],r[a]&&d.push(r[a][0]),r[a]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(u&&u(e);d.length;)d.shift()();return n.push.apply(n,h||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,o=1;o<s.length;o++){var c=s[o];0!==r[c]&&(i=!1)}i&&(n.splice(e--,1),t=a(a.s=s[0]))}return t}var i={},r={0:0},n=[];function a(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=i,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(s,i,function(e){return t[e]}.bind(null,i));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/onisun/";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var h=0;h<o.length;h++)e(o[h]);var u=c;n.push([156,1]),s()}([function(t,e,s){"use strict";var i=s(103);s.d(e,"Attacker",function(){return i.a});var r=s(104);s.d(e,"Chaser",function(){return r.a});var n=s(105);s.d(e,"Descender",function(){return n.a});var a=s(106);s.d(e,"Escaper",function(){return a.a});var o=s(107);s.d(e,"Explorer",function(){return o.a});s(12);var c=s(50);s.d(e,"Loiter",function(){return c.a});var h=s(27);s.d(e,"MetaAI",function(){return h.c});var u=s(108);s.d(e,"Patrol",function(){return u.a});var l=s(114);s.d(e,"Picker",function(){return l.a});var d=s(36);s.d(e,"AINewLevelEvent",function(){return d.b}),s.d(e,"PlayerAI",function(){return d.d}),s.d(e,"PlayerBorgAI",function(){return d.e});var p=s(115);s.d(e,"SelfHealer",function(){return p.a});var m=s(116);s.d(e,"Thrower",function(){return m.a});s(117),s(37),s(38);var f=s(35);s.d(e,"AfterEvent",function(){return f.a});var g=s(118);s.d(e,"AttackEvent",function(){return g.a});var v=s(119);s.d(e,"CloseDoorEvent",function(){return v.a});var y=s(15);s.d(e,"DieEvent",function(){return y.a}),s.d(e,"DieReason",function(){return y.b});var b=s(120);s.d(e,"DrinkPotionEvent",function(){return b.a});s(52);var w=s(18);s.d(e,"HurtEvent",function(){return w.a});var T=s(1);s.d(e,"CreatureEvent",function(){return T.a}),s.d(e,"Reaction",function(){return T.c});s(53);var C=s(121);s.d(e,"MissileAttackEvent",function(){return C.a});var P=s(14);s.d(e,"MoveEvent",function(){return P.a});s(56);var x=s(122);s.d(e,"PickUpItemsEvent",function(){return x.a});var M=s(123);s.d(e,"PickProfessionEvent",function(){return M.a});var k=s(57);s.d(e,"PickTalentEvent",function(){return k.a});var I=s(124);s.d(e,"PutOnItemEvent",function(){return I.a});var _=s(125);s.d(e,"RemoveImpactEvent",function(){return _.a});s(29),s(22);var E=s(39);s.d(e,"TakeOffItemEvent",function(){return E.a});var O=s(126);s.d(e,"TeleportationEvent",function(){return O.a});s(55);var S=s(40);s.d(e,"TrapEvent",function(){return S.a});var D=s(127);s.d(e,"UntrapEvent",function(){return D.a});s(21),s(59),s(128);var R=s(129);s.d(e,"dungeon",function(){return R.a});s(49),s(28);var A=s(9);s.d(e,"Calculator",function(){return A.a});var N=s(23);s.d(e,"DamageType",function(){return N.a});var B=s(130);s.d(e,"Gender",function(){return B.a});var W=s(34);s.d(e,"ImpactBunch",function(){return W.a}),s.d(e,"ImpactType",function(){return W.b});var $=s(131);s.d(e,"Level",function(){return $.a});var L=s(11);s.d(e,"Material",function(){return L.a});var j=s(132);s.d(e,"Pool",function(){return j.a});var G=s(30);s.d(e,"addCreatures",function(){return G.a}),s.d(e,"addDoors",function(){return G.b}),s.d(e,"centralize",function(){return G.c}),s.d(e,"safeWithMatchingTile",function(){return G.d}),s.d(e,"withEachTile",function(){return G.e}),s.d(e,"withMatchingTile",function(){return G.f});s(19),s(44);var H=s(133);s.o(H,"AICreature")&&s.d(e,"AICreature",function(){return H.AICreature}),s.o(H,"Ability")&&s.d(e,"Ability",function(){return H.Ability}),s.o(H,"Armor")&&s.d(e,"Armor",function(){return H.Armor}),s.o(H,"BagPresenter")&&s.d(e,"BagPresenter",function(){return H.BagPresenter}),s.o(H,"BaseInfoPresenter")&&s.d(e,"BaseInfoPresenter",function(){return H.BaseInfoPresenter}),s.o(H,"BodyArmor")&&s.d(e,"BodyArmor",function(){return H.BodyArmor}),s.o(H,"Boots")&&s.d(e,"Boots",function(){return H.Boots}),s.o(H,"CharacterInfoPage")&&s.d(e,"CharacterInfoPage",function(){return H.CharacterInfoPage}),s.o(H,"Clan")&&s.d(e,"Clan",function(){return H.Clan}),s.o(H,"Color")&&s.d(e,"Color",function(){return H.Color}),s.o(H,"Corridor")&&s.d(e,"Corridor",function(){return H.Corridor}),s.o(H,"Direction")&&s.d(e,"Direction",function(){return H.Direction}),s.o(H,"Door")&&s.d(e,"Door",function(){return H.Door}),s.o(H,"DrinkPresenter")&&s.d(e,"DrinkPresenter",function(){return H.DrinkPresenter}),s.o(H,"DropItemsPresenter")&&s.d(e,"DropItemsPresenter",function(){return H.DropItemsPresenter}),s.o(H,"Dungeon")&&s.d(e,"Dungeon",function(){return H.Dungeon}),s.o(H,"EquipmentPresenter")&&s.d(e,"EquipmentPresenter",function(){return H.EquipmentPresenter}),s.o(H,"Floor")&&s.d(e,"Floor",function(){return H.Floor}),s.o(H,"Game")&&s.d(e,"Game",function(){return H.Game}),s.o(H,"HistoryInfoPresenter")&&s.d(e,"HistoryInfoPresenter",function(){return H.HistoryInfoPresenter}),s.o(H,"IdlePresenter")&&s.d(e,"IdlePresenter",function(){return H.IdlePresenter}),s.o(H,"Inventory")&&s.d(e,"Inventory",function(){return H.Inventory}),s.o(H,"ItemGroup")&&s.d(e,"ItemGroup",function(){return H.ItemGroup}),s.o(H,"LevelMap")&&s.d(e,"LevelMap",function(){return H.LevelMap}),s.o(H,"LogLevel")&&s.d(e,"LogLevel",function(){return H.LogLevel}),s.o(H,"Logger")&&s.d(e,"Logger",function(){return H.Logger}),s.o(H,"LookPresenter")&&s.d(e,"LookPresenter",function(){return H.LookPresenter}),s.o(H,"LookPresenterVisibility")&&s.d(e,"LookPresenterVisibility",function(){return H.LookPresenterVisibility}),s.o(H,"Memory")&&s.d(e,"Memory",function(){return H.Memory}),s.o(H,"MenuComponent")&&s.d(e,"MenuComponent",function(){return H.MenuComponent}),s.o(H,"Missile")&&s.d(e,"Missile",function(){return H.Missile}),s.o(H,"MissileWeapon")&&s.d(e,"MissileWeapon",function(){return H.MissileWeapon}),s.o(H,"MultipleItemUseListingPresenter")&&s.d(e,"MultipleItemUseListingPresenter",function(){return H.MultipleItemUseListingPresenter}),s.o(H,"OneHandWeapon")&&s.d(e,"OneHandWeapon",function(){return H.OneHandWeapon}),s.o(H,"PickUpPresenter")&&s.d(e,"PickUpPresenter",function(){return H.PickUpPresenter}),s.o(H,"Player")&&s.d(e,"Player",function(){return H.Player}),s.o(H,"Point")&&s.d(e,"Point",function(){return H.Point}),s.o(H,"Potion")&&s.d(e,"Potion",function(){return H.Potion}),s.o(H,"PresenterType")&&s.d(e,"PresenterType",function(){return H.PresenterType}),s.o(H,"Profession")&&s.d(e,"Profession",function(){return H.Profession}),s.o(H,"ProfessionPicker")&&s.d(e,"ProfessionPicker",function(){return H.ProfessionPicker}),s.o(H,"ProfessionPickingPresenter")&&s.d(e,"ProfessionPickingPresenter",function(){return H.ProfessionPickingPresenter}),s.o(H,"ProtectionType")&&s.d(e,"ProtectionType",function(){return H.ProtectionType}),s.o(H,"PutOnItemsPresenter")&&s.d(e,"PutOnItemsPresenter",function(){return H.PutOnItemsPresenter}),s.o(H,"Room")&&s.d(e,"Room",function(){return H.Room}),s.o(H,"Talent")&&s.d(e,"Talent",function(){return H.Talent}),s.o(H,"TalentStatus")&&s.d(e,"TalentStatus",function(){return H.TalentStatus}),s.o(H,"TalentsPickingPresenter")&&s.d(e,"TalentsPickingPresenter",function(){return H.TalentsPickingPresenter}),s.o(H,"TalentsPresenter")&&s.d(e,"TalentsPresenter",function(){return H.TalentsPresenter}),s.o(H,"TeleportationPresenter")&&s.d(e,"TeleportationPresenter",function(){return H.TeleportationPresenter}),s.o(H,"TileTypes")&&s.d(e,"TileTypes",function(){return H.TileTypes}),s.o(H,"TileVisitor")&&s.d(e,"TileVisitor",function(){return H.TileVisitor}),s.o(H,"TrapType")&&s.d(e,"TrapType",function(){return H.TrapType}),s.o(H,"Wall")&&s.d(e,"Wall",function(){return H.Wall}),s.o(H,"Weapon")&&s.d(e,"Weapon",function(){return H.Weapon}),s.o(H,"dwarfRace")&&s.d(e,"dwarfRace",function(){return H.dwarfRace}),s.o(H,"humanRace")&&s.d(e,"humanRace",function(){return H.humanRace}),s.o(H,"leePath")&&s.d(e,"leePath",function(){return H.leePath}),s.o(H,"randomizeAttributes")&&s.d(e,"randomizeAttributes",function(){return H.randomizeAttributes}),s.o(H,"twoDimArray")&&s.d(e,"twoDimArray",function(){return H.twoDimArray});var F=s(16);s.d(e,"AICreature",function(){return F.a}),s.d(e,"Ability",function(){return F.b}),s.d(e,"Clan",function(){return F.c});var U=s(134);s.d(e,"Dungeon",function(){return U.a});var q=s(135);s.d(e,"Game",function(){return q.a});var V=s(136);s.d(e,"Inventory",function(){return V.a});s(13);var z=s(10);s.d(e,"Armor",function(){return z.a}),s.d(e,"BodyArmor",function(){return z.b}),s.d(e,"Boots",function(){return z.c}),s.d(e,"ItemGroup",function(){return z.f}),s.d(e,"Missile",function(){return z.g}),s.d(e,"MissileWeapon",function(){return z.h}),s.d(e,"OneHandWeapon",function(){return z.i}),s.d(e,"Potion",function(){return z.j}),s.d(e,"ProtectionType",function(){return z.k}),s.d(e,"Weapon",function(){return z.m});var Y=s(60);s.d(e,"LevelMap",function(){return Y.a});var X=s(61);s.d(e,"LogLevel",function(){return X.a}),s.d(e,"Logger",function(){return X.b});var K=s(137);s.d(e,"Memory",function(){return K.a});var J=s(138);s.d(e,"Player",function(){return J.a});var Q=s(58);s.d(e,"Profession",function(){return Q.a}),s.d(e,"ProfessionPicker",function(){return Q.b}),s.d(e,"Talent",function(){return Q.c}),s.d(e,"TalentStatus",function(){return Q.d});var Z=s(31);s.d(e,"Color",function(){return Z.a});var tt=s(7);s.d(e,"Corridor",function(){return tt.a}),s.d(e,"Door",function(){return tt.b}),s.d(e,"Floor",function(){return tt.c}),s.d(e,"Room",function(){return tt.d}),s.d(e,"TileTypes",function(){return tt.g}),s.d(e,"TileVisitor",function(){return tt.h}),s.d(e,"TrapType",function(){return tt.j}),s.d(e,"Wall",function(){return tt.k});s(54),s(63),s(64),s(65),s(66),s(67),s(68),s(69);var et=s(139);s.d(e,"BagPresenter",function(){return et.a});var st=s(140);s.d(e,"BaseInfoPresenter",function(){return st.a});var it=s(17);s.d(e,"CharacterInfoPage",function(){return it.a});s(51);var rt=s(141);s.d(e,"DrinkPresenter",function(){return rt.a});var nt=s(142);s.d(e,"DropItemsPresenter",function(){return nt.a});var at=s(41);s.d(e,"EquipmentPresenter",function(){return at.a});var ot=s(143);s.d(e,"HistoryInfoPresenter",function(){return ot.a});var ct=s(93);s.d(e,"IdlePresenter",function(){return ct.a});var ht=s(8);s.d(e,"PresenterType",function(){return ht.c});var ut=s(24);s.d(e,"MultipleItemUseListingPresenter",function(){return ut.a});var lt=s(144);s.d(e,"LookPresenter",function(){return lt.a}),s.d(e,"LookPresenterVisibility",function(){return lt.b});s(42),s(70);var dt=s(145);s.d(e,"PickUpPresenter",function(){return dt.a});var pt=s(146);s.d(e,"ProfessionPickingPresenter",function(){return pt.a});var mt=s(147);s.d(e,"PutOnItemsPresenter",function(){return mt.a});var ft=s(71);s.d(e,"TalentsPickingPresenter",function(){return ft.a});var gt=s(72);s.d(e,"TalentsPresenter",function(){return gt.a});var vt=s(148);s.d(e,"TeleportationPresenter",function(){return vt.a});s(48),s(62);var yt=s(149);s.d(e,"leePath",function(){return yt.a});var bt=s(150);s.d(e,"randomizeAttributes",function(){return bt.a});var wt=s(6);s.d(e,"Direction",function(){return wt.a}),s.d(e,"Point",function(){return wt.c}),s.d(e,"twoDimArray",function(){return wt.j})},function(t,e,s){"use strict";var i;s.d(e,"c",function(){return i}),s.d(e,"b",function(){return r}),s.d(e,"a",function(){return n}),function(t){t[t.DIE=0]="DIE",t[t.HURT=1]="HURT",t[t.DODGE=2]="DODGE",t[t.NOTHING=3]="NOTHING",t[t.RESIST=4]="RESIST"}(i||(i={}));class r{}class n extends r{affectPlayer(t){return this.affectCreature(t)}}},,function(t,e,s){"use strict";s.d(e,"Application",function(){return m});var i=s(153),r=s(2),n=s(0),a=s(43),o=s(98),c=s(25),h=s(32);s.o(n,"Armor")&&s.d(e,"Armor",function(){return n.Armor}),s.o(n,"CharacterInfoPage")&&s.d(e,"CharacterInfoPage",function(){return n.CharacterInfoPage}),s.o(n,"DamageType")&&s.d(e,"DamageType",function(){return n.DamageType}),s.o(n,"Direction")&&s.d(e,"Direction",function(){return n.Direction}),s.o(n,"Gender")&&s.d(e,"Gender",function(){return n.Gender}),s.o(n,"ItemGroup")&&s.d(e,"ItemGroup",function(){return n.ItemGroup}),s.o(n,"MenuComponent")&&s.d(e,"MenuComponent",function(){return n.MenuComponent}),s.o(n,"Point")&&s.d(e,"Point",function(){return n.Point}),s.o(n,"PresenterType")&&s.d(e,"PresenterType",function(){return n.PresenterType}),s.o(n,"ProtectionType")&&s.d(e,"ProtectionType",function(){return n.ProtectionType}),s.o(n,"TileVisitor")&&s.d(e,"TileVisitor",function(){return n.TileVisitor}),s.o(n,"TrapType")&&s.d(e,"TrapType",function(){return n.TrapType}),s.o(n,"Weapon")&&s.d(e,"Weapon",function(){return n.Weapon}),s.o(n,"dwarfRace")&&s.d(e,"dwarfRace",function(){return n.dwarfRace}),s.o(n,"humanRace")&&s.d(e,"humanRace",function(){return n.humanRace}),s.o(n,"randomizeAttributes")&&s.d(e,"randomizeAttributes",function(){return n.randomizeAttributes});s(92);var u=s(151);s.d(e,"MenuComponent",function(){return u.a}),s.d(e,"dwarfRace",function(){return h.b}),s.d(e,"humanRace",function(){return h.c});s(45);const l={chance:.05,multiplier:2};class d extends n.Game{constructor(t){super(t,new c.c);const e=new o.a;e.register(this),e.enter(this,t)}}class p extends n.Game{turn(){super.turn(),this.currentMap&&this.playerTurn&&this.player.ai.endTurn(this,this.currentMap)}get done(){return this.player.dead||this.turns>150}}class m{constructor(){this.menu=null,this.mainGame=null,this.initGame(this.randomPlayer(new n.PlayerAI))}initGame(t){this.mainGame=new d(t),this.menu=null}newPlayer(t,e,s,i,r,a,o=new n.PlayerAI){let c=new n.Player(this.buildLevels(e),o,{name:r,race:e,gender:t,clan:n.Clan.Player,abilities:[],leavesCorpseRatio:0,ownProfession:s,parentsProfession:a,weight:80,protections:[],damages:[{type:n.DamageType.Pure,dice:{times:3,max:3},extra:1}],maxHealthValue:10,regenerationRate:1,regenerationValue:1,resistances:[],visionRadius:10,moveSpeed:20,attackSpeed:20,bodyControl:5,material:n.Material.flesh,throwingDamages:[],eyeColor:n.Color.Aqua,hairColor:n.Color.Fuchsia,skinColor:n.Color.Purple,height:100,critical:l},i);return c.on(new n.PickProfessionEvent(s)),c.on(new n.PickProfessionEvent(a)),c}buildLevels(t){return new n.Level(Object(r.drop)(Object(r.reduce)(Object(i.map)(Object(r.drop)(Object(r.times)(51,t=>t%5*10+100*~~(t/5)),2),(t,e)=>t*(e+1)),(t,e)=>(t.push((Object(r.last)(t)||0)+e),t),[0]),1).map(e=>Math.floor(e*t.experienceRatio)))}randomPlayer(t){return this.newPlayer(n.Gender.Male,h.c,new c.a,h.c.primaryAttributes,"AI",new c.b,t)}newTitleGame(){let t=this.randomPlayer(new n.PlayerBorgAI(new a.a)),e=new p(t,new c.c),s=new o.a;return s.register(e),s.enter(e,t),e}}},,,function(t,e,s){"use strict";s.d(e,"d",function(){return r}),s.d(e,"i",function(){return n}),s.d(e,"j",function(){return a}),s.d(e,"c",function(){return o}),s.d(e,"b",function(){return c}),s.d(e,"g",function(){return h}),s.d(e,"e",function(){return u}),s.d(e,"f",function(){return l}),s.d(e,"a",function(){return d}),s.d(e,"h",function(){return p});var i=s(2);class r{constructor(t,e,s,i){if(this.x=t,this.y=e,this.w=s,this.h=i,s<=0||i<=0)throw`Rect ${t} ${e} ${s} ${i}: size is negative or zero`}move(t,e){this.x+=t,this.y+=e}}const n=function(t){return Math.floor(Math.random()*t)},a=function(t,e,s){let i=Array(t);for(let r=0;r<t;r++){i[r]=new Array(e);for(let t=0;t<e;t++)i[r][t]=s(r,t)}return i};class o{constructor(t,e){this.x=t,this.y=e}eq(t){return this.x===t.x&&this.y===t.y}nextTo(t){return Math.abs(this.x-t.x)<=1&&Math.abs(this.y-t.y)<=1}copy(){return new o(this.x,this.y)}add(t){return new o(this.x+t.x,this.y+t.y)}wrappers(){return o.dxy.map(t=>this.add(t))}}o.dxy=[new o(-1,-1),new o(0,-1),new o(1,-1),new o(-1,0),new o(1,0),new o(-1,1),new o(0,1),new o(1,1)];class c{constructor(t){this.map=t,this.width=t.length,this.height=t[0].length}at(t,e){return this.map[t][e]}inRange(t){return t.x>=0&&t.y>=0&&t.x<this.width&&t.y<this.height}each(t){this.map.forEach((e,s)=>{e.forEach((e,i)=>{t(e,s,i)})})}}const h=function(t,e){let s;if(e>0)for(let i=0;i<e;i++)s=t.pop(),t.unshift(s);else if(e<0)for(let i=e;i<0;i++)s=t.shift(),t.push(s);return t},u=function(t,e,s){let[i,r,n,a]=[t.x,e.x,t.y,e.y],c=Math.max(Math.abs(i-r),Math.abs(n-a));const h=new o((r-i)/c,(a-n)/c);for(;c>1;)i+=h.x,n+=h.y,s(Math.round(i),Math.round(n)),c-=1},l=function(t,e,s){u(t,e,s),s(e.x,e.y)};class d extends o{constructor(t,e){super(t,e)}multiple(t){return new o(this.x*t,this.y*t)}}d.up=new d(0,-1),d.down=new d(0,1),d.left=new d(-1,0),d.right=new d(1,0),d.upLeft=new d(-1,-1),d.upRight=new d(1,-1),d.downLeft=new d(-1,1),d.downRight=new d(1,1),d.all=[d.up,d.down,d.left,d.right,d.upLeft,d.upRight,d.downLeft,d.downRight];const p=function(t){const e=Object(i.min)(t);if(void 0!==e)return e;throw"minUnsafe got empty array"}},function(t,e,s){"use strict";s.d(e,"g",function(){return i}),s.d(e,"c",function(){return o}),s.d(e,"a",function(){return c}),s.d(e,"d",function(){return h}),s.d(e,"b",function(){return u}),s.d(e,"k",function(){return l}),s.d(e,"e",function(){return p}),s.d(e,"f",function(){return m}),s.d(e,"j",function(){return r}),s.d(e,"i",function(){return f}),s.d(e,"h",function(){return g});var i,r,n=s(28);!function(t){t[t.Wall=0]="Wall",t[t.Door=1]="Door",t[t.Floor=2]="Floor",t[t.StairwayDown=3]="StairwayDown",t[t.StairwayUp=4]="StairwayUp",t[t.Trap=5]="Trap",t[t.Trigger=6]="Trigger"}(i||(i={}));class a{constructor(t,e){this.key=t,this.kind=e}addItem(t,e){this.items||(this.items=new n.a),this.items.put(t,e)}free(t){return this.isFloor()&&this.passibleThrough(t)}isFloor(){return this.kind===i.Floor}visibleThrough(){return!0}passibleThrough(t){return t&&this.creature?this.kind!==i.Wall&&this.creature.id===t.id:this.kind!==i.Wall&&!this.creature}clone(t=this){let e=this.buildNew();return t.creature&&(e.creature=t.creature),e.items=t.items&&t.items.clone(),e}}class o extends a{visibleThrough(){return!0}visit(t){t.onFloor(this)}buildNew(){return new o(this.key,this.kind)}}class c extends o{}class h extends o{constructor(){super("R",i.Floor)}}class u extends a{constructor(t=Math.random()>=.5){super("D",i.Door),this.open=t}visibleThrough(){return this.open}visit(t){t.onDoor(this)}buildNew(){return new u(this.open)}}class l extends a{constructor(){super("W",i.Wall)}visibleThrough(){return!1}visit(t){t.onWall(this)}buildNew(){return new l}}class d extends a{constructor(t,e,s,i){super(t,e),this.currentMap=s,this.adjacentMapName=i}enterPos(t,e){return this._enterPos?this._enterPos:this._enterPos=e.matchStairs(t.name)}visibleThrough(){return!0}}class p extends d{constructor(t,e){super(">",i.StairwayDown,t,e)}visit(t){t.onStairwayDown(this)}buildNew(){return new p(this.currentMap,this.adjacentMapName)}}class m extends d{constructor(t,e){super("<",i.StairwayUp,t,e)}visit(t){t.onStairwayUp(this)}buildNew(){return new m(this.currentMap,this.adjacentMapName)}}!function(t){t[t.AirBlow=0]="AirBlow",t[t.BareWire=1]="BareWire",t[t.FallingRock=2]="FallingRock",t[t.Hole=3]="Hole",t[t.Light=4]="Light",t[t.Teleportation=5]="Teleportation",t[t.Water=6]="Water"}(r||(r={}));class f extends a{constructor(t,e,s=!1){super("^",i.Trap),this.type=t,this.tile=e,this.revealed=s}visit(t){t.onTrap(this)}disarmTile({x:t,y:e},s,i,r){r.logger.succeededToUntrap(s),i.setTile(t,e,this.tile.clone(this))}}class g{onWall(t){this.default(t)}onFloor(t){this.default(t)}onStairwayDown(t){this.onStairway(t)}onStairwayUp(t){this.onStairway(t)}onDoor(t){this.default(t)}onTrigger(t){this.default(t)}onTrap(t){this.default(t)}onStairway(t){this.default(t)}default(t){}}},function(t,e,s){"use strict";s.d(e,"c",function(){return i}),s.d(e,"b",function(){return n}),s.d(e,"a",function(){return a});var i,r=s(0);!function(t){t[t.TalentsPicking=0]="TalentsPicking",t[t.Death=1]="Death",t[t.Idle=2]="Idle",t[t.ItemsListing=3]="ItemsListing",t[t.Missile=4]="Missile",t[t.ProfessionPicking=5]="ProfessionPicking",t[t.Look=6]="Look",t[t.Teleportation=7]="Teleportation",t[t.PickHandleOption=8]="PickHandleOption",t[t.CharacterInfo=9]="CharacterInfo"}(i||(i={}));class n{constructor(t,e){this.levelMap=t,this.game=e,this.player=this.game.player}get tile(){return this.levelMap.creatureTile(this.player)}endTurn(){this.game.player.ai.endTurn(this.game,this.levelMap)}redirect(t){this.game.player.ai.redirect(t)}goIdle(){this.redirect(new r.IdlePresenter(this.levelMap,this.game))}}class a extends n{goToBaseInfo(){this.redirect(new r.BaseInfoPresenter(this.levelMap,this.game))}goToInventory(){this.redirect(new r.EquipmentPresenter(this.levelMap,this.game))}goToHistoryInfo(){this.redirect(new r.HistoryInfoPresenter(this.levelMap,this.game))}goToTalents(){this.redirect(new r.TalentsPresenter(this.levelMap,this.game))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(2),r=s(0),n=s(31);class a{constructor(){}static withCritical(t,{chance:e,multiplier:s}){return Math.random()>e?t:t.map(({type:t,dice:{times:e,max:i},extra:r})=>({type:t,dice:{times:e,max:i*s},extra:r*s}))}static misses(t,e){return Math.random()>t/(t+Math.pow(.25*e,.8))}static lowerWeight(t,e=1){let s=0;for(let i=e;i<t;i++)this.chance(1,3)&&(s+=1);return Math.max(1,s)}static higherWeight(t,e=1){return t+e-this.lowerWeight(t,e)}static chance(t,e){return Object(i.random)(1,e)<=t}static dodges(t,e){return Math.random()<Math.atan(t/e)/Math.PI*2}static damage(t,e,s){if(t.every(({type:t,resistances:e})=>this.resistTo(t,e,s)))return{damage:0,resist:!0};return{damage:Object(i.sumBy)(t,({extra:t,dice:i,type:r,resistances:n})=>this.resistTo(r,n,s)?0:Math.floor(Math.max(0,t+this.dropDice(i)-this.protectionValue(r,e)))),resist:!1}}static resistTo(t,e,s){if(e&&Object(i.intersection)(s,e).length)return!0;switch(t){case r.DamageType.Melee:case r.DamageType.Pierce:case r.DamageType.Blunt:return Object(i.includes)(s,n.b.Intangible);case r.DamageType.Magic:return Object(i.includes)(s,n.b.MagicDamage);case r.DamageType.Pure:return!1}}static dropDice(t){return Object(i.sum)(Object(i.times)(t.times,()=>Object(i.random)(1,t.max)))}static protectionValue(t,e){return Object(i.sum)(e.map(({type:e,value:s})=>s*this.armorToDamageRatio(t,e)))}}a.armorToDamageRatio=((t,e)=>{switch(t){case r.DamageType.Melee:switch(e){case r.ProtectionType.Medium:return 2/3;case r.ProtectionType.Solid:return 4/3;default:return 1}case r.DamageType.Pierce:switch(e){case r.ProtectionType.Light:return.5;case r.ProtectionType.Medium:return 4/3;case r.ProtectionType.Solid:return 3;case r.ProtectionType.Unarmored:return.75;default:return 1}case r.DamageType.Blunt:switch(e){case r.ProtectionType.Medium:return 2;case r.ProtectionType.Solid:case r.ProtectionType.Unarmored:return.5;default:return 1}case r.DamageType.Magic:switch(e){case r.ProtectionType.Light:return 5/4;case r.ProtectionType.Medium:return.75;case r.ProtectionType.Heavy:return.5;case r.ProtectionType.Solid:return 3;default:return 1}case r.DamageType.Pure:return 0;default:throw"Got unknown type of damage!"}})},function(t,e,s){"use strict";s.d(e,"l",function(){return i}),s.d(e,"f",function(){return r}),s.d(e,"e",function(){return a}),s.d(e,"d",function(){return u}),s.d(e,"j",function(){return l}),s.d(e,"m",function(){return d}),s.d(e,"g",function(){return p}),s.d(e,"h",function(){return m}),s.d(e,"i",function(){return f}),s.d(e,"k",function(){return o}),s.d(e,"a",function(){return g}),s.d(e,"b",function(){return v}),s.d(e,"c",function(){return y});var i,r,n,a,o,c=s(11);!function(t){t[t.WeaponOneHand=0]="WeaponOneHand",t[t.WearsOnHead=1]="WearsOnHead",t[t.WearsOnBody=2]="WearsOnBody",t[t.Ring=3]="Ring",t[t.Amulet=4]="Amulet",t[t.Throw=5]="Throw",t[t.Shoot=6]="Shoot",t[t.Boots=7]="Boots",t[t.Tool=8]="Tool",t[t.Belt=9]="Belt",t[t.Gloves=10]="Gloves",t[t.Gauntlets=11]="Gauntlets",t[t.Cloak=12]="Cloak",t[t.Scroll=13]="Scroll"}(i||(i={})),function(t){t[t.BodyArmor=0]="BodyArmor",t[t.OneHandWeapon=1]="OneHandWeapon",t[t.Consumable=2]="Consumable",t[t.Missile=3]="Missile",t[t.Potion=4]="Potion",t[t.MissileWeapon=5]="MissileWeapon",t[t.Boots=6]="Boots",t[t.Scrolls=7]="Scrolls",t[t.Hat=8]="Hat"}(r||(r={})),function(t){t[t.MissileRock=0]="MissileRock",t[t.Sling=1]="Sling",t[t.Bow=2]="Bow",t[t.Arrows=3]="Arrows"}(n||(n={})),function(t){t[t.None=0]="None",t[t.Slightly=1]="Slightly",t[t.Mostly=2]="Mostly",t[t.Fully=3]="Fully"}(a||(a={}));class h{constructor(t,e,s,i,r=[],n=h.getId()){this.group=t,this.name=e,this.weight=s,this.material=i,this.usages=r,this.id=n,this.impacts=[],this.corrosionLevel=a.None}static getId(){return this.lastId++}corrode(){switch(this.corrosionLevel){case a.None:return this.corrosionLevel=a.Slightly,!0;case a.Slightly:return this.corrosionLevel=a.Mostly,!0;case a.Mostly:return this.corrosionLevel=a.Fully,!0}return!1}get affectedWithWater(){return void 0!==this.material.affectedWithWater}get firm(){return this.material.firm}get insulator(){return this.material.insulator}get canSeeDetails(){return!0}clone(){return new h(this.group,this.name,this.weight,this.material)}groupsWith(t){return this.name===t.name}worksWith(t){return!1}canThrow(t){return!0}}h.lastId=0;class u extends h{constructor(t){super(r.Consumable,`${t.name}'s corpse`,t.weight,t.material),this.specie=t}}class l extends h{constructor(t,e=c.a.glass){super(r.Potion,t,.2,e),this.name=t}}class d extends h{constructor(t,e,s,i,r,n){super(t,e,s,i,n),this.rawDamages=r}get damages(){switch(this.corrosionLevel){case a.Slightly:return this.damageWithCorrosion(1);case a.Mostly:return this.damageWithCorrosion(2);case a.Fully:return this.damageWithCorrosion(4);default:return this.rawDamages}}damageWithCorrosion(t){return this.rawDamages.map(({dice:e,type:s,extra:i})=>({dice:e,type:s,extra:i-t}))}}class p extends d{constructor(t,e,s,i){super(r.Missile,t,e,i,s,[])}}class m extends d{constructor(t,e,s,n){super(r.MissileWeapon,t,e,n,s,[i.Shoot])}}class f extends d{constructor(t,e,s,n){super(r.OneHandWeapon,t,e,s,n,[i.WeaponOneHand])}}!function(t){t[t.Light=0]="Light",t[t.Medium=1]="Medium",t[t.Heavy=2]="Heavy",t[t.Solid=3]="Solid",t[t.Unarmored=4]="Unarmored"}(o||(o={}));class g extends h{constructor(t,e,s,i,r,n){super(t,e,s,i,[n]),this.rawProtections=r}get protections(){switch(this.corrosionLevel){case a.Slightly:return this.protectionWithCorrosion(1);case a.Mostly:return this.protectionWithCorrosion(2);case a.Fully:return this.protectionWithCorrosion(4);default:return this.rawProtections}}protectionWithCorrosion(t){return this.rawProtections.map(({type:e,value:s})=>({type:e,value:s-t}))}}class v extends g{constructor(t,e,s,n){super(r.BodyArmor,t,e,s,n,i.WearsOnBody)}}class y extends g{constructor(t,e,s,n){super(r.Boots,t,e,s,n,i.Boots)}}},function(t,e,s){"use strict";var i,r;s.d(e,"b",function(){return i}),s.d(e,"a",function(){return r}),function(t){t[t.Corrosion=0]="Corrosion",t[t.Destroy=1]="Destroy"}(i||(i={})),function(t){t.cloth={affectedWithWater:void 0,firm:!1,fragile:!1,insulator:!1},t.flesh={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0},t.glass={affectedWithWater:void 0,firm:!1,fragile:!0,insulator:!1},t.iron={affectedWithWater:i.Corrosion,firm:!0,fragile:!1,insulator:!0},t.leather={affectedWithWater:void 0,firm:!1,fragile:!1,insulator:!1},t.paper={affectedWithWater:i.Destroy,firm:!1,fragile:!1,insulator:!0},t.stone={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0},t.wood={affectedWithWater:void 0,firm:!0,fragile:!1,insulator:!0}}(r||(r={}))},function(t,e,s){"use strict";s.d(e,"a",function(){return o}),s.d(e,"b",function(){return c}),s.d(e,"c",function(){return h});var i=s(6),r=s(16),n=s(14),a=s(0);class o{moveTo(t,e,s,i){return this.move(t,s,i,t=>e.eq(t))}move(t,e,s,i){const[r]=this.buildPath(t,e,i);if(r)return new n.a(s,e,r)}buildPath(t,e,s){return Object(a.leePath)(t.stageMemory(e),e.creaturePos(t),e=>e.tangible(t),s)}withinView(t,e,s){let r=Object(i.j)(t.width,t.height,()=>!1),n=[e];for(;n.length;){let e=[];n.forEach(i=>{if(!t.inRange(i))return;const n=t.at(i.x,i.y);n.visible&&!r[i.x][i.y]&&(r[i.x][i.y]=!0,s(i,n),i.wrappers().forEach(t=>e.push(t)))}),n=e}}enemies(t,e){return t.id!==e.id&&(t.clan===r.c.FreeForAll||e.clan===r.c.FreeForAll||(t.clan===r.c.Player&&e.clan===r.c.PlayerOnlyEnemy||e.clan===r.c.Player&&t.clan===r.c.PlayerOnlyEnemy))}}class c extends o{constructor(){super(...arguments),this.destination=void 0}act(t,e,s){if(!this.foundNewTarget(t,e)||!this.destination)return this.checkCurrentTile(t,e,s);const i=this.goTo(t,e,s,this.destination);if(i)return i;this.destination=void 0,this.onCantMove(t)}goTo(t,e,s,i){return this.moveTo(t,i,e,s)}checkCurrentTile(t,e,s){if(this.destination&&e.creaturePos(t).eq(this.destination))return this.destination=void 0,this.onReach(t,e,s)}onMove(t){}onReach(t,e,s){}onCantMove(t){}}class h extends c{constructor(t){super(),this.matcher=t}checkCurrentTile(t,e,s){let i=super.checkCurrentTile(t,e,s);if(i)return i;const r=e.creaturePos(t);return this.matcher(t.stageMemory(e).at(r.x,r.y))?(this.destination=void 0,this.onReach(t,e,s)):void 0}foundNewTarget(t,e){const s=Object(a.leePath)(t.stageMemory(e),e.creaturePos(t),e=>e.tangible(t),(t,e)=>this.matcher(e),!0);return!!s.length&&(this.destination=s.pop(),!0)}}},function(t,e,s){"use strict";s.d(e,"n",function(){return o}),s.d(e,"j",function(){return c}),s.d(e,"h",function(){return h}),s.d(e,"d",function(){return u}),s.d(e,"c",function(){return l}),s.d(e,"g",function(){return d}),s.d(e,"f",function(){return p}),s.d(e,"b",function(){return m}),s.d(e,"a",function(){return f}),s.d(e,"i",function(){return g}),s.d(e,"m",function(){return v}),s.d(e,"e",function(){return y}),s.d(e,"l",function(){return b}),s.d(e,"k",function(){return w}),s.d(e,"o",function(){return T});var i=s(10),r=s(2);class n{constructor(t,e,s){this.usages=t,this.useSingleItem=e,this.equipment=s,this.name="InventorySlot"}matchingItems(t){return t.cares().filter(t=>this.match(t.item))}get insulator(){return!(!this.equipment||!this.equipment.item.insulator)}get firm(){return!(!this.equipment||!this.equipment.item.firm)}equip(t,e){if(this.equipment)throw`Slot ${this.name} is already equipped with ${this.equipment.item}`;this.equipment={count:e,item:t}}takeOff(){if(!this.equipment)throw`Slot ${this.name} has nothing to take off`;this.equipment=void 0}match(t){return Object(r.intersection)(t.usages,this.usages).length>0}withPairItem(t,e){return t.filter(t=>t.item.worksWith(e))}}class a extends n{get affectedWithWater(){return void 0!==this.material.affectedWithWater}}class o extends a{constructor(t){super([i.l.WeaponOneHand],!0),this.material=t,this.name="Правая рука"}}class c extends a{constructor(t){super([i.l.WeaponOneHand],!0),this.material=t,this.name="Левая рука"}}class h extends a{constructor(t){super([i.l.WearsOnHead],!0),this.material=t,this.name="Голова"}}class u extends a{constructor(t){super([i.l.WearsOnBody],!0),this.material=t,this.name="Корпус"}}class l extends a{constructor(t){super([i.l.Boots],!0),this.material=t,this.name="Ботинки"}}class d extends n{constructor(){super([i.l.Gloves],!0),this.name="Перчатки"}}class p extends n{constructor(){super([i.l.Gauntlets],!0),this.name="Наручи"}}class m extends n{constructor(){super([i.l.Belt],!0),this.name="Пояс"}}class f extends n{constructor(){super([i.l.Amulet],!0),this.name="Амулет"}}class g extends n{constructor(){super([i.l.Ring],!0),this.name="Левый палец"}}class v extends n{constructor(){super([i.l.Ring],!0),this.name="Правый палец"}}class y extends n{constructor(){super([i.l.Cloak],!0),this.name="Плащ"}}class b extends n{constructor(){super([i.l.Shoot],!0),this.name="Метательное"}matchingItems(t){let e=super.matchingItems(t),s=t.missileSlot.equipment;return s?this.withPairItem(e,s.item):e}}class w extends n{constructor(){super([i.l.Throw],!1),this.name="Снаряды"}matchingItems(t){let e=t.cares(),s=t.missileWeaponSlot.equipment;return s?this.withPairItem(e,s.item):e}}class T extends n{constructor(){super([i.l.Tool],!0),this.name="Инструмент"}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(1),r=s(7),n=s(0);class a extends r.h{constructor(t,e,s,i){super(),this.pos=t,this.creature=e,this.levelMap=s,this.game=i,this.reaction=n.Reaction.NOTHING}onTrap(t){this.reaction=t.activate(this.pos,this.game,this.levelMap,this.creature)}onTrigger(t){t.activate(this.game,this.levelMap,this.creature)}}class o extends i.a{constructor(t,e,s,i=e){super(),this.game=t,this.levelMap=e,this.nextPoint=s,this.nextLevel=i}affectCreature(t){const e=this.levelMap.creaturePos(t);this.nextLevel.name!==this.levelMap.name?(this.levelMap.removeCreature(t),this.nextLevel.addCreature(this.nextPoint,t)):(this.levelMap.at(e.x,e.y).creature=void 0,this.levelMap.at(this.nextPoint.x,this.nextPoint.y).creature=t);const s=new a(this.nextPoint,t,this.levelMap,this.game);return this.nextLevel.at(this.nextPoint.x,this.nextPoint.y).visit(s),s.reaction}affectPlayer(t){return this.nextLevel&&this.levelMap.name!==this.nextLevel.name?(this.levelMap.reset(),this.nextLevel.enter(),this.affectCreature(t),this.game.currentMap=this.nextLevel):this.affectCreature(t),n.Reaction.NOTHING}}},function(t,e,s){"use strict";s.d(e,"b",function(){return i}),s.d(e,"a",function(){return o});var i,r=s(1),n=s(10),a=s(36);!function(t){t[t.Attack=0]="Attack",t[t.Missile=1]="Missile",t[t.Trap=2]="Trap",t[t.Overloaded=3]="Overloaded"}(i||(i={}));class o extends r.a{constructor(t,e,s){super(),this.game=t,this.levelMap=e,this.reason=s}affectCreature(t){let e=this.levelMap.creatureTile(t);return this.levelMap.removeCreature(t),t.dead=!0,t.specie.leavesCorpseRatio>Math.random()&&e.addItem(new n.d(t.specie),1),t.inventoryItems.forEach(t=>e.addItem(t.item,t.count)),r.c.DIE}affectPlayer(t){return t.ai.pushEvent(new a.a(this.reason,this.levelMap,this.game)),t.dead=!0,this.game.playerTurn=!0,r.c.DIE}}},function(t,e,s){"use strict";var i=s(2),r=s(0),n=s(35),a=s(28),o=s(34),c=s(48),h=s(7);const u=function(t,e,s,i){new c.a(t.x,t.y,e,i.width,i.height,new class extends h.h{constructor(t,e){super(),this.stage=t,this.pos=e,this.visible=!1}isSolid(t,e){return this.x=t,this.y=e,this.stage.at(t,e).visit(this),!this.visible}onDoor(t){this.default(t),this.visible=this.visible||this.pos.x===this.x&&this.pos.y===this.y}default(t){this.x&&this.y&&(this.visible=this.stage.visibleThrough(this.x,this.y))}}(i,t),(t,e,r)=>{s.at(t,e).see(i.at(t,e),r)}).calc()};var l,d,p=s(19);s.d(e,"c",function(){return l}),s.d(e,"b",function(){return d}),s.d(e,"d",function(){return m}),s.d(e,"a",function(){return f}),function(t){t[t.Player=0]="Player",t[t.PlayerOnlyEnemy=1]="PlayerOnlyEnemy",t[t.FreeForAll=2]="FreeForAll"}(l||(l={})),function(t){t[t.GoStairway=0]="GoStairway",t[t.Inventory=1]="Inventory",t[t.Throwing=2]="Throwing",t[t.KnockWeaponOut=3]="KnockWeaponOut"}(d||(d={}));class m{constructor(t,e=m.getId()){this.specie=t,this.id=e,this.stageMemories=new Map,this.dead=!1,this.health=new p.d(t)}static getId(){return this.lastId++}get name(){return this.specie.name}get clan(){return this.specie.clan}get protections(){return this.specie.protections}get throwDamages(){return this.specie.throwingDamages}get damages(){return this.specie.damages}can(t){return Object(i.includes)(this.specie.abilities,t)}on(t){return t.affectCreature(this)}get speed(){return this.specie.moveSpeed}stageMemory(t){const e=this.stageMemories.get(t.name);return e||this.visionMask(t)}visionMask(t){let e=this.stageMemories.get(t.name);return e?e.resetVisible():(e=new r.Memory(t.width,t.height),this.stageMemories.set(t.name,e)),u(t.creaturePos(this),this.visionRadius,e,t),e}get impactsBunch(){return this._impactsBunch||(this._impactsBunch=new r.ImpactBunch),this._impactsBunch}hasImpact(t){return Object(i.includes)(this.impacts,t)}addConstImpact(t,e){this.impactsBunch.addConstImpact(t,e)}addImpact(t,e){this.impactsBunch.addImpact(t,e)}removeConstImpact(t,e){this.impactsBunch.removeConstImpact(t,e)}removeImpact(t){this.impactsBunch.removeImpact(t)}get visionRadius(){return this.hasImpact(o.b.Blind)?0:this.specie.visionRadius}get bodyControl(){return this.specie.bodyControl}get impacts(){return this.impactsBunch.activeImpacts}hasResistance(t){return Object(i.includes)(this.resistances,t)}get resistances(){return this.specie.resistances}get weightWithCarryings(){return this.specie.weight}statsTurn(){this.health.turn(),this._impactsBunch&&this._impactsBunch.turn()}}m.lastId=0;class f extends m{constructor(t,e,s=m.getId()){super(e,s),this.ai=t}act(t,e){this.statsTurn(),this.visionMask(t);const s=this.ai.act(this,t,e);return s&&this.on(s),this.on(new n.a(t,e)),this.speed}get missile(){if(this.specie.throwingItem)return{item:this.specie.throwingItem,count:1}}get inventoryItems(){return this.bag?this.bag.bunch:[]}addItem(t,e){this.bag||(this.bag=new a.a),this.bag.put(t,e)}removeItem(t,e){if(!this.bag)throw`Creature ${this.name} tried to remove item ${t.name} but it does not present`;this.bag.remove(t,e)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return i}),s.d(e,"b",function(){return n});var i,r=s(8);!function(t){t[t.Base=0]="Base",t[t.Talents=1]="Talents",t[t.Equipment=2]="Equipment",t[t.History=3]="History"}(i||(i={}));class n extends r.a{constructor(t,e){super(t,e)}get type(){return r.c.CharacterInfo}get specie(){return this.game.player.specie}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(1),r=s(15),n=s(9);class a extends i.a{constructor(t,e,s,i){super(),this.damages=t,this.dieReason=e,this.levelMap=s,this.game=i}get damage(){if(this.doneDamage)return this.doneDamage;throw"HurtEvent.damage called but there is no done damage"}affectCreature(t){const{damage:e,resist:s}=n.a.damage(this.damages,t.protections,t.resistances);return this.doneDamage=e,s?i.c.RESIST:e>=t.health.currentValue?(t.on(new r.a(this.game,this.levelMap,this.dieReason)),i.c.DIE):e<=0?i.c.NOTHING:(t.health.decrease(e),i.c.HURT)}}},function(t,e,s){"use strict";s.d(e,"e",function(){return r}),s.d(e,"a",function(){return n}),s.d(e,"d",function(){return a}),s.d(e,"f",function(){return o}),s.d(e,"b",function(){return c}),s.d(e,"c",function(){return h});var i=s(49);class r{constructor(t,e=1,s=0){this.base=t,this.rate=e,this.extra=s}get current(){return this.base*this.rate-this.extra}add(t){this.base+=t}subtract(t){this.base-=t}}class n{constructor(t,e){this.strength=t,this.constitution=e,this.strengthRatio=5,this.constitutionRatio=3,this.base=10}recalculate(t,e){this.strength=t,this.constitution=e}get stressed(){return this.base+this.strength*this.strengthRatio+this.constitution*this.constitutionRatio}get loadedStart(){return 1.5*this.stressed}get overloadedStart(){return 2*this.loadedStart}get flattenedStart(){return 3*this.overloadedStart}}class a extends i.a{constructor(t,e=0,s=t.maxHealthValue){super(t.maxHealthValue,s),this.currentTurn=e,this.regenerationRate=t.regenerationRate,this.regenerationValue=t.regenerationValue}turn(){this.currentTurn+=1,this.currentTurn>=this.regenerationRate&&(this.currentTurn=0,this.increase(this.regenerationValue))}}class o extends r{get meleeAdjustment(){return this.current<5?-2:this.current>10?Math.floor((this.current-10)/2):0}}class c extends r{get levelUpHPBonus(){return this.current<3?-2:this.current<6?-1:this.current<12?0:this.current<15?1:this.current<18?2:this.current<20?3:4}}class h extends r{get bodyControlAdjustment(){return this.current<5?-2:this.current>10?Math.floor(.9*(this.current-10)):0}get missileAdjustment(){return this.current<5?-2:this.current>10?Math.floor((this.current-10)/2):0}}},,function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e){super(),this.levelMap=t,this.game=e}playerSees(t){let{x:e,y:s}=this.levelMap.creaturePos(t);return this.game.player.stageMemory(this.levelMap).at(e,s).visible}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t){super(),this.levelMap=t}affectCreature(t){let e=t.stageMemory(this.levelMap);return this.levelMap.creaturePos(t).wrappers().forEach(({x:t,y:s})=>{e.at(t,s).see(this.levelMap.at(t,s),0)}),i.c.NOTHING}}},function(t,e,s){"use strict";var i;s.d(e,"a",function(){return i}),function(t){t[t.Melee=0]="Melee",t[t.Pierce=1]="Pierce",t[t.Blunt=2]="Blunt",t[t.Magic=3]="Magic",t[t.Pure=4]="Pure"}(i||(i={}))},function(t,e,s){"use strict";s.d(e,"b",function(){return n}),s.d(e,"a",function(){return a});var i=s(8);class r extends i.b{constructor(t,e){super(t,e),this.positions=[],this.initPositions()}get type(){return i.c.ItemsListing}close(){this.goIdle()}}class n extends r{get singleItemMode(){return!0}}class a extends r{get singleItemMode(){return!1}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a}),s.d(e,"b",function(){return o}),s.d(e,"c",function(){return c});var i,r=s(0),n=s(45);!function(t){t[t.Attacker=0]="Attacker",t[t.Defender=1]="Defender"}(i||(i={}));class a extends r.Profession{constructor(t=0,e=new n.a("strongGrip",1,0,5)){super(i.Attacker,"warrior",t,0,[e]),this.strongGrip=e}get depthCost(){return 5}get grid(){return[[void 0,this.strongGrip,void 0]]}}class o extends r.Profession{constructor(t=0,e=new n.b("steelSkin",0,0,5)){super(i.Defender,"defender",t,0,[e]),this.steelSkin=e}get depthCost(){return 5}get grid(){return[[this.steelSkin]]}}class c extends r.ProfessionPicker{constructor(t=new a,e=new o){super([t,e],3,6),this.attacker=t,this.defender=e}}},,function(t,e,s){"use strict";s.d(e,"a",function(){return r}),s.d(e,"b",function(){return n}),s.d(e,"c",function(){return a});var i=s(12);class r{constructor(t){this.game=t,this.player=t.player,this.logger=t.logger}}class n extends r{constructor(t,e){super(e),this.items=t}run(){}}class a extends i.a{constructor(t){super(),this.aiToRun=t,this.events=[]}pushEvent(t){this.events.push(t)}resetEvents(){this.events=[]}runEvents(){let t=!1;return this.events.forEach(e=>{t=!0,e.run()}),this.resetEvents(),t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);class r{constructor(){this.bunch=[]}find(t){return this.bunch.find(e=>e.item.groupsWith(t))}remove(t,e){const s=this.find(t);void 0!==s&&(s.count===e?Object(i.remove)(this.bunch,t=>t.item.groupsWith(s.item)):s.count-=e)}put(t,e){const s=this.bunch.find(e=>e.item.groupsWith(t));s?s.count+=e:this.bunch.push({count:e,item:t})}clone(){let t=new r;return this.bunch.forEach(e=>{t.put(e.item,e.count)}),t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(1),r=s(39);class n extends i.a{constructor(t,e,s){super(),this.slot=t,this.count=e,this.game=s}affectCreature(t){return i.c.NOTHING}affectPlayer(t){if(!this.slot.equipment)throw`RemoveItemEvent: ${this.slot.name} has no equipment`;return this.slot.equipment.count===this.count?t.on(new r.a(this.slot,this.game)):(this.slot.equipment.count-=this.count,i.c.NOTHING)}}},function(t,e,s){"use strict";s.d(e,"b",function(){return n}),s.d(e,"a",function(){return a}),s.d(e,"c",function(){return o}),s.d(e,"f",function(){return c}),s.d(e,"d",function(){return h}),s.d(e,"e",function(){return u});var i=s(6),r=s(2);const n=function(t,e,s=(()=>!0)){for(let i=1;i<t.height-1;i++)for(let r=1;r<t.width-1;r++){const n=t.at(r,i),a=t.at(r,i-1),o=t.at(r,i+1),c=t.at(r-1,i),h=t.at(r+1,i);s()&&"C"===n.key&&("D"!==c.key&&"D"!==h.key&&"D"!==a.key&&"D"!==o.key&&("R"!==c.key&&"R"!==h.key&&"R"!==a.key&&"R"!==o.key||("W"===c.key&&"W"===h.key||"W"===a.key&&"W"===o.key)&&t.setTile(r,i,e())))}return t},a=function(t,e,s){for(let r=1;r<e.width-1;r++)for(let n=1;n<e.height-1;n++)e.at(r,n).passibleThrough()&&Math.random()<t&&e.addCreature(new i.c(r,n),s.pick(null));return e},o=function(t){let e=t.width,s=t.height,r=0,n=0;for(let i=1;i<t.height-1;i++)for(let a=1;a<t.width-1;a++)t.at(a,i).passibleThrough()&&(n=Math.max(i,n),r=Math.max(a,r),s=Math.min(i,s),e=Math.min(a,e));const a=Math.floor((t.width-(r-e))/2)-e,o=Math.floor((t.height-(n-s))/2)-s;return Object(i.g)(t.map,a),t.map.forEach(t=>Object(i.g)(t,o)),t},c=function(t,e,s){let i=t.width*t.height;for(;i>0;){const n=Object(r.random)(0,t.width-1),a=Object(r.random)(0,t.height-1);if(e(t.at(n,a)))return s(n,a),t;i--}throw"post add failed to add tile"},h=function(t,e){let s=t.width*t.height;for(;s>0;){const i=Object(r.random)(0,t.width-1),n=Object(r.random)(0,t.height-1),a=t.at(i,n);if(e(a))return{tile:a,x:i,y:n};s--}},u=function(t,e,s){t.each((t,i,r)=>{e(t)&&s(t,i,r)})}},function(t,e,s){"use strict";var i,r;s.d(e,"b",function(){return i}),s.d(e,"a",function(){return r}),function(t){t[t.Intangible=0]="Intangible",t[t.MagicDamage=1]="MagicDamage",t[t.TeleportationControl=2]="TeleportationControl",t[t.Insulator=3]="Insulator"}(i||(i={})),function(t){t.Maroon="maroon",t.Red="red",t.Orange="orange",t.Yellow="yellow",t.Olive="olive",t.Green="green",t.Purple="purple",t.Fuchsia="fuchsia",t.Lime="lime",t.Teal="teal",t.Aqua="aqua",t.Blue="blue",t.Navy="navy",t.Black="black",t.Gray="gray",t.Silver="silver",t.White="white"}(r||(r={}))},function(t,e,s){"use strict";s.d(e,"c",function(){return i}),s.d(e,"b",function(){return r}),s.d(e,"a",function(){return n});const i={name:"human",primaryAttributes:{strength:8,dexterity:8,constitution:7,intelligence:7,wisdom:6,charisma:9},experienceRatio:.9},r={name:"human",primaryAttributes:{strength:10,dexterity:7,constitution:9,intelligence:5,wisdom:7,charisma:7},experienceRatio:1},n=[i,r]},,function(t,e,s){"use strict";s.d(e,"b",function(){return i}),s.d(e,"a",function(){return a});var i,r=s(2);!function(t){t[t.Blind=0]="Blind",t[t.Stressed=1]="Stressed",t[t.Loaded=2]="Loaded",t[t.Overloaded=3]="Overloaded"}(i||(i={}));class n{constructor(){this.constEffects=[],this.tempEffects=0}addTempEffect(t){this.tempEffects+=t}addConstEffect(t){this.constEffects.push(t)}removeTempEffect(){this.tempEffects=0}removeConstEffect(t){Object(r.remove)(this.constEffects,e=>e===t)}active(){return this.tempEffects>0||this.constEffects.length>0}turn(){this.tempEffects>=1&&(this.tempEffects-=1)}}class a{constructor(){this.impacts=new Map}get activeImpacts(){let t=[];return this.impacts.forEach((e,s)=>{e.active()&&t.push(s)}),t}addImpact(t,e){this.impactByType(t).addTempEffect(e)}removeImpact(t){this.impactByType(t).removeTempEffect()}addConstImpact(t,e){this.impactByType(t).addConstEffect(e)}removeConstImpact(t,e){this.impactByType(t).removeConstEffect(e)}turn(){this.impacts.forEach(t=>t.turn())}impactByType(t){let e=this.impacts.get(t);return void 0!==e?e:(e=new n,this.impacts.set(t,e),e)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(0),r=s(1);class n extends r.a{constructor(t,e){super(),this.levelMap=t,this.game=e}affectCreature(t){return r.c.NOTHING}affectPlayer(t){return t.removeConstImpact(i.ImpactType.Overloaded,"bag"),t.removeConstImpact(i.ImpactType.Stressed,"bag"),t.removeConstImpact(i.ImpactType.Loaded,"bag"),t.stuffWeight.current>t.carryingCapacity.flattenedStart?t.on(new i.DieEvent(this.game,this.levelMap,i.DieReason.Overloaded)):(t.stuffWeight.current>t.carryingCapacity.overloadedStart?t.addConstImpact(i.ImpactType.Overloaded,"bag"):t.stuffWeight.current>t.carryingCapacity.loadedStart?t.addConstImpact(i.ImpactType.Loaded,"bag"):t.stuffWeight.current>t.carryingCapacity.stressed&&t.addConstImpact(i.ImpactType.Stressed,"bag"),r.c.NOTHING)}}},function(t,e,s){"use strict";s.d(e,"b",function(){return a}),s.d(e,"a",function(){return o}),s.d(e,"c",function(){return c}),s.d(e,"d",function(){return h}),s.d(e,"e",function(){return u});var i=s(0),r=s(51),n=s(27);class a extends n.a{constructor(t,e,s){super(s),this.level=t,this.levelMap=e}run(){this.level%5==0?this.game.player.ai.presenter=new i.ProfessionPickingPresenter(this.level,this.levelMap,this.game):this.game.player.ai.presenter=new i.TalentsPickingPresenter(this.level,this.levelMap,this.game)}}class o extends n.a{constructor(t,e,s){super(s),this.dieReason=t,this.levelMap=e}run(){this.game.player.rebuildVision(this.levelMap),this.game.playerTurn=!0,this.game.player.ai.presenter=new r.a(this.dieReason,this.levelMap,this.game)}}class c extends n.a{constructor(t,e){super(e),this.levelMap=t}run(){this.game.player.rebuildVision(this.levelMap),this.game.playerTurn=!0,this.game.player.ai.presenter=new i.TeleportationPresenter(this.levelMap,this.game)}}class h extends n.c{constructor(){super(...arguments),this.presenter=null,this.levelUps=0}act(t,e,s){this.presenter=new i.IdlePresenter(e,s),s.playerTurn=!0}endTurn(t,e){let s=this.events.pop();if(s)s.run();else if(t&&e){t.player.on(new i.AfterEvent(e,t));let s=this.events.pop();s?s.run():(t.player.ai.runEvents(),t.playerTurn=!1,this.presenter=null)}}redirect(t){this.presenter=t}}class u extends h{constructor(t){super(),this.ai=t}act(t,e,s){let i=this.ai.act(t,e,s);return s.playerTurn=!0,i}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(1),r=s(0);class n extends i.b{constructor(t,e,s){super(),this.actor=t,this.levelMap=e,this.game=s}affectPlayer(t){return t.level.add(1).forEach(e=>{t.ai.pushEvent(new r.AINewLevelEvent(e,this.levelMap,this.game))}),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e,s,i){super(),this.impactType=t,this.source=e,this.game=s,this.duration=i}affectCreature(t){return this.duration?t.addImpact(this.impactType,this.duration):t.addConstImpact(this.impactType,this.source),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(0),r=s(2);class n extends i.CreatureEvent{constructor(t,e){super(),this.slot=t,this.game=e}affectCreature(t){return i.Reaction.NOTHING}affectPlayer(t){const e=this.slot.equipment;if(void 0===e)throw`Can not take off item from ${this.slot.name} - nothing equipped`;return this.slot.takeOff(),this.onTakeOff(t,e.item),t.inventory.putToBag(e.item,e.count),this.game.logger.takeOff(e.item),i.Reaction.NOTHING}onTakeOff(t,e){e instanceof i.Armor&&e.protections.forEach(e=>{t.itemsProtections.splice(Object(r.findIndex)(t.itemsProtections,t=>t===e),1)}),e.impacts.forEach(s=>{t.on(new i.RemoveImpactEvent(s,this.game,e.name))})}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(21),r=s(9),n=s(1);class a extends i.a{constructor(t,e,s,i,r){super(e,s),this.trap=t,this.onCreatureDodge=i,this.onCreatureActivated=r,this.dodgeRatio=t.dodgeRatio}affectCreature(t){const e=this.playerSees(t);return e&&(this.trap.revealed=!0),this.dodges(t)?(this.onCreatureDodge(e,!1),n.c.DODGE):this.onCreatureActivated(e,!1)}affectPlayer(t){return this.trap.revealed=!0,this.dodges(t)?(this.onCreatureDodge(!0,!0),n.c.DODGE):this.onCreatureActivated(!0,!0)}dodges(t){return r.a.dodges(t.bodyControl,this.dodgeRatio)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(0),r=s(93),n=s(17);class a extends n.b{constructor(t,e){super(t,e),this.positions=[],this.takeTime=!1,this.rebuildPositions()}get page(){return n.a.Equipment}takeOff(t){this.player.on(new i.TakeOffItemEvent(t.inventorySlot,this.game)),this.takeTime=!0,this.rebuildPositions()}putOn(t){this.redirect(new i.PutOnItemsPresenter(e=>{this.player.on(new i.PutOnItemEvent(t.inventorySlot,e.item,this.game)),this.takeTime=!0,this.rebuildPositions(),this.redirect(this)},t.availableItems,this.levelMap,this.game))}close(){this.takeTime?this.endTurn():this.redirect(new r.a(this.levelMap,this.game))}rebuildPositions(){this.positions=this.player.inventory.slots().map(t=>({inventorySlot:t,item:t.equipment&&t.equipment.item,count:t.equipment&&t.equipment.count,availableItems:t.matchingItems(this.player.inventory)}))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(8);class r extends i.b{constructor(t,e,s,i){super(t,e),this.effect=s,this.match=i,this.memory=this.player.stageMemory(this.levelMap),this.targetPos=t.creaturePos(this.player),this.drawTarget()}act(){this.removeEffect(),this.close()}get memoryTile(){return this.memory.at(this.targetPos.x,this.targetPos.y)}moveTarget(t){const e=this.targetPos.add(t);this.match(e)&&this.updateTarget(e)}removeEffect(){this.memory.at(this.targetPos.x,this.targetPos.y).effect=void 0}updateTarget(t){this.removeEffect(),this.targetPos=t.copy(),this.drawTarget()}drawTarget(){this.memoryTile.effect=this.effect}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(0);class r extends i.MetaAI{constructor(){super(),this.escaper=new i.Escaper,this.explorer=new i.Explorer,this.chaser=new i.Chaser,this.attacker=new i.Attacker,this.picker=new i.Picker,this.patrol=new i.Patrol,this.loiter=new i.Loiter,this.thrower=new i.Thrower,this.descender=new i.Descender}act(t,e,s){let r;return this.runEvents(),this.feelsGood(t)?(r=this.attacker.act(t,e,s))||(r=this.thrower.act(t,e,s))||(r=this.chaser.act(t,e,s))||(r=this.picker.act(t,e,s))||(r=this.explore(t,e,s)):this.healthCritical(t)&&(r=this.escaper.act(t,e,s))||(r=this.attacker.act(t,e,s))||(r=this.thrower.act(t,e,s))||(r=this.chaser.act(t,e,s))||(r=(new i.SelfHealer).act(t,e)),this.resetEvents(),r}feelsGood(t){return t.health.currentValue>.9*t.health.maximum}healthCritical(t){return t.health.currentValue<t.health.maximum/4}explore(t,e,s){let i;return(i=this.explorer.act(t,e,s))?t.dead||this.patrol.trackMovement(e.creaturePos(t),e.creatureTile(t)):(i=this.descender.act(t,e,s))||(i=this.patrol.act(t,e,s))||(i=this.loiter.act(t,e,s)),i}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);class r{constructor(){this.step=0,this.turns={}}add(t,e){const s=this.step+e;this.turns[s]?Object(i.includes)(this.turns[s],t)||this.turns[s].push(t):this.turns[s]=[t]}remove(t){Object(i.forEach)(this.turns,(e,s)=>{Object(i.remove)(e,e=>e===t)}),this.turns=Object(i.pickBy)(this.turns,t=>t.length>0)}next(){this.step=this.nextStep();const[t]=Object(i.pullAt)(this.turns[this.step],0);return 0===this.turns[this.step].length&&delete this.turns[this.step],void 0===t?this.next():t}actors(){if(0===Object(i.size)(this.turns))return[];this.step=this.nextStep();const t=this.turns[this.step];return delete this.turns[this.step],t}nextStep(){let t=Object(i.min)(Object(i.keys)(this.turns).map(t=>parseInt(t)));if(void 0===t)throw"Timeline.nextStep called when there is no ones turn";return t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n}),s.d(e,"b",function(){return a});var i=s(0);class r extends i.Talent{constructor(t,e,s,i){super(t,e,s,i)}}class n extends r{onObtain(t){}}class a extends r{onObtain(t){}}},,function(t,e,s){},function(t,e,s){"use strict";s.d(e,"a",function(){return i});class i{constructor(t,e,s,i,r,n,a){this.startx=t,this.starty=e,this.radius=s,this.width=i,this.height=r,this.solidChecker=n,this.markVisible=a,this.doubleRadius=this.radius*this.radius}calc(){this.markVisible(this.startx,this.starty,1),this.solidChecker.isSolid(this.startx,this.starty)||[[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([t,e])=>{this.castLight(1,1,0,0,t,e,0),this.castLight(1,1,0,t,0,0,e)})}castLight(t,e,s,i,r,n,a){if(e<s)return;let o=0,c=!1;for(let h=t;h<=this.radius&&!c;h++){let t=-h;for(let u=-h;u<=0;u++){let l=Math.round(this.startx+u*i+t*r),d=Math.round(this.starty+u*n+t*a),p=(u-.5)/(t+.5),m=(u+.5)/(t-.5);if(l>=0&&d>=0&&l<this.width&&d<this.height&&!(e<m)){if(s>p)break;this.doubleDistance(u,t)<=this.doubleRadius&&this.markVisible(l,d,1-this.doubleDistance(u,t)/this.doubleRadius),c?this.solidChecker.isSolid(l,d)?o=m:(c=!1,e=o):this.solidChecker.isSolid(l,d)&&h<this.radius&&(c=!0,this.castLight(h+1,e,p,i,r,n,a),o=m)}}}}doubleDistance(t,e){return t*t+e*e}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);class r{constructor(t,e=t){this.max=t,this.current=e,this.modifiers=[]}get maximum(){return this.max}get atMax(){return this.max===this.current}decrease(t){this.current-=t}increase(t){this.current=Math.min(this.current+t,this.max)}constantIncrease(t){this.max+=t,this.increase(t)}constantDecrease(t){this.max-=t,this.decrease(t)}addModifier(t){this.modifiers.push(t)}removeModifier(t){Object(i.remove)(this.modifiers,e=>e===t)}get currentValue(){return this.current+Object(i.sum)(this.modifiers)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(12);class r extends i.a{act(t,e,s){const i=e.creaturePos(t);return this.move(t,e,s,t=>!i.eq(t))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(8);class r extends i.b{constructor(t,e,s){super(e,s),this.dieReason=t}get type(){return i.c.Death}get playerName(){return this.game.player.name}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e,s){super(),this.tile=t,this.items=e,this.game=s}affectCreature(t){return this.items.forEach(({item:e,count:s})=>{t.removeItem(e,s)}),i.c.NOTHING}affectPlayer(t){return this.items.forEach(({item:e,count:s})=>{t.removeItem(e,s),t.stuffWeight.subtract(e.weight*s),this.game.logger.droppedItem(e,s),this.tile.addItem(e,s)}),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.b{affectPlayer(t){return this.updateHealth(t),i.c.NOTHING}updateHealth(t){t.health.constantIncrease(t.constitution.levelUpHPBonus),t.health.maximum<1&&t.health.constantIncrease(1-t.health.maximum)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});class i{constructor(t){this.onDone=t}speed(){return-1}}class r extends i{constructor(t,e,s){super(s),this.item=t,this.frames=e}patchMemory(t){if(this.done())return;const[e]=this.frames.splice(0,1),s=t.at(e.x,e.y);s.visible?s.effect="-":this.patchMemory(t)}done(){return 0===this.frames.length}}},function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s(0),r=s(9),n=s(37),a=s(15),o=s(1);class c extends o.a{constructor(t,e,s,i){super(),this.victim=t,this.missile=e,this.levelMap=s,this.game=i}affectCreature(t){return this.process(t,!1)}affectPlayer(t){const e=this.process(t,!0);return e===o.c.DIE&&t.on(new n.a(this.victim,this.levelMap,this.game)),e}process(t,e){const[s,i]=this.throw(t);return this.game.logger.attackLogger.missile(i,t,this.victim,s,this.missile,e),s}throw(t){if(r.a.misses(t.bodyControl,this.victim.bodyControl))return[o.c.DODGE,0];const e=new i.HurtEvent(r.a.withCritical(t.throwDamages,t.specie.critical),a.b.Missile,this.levelMap,this.game);return[this.victim.on(e),e.damage]}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(1),r=s(21);class n extends r.a{constructor(t,e,s){super(e,s),this.door=t}affectCreature(t){return this.door.open?this.game.logger.doorLogger.alreadyOpen():(this.door.open=!0,this.game.logger.doorLogger.open()),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(1),r=s(58);class n extends i.b{constructor(t,e){super(),this.profession=t,this.talent=e}affectPlayer(t){if(this.talent.status(this.profession)!==r.d.Available)throw`Talent ${this.talent.name} for profession ${this.profession.name} can not be upgraded`;return this.talent.upgrade(t),this.profession.points+=1,i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"d",function(){return i}),s.d(e,"c",function(){return n}),s.d(e,"a",function(){return a}),s.d(e,"b",function(){return o});var i,r=s(2);!function(t){t[t.Available=0]="Available",t[t.Completed=1]="Completed",t[t.Unavailable=2]="Unavailable"}(i||(i={}));class n{constructor(t,e,s,i){this.name=t,this.depth=e,this.rank=s,this.maxRank=i}upgrade(t){this.rank+=1,this.onObtain(t)}status(t){return this.rank===this.maxRank?i.Completed:this.depth*t.depthCost>t.points?i.Unavailable:i.Available}}class a{constructor(t,e,s=1,i=0,r){this.id=t,this.name=e,this.level=s,this.points=i,this.talents=r}}class o{constructor(t,e,s){this.pool=t,this.maxLevel=e,this.maxTaken=s}available(t){let e,s=[];return this.canUpdate(t)?e=this.updatableProfession(t):this.canTakeNewProfession(t)&&(e=this.newFromPool(t)),void 0!==e&&s.push(e),this.canTakeNewProfession(t)?e=this.newFromPool(t,e&&e.id):this.canUpdate(t)&&(e=this.updatableProfession(t,e&&e.id)),void 0!==e&&s.push(e),s}canUpdate(t){return t.professions.some(t=>t.level<this.maxLevel)}updatableProfession(t,e){return Object(r.sample)(t.professions.filter(t=>e!==t.id))}canTakeNewProfession(t){return t.professions.length<this.maxTaken&&this.pool.length>t.professions.length}newFromPool(t,e){const s=t.professions.map(t=>t.id);return void 0!==e&&s.push(e),Object(r.sample)(this.pool.filter(t=>!Object(r.includes)(s,t.id)))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return h});var i=s(9),r=s(11),n=s(15),a=s(18),o=s(1),c=s(29);class h extends o.a{constructor(t,e,s){super(),this.damages=t,this.levelMap=e,this.game=s,this.playerReaction=o.c.NOTHING}affectCreature(t){return t.specie.material.affectedWithWater?t.on(new a.a(this.damages,n.b.Trap,this.levelMap,this.game)):o.c.RESIST}affectPlayer(t){return this.affectBodyParts(t),this.affectInventory(t),this.affectEquipment(t),this.playerReaction}affectEquipment(t){t.dead||t.inventory.slots().forEach(e=>{if(e.equipment&&e.equipment.item.affectedWithWater){const{item:s,count:n}=e.equipment;switch(s.material.affectedWithWater){case r.b.Corrosion:i.a.chance(1,3)&&s.corrode()&&this.game.logger.itemCorrode(s);break;case r.b.Destroy:if(i.a.chance(1,4)){const r=i.a.lowerWeight(n);this.game.logger.itemDestroyByWater(s,r),t.on(new c.a(e,r,this.game))}}}})}affectInventory(t){t.dead||t.inventory.cares().forEach(({count:e,item:s})=>{switch(s.material.affectedWithWater){case r.b.Corrosion:i.a.chance(1,4)&&s.corrode()&&this.game.logger.itemCorrode(s);break;case r.b.Destroy:if(i.a.chance(1,6)){const r=i.a.lowerWeight(e);this.game.logger.itemDestroyByWater(s,r),t.inventory.removeFromBag(s,r)}}})}affectBodyParts(t){t.inventory.bodyParts.forEach(e=>{if(!t.dead&&e.affectedWithWater)if(e.equipment)this.game.logger.waterBodyPartEquipmentResist(e,e.equipment.item),this.trackReaction(o.c.RESIST);else{let s=t.on(new a.a(this.damages,n.b.Trap,this.levelMap,this.game));this.game.logger.waterBodyPartDamage(e,s),this.trackReaction(s)}})}trackReaction(t){this.playerReaction===o.c.HURT&&t===o.c.DIE?this.playerReaction=o.c.DIE:this.playerReaction===o.c.HURT?this.playerReaction=o.c.HURT:this.playerReaction=t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(6),r=s(44),n=s(7),a=s(2);class o extends i.b{constructor(t,e){super(e),this.name=t,this.creatures=[],this.timeline=new r.a}reset(){this.timeline=new r.a}enter(){this.reset(),this.creatures.forEach(t=>this.timeline.add(t.id,t.speed))}creatureTile(t){let e;if(this.each(s=>{s.creature&&s.creature.id===t.id&&(e=s)}),!e)throw`Creature ${t.id} ${t.name} is not found on map ${this.name}`;return e}creaturePos(t){let e;if(this.each((s,r,n)=>{s.creature&&s.creature.id===t.id&&(e=new i.c(r,n))}),!e)throw`Creature ${t.id} ${t.name} is not found on map ${this.name}`;return e}addCreature(t,e){this.creatures.push(e),this.at(t.x,t.y).creature=e,this.timeline.add(e.id,e.speed)}removeCreature(t){let e=this.creaturePos(t);this.at(e.x,e.y).creature=void 0,Object(a.remove)(this.creatures,e=>e.id===t.id),this.timeline.remove(t.id)}visibleThrough(t,e){return this.map[t][e].visibleThrough()}passibleThrough(t,e){return this.map[t][e].passibleThrough()}setTile(t,e,s){this.map[t][e]=s}matchStairs(t){let e;if(this.each((s,r,a)=>{(s instanceof n.e||s instanceof n.f)&&s.adjacentMapName===t&&(e=new i.c(r,a))}),e)return e;throw`LevelMap ${this.name} failed to find stairs to ${t}`}}},function(t,e,s){"use strict";s.d(e,"a",function(){return i}),s.d(e,"b",function(){return o});var i,r=s(10),n=s(2),a=s(0);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.DANGER=3]="DANGER"}(i||(i={}));class o{constructor(t){this.messages=[],this.attackLogger=new m(this,t),this.doorLogger=new p(this,t),this.trapAirBlow=new h(this,t),this.trapBareWire=new l(this,t),this.trapFallingRock=new d(this,t),this.trapHole=new u(this,t)}reset(){this.messages=[]}killMessage(t,e,s,i){this.warning(`${i.name} got ${e} damage from ${s.name} causes them to die`)}throwKillMessage(t,e,s,i,r){this.warning(`${i.name} got ${e} damage from ${s.name} by ${r.name} causes them to die`)}ranIntoAnObstacle(){this.addMessage(i.DEBUG,"You ran into a wall")}howToHandle(){this.addMessage(i.DEBUG,"Don't know how to handle it")}noItemsToPickUp(){this.addMessage(i.DEBUG,"You don't see anything to pick up")}takeOff(t){this.addMessage(i.DEBUG,`You took off ${t.name}`)}putOn(t){this.addMessage(i.DEBUG,`You put on ${t.name}`)}drink(t){this.addMessage(i.INFO,`You drunk ${t.name}`)}nothingToShotWith(){this.addMessage(i.DEBUG,"You have nothing to shoot with")}needMissileWeapon(){this.addMessage(i.DEBUG,"Мне нужен лук или типа того")}creatureTeleported(t){this.addMessage(i.INFO,`${t.name} иcчез`)}creatureNotTeleported(t){this.addMessage(i.INFO,`${t.name} озарился светом, но ничего не произошло`)}creatureDodgesTeleportationTrap(t){this.addMessage(i.INFO,`${t.name} попал в ловушку телепортации но смог увернуться`)}playerTeleportationCaused(){this.addMessage(i.INFO,"Что-то заставило меня телепортироваться")}playerTeleported(){this.addMessage(i.INFO,"Яркая вспышка и я оказался в другом месте")}playerNotTeleported(){this.addMessage(i.INFO,"Я озарился ярким светом, но ничего не произошло")}playerTeleportedWhereTheyWere(){this.addMessage(i.INFO,"Я решил никуда не телепортироваться")}playerDodgesTeleportationTrap(){this.addMessage(i.INFO,"Я попал в ловушку телепортации но смог увернуться")}lightTrapActivated(t,e,s,r){s?this.addMessage(i.INFO,"Яркая вспышка света ослепила меня"):this.addMessage(i.INFO,`${r.name} озарился яркой вспышкой света`)}lightTrapDodge(t,e,s,r){s?this.addMessage(i.INFO,"Вспышка света чуть не ослепила меня"):this.addMessage(i.INFO,`${r.name} озарился яркой вспышкой света`)}canNotUntrap(){this.addMessage(i.INFO,"Не представляю, как это обезвредить")}failedToUntrap(t){this.addMessage(i.WARNING,"У меня не получилось обезвредить ловушку")}succeededToUntrap(t){this.addMessage(i.INFO,"Успешно обезвредил ловушку")}pickedUpItem(t,e){1===e?this.addMessage(i.INFO,`You picked up ${t.name}`):this.addMessage(i.INFO,`You picked up ${e} ${t.name}`)}droppedItem(t,e){1===e?this.addMessage(i.INFO,`You dropped a ${t.name}`):this.addMessage(i.INFO,`You dropped ${e} ${t.name}`)}waterTrapActivated(){this.info("Я попал в ловушку с водой")}waterBodyPartEquipmentResist(t,e){this.debug(`${e.name} защитил ${t.name} от воды`)}waterBodyPartDamage(t,e){switch(e){case a.Reaction.DIE:this.danger(`Вода попала мне на ${t.name}, рана не совместима с жизнью`);break;case a.Reaction.HURT:this.danger(`Вода обожгла мне ${t.name}`);break;case a.Reaction.NOTHING:case a.Reaction.RESIST:this.danger(`Вода попала мне на ${t.name}, но все обошлось`)}}waterTrapDamage(t,e,s,i,r){if(e)switch(i){case a.Reaction.DIE:this.danger(`${r.name} растворился в потоках воды`);break;case a.Reaction.DODGE:this.info(`${r.name} уклонился от потока воды`);break;case a.Reaction.HURT:this.warning(`${r.name} пострадал от воды`);break;case a.Reaction.NOTHING:case a.Reaction.RESIST:s||this.debug(`${r.name} был облит водой`)}}itemCorrode(t){switch(t.corrosionLevel){case r.e.Slightly:return this.info(`${t.name} немного заржавел`);case r.e.Mostly:return this.info(`${t.name} значительно проржавел`);case r.e.Fully:return this.warning(`${t.name} полностью проржавел`)}}itemDestroyByWater(t,e){this.warning(`${e} ${t.name} были уничтожены водой`)}debug(t){this.addMessage(i.DEBUG,t)}info(t){this.addMessage(i.INFO,t)}warning(t){this.addMessage(i.WARNING,t)}danger(t){this.addMessage(i.DANGER,t)}addMessage(t,e){const s=Object(n.last)(this.messages);s&&s.message===e?s.counter+=1:this.messages.push({level:t,message:e,counter:1})}}class c{constructor(t,e){this.logger=t,this.player=e}debug(t){this.logger.debug(t)}info(t){this.logger.info(t)}warning(t){this.logger.warning(t)}danger(t){this.logger.danger(t)}}class h extends c{dodge(t,e,s){e?this.info("Я увернулся от потока воздуха"):t&&this.info(`${s.name} увернулся от потока воздуха`)}resist(t,e,s){e?this.debug("Поток воздуха чуть не снес меня"):t&&this.debug(`${s.name} попал в поток воздуха`)}activate(t,e,s){e?this.info("Меня снесло потоком воздуха"):t&&this.info(`${s.name} снесло потоком воздуха`)}handBlow(t){this.warning(`Поток воздуха выбил ${t.name} у меня из руки`)}headBlow(t){this.warning(`Поток воздуха снял ${t.name} с моей головы`)}}class u extends c{dodge(t,e,s){e?this.warning("Я чуть не упал в яму"):t&&this.warning(`${s.name} чуть не упал в яму`)}activated(t,e,s){e?this.warning("Я упал в яму"):t&&this.warning(`${s.name} упал в яму`)}shallowActivated(t,e,s){e?this.warning("Я упал в неглубокую яму"):t&&this.warning(`${s.name} упал в неглубокую яму`)}}class l extends c{activated(t,e,s){this.info(`${s.name} наступил на оголенный провод`)}doNotWant(){this.info("Трогать оголенный провод руками так себе затея")}resist(){this.info("Я наступил на оголенный провод, но все обошлось")}}class d extends c{resist(t){return this.info("Камень упал мне на голову, но каска защитила меня")}ranOut(){return this.debug("Громкий щелчок, но ничего не произошло")}dodge(t,e,s,i){this.info(`${i.name} увернулся от ловушки`)}activate(t,e,s,i,r){this.info(`${r.name} попал в ловушку`)}}class p extends c{alreadyOpen(){this.debug("Door is already open")}alreadyClosed(){this.debug("Door is already closed")}open(){this.debug("I opened the door")}close(){this.debug("I closed the door")}}class m extends c{melee(t,e,s,i,r){switch(i){case a.Reaction.HURT:return this.debug(`${s.name} got ${t} damage from ${e.name}`);case a.Reaction.DIE:return this.warning(`${s.name} got ${t} damage from ${e.name} causes them to die`);case a.Reaction.NOTHING:return this.debug(`Удар пришелся по ${e.name} но остался незамеченным`);case a.Reaction.RESIST:return this.info(`${s.name} игнорирует урон`);case a.Reaction.DODGE:return this.debug(`${e.name} misses ${s.name}!`)}}missile(t,e,s,i,r,n){switch(i){case a.Reaction.HURT:return this.debug(`${s.name} got ${t} damage from ${e.name} by ${r.name}`);case a.Reaction.DIE:return this.warning(`${s.name} got ${t} damage from ${e.name} causes them to die`);case a.Reaction.NOTHING:return this.debug(`Удар пришелся по ${e.name} но остался незамеченным`);case a.Reaction.RESIST:return this.info(`${s.name} игнорирует урон`);case a.Reaction.DODGE:return this.debug(`${e.name} throws ${r.name} in ${s.name}, but misses!`)}}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);class r{constructor(){this.total=0,this.stat=new Map}add(t){const e=this.stat.get(t);e?this.stat.set(t,e+1):this.stat.set(t,1)}get all(){return Object(i.sortBy)(Array.from(this.stat),([t,e])=>t)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return l});var i=s(7),r=s(6),n=s(9),a=s(40),o=s(29),c=s(2),h=s(14),u=s(0);class l extends i.i{constructor(t,e=!1){super(i.j.AirBlow,t,e)}untrap(t,e,s,i){n.a.chance(4,6)?(i.logger.failedToUntrap(e),n.a.chance(3,5)&&this.activate(t,i,s,e)):this.disarmTile(t,e,s,i)}buildNew(){return new l(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?6:15}get creatureWeightBlowThreshold(){return 60}activate(t,e,s,i){return i.on(new a.a(this,s,e,(t,s)=>e.logger.trapAirBlow.dodge(t,s,i),(r,a)=>{if(i.weightWithCarryings>=this.creatureWeightBlowThreshold)e.logger.trapAirBlow.resist(r,a,i);else{let o=this.randomPos(t,s,n.a.higherWeight(3,1),t=>t.passibleThrough(i));o.eq(t)?e.logger.trapAirBlow.resist(r,a,i):(e.logger.trapAirBlow.activate(r,a,i),i.on(new h.a(e,s,o)))}if(a){const i=e.player,r=i.inventory;[[r.headSlot,3,t=>e.logger.trapAirBlow.headBlow(t)],[r.rightHandSlot,40/i.strength.current,t=>e.logger.trapAirBlow.handBlow(t)],[r.leftHandSlot,45/i.strength.current,t=>e.logger.trapAirBlow.handBlow(t)]].forEach(([r,a,c])=>{r.equipment&&a>=3&&n.a.chance(1,Math.round(a))&&(c(r.equipment.item),this.throwItem(t,s,r.equipment.item),i.on(new o.a(r,1,e)))})}return u.Reaction.NOTHING}))}throwItem(t,e,s){let i=this.randomPos(t,e,n.a.lowerWeight(5,1),t=>t.isFloor());e.at(i.x,i.y).addItem(s,1)}randomPos(t,e,s,i){let n=t,a=!1;return Object(c.shuffle)(r.a.all).forEach(o=>{if(!a){let c=!1;Object(r.f)(t,t.add(o.multiple(s)),(t,s)=>{!c&&e.inRange(new r.c(t,s))&&i(e.at(t,s))?(n=new r.c(t,s),a=!0):c=!0})}}),n}}},function(t,e,s){"use strict";s.d(e,"a",function(){return l});var i=s(7),r=s(9),n=s(18),a=s(15),o=s(23),c=s(21),h=s(1);class u extends c.a{constructor(t,e,s){super(e,s),this.trap=t}get hurtEvent(){return new n.a(this.damages,a.b.Trap,this.levelMap,this.game)}get damages(){return[{type:o.a.Pure,dice:{times:5,max:2},extra:5}]}affectCreature(t){const e=t.on(this.hurtEvent);return this.playerSees(t)&&(this.trap.revealed=!0),this.game.logger.trapBareWire.activated(this.playerSees(t),e,t),e}affectPlayer(t){if(this.trap.revealed=!0,t.inventory.bootsSlot.insulator)return this.game.logger.trapBareWire.resist(),h.c.RESIST;{const e=t.on(this.hurtEvent);return this.game.logger.trapBareWire.activated(!0,e,t),e}}}class l extends i.i{constructor(t,e=!1){super(i.j.BareWire,t,e)}untrap(t,e,s,i){e.inventory.glovesSlot.insulator?r.a.chance(1,7)?(i.logger.failedToUntrap(e),this.activate(t,i,s,e)):this.disarmTile(t,e,s,i):i.logger.trapBareWire.doNotWant()}buildNew(){return new l(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?5:10}activate(t,e,s,i){return r.a.dodges(i.bodyControl,this.dodgeRatio)?h.c.DODGE:i.on(new u(this,s,e))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s(7),r=s(0),n=s(18),a=s(15),o=s(23);class c extends i.i{constructor(t,e,s=!1,r=5){super(i.j.FallingRock,e,s),this.newRock=t,this.missilesCount=r}buildNew(){return new c(this.newRock,this.tile,this.revealed,this.missilesCount)}get dodgeRatio(){return this.revealed?3:12}get damages(){return[{type:o.a.Blunt,extra:3,dice:{times:2,max:5}}]}untrap(t,e,s,i){if(r.Calculator.chance(1,4)){i.logger.failedToUntrap(e);const r=s.at(t.x,t.y).creature;r?this.activate(t,i,s,r):this.throwMissile(t,s,i.logger)}else this.disarmTile(t,e,s,i)}activate(t,e,s,i){return this.throwMissile(t,s,e.logger)?i.on(new r.TrapEvent(this,s,e,(t,s)=>e.logger.trapFallingRock.dodge(e.player,t,s,i),(t,o)=>{if(o&&e.player.inventory.headSlot.firm)return e.logger.trapFallingRock.resist(e.player),r.Reaction.RESIST;const c=i.on(new n.a(this.damages,a.b.Trap,s,e));return e.logger.trapFallingRock.activate(e.player,t,o,c,i),c})):r.Reaction.NOTHING}throwMissile(t,e,s){return this.missilesCount<=0?(s.trapFallingRock.ranOut(),!1):(this.missilesCount-=1,e.at(t.x,t.y).addItem(this.newRock(),1),!0)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return u});var i=s(0),r=s(14),n=s(22),a=s(7),o=s(18),c=s(23),h=s(15);class u extends a.i{constructor(t,e=!1){super(a.j.Hole,t,e)}buildNew(){return new u(this.tile,this.revealed)}untrap(t,e,s,i){i.logger.canNotUntrap()}get dodgeRatio(){return this.revealed?1:5}activate(t,e,s,r){return r.on(new i.TrapEvent(this,s,e,(t,s)=>e.logger.trapHole.dodge(t,s,r),(t,i)=>{let a=this.fallEvent(e,s);return a?(e.logger.trapHole.activated(t,i,r),r.on(a),r.on(new o.a([{type:c.a.Pure,dice:{times:3,max:2},extra:2}],h.b.Trap,s,e))):(e.logger.trapHole.shallowActivated(t,i,r),r.on(new n.a(s)))}))}fallEvent(t,e){let s=void 0;return Object(i.withEachTile)(e,()=>!0,n=>{if(n instanceof a.e){let a=t.getMap(n.adjacentMapName),o=void 0;(o=Object(i.safeWithMatchingTile)(a,t=>t.passibleThrough()))&&(s=new r.a(t,e,new i.Point(o.x,o.y),a))}}),s}}},function(t,e,s){"use strict";s.d(e,"a",function(){return h});var i=s(7),r=s(40),n=s(38),a=s(34),o=s(9),c=s(0);class h extends i.i{constructor(t,e=!1){super(i.j.Light,t,e)}untrap(t,e,s,i){o.a.chance(1,3)?(i.logger.failedToUntrap(e),this.activate(t,i,s,e)):this.disarmTile(t,e,s,i)}buildNew(){return new h(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?1:10}get duration(){return 10}activate(t,e,s,i){return i.on(new r.a(this,s,e,(t,s)=>e.logger.lightTrapDodge(e.player,t,s,i),(t,s)=>i.hasImpact(a.b.Blind)?c.Reaction.NOTHING:(e.logger.lightTrapActivated(e.player,t,s,i),i.on(new n.a(a.b.Blind,"trap",e,this.duration)))))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(0),r=s(7);class n extends r.i{constructor(t,e=!1){super(r.j.Teleportation,t,e)}untrap(t,e,s,i){i.logger.canNotUntrap()}buildNew(){return new n(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?3:10}activate(t,e,s,r){return r.on(new i.TrapEvent(this,s,e,(t,s)=>{s?e.logger.playerDodgesTeleportationTrap():t&&e.logger.creatureDodgesTeleportationTrap(r)},(t,n)=>r.on(new i.TeleportationEvent(s,e,!1))))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(7),r=s(0),n=s(23),a=s(59);class o extends i.i{constructor(t,e=!1){super(i.j.Water,t,e)}buildNew(){return new o(this.tile,this.revealed)}get dodgeRatio(){return this.revealed?10:8}get damages(){return[{type:n.a.Pure,extra:5,dice:{times:2,max:2}}]}untrap(t,e,s,i){r.Calculator.chance(3,4)?(i.logger.failedToUntrap(e),r.Calculator.chance(1,4)&&this.activate(t,i,s,e)):this.disarmTile(t,e,s,i)}activate(t,e,s,i){return i.on(new r.TrapEvent(this,s,e,(t,s)=>e.logger.waterTrapDamage(e.player,t,s,r.Reaction.DODGE,i),(t,r)=>{r&&e.logger.waterTrapActivated();let n=i.on(new a.a(this.damages,s,e));return r||e.logger.waterTrapDamage(e.player,t,r,n,i),n}))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(8);class r extends i.b{constructor(t,e,s,i){super(e,s),this.options=t,this.withOption=i}get type(){return i.c.PickHandleOption}pick(t){this.withOption(t)}close(){this.goIdle()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(8),r=s(53),n=s(72),a=s(57);class o extends i.b{constructor(t,e,s){super(e,s),this.level=t,this.talentsPage=new n.a(e,s)}get type(){return i.c.TalentsPicking}pickTalent(t,e){this.player.on(new a.a(t,e)),this.player.on(new r.a),this.endTurn()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(17);class r extends i.b{get page(){return i.a.Talents}get professions(){return this.player.professions}}},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){"use strict";var i=s(0);var r=s(11);s.d(e,"a",function(){return o});class n extends i.Missile{worksWith(t){return t instanceof a}}class a extends i.MissileWeapon{worksWith(t){return t instanceof n}}const o=()=>new n("Маленький камень",.3,[{type:i.DamageType.Blunt,dice:{times:1,max:3},extra:2}],r.a.stone);new i.Pool([[1,()=>new i.OneHandWeapon("Катана",1,r.a.iron,[{type:i.DamageType.Melee,dice:{times:5,max:2},extra:0}])],[7,()=>new i.OneHandWeapon("Кинжал",.8,r.a.iron,[{type:i.DamageType.Melee,dice:{times:1,max:3},extra:2}])]]),new i.Pool([[1,()=>new i.BodyArmor("Кольчуга",5,r.a.iron,[{type:i.ProtectionType.Medium,value:3}])],[5,()=>new i.BodyArmor("Латы",3,r.a.iron,[{type:i.ProtectionType.Heavy,value:5}])],[10,()=>new i.BodyArmor("Роба",1,r.a.iron,[{type:i.ProtectionType.Unarmored,value:1}])],[100,()=>new class extends i.Potion{constructor(){super("Зелье лечения")}onDrink(t){t.player.health.increase(5)}}]])},function(t,e,s){"use strict";var i=s(8),r=s(0),n=s(41),a=s(6);class o extends i.b{constructor(t,e){super(t,e),this.targetEnemyIndex=void 0,this.enemies=[],this.path=[],this.findEnemies(),this.memory=this.player.stageMemory(this.levelMap),this.targetPos=this.resetTargetId()}get type(){return i.c.Missile}nextTarget(){void 0!==this.targetEnemyIndex?(this.targetEnemyIndex+=1,this.targetEnemyIndex>=this.enemies.length&&(this.targetEnemyIndex=0),this.updateTarget(this.enemies[this.targetEnemyIndex])):this.resetTargetId()}previousTarget(){void 0!==this.targetEnemyIndex?(this.targetEnemyIndex-=1,this.targetEnemyIndex<0&&(this.targetEnemyIndex=this.enemies.length-1),this.updateTarget(this.enemies[this.targetEnemyIndex])):this.resetTargetId()}moveTarget(t){const e=this.targetPos.add(t);this.levelMap.at(e.x,e.y).visibleThrough()&&this.player.stageMemory(this.levelMap).at(e.x,e.y).visible&&(this.updateTarget(e),this.targetEnemyIndex=void 0)}attack(){this.targetPos.eq(this.levelMap.creaturePos(this.player))||this.player.on(new r.MissileAttackEvent(this.path,this.game,this.levelMap,()=>this.endTurn()))}close(){this.resetPath(),this.redirect(new f(this.levelMap,this.game))}resetTargetId(){let t;return this.enemies.length?(this.targetEnemyIndex=0,t=this.enemies[this.targetEnemyIndex]):(this.targetEnemyIndex=void 0,t=this.levelMap.creaturePos(this.player)),this.updateTarget(t),t}resetPath(){this.path.forEach(({x:t,y:e})=>this.memory.at(t,e).effect=void 0)}updateTarget(t){this.resetPath(),this.targetPos=t.copy(),this.drawPath()}drawPath(){this.path=[];let t=!1;const e=this.levelMap,s=this.levelMap.creaturePos(this.player);Object(a.f)(s,this.targetPos,(s,i)=>{e.at(s,i).passibleThrough()||(t=!0),this.path.push(new a.c(s,i)),this.memory.at(s,i).effect=t?"o":"x"})}findEnemies(){this.enemies=[],this.player.stageMemory(this.levelMap).each((t,e,s)=>{t.visible&&t.creature&&t.creature.id!==this.player.id&&this.enemies.push(new a.c(e,s))})}}var c=s(14),h=s(2),u=s(70),l=s(22),d=s(56);s.d(e,"a",function(){return f});class p extends r.TileVisitor{constructor(t,e,s){super(),this.position=t,this.game=e,this.levelMap=s,this.commands=[]}onStairway(t){const e=this.game.getMap(t.adjacentMapName);this.commands.push(["stairway",new c.a(this.game,this.levelMap,t.enterPos(this.levelMap,e),e)])}onTrap(t){t.revealed&&this.commands.push(["untrap",new r.UntrapEvent(this.position,t,this.levelMap,this.game)])}}class m extends p{onStairway(){}onDoor(t){t.open?this.commands.push(["closeDoor",new r.CloseDoorEvent(t,this.levelMap,this.game)]):this.commands.push(["openDoor",new d.a(t,this.levelMap,this.game)])}}class f extends i.a{get type(){return i.c.Idle}inventoryCommand(){this.redirect(new n.a(this.levelMap,this.game))}bagCommand(){this.redirect(new r.BagPresenter(this.levelMap,this.game))}stayCommand(){this.player.on(new l.a(this.levelMap)),this.endTurn()}dropCommand(){this.redirect(new r.DropItemsPresenter(this.levelMap,this.game))}drinkCommand(){this.redirect(new r.DrinkPresenter(this.levelMap,this.game))}lookCommand(){this.redirect(new r.LookPresenter(this.levelMap,this.game))}move(t){const e=this.levelMap.creaturePos(this.player).add(t),s=this.levelMap.at(e.x,e.y);s.passibleThrough(this.player)?this.player.on(new c.a(this.game,this.levelMap,e)):s.creature?this.player.on(new r.AttackEvent(s.creature,this.levelMap,this.game)):(this.game.logger.ranIntoAnObstacle(),this.player.stageMemory(this.levelMap).at(e.x,e.y).see(s,0)),this.endTurn()}pickUpCommand(){const t=this.tile,e=t.items;void 0===e||0===e.bunch.length?this.game.logger.noItemsToPickUp():1===e.bunch.length?(this.player.on(new r.PickUpItemsEvent(t,e.bunch,this.game)),this.endTurn()):this.redirect(new r.PickUpPresenter(this.levelMap,this.game))}missileCommand(){const t=this.player.inventory.missileSlot.equipment;t&&t.item?t.item.canThrow(this.player)?this.redirect(new o(this.levelMap,this.game)):this.game.logger.needMissileWeapon():this.game.logger.nothingToShotWith()}handleCommand(){let t=this.levelMap.creaturePos(this.player),e=new p(t,this.game,this.levelMap),s=new m(t,this.game,this.levelMap);this.tile.visit(e),t.wrappers().forEach(t=>{s.position=t,this.levelMap.at(t.x,t.y).visit(s)});const i=Object(h.concat)(e.commands,s.commands);switch(i.length){case 0:this.game.logger.howToHandle();break;case 1:this.player.on(i[0][1]),this.endTurn();break;default:this.redirect(new u.a(i,this.levelMap,this.game,([t,e])=>{this.player.on(e),this.endTurn()}))}}}},,,,,function(t,e,s){"use strict";var i=s(0),r=s(43),n=s(11);const a={chance:.05,multiplier:2},o=(t,e=[],s)=>new i.AICreature(new r.a,{name:t,weight:10,clan:i.Clan.PlayerOnlyEnemy,abilities:[],protections:e,damages:s,maxHealthValue:1,regenerationRate:5,regenerationValue:1,resistances:[],visionRadius:5,moveSpeed:20,attackSpeed:20,bodyControl:5,leavesCorpseRatio:50,material:n.a.flesh,throwingDamages:[],critical:a}),c=new i.Pool([[100,()=>o("Rat",[],[{type:i.DamageType.Melee,dice:{times:2,max:2},extra:0}])],[3,()=>o("Golem",[{type:i.ProtectionType.Solid,value:5}],[{type:i.DamageType.Blunt,dice:{times:1,max:5},extra:10}])]]);var h=s(30),u=s(63),l=s(64),d=s(65),p=s(92),m=s(66),f=s(67),g=s(68),v=s(69);s.d(e,"a",function(){return C});const y="title",b={addDoors:!1,minSize:3,maxSize:8,roomsCount:20,addTraps:!1,width:100,height:100},w=new Map;w.set("C",()=>new i.Corridor("C",i.TileTypes.Floor)),w.set("W",()=>new i.Wall),w.set("R",()=>new i.Floor("R",i.TileTypes.Floor)),w.set("D",()=>new i.Door);const T=new i.Pool([[1,t=>new u.a(t,!1)],[1,t=>new l.a(t,!1)],[1,t=>new d.a(p.a,t,!1)],[1,t=>new m.a(t,!1)],[1,t=>new f.a(t,!1)],[1,t=>new g.a(t,!1)],[1,t=>new v.a(t,!1)],[93,t=>t]]);class C extends i.Dungeon{enter(t,e){const s=t.currentMap=t.getMap(y);Object(i.withMatchingTile)(s,t=>t.isFloor()&&t.passibleThrough(),(t,r)=>{s.addCreature(new i.Point(t,r),e)})}register(t){t.addMap(y,(t,e)=>Object(i.addCreatures)(0,this.generateMap(y),c))}generateMap(t){let e=new i.LevelMap(t,Object(i.dungeon)(b.width,b.height,b.minSize,b.maxSize,b.roomsCount,()=>new i.Room,()=>new i.Corridor("C",i.TileTypes.Floor),()=>new i.Wall));return Object(i.addDoors)(e,()=>new i.Door,()=>!0),Object(h.e)(e,t=>t.isFloor(),(t,s,i)=>{e.setTile(s,i,T.pick(t))}),Object(i.centralize)(e),e}}},,,,,function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(0),r=s(12);class n extends r.a{act(t,e,s,r=!0){if(this.canAttack(t,e)){if(this.victim&&this.victimInAccess(t,e,this.victim))return new i.AttackEvent(this.victim,e,s);if(!r)throw"Attacker got called twice";return this.pickNewVictim(t,e),this.act(t,e,s,!1)}}canAttack(t,e){return!!this.findCreature(t,e,e=>this.enemies(t,e))}victimInAccess(t,e,s){if(void 0===s)return!1;return!!this.findCreature(t,e,t=>t.id===s.id)}pickNewVictim(t,e){this.victim=this.findCreature(t,e,e=>this.enemies(t,e))}findCreature(t,e,s){const i=t.stageMemory(e);return e.creaturePos(t).wrappers().map(({x:t,y:e})=>i.at(t,e).creature).find(t=>!!t&&s(t))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(6),r=s(12);class n extends r.b{foundNewTarget(t,e){return this.victimSet()&&this.buildVictimPath(t,e)||this.foundNewVictim(t,e)}onCantMove(){this.victimId=void 0}onReach(){this.victimId=void 0}victimSet(){return!!this.victimId}goTo(t,e,s){if(!this.destination)throw"Chaser.goTo: no destination";return this.followTo(t,this.destination,e,s)}buildVictimPath(t,e){return this.findCreature(t,e,t=>t.id===this.victimId)}foundNewVictim(t,e){return this.findCreature(t,e,e=>this.enemies(t,e))&&this.buildVictimPath(t,e)}findCreature(t,e,s){let r=!1;return this.withinView(t.stageMemory(e),e.creaturePos(t),({x:t,y:e},n)=>{const a=n.creature;!r&&a&&s(a)&&(this.destination=new i.c(t,e),this.victimId=a.id,r=!0)}),r}followTo(t,e,s,i){return this.move(t,s,i,t=>e.nextTo(t))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s(0),r=s(7),n=s(12);class a extends r.h{constructor(){super(...arguments),this.match=!1}onStairwayDown(){this.match=!0}}class o extends r.h{constructor(t,e){super(),this.game=t,this.levelMap=e}onStairwayDown(t){const e=this.game.getMap(t.adjacentMapName);this.event=new i.MoveEvent(this.game,this.levelMap,t.enterPos(this.levelMap,e),e)}}class c extends n.c{constructor(){super(t=>{const e=new a;return t.visit(e),e.match})}act(t,e,s){if(t.can(i.Ability.GoStairway))return super.act(t,e,s)}onReach(t,e,s){const i=new o(s,e);return e.creatureTile(t).visit(i),i.event}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(12),r=s(2);const n=2;class a extends i.b{constructor(){super(...arguments),this.escapesFrom=[]}foundNewTarget(t,e){return this.foundEnemies(t,e)&&this.buildEscapePath(t,e)}buildEscapePath(t,e,s=t.visionRadius/2){if(s<=1)return this.destination=void 0,!1;const i=this.buildPath(t,e,({x:t,y:e})=>{return Object(r.sumBy)(this.escapesFrom,([s,i])=>Math.max(Math.abs(t-s.x),Math.abs(e-s.y)))>=s});return i.length?(this.destination=i.pop(),!0):this.buildEscapePath(t,e,s-n)}foundEnemies(t,e){return this.escapesFrom=[],this.withinView(t.stageMemory(e),e.creaturePos(t),(e,s)=>{const i=s.creature;i&&this.enemies(t,i)&&this.escapesFrom.push([e,i])}),this.escapesFrom.length>0}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(12);class r extends i.c{constructor(){super(t=>!t.seen)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return u});var i=s(12),r=s(154),n=s(50),a=s(7),o=s(14);const c=10;class h extends a.h{constructor(t){super(),this.tile=t,this.status=!1}addNode(){return this.status=!1,this.tile.visit(this),this.status}onDoor(){this.status=!0}}class u extends i.a{constructor(){super(),this.step=c,this.firstCallPatrol=!0,this.i="a",this.graph=new r.Graph,this.lastNodeVisit={},this.currentNodeID="a",this.markNodeVisited(this.currentNodeID),this.path=[]}act(t,e,s,i=!0){if(!(this.graph.nodes().length<=1)){if(this.firstCallPatrol){const s=e.creaturePos(t);this.addNode(s),this.firstCallPatrol=!1}return this.step+=1,this.path.length?this.moveToTarget(t,e,s,i):(this.targetNodeID&&(this.markNodeVisited(this.targetNodeID),this.currentNodeID=this.targetNodeID),this.pickUpNewTarget(t,e),this.moveToTarget(t,e,s,i))}}reset(){this.path=[]}trackMovement(t,e){(this.step>=c||new h(e).addNode())&&this.addNode(t),this.step+=1}addNode(t){this.graph.setNode(this.i,t),this.currentNodeID&&this.currentNodeID!==this.i&&this.graph.setEdge(this.currentNodeID,this.i),this.currentNodeID=this.i,this.newNodeId(),this.step=0}buildNewPath(t,e){if(!this.targetNodeID)throw"Patrol has no next targetID";const s=this.graph.node(this.targetNodeID);this.path=this.buildPath(t,e,t=>s.eq(t))}pickUpNewTarget(t,e){let s=this.graph.nodes()[0],i=this.lastNodeVisit[s],r=this.graph.neighbors(this.currentNodeID);r&&r.forEach(t=>{i>(this.lastNodeVisit[t]||0)&&(s=t,i=this.lastNodeVisit[s])}),this.targetNodeID=s,this.buildNewPath(t,e)}moveToTarget(t,e,s,i){const r=this.path.shift();return r?t.stageMemory(e).at(r.x,r.y).tangible()?(this.buildNewPath(t,e),this.path.length?this.act(t,e,s,!1):void 0):new o.a(s,e,r):i?(this.path=[],this.act(t,e,s,!1)):(new n.a).act(t,e,s)}markNodeVisited(t){this.lastNodeVisit[t]=this.step}newNodeId(){this.i=String.fromCharCode(this.i.charCodeAt(0)+1)}}},,,,,,function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(0),r=s(16),n=s(12),a=s(27);class o extends n.c{constructor(){super(t=>!!t.items)}act(t,e,s){if(t.can(r.b.Inventory))return super.act(t,e,s)}onReach(t,e,s){const r=e.creatureTile(t);if(!r.items)throw"Picker.act : nothing to pick up";return t.ai.pushEvent(new a.b(r.items,s)),new i.PickUpItemsEvent(r,r.items.bunch,s)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(12),r=s(22);class n extends i.a{act(t,e){if(!t.health.atMax)return new r.a(e)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s(12),r=s(16),n=s(6),a=s(0),o=s(1);class c extends i.a{act(t,e,s){if(!t.can(r.b.Throwing)||!this.hasMissile(t)||!this.canAttack(t,e,s))return;let i=[];if(!this.victim)throw"Thrower.act called when there is no victim";return Object(n.e)(e.creaturePos(t),e.creaturePos(this.victim),(t,e)=>i.push(new n.c(t,e))),new a.MissileAttackEvent(i,s,e,t=>{t===o.c.DIE&&(this.victim=void 0,this.previousVictim=void 0)})}hasMissile(t){return this.missiles=t.missile,void 0!==this.missiles}canAttack(t,e,s){return this.previousVictim=this.victim,this.victim=void 0,!(!this.previousVictim||!this.findWithId(t,e,this.previousVictim.id))||this.findCreature(t,e,e=>this.enemies(t,e))}findWithId(t,e,s){return this.findCreature(t,e,t=>s===t.id)}findCreature(t,e,s){const i=t.stageMemory(e),r=e.creaturePos(t);return this.withinView(i,e.creaturePos(t),(n,a)=>{const o=a.creature;!this.victim&&o&&s(o)&&!this.obstacles(t,r,i,n)&&(this.victim=e.at(n.x,n.y).creature)}),!!this.victim}obstacles(t,e,s,i){let r=!1;return Object(n.e)(e,i,(e,i)=>{r=r||s.at(e,i).tangible(t)}),r}}},function(t,e,s){"use strict";s(12),s(22)},function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s(1),r=s(37),n=s(9),a=s(18),o=s(15);class c extends i.a{constructor(t,e,s){super(),this.victim=t,this.levelMap=e,this.game=s}affectCreature(t){return this.process(t,!1)}affectPlayer(t){const e=this.process(t,!0);return e===i.c.DIE&&t.on(new r.a(this.victim,this.levelMap,this.game)),e}process(t,e){const[s,i]=this.hit(t);return this.game.logger.attackLogger.melee(i,t,this.victim,s,e),s}hit(t){if(n.a.misses(t.bodyControl,this.victim.bodyControl))return[i.c.DODGE,0];const e=new a.a(n.a.withCritical(t.damages,t.specie.critical),o.b.Attack,this.levelMap,this.game);return[this.victim.on(e),e.damage]}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(1),r=s(21);class n extends r.a{constructor(t,e,s){super(e,s),this.door=t}affectCreature(t){return this.door.open?(this.door.open=!1,this.game.logger.doorLogger.close()):this.game.logger.doorLogger.alreadyClosed(),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e){super(),this.potion=t,this.game=e}affectCreature(t){return t.removeItem(this.potion,1),this.potion.onDrink(this.game),this.game.logger.drink(this.potion),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(1),r=s(54),n=s(55),a=s(29);class o extends i.a{constructor(t,e,s,i){super(),this.path=t,this.game=e,this.levelMap=s,this.done=i}affectCreature(t){let e=t.missile;if(!e)throw"MissileAttackEvent called when actor has no missiles";return this.withMissile(t,e.item),i.c.NOTHING}affectPlayer(t){const e=t.missile;if(!e)throw"MissileAttackEvent: slot has no items";return this.withMissile(t,e.item),t.on(new a.a(t.inventory.missileSlot,1,this.game)),t.stuffWeight.subtract(e.item.weight),i.c.NOTHING}withMissile(t,e){let s,a=[];this.path.forEach(t=>{if(!s){const e=this.levelMap.at(t.x,t.y);s=e.creature,a.push(t)}}),this.game.effect=new r.a(e,a,()=>{s?this.done(t.on(new n.a(s,e,this.levelMap,this.game))):this.done(i.c.NOTHING)})}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e,s){super(),this.tile=t,this.items=e,this.game=s}affectCreature(t){return this.items.forEach(({item:e,count:s})=>{t.addItem(e,s)}),i.c.NOTHING}affectPlayer(t){let e=this.tile.items;if(void 0===e)throw"Failed to pick up items - tile has no items";return this.withTileItems(t,e),i.c.NOTHING}withTileItems(t,e){this.items.forEach(({item:s,count:i})=>{t.addItem(s,i),t.stuffWeight.add(s.weight*i),this.game.logger.pickedUpItem(s,i),e.remove(s,i)})}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.b{constructor(t){super(),this.profession=t}affectPlayer(t){let e=t.professions.find(t=>t.id===this.profession.id);return e?e.level+=1:(this.profession.level+=1,t.professions.push(this.profession)),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(1),r=s(39),n=s(10),a=s(38);class o extends i.b{constructor(t,e,s){super(),this.slot=t,this.item=e,this.game=s}affectPlayer(t){let e=t.inventory.findInBag(this.item);if(void 0===e)throw`Item ${this.item.name} can not be equipped - not found in inventory`;if(this.slot.equipment){const e=t.on(new r.a(this.slot,this.game));if(e!==i.c.NOTHING)return e}const s=this.slot.useSingleItem?1:e.count;return t.removeItem(this.item,s),this.slot.equip(this.item,s),this.onPutOn(t,this.item),this.game.logger.putOn(this.item),i.c.NOTHING}onPutOn(t,e){e instanceof n.a&&(t.itemsProtections=t.itemsProtections.concat(e.protections)),e.impacts.forEach(s=>{t.on(new a.a(s,e.name,this.game))})}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.a{constructor(t,e,s){super(),this.impactType=t,this.game=e,this.source=s}affectCreature(t){return this.source?t.removeConstImpact(this.impactType,this.source):t.removeImpact(this.impactType),i.c.NOTHING}}},function(t,e,s){"use strict";s.d(e,"a",function(){return u});var i=s(21),r=s(30),n=s(14),a=s(6),o=s(31),c=s(36),h=s(1);class u extends i.a{constructor(t,e,s){super(t,e),this.selfCast=s}affectCreature(t){return this.playerSees(t)?t.hasResistance(o.b.TeleportationControl)||!this.teleport(t)?this.game.logger.creatureNotTeleported(t):this.game.logger.creatureTeleported(t):this.teleport(t),h.c.NOTHING}affectPlayer(t){return t.hasResistance(o.b.TeleportationControl)?(this.selfCast||this.game.logger.playerTeleportationCaused(),t.ai.pushEvent(new c.c(this.levelMap,this.game)),this.game.playerTurn=!0):this.teleport(t)?this.selfCast||this.game.logger.playerTeleported():this.game.logger.playerNotTeleported(),h.c.NOTHING}teleport(t){let e=!1;try{Object(r.f)(this.levelMap,t=>t.free(),(s,i)=>{e=!0,t.on(new n.a(this.game,this.levelMap,new a.c(s,i)))})}catch(t){}return e}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(1);class r extends i.b{constructor(t,e,s,i){super(),this.trapPosition=t,this.trap=e,this.levelMap=s,this.game=i}affectPlayer(t){return this.trap.untrap(this.trapPosition,t,this.levelMap,this.game),i.c.NOTHING}}},function(t,e,s){"use strict";s(6)},function(t,e,s){"use strict";var i=s(6);const r=0,n=60,a=Math.PI/(2*n);class o extends i.d{notCross(t){return t.x-r>this.x+this.w||t.y-r>this.y+this.h||t.x+t.w<this.x-r||t.y+t.h<this.y-r}pointWithin(){return new i.c(this.x+1+Object(i.i)(this.w-1),this.y+1+Object(i.i)(this.h-1))}add(t,e,s){let i=0;for(;i<this.w;){let r=0;for(;r<this.h;)t[this.x+i][this.y+r]=s(),e[this.x+i][this.y+r]=!1,r++;i++}}}class c extends i.d{constructor(t,e,s,i){super(t,e,s,i),this.lined=t>=s&&e>=i||s>=t&&i>=e}add(t,e,s){let[i,r,n]=this.horizontalLine(),a=0;for(;a<n;)e[i+a][r]&&(t[i+a][r]=s()),a+=1;let[o,c,h]=this.verticalLine(),u=0;for(;u<h;)e[o][c+u]&&(t[o][c+u]=s()),u+=1}horizontalLine(){return this.lined?[Math.min(this.x,this.w),Math.max(this.y,this.h),Math.abs(this.w-this.x)]:[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.w-this.x)]}verticalLine(){return this.lined,[Math.min(this.x,this.w),Math.min(this.y,this.h),Math.abs(this.h-this.y)]}}e.a=function(t,e,s,r,h,u,l,d){const p=new class{constructor(t,e,s,i,r){this.maxX=t,this.maxY=e,this.minSize=s,this.maxSize=i,this.roomsCount=r;let n=new Array(this.roomsCount).fill(void 0).map(t=>this.generateRoom());this.rooms=this.normalize(this.ray(n)),this.roads=this.buildRoads(this.rooms)}generateRoom(){return new o(0,0,this.minSize+Object(i.i)(this.maxSize-this.minSize),this.minSize+Object(i.i)(this.maxSize-this.minSize))}ray(t){return t.reduce((t,e)=>{for(let s=0,r=Object(i.i)(360)/180*Math.PI;s<n;r+=a,s++){const s=Math.cos(r),i=Math.sin(r);let n=1,a=0,c=0,h=new o(e.x,e.y,e.w,e.h);for(;Math.abs(a)<this.maxX/2&&Math.abs(c)<this.maxY/2;){let e=Math.round(n*s),r=Math.round(n*i);for(;e===a&&r===c;)n+=1,e=Math.round(n*s),r=Math.round(n*i);if(h.move(e-a,r-c),a=e,c=r,t.every(t=>h.notCross(t)))return t.push(h),t}}return t},[])}normalize(t){if(0===t.length)return t;const e=Object(i.h)(t.map(t=>t.x))-1;t.forEach(t=>{t.move(-e,0)}),t=t.filter(t=>t.x+t.w<this.maxX);const s=Object(i.h)(t.map(t=>t.y))-1;return t.forEach(t=>{t.move(0,-s)}),t.filter(t=>t.y+t.h<this.maxY)}buildRoads(t){let e=t.map(t=>t.pointWithin());const s=e.shift();if(!s)throw"Dungeon.buildRoads rooms array is empty";let i=[s],r=[];const n=function(t,e){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)};for(;e.length;){let t=e.shift();if(!t)throw"Dungeon.buildRoads rooms array is empty";let s=t,a=i[0],o=n(s,a);i.forEach(t=>{const e=n(t,s);e<o&&(a=t,o=e)}),i.push(s),r.push(new c(s.x,s.y,a.x,a.y))}return r}}(t,e,s,r,h);let m=Object(i.j)(t,e,d),f=Object(i.j)(t,e,()=>!0);for(let t=0;t<p.rooms.length;t++)p.rooms[t].add(m,f,u);for(let t=0;t<p.roads.length;t++)p.roads[t].add(m,f,l);return m}},function(t,e,s){"use strict";var i;s.d(e,"a",function(){return i}),function(t){t.Neuter="neuter",t.Female="female",t.Male="male"}(i||(i={}))},function(t,e,s){"use strict";s.d(e,"a",function(){return i});class i{constructor(t){this.requires=t,this.current=1,this.currentExperience=0,this.doneLeveling=!1,this.requiredExperience=this.requires[0]}add(t){if(this.doneLeveling)return[];this.currentExperience+=t;let e=[];for(;!this.doneLeveling&&this.currentExperience>=this.requiredExperience;)this.levelUp(),e.push(this.current);return e}levelUp(){this.current+=1;let t=this.requires[this.current-1];t?(this.currentExperience-=this.requiredExperience,this.requiredExperience=t):(this.currentExperience=this.requiredExperience,this.doneLeveling=!0)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);class r{constructor(t){this.totalWeight=0,this.items=[],t.forEach(([t,e])=>this.add(t,e))}add(t,e){if(t<1)throw"Item's weight is lower than 1";this.items.push([t,e]),this.totalWeight+=Math.ceil(t)}pick(t){if(0===this.items.length)throw"Tried to use empty pool";let e=Object(i.random)(this.totalWeight);const s=this.items.find(([t,s])=>(e-=t)<=0);if(void 0!==s)return s[1](t);throw"Pool failed to pick anything"}merge(t){let e=new r([]);return this.items.forEach(([t,s])=>e.add(t,s)),t.items.forEach(([t,s])=>e.add(t,s)),e}}},function(t,e){},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(30),r=s(7);class n{constructor(){this.levels=[]}addStairDown(t,e){return this.addStairs(t,new r.e(t,e))}addStairUp(t,e){return this.addStairs(t,new r.f(t,e))}addStairs(t,e){return Object(i.f)(t,t=>t.free(),(s,i)=>{t.setTile(s,i,e)}),t}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(60),r=s(61);class n{constructor(t,e){this.player=t,this.professionPicker=e,this.playerTurn=!1,this.running=!1,this.effect=null,this.turns=0,this.maps=new Map,this.logger=new r.b(t)}turn(){this.running||this.player.ai.presenter&&!this.effect||(this.running=!0,this.mutexTurn(),this.running=!1)}mutexTurn(){if(!this.player.ai.runEvents()){if(!this.currentMap)throw"mutexTurn: Map is undefined";if(this.effect)this.player.rebuildVision(this.currentMap),this.effect.patchMemory(this.player.stageMemory(this.currentMap)),this.effect.done()&&(this.effect.onDone(),this.effect=null);else{for(;!this.player.dead&&!this.playerTurn;)this.levelMapTurn(this.currentMap);this.player.rebuildVision(this.currentMap)}}}getMap(t){const e=this.maps.get(t);if(!e)throw`Map ${t} is not found`;if(e instanceof i.a)return e;if(e instanceof Function){const s=e(t,this);return this.maps.set(t,s),s}throw`LevelMap with id ${t} is not found`}addMap(t,e){if(this.maps.has(t))throw`Game.addMap: map ${t} already presence`;this.maps.set(t,e)}levelMapTurn(t){let e=t.timeline;const s=e.next();if(void 0===s)throw"Timeline event is empty!";const i=t.creatures.find(t=>s===t.id);if(i){const r=i.act(t,this);this.turns+=1,r&&t.creatures.find(t=>s===t.id)&&e.add(s,r)}}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(13),r=s(28),n=s(2),a=s(11);class o{constructor(){this.bag=new r.a,this.headSlot=new i.h(a.a.flesh),this.amuletSlot=new i.a,this.cloakSlot=new i.e,this.chestSlot=new i.d(a.a.flesh),this.rightHandSlot=new i.n(a.a.flesh),this.leftHandSlot=new i.j(a.a.flesh),this.leftFingerSlot=new i.i,this.rightFingerSlot=new i.m,this.glovesSlot=new i.g,this.gauntletsSlot=new i.f,this.beltSlot=new i.b,this.bootsSlot=new i.c(a.a.flesh),this.missileWeaponSlot=new i.l,this.missileSlot=new i.k,this.toolsSlot=new i.o}get bodyParts(){return[this.headSlot,this.rightHandSlot,this.leftHandSlot,this.chestSlot,this.bootsSlot]}slots(){return[this.headSlot,this.amuletSlot,this.cloakSlot,this.chestSlot,this.rightHandSlot,this.leftHandSlot,this.leftFingerSlot,this.rightFingerSlot,this.glovesSlot,this.gauntletsSlot,this.beltSlot,this.bootsSlot,this.missileWeaponSlot,this.missileSlot,this.toolsSlot]}get allItems(){return Object(n.concat)(this.cares(),Object(n.compact)(this.slots().map(t=>t.equipment)))}get unarmoredSlotsCount(){return[this.headSlot,this.chestSlot,this.glovesSlot,this.gauntletsSlot,this.beltSlot,this.bootsSlot].filter(t=>!t.equipment).length}cares(){return this.bag.bunch}findInBag(t){return this.bag.find(t)}putToBag(t,e){this.bag.put(t,e)}removeFromBag(t,e){this.bag.remove(t,e)}}},function(t,e,s){"use strict";s.d(e,"a",function(){return o});var i=s(7),r=s(0),n=s(6);class a{constructor(t){this.tile=t,this.visible=!1,this.degree=0,this.seen=!1}get items(){return this.tile.items}get creature(){return this.tile.creature}see(t,e){this.visible=!0,this.degree=e,this.seen=!0,this.tile=t.clone()}tangible(t){return this.seen&&!this.tile.passibleThrough(t)}reset(){this.visible=!1,this.effect=void 0,this.tile.creature=void 0}visit(t){this.tile.visit(t)}}class o extends n.b{constructor(t,e){const s=new i.k;super(Object(r.twoDimArray)(t,e,()=>new a(s)))}resetVisible(){this.each(t=>t.reset())}}},function(t,e,s){"use strict";s.d(e,"a",function(){return u});var i=s(2),r=s(0),n=s(35),a=s(19),o=s(10),c=s(16),h=s(62);class u extends c.d{constructor(t,e,s,i){super(s),this.level=t,this.ai=e,this.professions=[],this.inventory=new r.Inventory,this.itemsProtections=[],this.itemsResistances=[],this.killStat=new h.a,this.strength=new a.f(i.strength),this.dexterity=new a.c(i.dexterity),this.constitution=new a.b(i.constitution),this.intelligence=new a.e(i.intelligence),this.wisdom=new a.e(i.wisdom),this.charisma=new a.e(i.charisma),this.stuffWeight=new a.e(0),this.carryingCapacity=new a.a(this.strength.current,this.constitution.current)}act(t,e){this.statsTurn(),this.visionMask(t);const s=this.ai.act(this,t,e);return s&&this.on(s),this.on(new n.a(t,e)),this.speed}rebuildVision(t){this.visionMask(t)}on(t){return t.affectPlayer(this)}get missile(){return this.inventory.missileSlot.equipment}get inventoryItems(){return this.inventory.allItems}addItem(t,e){this.inventory.putToBag(t,e)}removeItem(t,e){this.inventory.removeFromBag(t,e)}get weightWithCarryings(){return this.specie.weight+Object(i.sumBy)(this.inventory.allItems,({item:t,count:e})=>t.weight*e)}get bodyControl(){return this.specie.bodyControl+this.dexterity.bodyControlAdjustment}get throwDamages(){const t=this.dexterity.missileAdjustment;return Object(i.concat)(this.specie.throwingDamages,this.missileItemsDamages()).map(e=>{let s=Object(i.cloneDeep)(e);return s.extra+=t,s})}get damages(){const t=this.strength.meleeAdjustment;return Object(i.concat)(this.specie.damages,this.meleeItemsDamages()).map(e=>{let s=Object(i.cloneDeep)(e);return s.extra+=t,s})}get protections(){return Object(i.concat)(this.specie.protections,this.itemsProtections,[{type:o.k.Unarmored,value:1*this.inventory.unarmoredSlotsCount}])}get resistances(){return Object(i.concat)(this.specie.resistances,this.itemsResistances)}meleeItemsDamages(){const t=this.inventory.rightHandSlot.equipment,e=this.inventory.leftHandSlot.equipment;return Object(i.concat)(t?t.item.damages:[],e?e.item.damages:[])}missileItemsDamages(){const t=this.inventory.missileSlot.equipment,e=this.inventory.missileWeaponSlot.equipment;return Object(i.concat)(t&&t.item.damages||[],e?e.item.damages:[])}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(24);class r extends i.b{constructor(){super(...arguments),this.title="Сумка"}initPositions(){this.positions=this.player.inventory.cares()}withItem(){this.endTurn()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(17);class r extends i.b{get page(){return i.a.Base}get currentLevel(){return this.player.level.current}get currentExperience(){return`${this.player.level.currentExperience}/${this.player.level.requiredExperience}`}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(0),r=s(10),n=s(24);class a extends n.b{constructor(){super(...arguments),this.title="Что выпить?"}initPositions(){this.positions=this.player.inventory.cares().filter(t=>t.item.group===r.f.Potion)}withItem({item:t}){this.player.on(new i.DrinkPotionEvent(t,this.game)),this.endTurn()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(24),r=s(52);class n extends i.a{constructor(){super(...arguments),this.title="Что положить?"}initPositions(){this.positions=this.player.inventory.cares()}withItems(t){t.length?(this.player.on(new r.a(this.tile,t,this.game)),this.endTurn()):this.goIdle()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(17);class r extends i.b{get page(){return i.a.History}get name(){return this.player.name}get weight(){return this.specie.weight}get height(){return this.specie.height}get gender(){return this.specie.gender}get eyeColor(){return this.specie.eyeColor}get hairColor(){return this.specie.hairColor}get skinColor(){return this.specie.skinColor}get race(){return this.player.specie.race}get turns(){return this.game.turns}}},function(t,e,s){"use strict";s.d(e,"b",function(){return i}),s.d(e,"a",function(){return o});var i,r=s(8),n=s(0),a=s(42);!function(t){t[t.See=0]="See",t[t.Recall=1]="Recall",t[t.Hidden=2]="Hidden"}(i||(i={}));class o extends a.a{constructor(t,e){super(t,e,"_",t=>this.memory.inRange(t))}get type(){return r.c.Look}get title(){return this.memoryTile.visible?i.See:this.memoryTile.seen?i.Recall:i.Hidden}get body(){let t=[];if(this.memoryTile.creature&&(this.memoryTile.creature.id===this.player.id?t.push("Это я"):t.push(`Это ${this.memoryTile.creature.name}`)),this.memoryTile.items)switch(this.memoryTile.items.bunch.length){case 0:break;case 1:t.push(`Лежит ${this.memoryTile.items.bunch[0].item.name}`);break;default:t.push("Лежит несколько предметов")}return t}close(){this.redirect(new n.IdlePresenter(this.levelMap,this.game))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(0);class r extends i.MultipleItemUseListingPresenter{constructor(){super(...arguments),this.title="Что поднять?"}initPositions(){const t=this.tile.items;if(void 0===t)throw"Failed to show pick up dialog - tile has no items";this.positions=t.bunch.map(t=>({item:t.item,count:t.count}))}withItems(t){this.player.on(new i.PickUpItemsEvent(this.tile,t,this.game)),this.endTurn()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(8),r=s(71),n=s(0);class a extends i.b{constructor(t,e,s){super(e,s),this.level=t,this.options=this.game.professionPicker.available(this.player)}get type(){return i.c.ProfessionPicking}pickProfession(t){this.player.on(new n.PickProfessionEvent(t)),this.redirect(new r.a(this.level,this.levelMap,this.game))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(24),r=s(41);class n extends i.b{constructor(t,e,s,i){super(s,i),this.onWithItem=t,this.positions=e,this.title="Что надеть?"}initPositions(){}withItem(t){this.onWithItem(t)}close(){this.redirect(new r.a(this.levelMap,this.game))}}},function(t,e,s){"use strict";s.d(e,"a",function(){return a});var i=s(8),r=s(42),n=s(14);class a extends r.a{constructor(t,e){super(t,e,"x",({x:e,y:s})=>t.at(e,s).passibleThrough(this.player)&&this.memory.at(e,s).seen)}get type(){return i.c.Teleportation}get title(){return"Выберите зону телепортации"}get body(){return[]}close(){this.targetPos.eq(this.levelMap.creaturePos(this.player))?this.game.logger.playerTeleportedWhereTheyWere():this.player.on(new n.a(this.game,this.levelMap,this.targetPos)),this.endTurn()}}},function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s(6),r=s(2);const n=function(t,e,s,n,o=!1){let c=Object(i.j)(t.width,t.height,()=>-1),h=[],u=[e],l=0;for(;u.length&&!h.length;){let e=[];u.forEach(i=>{if(!t.inRange(i))return;const r=t.at(i.x,i.y);s(r)||-1!==c[i.x][i.y]||(c[i.x][i.y]=l,n(i,r)?h.push(i):i.wrappers().forEach(t=>e.push(t)))}),l++,u=e}if(h.length){let t=Object(r.sample)(h);return a(o&&t?t:h[0],c)}return[]},a=function(t,e){let s,r=t,n=[r];for(;1!==e[r.x][r.y];){if(void 0===(s=i.c.dxy.find(t=>e[r.x+t.x]&&e[r.x+t.x][r.y+t.y]===e[r.x][r.y]-1)))return[];r=r.add(s),n.unshift(r)}return n}},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var i=s(2);const r=function(t,e){let s,r=Object(i.clone)(t),n=Object.keys(t),a={strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0};for(;n.length;)n=n.filter(t=>r[t]<=e),(s=Object(i.sample)(n))&&(e-=r[s],a[s]+=1,r[s]+=1);return[a,e]}},function(t,e,s){"use strict";s.d(e,"a",function(){return i});var i;s(32),s(25),s(0),s(2);!function(t){t[t.MainMenu=0]="MainMenu",t[t.ChooseGenderMenu=1]="ChooseGenderMenu",t[t.ChooseRaceMenu=2]="ChooseRaceMenu",t[t.ChooseProfessionMenu=3]="ChooseProfessionMenu",t[t.AttributesSelectionMenu=4]="AttributesSelectionMenu",t[t.EnterNameMenu=5]="EnterNameMenu",t[t.BackgroundMenu=6]="BackgroundMenu",t[t.TalentsMenu=7]="TalentsMenu"}(i||(i={}))},,,,,function(t,e,s){t.exports=s(243)},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,s){},,,,,,function(t,e,s){"use strict";var i=s(47);s.n(i).a},,,,,,,,,,,,,,,function(t,e,s){"use strict";var i=s(73);s.n(i).a},,function(t,e,s){"use strict";var i=s(74);s.n(i).a},,function(t,e,s){"use strict";var i=s(75);s.n(i).a},,function(t,e,s){"use strict";var i=s(76);s.n(i).a},,function(t,e,s){"use strict";var i=s(77);s.n(i).a},,function(t,e,s){"use strict";var i=s(78);s.n(i).a},,function(t,e,s){"use strict";var i=s(79);s.n(i).a},,function(t,e,s){"use strict";var i=s(80);s.n(i).a},,function(t,e,s){"use strict";var i=s(81);s.n(i).a},,function(t,e,s){"use strict";var i=s(82);s.n(i).a},,function(t,e,s){"use strict";var i=s(83);s.n(i).a},,function(t,e,s){"use strict";var i=s(84);s.n(i).a},,function(t,e,s){"use strict";var i=s(85);s.n(i).a},,function(t,e,s){"use strict";var i=s(86);s.n(i).a},,function(t,e,s){"use strict";var i=s(87);s.n(i).a},,function(t,e,s){"use strict";var i=s(88);s.n(i).a},,function(t,e,s){"use strict";var i=s(89);s.n(i).a},,function(t,e,s){"use strict";var i=s(90);s.n(i).a},,function(t,e,s){"use strict";var i=s(91);s.n(i).a},,function(t,e,s){"use strict";s.r(e);var i=s(4),r=s(155),n=s(152),a=s.n(n),o=(s(184),s(186),s(188),i.a.extend({name:"MenuOption",props:["char","name","separator"]})),c=(s(190),s(5)),h=Object(c.a)(o,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"menu-option",class:{"-separator":this.separator}},[this._v("["),e("span",{staticClass:"char",domProps:{textContent:this._s(this.char)}}),this._v("]\n"+this._s(this.name))])},[],!1,null,"ba0a0e9e",null);h.options.__file="MenuOption.vue";var u=h.exports,l=s(3),d=i.a.extend({name:"AttributesSelectionMenu",props:["menu"],data(){return{needConfirmation:!1,points:this.menu.points,selectedAttributes:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0},attributeNames:this.menu.attributeNames}},components:{MenuOption:u},methods:{onEvent(t){switch(t.key){case"a":return this.decrease(this.attributeNames[0]);case"A":return this.increase(this.attributeNames[0]);case"b":return this.decrease(this.attributeNames[1]);case"B":return this.increase(this.attributeNames[1]);case"c":return this.decrease(this.attributeNames[2]);case"C":return this.increase(this.attributeNames[2]);case"d":return this.decrease(this.attributeNames[3]);case"D":return this.increase(this.attributeNames[3]);case"e":return this.decrease(this.attributeNames[4]);case"E":return this.increase(this.attributeNames[4]);case"f":return this.decrease(this.attributeNames[5]);case"F":return this.increase(this.attributeNames[5]);case"*":return this.needConfirmation=!1,void([this.selectedAttributes,this.points]=Object(l.randomizeAttributes)(this.menu.baseAttributes,this.menu.points));case"R":case"r":return this.needConfirmation?this.menu.ready(this.selectedAttributes):void(this.needConfirmation=!0);case"=":return this.menu.back()}},attributeModifier:t=>0===t?"–":t>0?`+${t}`:t.toString(),keys:t=>["aA","bB","cC","dD","eE","fF"][t],totalAttribute(t){return this.menu.baseAttributes[t]+this.selectedAttributes[t]},canDecrease(t){return this.selectedAttributes[t]>0},canIncrease(t){return this.points>=this.totalAttribute(t)},increase(t){this.needConfirmation=!1,this.canIncrease(t)&&(this.points-=this.totalAttribute(t),this.selectedAttributes[t]+=1)},decrease(t){this.needConfirmation=!1,this.canDecrease(t)&&(this.selectedAttributes[t]-=1,this.points+=this.totalAttribute(t))}}}),p=(s(205),Object(c.a)(d,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("div",{staticClass:"subtitle"},[t._v("Choose your attributes:")]),s("table",[s("thead",[s("tr",{staticClass:"attribute-row -head"},[s("th"),s("th",{staticClass:"name"},[t._v(t._s(t._f("t")("name","presenters.primaryAttributeSelection")))]),s("th",{staticClass:"racial"},[t._v(t._s(t._f("t")("racial","presenters.primaryAttributeSelection")))]),s("th",{staticClass:"gender"},[t._v(t._s(t._f("t")("gender","presenters.primaryAttributeSelection")))]),s("th",{staticClass:"base"},[t._v(t._s(t._f("t")("base","presenters.primaryAttributeSelection")))]),s("th",{staticClass:"selected"},[t._v(t._s(t._f("t")("selected","presenters.primaryAttributeSelection")))]),s("th",{staticClass:"total"},[t._v(t._s(t._f("t")("total","presenters.primaryAttributeSelection")))])])]),s("tbody",t._l(t.attributeNames,function(e,i){return s("tr",{staticClass:"attribute-row"},[s("th",{staticClass:"key"},[t._v("["),s("div",{staticClass:"key"},[t._v(t._s(t.keys(i)))]),t._v("]")]),s("td",{staticClass:"name"},[t._v(t._s(t._f("t")(e,"primaryAttributes")))]),s("td",{staticClass:"racial"},[t._v(t._s(t.menu.racialAttributes[e]))]),s("td",{staticClass:"gender"},[t._v(t._s(t.attributeModifier(t.menu.genderAttributes[e])))]),s("td",{staticClass:"base"},[t._v(t._s(t.menu.baseAttributes[e]))]),s("td",{staticClass:"selected"},[s("a",{staticClass:"select-button float-left",class:{invisible:!t.canDecrease(e)},on:{click:function(s){t.decrease(e)}}},[t._v("-")]),t._v(t._s(t.attributeModifier(t.selectedAttributes[e]))),s("a",{staticClass:"select-button float-right",class:{invisible:!t.canIncrease(e)},on:{click:function(s){t.increase(e)}}},[t._v("+")])]),s("td",{staticClass:"total"},[t._v(t._s(t.totalAttribute(e)))])])}))]),s("div",{staticClass:"points mt-3"},[t._v(" "+t._s(t._f("t")("points","presenters.primaryAttributeSelection","",{points:t.points})))]),s("div",{staticClass:"menu-options"},[s("MenuOption",{attrs:{char:"R",name:t.needConfirmation?"Confirm":"Ready"}}),s("MenuOption",{attrs:{char:"*",name:"Random",separator:!0}}),s("MenuOption",{attrs:{char:"=",name:"Back"}})],1)])},[],!1,null,"78106fd2",null));p.options.__file="AttributesSelectionMenu.vue";var m=p.exports,f=i.a.extend({name:"ChooseGenderMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"M":return this.menu.withGender(l.Gender.Male);case"F":return this.menu.withGender(l.Gender.Female);case"*":return this.menu.random();case"=":return this.menu.back()}}}}),g=Object(c.a)(f,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("Choose a gender:")]),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"M",name:"Male"}}),e("MenuOption",{attrs:{char:"F",name:"Female"}}),e("MenuOption",{attrs:{char:"*",name:"Random",separator:!0}}),e("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,null,null);g.options.__file="ChooseGenderMenu.vue";var v=g.exports;var y=i.a.extend({name:"ChooseProfessionMenu",props:["menu"],data:()=>({pickedProfession:void 0}),computed:{ready(){return void 0!==this.pickedProfession}},methods:{onEvent(t){switch(t.key){case"Enter":return void(this.pickedProfession&&this.menu.withProfession(this.pickedProfession));case"=":return this.menu.back();default:return this.selectAt(t.key.charCodeAt(0)-97)}},selectAt(t){const e=this.menu.professions[t];this.pickedProfession=e||this.pickedProfession},iconPath:t=>`assets/professions/${t}.svg`},components:{MenuOption:u}}),b=(s(207),Object(c.a)(y,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("div",{staticClass:"subtitle"},[t._v("Choose your profession:")]),s("div",{staticClass:"professions-list"},t._l(t.menu.professions,function(e,i){return s("div",{staticClass:"profession-option",class:{"-picked":e===t.pickedProfession},on:{click:function(s){t.pickedProfession=e}}},[s("img",{staticClass:"icon",attrs:{src:t.iconPath(e.name)}}),s("div",{staticClass:"note"},[s("span",{staticClass:"key"},[t._v("["),s("span",{staticClass:"char"},[t._v(t._s(t._f("indexLetter")(i)))]),t._v("]\n")]),s("span",{staticClass:"name"},[t._v(t._s(t._f("t")(e.name,"professions")))])])])})),s("div",{staticClass:"menu-options"},[t.ready?s("MenuOption",{attrs:{char:"Enter",name:"Done",separator:!0}}):t._e(),s("MenuOption",{attrs:{char:"=",name:"Back",separator:!t.ready}})],1)])},[],!1,null,"522a786e",null));b.options.__file="ChooseProfessionMenu.vue";var w=b.exports,T=i.a.extend({name:"ChooseRaceMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"H":return this.menu.withRace(l.humanRace);case"D":return this.menu.withRace(l.dwarfRace);case"*":return this.menu.random();case"=":return this.menu.back()}}}}),C=Object(c.a)(T,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("You are "+this._s(this.menu.gender)+". Choose a race:")]),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"H",name:"Human"}}),e("MenuOption",{attrs:{char:"D",name:"Dwarf"}}),e("MenuOption",{attrs:{char:"*",name:"Random",separator:!0}}),e("MenuOption",{attrs:{char:"=",name:"Back",separator:!0}})],1)])},[],!1,null,null,null);C.options.__file="ChooseRaceMenu.vue";var P=C.exports,x=i.a.extend({name:"EnterNameMenu",props:["menu"],data:()=>({name:""}),components:{MenuOption:u},computed:{ready(){return this.name.length>0}},methods:{onEvent(t){switch(t.key){case"Backspace":return void(this.name=this.name.slice(0,-1));case"Enter":return void(this.ready&&this.menu.withName(this.name));case"=":return this.menu.back();default:1===t.key.length&&this.name.length<this.menu.maxLength&&(this.name=this.name.concat(t.key))}}}}),M=Object(c.a)(x,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("What's your name: "+this._s(this.name))]),e("div",{staticClass:"menu-options"},[this.ready?e("MenuOption",{attrs:{char:"Enter",name:"Done"}}):this._e(),e("MenuOption",{attrs:{char:"=",name:"Back"}})],1)])},[],!1,null,null,null);M.options.__file="EnterNameMenu.vue";var k=M.exports,I=i.a.extend({name:"PlayerBackground",props:["player"]}),_=(s(209),Object(c.a)(I,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"background my-3"},[s("p",[t._v("You were born "+t._s(t._f("t")(t.player.specie.gender,"genders"))+" "+t._s(t.player.specie.race.name))]),s("p",[t._v("Your parents were "+t._s(t._f("t")(t.player.specie.parentsProfession.name,"professions"))+".")]),s("p",[t._v("During your live you obtained basic skills of "+t._s(t._f("t")(t.player.specie.ownProfession.name,"professions"))+".")]),s("p",[t._v("Now at age "+t._s(t.player.age||30)+" you decided to begin your journey.")])])},[],!1,null,"3c8afd9a",null));_.options.__file="PlayerBackground.vue";var E=_.exports,O=i.a.extend({name:"HistoryMenu",props:["menu"],components:{MenuOption:u,PlayerBackground:E},methods:{onEvent(t){switch(t.key.toUpperCase()){case"N":return this.menu.next()}}}}),S=Object(c.a)(O,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle"},[this._v("Background")]),e("PlayerBackground",{attrs:{player:this.menu.player}}),e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"N",name:"Next"}})],1)],1)},[],!1,null,null,null);S.options.__file="BackgroundMenu.vue";var D=S.exports,R=i.a.extend({name:"MainMenu",props:["menu"],components:{MenuOption:u},methods:{onEvent(t){switch(t.key.toUpperCase()){case"N":return this.menu.newGame()}}}}),A=Object(c.a)(R,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"menu-options"},[e("MenuOption",{attrs:{char:"N",name:"New game"}}),e("MenuOption",{attrs:{char:"T",name:"Tutorial"}}),e("MenuOption",{attrs:{char:"R",name:"Random challenge"}})],1)])},[],!1,null,null,null);A.options.__file="MainMenu.vue";var N=A.exports,B=s(0);var W=i.a.extend({name:"TalentsPage",props:["screen","pickingEnabled"],data(){return{picked:void 0,pickedProfession:this.screen.professions[0]}},computed:{nameToLetter(){let t={},e=0;for(let s of this.pickedProfession.grid)for(let i of s)i&&(t[i.name]=String.fromCharCode(97+e++));return t}},methods:{confirmPick(t){const e=t||this.picked;e&&e.status(this.pickedProfession)===B.TalentStatus.Available&&(this.$emit("pickTalent",this.pickedProfession,e),this.picked=void 0)},pickProfession(t){t&&this.pickedProfession&&this.pickedProfession.name!==t.name&&(this.picked=void 0,this.pickedProfession=t)},pickTalent(t){this.pickingEnabled&&t.status(this.pickedProfession)===B.TalentStatus.Available&&(this.picked=t)},onEvent(t){switch(t.key){case"1":case"2":case"3":case"4":case"5":case"6":return this.pickProfession(this.screen.professions[parseInt(t.key)-1]);case" ":case"Enter":return this.confirmPick();default:for(let e of this.pickedProfession.talents)if(this.nameToLetter[e.name]===t.key){this.pickTalent(e);break}}},talentTip(t){let e=`${t.rank}/${t.maxRank}`;return this.pickingEnabled&&t.status(this.pickedProfession)===B.TalentStatus.Available?`${this.nameToLetter[t.name]} ${e}`:e},talentPickedStatus(t){if(this.picked&&this.picked.name===t.name)return"-selected";switch(t.status(this.pickedProfession)){case B.TalentStatus.Available:return"-available";case B.TalentStatus.Unavailable:return"-unavailable";case B.TalentStatus.Completed:return"-completed"}},iconPath:t=>`${t.name}.svg`}}),$=(s(211),Object(c.a)(W,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"simple-popover talents-container",attrs:{id:"talents-container"}},[s("div",{staticClass:"professions"},t._l(t.screen.professions,function(e,i){return s("div",{key:e.id,staticClass:"profession-block",class:{"-active":e.name==t.pickedProfession.name},on:{click:function(s){t.pickProfession(e)}}},[t._v("["),s("div",{staticClass:"key"},[t._v(t._s(i+1))]),t._v("] "+t._s(t._f("t")(e.name,"professions"))+" ("+t._s(e.level)+")")])})),s("div",{staticClass:"talents"},[s("div",{staticClass:"subtitle mb-3"},[t._v(t._s(t._f("t")("talentsTaken","presenters.talentsPage","",{count:t.pickedProfession.points})))]),s("table",t._l(t.pickedProfession.grid,function(e,i){return s("tr",{key:i},t._l(e,function(e,r){return s("td",{key:r,staticClass:"cell"},[e?s("div",{staticClass:"talent-cell",class:t.talentPickedStatus(e),attrs:{id:r+"talentTree-"+i,variant:"primary",dblclick:"confirmPick(talent)"},on:{click:function(s){t.pickTalent(e)}}},[s("img",{staticClass:"icon",attrs:{src:"assets/talents/"+t.iconPath(e)}}),s("span",{staticClass:"level"},[t._v(t._s(t.talentTip(e)))]),s("b-popover",{attrs:{target:r+"talentTree-"+i,triggers:"hover",container:"talents-container"}},[[s("p",{staticClass:"name"},[t._v(t._s(t._f("t")(e.name,"talents","name")))]),s("small",[s("p",{staticClass:"rank"},[t._v(t._s(t._f("t")("rank","presenters.talentsPage","",{current:e.rank,max:e.maxRank})))]),"-unavailable"===t.talentPickedStatus(e)?s("p",{staticClass:"requirements"},[t._v(t._s(t._f("t")("requirements","presenters.talentsPage","",{req:e.depth*t.pickedProfession.depthCost}))+"\n"+t._s(t._f("t")(t.pickedProfession.name,"professions")))]):t._e(),s("p",{staticClass:"description"},[t._v(t._s(t._f("t")(e.name,"talents","description")))])])]],2)],1):t._e()])}))}))]),t.picked?s("b-btn",{staticClass:"confirm",attrs:{variant:"default"},on:{click:function(e){t.confirmPick()}}},[t._v("Подтвердить")]):t._e()],1)},[],!1,null,"7ee95f8b",null));$.options.__file="TalentsPage.vue";var L=$.exports,j=i.a.extend({name:"HistoryMenu",props:["menu"],components:{TalentsPage:L},methods:{onEvent(t){this.$refs.talentsComponent.onEvent(t)},pickTalent(t,e){this.menu.pickTalent(t,e)}}}),G=Object(c.a)(j,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"subtitle mb-3"},[this._v("Pick talents ("+this._s(this.menu.points)+" left)")]),e("TalentsPage",{ref:"talentsComponent",attrs:{screen:this.menu.talentsPage,"picking-enabled":!0},on:{pickTalent:this.pickTalent}})],1)},[],!1,null,null,null);G.options.__file="PickTalentsMenu.vue";var H=G.exports,F=s(2),U=i.a.extend({name:"Logger",props:{logger:{type:B.Logger,required:!0}},data:()=>({lastId:0}),computed:{messages(){const t=this.logger.messages.length,e=Object(F.takeRight)(this.logger.messages,Math.max(t-this.lastId,5));return this.lastId=t,e}},methods:{counter(t){if(t>1)return`x${t}`},rowClass(t){switch(t.level){case B.LogLevel.DEBUG:return"debug";case B.LogLevel.INFO:return"info";case B.LogLevel.WARNING:return"warning";case B.LogLevel.DANGER:return"danger"}}}}),q=(s(213),Object(c.a)(U,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"logger"},t._l(t.messages,function(e,i){return s("div",{key:i,class:t.rowClass(e)},[t._v(t._s(e.message)+"\n"+t._s(t.counter(e.counter)))])}))},[],!1,null,"4926948c",null));q.options.__file="Logger.vue";var V=q.exports;class z{constructor(t,e,s,i,r,n,a){this.ch=t,this.r=e,this.g=s,this.b=i,this.br=r,this.bg=n,this.bb=a}getChar(){return this.ch}setChar(t){this.ch=t}setColor(t,e,s){this.r=t,this.g=e,this.b=s}setGrey(t){this.r=t,this.g=t,this.b=t}setBackground(t,e,s){this.br=t,this.bg=e,this.bb=s}backgroundToColor(){this.r=this.br,this.g=this.bg,this.b=this.bb}swapColors(){this.r=[this.br,this.br=this.r][0],this.g=[this.bg,this.bg=this.g][0],this.b=[this.bb,this.bb=this.b][0]}resetColor(){this.r=this.g=this.b=void 0}resetBackground(){this.br=this.bg=this.bb=void 0}getColorHex(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""}getBackgroundHex(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""}getColorRGB(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?`rgb(${this.r},${this.g},${this.b})`:""}getBackgroundRGB(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?`rgb(${this.br},${this.bg},${this.bb})`:""}getColorJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}}getBackgroundJSON(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}}copy(t){this.ch=t.ch,this.r=t.r,this.g=t.g,this.b=t.b,this.br=t.br,this.bg=t.bg,this.bb=t.bb}clone(){return new z(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)}}const Y="unicodetiles",X=new z(" ");const K="\nattribute vec2 position;\nattribute vec2 texCoord;\nattribute vec3 color;\nattribute vec3 bgColor;\nattribute float charIndex;\nuniform vec2 uResolution;\nuniform vec2 uTileCounts;\nuniform vec2 uPadding;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec2 tileCoords = floor(vec2(mod(charIndex, uTileCounts.x), charIndex / uTileCounts.x));\n  vTexCoord = (texCoord + tileCoords) / uTileCounts;\n  vTexCoord += (0.5 - texCoord) * uPadding;\n  vColor = color;\n  vBgColor = bgColor;\n  vec2 pos = position / uResolution * 2.0 - 1.0;\n  gl_Position = vec4(pos.x, -pos.y, 0.0, 1.0);\n}\n",J="\nprecision mediump float;\nuniform sampler2D uFont;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\nvarying vec3 vBgColor;\n\nvoid main() {\n  vec4 color = texture2D(uFont, vTexCoord);\n  color.rgb = mix(vBgColor, vColor, color.rgb);\n  gl_FragColor = color;\n}\n";const Q=function(t){return new class{constructor(t){if(this.view=t,this.view=t,this.canvas=document.createElement("canvas"),!this.canvas.getContext)throw"Canvas not supported";if(this.gl=this.canvas.getContext("experimental-webgl"),!this.gl)throw"WebGL not supported";if(t.elem.appendChild(this.canvas),this.charMap={},this.charArray=[],this.defaultColors={r:1,g:1,b:1,br:0,bg:0,bb:0},this.attribs={position:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},texCoord:{buffer:null,data:null,itemSize:2,location:null,hint:this.gl.STATIC_DRAW},color:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},bgColor:{buffer:null,data:null,itemSize:3,location:null,hint:this.gl.DYNAMIC_DRAW},charIndex:{buffer:null,data:null,itemSize:1,location:null,hint:this.gl.DYNAMIC_DRAW}},this.offscreen||(this.offscreen=document.createElement("canvas")),this.offscreen.style.position="absolute",this.offscreen.style.top="0px",this.offscreen.style.left="0px",this.ctx=this.offscreen.getContext("2d"),!this.ctx)throw"Failed to acquire offscreen canvas drawing context";this.updateStyle(),this.canvas.width=(t.squarify?this.th:this.tw)*t.w,this.canvas.height=this.th*t.h,this.offscreen.width=0,this.offscreen.height=0,this.updateStyle(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height);let e=this.compileShader(this.gl.VERTEX_SHADER,K),s=this.compileShader(this.gl.FRAGMENT_SHADER,J),i=this.gl.createProgram();if(this.gl.attachShader(i,e),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.deleteShader(e),this.gl.deleteShader(s),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS)){const t=`Error linking program: ${this.gl.getProgramInfoLog(i)}`;throw this.gl.deleteProgram(i),t}this.gl.useProgram(i),this.attribs.position.location=this.gl.getAttribLocation(i,"position"),this.attribs.texCoord.location=this.gl.getAttribLocation(i,"texCoord"),this.attribs.color.location=this.gl.getAttribLocation(i,"color"),this.attribs.bgColor.location=this.gl.getAttribLocation(i,"bgColor"),this.attribs.charIndex.location=this.gl.getAttribLocation(i,"charIndex"),this.initBuffers();let r=this.gl.getUniformLocation(i,"uResolution");this.gl.uniform2f(r,this.canvas.width,this.canvas.height),this.tileCountsLocation=this.gl.getUniformLocation(i,"uTileCounts"),this.gl.uniform2f(this.tileCountsLocation,this.view.w,this.view.h),this.paddingLocation=this.gl.getUniformLocation(i,"uPadding"),this.gl.uniform2f(this.paddingLocation,0,0);let n=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.cacheChars(" !\"#$%&'()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.activeTexture(this.gl.TEXTURE0),setTimeout(()=>{this.updateStyle(),this.buildTexture(),this.render()},100)}getRendererString(){return"webgl"}buildTexture(){let t=this.offscreen.width/(this.tw+this.pad),e=this.offscreen.height/(this.th+this.pad);const s=this.charArray.length;s>Math.floor(t)*Math.floor(e)&&(e=(t=Math.ceil(Math.sqrt(s)))+2,this.offscreen.width=t*(this.tw+this.pad),this.offscreen.height=e*(this.th+this.pad),this.updateStyle(),this.gl.uniform2f(this.tileCountsLocation,t,e)),this.gl.uniform2f(this.paddingLocation,this.pad/this.offscreen.width,this.pad/this.offscreen.height);let i,r=0;this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.offscreen.width,this.offscreen.height),this.ctx.fillStyle="#ffffff";const n=.5*this.gap,a=this.tw+this.pad,o=this.th+this.pad;let c=.5*o;for(let s=0;s<e;++s){let e=.5*this.pad;for(let s=0;s<t&&void 0!==(i=this.charArray[r]);++s,++r)this.ctx.fillText(i,e+n,c),e+=a;if(!i)break;c+=o}this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.offscreen)}cacheChars(t,e=!0){if(!this.gl)return;let s=!1;for(let e=0;e<t.length;++e)this.charMap[t[e]]||(s=!0,this.charArray.push(t[e]),this.charMap[t[e]]=this.charArray.length-1);s&&e&&this.buildTexture()}updateStyle(t){t=t||window.getComputedStyle(this.view.elem,null),this.ctx.font=t.fontSize+"/"+t.lineHeight+" "+t.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="#ffffff",this.tw=this.ctx.measureText("幅").width,this.th=parseInt(t.fontSize,10),this.gap=this.view.squarify?this.th-this.tw:0,this.view.squarify&&(this.tw=this.th),this.pad=2*Math.ceil(.2*this.th);const e=t.color.match(/\d+/g),s=t.backgroundColor.match(/\d+/g);this.defaultColors.r=parseInt(e[0],10)/255,this.defaultColors.g=parseInt(e[1],10)/255,this.defaultColors.b=parseInt(e[2],10)/255,this.defaultColors.br=parseInt(s[0],10)/255,this.defaultColors.bg=parseInt(s[1],10)/255,this.defaultColors.bb=parseInt(s[2],10)/255}clear(){}render(){this.gl.clear(this.gl.COLOR_BUFFER_BIT);const t=this.view.w,e=this.view.h;let s=this.view.buffer,i=(this.view.defaultColor,this.view.defaultBackground,!1);for(let r=0;r<e;++r)for(let e=0;e<t;++e){const n=s[r][e];let a=this.charMap[n.ch];void 0===a&&(this.cacheChars(n.ch,!1),i=!0,a=this.charMap[n.ch]);const o=6*this.attribs.color.itemSize*(r*t+e),c=6*this.attribs.charIndex.itemSize*(r*t+e),h=void 0===n.r?this.defaultColors.r:n.r/255,u=void 0===n.g?this.defaultColors.g:n.g/255,l=void 0===n.b?this.defaultColors.b:n.b/255,d=void 0===n.br?this.defaultColors.br:n.br/255,p=void 0===n.bg?this.defaultColors.bg:n.bg/255,m=void 0===n.bb?this.defaultColors.bb:n.bb/255;for(let t=0;t<6;++t){const e=o+t*this.attribs.color.itemSize;this.attribs.color.data[e+0]=h,this.attribs.color.data[e+1]=u,this.attribs.color.data[e+2]=l,this.attribs.bgColor.data[e+0]=d,this.attribs.bgColor.data[e+1]=p,this.attribs.bgColor.data[e+2]=m,this.attribs.charIndex.data[c+t]=a}}i&&this.buildTexture(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.color.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.color.data,this.attribs.color.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.bgColor.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.bgColor.data,this.attribs.bgColor.hint),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attribs.charIndex.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.attribs.charIndex.data,this.attribs.charIndex.hint);const r=this.attribs.position;this.gl.drawArrays(this.gl.TRIANGLES,0,r.data.length/r.itemSize)}compileShader(t,e){const s=this.gl.createShader(t);if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const t="Error compiling shader: "+this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),t}return s}initBuffers(){let t,e,s=this.attribs;const i=this.view.w,r=this.view.h;for(t in this.attribs)(e=s[t]).data=new Float32Array(6*e.itemSize*i*r);for(let t=0;t<r;++t)for(let e=0;e<i;++e){const r=6*s.position.itemSize*(t*i+e);this.insertQuad(s.position.data,r,e*this.tw,t*this.th,this.tw,this.th),this.insertQuad(s.texCoord.data,r,0,0,1,1)}for(t in this.attribs)(e=s[t]).buffer&&this.gl.deleteBuffer(e.buffer),e.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e.data,e.hint),this.gl.enableVertexAttribArray(e.location),this.gl.vertexAttribPointer(e.location,e.itemSize,this.gl.FLOAT,!1,0,0)}insertQuad(t,e,s,i,r,n){const a=s,o=i,c=s+r,h=i+n;t[e]=a,t[++e]=o,t[++e]=c,t[++e]=o,t[++e]=a,t[++e]=h,t[++e]=a,t[++e]=h,t[++e]=c,t[++e]=o,t[++e]=c,t[++e]=h}}(t)},Z=120,tt=180,et={r:255,g:165,b:0};class st extends z{lighted(t){return this}constructor(t,e=Z,s=Z,i=Z){super(t,e,s,i)}litBackground(t,e){return t.setBackground(et.r*e,et.g*e,et.b*e),t}litColor(t,e){return t.setColor(et.r*e,et.g*e,et.b*e),t}}class it extends st{constructor(t){super(t,tt,tt,tt)}}class rt extends it{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}class nt extends st{constructor(){super("＋")}lighted(t){let e=this.clone();return this.litColor(e,t),e.swapColors(),e}}class at extends st{constructor(t,e,s,i){super(t),this.vr=e,this.vg=s,this.vb=i}lighted(t){let e=this.clone();return e.setColor(this.vr,this.vg,this.vb),e}}const ot=new at("刀",200,200,200),ct=new at("体",200,200,200),ht=new at("胸",200,200,200),ut=new at("石",200,200,200),lt=new at("]",200,200,200),dt=new at("[",255,255,0),pt=new at("?",255,255,255),mt=new at("！",200,200,200),ft=function(t){switch(t.group){case l.ItemGroup.OneHandWeapon:return ot;case l.ItemGroup.Consumable:return ct;case l.ItemGroup.BodyArmor:return ht;case l.ItemGroup.Missile:return ut;case l.ItemGroup.MissileWeapon:return lt;case l.ItemGroup.Potion:return mt;case l.ItemGroup.Boots:return dt;case l.ItemGroup.Scrolls:return pt;default:return ct}},gt=new nt,vt=new class extends nt{lighted(t){let e=this.clone();return this.litColor(e,t),e}},yt=new class extends st{constructor(){super("＃")}lighted(t){let e=this.clone();return this.litBackground(e,t),e.backgroundToColor(),e}},bt=new class extends st{constructor(){super("・")}lighted(t){return this.litColor(this.clone(),t)}},wt=new class extends st{constructor(){super("＞")}},Tt=new class extends st{constructor(){super("＜")}},Ct=new st("　",0,0,0),Pt=new st("^",255,255,255),xt=new st("^",0,191,255),Mt=new st("^",255,255,0),kt=new st("^",139,69,19),It=new st("^",255,165,0),_t=new st("^",200,200,200),Et=new st("^",0,0,205);const Ot=new class extends l.TileVisitor{onWall(t){this.tile=yt}onFloor(t){this.tile=bt}onStairwayDown(t){this.tile=wt}onStairwayUp(t){this.tile=Tt}onDoor(t){t.open?this.tile=vt:this.tile=gt}onTrap(t){if(t.revealed)switch(t.type){case l.TrapType.AirBlow:this.tile=Pt;break;case l.TrapType.Teleportation:this.tile=xt;break;case l.TrapType.Light:this.tile=Mt;break;case l.TrapType.Hole:this.tile=kt;break;case l.TrapType.BareWire:this.tile=It;break;case l.TrapType.FallingRock:this.tile=_t;break;case l.TrapType.Water:this.tile=Et}else t.tile.visit(this)}onTrigger(t){t.tile.visit(this)}default(t){this.tile=Ct}},St=new rt("＠",0,255,0),Dt=new rt("r",197,65,38),Rt=new rt("G",120,120,120),At=new st("　",0,0,0),Nt=[new at("｜",200,200,200),new at("／",200,200,200),new at("ー",200,200,200),new at("＼",200,200,200)];var Bt=i.a.extend({props:["level","player","pos"],data:()=>({wholeMap:!1,term:null,eng:null,drawInterval:null,ts:Date.now(),interval:100,step:0}),methods:{getTile(t,e){const s=this.stage.at(t,e).effect,i=this.wholeMap?this.stage.at(t,e):this.stage.at(t,e).tile;if(!i)return At;if(s){if(i.creature){let t=this.creatureTile(i.creature).clone();return t.setBackground(200,0,0),t}return new st(s,200,200,0)}if(i.creature)return this.creatureTile(i.creature);if(i.items)switch(i.items.bunch.length){case 0:break;case 1:return ft(i.items.bunch[0].item);default:const t=this.step%(3*this.animationFps+4);if(t<Nt.length)return Nt[t];{const t=Math.floor(this.step/(3*this.animationFps+4));return ft(i.items.bunch[t%i.items.bunch.length].item)}}return function(t){return t.visit(Ot),Ot.tile}(i)},creatureTile:t=>"Rat"==t.name?Dt:"Golem"==t.name?Rt:St,initViewport(){this.term=new class{constructor(t,e,s,i,r=!1){this.elem=t,this.w=e,this.h=s,this.squarify=r,this.cx=Math.floor(e/2),this.cy=Math.floor(s/2),this.elem.innerHTML="",-1===t.className.indexOf(Y)&&(0===t.className.length?t.className=Y:t.className+=" "+Y),this.buffer=new Array(s);for(let t=0;t<s;++t){this.buffer[t]=new Array(e);for(let s=0;s<e;++s)this.buffer[t][s]=X}this.renderer=i(this)}updateStyle(t){const e=window.getComputedStyle(this.elem,null);this.defaultColor=e.color||void 0,this.defaultBackground=e.backgroundColor||void 0,t&&this.renderer.updateStyle(e)}getRendererString(){return this.renderer.getRendererString()}put(t,e,s){e<0||s<0||e>=this.w||s>=this.h||(this.buffer[s][e]=t)}unsafePut(t,e,s){this.buffer[s][e]=t}putString(t,e,s,i,r,n,a,o,c){const h=t.length;if(!(e<0||s<0))for(let u=0;u<h;++u){if(e>=this.w&&(e=0,++s),s>=this.h)return;const h=new z(t[u],i,r,n,a,o,c);this.unsafePut(h,e,s),++e}}get(t,e){return t<0||e<0||t>=this.w||e>=this.h?X:this.buffer[e][t]}clear(){for(let t=0;t<this.h;++t)for(let e=0;e<this.w;++e)this.buffer[t][e]=X;this.renderer.clear()}render(){this.renderer.render()}}(this.$refs.scene,Math.max(this.level.width,40),Math.max(this.level.height,40),Q,!0),this.eng=new class{constructor(t,e,s,i){this.viewport=t,this.tileFunc=e,this.w=s,this.h=i,this.refreshCache=!0,this.cacheEnabled=!1,this.transitionDuration=0,this.cachex=0,this.cachey=0,this.tileCache=new Array(t.h),this.tileCache2=new Array(t.h);for(let e=0;e<t.h;++e)this.tileCache[e]=new Array(t.w),this.tileCache2[e]=new Array(t.w)}setTileFunc(t,e,s){e&&(this.transition=void 0,"string"==typeof e&&("boxin"===e?this.transition=function(t,e,s,i,r,n,a){const o=.5*s,c=.5*i;return t-=o,e-=c,Math.abs(t)<o*a&&Math.abs(e)<c*a?r:n}:"boxout"===e?this.transition=function(t,e,s,i,r,n,a){const o=.5*s,c=.5*i;return t-=o,e-=c,a=1-a,Math.abs(t)<o*a&&Math.abs(e)<c*a?n:r}:"circlein"===e?this.transition=function(t,e,s,i,r,n,a){const o=.5*s,c=.5*i;return(t-=o)*t+(e-=c)*e<(o*o+c*c)*a?r:n}:"circleout"===e?this.transition=function(t,e,s,i,r,n,a){const o=.5*s,c=.5*i;return(t-=o)*t+(e-=c)*e>(o*o+c*c)*(a=1-a)?r:n}:"random"===e&&(this.transition=function(t,e,s,i,r,n,a){return Math.random()>a?n:r})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=s||500)),this.tileFunc=t}setMaskFunc(t){this.maskFunc=t}setShaderFunc(t){this.shaderFunc=t}setWorldSize(t,e){this.w=t,this.h=e}setCacheEnabled(t){this.cacheEnabled=t,this.refreshCache=!0}update(t,e){t=t||0,e=e||0;const s=t-this.viewport.cx,i=e-this.viewport.cy,r=(new Date).getTime();let n,a;this.transition&&this.transitionTimer&&(n=(r-this.transitionTimer)/this.transitionDuration),n&&n>=1&&(this.transition=void 0);for(let t=0;t<this.viewport.h;++t)for(let e=0;e<this.viewport.w;++e){const o=e+s,c=t+i;if(this.w&&(o<0||o>=this.w))a=X;else if(this.h&&(c<0||c>=this.h))a=X;else if(this.maskFunc&&!this.maskFunc(o,c))a=X;else if(this.transition&&!this.refreshCache)a=this.transition(e,t,this.viewport.w,this.viewport.h,this.tileFunc(o,c),this.tileCache[t][e],n||0);else if(this.cacheEnabled&&!this.refreshCache){const t=o-this.cachex,e=c-this.cachey;t>=0&&t<this.viewport.w&&e>=0&&e<this.viewport.h?(a=this.tileCache[e][t])===X&&(a=this.tileFunc(o,c)):a=this.tileFunc(o,c)}else a=this.tileFunc(o,c);this.tileCache2[t][e]=a,this.shaderFunc&&a!==X&&(a=this.shaderFunc(a,o,c,r)),this.viewport.unsafePut(a,e,t)}this.cachex=s,this.cachey=i;const o=this.tileCache;this.tileCache=this.tileCache2,this.tileCache2=o,this.refreshCache=!1}}(this.term,(t,e)=>this.getTile(t,e),this.level.width,this.level.height),this.eng.setMaskFunc((t,e)=>this.wholeMap||this.stage.at(t,e).seen),this.eng.setShaderFunc((t,e,s,i)=>this.lighting(t,e,s,i)),clearInterval(this.drawInterval),this.drawInterval=setInterval(()=>{this.drawScene()},this.interval)},drawScene(){const t=Date.now();this.ts+1e3<t&&(this.ts=t),this.eng.update(this.pos.x,this.pos.y),this.term.render(),this.step+=1},lighting(t,e,s,i){if(this.wholeMap)return t.lighted(1);const r=this.stage.at(e,s);return r.visible&&t.lighted?t.lighted(r.degree):t}},computed:{stage(){return this.wholeMap?this.level:this.player.stageMemory(this.level)},animationFps(){return 1e3/this.interval}},mounted(){this.initViewport()},beforeDestroy(){clearInterval(this.drawInterval)},watch:{interval(){this.initViewport()},level(){clearInterval(this.drawInterval),this.initViewport()}}}),Wt=(s(215),Object(c.a)(Bt,function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"scene",staticClass:"unicodetiles"})},[],!1,null,null,null));Wt.options.__file="Scene.vue";var $t=Wt.exports,Lt=i.a.extend({name:"PrimaryAttribute",props:["name","slug","attr","fullName"],computed:{id(){return`${this.slug}-container`},modifier(){return Object(F.sum)(this.attr.modifiers)}}}),jt=Object(c.a)(Lt,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"simple-popover",attrs:{id:t.id}},[s("div",{staticClass:"title"},[t._v(t._s(t.name))]),s("div",{staticClass:"value"},[t._v(t._s(t.attr.current))]),s("b-popover",{attrs:{target:t.id,triggers:"hover",container:t.id,placement:"top"}},[[s("big",{staticClass:"name"},[t._v(t._s(t.fullName))]),s("p",[s("span",{staticClass:"name"},[t._v("Базовый:")]),t._v(" "),s("span",{staticClass:"description"},[t._v(t._s(t.attr.current))])]),s("p",[s("span",{staticClass:"name"},[t._v("Модификатор:")]),t._v(" "),s("span",{staticClass:"description"},[t._v(t._s(t.modifier))])])]],2)],1)},[],!1,null,null,null);jt.options.__file="PrimaryAttribute.vue";var Gt=jt.exports;const Ht=function({extra:t,dice:{times:e,max:s},type:i}){let r=`${Ft(i)} ${e}d${s}`;return t&&(r+=`+${t}`),r},Ft=function(t){switch(t){case l.DamageType.Melee:return"Me";case l.DamageType.Pierce:return"Pi";case l.DamageType.Blunt:return"B";case l.DamageType.Magic:return"Mg";case l.DamageType.Pure:return"Pu";default:return"unknown damage type"}},Ut=function({type:t,value:e}){switch(t){case l.ProtectionType.Light:return`L${e}`;case l.ProtectionType.Medium:return`M${e}`;case l.ProtectionType.Heavy:return`H${e}`;case l.ProtectionType.Solid:return`S${e}`;case l.ProtectionType.Unarmored:return`U${e}`;default:return"unknown protection type"}};var qt=i.a.extend({name:"Stats",props:["creature","levelMap"],components:{PrimaryAttribute:Gt},computed:{levelProgress(){const t=this.creature.level;return`${t.currentExperience/t.requiredExperience*100}%`},healthLevel(){const t=this.creature.health;return`${t.currentValue/(t.maximum||0)*100}%`},protections(){return this.creature.protections.map(Ut).join(", ")},damages(){return this.creature.damages.map(Ht).join(", ")}},methods:{displayAttribute:t=>t.currentValue!=t.maximum?`${t.currentValue} / ${t.maximum}`:t.currentValue}}),Vt=(s(217),Object(c.a)(qt,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"panel container"},[s("div",{staticClass:"level cell"},[s("div",{staticClass:"value"},[t._v(t._s(t.creature.level.current))]),s("div",{staticClass:"note"},[t._v("Уровень"),s("div",{staticClass:"progress"},[s("div",{staticClass:"progress-bar bg-success",style:{width:t.levelProgress},attrs:{role:"progressbar"}})])])]),s("div",{staticClass:"hp cell"},[s("div",{staticClass:"value"},[t._v(t._s(t.displayAttribute(t.creature.health)))]),s("div",{staticClass:"bar",style:{height:t.healthLevel}})]),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"strength",name:"St","full-name":"Сила",attr:t.creature.strength}}),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"dexterity",name:"Dx","full-name":"Ловкость",attr:t.creature.dexterity}}),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"constitution",name:"Co","full-name":"Телосложение",attr:t.creature.constitution}}),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"intelligence",name:"In","full-name":"Интеллект",attr:t.creature.intelligence}}),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"wisdom",name:"Ws","full-name":"Мудрость",attr:t.creature.wisdom}}),s("PrimaryAttribute",{staticClass:"attribute",attrs:{slug:"charisma",name:"Ch","full-name":"Харизма",attr:t.creature.charisma}}),s("div",{staticClass:"cell"},[s("div",{staticClass:"value"},[t._v(t._s(t.levelMap.name))])]),s("div",{staticClass:"cell"},[s("div",{staticClass:"value"},[t._v(t._s(t.protections))])]),s("div",{staticClass:"cell"},[s("div",{staticClass:"value"},[t._v(t._s(t.damages))])])],1)},[],!1,null,"20a5072e",null));Vt.options.__file="Stats.vue";var zt=Vt.exports,Yt=i.a.extend({name:"Impacts",props:["impacts"],methods:{icon(t){switch(t){case B.ImpactType.Blind:return"blind";case B.ImpactType.Stressed:case B.ImpactType.Loaded:case B.ImpactType.Overloaded:return"weight"}},title(t){switch(t){case B.ImpactType.Blind:return"Слепота";case B.ImpactType.Stressed:return"Нагружен";case B.ImpactType.Loaded:return"Груженый";case B.ImpactType.Overloaded:return"Перегруженый"}}}}),Xt=(s(219),Object(c.a)(Yt,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"panel"},t._l(t.impacts,function(e){return s("div",{staticClass:"impact-block"},[s("img",{staticClass:"icon",attrs:{src:"assets/impacts/"+t.icon(e)+".svg"}}),s("div",{staticClass:"title",domProps:{textContent:t._s(t.title(e))}})])}))},[],!1,null,"436b0ad3",null));Xt.options.__file="Impacts.vue";var Kt=Xt.exports,Jt=i.a.extend({name:"IdleView",props:["screen"],methods:{onEvent(t){switch(t.key){case"l":case"ArrowRight":return this.screen.move(l.Direction.right);case"h":case"ArrowLeft":return this.screen.move(l.Direction.left);case"k":case"ArrowUp":return this.screen.move(l.Direction.up);case"j":case"ArrowDown":return this.screen.move(l.Direction.down);case"y":return this.screen.move(l.Direction.upLeft);case"u":return this.screen.move(l.Direction.upRight);case"b":return this.screen.move(l.Direction.downLeft);case"n":return this.screen.move(l.Direction.downRight);case"H":return this.screen.handleCommand();case"L":return this.screen.lookCommand();case"s":case".":return this.screen.stayCommand();case"i":case"#":return this.screen.inventoryCommand();case"I":return this.screen.bagCommand();case"t":return this.screen.missileCommand();case",":return this.screen.pickUpCommand();case"d":return this.screen.dropCommand();case"D":return this.screen.drinkCommand();case"@":return this.screen.goToBaseInfo();case"#":return this.screen.goToInventory();case"%":return this.screen.goToTalents();case"&":return this.screen.goToHistoryInfo();default:console.log("Key: ",t.key)}}}}),Qt=Object(c.a)(Jt,function(){var t=this.$createElement;return(this._self._c||t)("div")},[],!1,null,null,null);Qt.options.__file="IdleView.vue";var Zt=Qt.exports,te=i.a.extend({props:["screen"],data:()=>({picked:null}),methods:{close(t){const e=t||this.picked;e&&this.screen.pickProfession(e)},onEvent(t){switch(t.key){case"a":this.picked=this.screen.options[0];break;case"b":this.picked=this.screen.options[1];break;case" ":case"Enter":this.close();default:return}},iconPath:t=>`assets/professions/${t}.svg`}}),ee=(s(221),Object(c.a)(te,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"screen-modal text-center"},[s("div",{staticClass:"title"},[t._v(t._s(t._f("t")("title","presenters.professionPickingView","",{level:t.screen.level})))]),s("div",{staticClass:"content"},t._l(t.screen.options,function(e,i){return s("div",{key:e.id,staticClass:"option p-2 m-3",class:{picked:t.picked&&t.picked.id===e.id},on:{click:function(s){t.picked=e},dblclick:function(s){t.close(e)}}},[s("img",{staticClass:"icon",attrs:{src:t.iconPath(e.name)}}),t._v("["),s("span",{staticClass:"key"},[t._v(t._s(0===i?"a":"b"))]),t._v("]\n"),s("span",{staticClass:"name"},[t._v(t._s(t._f("t")(e.name,"professions")))]),s("div",[t._v(t._s(t._f("t")("rank","presenters.professionPickingView","",{level:e.level+1})))])])})),s("div",{staticClass:"bottom"},[null!==t.picked?s("b-btn",{attrs:{variant:"success"},on:{click:t.close}},[t._v("Подтвердить")]):t._e()],1)])},[],!1,null,"4527f8a2",null));ee.options.__file="ProfessionPickingView.vue";var se=ee.exports;var ie=i.a.extend({name:"Inventory",props:["screen"],data:()=>({page:0,perPage:20,selected:[]}),computed:{player(){return this.screen.player},carryingWeight(){return`Нагрузка ${Math.round(100*this.player.stuffWeight.current)/100} из ${this.player.carryingCapacity.stressed}`}},methods:{onEvent(t){switch(t.key){case"Escape":return this.screen.close();case"Enter":case" ":return this.screen.withItems(this.selected.map(t=>this.screen.positions[t]));default:return this.selectAt(t.key.charCodeAt(0)-97)}},selectAt(t){t>=0&&t<Math.min(this.perPage,this.screen.positions.length)&&(this.screen.singleItemMode?this.screen.withItem(this.screen.positions[t]):this.selected.indexOf(t)>=0?this.selected.splice(this.selected.indexOf(t),1):this.selected.push(t))},indexLetter:t=>String.fromCharCode(97+t),positionSelected(t){return this.selected.indexOf(t)>=0},positionStatus:t=>t.item?"text-success":"",itemWeight:t=>Math.round(t.item.weight*t.count*100)/100}}),re=(s(223),Object(c.a)(ie,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"screen-modal"},[s("span",{staticClass:"title"},[t._v(t._s(t.screen.title))]),s("div",{staticClass:"subtitle my-3",domProps:{textContent:t._s(t.carryingWeight)}}),s("table",{staticClass:"container positions-list"},t._l(t.screen.positions,function(e,i){return s("tr",{key:i,class:t.positionStatus(e)},[s("td",{staticClass:"selected"},[t.positionSelected(i)?s("div",{staticClass:"sign"},[t._v("+")]):t._e()]),s("td",{staticClass:"letter"},[t._v(t._s(t.indexLetter(i)))]),s("td",{staticClass:"separator"},[t._v("—")]),s("td",{staticClass:"name"},[t._v(t._s(e.item.name)+" ("+t._s(e.count)+")")]),s("td",{staticClass:"weight"},[t._v("["+t._s(t.itemWeight(e))+"kg]")])])}))])},[],!1,null,null,null));re.options.__file="ItemsListingView.vue";var ne=re.exports,ae=i.a.extend({props:["screen"],name:"TalentsPickingView",methods:{pickTalent(t,e){this.screen.pickTalent(t,e)},onEvent(t){this.$refs.talentsComponent.onEvent(t)}},components:{TalentsPage:L}}),oe=Object(c.a)(ae,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"screen-modal"},[e("div",{staticClass:"title"},[this._v(this._s(this._f("t")("title","presenters.talentsPickingView")))]),e("TalentsPage",{ref:"talentsComponent",attrs:{screen:this.screen.talentsPage,"picking-enabled":!0},on:{pickTalent:this.pickTalent}})],1)},[],!1,null,null,null);oe.options.__file="TalentsPickingView.vue";var ce=oe.exports,he=i.a.extend({name:"PickPointView",props:["screen"],computed:{title(){switch(this.screen.title){case B.LookPresenterVisibility.See:return"Вижу ...";case B.LookPresenterVisibility.Recall:return"Вспоминаю ...";case B.LookPresenterVisibility.Hidden:return"Без понятия ...";default:return this.screen.title}}},methods:{close(t){this.screen.onInput(t)},onEvent(t){switch(t.key){case"l":case"ArrowRight":return this.screen.moveTarget(B.Direction.right);case"h":case"ArrowLeft":return this.screen.moveTarget(B.Direction.left);case"k":case"ArrowUp":return this.screen.moveTarget(B.Direction.up);case"j":case"ArrowDown":return this.screen.moveTarget(B.Direction.down);case"y":return this.screen.moveTarget(B.Direction.upLeft);case"u":return this.screen.moveTarget(B.Direction.upRight);case"b":return this.screen.moveTarget(B.Direction.downLeft);case"n":return this.screen.moveTarget(B.Direction.downRight);case"Escape":case" ":this.screen.close()}}}}),ue=(s(225),Object(c.a)(he,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"look-modal"},[s("div",{staticClass:"title",domProps:{textContent:t._s(t.title)}}),t._l(t.screen.body,function(e){return s("div",{domProps:{textContent:t._s(e)}})})],2)},[],!1,null,"7db82404",null));ue.options.__file="PickPointView.vue";var le=ue.exports,de=i.a.extend({name:"MissileView",props:["screen"],methods:{close(t){this.screen.onInput(t)},onEvent(t){switch(t.key){case"l":case"ArrowRight":return this.screen.moveTarget(B.Direction.right);case"h":case"ArrowLeft":return this.screen.moveTarget(B.Direction.left);case"k":case"ArrowUp":return this.screen.moveTarget(B.Direction.up);case"j":case"ArrowDown":return this.screen.moveTarget(B.Direction.down);case"y":return this.screen.moveTarget(B.Direction.upLeft);case"u":return this.screen.moveTarget(B.Direction.upRight);case"b":return this.screen.moveTarget(B.Direction.downLeft);case"n":return this.screen.moveTarget(B.Direction.downRight);case">":this.screen.nextTarget();break;case"<":this.screen.previousTarget();break;case"t":this.screen.attack();break;case"Escape":this.screen.close()}}}}),pe=Object(c.a)(de,function(){var t=this.$createElement;return(this._self._c||t)("div")},[],!1,null,null,null);pe.options.__file="MissileView.vue";var me=pe.exports,fe=i.a.extend({name:"DeathView",props:["screen"],computed:{message(){switch(this.screen.dieReason){case B.DieReason.Attack:return"Смерть в бою честь для героя. Но жить мне все-таки нравилось больше";case B.DieReason.Missile:return"Раньше меня вела дорога приключений, но теперь и мне прострелили колено";case B.DieReason.Trap:return"Я так и не научился смотреть под ноги";case B.DieReason.Overloaded:return"Тяжко уйти от бремени, которое сам себе навязываешь.";default:return"Скучная смерть, которая даже не заслужила отдельного сообщения"}},signature(){return`Признался ${this.screen.playerName} перед смертью`}},methods:{onEvent(t){}}}),ge=(s(227),Object(c.a)(fe,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"screen-modal"},[e("div",{staticClass:"h4 title"},[this._v("Ты умер")]),e("div",{staticClass:"content mt-5"},[e("blockquote",{staticClass:"blockquote text-center signature"},[e("p",{staticClass:"mb-0",domProps:{textContent:this._s(this.message)}}),e("footer",{staticClass:"blockquote-footer",domProps:{textContent:this._s(this.signature)}})])])])},[],!1,null,null,null));ge.options.__file="DeathView.vue";var ve=ge.exports;var ye=i.a.extend({name:"PickSingleOptionView",props:["screen"],data:()=>({page:0,perPage:20,selected:[]}),computed:{title(){switch(this.screen.type){case l.PresenterType.PickHandleOption:return"С чем взаимодействовать?"}}},methods:{optionName(t){switch(this.screen.type){case l.PresenterType.PickHandleOption:return t[0]}},onEvent(t){switch(t.key){case"Escape":return this.screen.close();case"Enter":case" ":return this.screen.pickUpItems(this.selected.map(t=>this.screen.positions[t]));default:return this.selectAt(t.key.charCodeAt(0)-97)}},selectAt(t){t>=0&&t<Math.min(this.perPage,this.screen.options.length)&&this.screen.pick(this.screen.options[t])},indexLetter:t=>String.fromCharCode(97+t)}}),be=(s(229),Object(c.a)(ye,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"screen-modal"},[s("span",{staticClass:"title",domProps:{textContent:t._s(t.title)}}),s("table",{staticClass:"container options-list"},t._l(t.screen.options,function(e,i){return s("tr",{key:i},[s("td",{staticClass:"letter"},[t._v(t._s(t.indexLetter(i)))]),s("td",{staticClass:"separator"},[t._v("—")]),s("td",{staticClass:"name",domProps:{textContent:t._s(t.optionName(e))}})])}))])},[],!1,null,"08d3fe9c",null));be.options.__file="PickSingleOptionView.vue";var we=be.exports,Te=i.a.extend({name:"BasePage",props:["screen"],methods:{onEvent(t){}}}),Ce=(s(231),Object(c.a)(Te,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("div",{staticClass:"content-col"},[s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v("Level:\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.currentLevel))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v("Experience:\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.currentExperience))])])])])},[],!1,null,"072a3c41",null));Ce.options.__file="BasePage.vue";var Pe=Ce.exports;var xe=i.a.extend({name:"EquipmentPage",props:["screen"],data:()=>({page:0,perPage:20}),computed:{player(){return this.screen.player},carryingWeight(){return`Нагрузка ${Math.round(100*this.player.stuffWeight.current)/100} из ${this.player.carryingCapacity.stressed}`}},methods:{onEvent(t){switch(t.key){case" ":case"Escape":return this.screen.close();default:return this.selectAt(t.key.charCodeAt(0)-97)}},selectAt(t){if(t>=0&&t<Math.min(this.perPage,this.screen.positions.length)){const e=this.screen.positions[t];e.item?this.screen.takeOff(e):e.availableItems.length&&this.screen.putOn(e)}},positionDetails(t){if(t.item&&t.item.canSeeDetails)return function(t){return t instanceof l.Weapon?t.damages.map(Ht).join(","):t instanceof l.Armor?t.protections.map(Ut).join(","):void 0}(t.item)},indexLetter:t=>String.fromCharCode(97+t),positionStatus:t=>t.item?"text-success":"",displayBodyPart:t=>t.name,displayItem(t){if(t)return`${ft(t).getChar()} ${t.name}`},itemName:t=>t.item&&t.count?`${t.item.name} ${t.count>1?`(${t.count})`:""}`:"-",itemWeight(t){if(t.item&&t.count)return`[${t.item.weight*t.count}kg]`},available:t=>t.item||t.availableItems.length,availableStatus(t){return this.available(t)?"-available":"-unavailable"}}}),Me=(s(233),Object(c.a)(xe,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"subtitle mb-3",domProps:{textContent:t._s(t.carryingWeight)}}),s("table",{staticClass:"content inventory-list"},t._l(t.screen.positions,function(e,i){return s("tr",{key:i,class:t.availableStatus(e)},[s("td",{staticClass:"slot"},[s("span",{staticClass:"letter"},[t._v(t._s(t.indexLetter(i)))]),s("span",{staticClass:"dash"},[t._v("—")]),s("span",{staticClass:"part"},[t._v(t._s(t.displayBodyPart(e.inventorySlot)))]),s("span",{staticClass:"separator"},[t._v(":")])]),s("td",{staticClass:"name-slot"},[s("span",{staticClass:"name",class:t.positionStatus(e)},[t._v(t._s(t.itemName(e)))]),s("small",{staticClass:"details",domProps:{textContent:t._s(t.positionDetails(e))}})]),s("td",{staticClass:"weight"},[t._v(t._s(t.itemWeight(e)))])])}))])},[],!1,null,null,null));Me.options.__file="EquipmentPage.vue";var ke=Me.exports,Ie=i.a.extend({name:"HistoryInfoPage",props:["screen"],methods:{onEvent(t){}},components:{PlayerBackground:E}}),_e=(s(235),Object(c.a)(Ie,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("div",{staticClass:"content-col"},[s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("name","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.name))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("gender","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t._f("t")(t.screen.gender,"genders")))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("race","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t._f("t")(t.screen.race.name,"races")))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("height","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.height)+"sm")])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("weight","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.weight)+"kg")])])]),s("div",{staticClass:"content-col"},[s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("eye","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t._f("t")(t.screen.eyeColor,"colors")))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("hair","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t._f("t")(t.screen.hairColor,"colors")))])]),s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("skin","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t._f("t")(t.screen.skinColor,"colors")))])])]),s("div",{staticClass:"content-col"},[s("div",{staticClass:"attribute-row"},[s("span",{staticClass:"name"},[t._v(t._s(t._f("t")("turns","presenters.baseInfo"))+":\n")]),s("span",{staticClass:"value"},[t._v(t._s(t.screen.turns))])])]),s("PlayerBackground",{attrs:{player:t.screen.player}})],1)},[],!1,null,"b70be12e",null));_e.options.__file="HistoryInfoPage.vue";var Ee=_e.exports,Oe=i.a.extend({name:"CharacterInfoView",props:["screen"],methods:{onEvent(t){switch(t.key){case"@":return this.screen.goToBaseInfo();case"#":return this.screen.goToInventory();case"%":return this.screen.goToTalents();case"&":return this.screen.goToHistoryInfo();case"Escape":return this.screen.goIdle();default:this.$refs.pageComponent.onEvent(t)}}},computed:{page(){switch(this.screen.page){case l.CharacterInfoPage.Base:return Pe;case l.CharacterInfoPage.Equipment:return ke;case l.CharacterInfoPage.Talents:return L;case l.CharacterInfoPage.History:return Ee;default:return Pe}},pages:()=>[{type:l.CharacterInfoPage.Base,name:"baseInfo",key:"@"},{type:l.CharacterInfoPage.Equipment,name:"equipment",key:"#"},{type:l.CharacterInfoPage.Talents,name:"talentsInfo",key:"%"},{type:l.CharacterInfoPage.History,name:"historyInfo",key:"&"}],activeOption(){let t=this.pages.find(({type:t})=>t===this.screen.page);return t?t.name:"baseInfo"}},components:{BasePage:Pe,EquipmentPage:ke,TalentsPage:L}}),Se=(s(237),Object(c.a)(Oe,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"screen-modal"},[t._l(t.pages,function(e){var i=e.name,r=e.key;return s("div",{staticClass:"head-option",class:{"-active":t.activeOption===i}},[t._v("["),s("span",{staticClass:"key"},[t._v(t._s(r))]),t._v("]\n"+t._s(t._f("t")(i,"presenters.infoViewsHead")))])}),s(t.page,{ref:"pageComponent",tag:"component",attrs:{screen:t.screen}})],2)},[],!1,null,"96dddce8",null));Se.options.__file="CharacterInfoView.vue";var De=Se.exports,Re=i.a.extend({name:"Game",props:["game"],data:()=>({loopIntervalId:void 0}),components:{Impacts:Kt,Logger:V,Scene:$t,Stats:zt},computed:{viewComponent(){if(this.game.playerTurn&&this.game.player.ai.presenter)switch(this.game.player.ai.presenter.type){case B.PresenterType.TalentsPicking:return ce;case B.PresenterType.ProfessionPicking:return se;case B.PresenterType.Idle:return Zt;case B.PresenterType.ItemsListing:return ne;case B.PresenterType.Missile:return me;case B.PresenterType.Teleportation:case B.PresenterType.Look:return le;case B.PresenterType.Death:return ve;case B.PresenterType.PickHandleOption:return we;case B.PresenterType.CharacterInfo:return De;default:throw`App: unknown presenter ${this.game.player.ai.presenter}`}}},methods:{loop(){this.game.turn()},onEvent(t){const e=this.$refs.viewComponent;e&&e.onEvent(t)}}}),Ae=(s(239),Object(c.a)(Re,function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.game?s("div",{attrs:{id:"game-screen"}},[t.game.player?s("Scene",{staticClass:"scene",attrs:{level:t.game.currentMap,player:t.game.player,pos:t.game.currentMap.creaturePos(t.game.player)}}):t._e(),t.game.player?s("Stats",{staticClass:"player-stats",attrs:{creature:t.game.player,"level-map":t.game.currentMap}}):t._e(),s("Logger",{staticClass:"logger-panel",attrs:{logger:t.game.logger}}),s("Impacts",{staticClass:"effect-panel",attrs:{impacts:t.game.player.impacts}}),t.game.playerTurn?s(t.viewComponent,{ref:"viewComponent",tag:"component",attrs:{screen:t.game.player.ai.presenter}}):t._e()],1):t._e()},[],!1,null,null,null));Ae.options.__file="Game.vue";var Ne=Ae.exports;var Be=i.a.extend({name:"Main",data(){const t=new l.Application;return{app:t,background:t.newTitleGame(),loopIntervalId:void 0,step:0}},computed:{menuPage(){if(this.app.menu)switch(this.app.menu.component){case l.MenuComponent.MainMenu:return N;case l.MenuComponent.ChooseGenderMenu:return v;case l.MenuComponent.ChooseRaceMenu:return P;case l.MenuComponent.ChooseProfessionMenu:return w;case l.MenuComponent.AttributesSelectionMenu:return m;case l.MenuComponent.EnterNameMenu:return k;case l.MenuComponent.BackgroundMenu:return D;case l.MenuComponent.TalentsMenu:return H}},backgroundPos(){if(this.background.currentMap)return new l.Point(Math.round(.5*this.background.currentMap.width),Math.round(.4*this.background.currentMap.height))},game(){return this.app.mainGame}},components:{Scene:$t,Game:Ne},methods:{loop(){this.$refs.gameComponent;this.game&&this.$refs.gameComponent?this.$refs.gameComponent.loop():this.background&&(this.step+=1,this.step>=10&&(this.step=0,this.background.turn(),this.background.done&&(this.background=this.app.newTitleGame())))},onEvent(t){const e=this.$refs.gameComponent;e&&e.onEvent(t);const s=this.$refs.menuComponent;s&&s.onEvent(t)}},created(){this.loopIntervalId=window.setInterval(this.loop,10),document.addEventListener("keydown",this.onEvent)},beforeDestroy(){clearInterval(this.loopIntervalId),document.removeEventListener("keydown",this.onEvent)}}),We=(s(241),Object(c.a)(Be,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container-fluid"},[t.game?s("Game",{ref:"gameComponent",attrs:{game:t.game}}):t.background?s("Scene",{attrs:{level:t.background.currentMap,player:t.background.player,pos:t.backgroundPos}}):t._e(),t.app.menu?s("div",{staticClass:"title-view screen-modal"},[s("pre",{staticClass:"title"},[t._v(" ██████╗ ███╗   ██╗██╗███████╗██╗   ██╗███╗   ██╗\n██╔═══██╗████╗  ██║██║██╔════╝██║   ██║████╗  ██║\n██║   ██║██╔██╗ ██║██║███████╗██║   ██║██╔██╗ ██║\n██║   ██║██║╚██╗██║██║╚════██║██║   ██║██║╚██╗██║\n╚██████╔╝██║ ╚████║██║███████║╚██████╔╝██║ ╚████║\n ╚═════╝ ╚═╝  ╚═══╝╚═╝╚══════╝ ╚═════╝ ╚═╝  ╚═══╝")]),s(t.menuPage,{ref:"menuComponent",tag:"component",attrs:{menu:t.app.menu}})],1):t._e()],1)},[],!1,null,null,null));We.options.__file="Main.vue";var $e=We.exports;i.a.use(r.a),fetch("locales/en.json",{cache:"no-store"}).then(t=>t.json()).then(t=>{const e=new a.a({phrases:t,locale:"en"});i.a.filter("t",(t,s,i,r)=>e.t(i?`${s}.${t}.${i}`:`${s}.${t}`,r));i.a.filter("indexLetter",t=>String.fromCharCode(97+t)),new i.a({el:"#app",render:t=>t($e)})})}]);
//# sourceMappingURL=main.0937fda8.js.map